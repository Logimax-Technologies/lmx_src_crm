var path = url_params();

var ctrl_page = path.route.split('/');

var export_list = [];

var reorder_export_list = [];

var charges_master_details = [];

var weight_list = [];

var size_list = [];

$(document).ready(function () {

	$.extend(true, $.fn.dataTable.defaults, {

		dom: 'Bfrtip',

		buttons: [

			{

				extend: 'colvis',

				collectionLayout: 'fixed columns',

				collectionTitle: 'Column visibility control'

			}

		]

	});

	$(window).scroll(function () {    // this will work when your window scrolled.

		var height = $(window).scrollTop();  //getting the scrolling height of window

		if (height > 300) {

			$(".stickyBlk").css({ "position": "fixed" });

		} else {

			$(".stickyBlk").css({ "position": "static" });

		}

	});

	$('.dateRangePicker').daterangepicker({

		format: 'DD/MM/YYYY',

		//startDate:  moment().subtract(6, 'days'),

		endDate: moment(),

	});

	switch (ctrl_page[1]) {

		case 'cash_book':

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#rpt_from_date').html(from_date);

			$('#rpt_to_date').html(to_date);

			$('#rpt_date_picker').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(0, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#rpt_from_date').text(start.format('YYYY-MM-DD'));

					$('#rpt_to_date').text(end.format('YYYY-MM-DD'));

				}

			);

			break;

		case 'tagwiseprofit':

			get_ActiveMetals();

			break;

		case 'sales_transfer_report':

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#rpt_from_date').html(from_date);

			$('#rpt_to_date').html(to_date);

			$('#rpt_date_picker').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(0, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#rpt_from_date').text(start.format('YYYY-MM-DD'));

					$('#rpt_to_date').text(end.format('YYYY-MM-DD'));

				}

			);

			break;

		case 'advance_transfer_details':

			get_advance_transfer_details();

			break;

		case 'repair_order':

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#rpt_from_date').html(from_date);

			$('#rpt_to_date').html(to_date);

			$('#rpt_date_picker').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(0, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#rpt_from_date').text(start.format('YYYY-MM-DD'));

					$('#rpt_to_date').text(end.format('YYYY-MM-DD'));

				}

			);

			$("#emp_select").select2({

				placeholder: "Select Employee",

				allowClear: true

			});

			get_ActiveEmployee();

			get_ActiveKarigars();

			break;

		case 'tagging_history':

			$('body').on('click', '.next-tab', function () {

				var next = $('.nav-tabs > .active').next('li');

				if (next.length) {

					next.find('a').trigger('click');

				} else {

					$('#billing-tab a:first').tab('show');

				}

			});

			break;

		case 'employee_sales_referal_and_sales_return':

			get_ActiveMetals();

			get_category();

			get_ActiveProduct();

			// set_estimation_referral_and_sales_return();

			break;

		case 'customer_sales_analysis':

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#rpt_payments1').html(from_date);

			$('#rpt_payments2').html(to_date);

			//get_cheque_collection_report();

			$('#rpt_payment_date').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(29, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#rpt_payment_date').html(start.format('D/M/YYYY') + ' - ' + end.format('D/M/YYYY'));

					$('#rpt_payments1').text(start.format('DD-MM-YYYY'));

					$('#rpt_payments2').text(end.format('DD-MM-YYYY'));

				}

			);

			break;

		case 'repair_gst_abstract':

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#rpt_from_date').html(from_date);

			$('#rpt_to_date').html(to_date);

			$('#rpt_date_picker').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(0, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#rpt_date_picker').html(start.format('D/M/YYYY') + ' - ' + end.format('D/M/YYYY'));

					$('#rpt_from_date').text(start.format('DD-MM-YYYY'));

					$('#rpt_to_date').text(end.format('DD-MM-YYYY'));

				}

			);

			break;

		case 'item_delivery_report':

			$('#item_status').select2({

				placeholder: 'Select Status',

				allowClear: true

			});

			get_ItemDeliveryDetails();

			break;

		case 'stock_age_analysis':

			get_ActiveKarigars();

			get_ActiveMetals();

			get_category();

			get_ActiveProduct();

			break;

		case 'old_metal_purchase':

			get_ActiveMetals();

			set_old_metal_table();

			break;

		case 'bill_wise_transcation':

			get_ActiveFloors();

			get_ActiveCounters();

			get_ActiveVillage();

			get_ActiveMetals();

			get_category();

			get_ActiveSections();

			$('#bill_wise_type').select2({

				placeholder: 'Select type',

				allowClear: true

			});

			break;

		case 'day_closing_report':

			$('.datePicker').datepicker({

				dateFormat: 'mm-dd-yy'

			});

			break;

		case 'detailed_day_transaction_report':

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#rpt_payments1').html(from_date);

			$('#rpt_payments2').html(to_date);

			$('#rpt_payment_date').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(0, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#rpt_payments1').text(start.format('YYYY-MM-DD'));

					$('#rpt_payments2').text(end.format('YYYY-MM-DD'));

				}

			);

			get_ActiveMetals();

			get_category();

			get_ActiveProduct();

			$("#branch_select").on("change", function () {

				get_ActiveSections();

			});

			$('#bill_type').select2({

				placeholder: 'Select Bill Type',

				allowClear: true

			});

			$('#det_sales_report_type').select2({

				placeholder: 'Select Report Type',

				allowClear: true

			});

			break;

		case 'stock_age':

			get_ActiveKarigars();

			get_ActiveMetals();

			get_category();

			get_ActiveProduct();

			$("#select_size").select2({

				placeholder: "Select Size",

				allowClear: true

			});

			$("#sub_des_select").select2({

				placeholder: "Select Sub Design",

				allowClear: true

			});

			$("#wt_select").select2({

				placeholder: "Select Weight Range",

				allowClear: true

			});

			$("#des_select").select2({

				placeholder: "Select Design",

				allowClear: true

			});

			$("#age_type").select2({

				placeholder: "Select Age Type",

				allowClear: true

			});

			$('#des_select').on('change', function () {

				get_ActiveSubDesign();

			});

			switch (ctrl_page[2]) {

				case 'tag_list':

					if (ctrl_page[6] != ''){

						$('#id_branch').val(ctrl_page[6]);

					}

					get_branchname_list();

					get_stock_age_tag_list();

					break;

				case 'dynamic':

					$('#sub_des_select').select2({

						placeholder: 'Select Sub Design',

						allowClear: true

					});

					get_Activedesign();

					get_ActiveSubDesign();

					get_ActiveSections();

					$("#branch_select").on("change", function () {

						get_ActiveSections();

					});

					$("#stock_age_group_by").select2({

						placeholder: "Select Group By",

						allowClear: true

					});

					break;

			}

			break;

		case 'lot_wise':

			get_ActiveKarigars();

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#rpt_payments1').html(from_date);

			$('#rpt_payments2').html(to_date);

			set_lotwise_table();

			$('#rpt_payment_date').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(0, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#rpt_payments1').text(start.format('YYYY-MM-DD'));

					$('#rpt_payments2').text(end.format('YYYY-MM-DD'));

				}

			);

			break;

		case 'partly_sold':

			set_partlysold_table();

			break;

		case 'cash_abstract':

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#rpt_payments1').html(from_date);

			$('#rpt_payments2').html(to_date);

			$('#rpt_payment_date').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(0, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#rpt_payments1').text(start.format('YYYY-MM-DD'));

					$('#rpt_payments2').text(end.format('YYYY-MM-DD'));

				}

			);

			get_ActiveFloors();

			get_ActiveCounters();

			get_employee("cash_abs");

			$('#emp_sel').select2({

				placeholder: 'Select Employee',

				allowClear: true

			});

			break;

		case 'branch_trans':

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#rpt_payments1').html(from_date);

			$('#rpt_payments2').html(to_date);

			$('#rpt_payment_date').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(0, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#rpt_payments1').text(start.format('YYYY-MM-DD'));

					$('#rpt_payments2').text(end.format('YYYY-MM-DD'));

				}

			);

			$('#branch_transfer_type').select2({

				placeholder: "Trans Type",

				allowClear: true

			});

			$('#trans_status').select2({

				placeholder: " Select status",

				allowClear: true

			});

			$('#group_by').select2({

				placeholder: "Select Group By",

				allowClear: true

			}).val(null).trigger("change");

			$('#transtype').select2({

				placeholder: "Select Type",

				allowClear: true

			}).val(null).trigger("change");

			$('#trans_status').select2({

				placeholder: "Select Status",

				allowClear: true

			}).val(null).trigger("change");

			$('#brans_type').select2({

				placeholder: "Select Date",

				allowClear: true

			}).val(null).trigger("change");

			$('#branch_select_to').select2({

				placeholder: "To Branch",

				allowClear: true

			});

			if (ctrl_page[1] == 'branch_trans' && ctrl_page[2] == 'list') {

				$('#branch_select').select2({

					placeholder: "From Branch",

					allowClear: true

				}).val(null).trigger("change");

				$('#branch_select_to').select2({

					placeholder: "To Branch",

					allowClear: true

				}).val(null).trigger("change");

			}

			if (ctrl_page[2] == 'approval_pending') {

				getApprovalPending();

			} else {

				get_ActiveMetals();

				get_ActiveSections();

				get_category();

				//set_btreport_table();

			}

			break;

		case 'credit_issued':

			set_credit_issued_table();

			break;

		case 'credit_history':

			get_ActiveCustomer();

			set_credit_history_table();

			break;

		case 'tobe_history':

			get_ActiveCustomer();

			set_tobe_history_table();

			break;

		case 'tobe_pending':

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#rpt_from_date').html(from_date);

			$('#rpt_to_date').html(to_date);

			$('#rpt_date_picker').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(0, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#rpt_date_picker').html(start.format('D/M/YYYY') + ' - ' + end.format('D/M/YYYY'));

					$('#rpt_from_date').text(start.format('DD-MM-YYYY'));

					$('#rpt_to_date').text(end.format('DD-MM-YYYY'));

				}

			);

			set_tobe_pending_list();

			break;

		case 'stock_reserve_order':

			get_reserve_order();

			get_ActiveProduct();

			get_customer_reserveOrders();

			$("#sub_des_select").select2(

				{

					placeholder: "Select Sub Design",

					allowClear: true

				});

			$("#des_select").select2(

				{

					placeholder: "Select Design",

					allowClear: true

				});

			break;

		case 'advance_history':

			set_advance_history_table();

			break;

		case 'chit_closing_details':

			set_chit_closing_table();

			break;

		case 'card_payment':

			var today = new Date();

			var formattedDate = (today.getDate() + "-" + (today.getMonth() + 1) + "-" + today.getFullYear());

			$('#referencedate').val(formattedDate);

			$('#referencedate').datepicker({ format: 'dd-mm-yyyy', endDate: today });

			set_card_payment_table();

			break;

		case 'copy_bill_details':

			set_copy_bill_table();

			break;

		case 'pan_bill_details':

			set_pan_bill_table();

			break;

		case 'cancelled_bills':

			set_cancelledBills();

			break;

		case 'bill_discount':

			get_ActiveMetals();

			get_category();

			get_ActiveProduct();

			get_category();

			$("#sub_des_select").select2({

				placeholder: "Select Sub Design",

				allowClear: true

			});

			$("#prod_select").select2({

				placeholder: "Select Product",

				allowClear: true

			});

			$("#des_select").select2({

				placeholder: "Select Design",

				allowClear: true

			});

			$("#is_otp_approved").select2({

				placeholder: "Select Discount Type",

				allowClear: true

			});

			set_discBills();

			break;

		case 'gst_bill':

			set_gstBills();

			break;

		case 'reorder_items':

			//set_reorder_items();

			get_ActiveProduct();

			$("#select_size").select2({

				placeholder: "Select Size",

				allowClear: true

			});

			$("#sub_des_select").select2({

				placeholder: "Select Sub Design",

				allowClear: true

			});

			$("#wt_select").select2({

				placeholder: "Select Weight Range",

				allowClear: true

			});

			$("#des_select").select2({

				placeholder: "Select Design",

				allowClear: true

			});

			//get_weight_range();

			break;

		case 'branchreorder_items':

			//set_reorder_items();

			get_ActiveProduct();

			$("#select_size").select2({

				placeholder: "Select Size",

				allowClear: true

			});

			$("#sub_des_select").select2({

				placeholder: "Select Sub Design",

				allowClear: true

			});

			$("#wt_select").select2({

				placeholder: "Select Weight Range",

				allowClear: true

			});

			$("#des_select").select2({

				placeholder: "Select Design",

				allowClear: true

			});

			set_branchreorder_items();

			$('#des_select').on('change', function () {

				if (this.value != '') {

					if (ctrl_page[1] == 'branchreorder_items') {

						get_ActiveSubDesign();

					}

				}

			});

			//get_weight_range();

			break;

		case 'tag_items_designwise':

			get_ActiveMetals();

			get_Activedesign('');

			get_ActiveSections();

			get_ActiveProduct();

			get_category();

			get_ActiveKarigars();

			get_ActiveCollection();

			get_Active_purity();

			$('.available_stk_date').datepicker({ format: 'dd-mm-yyyy' });

			$("#select_size").select2({

				placeholder: "Select Size",

				allowClear: true

			});

			$("#select_purity").select2({

				placeholder: "Select Purity",

				allowClear: true

			});

			$("#section").select2({

				placeholder: "Select Section",

				allowClear: true

			});

			$("#select_collection").select2({

				placeholder: "Select Collection",

				allowClear: true

			});

			$("#sub_des_select").select2(

				{

					placeholder: "Select Sub Design",

					allowClear: true

				});

			break;

		case 'tagged_item_report':

			get_ActiveMetals();

			get_Activedesign('');

			get_ActiveSections();

			get_ActiveProduct();

			get_category();

			get_ActiveKarigars();

			get_ActiveCollection();

			get_Active_purity();

			$("#select_size").select2({

				placeholder: "Select Size",

				allowClear: true

			});

			$("#select_purity").select2({

				placeholder: "Select Purity",

				allowClear: true

			});

			$("#section").select2({

				placeholder: "Select Section",

				allowClear: true

			});

			$("#select_collection").select2({

				placeholder: "Select Collection",

				allowClear: true

			});

			$("#sub_des_select").select2(

				{

					placeholder: "Select Sub Design",

					allowClear: true

				});

			break;

		case 'reorder_report':

			get_Activedesign('');

			get_ActiveSections();

			get_ActiveProduct();

			$("#section").select2({

				placeholder: "Select Section",

				allowClear: true

			});

			$("#sub_des_select").select2(

				{

					placeholder: "Select Sub Design",

					allowClear: true

				});

			$("#sub_des_select").select2(

				{

					placeholder: "Select Sub Design",

					allowClear: true

				});

			$("#reorder_groupby").select2(

				{

					placeholder: "Group By",

					allowClear: true

				});

			break;

		case 'section_stock_inout':

			get_ActiveMetals();

			get_ActiveProduct();

			get_ActiveSections();

			get_Activedesign('');

			$("#sub_des_select").select2(

				{

					placeholder: "Select Sub Design",

					allowClear: true

				});

			$("#des_select").select2(

				{

					placeholder: "Select Design",

					allowClear: true

				});

			$('#des_select').on('change', function () {

				if (this.value != '') {

					if (ctrl_page[1] == 'section_stock_inout') {

						get_ActiveSubDesign();

					}

				}

			});

			break;

		case 'stock_report':

			get_ActiveMetals();

			get_category();

			get_ActiveProduct();

			//stock_report();

			break;

		case 'branch_vault_report':

			get_ActiveMetals();

			$('#stock_type').select2({

				placeholder: "Select Stock type",

				allowClear: true

			})

			break;

		case 'ho_daily_stock_book':

			get_ActiveMetals();

			break;

		case 'stock_issue_report':

			$('#issue_type').select2({

				placeholder: "Select Issue Type",

				allowClear: true

			});

			get_ActiveKarigars();

			get_stock_issue_report();

			break;

		case 'gst_bills':

			get_category();

			$("#category_select").select2({

				placeholder: "Select Category",

				allowClear: true

			});

			break;

		case 'stock_details':

			get_ActiveMetals();

			get_category();

			get_ActiveProduct();

			get_Activedesign('');

			get_Active_stockSubDesign();

			// setTimeout(function () {

			// 	get_stock_details();

			//    }, 1000);

			$("#sub_des_select").select2(

				{

					placeholder: "Select Sub Design",

					allowClear: true

				});

			//get_stock_details();

			break;

		case 'approvalstock_details':

			get_ActiveMetals();

			get_category();

			get_ActiveProduct();

			//get_stock_details();

			break;

		case 'stock_checking':

			get_ActiveProduct();

			stock_checking();

			break;

		case 'tag_scan_missing':

			get_ActiveProduct();

			tag_missing_report();

			break;

		case 'scan_report':

			get_ActiveSections();

			get_ActiveProduct();

			get_category();

			$("#select_size").select2({

				placeholder: "Select Size",

				allowClear: true

			});

			$("#sub_des_select").select2(

				{

					placeholder: "Select Sub Design",

					allowClear: true

				});

			$("#category_select").select2(

				{

					placeholder: "Select Category",

					allowClear: true

				});

			$("#des_select").select2(

				{

					placeholder: "Select Design",

					allowClear: true

				});

			$("#section_select").select2(

				{

					placeholder: "Select Section",

					allowClear: true

				});

			if (ctrl_page[2] == 'scanned_details') {

				get_ActiveSections();

				get_scanned_details_report();

			}

			break;

		case 'item_sales':

			get_ActiveProduct();

			get_ActiveMetals();

			//itemwise_sales();

			break;

		case 'home_bill':

			get_home_bill_sales();

			get_ActiveMetals();

			get_category();

			get_ActiveProduct();

			$('#des_select').select2({

				placeholder: "Select Design",

				allowClear: true

			});

			$('#sub_des_select').select2({

				placeholder: "Select Sub Design",

				allowClear: true

			});

			break;

		case 'order_advance':

			set_order_advance();

			$('#filterby').select2();

			break;

		case 'est_referral':

			get_ActiveMetals();

			get_category();

			get_ActiveProduct();

			set_estimation_referral();

			get_ActiveEmployee();

			$("#sub_des_select").select2({

				placeholder: "Select Sub Design",

				allowClear: true

			});

			$("#emp_select").select2({

				placeholder: "Select Employee",

				allowClear: true

			});

			$("#des_select").select2({

				placeholder: "Select Design",

				allowClear: true

			});

			break;

		case 'other_issue':

			get_ActiveProduct();

			set_other_issue();

			get_ActiveMetals();

			get_ActiveSections();

			get_Activedesign('');

			get_ActiveKarigars();

			$('#sub_des_select').select2({

				placeholder: 'Select Sub Design',

				allowClear: true

			});

			$('#karigar').select2({

				placeholder: 'Select Karigar',

				allowClear: true

			});

			break;

		case 'karigar_wise_sales_detail':

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#rpt_payments1').html(from_date);

			$('#rpt_payments2').html(to_date);

			$('#rpt_payment_date').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(0, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#rpt_payments1').text(start.format('YYYY-MM-DD'));

					$('#rpt_payments2').text(end.format('YYYY-MM-DD'));

				}

			);

			get_karigar_wise_sales_detail();

			get_ActiveProduct();

			get_Activedesign('');

			$('#des_select').on('change', function () {

				if (this.value != '') {

					if (ctrl_page[1] == 'karigar_wise_sales_detail') {

						get_ActiveSubDesign();

					}

				}

			});

			$("#sub_des_select").select2(

				{

					placeholder: "Select Sub Design",

					allowClear: true

				});

			get_ActiveKarigars();

			break;

		case 'tag_history':

			//set_tag_history();

			break;

		case 'order_status':

			$('#order_status').select2({

				placeholder: "Select Order Status",

				allowClear: true

			});

			$('#order_status').select2("val", '');

			get_order_status();

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#rpt_payments1').html(from_date);

			$('#rpt_payments2').html(to_date);

			set_order_status_report();

			$('#rpt_payment_date').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(0, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#rpt_payments1').text(start.format('YYYY-MM-DD'));

					$('#rpt_payments2').text(end.format('YYYY-MM-DD'));

				}

			);

			break;

		case 'monthly_sales':

			set_monthly_sales();

			break;

		case 'old_metal_analyse':

			get_old_metal_type();

			set_old_metal_analyse_table();

			break;

		case 'sales_analysis_report':

			if (ctrl_page[2] == 'list') {

				var date = new Date();

				var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 30, 1);

				var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

				var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

				$('#rpt_payments1').html(from_date);

				$('#rpt_payments2').html(to_date);

				//get_sales_analysis_report();

				$('#rpt_payment_date').daterangepicker(

					{

						ranges: {

							'Today': [moment(), moment()],

							'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

							'Last 7 Days': [moment().subtract(6, 'days'), moment()],

							'Last 30 Days': [moment().subtract(29, 'days'), moment()],

							'This Month': [moment().startOf('month'), moment().endOf('month')],

							'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

						},

						startDate: moment().subtract(29, 'days'),

						endDate: moment()

					},

					function (start, end) {

						$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

						$('#rpt_payments1').text(start.format('YYYY-MM-DD'));

						$('#rpt_payments2').text(end.format('YYYY-MM-DD'));

					}

				);

				//get_ActiveVillage();

				//get_ActiveProduct();

				//get_ActiveZone();

			}

			else if (ctrl_page[2] == 'chit_details') {

				get_chit_analysis_report();

			}

			else if (ctrl_page[2] == 'sales_details') {

				get_sales_analysis_details_report();

			}

			else if (ctrl_page[2] == 'product_details') {

				get_product_analysis_details_report();

			}

			else if (ctrl_page[2] == 'without_acc_list') {

				get_without_acc_list();

			}

			break;

		case 'unbilled_estimation':

			set_unbilled_estimation();

			break;

		case 'karigar_wise_sales':

			get_karigar_wise_sales();

			get_ActiveProduct();

			break;

		case 'lot_history':

			switch (ctrl_page[2]) {

				case 'list':

					setLotHisory();

					break;

				case 'lot_details':

					get_lot_details();

					break;

			}

			break;

		case 'lot_merge_report':

			getlotMergeNos();

			$('#lot_nos').select2({

				placeholder: "Select Lot",

				allowClear: true

			});

			get_lot_merge_details();

			break;

		case 'lot_split_report':

			get_ActiveEmployee();

			$('#emp_select').select2({

				placeholder: "Select Employee",

				allowClear: true

			});

			get_lot_split_details();

			break;

		case 'green_tag':

			get_ActiveMetals();

			get_category();

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 30, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#rpt_payments1').html(from_date);

			$('#rpt_payments2').html(to_date);

			get_getGreenTagDetails();

			$('#rpt_payment_date').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(30, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#rpt_payments1').text(start.format('YYYY-MM-DD'));

					$('#rpt_payments2').text(end.format('YYYY-MM-DD'));

				}

			);

			break;

		case 'sales_comparision':

			get_ActiveProduct();

			//get_sales_comparision();

			break;

		case 'customer_history':

			if (ctrl_page[3] != '' && ctrl_page[3] != undefined) {

				get_customer_details();

			}

			break;

		case 'credit_pending':

			get_influencer();

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#rpt_from_date').html(from_date);

			$('#rpt_to_date').html(to_date);

			$('#rpt_date_picker').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(0, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#rpt_date_picker').html(start.format('D/M/YYYY') + ' - ' + end.format('D/M/YYYY'));

					$('#rpt_from_date').text(start.format('DD-MM-YYYY'));

					$('#rpt_to_date').text(end.format('DD-MM-YYYY'));

				}

			);

			set_credit_pending_list();

			break;

		case 'stock_and_sales_report':

			set_stock_and_sales_list();

			break;

		case 'incentive_report':

			switch (ctrl_page[2]) {

				case 'emp_list':

					set_incentive_emp_list();

					break;

			}

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 30, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

		       /* $('#rpt_payments1').html(from_date);

                $('#rpt_payments2').html(to_date);

               */  set_incentive_report();

			$('#rpt_payment_date').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(30, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#rpt_payments1').text(start.format('YYYY-MM-DD'));

					$('#rpt_payments2').text(end.format('YYYY-MM-DD'));

				}

			);

			break;

		case 'monthly_slaes_comparision':

			if (ctrl_page[2] == 'list') {

				$('#yearpicker').select2({

					placeholder: "Select Year",

					allowClear: true

				});

				current_year = new Date().getFullYear();

				$('#cur_year').val(current_year);

				$("#yearpicker").select2("val", current_year);

				for (i = new Date().getFullYear(); i > 2000; i--) {

					$('#yearpicker').append($('<option />').val(i).html(i));

				}

				$('#yearpicker').on('change', function () {

					$('#cur_year').val(this.value);

				});

				get_ActiveVillage();

				monthly_slaes_comparision();

			} else if (ctrl_page[2] == 'detailed_list') {

				get_monthly_sales_details();

			}

			break;

		case 'telecalling':

			$('#select_zone').select2({

				placeholder: "Select Zone",

				allowClear: true

			});

			$('#select_village').select2({

				placeholder: "Select Area",

				allowClear: true

			});

			get_ActiveZone();

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#rpt_cus1').html(from_date);

			$('#rpt_cus2').html(to_date);

			$('#rpt_customer').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(0, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#rpt_cus1').text(start.format('YYYY-MM-DD'));

					$('#rpt_cus2').text(end.format('YYYY-MM-DD'));

				}

			);

			break;

		case 'feedback_report':

			get_feedback_report();

			break;

		case 'customer_edit_log':

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

			var from_date = firstDay.getFullYear() + '-' + (firstDay.getMonth() + 1) + '-' + firstDay.getDate();

			var to_date = (date.getFullYear() + "-" + (date.getMonth() + 1) + "-" + date.getDate());

			$('#customer_edit_log_date1').html(from_date);

			$('#customer_edit_log_date2').html(to_date);

			set_customer_edit_log_table();

			$('#customer_edit_log_date').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(0, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#customer_edit_log_date1').text(start.format('YYYY-MM-DD'));

					$('#customer_edit_log_date2').text(end.format('YYYY-MM-DD'));

					set_customer_edit_log_table();

				}

			);

			break;

		case 'gt_return_report':

			set_gt_return_report_table();

			break;

		case 'dashboard_estimation':

			set_dashboard_estimationList();

			break;

		case 'dashboard_sales':

			set_dashboard_salesList();

			break;

		case 'dashboard_greentag':

			set_dashboard_greentagList();

			break;

		case 'dashboard_oldmetal':

			set_dashboard_oldmetalList();

			break;

		case 'dashboard_creditsales':

			set_dashboard_creditsalesList();

			break;

		case 'dashboard_giftcard':

			set_dashboard_giftcardList();

			break;

		case 'dashboard_virtualsales':

			set_dashboard_virtualsalesList();

			break;

		case 'dashboard_lottag':

			set_dashboard_lottagList();

			break;

		case 'dashboard_customerorder':

			set_dashboard_customerorderList();

			break;

		case 'dashboard_salereturn':

			set_dashboard_salereturnList();

			break;

		case 'dashboard_greentag_incent':

			set_dashboard_greentagincentList();

			break;

		case 'dashboard_lot':

			set_dashboard_lotList();

			break;

		case 'dashboard_tag':

			set_dashboard_tagList();

			break;

		case 'dashboard_ordermanagement':

			set_dashboard_ordermangement();

			get_ActiveProduct();

			$("#prod_select").select2(

				{

					placeholder: "Select Product",

					allowClear: true

				});

			$('#order_status').select2({

				placeholder: "Select Order Status",

				allowClear: true

			});

			$("#des_select").select2(

				{

					placeholder: "Select Design",

					allowClear: true

				});

			$("#sub_des_select").select2(

				{

					placeholder: "Select Sub Design",

					allowClear: true

				});

			break;

		case 'purchase':

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#rpt_from_date').html(from_date);

			$('#rpt_to_date').html(to_date);

			$('#rpt_date_picker').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(0, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#rpt_date_picker').html(start.format('D/M/YYYY') + ' - ' + end.format('D/M/YYYY'));

					$('#rpt_from_date').text(start.format('DD-MM-YYYY'));

					$('#rpt_to_date').text(end.format('DD-MM-YYYY'));

				}

			);

			get_ActiveMetals();

			get_category();

			get_ActiveProduct();

			get_ActiveKarigars();

			get_po_bills_details();

			$("#des_select").select2(

				{

					placeholder: "Select Design",

					allowClear: true

				});

			$("#sub_des_select").select2(

				{

					placeholder: "Select Sub Design",

					allowClear: true

				});

			break;

		case 'grnbills':

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#rpt_from_date').html(from_date);

			$('#rpt_to_date').html(to_date);

			$('#rpt_date_picker').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(0, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#rpt_date_picker').html(start.format('D/M/YYYY') + ' - ' + end.format('D/M/YYYY'));

					$('#rpt_from_date').text(start.format('DD-MM-YYYY'));

					$('#rpt_to_date').text(end.format('DD-MM-YYYY'));

				}

			);

			get_charges();

			get_category();

			get_ActiveKarigars();

			get_grn_bills_details();

			break;

		// case 'purchase_return':

		// 	var date = new Date();

		// 	var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

		// 	var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

		// 	var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

		// 	$('#rpt_from_date').html(from_date);

		// 	$('#rpt_to_date').html(to_date);

		// 	$('#rpt_date_picker').daterangepicker(

		// 		{

		// 			ranges: {

		// 				'Today': [moment(), moment()],

		// 				'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

		// 				'Last 7 Days': [moment().subtract(6, 'days'), moment()],

		// 				'Last 30 Days': [moment().subtract(29, 'days'), moment()],

		// 				'This Month': [moment().startOf('month'), moment().endOf('month')],

		// 				'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

		// 			},

		// 			startDate: moment().subtract(0, 'days'),

		// 			endDate: moment()

		// 		},

		// 		function (start, end) {

		// 			$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

		// 			$('#rpt_date_picker').html(start.format('D/M/YYYY') + ' - ' + end.format('D/M/YYYY'));

		// 			$('#rpt_from_date').text(start.format('DD-MM-YYYY'));

		// 			$('#rpt_to_date').text(end.format('DD-MM-YYYY'));

		// 		}

		// 	);

		// 	get_ActiveMetals();

		// 	get_charges();

		// 	get_category();

		// 	get_ActiveKarigars();

		// 	get_purchase_return_details();

		// 	break;

		case 'purchase_return':

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#rpt_from_date').html(from_date);

			$('#rpt_to_date').html(to_date);

			$('#rpt_date_picker').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(0, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#rpt_date_picker').html(start.format('D/M/YYYY') + ' - ' + end.format('D/M/YYYY'));

					$('#rpt_from_date').text(start.format('DD-MM-YYYY'));

					$('#rpt_to_date').text(end.format('DD-MM-YYYY'));

				}

			);

			get_ActiveMetals();

			get_category();

			get_ActiveProduct();

			get_ActiveKarigars();

			get_purchase_return_details();

			$("#des_select").select2(

				{

					placeholder: "Select Design",

					allowClear: true

				});

			$("#sub_des_select").select2(

				{

					placeholder: "Select Sub Design",

					allowClear: true

				});

			break;

		case 'retagging_report':

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#rpt_from_date').html(from_date);

			$('#rpt_to_date').html(to_date);

			$('#rpt_date_picker').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(0, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#rpt_date_picker').html(start.format('D/M/YYYY') + ' - ' + end.format('D/M/YYYY'));

					$('#rpt_from_date').text(start.format('DD-MM-YYYY'));

					$('#rpt_to_date').text(end.format('DD-MM-YYYY'));

				}

			);

			get_ActiveMetals();

			get_category();

			get_ActiveProduct();

			get_ActiveKarigars();

			// get_purchase_return_details();

			$("#des_select").select2(

				{

					placeholder: "Select Design",

					allowClear: true

				});

			$("#sub_des_select").select2(

				{

					placeholder: "Select Sub Design",

					allowClear: true

				});

			break;

		case 'popayments':

			get_ActiveKarigars();

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#rpt_payments1').html(from_date);

			$('#rpt_payments2').html(to_date);

			$('#rpt_payment_date').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(0, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#rpt_payments1').text(start.format('YYYY-MM-DD'));

					$('#rpt_payments2').text(end.format('YYYY-MM-DD'));

				}

			);

			break;

		case 'qcstatus':

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#rpt_from_date').html(from_date);

			$('#rpt_to_date').html(to_date);

			$('#rpt_date_picker').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(0, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#rpt_date_picker').html(start.format('D/M/YYYY') + ' - ' + end.format('D/M/YYYY'));

					$('#rpt_from_date').text(start.format('DD-MM-YYYY'));

					$('#rpt_to_date').text(end.format('DD-MM-YYYY'));

				}

			);

			get_po_ref_nos();

			get_qc_issue_details();

			break;

		case 'pohmstatus':

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#rpt_from_date').html(from_date);

			$('#rpt_to_date').html(to_date);

			$('#rpt_date_picker').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(0, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#rpt_date_picker').html(start.format('D/M/YYYY') + ' - ' + end.format('D/M/YYYY'));

					$('#rpt_from_date').text(start.format('DD-MM-YYYY'));

					$('#rpt_to_date').text(end.format('DD-MM-YYYY'));

				}

			);

			get_hm_issue_details();

			$("#karigar").select2({

				placeholder: "Select Supplier / Karigar",

				allowClear: true

			});

			get_ActiveKarigars();

			break;

		case 'approvaltag_items_designwise':

			get_Activedesign('');

			get_ActiveProduct();

			$("#select_size").select2({

				placeholder: "Select Size",

				allowClear: true

			});

			break;

		case 'customer_ledger_statement':

			get_CustomerLedger();

			break;

		case 'supplierledger':

			get_ActiveKarigars();

			break;

		case 'smithtransaction':

			get_ActiveMetals();

			get_ActiveKarigars();

			break;

		case 'suppliertransaction':

			get_ActiveMetals();

			get_ActiveKarigars();

			break;

		case 'supplier_approval_transaction':

			get_ActiveMetals();

			get_ActiveKarigars();

			break;

		case 'smithalltransactions':

			get_ActiveKarigars();

			get_SmithAllTransactions();

			break;

		case 'lottagvault':

			get_ActiveKarigars();

			get_ActiveMetals();

			get_category();

			get_LotVsTaggedTransactions();

			break;

		case 'old_sale_report':

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#old_tag_report_date1').html(from_date);

			$('#old_tag_report_date2').html(to_date);

			get_old_sale_report_report();

			$('#old_tag_report_date').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(1, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#old_tag_report_date1').text(start.format('DD-MM-YYYY'));

					$('#old_tag_report_date2').text(end.format('DD-MM-YYYY'));

				}

			);

			break;

		case 'metal_stock_details':

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#rpt_payments1').html(from_date);

			$('#rpt_payments2').html(to_date);

			$('#rpt_payment_date').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(0, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					set_cashabstract_table();

					$('#rpt_payments1').text(start.format('YYYY-MM-DD'));

					$('#rpt_payments2').text(end.format('YYYY-MM-DD'));

				}

			);

			//get_metal_stock_details();

			break;

		case 'advance_total_details':

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#rpt_from_date').html(from_date);

			$('#rpt_to_date').html(to_date);

			$('#rpt_date_picker').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(0, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#rpt_date_picker').html(start.format('D/M/YYYY') + ' - ' + end.format('D/M/YYYY'));

					$('#rpt_from_date').text(start.format('DD-MM-YYYY'));

					$('#rpt_to_date').text(end.format('DD-MM-YYYY'));

				}

			);

			get_advance_details();

			break;

		case 'dashboard_branchtransfer':

			set_dashboard_btlist();

			break;

		case 'acc_stock_details':

			set_acc_stock_details();

			break;

		case 'tag_stone':

			get_ActiveMetals();

			get_Tagcategory();

			get_Activedesign('');

			get_ActiveProduct();

			$("#select_size").select2({

				placeholder: "Select Size",

				allowClear: true

			});

			$('#metal').on('change', function (e) {

				if (this.value != '' && ctrl_page[1] == 'tag_stone') {

					get_Tagcategory();

				}

			});

			break;

		case 'retag_report':

			get_ActiveKarigars();

			get_ActiveMetals();

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#rpt_payments1').html(from_date);

			$('#rpt_payments2').html(to_date);

			$('#rpt_payment_date').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(0, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#rpt_payments1').text(start.format('YYYY-MM-DD'));

					$('#rpt_payments2').text(end.format('YYYY-MM-DD'));

				}

			);

			$('#retag_report_type').select2({

				placeholder: "Select Report Type",

				allowClear: true

			});

			$('#metal').select2({

				placeholder: "Select Metal",

				allowClear: true

			});

			break;

		case 'purchase_itemwise':

			get_ActiveProduct();

			get_Activedesign('');

			$('#des_select').on('change', function () {

				if (this.value != '') {

					if (ctrl_page[1] == 'purchase_itemwise') {

						get_ActiveSubDesign();

					}

				}

			});

			$("#sub_des_select").select2(

				{

					placeholder: "Select Sub Design",

					allowClear: true

				});

			get_ActiveKarigars();

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#rpt_payments1').html(from_date);

			$('#rpt_payments2').html(to_date);

			$('#rpt_payment_date').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(0, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#rpt_payments1').text(start.format('YYYY-MM-DD'));

					$('#rpt_payments2').text(end.format('YYYY-MM-DD'));

				}

			);

			get_purchase_itemwise();

			break;

		case 'sales_import':

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#rpt_payments1').html(from_date);

			$('#rpt_payments2').html(to_date);

			$('#rpt_payment_date').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(0, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#rpt_payments1').text(start.format('YYYY-MM-DD'));

					$('#rpt_payments2').text(end.format('YYYY-MM-DD'));

				}

			);

			get_sales_import();

			break;

		case 'purchase_import':

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#rpt_payments1').html(from_date);

			$('#rpt_payments2').html(to_date);

			$('#rpt_payment_date').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(0, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#rpt_payments1').text(start.format('YYYY-MM-DD'));

					$('#rpt_payments2').text(end.format('YYYY-MM-DD'));

				}

			);

			get_purchase_import();

			break;

		case 'payment_mode_import':

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#rpt_payments1').html(from_date);

			$('#rpt_payments2').html(to_date);

			$('#rpt_payment_date').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(0, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#rpt_payments1').text(start.format('YYYY-MM-DD'));

					$('#rpt_payments2').text(end.format('YYYY-MM-DD'));

				}

			);

			get_payment_mode_import();

			break;

		case 'stock_rotation':

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#rpt_payments1').html(from_date);

			$('#rpt_payments2').html(to_date);

			$('#rpt_payment_date').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(0, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#rpt_payments1').text(start.format('YYYY-MM-DD'));

					$('#rpt_payments2').text(end.format('YYYY-MM-DD'));

				}

			);

			get_ActiveProduct();

			get_stock_rotation_list();

			break;

		//ACCOUNTS REPORTS

		case 'categorywise_bt_report':

			get_category();

			get_oldmetalcategory();

			$('#branch_select').select2({

				placeholder: "To Centre",

				allowClear: true

			});

			$('#branch_select_to').select2({

				placeholder: "Cost Centre",

				allowClear: true

			});

			break;

		case 'categorywise_stock_report':

			get_category();

			get_oldmetalcategory();

			$('#branch_select').select2({

				placeholder: "Select Branch",

				allowClear: true

			});

			break;

		case 'bookstocks':

			get_category();

			get_oldmetalcategory();

			$('#branch_select').select2({

				placeholder: "Select Branch",

				allowClear: true

			});

			get_categorybookstock_report();

			break;

		case 'gst_abstract':

			get_category();

			get_ActiveMetals();

			$('#report_type').select2();

			$('#gst_filter').select2();

			$('#report_type').select2({

				placeholder: "Select Report Type",

				allowClear: true

			});

			$('#gst_filter').select2({

				placeholder: "Select GST Type",

				allowClear: true

			});

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#rpt_from_date').html(from_date);

			$('#rpt_to_date').html(to_date);

			$('#rpt_date_picker').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(0, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#rpt_date_picker').html(start.format('D/M/YYYY') + ' - ' + end.format('D/M/YYYY'));

					$('#rpt_from_date').text(start.format('DD-MM-YYYY'));

					$('#rpt_to_date').text(end.format('DD-MM-YYYY'));

				}

			);

			break;

		case 'gst_abstract_with_return':

			$('#report_type').select2();

			$('#gst_filter').select2();

			$('#report_type').select2({

				placeholder: "Select Report Type",

				allowClear: true

			});

			$('#gst_filter').select2({

				placeholder: "Select GST Type",

				allowClear: true

			});

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#rpt_from_date').html(from_date);

			$('#rpt_to_date').html(to_date);

			$('#rpt_date_picker').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(0, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#rpt_date_picker').html(start.format('D/M/YYYY') + ' - ' + end.format('D/M/YYYY'));

					$('#rpt_from_date').text(start.format('DD-MM-YYYY'));

					$('#rpt_to_date').text(end.format('DD-MM-YYYY'));

				}

			);

			get_ActiveMetals();

			get_TaxGroupFromBilling();

			get_category();

			get_hsncode();

			break;

		case 'sales_return_abstract':

			get_category();

			get_ActiveMetals();

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#rpt_from_date').html(from_date);

			$('#rpt_to_date').html(to_date);

			sales_return_details();

			$('#rpt_date_picker').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(0, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#rpt_date_picker').html(start.format('D/M/YYYY') + ' - ' + end.format('D/M/YYYY'));

					$('#rpt_from_date').text(start.format('DD-MM-YYYY'));

					$('#rpt_to_date').text(end.format('DD-MM-YYYY'));

				}

			);

			break;

		case 'card_collection_report':

			getDeviceNames();

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#rpt_payments1').html(from_date);

			$('#rpt_payments2').html(to_date);

			get_card_collection_report();

			$('#rpt_payment_date').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(29, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#rpt_payment_date').html(start.format('D/M/YYYY') + ' - ' + end.format('D/M/YYYY'));

					$('#rpt_payments1').text(start.format('DD-MM-YYYY'));

					$('#rpt_payments2').text(end.format('DD-MM-YYYY'));

				}

			);

			break;

		case 'cheque_collection_report':

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#rpt_payments1').html(from_date);

			$('#rpt_payments2').html(to_date);

			get_cheque_collection_report();

			$('#rpt_payment_date').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(29, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#rpt_payment_date').html(start.format('D/M/YYYY') + ' - ' + end.format('D/M/YYYY'));

					$('#rpt_payments1').text(start.format('DD-MM-YYYY'));

					$('#rpt_payments2').text(end.format('DD-MM-YYYY'));

				}

			);

			break;

		case 'netbanking_collection_report':

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 6, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#nb_coll_rpt1').html(from_date);

			$('#nb_coll_rpt2').html(to_date);

			get_ActiveDevicename();

			get_ActiveBankname();

			get_netbanking_collection_report();

			$('#nb_coll_rpt').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(6, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#nb_coll_rpt').html(start.format('D/M/YYYY') + ' - ' + end.format('D/M/YYYY'));

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#nb_coll_rpt1').text(start.format('DD-MM-YYYY'));

					$('#nb_coll_rpt2').text(end.format('DD-MM-YYYY'));

				}

			);

			break;

		case 'advance_receipt_report':

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 7, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#advance_list_report_date1').html(from_date);

			$('#advance_list_report_date2').html(to_date);

			set_advance_receipt_table();

			$('#advance_list_report_date').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(0, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#advance_list_report_date').html(start.format('D/M/YYYY') + ' - ' + end.format('D/M/YYYY'));

					$('#advance_list_report_date1').text(start.format('YYYY-MM-DD'));

					$('#advance_list_report_date2').text(end.format('YYYY-MM-DD'));

				}

			);

			//get_metal_stock_details();

			break;

		case 'gstr1_sales':

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#rpt_payments1').html(from_date);

			$('#rpt_payments2').html(to_date);

			$('#rpt_payment_date').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(0, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#rpt_payments1').text(start.format('YYYY-MM-DD'));

					$('#rpt_payments2').text(end.format('YYYY-MM-DD'));

				}

			);

			break;

		case 'gstr2_purchase':

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#rpt_payments1').html(from_date);

			$('#rpt_payments2').html(to_date);

			$('#rpt_payment_date').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(0, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#rpt_payments1').text(start.format('YYYY-MM-DD'));

					$('#rpt_payments2').text(end.format('YYYY-MM-DD'));

				}

			);

			get_ActiveMetals();

			break;

		case 'get_stock_detail_list':

			get_stock_detail_list();

			break;

		case 'categorywise_day_transaction':

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#rpt_payments1').html(from_date);

			$('#rpt_payments2').html(to_date);

			$('#rpt_payment_date').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(0, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#rpt_payments1').text(start.format('YYYY-MM-DD'));

					$('#rpt_payments2').text(end.format('YYYY-MM-DD'));

				}

			);

			get_ActiveMetals();

			get_category();

			get_old_metal_type();

			//get_old_metal_cat();

			break;

		case 'daytransactions':

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#rpt_from_date').html(from_date);

			$('#rpt_to_date').html(to_date);

			$('#rpt_date_picker').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(0, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#rpt_date_picker').html(start.format('D/M/YYYY') + ' - ' + end.format('D/M/YYYY'));

					$('#rpt_from_date').text(start.format('DD-MM-YYYY'));

					$('#rpt_to_date').text(end.format('DD-MM-YYYY'));

				}

			);

			break;

		//ACCOUNTS REPORTS

		case 'item_sales_detail':

			get_ActiveSections();

			get_ActiveProduct();

			get_ActiveMetals();

			get_category();

			break;

		case 'pay_device':

			set_devicepayBills();

			get_ActiveDevicename();

			break;

		case 'weight_range_sales':

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#rpt_payments1').html(from_date);

			$('#rpt_payments2').html(to_date);

			$('#rpt_payment_date').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(0, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#rpt_payments1').text(start.format('YYYY-MM-DD'));

					$('#rpt_payments2').text(end.format('YYYY-MM-DD'));

				}

			);

			get_ActiveProduct();

			get_ActiveKarigars();

			//get_weight_range_wise_sales_list();

			$("#sub_des_select").select2({

				placeholder: "Select Sub Design",

				allowClear: true

			});

			$("#wt_select").select2({

				placeholder: "Select Weight Range",

				allowClear: true

			});

			$("#des_select").select2({

				placeholder: "Select Design",

				allowClear: true

			});

			$('#des_select').on('change', function () {

				if (this.value != '') {

					if (ctrl_page[1] == 'stock_rotation_sales') {

						get_ActiveSubDesign();

					}

				}

			});

			break;

		case 'staff_incentive_report':

			if (ctrl_page[2] == 'list') {

				var date = new Date();

				var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

				var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

				var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

				$('#rpt_payments1').html(from_date);

				$('#rpt_payments2').html(to_date);

				$('#rpt_payment_date').daterangepicker(

					{

						ranges: {

							'Today': [moment(), moment()],

							'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

							'Last 7 Days': [moment().subtract(6, 'days'), moment()],

							'Last 30 Days': [moment().subtract(29, 'days'), moment()],

							'This Month': [moment().startOf('month'), moment().endOf('month')],

							'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

						},

						startDate: moment().subtract(0, 'days'),

						endDate: moment()

					},

					function (start, end) {

						$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

						$('#rpt_payments1').text(start.format('YYYY-MM-DD'));

						$('#rpt_payments2').text(end.format('YYYY-MM-DD'));

					}

				);

				get_staff_incentive_report();

			} if (ctrl_page[2] == 'detailed') {

				get_staff_incentive_detailed_report();

			}

			break;

		case 'karigar_metal_issue':

			get_ActiveKarigars();

			get_ActiveMetals();

			get_category();

			get_ActiveProduct();

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#rpt_from_date').html(from_date);

			$('#rpt_to_date').html(to_date);

			$('#rpt_date_picker').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(0, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#rpt_date_picker').html(start.format('D/M/YYYY') + ' - ' + end.format('D/M/YYYY'));

					$('#rpt_from_date').text(start.format('DD-MM-YYYY'));

					$('#rpt_to_date').text(end.format('DD-MM-YYYY'));

				}

			);

			get_karigar_metal_issue_itemwise();

			break;

		case 'customer_detail':

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#rpt_cus1').html(from_date);

			$('#rpt_cus2').html(to_date);

			$('#rpt_customer').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(0, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#rpt_cus1').text(start.format('YYYY-MM-DD'));

					$('#rpt_cus2').text(end.format('YYYY-MM-DD'));

				}

			);

			$('#vip_fil').select2({

				placeholder: "ALL",

				allowClear: true

			});

			break;

		case 'deposit_report':

			$('#dep_date').datepicker({

				format: 'dd-mm-yyyy'

			});

			getDepositBranch();

			break;

		case 'rate_fixed':

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#rpt_from_date').html(from_date);

			$('#rpt_to_date').html(to_date);

			$('#rpt_date_picker').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(0, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#rpt_date_picker').html(start.format('D/M/YYYY') + ' - ' + end.format('D/M/YYYY'));

					$('#rpt_from_date').text(start.format('DD-MM-YYYY'));

					$('#rpt_to_date').text(end.format('DD-MM-YYYY'));

				}

			);

			get_rate_fixed_details();

			get_ActiveKarigars();

			get_ActiveMetals();

			break;

		case 'unfixing_report':

			get_ActiveKarigars();

			get_category();

			get_unfixing_details();

			get_ActiveMetals();

			break;

		case 'supplier_contract_wise':

			get_ActiveKarigars();

			break;

		case 'weight_rage_report':

			get_category();

			get_ActiveProduct();

			weight_rage_report();

			$("#sub_des_select").select2(

				{

					placeholder: "Select Sub Design",

					allowClear: true

				});

			$("#des_select").select2(

				{

					placeholder: "Select Design",

					allowClear: true

				});

			$("#prod_select").select2(

				{

					placeholder: "Select Product",

					allowClear: true

				});

			break;

		case 'dashboard_contractprice':

			set_dashboard_contractprice();

			break;

		case 'employee_wise_tag':

			getTaggedLot();

			set_employee_wise_sales_tag();

			get_ActiveProduct();

			$("#sub_des_select").select2(

				{

					placeholder: "Select sub Design",

					allowClear: true

				});

			$("#des_select").select2(

				{

					placeholder: "Select Design",

					allowClear: true

				});

			$("#employee_select").select2(

				{

					placeholder: "Select Employee",

					allowClear: true

				});

			var id_branch = ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val());

			get_employee(id_branch);

			$("#branch_select").on("change", function () {

				get_employee(id_branch);

			});

			break;

		case 'old_metal_pl_report':

			get_old_metal_type();

			break;

		case 'section_transfer':

			get_ActiveProduct();

			getActiveSections();

			break;

		case 'irn_report':

			get_irn_details();

			var date = new Date();

			var firstDay = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 0, 1);

			var from_date = (firstDay.getDate() + "-" + (firstDay.getMonth() + 1) + "-" + firstDay.getFullYear());

			var to_date = (date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear());

			$('#rpt_payments1').html(from_date);

			$('#rpt_payments2').html(to_date);

			$('#rpt_payment_date').daterangepicker(

				{

					ranges: {

						'Today': [moment(), moment()],

						'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],

						'Last 7 Days': [moment().subtract(6, 'days'), moment()],

						'Last 30 Days': [moment().subtract(29, 'days'), moment()],

						'This Month': [moment().startOf('month'), moment().endOf('month')],

						'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]

					},

					startDate: moment().subtract(0, 'days'),

					endDate: moment()

				},

				function (start, end) {

					$('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

					$('#rpt_payments1').text(start.format('YYYY-MM-DD'));

					$('#rpt_payments2').text(end.format('YYYY-MM-DD'));

				}

			);

			break;

		case 'stock_ratio_avail':

			get_ActiveProduct();

			get_Activedesign();

			$("#size").select2({

				placeholder: "Select size",

				allowClear: true

			});

			break;

		case 'inventory_turnover':

			get_ActiveMetals();

			get_category();

			get_ActiveProduct();

			get_Activedesign();

			get_ActiveSubDesign();

			get_ActiveSections();

			get_ActiveKarigars();

			$('#sub_des_select').select2({

				placeholder: 'Select Sub Design',

				allowClear: true

			});

			$("#wt_select").select2({

				placeholder: "Select Weight Range",

				allowClear: true

			});

			$("#des_select").select2({

				placeholder: "Select Design",

				allowClear: true

			});

			$('#des_select').on('change', function () {

				get_ActiveSubDesign();

			});

			$("#branch_select").on("change", function () {

				get_ActiveSections();

			});

			$("#group_by").select2({

				placeholder: "Select Group By",

				allowClear: true

			});

			$('#group_by').select2("val", "");

			break;

	}

	$('#filter_metal').select2({

		placeholder: "Select type",

		allowClear: true

	});

	$("#karigar").select2({

		placeholder: "Select Supplier / Karigar",

		allowClear: true

	});

	$('#lot').select2({

		placeholder: "Select Lot ID",

		allowClear: true

	});

	jQuery("#category").on("change", function () {

		$("#product").val('');

		$("#design").val('');

	});

	$("#karigar").on("change", function () {

		/*if($("#karigar").val() != "" && $("#karigar").val() != 0 && ctrl_page[1] == 'supplierledger'){

			getSupplierLedger();

		}*/

		if ($("#karigar").val() != "" && ctrl_page[1] == 'supplierledger') {

			getSupplierLedger();

		}

		if ($("#karigar").val() != "" && ctrl_page[1] == 'smithtransaction') {

			get_SmithTransactions();

		}

		if ($("#karigar").val() != "" && ctrl_page[1] == 'smithalltransactions') {

			get_SmithAllTransactions();

		}

		if ($("#karigar").val() != "" && ctrl_page[1] == 'supplier_approval_transaction') {

			get_SupplierApprovalTransactions();

		}

		if ($("#karigar").val() != "" && ctrl_page[1] == 'suppliertransaction') {

			get_SupplierTransactions();

		}

		/*if ($("#karigar").val() != "" && ctrl_page[1] == 'lottagvault') {

			get_LotVsTaggedTransactions();

		}*/

	});

	$("input[name='ledger_type']:radio").change(function () {

		if ($("#karigar").val() != "" && ctrl_page[1] == 'supplierledger') {

			getSupplierLedger();

		}

	});

	$('#supplier_search').click(function (event) {

		getSupplierLedger();

	});

	jQuery("#product").on("input", function () {

		var prod = $("#product").val();

		$("#design").val('');

		if (prod.length >= 3) {

			getSearchProd(prod);

		}

	});

	jQuery("#design").on("input", function () {

		var des = $("#design").val();

		if (des.length >= 3) {

			getSearchDesign(des);

		}

	});

	$('#old_metal_search').click(function (event) {

		set_old_metal_table();

	});

	$('#soldNpend_search').click(function (event) {

		set_lotwise_table();

	});

	$('#partlySold_search').click(function (event) {

		set_partlysold_table();

	});

	$('#credit_issued_search').click(function (event) {

		set_credit_issued_table();

	});

	$('#credit_history_search').click(function (event) {

		set_credit_history_table();

	});

	$('#advance_search').click(function (event) {

		set_advance_history_table();

	});

	$('#chit_closing_search').click(function (event) {

		set_chit_closing_table();

	});

	$('#pay_search').click(function (event) {

		set_card_payment_table();

	});

	$('#copy_bill_search').click(function (event) {

		set_copy_bill_table();

	});

	$('#pan_bill_search').click(function (event) {

		set_pan_bill_table();

	});

	$('#stockAge_search').click(function (event) {

		set_stock_age_table();

	});

	$('#cancelled_bill_search').click(function (event) {

		set_cancelledBills();

	});

	$('#disc_bill_search').click(function (event) {

		set_discBills();

	});

	$('#gst_bill_search').click(function (event) {

		set_gstBills();

	});

	$('#reorder_items_search').click(function (event) {

		set_reorder_items();

	});

	$('#branchreorder_items_search').click(function (event) {

		set_branchreorder_items();

	});

	$('#tag_design_search').click(function (event) {

		set_tagged_items();

	});

	$('#tag_item_design_search').click(function (event) {

		set_tag_items();

	});

	$('#stock_search').click(function (event) {

		stock_report();

	});

	$('#stock_checking').click(function (event) {

		stock_checking();

	});

	$('#item_sale_search').click(function (event) {

		itemwise_sales();

	});

	$('#bill_wise_search').click(function (event) {

		get_bill_wise_trns_list();

	});

	$('#home_bill_search').click(function (event) {

		get_home_bill_sales();

	});

	$('#order_adv_search').click(function (event) {

		set_order_advance()

	});

	$('#ref_search').click(function (event) {

		set_estimation_referral()

	});

	$('#other_issue_search').click(function (event) {

		set_other_issue();

	});

	$('#gift_search').click(function (event) {

		set_gift_voucher_list();

	});

	$('#order_status_search').click(function (event) {

		set_order_status_report();

	});

	$('#sales_search').click(function (event) {

		set_monthly_sales();

	});

	$('#old_metal_analyse_search').click(function (event) {

		set_old_metal_analyse_table();

	});

	$('#tag_history_search').click(function (event) {

		set_tag_history();

	});

	$('#sales_analysis').click(function (event) {

		get_sales_analysis_report();

	});

	$("body").on("click", "#home_city", function () {

		$('.other_city').css('display', 'none');

		$('.home_city').css('display', 'block');

		get_sales_analysis_report();

	});

	$("body").on("click", "#other_city", function () {

		$('.home_city').css('display', 'none');

		$('.other_city').css('display', 'block');

		get_sales_analysis_other_city_report();

	});

	$('#unbilled_est_search').click(function (event) {

		set_unbilled_estimation();

	});

	$('#karigar_wise_sales').click(function (event) {

		get_karigar_wise_sales();

	});

	$('#sales_comparision_search').click(function (event) {

		get_sales_comparision();

	});

	$('#old_tag_report_search').on('click', function () {

		get_old_sale_report_report();

	});

	$('#tag_scanned_search').click(function (event) {

		getScanned_details();

	});

	$('#credit_pending_search').click(function (event) {

		set_credit_pending_list();

	});

	$('#scanned_details_report').click(function (event) {

		if ($('#report_type').val() == 1) {

			get_scanned_details_report();

		}

		else if ($('#report_type').val() == 2) {

			if ($('#prod_filter').val() == null || $('#prod_filter').val() == '') {

				$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + 'Please Select Product' });

			}

			else {

				get_scanned_details_report();

			}

		}

	});

	$('#sales_stock_Search').click(function (event) {

		set_stock_and_sales_list();

	});

	$('#monthly_sales_comparision_search').click(function (event) {

		monthly_slaes_comparision();

	});

	$('#customer_search').click(function (event) {

		get_telecalling_report();

	});

	$('#incentive_search').on('click', function () {

		set_incentive_report();

	});

	$('#metal_stock_search').click(function (event) {

		if ($('#report_type').val() == 1 || $('#report_type').val() == 2 || $('#report_type').val() == 5) {

			get_metal_stock_details();

		} else {

			get_old_metal_stock_details();

		}

	});

	$('#po_bills_search').click(function (event) {

		get_po_bills_details();

	});

	$('#grn_bills_search').click(function (event) {

		get_grn_bills_details();

	});

	$('#po_payment_search').click(function (event) {

		if ($('#karigar').val() != "") {

			get_po_payment_details();

		}

	});

	$('#po_qcbills_search').click(function (event) {

		get_qc_issue_details();

	});

	$('#po_bills_hmsearch').click(function (event) {

		get_hm_issue_details();

	});

	$('#tag_wise_profit_search').click(function (event) {

		get_tag_wise_profit_list();

	});

	$('#approvaltag_design_search').click(function (event) {

		set_approval_tagged_items();

	});

	$('#metal_available_stock_search').click(function (event) {

		get_metal_available_stock_details();

	});

	$('#retagging_items_search').click(function (event) {

		get_retagging_list();

	});

	$('#disc_rep_type').select2();

	$('#cash_abstract_print').click(function (event) {

		var dt_range = ($("#dt_range").val()).split('-');

		var from_date = date_format(dt_range[0].trim());

		var to_date = date_format(dt_range[1].trim());

		var id_branch = $("#branch_select").val();

		window.open(base_url + 'index.php/admin_ret_reports/generate_cash_abstract/' + id_branch + '/' + from_date + '/' + to_date);

	});

	$('#export_csv').click(function (event) {

		var dt_range = ($("#dt_range").val()).split('-');

		var from_date = date_format(dt_range[0].trim());

		var to_date = date_format(dt_range[1].trim());

		var id_branch = $("#branch_select").val();

		window.location.href = base_url + 'index.php/admin_ret_reports/export_csv/' + id_branch + '/' + from_date + '/' + to_date;

	});

	$('#cash_abstract_search').click(function (event) {

		set_cashabstract_table();

	});

	$('#bt_report_search').click(function (event) {

		// set_packaging_table();

		set_btreport_table();

	});

	$('#advance_total_search').on('click', function () {

		get_advance_details();

	});

	$('#stockAge_dynamic_search').click(function (event) {

		set_stock_age_dynamic_report();

	});

	$('#dash_order_status_search').on('click', function () {

		set_dashboard_ordermangement();

	});

	$('#irn_details_search').on('click', function () {

		get_irn_details();

	});

	$('.range_inputs .applyBtn').click(function (event) {

		if (ctrl_page[1] == 'supplierledger') {

			getSupplierLedger();

		} else if (ctrl_page[1] == 'smithtransaction') {

			get_SmithTransactions();

		} else if (ctrl_page[1] == 'smithalltransactions') {

			get_SmithAllTransactions();

		}

	});

});

function getDisplayDateTime() {

	var today = new Date();

	var dispdate = today.getDate() + '-' + (today.getMonth() + 1) + '-' + today.getFullYear();

	var disptime = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();

	return dispdate + " " + disptime;

}

function report_print(branch_name, report_name, from_date, to_date, optional) {

	if (branch_name == '') {

		branch_name = "ALL"

	}

	var data = "<span>" + report_name + " - " + branch_name + "</span></br>"

		+ "<span>" + (optional != '' ? optional : '') + "</span>"

		+ (from_date != '' && to_date != '' ? "<span>FROM&nbsp;:&nbsp;" + from_date + " &nbsp;&nbsp;TO&nbsp;&nbsp; " + to_date + "</span></br> " : '')

		+ $('.hidden-xs').html() + " &nbsp; - &nbsp;" + "</span>" + "<span style='font-size:11pt;'>" + getDisplayDateTime() + "</span></br>";

	return data;

}

function date_format(dt_range) {

	var date = dt_range.split('/');

	return date[2] + '-' + date[1] + '-' + date[0];

}

function formatMoney(number) {

	return number.toLocaleString('en-IN', { style: 'currency', currency: 'USD' });

}

function set_stock_age_table(branch = "") {

	$("div.overlay").css("display", "block");

	var id_branch = ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val());

	var age_type = $("#age_type").val();

	var age_type_name = $("#age_type option:selected").text();

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "Stock Age Analysis - Based on " + age_type_name;

	var company_name = $('#company_name').val();

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

	+ "<span>" + report_name + " - " + branch_name + "</span></br>"

	+ 'Taken By - ' + $('.hidden-xs').html() + " &nbsp; - &nbsp;" + "</span>" + "<span style='font-size:11pt;'>Taken On - " + getDisplayDateTime() + "</span></br>"

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/stock_age/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'id_branch': id_branch, 'id_product': $("#prod_select").val(), 'id_metal': $("#metal").val(), 'id_ret_category': $("#category").val(), 'age_type': age_type}),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.list;

			$('#total_count').text(list.length);

			var oTable = $('#stock_age_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#stock_age_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"bSort": true,

					"dom": 'lBfrtip',

					"order": [[0, "asc"]],

					"columnDefs": [

						{

							targets: [0,1],

							className: 'dt-body-left'

						},

						{

							targets: [2,3,4,5,6],

							className: 'dt-body-right'

						},

						{ width: '5%', targets: 0 },

						{ width: '20%', targets: 1 },

						{ width: '15%', targets: 2 },

						{ width: '15%', targets: 3 },

						{ width: '15%', targets: 4 },

						{ width: '15%', targets: 5 },

						{ width: '15%', targets: 6 }

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: "",

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: "",

							messageTop: company_name + ' - ' + branch_name + ' - ' + report_name + ' - Taken By - '  + $('.hidden-xs').html() + ' - Taken On - ' + getDisplayDateTime(),

						}

					],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "pro_id" },

						{ "mDataProp": "product_name" },

						{

							"mDataProp": function (row, type, val, meta) {

								var url = base_url + 'index.php/admin_ret_reports/stock_age/tag_list/0/120/' + row.pro_id + '/' + id_branch + '/' + age_type;

								return '<a href=' + url + ' target="_blank">' + row.below_120_days + '</a>';

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var url = base_url + 'index.php/admin_ret_reports/stock_age/tag_list/120/180/' + row.pro_id + '/' + id_branch + '/' + age_type;

								return '<a href=' + url + ' target="_blank">' + row.above_120_days + '</a>';

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var url = base_url + 'index.php/admin_ret_reports/stock_age/tag_list/180/240/' + row.pro_id + '/' + id_branch + '/' + age_type;

								return '<a href=' + url + ' target="_blank">' + row.above_180_days + '</a>';

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var url = base_url + 'index.php/admin_ret_reports/stock_age/tag_list/240/360/' + row.pro_id + '/' + id_branch + '/' + age_type;

								return '<a href=' + url + ' target="_blank">' + row.above_240_days + '</a>';

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var url = base_url + 'index.php/admin_ret_reports/stock_age/tag_list/360/' + '' + '/' + row.pro_id + '/' + id_branch + '/' + age_type;

								return '<a href=' + url + ' target="_blank">' + row.above_360_days + '</a>';

							}

						},

					],

				});

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function get_stock_age_tag_list() {

	$("div.overlay").css("display", "block");

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var company_name = $('#company_name').val();

	var age_type = ctrl_page[7];

	var stock_age_report_type = (age_type == 1 ? 'Tag Date' : 'Received Date');

	var report_name = "Stock Age Analysis - Based on " + stock_age_report_type;

	var from_days = ctrl_page[3];

	var to_days = ctrl_page[4];

	var age_count = (from_days != 0 && to_days != '' ? "<span>AGE&nbsp;:&nbsp;" + from_days + " &nbsp;TO&nbsp; " + to_days + " days</span></br> " : (from_days == 0 ? "<span>AGE&nbsp;:&nbsp; Below "+to_days+" days</span></br>":"<span>AGE&nbsp;:&nbsp; Above "+from_days+" days</span></br>"))

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+"<span>" + report_name + " - " + branch_name + "</span></br>" + age_count 

		+ ' Taken By - '+ $('.hidden-xs').html() + " &nbsp; - &nbsp;"+ 'Taken ON - ' + "</span>" + "<span style='font-size:11pt;'>" + getDisplayDateTime() + "</span></br>";

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/stock_age/tagging?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'from_days': ctrl_page[3], 'to_days': ctrl_page[4], 'id_product': ctrl_page[5], 'id_branch': ctrl_page[6], 'age_type': ctrl_page[7] }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data;

			var oTable = $('#stock_age_tag').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#stock_age_tag').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"order": [[0, "asc"]],

					"lengthMenu": [[-1, 25, 50, 100, 250], ["All", 25, 50, 100, 250]],

					"columnDefs": [

						{

							targets: [0,1,2,3,4,5,6,7,8,9],

							className: 'dt-body-left'

						},

						{

							targets: [10,11,12,13,14],

							className: 'dt-body-right'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: "",

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: "",

							messageTop: company_name + ' - ' + branch_name + ' - ' + report_name   + (from_days != 0 && to_days != '' ? " - AGE: " + from_days + " TO " + to_days + " days " : (from_days == 0 ? " - AGE: Below "+to_days+" days ":" - AGE: Above "+from_days+" days ")) 

							+ ' - Taken By - ' + $('.hidden-xs').html() + ' - Taken On - ' + getDisplayDateTime(),

						}

					],

					"aaData": list,

					"aoColumns": [

						{

							"mDataProp": function (row, type, val, meta) {

								return '<input type="checkbox" class="tag_id" name="tag_id[]" value="' + row.tag_id + '"/>' + row.tag_id;

							}

						},

						{ "mDataProp": "tag_code" },

						{ "mDataProp": "old_tag_id" },

						{ "mDataProp": "tag_datetime" },

						{ "mDataProp": "old_tag_date" },

						{ "mDataProp": "actual_age" },

						{ "mDataProp": "received_date" },

						{ "mDataProp": "current_age" },

						{ "mDataProp": "product_name" },

						{ "mDataProp": "karigar_name" },

						{ "mDataProp": "tag_lot_id" },

						{ "mDataProp": "tot_pcs" },

						{ "mDataProp": "total_wt" },

						{ "mDataProp": "retail_max_wastage_percent" },

						{ "mDataProp": "tag_mc_value" },

						{

							"mDataProp": function (row, type, val, meta) {

								if (row.tag_mark == 1) {

									return '<span class="badge bg-green">' + row.tag_status + (row.is_green_tag_printed == 1 ? ' - <i class="fa fa-print" aria-hidden="true"></i>' : '') + '</span>';

								} else {

									return '-' + (row.is_green_tag_printed == 1 ? '<i class="fa fa-print" aria-hidden="true"></i>' : '');

								}

							}

						},

					],

					"footerCallback": function (row, data, start, end, display) {

						if (data.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								pieces = api

									.column(11)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(11).footer()).html(parseFloat(pieces));



								gross_wgt = api

									.column(12)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(12).footer()).html(parseFloat(gross_wgt).toFixed(3));

							}

						} else {

							var api = this.api(), data;

							$(api.column(11).footer()).html('');

						}

					}

				});

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

$("input[name='upd_status_btn']:radio").change(function () {

	if ($("input[name='tag_id[]']:checked").val()) {

		$('#set_green_tag').prop('disabled', true);

		var selected = [];

		var approve = false;

		$("#stock_age_tag tbody tr").each(function (index, value) {

			if ($(value).find("input[name='tag_id[]']:checked").is(":checked")) {

				transData = {

					'tag_id': $(value).find(".tag_id").val(),

					"req_status": $("input[name='upd_status_btn']:checked").val(),

				}

				selected.push(transData);

			}

		})

		req_data = selected;

		update_green_tag(req_data);

	} else {

		$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + 'Please Select Any One Tag..' });

	}

});

function update_green_tag(data = "") {

	my_Date = new Date();

	$("div.overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/update_green_tag?nocache=" + my_Date.getUTCSeconds() + '' + my_Date.getUTCMinutes() + '' + my_Date.getUTCHours(),

		data: { 'req_data': data },

		type: "POST",

		async: false,

		success: function (data) {

			$('#set_green_tag').prop('disabled', false);

			location.reload(false);

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			console.log(error);

			$("div.overlay").css("display", "none");

		}

	});

}

$("#tag_print").on('click', function () {

	if ($("input[name='tag_id[]']:checked").val()) {

		var selected = [];

		var tag_id = '';

		$("#stock_age_tag tbody tr").each(function (index, value) {

			if ($(value).find("input[name='tag_id[]']:checked").is(":checked")) {

				tag_id += $(value).find(".tag_id").val() + ',';

				transData = {

					'tag_id': $(value).find(".tag_id").val(),

				}

			}

		});

		req_data = tag_id;

		tagging_print(req_data);

	}

	else {

		$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + 'Please Select Any One Tag..' });

	}

});

function tagging_print(req_data) {

	//var tag = JSON.stringify(req_data);

	window.open(base_url + 'index.php/admin_ret_tagging/tagging/generate_barcode?tag=' + req_data, '_blank');

	window.location.reload();

}

function get_ActiveKarigars(kar_type = '') {

	$.ajax({

		type: 'GET',

		url: base_url + 'index.php/admin_ret_catalog/karigar/active_list/' + kar_type,

		dataType: 'json',

		success: function (data) {

			var id = $("#karigar").val();

			$("#karigar").append(

				$("<option></option>")

					.attr("value", 0)

					.text('All')

			);

			$.each(data, function (key, item) {

				$('#karigar').append(

					$("<option></option>")

						.attr("value", item.id_karigar)

						.text(item.karigar + ' - ' + item.code)

				);

			});

			$("#karigar").select2(

				{

					placeholder: "Select Karigar",

					allowClear: true

				});

			$('#karigar').select2("val", "");

		}

	});

}

$("#metal").on('change', function () {

	if (this.value != '' && (ctrl_page[1] != 'lottagvault')) {

		get_category();

	}

});

function get_ActiveMetals() {

	$("#metal option").remove();

	$.ajax({

		type: 'GET',

		url: base_url + 'index.php/admin_ret_catalog/ret_product/active_metal',

		dataType: 'json',

		success: function (data) {

			var id = $("#metal").val();

			$("#metal").append(

				$("<option></option>")

					.attr("value", 0)

					.text('All')

			);

			$.each(data, function (key, item) {

				$('#metal').append(

					$("<option></option>")

						.attr("value", item.id_metal)

						.text(item.metal)

				);

			});

			$("#metal").select2(

				{

					placeholder: "Select Metal",

					allowClear: true

				});

		}

	});

}

function get_ActiveFloors() {

	$('#floor_sel option').remove();

	$("div.overlay").css("display", "block");

	$.ajax({

		type: 'POST',

		url: base_url + 'index.php/admin_ret_catalog/get_ActiveBranchFloor',

		dataType: 'json',

		data: { 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()) },

		success: function (data) {

			var id = $("#floor_sel").val();

			$("#floor_sel").append(

				$("<option></option>")

					.attr("value", 0)

					.text('All')

			);

			$.each(data, function (key, item) {

				$('#floor_sel').append(

					$("<option></option>")

						.attr("value", item.floor_id)

						.text(item.floor_name)

				);

			});

			$("#floor_sel").select2(

				{

					placeholder: "Select Floor",

					allowClear: true

				});

			$('#floor_sel').select2("val", (id != '' && id > 0 ? id : ''));

			$(".overlay").css("display", "none");

		}

	});

}

$(document).on("change", "#floor_sel", function () {

	if (this.value != '') {

		get_ActiveCounters();

	}

});

function get_ActiveCounters() {

	$('#counter_sel option').remove();

	$("div.overlay").css("display", "block");

	$.ajax({

		type: 'POST',

		url: base_url + 'index.php/admin_ret_catalog/get_ActiveCounter',

		dataType: 'json',

		data: { 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'id_floor': $("#floor_sel").val() },

		success: function (data) {

			var id = $("#counter").val();

			$("#counter_sel").append(

				$("<option></option>")

					.attr("value", 0)

					.text('All')

			);

			$.each(data, function (key, item) {

				$('#counter_sel').append(

					$("<option></option>")

						.attr("value", item.counter_id)

						.text(item.counter_name)

				);

			});

			$("#counter_sel").select2(

				{

					placeholder: "Select Counter",

					allowClear: true

				});

			$('#counter_sel').select2("val", (id != '' && id > 0 ? id : ''));

			$(".overlay").css("display", "none");

		}

	});

}

function set_lotwise_table() {

	var company_name = $('#company_name').val();

	var from_date = $("#rpt_payments1").html();

	var to_date = $("#rpt_payments2").html();

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "Lot-wise Sold & Pending"

	var optional = $('#karigar option:selected').html() != '' && $('#karigar option:selected').html() != undefined ? $('#karigar option:selected').html() + " - " : '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/lot_wise/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'lot_no': $("#filter_lot").val(), 'karigar': $("#karigar").val(), 'id_product': $("#id_product").val(), 'from_date': $("#rpt_payments1").html(), 'to_date': $("#rpt_payments2").html(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()) }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.list;

			$('#total_count').text(list.length);

			var oTable = $('#lotwise_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#lotwise_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"order": [[0, "desc"]],

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"columnDefs": [

						{

							targets: [2, 3, 4, 5, 6, 7],

							className: 'dt-body-right'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', '10px');

							},

						},

						{

							extend: 'colvis',

							collectionLayout: 'fixed columns',

							collectionTitle: 'Column visibility control'

						},

						{

							extend: 'excel',

							footer: true,

							title: "Lot-wise Sold & Pending - " + $("#dt_range").val(),

						}

					],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "lot_no" },

						{ "mDataProp": "karigar_name" },

						{ "mDataProp": "no_of_pcs" },

						{

							"mDataProp": function (row, type, val, meta) {

								var total_gwt = row.total_gwt;

								return money_format_india(total_gwt);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var sold_pcs = row.sold_pcs;

								return money_format_india(sold_pcs);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var sold_gwt = row.sold_gwt;

								return money_format_india(sold_gwt);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var pending_pcs = row.pending_pcs;

								return money_format_india(pending_pcs);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var pending_gwt = row.pending_gwt;

								return money_format_india(pending_gwt);

							}

						},

					],

				});

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function getSearchProd(searchTxt) {

	my_Date = new Date();

	$.ajax({

		url: base_url + 'index.php/admin_ret_catalog/product/active_prodBySearch/?nocache=' + my_Date.getUTCSeconds(),

		dataType: "json",

		method: "POST",

		data: { 'searchTxt': searchTxt, 'lotno': $("#lotno").val(), 'cat_id': $("#category").val() },

		success: function (data) {

			$("#product").autocomplete(

				{

					source: data,

					select: function (e, i) {

						e.preventDefault();

						$("#product").val(i.item.label);

						$("#id_product").val(i.item.value);

					},

					response: function (e, i) {

						// ui.content is the array that's about to be sent to the response callback.

						if (i.content.length === 0) {

							$("#prodAlert").html('<p style="color:red">Enter a valid Product</p>');

							$('#id_product').val('');

						} else {

							$("#prodAlert").html('');

						}

					},

					minLength: 0,

				});

		}

	});

}

function getSearchDesign(searchTxt) {

	my_Date = new Date();

	$.ajax({

		url: base_url + 'index.php/admin_ret_brntransfer/branch_transfer/getDesignByFilter/?nocache=' + my_Date.getUTCSeconds(),

		dataType: "json",

		method: "POST",

		data: { 'searchTxt': searchTxt, 'prodId': $("#id_product").val(), 'lotno': $("#lotno").val() },

		success: function (data) {

			$("#design").autocomplete(

				{

					source: data,

					select: function (e, i) {

						e.preventDefault();

						$("#design").val(i.item.label);

						$("#id_design").val(i.item.value);

					},

					response: function (e, i) {

						// ui.content is the array that's about to be sent to the response callback.

						console.log(i);

					},

					minLength: 0,

				});

		}

	});

}

function set_partlysold_table() {

	var dt_range = ($("#dt_range").val()).split('-');

	var company_name = $('#company_name').val();

	var from_date = dt_range[0];

	var to_date = dt_range[1];

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "Partly Sold & Pending ";

	var product = $('#product').val() != '' && $('#product').val() != undefined ? $('#product').val() + " - " : '';

	var category = $('#category option:selected').val() != '' && $('#category option:selected').val() != undefined ? $('#category option:selected').html() + " - " : '';

	var optional = product + category;

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/partly_sold/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'lot_no': $("#filter_lot").val(), 'id_product': $("#id_product").val(), 'dt_range': $("#dt_range").val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()) }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.list;

			$('#total_count').text(list.length);

			var oTable = $('#partlysold_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#partlysold_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"order": [[0, "desc"]],

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"columnDefs": [

						{

							targets: [7, 8, 9, 10, 11, 12, 13, 14, 15],

							className: 'dt-body-right'

						},

						{

							targets: [1, 2, 3, 5, 6],

							className: 'dt-body-left'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							orientation: 'landscape',

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact');

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', '10px')

									.css('font-family', 'sans-serif');

							},

							exportOptions: {

								columns: ':visible',

								stripHtml: false

							},

						},

						{

							extend: 'colvis',

							collectionLayout: 'fixed columns',

							collectionTitle: 'Column visibility control'

						},

						{

							extend: 'excel',

							footer: true,

							title: "Partly Sold & Pending - " + $("#dt_range").val(),

						}

					],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "branch_name" },

						{ "mDataProp": "bill_date" },

						{ "mDataProp": "bill_no" },

						{ "mDataProp": "tag_code" },

						{

							"mDataProp": null,

							"sClass": "control center",

							"sDefaultContent": '<span class="drill-val"><i class="fa fa-chevron-circle-down text-teal"></i></span>'

						},

						{ "mDataProp": "product" },

						{ "mDataProp": "design" },

						{ "mDataProp": "actual_pieces" },

						{ "mDataProp": "actual_gross_wt" },

						{ "mDataProp": "actual_net_wt" },

						{ "mDataProp": "sold_pieces" },

						{ "mDataProp": "sold_gross_wt" },

						{ "mDataProp": "sold_net_wt" },

						{ "mDataProp": "blc_pcs" },

						{

							"mDataProp": function (row, type, val, meta) {

								return parseFloat(parseFloat(row.actual_gross_wt) - parseFloat(row.sold_gross_wt)).toFixed(3);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								return parseFloat(parseFloat(row.actual_net_wt) - parseFloat(row.sold_net_wt)).toFixed(3);

							}

						},

					],

					"footerCallback": function (row, data, start, end, display) {

						var cshtotal = 0;

						if (data.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								pieces = api

									.column(7)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(7).footer()).html(parseFloat(pieces).toFixed(2));

								gross_wt = api

									.column(8)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(8).footer()).html(parseFloat(gross_wt).toFixed(2));

								net_wt = api

									.column(9)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(9).footer()).html(parseFloat(net_wt).toFixed(2));

								sold_pieces = api

									.column(10)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(10).footer()).html(parseFloat(sold_pieces).toFixed(2));

								sold_gross_wt = api

									.column(11)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(11).footer()).html(parseFloat(sold_gross_wt).toFixed(2));

								sold_net_wt = api

									.column(12)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(12).footer()).html(parseFloat(sold_net_wt).toFixed(2));

								blc_pieces = api

									.column(13)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(13).footer()).html(parseFloat(blc_pieces).toFixed(2));

								blc_gross_wt = api

									.column(14)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(14).footer()).html(parseFloat(blc_gross_wt).toFixed(2));

								blc_net_wt = api

									.column(15)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(15).footer()).html(parseFloat(blc_net_wt).toFixed(2));

							}

						} else {

							var api = this.api(), data;

							$(api.column(5).footer()).html('');

							$(api.column(6).footer()).html('');

							$(api.column(7).footer()).html('');

							$(api.column(8).footer()).html('');

							$(api.column(9).footer()).html('');

							$(api.column(10).footer()).html('');

							$(api.column(11).footer()).html('');

							$(api.column(12).footer()).html('');

							$(api.column(13).footer()).html('');

						}

					}

				});

				var anOpen = [];

				$(document).on('click', "#partlysold_list .control", function () {

					var nTr = this.parentNode;

					var i = $.inArray(nTr, anOpen);

					if (i === -1) {

						$('.drill-val', this).html('<i class="fa fa-chevron-circle-up text-teal"></i>');

						oTable.fnOpen(nTr, fnFormatRowTagPartialDetails(oTable, nTr), 'details');

						anOpen.push(nTr);

					}

					else {

						$('.drill-val', this).html('<i class="fa fa-chevron-circle-down text-teal"></i>');

						oTable.fnClose(nTr);

						anOpen.splice(i, 1);

					}

				});

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function fnFormatRowTagPartialDetails(oTable, nTr) {

	var oData = oTable.fnGetData(nTr);

	var rowDetail = '';

	var prodTable =

		'<div class="innerDetails">' +

		'<table class="table table-responsive table-bordered text-center table-sm">' +

		'<tr class="bg-teal">' +

		'<th>S.No</th>' +

		'<th>Bill No</th>' +

		'<th>Bill Date</th>' +

		'<th>G.wt </th>' +

		'<th>N.wt </th>' +

		'</tr>';

	var partial_details = oData.partial_details;

	$.each(partial_details, function (idx, val) {

		var bill_url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + val.bill_id;

		var ref_no = val.tag_id + '_' + oData.product_id;

		prodTable +=

			'<tr class="prod_det_btn">' +

			'<td>' + parseFloat(idx + 1) + '</td>' +

			'<td><a href=' + bill_url + ' target="_blank">' + (val.sales_ref_no != '' ? val.sales_ref_no : '-') + '</a></td>' +

			'<td>' + val.bill_date + '</td>' +

			'<td>' + val.gross_wt + '</td>' +

			'<td>' + val.net_wt + '</td>' +

			'</tr>';

	});

	rowDetail = prodTable + '</table></div>';

	return rowDetail;

}

function set_cashabstract_table() {

	var report_type = $('#report_type').val();

	var group_type = $('#group_type').val();

	var company_name = $('#company_name').val();

	var from_date = $('#rpt_payments1').html();

	var to_date = $('#rpt_payments2').html();

	var counter = $("#counter_sel option:selected").text() && $("#counter_sel option:selected").text() != undefined ? $("#counter_sel option:selected").text() + " - " : '';

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var floor_sel = $("#floor_sel option:selected").text() && $("#floor_sel option:selected").text() != undefined ? $("#floor_sel option:selected").text() + " - " : '';

	var report_name = "CASH ABSTRACT";

	var optional = counter + floor_sel;

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	var employee_ids = $("#emp_sel").val();

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/cash_abstract/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({

			'from_date': $('#rpt_payments1').html(), 'to_date': $('#rpt_payments2').html(),

			'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'counter_id': $('#counter_sel').val(), 'floor_id': $('#floor_sel').val(), 'employee_ids': employee_ids, 'report_type': $('#report_type').val(), 'group_type': $('#group_type').val()

		}),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			$("#sales_list > tbody > tr").remove();

			$('#sales_list').dataTable().fnClearTable();

			$('#sales_list').dataTable().fnDestroy();

			var trHTML = '';

			var sales_details = data.list.item_details;

			var old_matel_details = data.list.old_matel_details;

			var return_details = data.list.return_details;

			var payment_details = data.list.payment_details;

			var adv_adj_details = data.list.advance_adjusted;

			var due_details = data.list.due_details;

			var chit_details = data.list.chit_details;

			var credit_details = data.list.credit_details;

			var wallet_adjusted = data.list.wallet_adjusted;

			var advance_detals = data.list.advance_detals;

			var general_adv_details = data.list.general_adv_details;

			var general_pay_details = data.list.general_pay;

			var order_adj_details = data.list.order_adj;

			var home_bill_details = data.list.home_bill;

			var voucher_details = data.list.voucher_details;

			var partly_sale_details = data.list.partly_sale;

			var round_off_amt = parseFloat(data.list.bill_det.round_off_amt).toFixed(2);

			var advance_ref_details = data.list.adv_refund;

			var repair_order_delivered = data.list.repair_order_delivered;

			var general_credit_collection = data.list.general_credit_collection;

			var other_expense_amount = data.list.other_expense.tot_amount;

			var advance_deposit_amt = data.list.advance_deposit.advance_deposit_amt;

			var chit_credit_collection_details = data.list.chit_credit_collection;

			var eda_sales_abstract = data.list.eda_sales_abstract;

			var eda_purchase_abstract = data.list.eda_purchase_abstract;

			var closing_amount = 0;

			var adv_amt = 0;

			var gen_adv_amt = 0;

			var order_adj_amt = 0;

			var voucher_amt = 0;

			//Sales

			var total_tax = 0;

			var total_amt = 0;

			var total_discount = 0;

			var total_wt = 0;

			var total_gwt = 0;

			var total_less_wt = 0;

			var no_of_pcs = 0;

			var tot_sales_amt = 0;

			var tot_sales_wt = 0;

			var tot_sales_gwt = 0;

			var tot_sales_less_wt = 0;

			var tot_sales_tax = 0;

			var tot_sales_discount = 0;

			var tot_sales_pcs = 0;

			var sales_taxable_amount = 0;

			var tot_sale_with_tax = 0;

			var tot_taxable_amount = 0;

			//Sales

			//Sales return

			var sales_ret_tax = 0;

			var sales_ret_amt = 0;

			var sales_ret_tax_with_amt = 0;

			var sales_ret_discount = 0;

			var sales_ret_gwt = 0;

			var sales_ret_wt = 0;

			var sales_ret_diawt = 0;

			var sales_ret_less_wt = 0;

			var sales_ret_pcs = 0;

			var tot_sales_ret_amt = 0;

			var tot_sales_with_tax = 0;

			var tot_sales_ret_gwt = 0;

			var tot_sales_ret_wt = 0;

			var tot_sales_ret_diawt = 0;

			var tot_sales_ret_less_wt = 0;

			var tot_sales_ret_tax = 0;

			var tot_sales_ret_discount = 0;

			var tot_sales_ret_pcs = 0;

			var sales_ret_taxable_amt = 0;

			var tot_sales_ret_taxable_amt = 0;

			//Sales return

			//Purchase

			var tot_pur_amt = 0;

			var tot_pur_gwt = 0;

			var tot_pur_nwt = 0;

			var tot_pur_pur_dia_wt = 0;

			var pur_gwt = 0;

			var pur_nwt = 0;

			var pur_dia_wt = 0;

			var pur_amount = 0;

			//Purchase

			//Payment

			var cash_payment = 0;

			var card_payment = 0;

			var cheque_payment = 0;

			var online_payment = 0;

			var chit_payment = 0;

			var gift_voucher = 0;

			var partial_gwt = 0;

			var partial_nwt = 0;

			var due_amt = 0;

			var credit_amount = 0;

			var cheque_credit = 0;

			var cheque_debit = 0;

			var total_imps_amount = 0;

			var total_rtgs_amount = 0;

			var total_upi_amount = 0;

			//Payment

			//genral_pay

			var gen_cash_payment = 0

			var gen_card_payment = 0

			var gen_cheque_payment = 0

			var gen_online_payment = 0

			var gen_cheque_payment_pay = 0

			var gen_cheque_payment_rec = 0

			var tot_gen_online_payment_rtgs = 0;

			var tot_gen_online_payment_imps = 0;

			var tot_gen_online_payment_upi = 0;

			//genral_pay

			//Credit Given

			var due_amount = 0;

			//Credit Given

			//Advance Adjusement

			var adv_adj_amt = adv_adj_details.adj_amt;

			//Advance Adjusement

			//Wallet amt adj

			var wallet_amt = 0;

			//advance refund

			var adv_refund_amt = 0;

			if (advance_ref_details.length > 0) {

				$.each(advance_ref_details, function (key, items) {

					adv_refund_amt += parseFloat(items.payment_amount);

				});

			}

			//Advance refund

			if (credit_details.length > 0) {

				$.each(credit_details, function (key, items) {

					credit_amount += parseFloat(items.tot_amt_received);

				});

			}

			if (general_credit_collection.length > 0) {

				$.each(general_credit_collection, function (key, item) {

					credit_amount += parseFloat(item.amount);

				});

			}

			if (general_adv_details.length > 0) {

				var advance_amt = 0;

				var weight_amt = 0;

				$.each(general_adv_details, function (key, items) {

					advance_amt += parseFloat(items.amount);

					//weight_amt += parseFloat((items.weight_amt != null ? items.weight_amt : 0));

				});

				gen_adv_amt = parseFloat(parseFloat(advance_amt) + parseFloat(weight_amt)).toFixed(2);

			}

			trHTML += '<tr class="sales">' +

				'<td class="sales" style="font-weight:bold;"><strong>SALES<strong></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'</tr>';

			$.each(sales_details, function (key, category) {

				if (report_type == 2) {

					trHTML += '<tr style="font-weight:bold;">' +

						'<td style="text-align: left;">' + key + '</td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'</tr>';

				}

				$.each(category, function (k, items) {

					var taxable_amount = parseFloat(items.item_cost - items.item_total_tax).toFixed(2);

					tot_taxable_amount += parseFloat(items.item_cost - items.item_total_tax);

					var sales_rate = parseFloat(items.sales_rate / items.piece).toFixed(2);

					var avg_rate = parseFloat(taxable_amount / items.net_wt).toFixed(2);

					var rate_diff = parseFloat(avg_rate - sales_rate).toFixed(2);

					total_amt += parseFloat(items.item_cost);

					total_discount += parseFloat(items.bill_discount);

					total_gwt += parseFloat(items.gross_wt);

					total_wt += parseFloat(items.net_wt);

					total_less_wt += parseFloat(items.less_wt);

					total_tax += parseFloat(items.item_total_tax);

					no_of_pcs += parseFloat(items.piece);

					trHTML += '<tr>' +

						'<td >' + (report_type == 2 ? items.product_name : (group_type == 1 ? items.category_name : items.metal_name)) + '</td>' +

						'<td >' + items.piece + '</td>' +

						'<td >' + (items.gross_wt > 0 ? money_format_india(items.gross_wt) : '') + '</td>' +

						'<td >' + (items.net_wt > 0 ? money_format_india(items.net_wt) : '') + '</td>' +

						'<td >' + (items.less_wt > 0 ? money_format_india(items.less_wt) : '') + '</td>' +

						'<td >' + money_format_india(taxable_amount) + '</td>' +

						'<td >' + money_format_india(items.item_total_tax) + '</td>' +

						'<td >' + money_format_india(items.item_cost) + '</td>' +

						'<td >' + money_format_india(items.bill_discount) + '</td>' +

						'<td >' + money_format_india(sales_rate) + '</td>' +

						'<td >' + (items.sales_mode == 2 ? money_format_india(avg_rate) : money_format_india(parseFloat(taxable_amount - items.bill_discount).toFixed(2))) + '</td>' +

						'<td>' + (items.sales_mode == 2 ? money_format_india(rate_diff) : '') + '</td>' +

						'</tr>';

				});

				if (report_type == 2) {

					trHTML += '<tr style="font-weight:bold;color:red">' +

						'<td><strong>SUB TOTAL</strong></td>' +

						'<td><strong>' + no_of_pcs + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(total_gwt).toFixed(3)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(total_wt).toFixed(3)) + '</strong></td>' +

						'<td><strong>' + (total_less_wt != 0 ? money_format_india(parseFloat(total_less_wt).toFixed(3)) : '') + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(tot_taxable_amount).toFixed(2)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(total_tax).toFixed(2)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(total_amt).toFixed(2)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(total_discount).toFixed(2)) + '</strong></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'</tr>';

				}

				tot_sales_amt += total_amt;

				tot_sales_wt += total_wt;

				tot_sales_gwt += total_gwt;

				tot_sales_less_wt += total_less_wt;

				tot_sales_tax += total_tax;

				tot_sales_discount += total_discount;

				tot_sales_pcs += no_of_pcs;

				sales_taxable_amount += tot_taxable_amount;

				tot_sale_with_tax += total_amt;

				total_amt = 0;

				total_gwt = 0;

				total_wt = 0; total_less_wt = 0;

				total_discount = 0; total_tax = 0; no_of_pcs = 0; tot_taxable_amount = 0;

			});

			//Total Sales Details

			trHTML += '<tr style="font-weight:bold;color:blue">' +

				'<td><strong>SALES TOTAL</strong></td>' +

				'<td><strong>' + tot_sales_pcs + '</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(tot_sales_gwt).toFixed(3)) + '</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(tot_sales_wt).toFixed(3)) + '</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(tot_sales_less_wt).toFixed(3)) + '</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(sales_taxable_amount).toFixed(2)) + '</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(tot_sales_tax).toFixed(2)) + '</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(tot_sale_with_tax).toFixed(2)) + '</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(tot_sales_discount).toFixed(2)) + '</strong></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'</tr>';

			//Total Sales Details

			//Sales Return

			trHTML += '<tr style="font-weight:bold;">' +

				'<td><strong>SALES RETURN</strong></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'</tr>';

			$.each(return_details, function (key, category) {

				if (report_type == 2) {

					trHTML += '<tr style="font-weight:bold;">' +

						'<td style="text-align: left;">' + key + '</td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'</tr>';

				}

				console.log(category);

				if (category.length > 0 && category != '') {

					$.each(category, function (k, items) {

						var taxable_amount = parseFloat(items.item_cost - items.item_total_tax).toFixed(2);

						sales_ret_taxable_amt += parseFloat(items.item_cost - items.item_total_tax);

						var sales_rate = parseFloat(items.sales_rate / items.piece).toFixed(2);

						var avg_rate = parseFloat(taxable_amount / items.net_wt).toFixed(2);

						var rate_diff = parseFloat(avg_rate - sales_rate).toFixed(2);

						sales_ret_amt += parseFloat(items.item_cost);

						sales_ret_discount += parseFloat(items.bill_discount);

						sales_ret_gwt += parseFloat(items.gross_wt);

						sales_ret_wt += parseFloat(items.net_wt);

						sales_ret_diawt += parseFloat(items.dia_wt);

						sales_ret_less_wt += parseFloat(items.less_wt);

						sales_ret_tax += parseFloat(items.item_total_tax);

						sales_ret_tax_with_amt += parseFloat(items.item_cost);

						sales_ret_pcs += parseFloat(items.piece);

						trHTML += '<tr>' +

							'<td >' + (report_type == 2 ? items.product_name : (group_type == 1 ? items.category_name : items.metal_name)) + '</td>' +

							'<td >' + items.piece + '</td>' +

							'<td >' + (items.gross_wt > 0 ? money_format_india(items.gross_wt) : '') + '</td>' +

							'<td >' + (items.net_wt > 0 ? money_format_india(items.net_wt) : '') + '</td>' +

							'<td>' + money_format_india(items.dia_wt) + '</td>' +

							'<td >' + money_format_india(taxable_amount) + '</td>' +

							'<td >' + money_format_india(items.item_total_tax) + '</td>' +

							'<td >' + money_format_india(items.item_cost) + '</td>' +

							'<td >' + money_format_india(items.bill_discount) + '</td>' +

							'<td >' + money_format_india(sales_rate) + '</td>' +

							'<td >' + (items.sales_mode == 2 ? money_format_india(avg_rate) : money_format_india(parseFloat(taxable_amount - items.bill_discount).toFixed(2))) + '</td>' +

							'<td >' + (items.sales_mode == 2 ? money_format_india(rate_diff) : '') + '</td>' +

							'</tr>';

					});

				}

				/*trHTML += '<tr style="font-weight:bold;">' +

							  '<td>TAX</td>'+

							  '<td></td>'+

							  '<td></td>'+

							  '<td></td>'+

							  '<td></td>'+

							  '<td style="font-weight:bold;">'+parseFloat(sales_ret_tax).toFixed(2)+'</td>'+

							  '<td></td>'+

							  '<td></td>'+

							  '<td></td>'+

							  '<td></td>'+

					   '</tr>';*/

				if (report_type == 2) {

					trHTML += '<tr style="font-weight:bold;color:red;">' +

						'<td><strong>SUB TOTAL</strong></td>' +

						'<td><strong>' + sales_ret_pcs + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(sales_ret_gwt).toFixed(3)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(sales_ret_wt).toFixed(3)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(sales_ret_diawt).toFixed(3)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(sales_ret_taxable_amt).toFixed(2)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(sales_ret_tax).toFixed(2)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(sales_ret_tax_with_amt).toFixed(2)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(sales_ret_discount).toFixed(2)) + '</strong></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'</tr>';

				}

				tot_sales_ret_amt += sales_ret_amt;

				tot_sales_ret_gwt += sales_ret_gwt;

				tot_sales_ret_wt += sales_ret_wt;

				tot_sales_ret_diawt += sales_ret_diawt;

				tot_sales_ret_less_wt += sales_ret_less_wt;

				tot_sales_ret_tax += sales_ret_tax;

				tot_sales_ret_discount += sales_ret_discount;

				tot_sales_ret_pcs += sales_ret_pcs;

				tot_sales_ret_taxable_amt += sales_ret_taxable_amt;

				tot_sales_with_tax += sales_ret_tax_with_amt;

				sales_ret_amt = 0;

				sales_ret_wt = 0;

				sales_ret_diawt = 0;

				sales_ret_gwt = 0;

				sales_ret_tax_with_amt = 0;

				sales_ret_discount = 0; sales_ret_tax = 0; sales_ret_pcs = 0; sales_ret_taxable_amt = 0;

			});

			trHTML += '<tr style="font-weight:bold;color:blue">' +

				'<td><strong>SALES RETURN TOTAL</strong></td>' +

				'<td><strong>' + tot_sales_ret_pcs + '</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(tot_sales_ret_gwt).toFixed(3)) + '</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(tot_sales_ret_wt).toFixed(3)) + '</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(tot_sales_ret_diawt).toFixed(3)) + '</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(tot_sales_ret_taxable_amt).toFixed(2)) + '</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(tot_sales_ret_tax).toFixed(2)) + '</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(tot_sales_with_tax).toFixed(2)) + '</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(tot_sales_ret_discount).toFixed(2)) + '</strong></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'</tr>';

			//Sales Return

			//REPAIR ORDER DELIVERED

			trHTML += '<tr style="font-weight:bold;">' +

				'<td><strong>REPAIR ORDER</strong></td>' +

				'<td>' + (repair_order_delivered.pcs != null ? repair_order_delivered.pcs : '-') + '</td>' +

				//'<td>' + (repair_order_delivered.weight != null ? money_format_india(parseFloat(repair_order_delivered.weight).toFixed(2)) : '-') + '</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td>' + (repair_order_delivered.amount != null ? money_format_india(parseFloat(repair_order_delivered.amount).toFixed(2)) : '-') + '</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'</tr>';

			//REPAIR ORDER DELIVERED

			//Purchase Details

			trHTML += '<tr style="font-weight:bold;">' +

				'<td><strong>PURCHASE</strong></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'</tr>';

			$.each(old_matel_details, function (key, old_metal) {

				/*trHTML += '<tr style="font-weight:bold;">' +

									'<td>'+key+'</td>'+

									'<td></td>'+

									'<td></td>'+

									'<td></td>'+

									'<td></td>'+

									'<td></td>'+

									'<td></td>'+

									'<td></td>'+

							 '</tr>';*/

				$.each(old_metal, function (i, items) {

					pur_gwt += parseFloat(items.gross_wt);

					pur_nwt += parseFloat(items.net_wt);

					pur_dia_wt += parseFloat(items.dia_wt);

					pur_amount += parseFloat(items.amount);

					var sales_rate = parseFloat(items.rate_per_grm / items.tot_pur).toFixed(2);

					var avg_rate = parseFloat(items.amount / items.net_wt).toFixed(2);

					trHTML += '<tr>' +

						'<td >' + items.old_metal_type + '</td>' +

						'<td></td>' +

						'<td>' + money_format_india(items.gross_wt) + '</td>' +

						'<td>' + money_format_india(items.net_wt) + '</td>' +

						'<td>' + money_format_india(items.dia_wt) + '</td>' +

						'<td>' + money_format_india(items.amount) + '</td>' +

						'<td></td>' +

						'<td>' + money_format_india(sales_rate) + '</td>' +

						'<td>' + money_format_india(avg_rate) + '</td>' +

						'<td>' + money_format_india(parseFloat(avg_rate - sales_rate).toFixed(2)) + '</td>' +

						'<td></td>' +

						'<td></td>' +

						'</tr>';

				});

				tot_pur_amt += pur_amount;

				tot_pur_gwt += pur_gwt;

				tot_pur_nwt += pur_nwt;

				tot_pur_pur_dia_wt += pur_dia_wt;

				pur_gwt = 0; pur_amount = 0;

				pur_nwt = 0;

				pur_dia_wt = 0;

			});

			trHTML += '<tr style="font-weight:bold;color:blue">' +

				'<td style="text-align: left;color:blue"><strong>PURCHASE TOTAL</strong></td>' +

				'<td></td>' +

				'<td><strong>' + money_format_india(parseFloat(tot_pur_gwt).toFixed(3)) + '</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(tot_pur_nwt).toFixed(3)) + '</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(tot_pur_pur_dia_wt).toFixed(3)) + '</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(tot_pur_amt).toFixed(2)) + '</strong></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'</tr>';

			//Purchase Details

			//Home Bill Details

			if (home_bill_details.length > 0) {

				trHTML += '<tr >' +

					'<td style="text-align: left;font-weight:bold;"><strong>HOME BILL</strong></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'</tr>';

				$.each(home_bill_details, function (key, item) {

					trHTML += '<tr>' +

						'<td>' + item.product_name + '</td>' +

						'<td>' + item.pcs + '</td>' +

						'<td>' + money_format_india(parseFloat(item.gross_wt).toFixed(3)) + '</td>' +

						'<td></td>' +

						'<td></td>' +

						'<td>' + money_format_india(item.item_cost) + '</td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'</tr>';

				});

			}

			//Home Bill Details

			//Partly sale details

			if (partly_sale_details.length > 0) {

				trHTML += '<tr style="font-weight:bold;">' +

					'<td style="text-align: left;"><strong>PARTLY SALE</strong></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'</tr>';

				$.each(partly_sale_details, function (key, item) {

					trHTML += '<tr>' +

						'<td>' + item.product_name + '</td>' +

						'<td>' + item.pcs + '</td>' +

						'<td>' + money_format_india(parseFloat(item.gross_wt).toFixed(3)) + '</td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'</tr>';

				});

			}

			//EDA sale details

			if (eda_sales_abstract.length > 0) {

				trHTML += '<tr style="font-weight:bold;">' +

					'<td style="text-align: left;"><strong>EDA SALES</strong></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'</tr>';

				$.each(eda_sales_abstract, function (key, item) {

					trHTML += '<tr>' +

						'<td>' + item.metal + '</td>' +

						'<td>' + item.pieces + '</td>' +

						'<td>' + item.grosswt + '</td>' +

						'<td>' + item.netwt + '</td>' +

						'<td>' + item.collectedamt + '</td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'</tr>';

				});

			}

			//EDA sale details

			//EDA Purchase details

			if (eda_purchase_abstract.length > 0) {

				trHTML += '<tr style="font-weight:bold;">' +

					'<td style="text-align: left;"><strong>EDA PURCHASE</strong></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'</tr>';

				$.each(eda_purchase_abstract, function (key, item) {

					trHTML += '<tr>' +

						'<td>' + item.metal + '</td>' +

						'<td>' + item.pieces + '</td>' +

						'<td>' + item.grosswt + '</td>' +

						'<td>' + item.netwt + '</td>' +

						'<td>' + item.purchaseamt + '</td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'</tr>';

				});

			}

			//EDA Purchase details

			//Partly sale details

			//Cash Abstract

			if (due_details.length > 0) {

				$.each(due_details, function (key, item) {

					due_amount += parseFloat(item.due_amt);

				});

			}

			if (advance_detals.length > 0) {

				var adv_wt_amt = 0;

				$.each(advance_detals, function (key, item) {

					/*	if (item.received_weight > 0) {

							adv_wt_amt += parseFloat(item.received_weight * item.rate_per_gram);

						}*/

					adv_amt += parseFloat(item.advance_amount);

				});

				adv_amt = parseFloat(parseFloat(adv_amt) + parseFloat(adv_wt_amt)).toFixed(2);

			}

			if (order_adj_details.length > 0) {

				var ord_adj_wt = 0;

				$.each(order_adj_details, function (key, items) {

					/*if (items.received_weight > 0) {

						ord_adj_wt += parseFloat(items.received_weight * items.rate_per_gram);

					}*/

					order_adj_amt += parseFloat(items.advance_amount);

				});

				order_adj_amt = parseFloat(parseFloat(order_adj_amt) + parseFloat(ord_adj_wt)).toFixed(2);

			}

			trHTML += '<tr style="font-weight:bold;">' +

				'<td><strong>CASH ABSTRACT</strong></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'</tr>';

			trHTML += '<tr style="font-weight:bold;>' +

				'<td>SALES</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td>' + money_format_india(parseFloat(sales_taxable_amount).toFixed(2)) + '</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'</tr>';

			trHTML += '<tr style="font-weight:bold;">' +

				'<td style="text-align: left;">SALES</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td>' + money_format_india(parseFloat(sales_taxable_amount).toFixed(2)) + '</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'</tr>';

			trHTML += '<tr style="font-weight:bold;">' +

				'<td style="text-align: left;">TAX/VAT</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td>' + money_format_india(parseFloat(tot_sales_tax).toFixed(2)) + '</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'</tr>';

			trHTML += '<tr style="font-weight:bold;">' +

				'<td style="text-align: left;">SALES RETURN</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td>' + money_format_india(parseFloat(tot_sales_ret_taxable_amt).toFixed(2)) + '</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'</tr>';

			trHTML += '<tr style="font-weight:bold;">' +

				'<td>TAx/VAT- SR</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td>' + money_format_india(parseFloat(tot_sales_ret_tax).toFixed(2)) + '</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'</tr>';

			trHTML += '<tr style="font-weight:bold;">' +

				'<td style="text-align: left;">PURCHASE</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td>' + money_format_india(parseFloat(tot_pur_amt).toFixed(2)) + '</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'</tr>';

			trHTML += '<tr style="font-weight:bold;text-transform:uppercase">' +

				'<td style="text-align: left;">ADVANCE RECEIPT</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td>' + money_format_india(parseFloat(parseFloat(adv_amt) + parseFloat(gen_adv_amt)).toFixed(2)) + '</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'</tr>';

			trHTML += '<tr style="font-weight:bold;text-transform:uppercase">' +

				'<td style="text-align: left;">ADVANCE  DEPOSIT</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td>' + money_format_india(parseFloat(advance_deposit_amt).toFixed(2)) + '</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'</tr>';

			trHTML += '<tr style="font-weight:bold;text-transform:uppercase">' +

				'<td style="text-align: left;">ADVANCE REFUND</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td>' + money_format_india(parseFloat(adv_refund_amt).toFixed(2)) + '</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'</tr>';

			trHTML += '<tr style="font-weight:bold;text-transform:uppercase">' +

				'<td style="text-align: left;">CREDIT RECEIPT</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td>' + money_format_india(parseFloat(credit_amount).toFixed(2)) + '</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'</tr>';

			trHTML += '<tr style="font-weight:bold;text-transform:uppercase">' +

				'<td style="text-align: left;">CREDIT SALES</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td>' + money_format_india(parseFloat(due_amount).toFixed(2)) + '</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'</tr>';

			trHTML += '<tr style="font-weight:bold;text-transform:uppercase">' +

				'<td style="text-align: left;">OTHER EXPENSES</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td>' + money_format_india(parseFloat(other_expense_amount).toFixed(2)) + '</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'</tr>';

			trHTML += '<tr style="font-weight:bold;">' +

				'<td>HANDLING CHARGES</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td>' + money_format_india(parseFloat(data.list.bill_det.handling_charges).toFixed(2)) + '</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'</tr>';

			trHTML += '<tr style="font-weight:bold;text-transform:uppercase">' +

				'<td style="text-align: left;"><strong>TOTAL</strong></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td><strong>' + money_format_india(parseFloat(parseFloat(tot_sales_amt) + parseFloat(credit_amount) + parseFloat(adv_amt) + parseFloat(gen_adv_amt) + parseFloat(advance_deposit_amt) + parseFloat(data.list.bill_det.handling_charges) + parseFloat(repair_order_delivered.amount) - parseFloat(tot_pur_amt) - parseFloat(tot_sales_ret_amt) - parseFloat(due_amount) - parseFloat(adv_refund_amt) - parseFloat(other_expense_amount)).toFixed(2)) + '</strong></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'</tr>';

			//cash abstract

			//Payment

			if (payment_details.length > 0) {

				$.each(payment_details, function (key, item) {

					if (item.payment_mode == 'Cash' && item.payment_amount != null) {

						cash_payment += parseFloat(item.payment_amount);

					}

					if (item.payment_mode == 'CC' || item.payment_mode == 'DC' && item.payment_amount != null) {

						card_payment += parseFloat(item.payment_amount);

					}

					if (item.payment_mode == 'CHQ' && item.payment_amount != null) {

						cheque_payment += parseFloat(item.payment_amount);

						if (item.type == 1) {

							cheque_credit += parseFloat(item.payment_amount);

						} else if (item.type == 2) {

							cheque_debit -= parseFloat(item.payment_amount);

						}

					}

					if (item.payment_mode == 'NB' && item.payment_amount != null) {

						online_payment += parseFloat(item.payment_amount);

					}

					if (item.nb_type != null && item.nb_type > 0  && item.payment_amount != null) {

						if (item.nb_type == 1) {

							total_rtgs_amount += parseFloat(item.payment_amount);

						}

						if (item.nb_type == 2) {

							total_imps_amount += parseFloat(item.payment_amount);

						}

						if (item.nb_type == 3) {

							total_upi_amount += parseFloat(item.payment_amount);

						}

					}

				});

			}

			if (general_pay_details.length > 0) {

				$.each(general_pay_details, function (key, item) {

					if (item.payment_mode == 'Cash' && item.payment_amount != null) {

						if (item.transcation_type == 1) {

							gen_cash_payment += parseFloat(item.payment_amount);

						}

						if (item.transcation_type == 2) {

							gen_cash_payment -= parseFloat(item.payment_amount);

						}

					}

					if (item.payment_mode == 'CC' || item.payment_mode == 'DC' && item.payment_amount != null) {

						if (item.transcation_type == 1) {

							gen_card_payment += parseFloat(item.payment_amount);

						}

						if (item.transcation_type == 2) {

							gen_card_payment -= parseFloat(item.payment_amount);

						}

					}

					if (item.payment_mode == 'CHQ' && item.payment_amount != null) {

						if (item.transcation_type == 1) {

							gen_cheque_payment += parseFloat(item.payment_amount);

							gen_cheque_payment_rec += parseFloat(item.payment_amount);

						}

						if (item.transcation_type == 2) {

							gen_cheque_payment -= parseFloat(item.payment_amount);

							gen_cheque_payment_pay += parseFloat(item.payment_amount);

						}

					}

					if (item.payment_mode == 'NB' && item.payment_amount != null) {

						if (item.transcation_type == 1) {

							gen_online_payment += parseFloat(item.payment_amount);

						}

						if (item.transcation_type == 2) {

							gen_online_payment -= parseFloat(item.payment_amount);

						}

						if (item.nb_type != null && item.nb_type != 0) {

							if (item.nb_type == 1) {

								if (item.transcation_type == 1) {

									tot_gen_online_payment_rtgs += parseFloat(item.payment_amount);

								} else {

									tot_gen_online_payment_rtgs -= parseFloat(item.payment_amount);

								}

							}

							if (item.nb_type == 2) {

								if (item.transcation_type == 1) {

									tot_gen_online_payment_imps += parseFloat(item.payment_amount);

								} else {

									tot_gen_online_payment_imps -= parseFloat(item.payment_amount);

								}

							}

							if (item.nb_type == 3) {

								if (item.transcation_type == 1) {

									tot_gen_online_payment_upi += parseFloat(item.payment_amount);

								} else {

									tot_gen_online_payment_upi -= parseFloat(item.payment_amount);

								}

							}

						}

					}

				});

			}

			if (chit_details.length > 0) {

				$.each(chit_details, function (key, item) {

					closing_amount += parseFloat(item.utilized_amt);

				});

			}

			if (voucher_details.length > 0) {

				$.each(voucher_details, function (key, item) {

					voucher_amt += parseFloat(item.gift_voucher_amt);

				});

			}

			/*trHTML += '<tr style="font-weight:bold;">' +

												'<td style="text-align: left;">TOTAL</td>'+

												'<td></td>'+

												'<td></td>'+

												'<td></td>'+

												'<td></td>'+

												'<td></td>'+

												'<td></td>'+

												'<td></td>'+

										 '</tr>';*/

			trHTML += '<tr style="font-weight:bold;text-transform:uppercase">' +

				'<td style="text-align: left;">CASH</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td>' + money_format_india(parseFloat(parseFloat(cash_payment) + parseFloat(gen_cash_payment)).toFixed(2)) + '</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'</tr>';

			trHTML += '<tr style="font-weight:bold;text-transform:uppercase">' +

				'<td style="text-align: left;">CHEQUE RECEIVED</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td>' + money_format_india(parseFloat(parseFloat(cheque_credit) + parseFloat(gen_cheque_payment_rec)).toFixed(2)) + '</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'</tr>';

			trHTML += '<tr style="font-weight:bold;text-transform:uppercase">' +

				'<td style="text-align: left;">CHEQUE ISSUED</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td>' + money_format_india(parseFloat(parseFloat(cheque_debit) + parseFloat(gen_cheque_payment_pay)).toFixed(2)) + '</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'</tr>';

			trHTML += '<tr style="font-weight:bold;text-transform:uppercase">' +

				'<td style="text-align: left;">CARD</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td>' + money_format_india((parseFloat(card_payment) + parseFloat(gen_card_payment)).toFixed(2)) + '</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'</tr>';

			/*trHTML += '<tr style="font-weight:bold;text-transform:uppercase">' +

				'<td style="text-align: left;">NET BANKING</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td>' + money_format_india(parseFloat(parseFloat(online_payment) + parseFloat(gen_online_payment)).toFixed(2)) + '</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'</tr>';*/

			trHTML += '<tr style="font-weight:bold;text-transform:uppercase">' +

				'<td style="text-align: left;">RTGS</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td>' + money_format_india(parseFloat(parseFloat(total_rtgs_amount) + parseFloat(tot_gen_online_payment_rtgs)).toFixed(2)) + '</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'</tr>';

			trHTML += '<tr style="font-weight:bold;text-transform:uppercase">' +

				'<td style="text-align: left;">IMPS</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td>' + money_format_india(parseFloat(parseFloat(total_imps_amount) + parseFloat(tot_gen_online_payment_imps)).toFixed(2)) + '</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'</tr>';

			trHTML += '<tr style="font-weight:bold;text-transform:uppercase">' +

				'<td style="text-align: left;">UPI</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td>' + money_format_india(parseFloat(parseFloat(total_upi_amount) + parseFloat(tot_gen_online_payment_upi)).toFixed(2)) + '</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'</tr>';

			trHTML += '<tr style="font-weight:bold;text-transform:uppercase">' +

				'<td style="text-align: left;">ADVANCE  ADJ</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td>' + money_format_india(parseFloat(adv_adj_amt).toFixed(2)) + '</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'</tr>';

			trHTML += '<tr style="font-weight:bold;text-transform:uppercase">' +

				'<td style="text-align: left;">CHIT UTILIZED</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td>' + money_format_india(parseFloat(closing_amount).toFixed(2)) + '</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'</tr>';

			trHTML += '<tr style="font-weight:bold;text-transform:uppercase">' +

				'<td style="text-align: left;">ORDER ADJ</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td>' + money_format_india(parseFloat(order_adj_amt).toFixed(2)) + '</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'</tr>';

			trHTML += '<tr style="font-weight:bold;">' +

				'<td style="text-align: left;">GIFT VOUCHER</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td>' + money_format_india(parseFloat(voucher_amt).toFixed(2)) + '</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'</tr>';

			trHTML += '<tr style="font-weight:bold;text-transform:uppercase">' +

				'<td style="text-align: left;">ROUND off</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td>' + money_format_india(round_off_amt) + '</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'</tr>';

			//TOTAL

			if (round_off_amt >= 0) {

				var collection_amt = parseFloat(parseFloat(cash_payment) + parseFloat(cheque_payment) + parseFloat(card_payment) + parseFloat(online_payment) + parseFloat(adv_adj_amt) + parseFloat(closing_amount) + parseFloat(gen_cash_payment) + parseFloat(gen_card_payment) + parseFloat(gen_online_payment) + parseFloat(gen_cheque_payment) + parseFloat(order_adj_amt) + parseFloat(voucher_amt) - parseFloat(round_off_amt));

			} else {

				var collection_amt = parseFloat(parseFloat(cash_payment) + parseFloat(cheque_payment) + parseFloat(card_payment) + parseFloat(online_payment) + parseFloat(adv_adj_amt) + parseFloat(closing_amount) + parseFloat(gen_cash_payment) + parseFloat(gen_card_payment) + parseFloat(gen_online_payment) + parseFloat(gen_cheque_payment) + parseFloat(order_adj_amt) + parseFloat(voucher_amt) - parseFloat(round_off_amt * -1));

			}

			//TOTAL

			trHTML += '<tr style="font-weight:bold;text-transform:uppercase">' +

				'<td style="text-align: left;"><strong>TOTAL</strong></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td><strong>' + money_format_india(parseFloat(collection_amt).toFixed(2)) + '</strong></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'</tr>';

			//Payment

			if (chit_credit_collection_details.length > 0) {

				trHTML += '<tr >' +

					'<td style="white-space:nowrap;text-align: left;font-weight:bold;"><strong>CHIT CREDIT COLLECTION</strong></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'</tr>';

				$.each(chit_credit_collection_details, function (key, item) {

					trHTML += '<tr style="font-weight:bold">' +

						'<td>' + item.payment_mode + '</td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td>' + item.payment_amount + '</td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'</tr>';

				});

			}

			$('#sales_list > tbody').html(trHTML);

			if (!$.fn.DataTable.isDataTable('#sales_list')) {

				oTable = $('#sales_list').dataTable({

					"bSort": false,

					"bDestroy": true,

					"bInfo": true,

					"scrollX": '100%',

					"paging": false,

					"dom": 'Bfrtip',

					"bAutoWidth": false,

					"responsive": true,

					"columnDefs": [

						{

							targets: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11],

							className: 'dt-body-right'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact');

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', '10px')

									.css('font-family', 'sans-serif');

							},

							exportOptions: {

								columns: ':visible',

								stripHtml: false

							}

						},

						{

							extend: 'colvis',

							collectionLayout: 'fixed columns',

							collectionTitle: 'Column visibility control'

						},

						{

							extend: 'excel',

							footer: true,

							title: 'CASH-ABSTRACT',

						}

					],

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function set_btreport_table() {

	var company_name = $('#company_name').val();

	var from_date = $("#rpt_payments1").html();

	var to_date = $("#rpt_payments2").html();

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "Branch Transfer Report"

	var optional = '';

	var report_type = $('#report_type').val();

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	var type = $('#transtype').val();

	var from_branch = "";

	var to_branch = "";

	if (type == 1) {

		from_branch = $("#branch_filter").val();

	}

	else if (type == 2) {

		to_branch = $("#branch_filter").val();

	}

	else {

		from_branch = $("#branch_filter").val();

	}

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/branch_trans/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({

			'transtype': $("#transtype").val(),

			'from_date': $("#rpt_payments1").html(),

			'to_date': $("#rpt_payments2").html(),

			'branchtranstype': $('#branch_transfer_type').val(),

			'from_branch': $("#branch_select").val() || from_branch,

			'to_branch': $('#branch_select_to').val() || to_branch,

			'id_metal': $("#metal").val(),

			'id_section': $('#section_select').val(),

			'id_category': $('#category').val(),

			'report_type': $('#report_type').val(),

			'group_by': $('#group_by').val(),

			'trans_status': $('#trans_status').val(),

			'brans_type': $('#brans_type').val(),

			'stock_type': $('input[name="bt_stock_type"]:checked').val()

		}),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.list;

			$("#bt_report > tbody > tr").remove();

			$('#bt_report').dataTable().fnClearTable();

			$('#bt_report').dataTable().fnDestroy();

			// $("#other_inventory_report > tbody > tr").remove();

			// $('#other_inventory_report').dataTable().fnClearTable();

			// $('#other_inventory_report').dataTable().fnDestroy();

			if ($('#branch_transfer_type').val() != 6) {

				if (list != null && list != 0) {

					trHTML = '';

					tfootHTML = '';

					var total_pieces = 0;

					var total_grs_wt = 0;

					var total_net_wt = 0;

					var total_stn_wt = 0;

					var total_dia_wt = 0;

					$.each(list, function (i, branch) {

						var pieces = 0;

						var grs_wt = 0;

						var net_wt = 0;

						var stn_wt = 0;

						var dia_wt = 0;

						if ($('#group_by').val() == 2 || $('#group_by').val() == 3) {

							trHTML += '<tr style="font-weight:bold;">' +

								'<td style="text-align: left;">' + i + '</td>' +

								'<td></td>' +

								'<td></td>' +

								'<td></td>' +

								'<td></td>' +

								'<td></td>' +

								'<td></td>' +

								'<td></td>' +

								'<td></td>' +

								'<td></td>' +

								'<td></td>' +

								'<td></td>' +

								'<td></td>' +

								'<td></td>' +

								'<td></td>' +

								'<td></td>' +

								'<td></td>' +

								'<td></td>' +

								'<td></td>' +

								'<td></td>' +

								'<td></td>' +

								'<td></td>' +

								'<td></td>' +

								'<td></td>' +

								'</tr>';

						}

						$.each(branch, function (idx, item) {

							trHTML += '<tr>'

								+ '<td>' + parseFloat(idx + 1) + '</td>'

								+ '<td>' + item.date_add + '</td>'

								+ '<td>' + item.branch_transfer_id + '</td>'

								+ '<td>' + item.branch_trans_code + '</td>'

								+ '<td>' + ($('#report_type').val() == 1 ? item.tag_code : "-") + '</td>'

								+ '<td>' + ($('#report_type').val() == 1 ? item.old_tag_id : "-") + '</td>'

								+ '<td>' + item.po_ref_no + '</td>'

								+ '<td>' + item.po_date + '</td>'

								+ '<td>' + item.from_branch + '</td>'

								+ '<td>' + item.to_branch + '</td>'

								+ '<td>' + item.section + '</td>'

								+ '<td>' + item.purity + '</td>'

								+ '<td>' + item.product_name + '</td>'

								+ '<td>' + item.design_name + '</td>'

								+ '<td>' + item.pieces + '</td>'

								+ '<td>' + (item.stone_type != 2 ? money_format_india(item.grs_wt) : '0.000') + '</td>'

								+ '<td>' + (item.stone_type != 2 ? money_format_india(item.net_wt) : '0.000') + '</td>'

								+ '<td>' + money_format_india(item.stn_wt) + '</td>'

								+ '<td>' + (item.stone_type == 2 ? money_format_india(item.grs_wt) : money_format_india(item.dia_wt)) + '</td>'

								+ '<td>' + item.bt_status + '</td>'

								+ '<td>' + item.approved_datetime + '</td>'

								+ '<td>' + item.dwnload_datetime + '</td>'

								+ '<td>' + item.created_emp + '</td>'

								+ '<td>' + item.downloaded_emp + '</td>'

							'</tr>';

							pieces += parseFloat(item.pieces);

							grs_wt += (item.stone_type != 2 ? parseFloat(item.grs_wt) : 0);

							net_wt += (item.stone_type != 2 ? parseFloat(item.net_wt) : 0);

							stn_wt += parseFloat(item.stn_wt);

							dia_wt += (item.stone_type == 2 ? parseFloat(item.grs_wt) : parseFloat(item.dia_wt));

						});

						trHTML += '<tr style="font-weight:bold;color:red">' +

							+'<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td>Sub Total</td>'

							+ '<td>' + money_format_india(parseFloat(pieces).toFixed(0)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(grs_wt).toFixed(3)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(net_wt).toFixed(3)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(stn_wt).toFixed(3)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(dia_wt).toFixed(3)) + '</td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

						'</tr>';

						total_pieces += pieces;

						total_grs_wt += grs_wt;

						total_net_wt += net_wt;

						total_stn_wt += stn_wt;

						total_dia_wt += dia_wt;

					});

					trHTML += '<tr style="font-weight:bold;color:blue">' +

						+'<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td>Grand Total</td>'

						+ '<td>' + money_format_india(parseFloat(total_pieces).toFixed(0)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(total_grs_wt).toFixed(3)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(total_net_wt).toFixed(3)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(total_stn_wt).toFixed(3)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(total_dia_wt).toFixed(3)) + '</td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

					'</tr>';

					$('#bt_report > tbody').html(trHTML);

					// Check and initialise datatable

					if (!$.fn.DataTable.isDataTable('#bt_report')) {

						oTable = $('#bt_report').dataTable({

							"bSort": false,

							"bInfo": true,

							"scrollX": '100%',

							"dom": 'lBfrtip',

							"columnDefs": [

								{

									targets: [15, 16, 17, 18, 19],

									className: 'dt-body-right'

								},

							],

							"buttons": [

								{

									extend: 'print',

									footer: true,

									title: '',

									messageTop: title,

									customize: function (win) {

										$(win.document.body).find('table')

											.addClass('compact')

											.css('font-size', '10px');

									},

								},

								{

									extend: 'excel',

									footer: true,

									title: company_name + '-' + (branch_name != '' ? branch_name : '') + ' - ' + report_type + ' ' + from_date + '-' + to_date,

								}

							],

						});

					}

				}

			}

			else {

				if (list != null && list != 0) {

					trHTML = '';

					tfootHTML = '';

					total_pieces = 0;

					$.each(list, function (i, branch) {

						var pieces = 0;

						$.each(branch, function (idx, item) {

							trHTML += '<tr>'

								+ '<td>' + item.date_add + '</td>'

								+ '<td>' + item.branch_transfer_id + '</td>'

								+ '<td>' + item.branch_trans_code + '</td>'

								+ '<td>' + item.from_branch + '</td>'

								+ '<td>' + item.to_branch + '</td>'

								+ '<td>' + item.item_name + '</td>'

								+ '<td>' + money_format_india(item.pieces) + '</td>'

								+ '<td>' + item.bt_status + '</td>'

								+ '<td>' + item.approved_datetime + '</td>'

								+ '<td>' + item.dwnload_datetime + '</td>'

								+ '<td>' + item.created_emp + '</td>'

								+ '<td>' + item.downloaded_emp + '</td>'

							'</tr>';

							pieces = parseFloat(pieces) + parseFloat(item.pieces);

						});

						total_pieces = total_pieces + pieces;

						// total_paid_amount = total_paid_amount + paid_amount;

						// total_bal_amount = total_bal_amount + bal_amount;

					});

					trHTML += '<tr style="font-weight:bold; color: blue">'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td>Grand Total</td>'

						+ '<td></td>'

						+ '<td>' + money_format_india(total_pieces) + '</td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

					'</tr>';

					$('#other_inventory_report > tbody').html(trHTML);

					// Check and initialise datatable

					if (!$.fn.DataTable.isDataTable('#other_inventory_report')) {

						oTable = $('#other_inventory_report').dataTable({

							"bSort": false,

							"bInfo": true,

							"scrollX": '100%',

							"dom": 'lBfrtip',

							"columnDefs": [

								{

									targets: [6],

									className: 'dt-body-right'

								},

							],

							"buttons": [

								{

									extend: 'print',

									footer: true,

									title: '',

									messageTop: title,

									customize: function (win) {

										$(win.document.body).find('table')

											.addClass('compact')

											.css('font-size', '10px');

									},

								},

								{

									extend: 'excel',

									footer: true,

									title: "Branch Transfer Report - " + $("#dt_range").val(),

								}

							],

						});

					}

				}

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

$('#branch_transfer_type').on('change', function () {

	if (this.value == 0) {

		$('.branch_transfer').css("display", "block");

		$('.inventory').css("display", "none");

		$('.section').css("display", "block");

		$('.metal_filter').css("display", "block");

		$('.report').css("display", "block");

	}

	else if (this.value == 1) {

		$('.branch_transfer').css("display", "block");

		$('.inventory').css("display", "none");

		$('.section').css("display", "block");

		$('.metal_filter').css("display", "block");

		$('.report').css("display", "block");

	} else if (this.value == 2) {

		$('.branch_transfer').css("display", "block");

		$('.inventory').css("display", "none");

		$('.section').css("display", "block");

		$('.metal_filter').css("display", "block");

		$('.report').css("display", "none");

	}

	else if (this.value == 3) {

		$('.branch_transfer').css("display", "block");

		$('.inventory').css("display", "none");

		$('.section').css("display", "none");

		$('.metal_filter').css("display", "block");

		$('.report').css("display", "block");

	}

	else if (this.value == 4) {

		$('.branch_transfer').css("display", "block");

		$('.inventory').css("display", "none");

		$('.section').css("display", "none");

		$('.metal_filter').css("display", "block");

		$('.report').css("display", "block");

	}

	else if (this.value == 5) {

		$('.branch_transfer').css("display", "block");

		$('.inventory').css("display", "none");

		$('.section').css("display", "none");

		$('.metal_filter').css("display", "block");

		$('.report').css("display", "block");

	} else if (this.value == 6) {

		$('.branch_transfer').css("display", "none");

		$('.inventory').css("display", "block");

		$('.section').css("display", "none");

		$('.metal_filter').css("display", "none");

		$('.report').css("display", "none");

	}

});

$('#stock_type').on('change', function () {

	$('.karigar').css("display", "none");

	if (this.value == 1) {

		$('.karigar').css("display", "block");

	} else if (this.value == 2 || this.value == 3 || this.value == 0) {

		$('.karigar').css("display", "none");

	}

	set_old_metal_table();

});

$('#oldmetal_report_type').on('change', function () {

	$('.detailed_report').css("display", "none");

	$('.summary_report').css("display", "none");

	if (this.value == 2) {

		$('.detailed_report').css("display", "block");

	} else if (this.value == 1) {

		$('.summary_report').css("display", "block");

	}

	set_old_metal_table();

});

function set_old_metal_table() {

	var dt_range = ($("#dt_range").val()).split('-');

	var company_name = $('#company_name').val();

	var from_date = dt_range[0];

	var to_date = dt_range[1];

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "PURCHASE AND EXCHANGE"

	var metal = $('#metal option:selected').html() != '' && $('#metal option:selected ').html() != undefined ? $('#metal option:selected').html() + " - " : '';

	var oldmetal_report_type = $('#oldmetal_report_type option:selected').html() != '' && $('#oldmetal_report_type option:selected ').html() != undefined ? $('#oldmetal_report_type option:selected').html() + " - " : '';

	var optional = oldmetal_report_type + metal;

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/old_metal_purchase/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'metal': $("#metal").val(), 'dt_range': $("#dt_range").val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'report_type': $('#oldmetal_report_type').val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.list.item_details;

			if ($('#oldmetal_report_type').val() == 2) {

				$("#old_metal_report > tbody > tr").remove();

				$('#old_metal_report').dataTable().fnClearTable();

				$('#old_metal_report').dataTable().fnDestroy();

				if (list != null) {

					var return_details = data.list.return_details;

					var partly_sale_det = data.list.partly_sale_det;

					trHTML = '';

					tfootHTML = '';

					var total_gross_wt = 0;

					var total_stone_wt = 0;

					var total_dia_wt = 0;

					var total_dust_wt = 0;

					var total_pure_wt = 0;

					var total_wast_wt = 0;

					var total_net_wt = 0;

					var total_rate = 0;

					var sales_ret_gwt = 0;

					var sales_ret_nwt = 0;

					var partly_sale_gwt = 0;

					var partly_sale_nwt = 0;

					var tot_refund_amt = 0;

					//Sales Return

					//Partly sale

					//Old Metal Purchase

					$.each(list, function (i, category) {

						trHTML += '<tr style="font-weight:bold;">' +

							'<td style="text-align: left; text-transform:uppercase;">' + i + '</td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'</tr>';

						var gross_wt = 0;

						var stone_wt = 0;

						var dia_wt = 0;

						var dust_wt = 0;

						var pure_wt = 0;

						var wast_wt = 0;

						var net_wt = 0;

						var rate = 0;

						var purity_per = 0;

						$.each(category, function (idx, bill_no) {

							trHTML += '<tr style="font-weight:bold;">' +

								'<td style="text-align: left; text-transform:uppercase;">' + idx + '</td>' +

								'<td></td>' +

								'<td></td>' +

								'<td></td>' +

								'<td></td>' +

								'<td></td>' +

								'<td></td>' +

								'<td></td>' +

								'<td></td>' +

								'<td></td>' +

								'<td></td>' +

								'<td></td>' +

								'<td></td>' +

								'<td></td>' +

								'<td></td>' +

								'<td></td>' +

								'<td></td>' +

								'<td></td>' +

								'<td></td>' +

								'<td></td>' +

								'<td></td>' +

								'<td></td>' +

								'<td></td>' +

								'<td></td>' +

								'<td></td>' +

								'</tr>';

							var refund_amt = (bill_no[0]['refund_amt'] * -1);

							tot_refund_amt += (bill_no[0]['refund_amt'] * -1);

							$.each(bill_no, function (bill, item) {

								var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + item.bill_id;

								if (item.goldrate_24ct > 0) {

									purity_per = parseFloat((item.rate / item.gross_wt) / item.goldrate_24ct).toFixed(2);

								}

								trHTML += '<tr>' +

									'<td>' + item.branch + '</td>' +

									'<td>' + item.bill_date + '</td>' +

									'<td><a href=' + url + ' target="_blank">' + item.bill_no + '</a></td>' +

									'<td>' + item.customer + '</td>' +

									'<td>' + item.cus_address + '</td>' +

									'<td>' + item.state_name + '</td>' +

									'<td>' + item.gst_number + '</td>' +

									'<td>' + item.mobile + '</td>' +
									'<td>' + (item.old_metal_category == null ? '' : item.old_metal_category)+ '</td>' +
									'<td>' + item.gross_wt + '</td>' +

									'<td>' + item.stone_wt + '</td>' +

									'<td>' + item.sttotwt + '</td>' +

									'<td>' + item.dust_wt + '</td>' +

									'<td>' + item.pure_wt + '</td>' +

									'<td>' + item.wast_wt + '</td>' +

									'<td>' + item.net_wt + '</td>' +

									'<td>' + item.touch + '</td>' +

									'<td>' + item.purity + '</td>' +

									'<td>' + money_format_india(item.rate_per_grm) + '</td>' +

									'<td>' + money_format_india(item.rate) + '</td>' +

									'<td>' + money_format_india(parseFloat(refund_amt).toFixed(2)) + '</td>' +

									'<td>' + item.old_metal_status + '</td>' +

									'<td>' + item.customer + '</td>' +

									'<td>' + item.esti_no + '</td>' +

									'<td>' + item.emp_name + '</td>' +

									'</tr>';

								refund_amt = 0;

								gross_wt = parseFloat(gross_wt) + parseFloat(item.gross_wt);

								stone_wt = parseFloat(stone_wt) + parseFloat(item.stone_wt);

								dia_wt = parseFloat(dia_wt) + parseFloat(item.sttotwt);

								dust_wt = parseFloat(dust_wt) + parseFloat(item.dust_wt);

								pure_wt = parseFloat(pure_wt) + parseFloat(item.pure_wt);

								wast_wt = parseFloat(wast_wt) + parseFloat(item.wast_wt);

								net_wt = parseFloat(net_wt) + parseFloat(item.net_wt);

								rate = parseFloat(rate) + parseFloat(item.rate);

							});

						});

						/*trHTML += '<tr>' +

									   '<td>Sub Total</td>' +

									   '<td>' + parseFloat(gross_wt).toFixed(3); + '</td>' +

									   '<td>' + parseFloat(stone_wt).toFixed(3) + '</td>' +

									   '<td>' + parseFloat(dust_wt).toFixed(3) + '</td>' +

									   '<td>' + parseFloat(pure_wt).toFixed(3) + '</td>' +

									   '<td>' + parseFloat(wast_wt).toFixed(3) + '</td>' +

									   '<td>' + parseFloat(net_wt).toFixed(3) + '</td>' +

									   '<td></td>' +

									   '<td></td>' +

									   '<td>' + rate + '</td>' +

									   '<td></td>' +

									   '<td></td>' +

									   '</tr>';*/

						total_gross_wt = total_gross_wt + gross_wt;

						total_stone_wt = total_stone_wt + stone_wt;

						total_dia_wt = total_dia_wt + dia_wt;

						total_dust_wt = total_dust_wt + dust_wt;

						total_pure_wt = total_pure_wt + pure_wt;

						total_wast_wt = total_wast_wt + wast_wt;

						total_net_wt = total_net_wt + net_wt;

						total_rate = total_rate + rate;

					});

					trHTML += '<tr style="font-weight:bold;color:blue">' +

						'<td>Grand Total</td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td>' + money_format_india(parseFloat(total_gross_wt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(total_stone_wt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(total_dia_wt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(total_dust_wt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(total_pure_wt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(total_wast_wt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(total_net_wt).toFixed(3)) + '</td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td>' + money_format_india(total_rate) + '</th>' +

						'<td>' + money_format_india(parseFloat(tot_refund_amt).toFixed(2)) + '</td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'</tr>';

					//Old Metal Purchase

					$('#old_metal_report > tbody').html(trHTML);

					// Check and initialise datatable

					if (!$.fn.DataTable.isDataTable('#old_metal_report')) {

						oTable = $('#old_metal_report').dataTable({

							"bSort": false,

							"bInfo": true,

							"scrollX": '100%',

							"dom": 'lBfrtip',

							"lengthMenu": [[-1, 25, 50, 100, 250], ["All", 25, 50, 100, 250]],

							"columnDefs": [

								{

									targets: [9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22],

									className: 'dt-body-right'

								},

								{

									targets: [0, 1, 2, 3, 4, 5, 6, 7, 8],

									className: 'dt-body-left'

								},

							],

							"buttons": [

								{

									extend: 'print',

									footer: true,

									title: '',

									messageTop: title,

									customize: function (win) {

										$(win.document.body).find('table')

											.addClass('compact')

											.css('font-size', '10px');

									},

									exportOptions: {

										columns: ':visible',

										stripHtml: false

									},

								},

								{

									extend: 'colvis',

									collectionLayout: 'fixed columns',

									collectionTitle: 'Column visibility control'

								},

								{

									extend: 'excel',

									footer: true,

									title: 'Old Metal Purchase Report',

								}

							],

						});

					}

				}

			} else if ($('#oldmetal_report_type').val() == 1) {

				var oTable = $('#old_metal_detailed_report').DataTable();

				oTable.clear().draw();

				if (data.list != null && data.list.length > 0) {

					oTable = $('#old_metal_detailed_report').dataTable({

						"bDestroy": true,

						"bInfo": true,

						"bFilter": true,

						"bSort": true,

						"order": [[0, "asc"]],

						"dom": 'lBfrtip',

						"columnDefs": [

							{

								targets: [3, 4, 5, 6],

								className: 'dt-body-right'

							},

						],

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: "Old Metal Purchase Report",

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', 'inherit');

								},

								exportOptions: {

									columns: ':visible',

									stripHtml: false

								},

							},

							{

								extend: 'colvis',

								collectionLayout: 'fixed columns',

								collectionTitle: 'Column visibility control'

							},

							{

								extend: 'excel',

								footer: true,

								title: "Old Metal Purchase Report",

							}

						],

						"aaData": data.list,

						"aoColumns": [

							{ "mDataProp": "bill_date" },

							{ "mDataProp": "branch_name" },

							{ "mDataProp": "old_metal_category" },

							{

								"mDataProp": function (row, type, val, meta) {

									var total_gross_wt = row.total_gross_wt;

									return money_format_india(total_gross_wt);

								}

							},

							{

								"mDataProp": function (row, type, val, meta) {

									var total_net_wt = row.total_net_wt;

									return money_format_india(total_net_wt);

								}

							},

							{

								"mDataProp": function (row, type, val, meta) {

									var sttotwt = row.sttotwt;

									return money_format_india(sttotwt);

								}

							},

							{

								"mDataProp": function (row, type, val, meta) {

									var total_amount = row.total_amount;

									return money_format_india(total_amount);

								}

							},

						],

						"footerCallback": function (row, data, start, end, display) {

							if (data.length > 0) {

								var api = this.api(), data;

								for (var i = 0; i <= data.length - 1; i++) {

									var intVal = function (i) {

										return typeof i === 'string' ?

											i.replace(/[\$,]/g, '') * 1 :

											typeof i === 'number' ?

												i : 0;

									};

									$(api.column(0).footer()).html('Total');

									gross_wgt = api

										.column(3)

										.data()

										.reduce(function (a, b) {

											return intVal(a) + intVal(b);

										}, 0);

									$(api.column(3).footer()).html(money_format_india(parseFloat(gross_wgt).toFixed(3)));

									net_wgt = api

										.column(4)

										.data()

										.reduce(function (a, b) {

											return intVal(a) + intVal(b);

										}, 0);

									$(api.column(4).footer()).html(parseFloat(net_wgt).toFixed(3));

									total_dia = api

										.column(5)

										.data()

										.reduce(function (a, b) {

											return intVal(a) + intVal(b);

										}, 0);

									$(api.column(5).footer()).html(parseFloat(total_dia).toFixed(3));

									total_amount = api

										.column(6)

										.data()

										.reduce(function (a, b) {

											return intVal(a) + intVal(b);

										}, 0);

									$(api.column(6).footer()).html(parseFloat(total_amount).toFixed(2));

								}

							} else {

								var api = this.api(), data;

								$(api.column(3).footer()).html('');

								$(api.column(3).footer()).html('');

								$(api.column(5).footer()).html('');

							}

						}

					});

				}

			}

		}

	});

}

//credit issued

function set_credit_issued_table() {

	var report_type = ($('#report_type').val() == 1 ? 'CREDIT ISSUED REPORT' : 'CREDIT RECEIVED REPORT');

	var dt_range = ($("#dt_range").val()).split('-');

	var company_name = $('#company_name').val();

	var from_date = dt_range[0];

	var to_date = dt_range[1];

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = report_type;

	var optional = '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$("div.overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/credit_issued/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'dt_range': $("#dt_range").val(), 'report_type': $('#report_type').val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()) }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			$('#credit_issue_details').css('display', 'block');

			$('#credit_received_details').css('display', 'none');

			$("#credit_issued_list > tbody > tr").remove();

			$('#credit_issued_list').dataTable().fnClearTable();

			$('#credit_issued_list').dataTable().fnDestroy();

			$("#credit_received_list > tbody > tr").remove();

			$('#credit_received_list').dataTable().fnClearTable();

			$('#credit_received_list').dataTable().fnDestroy();

			if ($('#report_type').val() == 1) {

				if (list != null && list != 0) {

					trHTML = '';

					tfootHTML = '';

					total_bill_amount = 0;

					total_paid_amount = 0;

					total_bal_amount = 0;

					$.each(list, function (i, branch) {

						var bill_amount = 0;

						var paid_amount = 0;

						var bal_amount = 0;

						$.each(branch, function (idx, item) {

							trHTML += '<tr>'

								+ '<td>' + item.cus_name + '</td>'

								+ '<td>' + item.mobile + '</td>'

								+ '<td>' + item.bill_no + '</td>'

								+ '<td>' + item.bill_date + '</td>'

								+ '<td>' + item.credit_due_date + '</td>'

								+ '<td>' + money_format_india(item.tot_bill_amount) + '</td>'

								+ '<td>' + money_format_india(item.tot_amt_received) + '</td>'

								+ '<td>' + money_format_india(item.credit_ret_amt) + '</td>'

								+ '<td>' + money_format_india(item.due_amt) + '</td>'

							'</tr>';

							bill_amount = parseFloat(bill_amount) + parseFloat(item.tot_bill_amount);

							paid_amount = parseFloat(paid_amount) + parseFloat(item.tot_amt_received);

							bal_amount = parseFloat(bal_amount) + parseFloat(item.due_amt);

						});

						trHTML += '<tr style="font-weight:bold;color:red">' +

							+'<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td>Sub Total</td>'

							+ '<td>' + money_format_india(bill_amount) + '</td>'

							+ '<td>' + money_format_india(paid_amount) + '</td>'

							+ '<td></td>'

							+ '<td>' + money_format_india(bal_amount) + '</td>'

						'</tr>';

						total_bill_amount = total_bill_amount + bill_amount;

						total_paid_amount = total_paid_amount + paid_amount;

						total_bal_amount = total_bal_amount + bal_amount;

					});

					trHTML += '<tr style="font-weight:bold; color: blue">'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td>Grand Total</td>'

						+ '<td>' + money_format_india(total_bill_amount) + '</td>'

						+ '<td>' + money_format_india(total_paid_amount) + '</td>'

						+ '<td></td>'

						+ '<td>' + money_format_india(total_bal_amount) + '</td>'

					'</tr>';

					$('#credit_issued_list > tbody').html(trHTML);

					// Check and initialise datatable

					if (!$.fn.DataTable.isDataTable('#credit_issued_list')) {

						oTable = $('#credit_issued_list').dataTable({

							"bSort": false,

							"bInfo": true,

							"scrollX": '100%',

							"dom": 'lBfrtip',

							"columnDefs": [

								{

									targets: [5, 6, 7, 8],

									className: 'dt-body-right'

								},

							],

							"buttons": [

								{

									extend: 'print',

									footer: true,

									title: '',

									messageTop: title,

									customize: function (win) {

										$(win.document.body).find('table')

											.addClass('compact')

											.css('font-size', '10px');

									},

								},

								{

									extend: 'excel',

									footer: true,

									title: company_name + '-' + (branch_name != '' ? branch_name : '') + ' - ' + report_type + ' ' + dt_range[0] + '-' + dt_range[1],

								}

							],

						});

					}

				}

			}

			else {

				if (list != null && list != 0) {

					$('#credit_received_details').css('display', 'block');

					$('#credit_issue_details').css('display', 'none');

					var oTable = $('#credit_received_list').DataTable();

					oTable.clear().draw();

					oTable = $('#credit_received_list').dataTable({

						"bDestroy": true,

						"bInfo": true,

						"bFilter": true,

						"order": [[0, "desc"]],

						"scrollX": '100%',

						"bSort": true,

						"dom": 'lBfrtip',

						"columnDefs": [

							{

								targets: [4],

								className: 'dt-body-right'

							},

						],

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: '',

								messageTop: title,

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', 'inherit');

								},

							},

							{

								extend: 'excel',

								footer: true,

								title: company_name + '-' + (branch_name != '' ? branch_name : '') + ' - ' + report_type + ' ' + dt_range[0] + '-' + dt_range[1],

							}

						],

						"aaData": list,

						"aoColumns": [

							{ "mDataProp": "cus_name" },

							{ "mDataProp": "mobile" },

							{ "mDataProp": "bill_date" },

							{ "mDataProp": "bill_no" },

							{

								"mDataProp": function (row, type, val, meta) {

									var tot_amt_received = row.tot_amt_received;

									return money_format_india(tot_amt_received);

								}

							},

						],

						"footerCallback": function (row, data, start, end, display) {

							if (data.length > 0) {

								var api = this.api(), data;

								for (var i = 0; i <= data.length - 1; i++) {

									var intVal = function (i) {

										return typeof i === 'string' ?

											i.replace(/[\$,]/g, '') * 1 :

											typeof i === 'number' ?

												i : 0;

									};

									$(api.column(0).footer()).html('Total');

									gross_wgt = api

										.column(4)

										.data()

										.reduce(function (a, b) {

											return intVal(a) + intVal(b);

										}, 0);

									$(api.column(4).footer()).html(money_format_india(parseFloat(gross_wgt).toFixed(2)));

								}

							} else {

								var api = this.api(), data;

								$(api.column(4).footer()).html('');

							}

						}

					});

				}

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//credit issued

//credit history

function get_ActiveCustomer() {

	$('.overlay').css('display', 'block');

	$.ajax({

		type: 'GET',

		url: base_url + 'index.php/admin_ret_reports/get_bill_customer',

		dataType: 'json',

		success: function (data) {

			var id_village = '';

			$.each(data, function (key, data) {

				$('#select_customer').append(

					$("<option></option>")

						.attr("value", data.id_customer)

						.text(data.mobile + '-' + data.cus_name)

				);

				$('#select_customer').select2({

					placeholder: "Select Customer",

					allowClear: true

				});

				$("#select_customer").select2("val", (id_village != null ? id_village : ''));

			});

			$('.overlay').css('display', 'none');

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function set_credit_history_table() {

	var dt_range = ($("#dt_range").val()).split('-');

	var company_name = $('#company_name').val();

	var from_date = dt_range[0];

	var to_date = dt_range[1];

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "CREDIT SALES HISTORY REPORT";

	var select_customer = $('#select_customer option:selected').html() != '' && $('#select_customer option:selected').html() != undefined ? $('#select_customer option:selected').html() + ' - ' : '';

	var optional = select_customer;

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	var report_type = 'CREDIT HISTORY REPORT';

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/credit_history/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'id_customer': $('#select_customer').val(), 'dt_range': $("#dt_range").val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()) }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			$("#credit_issued_list > tbody > tr").remove();

			$('#credit_issued_list').dataTable().fnClearTable();

			$('#credit_issued_list').dataTable().fnDestroy();

			if (list != null && list != '') {

				trHTML = '';

				tfootHTML = '';

				total_bill_amount = 0;

				total_paid_amount = 0;

				total_bal_amount = 0;

				total_credit_disc_amt = 0;

				total_credit_ret_amt = 0;

				total_old_metal_amount = 0;

				$.each(list, function (i, branch) {

					var bill_amount = 0;

					var paid_amount = 0;

					var credit_ret_amt = 0;

					var bal_amount = 0;

					var bill_bal_amt = 0;

					var credit_disc_amt = 0;

					var old_metal_amount = 0;

					$.each(branch, function (idx, item) {

						if (item.type == 0) {

							var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + item.bill_id;

						} else {

							var url = base_url + 'index.php/admin_ret_billing/issue/issue_print/' + item.bill_id;

						}

						trHTML += '<tr>' +

							'<td>' + item.branch_name + '</td>'

							+ '<td>' + item.cus_name + '</td>'

							+ '<td>' + item.mobile + '</td>'

							+ '<td><a href=' + url + ' target="_blank">' + item.bill_no + '</a></td>'

							+ '<td>' + item.bill_date + '</td>'

							+ '<td>' + money_format_india(parseFloat(item.tot_bill_amount).toFixed(2)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(item.tot_amt_received).toFixed(2)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(item.credit_disc_amt).toFixed(2)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(item.credit_ret_amt).toFixed(2)) + '</td>'

							+ '<td></td>'

							+ '<td>' + money_format_india(parseFloat(item.bal_amt).toFixed(2)) + '</td>'

						'</tr>';

						bill_amount = parseFloat(bill_amount) + parseFloat(item.tot_bill_amount);

						paid_amount = parseFloat(paid_amount) + parseFloat(item.tot_amt_received);

						credit_ret_amt = parseFloat(credit_ret_amt) + parseFloat(item.credit_ret_amt);

						bill_bal_amt = parseFloat(item.bal_amt);

						if ((item.credit_collection).length > 0) {

							$.each(item.credit_collection, function (key, value) {

								var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + value.bill_id;

								bill_bal_amt = parseFloat(bill_bal_amt) - parseFloat(value.tot_amt_received) - parseFloat(value.credit_disc_amt) - parseFloat(value.old_metal_amount);

								credit_disc_amt += parseFloat(value.credit_disc_amt);

								old_metal_amount += parseFloat(value.old_metal_amount);

								if (item.type == 0) {

									var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + value.bill_id;

								} else {

									var url = base_url + 'index.php/admin_ret_billing/receipt/receipt_print/' + value.bill_id;

								}

								trHTML += '<tr>' +

									+'<td></td>'

									+ '<td></td>'

									+ '<td></td>'

									+ '<td></td>'

									+ '<td><a href=' + url + ' target="_blank">' + value.bill_no + '</a></td>'

									+ '<td>' + value.bill_date + '</td>'

									+ '<td>' + (parseFloat(value.tot_bill_amount) + parseFloat(value.credit_disc_amt)).toFixed(2) + '</td>'

									+ '<td>' + money_format_india(parseFloat(value.tot_amt_received).toFixed(2)) + '</td>'

									+ '<td>' + money_format_india(parseFloat(value.credit_disc_amt).toFixed(2)) + '</td>'

									+ '<td></td>'

									+ '<td>' + money_format_india(parseFloat(value.old_metal_amount).toFixed(2)) + '</td>'

									+ '<td>' + money_format_india(parseFloat(bill_bal_amt).toFixed(2)) + '</td>'

								'</tr>';

								paid_amount = parseFloat(paid_amount) + parseFloat(value.tot_amt_received);

							});

						}

					});

					trHTML += '<tr style="font-weight:bold;color:red">' +

						'<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td>Sub Total</td>'

						+ '<td>' + money_format_india(bill_amount) + '</td>'

						+ '<td>' + money_format_india(paid_amount) + '</td>'

						+ '<td>' + money_format_india(credit_disc_amt) + '</td>'

						+ '<td></td>'

						+ '<td>' + money_format_india(old_metal_amount) + '</td>'

						+ '<td>' + money_format_india(parseFloat(parseFloat(paid_amount) - parseFloat(credit_ret_amt) - parseFloat(credit_disc_amt) - parseFloat(old_metal_amount)).toFixed(2)); +'</td>'

							+ '<td></td>'

					'</tr>';

					total_bill_amount = total_bill_amount + bill_amount;

					total_paid_amount = total_paid_amount + paid_amount;

					total_bal_amount = total_bal_amount + (parseFloat(paid_amount) - parseFloat(credit_ret_amt) - parseFloat(credit_disc_amt) - parseFloat(old_metal_amount));

					total_credit_disc_amt = total_credit_disc_amt + credit_disc_amt;

					total_credit_ret_amt = total_credit_ret_amt + credit_ret_amt;

					total_old_metal_amount = total_old_metal_amount + old_metal_amount;

				});

				trHTML += '<tr style="font-weight:bold;color:blue">' +

					'<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td>Grand Total</td>'

					+ '<td>' + money_format_india(total_bill_amount) + '</td>'

					+ '<td>' + money_format_india(total_paid_amount) + '</td>'

					+ '<td>' + money_format_india(total_credit_disc_amt) + '</td>'

					+ '<td></td>'

					+ '<td>' + money_format_india(total_old_metal_amount) + '</td>'

					+ '<td>' + money_format_india(total_bal_amount) + '</td>'

					+ '<td></td>'

				'</tr>';

				$('#credit_issued_list > tbody').html(trHTML);

				// Check and initialise datatable

				if (!$.fn.DataTable.isDataTable('#credit_issued_list')) {

					oTable = $('#credit_issued_list').dataTable({

						"bSort": false,

						"bInfo": true,

						"scrollX": '100%',

						"dom": 'lBfrtip',

						"paging": false,

						"columnDefs": [

							{

								targets: [5, 6, 7, 8, 9, 10],

								className: 'dt-body-right'

							},

						],

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: '',

								messageTop: title,

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', '10px');

								},

							},

							{

								extend: 'excel',

								footer: true,

								title: company_name + '-' + (branch_name != '' ? branch_name : '') + ' - ' + report_type + ' ' + dt_range[0] + '-' + dt_range[1],

							}

						],

					});

				}

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//credit history

function set_advance_history_table() {

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/advance_history/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'dt_range': $("#dt_range").val(), 'id_branch': $("#branch_select").val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			if (list != null) {

				trHTML = '';

				tfootHTML = '';

				total_adv_amount = 0;

				total_adjusted_amount = 0;

				$.each(list, function (i, branch) {

					var adv_amount = 0;

					var adjusted_amt = 0;

					$.each(branch, function (idx, item) {

						trHTML += '<tr>' +

							'<td>' + item.branch_name + '</td>'

							+ '<td>' + item.cus_name + '</td>'

							+ '<td>' + item.mobile + '</td>'

							+ '<td>' + item.total_adv_amount + '</td>'

							+ '<td>' + item.adjusted_amt + '</td>'

						'</tr>';

						adv_amount = parseFloat(adv_amount) + parseFloat(item.total_adv_amount);

						adjusted_amt = parseFloat(adjusted_amt) + parseFloat(item.adjusted_amt);

					});

					trHTML += '<tr style="font-weight:bold;">' +

						+'<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td>Sub Total</td>'

						+ '<td>' + adv_amount + '</td>'

						+ '<td>' + adjusted_amt + '</td>'

					'</tr>';

					total_adv_amount = total_adv_amount + adv_amount;

					total_adjusted_amount = total_adjusted_amount + adjusted_amt;

				});

				trHTML += '<tr style="font-weight:bold;">' +

					+'<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td>Grand Total</td>'

					+ '<td>' + total_adv_amount + '</td>'

					+ '<td>' + total_adjusted_amount + '</td>'

				'</tr>';

				$('#advance_list > tbody').html(trHTML);

				// Check and initialise datatable

				if (!$.fn.DataTable.isDataTable('#advance_list')) {

					oTable = $('#advance_list').dataTable({

						"bSort": false,

						"bInfo": true,

						"scrollX": '100%',

						"dom": 'lBfrtip',

						"paging": false,

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: "Advance History Report - " + $("#dt_range").val(),

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', 'inherit');

								},

							},

							{

								extend: 'excel',

								footer: true,

								title: "Advance History Report - " + $("#dt_range").val(),

							}

						],

					});

				}

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function set_chit_closing_table() {

	var dt_range = ($("#dt_range").val()).split('-');

	var company_name = $('#company_name').val();

	var from_date = dt_range[0];

	var to_date = dt_range[1];

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "Chit Closing Report"

	var optional = '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/chit_closing_details/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'dt_range': $("#dt_range").val(), 'id_branch': $("#branch_select").val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			$("#chit_closing_list > tbody > tr").remove();

			$('#chit_closing_list').dataTable().fnClearTable();

			$('#chit_closing_list').dataTable().fnDestroy();

			if (list != null && list.length > 0) {

				trHTML = '';

				tfootHTML = '';

				total_bill_amount = 0;

				total_closing_amount = 0;

				total_sch_benefits = 0;

				total_add_sch_benefits = 0;

				var bill_amount = 0;

				var closing_amt = 0;

				var sch_benefits = 0;

				var add_benefits = 0;

				$.each(list, function (i, item) {

					var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + item.bill_id;

					var chit_url = base_url + 'index.php/reports/payment/account/' + item.scheme_account_id;

					trHTML += '<tr>'

						+ '<td>' + item.bill_date + '</td>'

						+ '<td><a href=' + url + ' target="_blank">' + item.bill_no + '</a></td>'

						+ '<td>' + item.cus_name + '</td>'

						+ '<td>' + item.mobile + '</td>'

						+ '<td>' + item.scheme_name + '</td>'

						+ '<td><a href=' + chit_url + ' target="_blank">' + item.scheme_acc_number + '</a></td>'

						+ '<td>' + item.paid_installments + '/' + item.total_installments + '</td>'

						+ '<td>' + money_format_india(parseFloat(item.closing_amount).toFixed(2)) + '</td>'

						+ '<td>' + parseFloat(item.benifits).toFixed(2) + '</td>'

						+ '<td>' + parseFloat(item.additional_bennefits).toFixed(2) + '</td>'

						+ '<td>' + item.closing_add_chgs + '</td>'

						+ '<td><a href=' + chit_url + ' target="_blank">' + item.scheme_account_id + '</a></td>'

					'</tr>';

					bill_amount = parseFloat(bill_amount) + parseFloat(item.tot_bill_amount);

					closing_amt = parseFloat(closing_amt) + parseFloat(item.closing_amount);

					sch_benefits = parseFloat(sch_benefits) + parseFloat(item.benifits);

					add_benefits = parseFloat(add_benefits) + parseFloat(item.additional_bennefits);

				});

				total_closing_amount = total_closing_amount + closing_amt;

				total_sch_benefits = total_sch_benefits + sch_benefits;

				total_add_sch_benefits = total_add_sch_benefits + add_benefits;

				trHTML += '<tr style="font-weight:bold;color:blue">' +

					+'<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td>Grand Total</td>'

					+ '<td>' + money_format_india(parseFloat(total_closing_amount).toFixed(2)) + '</td>'

					+ '<td>' + money_format_india(parseFloat(total_sch_benefits).toFixed(2)) + '</td>'

					+ '<td>' + money_format_india(parseFloat(total_add_sch_benefits).toFixed(2)) + '</td>'

					+ '<td></td>'

					+ '<td></td>'

				'</tr>';

				$('#chit_closing_list > tbody').html(trHTML);

				// Check and initialise datatable

				if (!$.fn.DataTable.isDataTable('#chit_closing_list')) {

					oTable = $('#chit_closing_list').dataTable({

						"bSort": false,

						"bInfo": true,

						"scrollX": '100%',

						"dom": 'lBfrtip',

						"paging": false,

						"columnDefs": [

							{

								targets: [0, 1, 2],

								className: 'dt-body-left'

							},

							{

								targets: [7, 8, 9],

								className: 'dt-body-right'

							},

						],

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: '',

								messageTop: title,

								customize: function (win) {

									$(win.document.body)

										.css('font-size', '12pt');

								},

							},

							{

								extend: 'excel',

								footer: true,

								title: "Chit Clsoing Report - " + $("#dt_range").val(),

							}

						],

					});

				}

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//chit closing

/*

function set_chit_closing_table()

{

	var dt_range = ($("#dt_range").val()).split('-');

	var company_name = $('#company_name').val();

	var from_date = dt_range[0];

	var to_date = dt_range[1];

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "Chit Closing Report"

	var optional = '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

			 url:base_url+ "index.php/admin_ret_reports/chit_closing_details/ajax?nocache=" + my_Date.getUTCSeconds(),

			 data: ( {'dt_range' :$("#dt_range").val(),'id_branch':$("#branch_select").val()}),

			 dataType:"JSON",

			 type:"POST",

			 success:function(data){

				  var list = data.list;

				$("#chit_closing_list > tbody > tr").remove();

					$('#chit_closing_list').dataTable().fnClearTable();

				$('#chit_closing_list').dataTable().fnDestroy();

				if (list!= null && list.length>0)

				{

					trHTML = '';

					tfootHTML = '';

					total_bill_amount=0;

					total_closing_amount=0;

					total_sch_benefits=0;

					total_add_sch_benefits =0;

						var bill_amount=0;

							var closing_amt=0;

							var sch_benefits=0;

							var add_benefits=0;

					$.each(list, function (i, item) {

							var url = base_url+'index.php/admin_ret_billing/billing_invoice/'+item.bill_id;

							var chit_url = base_url+'index.php/reports/payment/account/'+item.scheme_account_id;

								trHTML += '<tr>'

												+'<td>'+item.bill_date+'</td>'

												+'<td><a href='+url+' target="_blank">'+item.bill_no+'</a></td>'

												+'<td>'+item.cus_name+'</td>'

												+'<td>'+item.mobile+'</td>'

												+'<td>'+item.scheme_name+'</td>'

												+'<td><a href='+chit_url+' target="_blank">'+item.scheme_acc_number+'</a></td>'

												+'<td>'+item.paid_installments+'/'+item.total_installments+'</td>'

												+'<td>'+money_format_india(parseFloat(item.closing_amount).toFixed(2))+'</td>'

												+'<td>'+parseFloat(item.benifits).toFixed(2)+'</td>'

												+'<td>'+parseFloat(item.additional_bennefits).toFixed(2)+'</td>'

												+'<td>'+item.closing_add_chgs+'</td>'

												+'<td><a href='+chit_url+' target="_blank">'+item.scheme_account_id+'</a></td>'

										   '</tr>';

								bill_amount   = parseFloat(bill_amount) + parseFloat(item.tot_bill_amount);

								closing_amt = parseFloat(closing_amt) + parseFloat(item.closing_amount);

								sch_benefits = parseFloat(sch_benefits) + parseFloat(item.sch_benefits);

								add_benefits = parseFloat(add_benefits) + parseFloat(item.additional_bennefits);

						});

						 total_closing_amount=total_closing_amount+closing_amt;

						 total_sch_benefits=total_sch_benefits+sch_benefits;

						 total_add_sch_benefits=total_add_sch_benefits+add_benefits;

					trHTML += '<tr style="font-weight:bold;color:blue">' +

									+'<td></td>'

									+'<td></td>'

									+'<td></td>'

									+'<td></td>'

									+'<td></td>'

									+'<td></td>'

									+'<td></td>'

									+'<td>Grand Total</td>'

									+'<td>'+money_format_india(parseFloat(total_closing_amount).toFixed(2))+'</td>'

									+'<td>'+money_format_india(parseFloat(total_sch_benefits).toFixed(2))+'</td>'

									+'<td>'+money_format_india(parseFloat(total_add_sch_benefits).toFixed(2))+'</td>'

									+'<td></td>'

									+'<td></td>'

							 '</tr>';

					$('#chit_closing_list > tbody').html(trHTML);

					 // Check and initialise datatable

					if ( ! $.fn.DataTable.isDataTable( '#chit_closing_list' ) ) {

						oTable = $('#chit_closing_list').dataTable({

						"bSort": false,

						"bInfo": true,

						"scrollX":'100%',

						"dom": 'lBfrtip',

						"paging":false,

						"columnDefs": [

							{

								targets: [0, 1, 2],

								className: 'dt-body-left'

							},

							{

								targets: [7,8,9],

								className: 'dt-body-right'

							},

						],

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: '',

								messageTop: title,

								customize: function (win) {

									$(win.document.body)

										.css('font-size', '12pt');

								},

							},

						{

							extend:'excel',

							footer: true,

							title: "Chit Clsoing Report - "+$("#dt_range").val(),

						}

						],

						});

					}

				}

				$("div.overlay").css("display", "none");

			  },

			  error:function(error)

			  {

				 $("div.overlay").css("display", "none");

			  }

		  });

} */

//chit closing

//Card Payment

function set_card_payment_table() {

	var company_name = $('#company_name').val();

	var from_date = $('#referencedate').val();

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "Card Payment Report"

	var optional = '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/card_payment/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'from_date': $('#referencedate').val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'report_tpe': $('#report_tpe').val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			$("#bill_wise_list > tbody > tr").remove();

			$('#bill_wise_list').dataTable().fnClearTable();

			$('#bill_wise_list').dataTable().fnDestroy();

			$("#date_wise_list > tbody > tr").remove();

			$('#date_wise_list').dataTable().fnClearTable();

			$('#date_wise_list').dataTable().fnDestroy();

			$('#date_wise_report').css('display', 'none');

			$('#bill_wise_report').css('display', 'block');

			$("#bill_wise_list > tbody > tr").remove();

			$("#date_wise_list > tbody > tr").remove();

			if (list != null) {

				trHTML = '';

				tfootHTML = '';

				total_debit_payment = 0;

				total_credit_payment = 0;

				total_net_payment = 0;

				$.each(list, function (i, title) {

					var debit_payment = 0;

					var credit_payment = 0;

					var net_payment = 0;

					trHTML += '<tr>' +

						'<td><strong>' + i + '</strong></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

					'</tr>';

					$.each(title, function (idx, item) {

						trHTML += '<tr>' +

							'<td>' + item.bill_date + '</td>'

							+ '<td>' + item.bill_no + '</td>'

							+ '<td>' + item.card_no + '</td>'

							+ '<td>' + item.payment_ref_number + '</td>'

							+ '<td>' + item.cus_name + '</td>'

							+ '<td>' + item.mobile + '</td>'

							+ '<td>' + money_format_india(item.crdit_payment) + '</td>'

							+ '<td>' + money_format_india(item.debit_payment) + '</td>'

							+ '<td>' + money_format_india(item.net_payment) + '</td>'

						'</tr>';

						credit_payment = parseFloat(credit_payment) + parseFloat(item.crdit_payment);

						debit_payment = parseFloat(debit_payment) + parseFloat(item.debit_payment);

						net_payment = parseFloat(net_payment) + parseFloat(item.net_payment);

					});

					trHTML += '<tr style="font-weight:bold;color:red">' +

						+'<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td>Sub Total</td>'

						+ '<td>' + money_format_india(credit_payment) + '</td>'

						+ '<td>' + money_format_india(debit_payment) + '</td>'

						+ '<td>' + money_format_india(net_payment) + '</td>'

						+ '<td></td>'

					'</tr>';

					total_credit_payment = total_credit_payment + credit_payment;

					total_debit_payment = total_debit_payment + debit_payment;

					total_net_payment = total_net_payment + net_payment;

				});

				trHTML += '<tr style="font-weight:bold;color:blue">' +

					+'<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td>Grand Total</td>'

					+ '<td>' + money_format_india(total_credit_payment) + '</td>'

					+ '<td>' + money_format_india(total_debit_payment) + '</td>'

					+ '<td>' + money_format_india(total_net_payment) + '</td>'

				'</tr>';

				$('#bill_wise_list > tbody').html(trHTML);

				// Check and initialise datatable

				if (!$.fn.DataTable.isDataTable('#bill_wise_list')) {

					oTable = $('#bill_wise_list').dataTable({

						"bSort": false,

						"bInfo": true,

						"scrollX": '100%',

						"dom": 'lBfrtip',

						"paging": false,

						"columnDefs": [

							{

								targets: [6, 7, 8],

								className: 'dt-body-right'

							},

							{

								targets: [0, 1, 2, 3, 4, 5],

								className: 'dt-body-left'

							},

						],

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: '',

								messageTop: title,

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', 'inherit');

								},

							},

							{

								extend: 'colvis',

								collectionLayout: 'fixed columns',

								collectionTitle: 'Column visibility control'

							},

							{

								extend: 'excel',

								footer: true,

								title: "Card Payment Bill Wise Report - " + $("#dt_range").val(),

							}

						],

					});

				}

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//Card Payment

//Duplicate bill

function set_copy_bill_table() {

	var dt_range = ($("#dt_range").val()).split('-');

	var company_name = $('#company_name').val();

	var from_date = dt_range[0];

	var to_date = dt_range[1];

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "DUPLICATE BILL REPORT";

	var optional = '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/copy_bill_details/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'dt_range': $("#dt_range").val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()) }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			$("#copy_bill_list > tbody > tr").remove();

			if (list != null) {

				trHTML = '';

				tfootHTML = '';

				$.each(list, function (i, branch) {

					$.each(branch, function (idx, item) {

						trHTML += '<tr>' +

							'<td>' + item.branch_name + '</td>'

							+ '<td>' + item.cus_name + '</td>'

							+ '<td>' + item.mobile + '</td>'

							+ '<td>' + item.bill_no + '</td>'

							+ '<td>' + item.bill_date + '</td>'

							+ '<td>' + money_format_india(item.tot_bill_amount) + '</td>'

							+ '<td>' + item.print_date + '</td>'

							+ '<td>' + item.emp_name + '</td>'

							+ '<td>' + item.total_copy + '</td>'

						'</tr>';

					});

					trHTML += '<tr style="font-weight:bold;">' +

						+'<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

					'</tr>';

				});

				$('#copy_bill_list > tbody').html(trHTML);

				// Check and initialise datatable

				if (!$.fn.DataTable.isDataTable('#copy_bill_list')) {

					oTable = $('#copy_bill_list').dataTable({

						"bSort": false,

						"bInfo": true,

						"scrollX": '100%',

						"dom": 'lBfrtip',

						"paging": false,

						"columnDefs": [

							{

								targets: [5],

								className: 'dt-body-right'

							},

						],

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: '',

								messageTop: title,

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', '10px');

								},

							},

							{

								extend: 'excel',

								footer: true,

								title: "DUPLICATE BILL REPORT - " + $("#dt_range").val(),

							}

						],

					});

				}

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//duplicate bill

//PAN Bill details

function set_pan_bill_table() {

	var dt_range = ($("#dt_range").val()).split('-');

	var company_name = $('#company_name').val();

	var from_date = dt_range[0];

	var to_date = dt_range[1];

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "PAN Bill Report";

	var optional = '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/pan_bill_details/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'dt_range': $("#dt_range").val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()) }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			$("#pan_bill_list > tbody > tr").remove();

			$('#pan_bill_list').dataTable().fnClearTable();

			$('#pan_bill_list').dataTable().fnDestroy();

			if (list != null) {

				trHTML = '';

				tfootHTML = '';

				$.each(list, function (i, branch) {

					$.each(branch, function (idx, item) {

						var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + item.bill_id;

						trHTML += '<tr>' +

							'<td>' + item.bill_date + '</td>'

							+ '<td><a href=' + url + ' target="_blank">' + item.bill_no + '</a></td>'

							+ '<td>' + item.cus_name + '</td>'

							+ '<td>' + item.mobile + '</td>'

							+ '<td>' + money_format_india(item.tot_bill_amount) + '</td>'

							+ '<td>' + item.pan_no + '</td>'

						'</tr>';

					});

					trHTML += '<tr style="font-weight:bold;">' +

						+'<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

					'</tr>';

				});

				$('#pan_bill_list > tbody').html(trHTML);

				// Check and initialise datatable

				if (!$.fn.DataTable.isDataTable('#pan_bill_list')) {

					oTable = $('#pan_bill_list').dataTable({

						"bSort": false,

						"bInfo": true,

						"scrollX": '100%',

						"dom": 'lBfrtip',

						"paging": false,

						"columnDefs": [

							{

								targets: [4],

								className: 'dt-body-right'

							},

						],

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: '',

								messageTop: title,

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', '10px');

								},

							},

							{

								extend: 'excel',

								footer: true,

								title: "PAN BILL REPORT - " + $("#dt_range").val(),

							}

						],

					});

				}

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//PAN Bill details

function get_category() {

	$("div.overlay").css("display", "block");

	$("#category option").remove();

	$.ajax({

		type: 'POST',

		url: base_url + 'index.php/admin_ret_reports/active_category',

		dataType: 'json',

		data: { 'id_metal': $('#metal').val() },

		success: function (data) {

			$("#category,#category_select").append(

				$("<option></option>")

					.attr("value", 0)

					.text('All')

			);

			$.each(data, function (key, item) {

				$('#category,#category_select').append(

					$("<option></option>")

						.attr("value", item.id_ret_category)

						.text(item.name)

				);

			});

			$("#category,#category_select").select2({

				placeholder: "Select Category",

				allowClear: true

			});

			if (ctrl_page[1] == 'categorywise_bt_report') {

				$('#branch_select').select2({

					placeholder: "To Centre",

					allowClear: true

				});

				$('#branch_select_to').select2({

					placeholder: "Cost Centre",

					allowClear: true

				});

				$('#selecttransitemtypes').select2({

					placeholder: "Trans Type",

					allowClear: true

				});

			} else if (ctrl_page[1] == 'categorywise_stock_report') {

				$('#selecttransitemtypes').select2({

					placeholder: "Trans Type",

					allowClear: true

				});

			} else if (ctrl_page[1] == 'gst_abstract_with_return') {

				$('#category').select2({

					placeholder: "Category",

					allowClear: true

				});

			}

		}

	});

	$("div.overlay").css("display", "none");

}

function get_oldmetalcategory() {

	$("div.overlay").css("display", "block");

	$("#category option").remove();

	$.ajax({

		type: 'POST',

		url: base_url + 'index.php/admin_ret_catalog/old_metal_cat/active_oldmetal',

		dataType: 'json',

		data: { 'id_metal': $('#metal').val() },

		success: function (data) {

			$("#oldcategory").append(

				$("<option></option>")

					.attr("value", 0)

					.text('All')

			);

			$.each(data, function (key, item) {

				$('#oldcategory').append(

					$("<option></option>")

						.attr("value", item.id_metal_type)

						.text(item.metal_type)

				);

			});

			$("#oldcategory").select2({

				placeholder: "Select Category",

				allowClear: true

			});

		}

	});

	$("div.overlay").css("display", "none");

}

// Cancelled Bills

function set_cancelledBills() {

	var dt_range = ($("#dt_range").val()).split('-');

	var company_name = $('#company_name').val();

	var from_date = dt_range[0];

	var to_date = dt_range[1];

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "Cancelled Bills Report"

	var optional = '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/cancelled_bills/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'dt_range': $("#dt_range").val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()) }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			$("#cancelled_bill_list > tbody > tr").remove();

			$('#cancelled_bill_list').dataTable().fnClearTable();

			$('#cancelled_bill_list').dataTable().fnDestroy();

			if (list != null) {

				trHTML = '';

				tfootHTML = '';

				total_bill_amount = 0;

				$.each(list, function (i, branch) {

					var bill_amount = 0;

					$.each(branch, function (idx, item) {

						var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + item.bill_id;

						trHTML += '<tr>'

							+ '<td>' + item.cus_name + '</td>'

							+ '<td>' + item.mobile + '</td>'

							+ '<td><a href=' + url + ' target="_blank">' + item.bill_no + '</a></td>'

							+ '<td>' + item.bill_type + '</td>'

							+ '<td>' + item.bill_date + '</td>'

							+ '<td>' + item.cancelled_date + '</td>'

							+ '<td>' + money_format_india(item.tot_bill_amount) + '</td>'

							+ '<td>' + item.cancel_reason + '</td>'

							+ '<td>' + item.cancel_by + '</td>'

						'</tr>';

						bill_amount = parseFloat(bill_amount) + parseFloat(item.tot_bill_amount);

					});

					trHTML += '<tr style="font-weight:bold;color:red">' +

						+'<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td>Sub Total</td>'

						+ '<td>' + money_format_india(bill_amount) + '</td>'

						+ '<td></td>'

						+ '<td></td>'

					'</tr>';

					total_bill_amount = total_bill_amount + bill_amount;

				});

				trHTML += '<tr style="font-weight:bold;color:blue">' +

					+'<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td>Grand Total</td>'

					+ '<td>' + money_format_india(total_bill_amount) + '</td>'

					+ '<td></td>'

					+ '<td></td>'

				'</tr>';

				$('#cancelled_bill_list > tbody').html(trHTML);

				// Check and initialise datatable

				if (!$.fn.DataTable.isDataTable('#cancelled_bill_list')) {

					oTable = $('#cancelled_bill_list').dataTable({

						"bSort": false,

						"bInfo": true,

						"scrollX": '100%',

						"dom": 'lBfrtip',

						"paging": false,

						"columnDefs": [

							{

								targets: [5, 6],

								className: 'dt-body-right'

							}

						],

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: '',

								messageTop: title,

								orientation: 'landscape',

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact');

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', '10px')

										.css('font-family', 'sans-serif');

								},

							},

							{

								extend: 'colvis',

								collectionLayout: 'fixed columns',

								collectionTitle: 'Column visibility control'

							},

							{

								extend: 'excel',

								footer: true,

								title: "Cancelled Bills Report - " + $("#dt_range").val(),

							}

						],

					});

				}

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//Cancelled Bills - Ends

// Discounted Bills

$("#disc_rep_type").on("change", function () {

	if (this.value == 1) {

		$(".without_bill_detail").css("display", "block");

		$(".with_bill_detail").css("display", "none");

	}

	else if (this.value == 2) {

		$(".with_bill_detail").css("display", "block");

		$(".without_bill_detail").css("display", "none");

	}

});

function set_discBills_27_02_2024() {

	var dt_range = ($("#dt_range").val()).split('-');

	var company_name = $('#company_name').val();

	var from_date = dt_range[0];

	var to_date = dt_range[1];

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "Discount Bill Report"

	var optional = '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/bill_discount/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'dt_range': $("#dt_range").val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'disc_rep_type': $("#disc_rep_type").val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.list;

			$('#total_count').text(list.length);

			var oTable = $('#disc_bill_detail').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#disc_bill_detail').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"order": [[0, "desc"]],

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"fixedHeader": true,

					"paging": false,

					"autoWidth": true,

					"columnDefs": [

						{

							targets: [7, 8, 9, 10, 11, 12],

							className: 'dt-body-right'

						},

						{

							targets: [0, 1, 2, 3, 4, 5, 6],

							className: 'dt-body-left'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', '10px');

							},

						},

						{

							extend: 'colvis',

							collectionLayout: 'fixed columns',

							collectionTitle: 'Column visibility control'

						},

						{

							extend: 'excel',

							footer: true,

							title: 'Discount Bill Report',

						}

					],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "bill_date" },

						{

							"mDataProp": function (row, type, val, meta) {

								var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + row.bill_id;

								return '<a href=' + url + ' target="_blank">' + row.bill_no + '</a>';

							},

						},

						{ "mDataProp": "cus_name" },

						{ "mDataProp": "mobile" },

						{ "mDataProp": "product_name" },

						{ "mDataProp": "design_name" },

						{ "mDataProp": "sub_design_name" },

						{ "mDataProp": "net_wt" },

						{ "mDataProp": "wastage_percent" },

						{

							"mDataProp": function (row, type, val, meta) {

								var mc_value = 0;

								if (row.calculation_based_on == 0 || row.calculation_based_on == 2) {

									mc_value = (row.mcType == 1 ? parseFloat(row.mc_value * row.gross_wt) : parseFloat(row.mc_value * row.piece));

								} else if (row.calculation_based_on == 1) {

									mc_value = (row.mcType == 1 ? parseFloat(row.mc_value * row.net_wt) : parseFloat(row.mc_value * row.piece));

								}

								return money_format_india(parseFloat(mc_value).toFixed(3));

							},

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var item_cost = (row.item_cost - row.item_total_tax)

								return money_format_india(item_cost.toFixed(2));

							},

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var bill_discount = (row.bill_discount)

								return money_format_india(bill_discount);

							},

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var mc_value = 0;

								var wast_wt = 0;

								var disc_per = '-';

								var dis_per = (row.bill_discount / row.item_cost) * 100

								return dis_per.toFixed(2);

							},

						},

						{ "mDataProp": "emp_name" },

						{ "mDataProp": "otp_approved_by" },

					],

				});

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//Discounted Bills - Ends

// GST Bills

function set_gstBills() {

	var dt_range = ($("#dt_range").val()).split('-');

	var company_name = $('#company_name').val();

	var from_date = dt_range[0];

	var to_date = dt_range[1];

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "B2B GST BIll DETAILED REPORT"

	var optional = $('#category option:selected').html() != '' && $('#category option:selected').html() != undefined ? $('#category option:selected').html() + " - " : '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/gst_bills/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'dt_range': $("#dt_range").val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'id_category': ($('#category').val() != '' && $('#category').val() != undefined && $('#category').val() != null) ? $('#category').val() : 0 }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			$("#gst_bill_list > tbody > tr").remove();

			$('#gst_bill_list').dataTable().fnClearTable();

			$('#gst_bill_list').dataTable().fnDestroy();

			if (list != null) {

				trHTML = '';

				tfootHTML = '';

				total_bill_amount = 0;

				total_bill_tax_value = 0;

				total_bill_sgst = 0;

				total_bill_cgst = 0;

				total_bill_igst = 0;

				total_tax_amount = 0;

				total_tax_value = 0;

				$.each(list, function (i, branch) {

					var bill_amount = 0;

					$.each(branch, function (idx, item) {

						var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + item.bill_id;

						trHTML += '<tr>'

							+ '<td><a href=' + url + ' target="_blank">' + item.bill_no + '</a></td>'

							+ '<td>' + item.bill_date + '</td>'

							+ '<td>' + item.cus_name + '</td>'

							+ '<td>' + item.mobile + '</td>'

							+ '<td>' + item.gst_number + '</td>'

							+ '<td>' + item.pan + '</td>'

							+ '<td>' + money_format_india(item.tax_value) + '</td>'

							+ '<td>' + money_format_india(item.tot_tax_value) + '</td>'

							+ '<td>' + money_format_india(item.tot_bill_amount) + '</td>'

						'</tr>';

						bill_amount = parseFloat(bill_amount) + parseFloat(item.tot_bill_amount);

						total_bill_amount += parseFloat(item.tot_bill_amount);

						total_tax_amount += parseFloat(item.tot_tax_value);

						total_tax_value += parseFloat(item.tax_value);

					});

					/*trHTML += '<tr style="font-weight:bold;">' +

									+'<td></td>'

									+'<td></td>'

									+'<td></td>'

									+'<td></td>'

									+'<td></td>'

									+'<td></td>'

									+'<td>Sub Total</td>'

									+'<td>'+bill_amount+'</td>'

							 '</tr>';*/

				});

				trHTML += '<tr style="font-weight:bold;">' +

					+'<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td><strong> TOTAL</strong></td>'

					+ '<td>' + money_format_india(parseFloat(total_tax_value).toFixed(2)) + '</td>'

					+ '<td>' + money_format_india(parseFloat(total_tax_amount).toFixed(2)) + '</td>'

					+ '<td>' + money_format_india(parseFloat(total_bill_amount).toFixed(2)) + '</td>'

				'</tr>';

				$('#gst_bill_list > tbody').html(trHTML);

				// Check and initialise datatable

				if (!$.fn.DataTable.isDataTable('#gst_bill_list')) {

					oTable = $('#gst_bill_list').dataTable({

						"bSort": false,

						"bInfo": true,

						"scrollX": '100%',

						"dom": 'lBfrtip',

						"paging": false,

						"columnDefs": [

							{

								targets: [0, 1, 2, 3, 4, 5,],

								className: 'dt-body-left'

							},

							{

								targets: [6, 7, 8],

								className: 'dt-body-right'

							},

						],

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: '',

								messageTop: title,

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', 'inherit');

								},

							},

							{

								extend: 'colvis',

								collectionLayout: 'fixed columns',

								collectionTitle: 'Column visibility control'

							},

							{

								extend: 'excel',

								footer: true,

								title: title,

							}

						],

					});

				}

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//GST Bills - Ends

//re-order items

$('#prod_select').on('change', function () {

	if (this.value != '') {

		if (ctrl_page[1] != 'sales_comparision') {

			get_Activedesign($("#prod_select").val());

		}

		if (ctrl_page[1] == 'tag_items_designwise' || ctrl_page[1] == 'reorder_items' || ctrl_page[1] == 'scan_report' || ctrl_page[1] == 'stock_age') {

			get_Activesize(this.value);

		}

		if (ctrl_page[1] == 'home_bill' || ctrl_page[1] == 'scan_report') {

			get_Activedesign(this.value);

		}

		if (ctrl_page[1] == 'stock_ratio_avail') {

			get_product_size(this.value);

		}

		if (ctrl_page[1] == 'inventory_turnover') {

			get_weight_range(this.value);

		}

		// if (ctrl_page[1] == 'reorder_report') {

		// 	if($("#prod_select").val() != 0)

		// 	{

		// 		$('#reorder_print').prop('disabled', true);

		// 	}

		// 	else{

		// 		$('#reorder_print').prop('disabled', false);

		// 	}

		// }

	}

});

$('#prod_filter').on('change', function () {

	if (this.value != '') {

		if (ctrl_page[1] == 'scan_report') {

			get_Activedesign(this.value);

		}

	}

});

function get_Activedesign(id_product) {

	$('#des_select option').remove();

	$.ajax({

		type: 'POST',

		url: base_url + 'index.php/admin_ret_reports/get_Activedesign',

		dataType: 'json',

		data: { 'id_product': id_product },

		success: function (data) {

			var id = $("#id_design").val();

			$.each(data, function (key, item) {

				$("#des_select").append(

					$("<option></option>")

						.attr("value", item.design_no)

						.text(item.design_name)

				);

			});

			$("#des_select").select2(

				{

					placeholder: "Select Design",

					allowClear: true

				});

			$("#des_select").select2("val", (id != '' && id > 0 ? id : ''));

		}

	});

}

$('#des_select').on('change', function () {

	if (this.value != '') {

		if (ctrl_page[1] == 'reorder_items') {

			get_ActiveSubDesign();

		}

		if (ctrl_page[1] == 'weight_range_sales') {

			get_ActiveSubDesign();

		}

		if (ctrl_page[1] == 'purchase') {

			get_ActiveSubDesign();

		}

		if (ctrl_page[1] == 'purchase_return') {

			get_ActiveSubDesign();

		}

		if (ctrl_page[1] == 'weight_rage_report') {

			get_ActiveSubDesign();

		}

		if (ctrl_page[1] == 'home_bill') {

			get_ActiveSubDesign();

		}

		if (ctrl_page[1] == 'est_referral') {

			get_ActiveSubDesign();

		}

		if (ctrl_page[1] == 'employee_wise_tag' || ctrl_page[1] == 'tag_items_designwise') {

			get_ActiveSubDesign();

		}

		if (ctrl_page[1] == 'other_issue') {

			get_ActiveSubDesign();

		}

		if (ctrl_page[1] == 'scan_report') {

			get_ActiveSubDesign();

		}

		if (ctrl_page[1] == 'reorder_report') {

			get_ActiveSubDesign();

		}

		if (ctrl_page[1] == 'dashboard_ordermanagement') {

			get_ActiveSubDesign();

		}

		if (ctrl_page[1] == 'bill_discount') {

			get_ActiveSubDesign();

		}

	}

	if (ctrl_page[1] == 'stock_ratio_avail') {

		get_ActiveSubDesign();

		get_weight_range($('#prod_select').val(), this.value, $('#sub_des_select').val());

	}

});

function get_ActiveSubDesign() {

	$('#sub_des_select option').remove();

	$.ajax({

		type: 'POST',

		url: base_url + 'index.php/admin_ret_reports/get_ActiveSubDesign',

		dataType: 'json',

		data: {

			'id_product': $('#prod_select').val() || $('#prod_filter').val(),

			'id_design': $('#des_select').val()

		},

		success: function (data) {

			var id = $("#id_design").val();

			$.each(data, function (key, item) {

				$("#sub_des_select").append(

					$("<option></option>")

						.attr("value", item.id_sub_design)

						.text(item.sub_design_name)

				);

			});

			$("#sub_des_select").select2(

				{

					placeholder: "Select Sub Design",

					allowClear: true

				});

			$("#sub_des_select").select2("val", (id != '' && id > 0 ? id : ''));

		}

	});

}

function get_Active_stockSubDesign() {

	$('#sub_des_select option').remove();

	$.ajax({

		type: 'POST',

		url: base_url + 'index.php/admin_ret_reports/get_Active_St_SubDesign',

		dataType: 'json',

		success: function (data) {

			var id = $("#id_sub_design").val();

			$.each(data, function (key, item) {

				$("#sub_des_select").append(

					$("<option></option>")

						.attr("value", item.id_sub_design)

						.text(item.sub_design_name)

				);

			});

			$("#sub_des_select").select2(

				{

					placeholder: "Select Sub Design",

					allowClear: true

				});

			$("#sub_des_select").select2("val", (id != '' && id > 0 ? id : ''));

		}

	});

}

$("#sub_des_select").on('change', function () {

	if (ctrl_page[1] == 'stock_ratio_avail') {

		get_weight_range($('#prod_select').val(), $('#des_select').val(), this.value);

	}

});

function get_weight_range(id_product, id_design = "", id_sub_design = "") {

	$('#wt_select option').remove();

	$('#ed_wt_select option').remove();

	$.ajax({

		type: 'POST',

		url: base_url + 'index.php/admin_ret_reports/get_weight_range',

		dataType: 'json',

		data: { 'id_product': id_product, 'id_design': id_design, 'id_sub_design': id_sub_design },

		success: function (data) {

			var id = $("#wt_range").val();

			$.each(data, function (key, item) {

				$("#wt_select").append(

					$("<option></option>")

						.attr("value", item.id_weight)

						.text(item.weight_description)

				);

			});

			$("#wt_select").select2(

				{

					placeholder: "Weight Range",

					allowClear: true

				});

			$("#wt_select").select2("val", (id != '' && id > 0 ? id : ''));

		}

	});

}

function set_reorder_items() {

	var from_date = '';

	var to_date = '';

	var company_name = $('#company_name').val();

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "Re-order Items Report "

	var prod_select = $('#prod_select option:selected').html() != '' && $('#prod_select option:selected').html() != undefined ? $('#prod_select option:selected').html() + " - " : '';

	var des_select = $('#des_select option:selected').html() != '' && $('#des_select option:selected').html() != undefined ? $('#des_select option:selected').html() + " - " : '';

	var sub_des_select = $('#sub_des_select option:selected').html() != '' && $('#sub_des_select option:selected').html() != undefined ? $('#sub_des_select option:selected').html() + " - " : '';

	var wt_select = $('#wt_select option:selected').html() != '' && $('#wt_select option:selected').html() != undefined ? $('#wt_select option:selected').html() + " - " : '';

	var select_size = $('#select_size option:selected').html() != '' && $('#select_size option:selected').html() != undefined ? $('#select_size option:selected').html() + " - " : '';

	var optional = prod_select + des_select + sub_des_select + wt_select + select_size;

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/reorder_items/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'id_design': $("#des_select").val(), 'id_sub_design': $("#sub_des_select").val(), 'id_product': $("#prod_select").val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'id_weight': $('#wt_select').val(), 'id_size': $('#select_size').val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.list;

			$('#total_count').text(list.length);

			var oTable = $('#reorder_item_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#reorder_item_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"order": [[0, "desc"]],

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"fixedHeader": true,

					"paging": true,

					"autoWidth": true,

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							// exportOptions: {

							// 	columns: ':visible'

							// },

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', '12px')

									.css('font-family', 'sans-serif');

							},

						},

						{

							extend: 'colvis',

							collectionLayout: 'fixed columns',

							collectionTitle: 'Column visibility control'

						},

						{

							extend: 'excel',

							footer: true,

							title: title,

						}

					],

					"aaData": list,

					"aoColumns": [

						{

							"mDataProp": function (row, type, val, meta) {

								var design_name = row.design_name;

								var product_name = row.product_name;

								var shortage = 0;

								var excess = 0;

								var tag_details = row.tag_details;

								if (parseFloat(row.min_pcs) > parseFloat(tag_details.tot_pcs) && (row.min_pcs > 0)) {

									if (tag_details.tot_pcs > 0) {

										shortage = parseFloat(row.min_pcs) - parseFloat(tag_details.tot_pcs);

									} else {

										shortage = parseFloat(row.min_pcs)

									}

								}

								if (shortage > 0 && (row.is_cart == 0 && row.is_order == 0)) {

									return '<input type="checkbox" class="reorder_items" name="reorder_items[]"/><input type="hidden" class="product_name" value=' + row.product_name + '><input type="hidden" class="product_id" value=' + row.product_id + '><input type="hidden" class="design_id" value=' + row.design_id + '><input type="hidden" class="id_sub_design" value=' + row.id_sub_design + '><input type="hidden" class="id_branch" value=' + row.id_branch + '><input type="hidden" class="id_category" value=' + row.id_category + '><input type="hidden" class="id_wt_range" value=' + row.id_wt_range + '><input type="hidden" class="max_pcs" value=' + row.max_pcs + '><input type="hidden" class="min_pcs" value=' + row.min_pcs + '><input type="hidden" class="product_name" value=' + product_name + '><input type="hidden" class="design_name" value=' + design_name + '><input type="hidden" class="weight_name" value=' + row.weight_name + '><input type="hidden" class="is_cart" value=' + row.is_cart + '><input type="hidden" class="shortage" value=' + shortage + '><input type="hidden" class="size" value=' + (row.id_size != null && row.id_size != '' ? row.id_size : '') + '>' + row.product_name;

								}

								else {

									return '<input type="hidden" class="product_name" value=' + row.product_name + '><input type="hidden" class="product_id" value=' + row.product_id + '><input type="hidden" class="design_id" value=' + row.design_id + '><input type="hidden" class="id_sub_design" value=' + row.id_sub_design + '><input type="hidden" class="id_branch" value=' + row.id_branch + '><input type="hidden" class="id_category" value=' + row.id_category + '><input type="hidden" class="id_wt_range" value=' + row.id_wt_range + '><input type="hidden" class="max_pcs" value=' + row.max_pcs + '><input type="hidden" class="min_pcs" value=' + row.min_pcs + '><input type="hidden" class="product_name" value=' + product_name + '><input type="hidden" class="design_name" value=' + design_name + '><input type="hidden" class="weight_name" value=' + row.weight_name + '><input type="hidden" class="is_cart" value=' + row.is_cart + '>' + row.product_name;

								}

							},

						},

						{ "mDataProp": "design_name" },

						{ "mDataProp": "sub_design_name" },

						{ "mDataProp": "size" },

						{ "mDataProp": "weight_name" },

						{

							"mDataProp": function (row, type, val, meta) {

								var tag_details = row.tag_details;

								return tag_details.gross_wt;

							},

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var tag_details = row.tag_details;

								return tag_details.net_wt;

							},

						},

						{

							"mDataProp": function (row, type, val, meta) {

								return row.min_pcs + '/' + row.max_pcs;

							},

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var tag_details = row.tag_details;

								return tag_details.tot_pcs;

							},

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var shortage = 0;

								var excess = 0;

								var tag_details = row.tag_details;

								if (parseFloat(row.min_pcs) > parseFloat(tag_details.tot_pcs) && (row.min_pcs > 0)) {

									if (tag_details.tot_pcs > 0) {

										shortage = parseFloat(row.min_pcs) - parseFloat(tag_details.tot_pcs);

									} else {

										shortage = parseFloat(row.min_pcs)

									}

								}

								if (shortage > 0) {

									return '<a href="" data-toggle="modal" data-toggle="tooltip" title="Click Here to Add Cart" onclick="create_new_order($(this).closest(\'tr\'));" ><span class="badge bg-red">' + shortage + '</span></a>';

								} else {

									return '<span class="badge bg-red">' + shortage + '</span>';

								}

							},

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var excess = 0;

								var product_id = row.product_id;

								var design_id = row.design_id;

								var id_branch = row.id_branch;

								var id_category = row.id_category;

								var tag_details = row.tag_details;

								create_order = '';

								if (parseFloat(tag_details.tot_pcs) > parseFloat(row.max_pcs)) {

									excess = parseFloat(row.max_pcs) - parseFloat(tag_details.tot_pcs);

									excess = excess < 0 ? parseFloat(excess * -1) : excess;

								}

								return '<span class="badge bg-green">' + excess + '</span>';

							},

						},

						{

							"mDataProp": function (row, type, val, meta) {

								if (row.is_cart > 0 || row.is_order > 0) {

									var cart_url = base_url + 'index.php/admin_ret_order/cart/list/';

									var order_url = base_url + 'index.php/admin_ret_purchase/purchase/order_status';

									return (row.is_cart > 0 ? '<a href=' + cart_url + ' target="_blank" data-toggle="tooltip" title="In Cart"><i class="fa fa-shopping-cart" aria-hidden="true" style="margin-left: 23%;"></i><span class="badge bg-green" ></span></a> / ' : '') + (row.is_order > 0 ? ' <a href=' + order_url + ' target="_blank" data-toggle="tooltip" title="Order Placed"><span class="badge bg-green"><i class="fa fa-cart-plus" aria-hidden="true"></i></span></a>' : '');

								} else {

									return '';

								}

							},

						},

					],

					"footerCallback": function (row, data, start, end, display) {

						if (data.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								pieces = api

									.column(9)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(9).footer()).html(parseFloat(pieces).toFixed(2));

								shortage = api

									.column(10)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(10).footer()).html(parseFloat(shortage).toFixed(2));

								excess = api

									.column(11)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(11).footer()).html(parseFloat(excess).toFixed(2));

								gross_wgt = api

									.column(5)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(5).footer()).html(money_format_india(parseFloat(gross_wgt).toFixed(2)));

								net_wgt = api

									.column(6)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(6).footer()).html(money_format_india(parseFloat(net_wgt).toFixed(2)));

							}

						} else {

							var api = this.api(), data;

							$(api.column(9).footer()).html('');

							$(api.column(5).footer()).html('');

							$(api.column(6).footer()).html('');

							$(api.column(10).footer()).html('');

							$(api.column(11).footer()).html('');

						}

					}

				});

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function set_branchreorder_items() {

	var from_date = '';

	var to_date = '';

	var company_name = $('#company_name').val();

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "Re-order Items Report "

	var prod_select = $('#prod_select option:selected').html() != '' && $('#prod_select option:selected').html() != undefined ? $('#prod_select option:selected').html() + " - " : '';

	var des_select = $('#des_select option:selected').html() != '' && $('#des_select option:selected').html() != undefined ? $('#des_select option:selected').html() + " - " : '';

	var sub_des_select = $('#sub_des_select option:selected').html() != '' && $('#sub_des_select option:selected').html() != undefined ? $('#sub_des_select option:selected').html() + " - " : '';

	var wt_select = $('#wt_select option:selected').html() != '' && $('#wt_select option:selected').html() != undefined ? $('#wt_select option:selected').html() + " - " : '';

	var optional = prod_select + des_select + sub_des_select + wt_select;

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/branchreorder_items/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'id_design': $("#des_select").val(), 'id_sub_design': $("#sub_des_select").val(), 'id_product': $("#prod_select").val(), 'id_weight': $('#wt_select').val(), 'id_size': $('#select_size').val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.list;

			$('#total_count').text(list.length);

			var oTable = $('#reorder_item_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#reorder_item_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"order": [[0, "desc"]],

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"fixedHeader": true,

					"paging": true,

					"autoWidth": true,

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'colvis',

							collectionLayout: 'fixed columns',

							collectionTitle: 'Column visibility control'

						},

						{

							extend: 'excel',

							footer: true,

							title: title,

						}

					],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "product_name" },

						{ "mDataProp": "design_name" },

						{ "mDataProp": "sub_design_name" },

						{ "mDataProp": "size" },

						{ "mDataProp": "weight_name" },

						{

							"mDataProp": function (row, type, val, meta) {

								return row.Btotgrswt;

							},

						},

						{

							"mDataProp": function (row, type, val, meta) {

								return row.Btotnetwt;

							},

						},

						{

							"mDataProp": function (row, type, val, meta) {

								return row.Bminmax;

							},

						},

						{

							"mDataProp": function (row, type, val, meta) {

								return row.Btotpcs;

							},

						},

						{

							"mDataProp": function (row, type, val, meta) {

								if (row.Bshortage > 0) {

									return '<a href="" data-toggle="modal" data-toggle="tooltip" title="Click Here to Add Cart" onclick="create_new_branch_order($(this).closest(\'tr\'));" ><span class="badge bg-red">' + row.Bshortage + '</span></a>';

								} else {

									return '<span class="badge bg-green">' + row.Bexcess + '</span>';

								}

							},

						},

						{

							"mDataProp": function (row, type, val, meta) {

								return row.Ctotgrswt;

							},

						},

						{

							"mDataProp": function (row, type, val, meta) {

								return row.Ctotnetwt;

							},

						},

						{

							"mDataProp": function (row, type, val, meta) {

								return row.Cminmax;

							},

						},

						{

							"mDataProp": function (row, type, val, meta) {

								return row.Ctotpcs;

							},

						},

						{

							"mDataProp": function (row, type, val, meta) {

								if (row.Cshortage > 0) {

									return '<a href="" data-toggle="modal" data-toggle="tooltip" title="Click Here to Add Cart" onclick="create_new_branch_order($(this).closest(\'tr\'));" ><span class="badge bg-red">' + row.Cshortage + '</span></a>';

								} else {

									return '<span class="badge bg-green">' + row.Cexcess + '</span>';

								}

							},

						},

						{

							"mDataProp": function (row, type, val, meta) {

								return row.Dtotgrswt;

							},

						},

						{

							"mDataProp": function (row, type, val, meta) {

								return row.Dtotnetwt;

							},

						},

						{

							"mDataProp": function (row, type, val, meta) {

								return row.Dminmax;

							},

						},

						{

							"mDataProp": function (row, type, val, meta) {

								return row.Dtotpcs;

							},

						},

						{

							"mDataProp": function (row, type, val, meta) {

								if (row.Dshortage > 0) {

									return '<a href="" data-toggle="modal" data-toggle="tooltip" title="Click Here to Add Cart" onclick="create_new_branch_order($(this).closest(\'tr\'));" ><span class="badge bg-red">' + row.Dshortage + '</span></a>';

								} else {

									return '<span class="badge bg-green">' + row.Dexcess + '</span>';

								}

							},

						},

						{

							"mDataProp": function (row, type, val, meta) {

								return row.Etotgrswt;

							},

						},

						{

							"mDataProp": function (row, type, val, meta) {

								return row.Etotnetwt;

							},

						},

						{

							"mDataProp": function (row, type, val, meta) {

								return row.Eminmax;

							},

						},

						{

							"mDataProp": function (row, type, val, meta) {

								return row.Etotpcs;

							},

						},

						{

							"mDataProp": function (row, type, val, meta) {

								if (row.Eshortage > 0) {

									return '<a href="" data-toggle="modal" data-toggle="tooltip" title="Click Here to Add Cart" onclick="create_new_branch_order($(this).closest(\'tr\'));" ><span class="badge bg-red">' + row.Eshortage + '</span></a>';

								} else {

									return '<span class="badge bg-green">' + row.Eexcess + '</span>';

								}

							},

						},

					],

					"footerCallback": function (row, data, start, end, display) {

						if (data.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								pieces = api

									.column(9)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(9).footer()).html(parseFloat(pieces).toFixed(2));

								shortage = api

									.column(10)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(10).footer()).html(parseFloat(shortage).toFixed(2));

								excess = api

									.column(11)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(11).footer()).html(parseFloat(excess).toFixed(2));

								gross_wgt = api

									.column(5)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(5).footer()).html(parseFloat(gross_wgt).toFixed(2));

								net_wgt = api

									.column(6)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(6).footer()).html(parseFloat(net_wgt).toFixed(2));

							}

						} else {

							var api = this.api(), data;

							$(api.column(9).footer()).html('');

							$(api.column(5).footer()).html('');

							$(api.column(6).footer()).html('');

							$(api.column(10).footer()).html('');

							$(api.column(11).footer()).html('');

						}

					}

				});

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

$("#add_to_cart").click(function () {

	if ($("input[name='reorder_items[]']:checked").val()) {

		var selected = [];

		$("#reorder_item_list tbody tr").each(function (index, value) {

			if ($(value).find("input[name='reorder_items[]']:checked").is(":checked")) {

				curRow = $(this);

				transData = {

					'product_id': $(value).find(".product_id").val(),

					'design_id': $(value).find(".design_id").val(),

					'id_sub_design': $(value).find(".id_sub_design").val(),

					'id_wt_range': $(value).find(".id_wt_range").val(),

					'shortage_pcs': $(value).find(".shortage").val(),

					'id_size': $(value).find(".size").val(),

				}

				selected.push(transData);

			}

		});

		req_data = selected;

		add_to_cart(req_data);

	}

	else {

		alert('Please Select Atleast One Row');

	}

});

function add_to_cart(req_data) {

	$("div.overlay").css("display", "none");

	var url = base_url + "index.php/admin_ret_order/add_to_cart?nocache=" + my_Date.getUTCSeconds();

	$.ajax({

		url: url,

		data: { 'req_data': req_data, 'id_branch': $('#branch_select').val() },

		type: "POST",

		dataType: "JSON",

		success: function (data) {

			if (data.status) {

				$.toaster({ priority: 'success', title: 'Warning!', message: '' + "</br>" + data.message });

				$("div.overlay").css("display", "none");

			}

			else {

				$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + data.message });

				$("div.overlay").css("display", "none");

			}

			set_reorder_items();

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

$('#create_order').on('click', function () {

	if (validateOrderDetailRow()) {

		var form_data = $('#order_cart').serialize();

		var url = base_url + "index.php/admin_ret_order/cart/save?nocache=" + my_Date.getUTCSeconds();

		$.ajax({

			url: url,

			data: form_data,

			type: "POST",

			dataType: "JSON",

			success: function (data) {

				if (data.status) {

					$('#success_res').css("display", "block");

					$('#success_msg').html(data.msg);

					setTimeout(function () {

						$("#success-alert").hide();

						$('#success_msg').html('');

						$("#success-alert").show();

						$('#success_res').css("display", "none");

					}, 1000);

				} else {

					$('#failed_msg').html(data.msg);

					$('#success_res').css("display", "none")

				}

				set_reorder_items();

				$("div.overlay").css("display", "none");

			},

			error: function (error) {

				$("div.overlay").css("display", "none");

			}

		});

		$('#confirm-add').modal('toggle');

	}

});

function validateOrderDetailRow() {

	var validate = true;

	$('#item_detail > tbody  > tr').each(function (index, tr) {

		if ($(this).find('.product').val() == "" || $(this).find('.design').val() == "" || $(this).find('.qty').val() == "" || ($(this).find('.qty').val() == 0) || $(this).find('.id_wt_range').val() == "" || $(this).find('.purity_sel').val() == "" || $(this).find('.purity_sel').val() == null) {

			validate = false;

		}

		if ($(this).find('.qty').val() == '' || $(this).find('.qty').val() == 0) {

			msg = '<div class = "alert alert-danger"><a href = "#" class = "close" data-dismiss = "alert">&times;</a><strong>Warning!</strong>Please Enter Total Pieces</div>';

			$('#chit_alert').html(msg);

		}

		else if ($(this).find('.karigar').val() == "" || $(this).find('.karigar').val() == null) {

			msg = '<div class = "alert alert-danger"><a href = "#" class = "close" data-dismiss = "alert">&times;</a><strong>Warning!</strong>Please Select Karigar</div>';

			$('#chit_alert').html(msg);

		}

		else if ($(this).find('.purity_sel').val() == "" || $(this).find('.purity_sel').val() == null) {

			msg = '<div class = "alert alert-danger"><a href = "#" class = "close" data-dismiss = "alert">&times;</a><strong>Warning!</strong>Please Select Purity</div>';

			$('#chit_alert').html(msg);

		}

	});

	return validate;

}

//re-order items

//tag items -design wise

function get_ActiveProduct() {

	$('#prod_select option').remove();

	$('#prod_filter option').remove();

	$.ajax({

		url: base_url + 'index.php/admin_ret_reports/get_ActiveProduct',

		data: ({ 'id_category': $('#category').length > 0 ? $('#category').val() : 0 }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var id = $("#id_design").val();

			if (ctrl_page[1] == 'scan_report' || ctrl_page[1] == 'reorder_report') {

				$("#prod_select,#prod_filter").append(

					$("<option></option>")

						.attr("value", 0)

						.text('ALL')

				);

			}

			$.each(data, function (key, item) {

				$("#prod_select,#prod_filter").append(

					$("<option></option>")

						.attr("value", item.pro_id)

						.text(item.product_name)

				);

			});

			$("#prod_select,#prod_filter").select2(

				{

					placeholder: "Select Product",

					allowClear: true

				});

			$("#prod_select").select2("val", (id != '' && id > 0 ? id : ''));

			if ($("#prod_filter").length) {

				$("#prod_filter").select2("val", (id != '' && id > 0 ? id : ''));

			}

		}

	});

}

$('#metal').on('change', function () {

	// get_category(this.value);

	if (ctrl_page[1] == 'stock_details' && ctrl_page[2] == 'list') {

		get_product_group();

	} else {

		get_category();

	}

});

$('#category').on('change', function () {

	get_ActiveProduct(this.value);

});

//Product select

$('#prod_select').on('change', function () {

	if (this.value != '') {

		if (ctrl_page[1] != 'scan_report' && ctrl_page[1] != 'sales_comparision') {

			get_weight_range(this.value);

		}

		if (ctrl_page[1] == 'employee_wise_sales') {

			get_Activedesign(this.value);

		}

		if (ctrl_page[1] == 'est_referral') {

			get_Activedesign(this.value);

		}

	}

});

function get_ActiveCollection() {

	$('#select_collection option').remove();

	$("div.overlay").css("display", "block");

	$.ajax({

		type: 'GET',

		url: base_url + 'index.php/admin_ret_tagging/get_ActiveCollection',

		dataType: 'json',

		success: function (data) {

			var id = $("#select_collection").val();

			$.each(data, function (key, item) {

				$("#select_collection").append(

					$("<option></option>")

						.attr("value", item.id_collection)

						.text(item.collection_name)

				);

			});

			if ($("#select_collection").length) {

				$("#select_collection").select2("val", (id != '' && id > 0 ? id : ''));

			}

		}

	});

	$("div.overlay").css("display", "none");

}

function set_tagged_items() {

	var company_name = $('#company_name').val();

	var from_date = '';

	var to_date = '';

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "Design Wise Tag Items"

	var metal = $('#metal option:selected').html() != '' && $('#metal option:selected').html() != undefined ? $('#metal option:selected').html() + " - " : '';

	var category = $('#category option:selected').html() != '' && $('#category option:selected').html() != undefined ? $('#category option:selected').html() + " - " : '';

	var prod_select = $('#prod_select option:selected').html() != '' && $('#prod_select option:selected').html() != undefined ? $('#prod_select option:selected').html() + " - " : '';

	var des_select = $('#des_select option:selected').html() != '' && $('#des_select option:selected').html() != undefined ? $('#des_select option:selected').html() + " - " : '';

	var select_collection = $('#select_collection option:selected').html() != '' && $('#select_collection option:selected').html() != undefined ? $('#select_collection option:selected').html() + " - " : '';

	var select_size = $('#select_size option:selected').html() != '' && $('#select_size option:selected').html() != undefined ? $('#select_size option:selected').html() + " - " : '';

	var karigar = $('#karigar option:selected').html() != '' && $('#karigar option:selected').html() != undefined ? $('#karigar option:selected').html() + " - " : '';

	var optional = metal + category + prod_select + des_select + select_collection + select_size + karigar;

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/tag_items_designwise/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({

			'id_category': $('#category').val(),

			'id_product': $('#prod_select').val(),

			'id_design': $("#des_select").val(),

			'from_lotno': $("#from_lotno").val(),

			'to_lotno': $("#to_lotno").val(),

			'id_sub_design': $('#sub_des_select').val(),

			'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()),

			'from_weight': $('#from_weight').val(),

			'to_weight': $('#to_weight').val(),

			'id_size': $('#select_size').val(),

			'id_metal': $('#metal').val(),

			'id_collection': $('#select_collection').val(),

			'id_karigar': $('#karigar').val(),

			'id_collection': $('#select_collection').val(),

			'id_section': $('#section_select').val(),

			'huid' : $('#tag_huid').val(),

			'available_stk_date': $('.available_stk_date').val()

		}),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.list;

			export_list = [];

			export_list = list;

			var stock_details = data.stock_details;

			var tot_weight = 0;

			var tot_piece = 0;

			$.each(list, function (key, item) {

				tot_piece += parseFloat(item.piece);

				tot_weight += parseFloat(item.gross_wt);

			})

			$('#total_count').text(tot_piece);

			$('#total_wt').text(parseFloat(tot_weight).toFixed(3));

			$("#tag_item_branchwise > tbody > tr").remove();

			if ((stock_details.length > 0) && ($("#branch_select").val() == 0)) {

				var trHtml = '';

				var tot_pcs = 0;

				var tot_gross_wt = 0;

				var tot_net_wt = 0;

				$.each(stock_details, function (key, items) {

					tot_pcs += parseFloat(items.piece);

					tot_gross_wt += parseFloat(items.gross_wt);

					tot_net_wt += parseFloat(items.gross_wt);

					trHtml += '<tr>'

						+ '<td>' + items.branch_name + '</td>'

						+ '<td>' + items.piece + '</td>'

						+ '<td>' + items.gross_wt + '</td>'

						+ '<td>' + items.net_wt + '</td>'

						+ '</tr>';

				});

				trHtml += '<tr style="font-weight:bold;">'

					+ '<td>TOTAL</td>'

					+ '<td>' + parseFloat(tot_pcs).toFixed(2) + '</td>'

					+ '<td>' + parseFloat(tot_gross_wt).toFixed(2) + '</td>'

					+ '<td>' + parseFloat(tot_net_wt).toFixed(2) + '</td>'

					+ '</tr>';

				$('#tag_item_branchwise').append(trHtml);

			}

			var oTable = $('#tag_items_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#tag_items_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"order": [[0, "desc"]],

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"columnDefs": [

						{

							targets: [15, 16, 17, 18, 19],

							className: 'dt-body-right'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							// exportOptions: {

							//     columns: ':visible'

							// },

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', '12px')

									.css('font-family', 'sans-serif');

							},

						},

						'colvis',

						{

							extend: 'excel',

							footer: true,

							title: 'Design Wise Tag Items',

						}

					],

					"aaData": list,

					"aoColumns": [

						/*{ "mDataProp": "tag_lot_id" },*/

						/*{

							"className":      'dt-control',

							"orderable":      false,

							"data":           "tag_lot_id",

							"defaultContent": '<span class="drill-val"><i class="fa fa-chevron-circle-down text-teal"></i></span>',

						},*/

						{

							"mDataProp": function (row, type, val, meta) {

								if (type === 'display' || type === 'filter') {

									return meta.row + 1;

								}

								return meta.row;

							}

						},

						{

							"className": 'dt-control',

							"mDataProp": function (row, type, val, meta) {

								if (row.stone_details.length > 0 || row.multi_metal_details.length > 0) {

									return '<span class="drill-val"><i class="fa fa-chevron-circle-down text-teal"></i>' + row.tag_lot_id + '</span>';

								} else {

									return '<span class="badge bg-red">' + row.tag_lot_id + '</span>';

								}

							}

						},

						{ "mDataProp": "po_ref_no" },

						{ "mDataProp": "order_no" },

						{ "mDataProp": "karigarname" },

						{

							"mDataProp": function (row, type, val, meta) {

								if (row.tag_img != null && row.tag_img != undefined && row.tag_img != '') {

									var img_src = base_url + 'assets/img/tag/' + row.tag_img;

								}

								else {

									var img_src = base_url + 'assets/img/no_image.png';

								}

								var image = "<img  class='img_src' id='img_prev' src=" + img_src + "  width='35' height='35' onClick=tag_imgprev($(this).closest('tr')) ></img>"

								return image;

							}

						},

						{ "mDataProp": "tag_code" },

						{ "mDataProp": "old_tag_id" },

						{

							"mDataProp": function (row, type, val, meta) {

								if (row.tag_code != "") {

									return row.tag_date;

								} else {

									return row.old_tag_date;

								}

							},

						},

						{ "mDataProp": "branch_name" },

						{ "mDataProp": "catname" },

						{ "mDataProp": "purity" },

						{ "mDataProp": "product_name" },

						{ "mDataProp": "design_name" },

						{ "mDataProp": "sub_design_name" },

						{ "mDataProp": "collection_name" },

						{ "mDataProp": "section_name" },

						{ "mDataProp": "huid" },

						{ "mDataProp": "piece" },

						{

							"mDataProp": function (row, type, val, meta) {

								var gross_wt = row.gross_wt;

								return money_format_india(gross_wt);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var net_wt = row.net_wt;

								return money_format_india(net_wt);

							}

						},

						{ "mDataProp": "nt_stn_pcs" },

						{

							"mDataProp": function (row, type, val, meta) {

								var nt_stn_wt = row.nt_stn_wt;

								return money_format_india(nt_stn_wt);

							}

						},

						{ "mDataProp": "dia_stn_pcs" },

						{

							"mDataProp": function (row, type, val, meta) {

								var dia_stn_wt = row.dia_stn_wt;

								return money_format_india(dia_stn_wt);

							}

						},

						{ "mDataProp": "size_name" },

						{ "mDataProp": "retail_max_wastage_percent" },

						{

							"mDataProp": function (row, type, val, meta) {

								if (row.tag_mc_type == 2) {

									return money_format_india(row.tag_mc_value);

								} else {

									return '-';

								}

							},

						},

						{

							"mDataProp": function (row, type, val, meta) {

								if (row.tag_mc_type == 1) {

									return row.tag_mc_value;

								} else {

									return '-';

								}

							},

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var sales_value = row.sales_value;

								return money_format_india(sales_value);

							}

						},

						{ "mDataProp": "attrvalues" },

						{ "mDataProp": "cert_no" },

						{ "mDataProp": "style_code" },

						{

							"mDataProp": function (row, type, val, meta) {

								return '<span class="badge bg-red">' + row.tot_est + '</span>';

							}

						},

						{ "mDataProp": "emp_name" },

						{

							"mDataProp": function (row, type, val, meta) {

								if (row.tag_code != "") {

									return row.age;

								} else {

									return row.old_age;

								}

							},

						},

						{ "mDataProp": "remark" },

					],

				});

				var anOpen = [];

				$(document).on('click', "#tag_items_list .dt-control", function () {

					var nTr = this.parentNode;

					var i = $.inArray(nTr, anOpen);

					if (i === -1) {

						//$('.drill-val', this).html('<i class="fa fa-chevron-circle-up text-teal"></i>');

						$('.drill-val i', this).toggleClass("fa-chevron-circle-down fa-chevron-circle-up");

						oTable.fnOpen(nTr, formatstoneDetails(oTable, nTr), 'details');

						anOpen.push(nTr);

					}

					else {

						//$('.drill-val', this).html('<i class="fa fa-chevron-circle-down text-teal"></i>');

						$('.drill-val i', this).toggleClass("fa-chevron-circle-up fa-chevron-circle-down");

						oTable.fnClose(nTr);

						anOpen.splice(i, 1);

					}

				});

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function formatstoneDetails(oTable, nTr) {

	var oData = oTable.fnGetData(nTr);

	var rowDetail = '';

	if (oData.stone_details.length > 0) {

		var prodTable =

			'<div class="innerDetails">' +

			'<table class="table table-responsive table-bordered text-center table-sm">' +

			'<tr class="bg-teal">' +

			'<th>Is Less Wt</th>' +

			'<th>Stone</th>' +

			'<th>Pcs</th>' +

			'<th>Weight</th>' +

			'<th>Unit</th>' +

			'<th>Rate</th>' +

			'<th>Amount</th>' +

			'</tr>';

		var st_details = oData.stone_details;

		$.each(st_details, function (idx, val) {

			var is_lesswt = val.is_apply_in_lwt == 1 ? "Yes" : "No";

			prodTable +=

				'<tr class="prod_det_btn">' +

				'<td>' + is_lesswt + '</td>' +

				'<td>' + val.stone_name + '</td>' +

				'<td>' + val.pieces + '</td>' +

				'<td>' + val.wt + '</td>' +

				'<td>' + val.uom_name + '</td>' +

				'<td>' + val.rate_per_gram + '</td>' +

				'<td>' + val.price + '</td>' +

				'</tr>';

		});

		rowDetail = prodTable + '</table></div>';

	}

	if (oData.multi_metal_details.length > 0) {

		var prodTable =

			'<div class="innerDetails">' +

			'<table class="table table-responsive table-bordered text-center table-sm">' +

			'<tr class="bg-teal">' +

			'<th>Category</th>' +

			'<th>Purity</th>' +

			'<th>Weight</th>' +

			'<th>Wastage</th>' +

			'<th>MC</th>' +

			'<th>Pcs</th>' +

			'<th>Rate</th>' +

			'<th>Amount</th>' +

			'</tr>';

		var mmet_details = oData.multi_metal_details;

		$.each(mmet_details, function (idx, val) {

			prodTable +=

				'<tr class="prod_det_btn">' +

				'<td>' + val.name + '</td>' +

				'<td>' + val.purity + '</td>' +

				'<td>' + val.grosswt + '</td>' +

				'<td>' + val.wastage + '</td>' +

				'<td>' + val.mc + '</td>' +

				'<td>' + val.pcs + '</td>' +

				'<td>' + val.rate + '</td>' +

				'<td>' + val.totalamt + '</td>' +

				'</tr>';

		});

		rowDetail = prodTable + '</table></div>';

	}

	return rowDetail;

}

function formatInnerDatastoneDetails(oData) {

	var st_details = oData.stone_details;

	var rowDetail = '';

	var prodTable =

		'<div class="innerDetails" style="margin-bottom: 20px;border-bottom: 2px solid #39cccc;">' +

		'<table class="table table-responsive table-bordered text-center table-sm">';

	/*+'<tr class="bg-teal">'+

	 '<th>Is Less Wt</th>'+

	 '<th>Stone</th>'+

	 '<th>Pcs</th>'+

	 '<th>Weight</th>'+

	 '<th>Unit</th>'+

	 '<th>Rate</th>'+

	 '<th>Amount</th>'+

	'</tr>';*/

	$.each(st_details, function (idx, val) {

		var is_lesswt = val.is_apply_in_lwt == 1 ? "Yes" : "No";

		prodTable +=

			'<tr class="prod_det_btn">' +

			'<td colspan="20"></td>' +

			'<td>' + val.stone_name + '</td>' +

			'<td>' + is_lesswt + '</td>' +

			'<td>' + val.pieces + '</td>' +

			'<td>' + val.wt + '</td>' +

			'<td>' + val.uom_name + '</td>' +

			'<td>' + val.rate_per_gram + '</td>' +

			'<td>' + val.price + '</td>' +

			'</tr>';

	});

	rowDetail = prodTable + '</table></div>';

	return rowDetail;

}

function fntaggedItemsExcelReport(export_type) {

	if (export_list.length >= 1) {

		var htmls = "";

		htmls += '<table class="table table-bordered table-striped text-center"><thead><tr class="bg-teal"><th colspan=26 style="background-color:#39cccc;text-align:center;"> Design-wise Tag Items</th></tr>'

			+ '<tr><th width="10%;">Lot No</th>'

			+ '<th width="10%;">Karigar</th>'

			+ '<th width="10%;">Tag No</th>'

			+ '<th width="10%;">Tag Date</th>'

			+ '<th width="10%;">Branch</th>'

			+ '<th width="10%;">Catgory</th>'

			+ '<th width="10%;">Product</th>'

			+ '<th width="10%;">Design</th>'

			+ '<th width="10%;">Sub Design</th>'

			+ '<th width="10%;">Pcs</th>'

			+ '<th width="10%;">Gross Wgt</th>'

			+ '<th width="10%;">Net Wgt</th>'

			+ '<th width="1%">Size/Length</th>'

			+ '<th width="10%;">Wastage</th>'

			+ '<th width="10%;">Mc Type </th>'

			+ '<th width="10%;">Mc Val </th>'

			+ '<th width="10%;">Cost</th>'

			+ '<th width="5%;">Attributes</th>'

			+ '<th width="5%;">Remark</th>'

			+ '<th width="10%;">Tot Est</th>'

			// + '<th width="5%;">St Name</th>'

			// + '<th width="5%;">Is Less</th>'

			// + '<th width="5%;">St Pcs</th>'

			// + '<th width="5%;">St Weight</th>'

			// + '<th width="5%;">UOM</th>'

			// + '<th width="5%;">Rate</th>'

			// + '<th width="5%;">St Amount</th>'

			+ '</tr></thead><tbody>';

		var textRange; var j = 0;

		$.each(export_list, function (index, val) {

			var datas = "";

			htmls += '<div class="innerDetails" style="margin-bottom: 20px;border-bottom: 2px solid #39cccc;"><table class="table table-responsive table-bordered text-center table-sm"><tr class="prod_det_btn"><td style="width: 8%;color:red;">' + val.tag_lot_id + '</td><td style="width: 8%;">' + val.karigarname + '</td><td style="width: 8%;">' + val.tag_code + '</td><td style="width: 8%;">' + val.tag_date + '</td><td style="width: 8%;">' + val.branch_name + '</td><td style="width: 8%;">' + val.catname + '</td><td style="width: 8%;">' + val.product_name + '</td><td style="width: 8%;">' + val.design_name + '</td><td style="width: 8%;">' + val.sub_design_name + '</td><td style="width: 8%;">' + val.piece + '</td><td style="width: 8%;">' + val.gross_wt + '</td><td style="width: 8%;">' + val.net_wt + '</td><td style="width: 8%;">' + val.size_name + '</td><td style="width: 8%;">' + val.retail_max_wastage_percent + '</td><td style="width: 8%;">' + val.mc_type + '</td><td style="width: 8%;">' + val.tag_mc_value + '</td><td style="width: 8%;">' + val.sales_value + '</td><td style="width: 10%;color:red;">' + val.attrvalues + '</td><td style="width: 10%;color:red;">' + val.remarks + '</td><td style="width: 10%;color:red;">' + val.tot_est + '</td></tr>';

			// <td style="width: 10%;color:red;"></td><td style="width: 10%;color:red;"></td><td style="width: 10%;color:red;"></td><td style="width: 10%;color:red;"></td><td style="width: 10%;color:red;"><td style="width: 10%;color:red;"><td style="width: 10%;color:red;"></td>

			// if (val.stone_details.length > 0 && export_type == '1') {

			// 	htmls += formatInnerDatastoneDetails(val) + '</table></div>';

			// }

		});

		htmls += '</tbody><tfoot></tfoot></table></div>';

		if (export_type == '1') {

			var uri = 'data:application/vnd.ms-excel;base64,';

			var template = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>';

			var base64 = function (s) {

				return window.btoa(unescape(encodeURIComponent(s)))

			};

			var format = function (s, c) {

				return s.replace(/{(\w+)}/g, function (m, p) {

					return c[p];

				})

			};

			var ctx = {

				worksheet: 'Worksheet',

				table: htmls

			}

			var link = document.createElement("a");

			link.download = "Design_Wise_Tagged_Items.xls";

			link.href = uri + base64(format(template, ctx));

			link.click();

		}

	}

}

function exportTableToCSV($table, filename) {

	//rescato los títulos y las filas

	var $Tabla_Nueva = $table.find('tr:has(td,th)');

	// elimino la tabla interior.

	var Tabla_Nueva2 = $Tabla_Nueva.filter(function () {

		return (this.childElementCount != 1);

	});

	var $rows = Tabla_Nueva2,

		// Temporary delimiter characters unlikely to be typed by keyboard

		// This is to avoid accidentally splitting the actual contents

		tmpColDelim = String.fromCharCode(11), // vertical tab character

		tmpRowDelim = String.fromCharCode(0), // null character

		// Solo Dios Sabe por que puse esta linea

		colDelim = (filename.indexOf("xls") != -1) ? '"\t"' : '","',

		rowDelim = '"\r\n"',

		// Grab text from table into CSV formatted string

		csv = '"' + $rows.map(function (i, row) {

			var $row = $(row);

			var $cols = $row.find('td:not(.hidden),th:not(.hidden)');

			return $cols.map(function (j, col) {

				var $col = $(col);

				var text = $col.text().replace(/\./g, '');

				return text.replace('"', '""'); // escape double quotes

			}).get().join(tmpColDelim);

			csv = csv + '"\r\n"' + 'fin ' + '"\r\n"';

		}).get().join(tmpRowDelim)

			.split(tmpRowDelim).join(rowDelim)

			.split(tmpColDelim).join(colDelim) + '"';

	download_csv(csv, filename);

}

function download_csv(csv, filename) {

	var csvFile;

	var downloadLink;

	// CSV FILE

	csvFile = new Blob([csv], { type: "text/csv" });

	// Download link

	downloadLink = document.createElement("a");

	// File name

	downloadLink.download = filename;

	// We have to create a link to the file

	downloadLink.href = window.URL.createObjectURL(csvFile);

	// Make sure that the link is not displayed

	downloadLink.style.display = "none";

	// Add the link to your DOM

	document.body.appendChild(downloadLink);

	// Lanzamos

	downloadLink.click();

}

//tag items -design wise

//stock report

function stock_report() {

	var dt_range = ($("#dt_range").val()).split('-');

	var company_name = $('#company_name').val();

	var from_date = dt_range[0];

	var to_date = dt_range[1];

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "STOCK REPORT";

	var metal = $('#metal option:selected').html() != '' && $('#metal option:selected').html() != undefined ? $('#metal option:selected').html() + " - " : '';

	var category = $('#category option:selected').html() != '' && $('#category option:selected').html() != undefined ? $('#category option:selected').html() + " - " : '';

	var prod_select = $('#prod_select option:selected').html() != '' && $('#prod_select option:selected').html() != undefined ? $('#prod_select option:selected').html() + " - " : '';

	var optional = metal + category + prod_select;

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/stock_report/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'dt_range': $("#dt_range").val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'id_product': $('#prod_select').val(), 'id_metal': $('#metal').val(), 'id_category': $('#category').val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			var non_tag_items = data.non_tag_items;

			$("#stock_list > tbody > tr").remove();

			$('#stock_list').dataTable().fnClearTable();

			$('#stock_list').dataTable().fnDestroy();

			if (list != null) {

				trHTML = '';

				tfootHTML = '';

				total_bill_amount = 0;

				total_bill_tax_value = 0;

				var total_op_blc_pcss = 0;

				var total_op_blc_gwt = 0;

				var total_op_blc_nwt = 0;

				var total_inw_pcss = 0;

				var total_inw_gwt = 0;

				var total_inw_nwt = 0;

				var total_closing_inw_pcs = 0;

				var total_closing_inw_gwt = 0;

				var total_closing_net_wt = 0;

				$.each(list, function (i, metal) {

					var metal_op_blc_pcss = 0;

					var metal_op_blc_gwt = 0;

					var metal_op_blc_nwt = 0;

					var metal_inw_pcss = 0;

					var metal_inw_gwt = 0;

					var metal_inw_nwt = 0;

					var metal_closing_inw_pcs = 0;

					var metal_closing_inw_gwt = 0;

					var metal_closing_net_wt = 0;

					$.each(metal, function (i, category) {

						var op_blc_pcss = 0;

						var op_blc_gwt = 0;

						var op_blc_nwt = 0;

						var inw_pcss = 0;

						var inw_gwt = 0;

						var inw_nwt = 0;

						var sold_pcs = 0;

						var sold_gwt = 0;

						var sold_nwt = 0;

						var other_s_pcs = 0;

						var other_s_gwt = 0;

						var other_s_nwt = 0;

						var closing_inw_pcs = 0;

						var closing_inw_gwt = 0;

						var closing_net_wt = 0;

						trHTML += '<tr>'

							+ '<td style="text-align:left;" colspan="2"><strong>' + i + '</strong></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

						'</tr>';

						$.each(category, function (idx, item) {

							op_blc_pcss += parseFloat(item.op_blc_pcs);

							op_blc_gwt += parseFloat(item.op_blc_gwt);

							op_blc_nwt += parseFloat(item.op_blc_nwt);

							//Product Inward Details

							inw_pcss += parseFloat(item.inw_pcs);

							inw_gwt += parseFloat(item.inw_gwt);

							inw_nwt += parseFloat(item.inw_nwt);

							//Product Inward Details

							//Product SOld Details

							sold_pcs += parseFloat(item.sold_pcs);

							sold_gwt += parseFloat(item.sold_gwt);

							sold_nwt += parseFloat(item.sold_nwt);

							//Product SOld Details

							//Other Outward Details

							other_s_pcs += parseFloat(item.br_out_pcs);

							other_s_gwt += parseFloat(item.br_out_gwt);

							other_s_nwt += parseFloat(item.br_out_nwt);

							//Other Outward Details

							//Product closing Details

							var closing_pcs = parseFloat(item.op_blc_pcs) + parseFloat(item.inw_pcs) - parseFloat(parseFloat(item.sold_pcs) + parseFloat(item.br_out_pcs));

							var closing_gwt = parseFloat(parseFloat(item.op_blc_gwt) + parseFloat(item.inw_gwt) - parseFloat(item.sold_gwt) - parseFloat(item.br_out_gwt)).toFixed(3);

							var closing_nwt = parseFloat(parseFloat(item.op_blc_nwt) + parseFloat(item.inw_nwt) - parseFloat(item.sold_nwt) - parseFloat(item.br_out_nwt)).toFixed(3);

							//Product closing Details

							trHTML += '<tr>'

								+ '<td style="text-align:left;">' + item.product_name + '</td>'

								+ '<td>' + money_format_india(item.op_blc_pcs) + '</td>'

								+ '<td>' + money_format_india(item.op_blc_gwt) + '</td>'

								+ '<td>' + money_format_india(item.op_blc_nwt) + '</td>'

								+ '<td>' + money_format_india(item.inw_pcs) + '</td>'

								+ '<td>' + money_format_india(item.inw_gwt) + '</td>'

								+ '<td>' + money_format_india(item.inw_nwt) + '</td>'

								+ '<td>' + money_format_india(parseFloat(parseFloat(item.sold_pcs) + parseFloat(item.br_out_pcs))) + '</td>'

								+ '<td>' + money_format_india(parseFloat(parseFloat(item.sold_gwt) + parseFloat(item.br_out_gwt)).toFixed(3)) + '</td>'

								+ '<td>' + money_format_india(parseFloat(parseFloat(item.sold_nwt) + parseFloat(item.br_out_nwt)).toFixed(3)) + '</td>'

								+ '<td>' + money_format_india(closing_pcs) + '</td>'

								+ '<td>' + money_format_india(closing_gwt) + '</td>'

								+ '<td>' + money_format_india(closing_nwt) + '</td>'

								+ '<td>' + money_format_india(item.in_trans_pcs) + '</td>'

								+ '<td>' + money_format_india(parseFloat(parseFloat(closing_pcs) + parseFloat(item.in_trans_pcs))) + '</td>'

							'</tr>';

							closing_inw_pcs += parseFloat(closing_pcs);

							closing_inw_gwt += parseFloat(closing_gwt);

							closing_net_wt += parseFloat(closing_nwt);

						});

						trHTML += '<tr style="font-weight:bold;color:red">' +

							+'<td></td>'

							+ '<td style="text-align:left;"><strong>SUB TOTAL</strong></td>'

							+ '<td>' + money_format_india(op_blc_pcss) + '</td>'

							+ '<td>' + money_format_india(parseFloat(op_blc_gwt).toFixed(3)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(op_blc_nwt).toFixed(3)) + '</td>'

							+ '<td>' + money_format_india(inw_pcss) + '</td>'

							+ '<td>' + money_format_india(parseFloat(inw_gwt).toFixed(3)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(inw_nwt).toFixed(3)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(sold_pcs + other_s_pcs)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(sold_gwt + other_s_gwt).toFixed(3)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(sold_nwt + other_s_nwt).toFixed(3)) + '</td>'

							+ '<td>' + money_format_india(closing_inw_pcs) + '</td>'

							+ '<td>' + money_format_india(parseFloat(closing_inw_gwt).toFixed(3)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(closing_net_wt).toFixed(3)) + '</td>'

							+ '<td></td>'

							+ '<td></td>'

						'</tr>';

						metal_op_blc_pcss += parseFloat(op_blc_pcss);

						metal_op_blc_gwt += parseFloat(op_blc_gwt);

						metal_op_blc_nwt += parseFloat(op_blc_nwt);

						metal_inw_pcss += parseFloat(inw_pcss);

						metal_inw_gwt += parseFloat(inw_gwt);

						metal_inw_nwt += parseFloat(inw_nwt);

						metal_closing_inw_pcs += parseFloat(closing_inw_pcs);

						metal_closing_inw_gwt += parseFloat(closing_inw_gwt);

						metal_closing_net_wt += parseFloat(closing_net_wt);

					});

					trHTML += '<tr style="font-weight:bold;color:red">' +

						+'<td></td>'

						+ '<td style="text-align:left;">TOTAL</td>'

						+ '<td>' + money_format_india(metal_op_blc_pcss) + '</td>'

						+ '<td>' + money_format_india(parseFloat(metal_op_blc_gwt).toFixed(3)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(metal_op_blc_nwt).toFixed(3)) + '</td>'

						+ '<td>' + money_format_india(metal_inw_pcss) + '</td>'

						+ '<td>' + money_format_india(parseFloat(metal_inw_gwt).toFixed(3)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(metal_inw_nwt).toFixed(3)) + '</td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td>' + money_format_india(metal_closing_inw_pcs) + '</td>'

						+ '<td>' + money_format_india(parseFloat(metal_closing_inw_gwt).toFixed(3)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(metal_closing_net_wt).toFixed(3)) + '</td>'

						+ '<td></td>'

						+ '<td></td>'

					'</tr>';

					total_op_blc_pcss += parseFloat(metal_op_blc_pcss);

					total_op_blc_gwt += parseFloat(metal_op_blc_gwt);

					total_op_blc_nwt += parseFloat(metal_op_blc_nwt);

					total_inw_pcss += parseFloat(metal_inw_pcss);

					total_inw_gwt += parseFloat(metal_inw_gwt);

					total_inw_nwt += parseFloat(metal_inw_nwt);

					total_closing_inw_pcs += parseFloat(metal_closing_inw_pcs);

					total_closing_inw_gwt += parseFloat(metal_closing_inw_gwt);

					total_closing_net_wt += parseFloat(metal_closing_net_wt);

				});

				trHTML += '<tr style="font-weight:bold;color:blue">' +

					+'<td></td>'

					+ '<td style="text-align:left;">GRAND TOTAL</td>'

					+ '<td>' + money_format_india(total_op_blc_pcss) + '</td>'

					+ '<td>' + money_format_india(parseFloat(total_op_blc_gwt).toFixed(3)) + '</td>'

					+ '<td>' + money_format_india(parseFloat(total_op_blc_nwt).toFixed(3)) + '</td>'

					+ '<td>' + money_format_india(total_inw_pcss) + '</td>'

					+ '<td>' + money_format_india(parseFloat(total_inw_gwt).toFixed(3)) + '</td>'

					+ '<td>' + money_format_india(parseFloat(total_inw_nwt).toFixed(3)) + '</td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td>' + money_format_india(total_closing_inw_pcs) + '</td>'

					+ '<td>' + money_format_india(parseFloat(total_closing_inw_gwt).toFixed(3)) + '</td>'

					+ '<td>' + money_format_india(parseFloat(total_closing_net_wt).toFixed(3)) + '</td>'

					+ '<td></td>'

					+ '<td></td>'

				'</tr>';

				$.each(non_tag_items, function (key, metal) {

					trHTML += '<tr>'

						+ '<td style="font-weight:bold;text-align:left;text-transform:uppercase;" colspan="2">Non Tag Items</td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

					'</tr>';

					$.each(metal, function (k, category) {

						trHTML += '<tr>'

							+ '<td style="font-weight:bold;text-align:left;" colspan="2">' + k + '</td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

						'</tr>';

						$.each(category, function (c, items) {

							trHTML += '<tr style="font-weight:bold;">'

								+ '<td style="font-weight:bold;text-align:left;">' + items.product_name + '</td>'

								+ '<td>' + items.op_blc_pcs + '</td>'

								+ '<td>' + items.op_blc_gwt + '</td>'

								+ '<td>' + items.op_blc_nwt + '</td>'

								+ '<td>' + items.inw_pcs + '</td>'

								+ '<td>' + items.inw_gwt + '</td>'

								+ '<td>' + items.inw_nwt + '</td>'

								+ '<td>' + items.out_pcs + '</td>'

								+ '<td>' + items.out_gwt + '</td>'

								+ '<td>' + items.out_nwt + '</td>'

								+ '<td>' + parseFloat(parseFloat(items.op_blc_pcs) + parseFloat(items.inw_pcs) - parseFloat(items.out_pcs)).toFixed(3) + '</td>'

								+ '<td>' + parseFloat(parseFloat(items.op_blc_gwt) + parseFloat(items.inw_gwt) - parseFloat(items.out_gwt)).toFixed(3) + '</td>'

								+ '<td>' + parseFloat(parseFloat(items.op_blc_nwt) + parseFloat(items.inw_nwt) - parseFloat(items.out_nwt)).toFixed(3) + '</td>'

								+ '<td></td>'

								+ '<td></td>'

							'</tr>';

						});

					});

				});

				$('#stock_list > tbody').html(trHTML);

				// Check and initialise datatable

				if (!$.fn.DataTable.isDataTable('#stock_list')) {

					oTable = $('#stock_list').dataTable({

						"bSort": false,

						"bInfo": true,

						"scrollX": '100%',

						"dom": 'lBfrtip',

						"paging": false,

						"columnDefs": [

							{

								targets: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14],

								className: 'dt-body-right'

							},

						],

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: '',

								messageTop: title,

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', 'inherit');

								},

							},

							{

								extend: 'excel',

								footer: true,

								title: 'STOCK REPORT ' + branch_name + '-' + dt_range[0] + '-' + dt_range[1],

							}

						],

					});

				}

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

$('#stock_detail_search').on('click', function () {

	get_stock_details();

});

function get_stock_details() {

	var title = '';

	$("div.overlay").css("display", "block");

	var dt_range = ($("#dt_range").val()).split('-');

	var company_name = $('#company_name').val();

	var from_date = date_format(dt_range[0].trim());

	var to_date = date_format(dt_range[1].trim());

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "STOCK REPORT";

	var category = $('#category option:selected').html() != '' && $('#category option:selected').html() != undefined ? $('#category option:selected').html() + " - " : '';

	var metal = $('#metal option:selected').html() != '' && $('#metal option:selected').html() != undefined ? $('#metal option:selected').html() + " - " : '';

	var prod_select = $('#prod_select option:selected').html() != '' && $('#prod_select option:selected').html() != undefined ? $('#prod_select option:selected').html() + " - " : '';

	var select_group_by = $('#select_group_by option:selected').html() != '' && $('#select_group_by option:selected').html() != undefined ? $('#select_group_by option:selected').html() + " - " : '';

	var optional = category + metal + prod_select + select_group_by;

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/stock_details/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'dt_range': $("#dt_range").val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()) || 0, 'id_product': $('#prod_select').val(), 'id_metal': $('#metal').val(), 'id_category': $('#category').val(), 'group_by': $('#select_group_by').val(), 'id_design': $('#des_select').val(), 'id_sub_design': $('#sub_des_select').val(), 'list_by': $('#list_by').val(), 'prod_group_id': $('#prod_group_id').val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			$('.opqty').html(data.stocksummery.openpcs);

			$('.opwt').html(parseFloat(data.stocksummery.openwt).toFixed(3));

			$('.inqty').html(data.stocksummery.inwardpcs);

			$('.inwt').html(parseFloat(data.stocksummery.inwardwt).toFixed(3));

			$('.outqty').html(data.stocksummery.outwardpcs);

			$('.outwt').html(parseFloat(data.stocksummery.outwardwt).toFixed(3));

			$('.soldqty').html(data.stocksummery.showroomsalepcs);

			$('.soldwt').html(parseFloat(data.stocksummery.showroomsalegwt).toFixed(3));

			$('.otherqty').html(data.stocksummery.otherpcs);

			$('.otherwt').html(parseFloat(data.stocksummery.othergwt).toFixed(3));

			$('.clsqty').html(data.stocksummery.closepcs);

			$('.clswt').html(parseFloat(data.stocksummery.closewt).toFixed(3));

			$('.issqty').html(data.stocksummery.issued_pcs);

			$('.isswt').html(parseFloat(data.stocksummery.issued_wt).toFixed(3));

			$('.brinqty').html(data.stocksummery.brainw_pcs);

			$('.brinwt').html(parseFloat(data.stocksummery.brainw_gwt).toFixed(3));

			$('.lotinqty').html(data.stocksummery.lotinw_pcs);

			$('.lotinwt').html(parseFloat(data.stocksummery.lotinw_gwt).toFixed(3));

			var list = data.list;

			var non_tag_items = data.non_tag_items;

			$("#stock_list > tbody > tr").remove();

			$('#stock_list').dataTable().fnClearTable();

			$('#stock_list').dataTable().fnDestroy();

			if (list != null) {

				trHTML = '';

				tfootHTML = '';

				total_bill_amount = 0;

				total_bill_tax_value = 0;

				var metal_wise_total = [];

				var total_op_blc_pcss = 0;

				var total_op_blc_gwt = 0;

				var total_op_blc_nwt = 0;

				var total_op_blc_dwt = 0;

				var total_inw_pcss = 0;

				var total_inw_gwt = 0;

				var total_inw_nwt = 0;

				var total_inw_dwt = 0;

				var total_closing_inw_pcs = 0;

				var total_closing_inw_gwt = 0;

				var total_closing_net_wt = 0;

				var total_closing_dia_wt = 0;

				var total_outward_pcs = 0;

				var total_outward_gwt = 0;

				var total_outward_nwt = 0;

				var total_outward_dwt = 0;

				var tot_nt_op_blc_pcs = 0;

				var tot_nt_op_blc_gwt = 0;

				var tot_nt_op_blc_nwt = 0;

				var tot_nt_inw_pcs = 0;

				var tot_nt_inw_gwt = 0;

				var tot_nt_inw_nwt = 0;

				var tot_nt_out_pcs = 0;

				var tot_nt_out_gwt = 0;

				var tot_nt_out_nwt = 0;

				var tot_nt_closing_pcs = 0;

				var tot_nt_closing_gwt = 0;

				var tot_nt_closing_nwt = 0;

				$.each(list, function (i, metal) {

					var metal_key = i;

					var metal_op_blc_pcss = 0;

					var metal_op_blc_gwt = 0;

					var metal_op_blc_nwt = 0;

					var metal_op_blc_dwt = 0;

					var metal_inw_pcss = 0;

					var metal_inw_gwt = 0;

					var metal_inw_nwt = 0;

					var metal_inw_dwt = 0;

					var metal_outward_pcs = 0;

					var metal_outward_gwt = 0;

					var metal_outward_nwt = 0;

					var metal_outward_dwt = 0;

					var metal_closing_inw_pcs = 0;

					var metal_closing_inw_gwt = 0;

					var metal_closing_net_wt = 0;

					var metal_closing_dia_wt = 0;

					if ($('#select_group_by').val() == 3 || $('#select_group_by').val() == 4) {

						trHTML += '<tr>'

							+ '<td style="text-align:left;" colspan="2"><strong>' + i + '</strong></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

						'</tr>';

					}

					$.each(metal, function (i, category) {

						var op_blc_pcss = 0;

						var op_blc_gwt = 0;

						var op_blc_nwt = 0;

						var op_blc_dwt = 0;

						var inw_pcss = 0;

						var inw_gwt = 0;

						var inw_nwt = 0;

						var inw_dwt = 0;

						var sold_pcs = 0;

						var sold_gwt = 0;

						var sold_nwt = 0;

						var sold_dwt = 0;

						var other_s_pcs = 0;

						var other_s_gwt = 0;

						var other_s_nwt = 0;

						var other_s_dwt = 0;

						var ret_pcs = 0;

						var ret_gwt = 0;

						var ret_nwt = 0;

						var ret_diawt = 0;

						var iss_pcs = 0;

						var iss_gwt = 0;

						var iss_nwt = 0;

						var iss_diawt = 0;

						var closing_inw_pcs = 0;

						var closing_inw_gwt = 0;

						var closing_net_wt = 0;

						var closing_dia_wt = 0;

						if ($('#select_group_by').val() == 1 || $('#select_group_by').val() == 3 || $('#select_group_by').val() == 4) {

							trHTML += '<tr>'

								+ '<td style="text-align:left;" colspan="2"><strong>' + i + '</strong></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

							'</tr>';

						}

						$.each(category, function (idx, item) {

							op_blc_pcss += parseFloat(item.op_blc_pcs);

							op_blc_gwt += parseFloat(item.op_blc_gwt);

							op_blc_nwt += parseFloat(item.op_blc_nwt);

							op_blc_dwt += parseFloat(item.op_blc_dwt);

							//Product Inward Details

							inw_pcss += parseFloat(item.inw_pcs);

							inw_gwt += parseFloat(item.inw_gwt);

							inw_nwt += parseFloat(item.inw_nwt);

							inw_dwt += parseFloat(item.inw_dwt);

							//Product Inward Details

							//Product SOld Details

							sold_pcs += parseFloat(item.sold_pcs);

							sold_gwt += parseFloat(item.sold_gwt);

							sold_nwt += parseFloat(item.sold_nwt);

							sold_dwt += parseFloat(item.sold_dwt);

							//Product SOld Details

							//Other Outward Details

							other_s_pcs += parseFloat(item.br_out_pcs);

							other_s_gwt += parseFloat(item.br_out_gwt);

							other_s_nwt += parseFloat(item.br_out_nwt);

							other_s_dwt += parseFloat(item.br_out_dwt);

							//Other Outward Details

							//Purchase Return Details

							ret_pcs += parseFloat(item.ret_pcs);

							ret_gwt += parseFloat(item.ret_gwt);

							ret_nwt += parseFloat(item.ret_nwt);

							ret_diawt += parseFloat(item.ret_diawt);

							//Purchase Return Details

							//Karigar Issue Details

							iss_pcs += parseFloat(item.iss_pcs);

							iss_gwt += parseFloat(item.iss_gwt);

							iss_nwt += parseFloat(item.iss_nwt);

							iss_diawt += parseFloat(item.iss_diawt);

							//Karigar Issue Details

							//Product closing Details

							var closing_pcs = parseFloat(item.op_blc_pcs) + parseFloat(item.inw_pcs) - parseFloat(parseFloat(item.sold_pcs) + parseFloat(item.br_out_pcs) + parseFloat(item.ret_pcs) + parseFloat(item.iss_pcs));

							var closing_gwt = parseFloat(parseFloat(item.op_blc_gwt) + parseFloat(item.inw_gwt) - parseFloat(item.sold_gwt) - parseFloat(item.br_out_gwt) - parseFloat(item.ret_gwt) - parseFloat(item.iss_gwt)).toFixed(3);

							var closing_nwt = parseFloat(parseFloat(item.op_blc_nwt) + parseFloat(item.inw_nwt) - parseFloat(item.sold_nwt) - parseFloat(item.br_out_nwt) - parseFloat(item.ret_nwt) - parseFloat(item.issue_nwt)).toFixed(3);

							var closing_dwt = parseFloat(parseFloat(item.op_blc_dwt) + parseFloat(item.inw_dwt) - parseFloat(item.sold_dwt) - parseFloat(item.br_out_dwt) - parseFloat(item.ret_diawt) - parseFloat(item.iss_diawt)).toFixed(3);

							//Product closing Details

							trHTML += '<tr>'

								+ '<td style="text-align:left;">' + ($('#select_group_by').val() == 1 ? item.product_name : ($('#select_group_by').val() == 2 ? item.category_name : ($('#select_group_by').val() == 3 ? item.weight_range : item.sub_design_name))) + '</td>'

								+ '<td>' + (item.op_blc_pcs > 0 ? item.op_blc_pcs : '') + '</td>'

								+ '<td>' + (item.op_blc_gwt > 0 ? money_format_india(parseFloat(item.op_blc_gwt).toFixed(3)) : '') + '</td>'

								+ '<td>' + (item.op_blc_nwt > 0 ? money_format_india(parseFloat(item.op_blc_nwt).toFixed(3)) : '') + '</td>'

								+ '<td>' + (item.op_blc_dwt > 0 ? money_format_india(item.op_blc_dwt) : '') + '</td>'

								+ '<td>' + (item.inw_pcs > 0 ? money_format_india(item.inw_pcs) : '') + '</td>'

								+ '<td>' + (item.inw_gwt > 0 ? money_format_india(parseFloat(item.inw_gwt).toFixed(3)) : '') + '</td>'

								+ '<td>' + (item.inw_nwt > 0 ? money_format_india(parseFloat(item.inw_nwt).toFixed(3)) : '') + '</td>'

								+ '<td>' + (item.inw_dwt > 0 ? money_format_india(item.inw_dwt) : '') + '</td>'

								+ '<td>' + (item.br_out_pcs > 0 || item.sold_pcs > 0 || item.ret_pcs > 0 || item.iss_pcs > 0 ? parseFloat(parseFloat(item.sold_pcs) + parseFloat(item.br_out_pcs) + parseFloat(item.ret_pcs) + parseFloat(item.iss_pcs)) : '') + '</td>'

								+ '<td>' + (item.sold_gwt > 0 || item.br_out_gwt > 0 || item.ret_gwt > 0 || item.iss_gwt > 0 ? money_format_india(parseFloat(parseFloat(item.sold_gwt) + parseFloat(item.br_out_gwt) + parseFloat(item.ret_gwt) + parseFloat(item.iss_gwt)).toFixed(3)) : '') + '</td>'

								+ '<td>' + (item.br_out_nwt > 0 || item.sold_nwt > 0 || item.ret_nwt > 0 || item.iss_nwt > 0 ? money_format_india(parseFloat(parseFloat(item.sold_nwt) + parseFloat(item.br_out_nwt) + parseFloat(item.ret_nwt) + parseFloat(item.iss_nwt)).toFixed(3)) : '') + '</td>'

								+ '<td>' + (item.br_out_dwt > 0 || item.sold_dwt > 0 || item.ret_diawt > 0 || item.iss_diawt > 0 ? money_format_india(parseFloat(parseFloat(item.sold_dwt) + parseFloat(item.br_out_dwt) + parseFloat(item.ret_diawt) + parseFloat(item.iss_diawt)).toFixed(3)) : '') + '</td>'

								+ '<td>' + (closing_pcs > 0 ? closing_pcs : '') + '</td>'

								+ '<td>' + (closing_gwt > 0 ? money_format_india(closing_gwt) : '') + '</td>'

								+ '<td>' + (closing_nwt > 0 ? money_format_india(closing_nwt) : '') + '</td>'

								+ '<td>' + (closing_dwt > 0 ? money_format_india(closing_dwt) : '') + '</td>'

								+ '<td>' + (item.in_trans_pcs > 0 ? item.in_trans_pcs : '') + '</td>'

								+ '<td>' + (item.in_trans_pcs > 0 || closing_pcs > 0 ? money_format_india(parseFloat(parseFloat(closing_pcs) + parseFloat(item.in_trans_pcs))) : '') + '</td>'

							'</tr>';

							closing_inw_pcs += parseFloat(closing_pcs);

							closing_inw_gwt += parseFloat(closing_gwt);

							closing_net_wt += parseFloat(closing_nwt);

							closing_dia_wt += parseFloat(closing_dwt);

						});

						if ($('#select_group_by').val() == 1 || $('#select_group_by').val() == 3 || $('#select_group_by').val() == 4) {

							trHTML += '<tr style="font-weight:bold;color:red">' +

								+ '<td></td>'

								+ '<td style="text-align:left;"><strong>SUB TOTAL</strong></td>'

								+ '<td>' + (op_blc_pcss > 0 ? op_blc_pcss : '') + '</td>'

								+ '<td>' + (op_blc_gwt > 0 ? money_format_india(parseFloat(op_blc_gwt).toFixed(3)) : '') + '</td>'

								+ '<td>' + (op_blc_nwt > 0 ? money_format_india(parseFloat(op_blc_nwt).toFixed(3)) : '') + '</td>'

								+ '<td>' + (op_blc_dwt > 0 ? money_format_india(parseFloat(op_blc_dwt).toFixed(3)) : '') + '</td>'

								+ '<td>' + (inw_pcss > 0 ? money_format_india(inw_pcss) : '') + '</td>'

								+ '<td>' + (inw_gwt > 0 ? money_format_india(parseFloat(inw_gwt).toFixed(3)) : '') + '</td>'

								+ '<td>' + (inw_nwt > 0 ? money_format_india(parseFloat(inw_nwt).toFixed(3)) : '') + '</td>'

								+ '<td>' + (inw_dwt > 0 ? money_format_india(parseFloat(inw_dwt).toFixed(3)) : '') + '</td>'

								+ '<td>' + (sold_pcs + other_s_pcs + ret_pcs + iss_pcs > 0 ? money_format_india(parseFloat(sold_pcs + other_s_pcs + ret_pcs + iss_pcs)) : '') + '</td>'

								+ '<td>' + (sold_gwt + other_s_gwt + ret_gwt + iss_gwt > 0 ? money_format_india(parseFloat(sold_gwt + other_s_gwt + ret_gwt + iss_gwt).toFixed(3)) : '') + '</td>'

								+ '<td>' + (sold_nwt + other_s_nwt + ret_nwt + iss_nwt > 0 ? money_format_india(parseFloat(sold_nwt + other_s_nwt + ret_nwt + iss_nwt).toFixed(3)) : '') + '</td>'

								+ '<td>' + (sold_dwt + other_s_dwt + ret_diawt + iss_diawt > 0 ? money_format_india(parseFloat(sold_dwt + other_s_dwt + ret_diawt + iss_diawt).toFixed(3)) : '') + '</td>'

								+ '<td>' + (closing_inw_pcs > 0 ? money_format_india(closing_inw_pcs) : '') + '</td>'

								+ '<td>' + (closing_inw_gwt > 0 ? money_format_india(parseFloat(closing_inw_gwt).toFixed(3)) : '') + '</td>'

								+ '<td>' + (closing_net_wt > 0 ? money_format_india(parseFloat(closing_net_wt).toFixed(3)) : '') + '</td>'

								+ '<td>' + (closing_dia_wt > 0 ? money_format_india(parseFloat(closing_dia_wt).toFixed(3)) : '') + '</td>'

								+ '<td></td>'

								+ '<td></td>'

							'</tr>';

						}

						metal_op_blc_pcss += parseFloat(op_blc_pcss);

						metal_op_blc_gwt += parseFloat(op_blc_gwt);

						metal_op_blc_nwt += parseFloat(op_blc_nwt);

						metal_op_blc_dwt += parseFloat(op_blc_dwt);

						metal_inw_pcss += parseFloat(inw_pcss);

						metal_inw_gwt += parseFloat(inw_gwt);

						metal_inw_nwt += parseFloat(inw_nwt);

						metal_inw_dwt += parseFloat(inw_dwt);

						metal_outward_pcs += parseFloat(sold_pcs + other_s_pcs + ret_pcs + iss_pcs);

						metal_outward_gwt += parseFloat(sold_gwt + other_s_gwt + ret_gwt + iss_gwt);

						metal_outward_nwt += parseFloat(sold_nwt + other_s_nwt + ret_nwt + iss_nwt);

						metal_outward_dwt += parseFloat(sold_dwt + other_s_dwt + ret_diawt + iss_diawt);

						metal_closing_inw_pcs += parseFloat(closing_inw_pcs);

						metal_closing_inw_gwt += parseFloat(closing_inw_gwt);

						metal_closing_net_wt += parseFloat(closing_net_wt);

						metal_closing_dia_wt += parseFloat(closing_dia_wt);

					});

					if ($('#select_group_by').val() == 1 || $('#select_group_by').val() == 3 || $('#select_group_by').val() == 4) {

						trHTML += '<tr style="font-weight:bold;color:red">' +

							+ '<td></td>'

							+ '<td style="text-align:left;">TOTAL</td>'

							+ '<td>' + (metal_op_blc_pcss > 0 ? money_format_india(metal_op_blc_pcss) : '') + '</td>'

							+ '<td>' + (metal_op_blc_gwt > 0 ? money_format_india(parseFloat(metal_op_blc_gwt).toFixed(3)) : '') + '</td>'

							+ '<td>' + (metal_op_blc_nwt > 0 ? money_format_india(parseFloat(metal_op_blc_nwt).toFixed(3)) : '') + '</td>'

							+ '<td>' + (metal_op_blc_dwt > 0 ? money_format_india(parseFloat(metal_op_blc_dwt).toFixed(3)) : '') + '</td>'

							+ '<td>' + (metal_inw_pcss > 0 ? money_format_india(metal_inw_pcss) : '') + '</td>'

							+ '<td>' + (metal_inw_gwt > 0 ? money_format_india(parseFloat(metal_inw_gwt).toFixed(3)) : '') + '</td>'

							+ '<td>' + (metal_inw_nwt > 0 ? money_format_india(parseFloat(metal_inw_nwt).toFixed(3)) : '') + '</td>'

							+ '<td>' + (metal_inw_dwt > 0 ? money_format_india(parseFloat(metal_inw_dwt).toFixed(3)) : '') + '</td>'

							+ '<td>' + (metal_outward_pcs > 0 ? money_format_india(parseFloat(metal_outward_pcs)) : '') + '</td>'

							+ '<td>' + (metal_outward_gwt > 0 ? money_format_india(parseFloat(metal_outward_gwt).toFixed(3)) : '') + '</td>'

							+ '<td>' + (metal_outward_nwt > 0 ? money_format_india(parseFloat(metal_outward_nwt).toFixed(3)) : '') + '</td>'

							+ '<td>' + (metal_outward_dwt > 0 ? money_format_india(parseFloat(metal_outward_dwt).toFixed(3)) : '') + '</td>'

							+ '<td>' + (metal_closing_inw_pcs > 0 ? money_format_india(metal_closing_inw_pcs) : '') + '</td>'

							+ '<td>' + (metal_closing_inw_gwt > 0 ? money_format_india(parseFloat(metal_closing_inw_gwt).toFixed(3)) : '') + '</td>'

							+ '<td>' + (metal_closing_net_wt > 0 ? money_format_india(parseFloat(metal_closing_net_wt).toFixed(3)) : '') + '</td>'

							+ '<td>' + (metal_closing_dia_wt > 0 ? money_format_india(parseFloat(metal_closing_dia_wt).toFixed(3)) : '') + '</td>'

							+ '<td></td>'

							+ '<td></td>'

						'</tr>';

					}

					var metal_wise_sum = {

						"metal_op_blc_pcss": metal_op_blc_pcss,

						"metal_op_blc_gwt": parseFloat(metal_op_blc_gwt).toFixed(3),

						"metal_op_blc_nwt": parseFloat(metal_op_blc_nwt).toFixed(3),

						"metal_op_blc_dwt": parseFloat(metal_op_blc_dwt).toFixed(3),

						"metal_inw_pcss": metal_inw_pcss,

						"metal_inw_gwt": parseFloat(metal_inw_gwt).toFixed(3),

						"metal_inw_nwt": parseFloat(metal_inw_nwt).toFixed(3),

						"metal_inw_dwt": parseFloat(metal_inw_dwt).toFixed(3),

						"metal_outward_pcs": parseFloat(metal_outward_pcs),

						"metal_outward_gwt": parseFloat(metal_outward_gwt).toFixed(3),

						"metal_outward_nwt": parseFloat(metal_outward_nwt).toFixed(3),

						"metal_outward_dwt": parseFloat(metal_outward_dwt).toFixed(3),

						"metal_closing_inw_pcs": metal_closing_inw_pcs,

						"metal_closing_inw_gwt": parseFloat(metal_closing_inw_gwt).toFixed(3),

						"metal_closing_net_wt": parseFloat(metal_closing_net_wt).toFixed(3),

						"metal_closing_dia_wt": parseFloat(metal_closing_dia_wt).toFixed(3),

					};

					metal_wise_total[metal_key] = metal_wise_sum;

					total_op_blc_pcss += parseFloat(metal_op_blc_pcss);

					total_op_blc_gwt += parseFloat(metal_op_blc_gwt);

					total_op_blc_nwt += parseFloat(metal_op_blc_nwt);

					total_op_blc_dwt += parseFloat(metal_closing_dia_wt);

					total_inw_pcss += parseFloat(metal_inw_pcss);

					total_inw_gwt += parseFloat(metal_inw_gwt);

					total_inw_nwt += parseFloat(metal_inw_nwt);

					total_inw_dwt += parseFloat(metal_inw_dwt);

					total_outward_pcs += parseFloat(metal_outward_pcs);

					total_outward_gwt += parseFloat(metal_outward_gwt);

					total_outward_nwt += parseFloat(metal_outward_nwt);

					total_outward_dwt += parseFloat(metal_outward_dwt);

					total_closing_inw_pcs += parseFloat(metal_closing_inw_pcs);

					total_closing_inw_gwt += parseFloat(metal_closing_inw_gwt);

					total_closing_net_wt += parseFloat(metal_closing_net_wt);

					total_closing_dia_wt += parseFloat(metal_closing_dia_wt);

				});

				if ($('#list_by').val() != 2) {

					trHTML += '<tr style="font-weight:bold;color:blue">' +

						+ '<td></td>'

						+ '<td style="text-align:left;">TAG TOTAL</td>'

						+ '<td>' + (total_op_blc_pcss > 0 ? money_format_india(total_op_blc_pcss) : '') + '</td>'

						+ '<td>' + (total_op_blc_gwt > 0 ? money_format_india(parseFloat(total_op_blc_gwt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (total_op_blc_nwt > 0 ? money_format_india(parseFloat(total_op_blc_nwt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (total_op_blc_dwt > 0 ? money_format_india(parseFloat(total_op_blc_dwt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (total_inw_pcss > 0 ? money_format_india(total_inw_pcss) : '') + '</td>'

						+ '<td>' + (total_inw_gwt > 0 ? money_format_india(parseFloat(total_inw_gwt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (total_inw_nwt > 0 ? money_format_india(parseFloat(total_inw_nwt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (total_inw_dwt > 0 ? money_format_india(parseFloat(total_inw_dwt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (total_outward_pcs > 0 ? money_format_india(parseFloat(total_outward_pcs)) : '') + '</td>'

						+ '<td>' + (total_outward_gwt > 0 ? money_format_india(parseFloat(total_outward_gwt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (total_outward_nwt > 0 ? money_format_india(parseFloat(total_outward_nwt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (total_outward_dwt > 0 ? money_format_india(parseFloat(total_outward_dwt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (total_closing_inw_pcs > 0 ? money_format_india(total_closing_inw_pcs) : '') + '</td>'

						+ '<td>' + (total_closing_inw_gwt > 0 ? money_format_india(parseFloat(total_closing_inw_gwt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (total_closing_net_wt > 0 ? money_format_india(parseFloat(total_closing_net_wt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (total_closing_dia_wt > 0 ? money_format_india(parseFloat(total_closing_dia_wt).toFixed(3)) : '') + '</td>'

						+ '<td></td>'

						+ '<td></td>'

					'</tr>';

				}

				if (non_tag_items != '') {

					trHTML += '<tr>'

						+ '<td style="font-weight:bold;text-align:left;text-transform:uppercase;" colspan="2">Non Tag Items</td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

					'</tr>';

					$.each(non_tag_items, function (key, metal) {

						var metal_key = key;

						var nt_metal_op_blc_pcss = 0;

						var nt_metal_op_blc_gwt = 0;

						var nt_metal_op_blc_nwt = 0;

						var nt_metal_inw_pcss = 0;

						var nt_metal_inw_gwt = 0;

						var nt_metal_inw_nwt = 0;

						var nt_metal_closing_inw_pcs = 0;

						var nt_metal_closing_inw_gwt = 0;

						var nt_metal_closing_net_wt = 0;

						var nt_metal_outward_pcs = 0;

						var nt_metal_outward_gwt = 0;

						var nt_metal_outward_nwt = 0;

						if ($('#select_group_by').val() == 4) {

							trHTML += '<tr>'

								+ '<td style="font-weight:bold;text-align:left;" colspan="2">' + key + '</td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

							'</tr>';

						}

						$.each(metal, function (k, category) {

							var tot_op_blc_pcs = 0;

							var tot_op_blc_gwt = 0;

							var tot_op_blc_nwt = 0;

							var tot_inw_pcs = 0;

							var tot_inw_gwt = 0;

							var tot_inw_nwt = 0;

							var tot_out_pcs = 0;

							var tot_out_gwt = 0;

							var tot_out_nwt = 0;

							var tot_closing_pcs = 0;

							var tot_closing_gwt = 0;

							var tot_closing_nwt = 0;

							if ($('#select_group_by').val() == 1 || $('#select_group_by').val() == 4) {

								trHTML += '<tr>'

									+ '<td style="font-weight:bold;text-align:left;" colspan="2">' + k + '</td>'

									+ '<td></td>'

									+ '<td></td>'

									+ '<td></td>'

									+ '<td></td>'

									+ '<td></td>'

									+ '<td></td>'

									+ '<td></td>'

									+ '<td></td>'

									+ '<td></td>'

									+ '<td></td>'

									+ '<td></td>'

									+ '<td></td>'

									+ '<td></td>'

									+ '<td></td>'

									+ '<td></td>'

									+ '<td></td>'

									+ '<td></td>'

									+ '<td></td>'

								'</tr>';

							}

							$.each(category, function (c, items) {

								tot_op_blc_pcs += parseFloat(items.op_blc_pcs);

								tot_op_blc_gwt += parseFloat(items.op_blc_gwt);

								tot_op_blc_nwt += parseFloat(items.op_blc_nwt);

								tot_inw_pcs += parseFloat(items.inw_pcs);

								tot_inw_gwt += parseFloat(items.inw_gwt);

								tot_inw_nwt += parseFloat(items.inw_nwt);

								tot_out_pcs += parseFloat(parseFloat(items.sales_pcs) + parseFloat(items.br_out_pcs));

								tot_out_gwt += parseFloat(parseFloat(items.sales_gwt) + parseFloat(items.br_out_gwt));

								tot_out_nwt += parseFloat(parseFloat(items.sales_nwt) + parseFloat(items.br_out_nwt));

								tot_closing_pcs += parseFloat(parseFloat(items.op_blc_pcs) + parseFloat(items.inw_pcs) - parseFloat(items.sales_pcs) - parseFloat(items.br_out_pcs));

								tot_closing_gwt += parseFloat(parseFloat(items.op_blc_gwt) + parseFloat(items.inw_gwt) - parseFloat(items.sales_gwt) - parseFloat(items.br_out_gwt));

								tot_closing_nwt += parseFloat(parseFloat(items.op_blc_nwt) + parseFloat(items.inw_nwt) - parseFloat(items.sales_nwt) - parseFloat(items.br_out_nwt));

								tot_nt_op_blc_pcs += parseFloat(items.op_blc_pcs);

								tot_nt_op_blc_gwt += parseFloat(items.op_blc_gwt);

								tot_nt_op_blc_nwt += parseFloat(items.op_blc_nwt);

								tot_nt_inw_pcs += parseFloat(items.inw_pcs);

								tot_nt_inw_gwt += parseFloat(items.inw_gwt);

								tot_nt_inw_nwt += parseFloat(items.inw_nwt);

								tot_nt_out_pcs += parseFloat(parseFloat(items.sales_pcs) + parseFloat(items.br_out_pcs));

								tot_nt_out_gwt += parseFloat(parseFloat(items.sales_gwt) + parseFloat(items.br_out_gwt));

								tot_nt_out_nwt += parseFloat(parseFloat(items.sales_nwt) + parseFloat(items.br_out_nwt));

								tot_nt_closing_pcs += parseFloat(parseFloat(items.op_blc_pcs) + parseFloat(items.inw_pcs) - parseFloat(items.sales_pcs) - parseFloat(items.br_out_pcs));

								tot_nt_closing_gwt += parseFloat(parseFloat(items.op_blc_gwt) + parseFloat(items.inw_gwt) - parseFloat(items.sales_gwt) - parseFloat(items.br_out_gwt));

								tot_nt_closing_nwt += parseFloat(parseFloat(items.op_blc_nwt) + parseFloat(items.inw_nwt) - parseFloat(items.sales_nwt) - parseFloat(items.br_out_nwt));

								trHTML += '<tr style="font-weight:bold;">'

									// + '<td style="font-weight:bold;text-align:left;">' + ($('#select_group_by').val() == 1 ? items.product_name :items.category_name ) + '</td>'

									+ '<td style="font-weight:bold;text-align:left;">' + ($('#select_group_by').val() == 1 ? items.product_name : ($('#select_group_by').val() == 2 ? items.category_name : ($('#select_group_by').val() == 3 ? items.section_name : items.sub_design_name))) + '</td>'

									+ '<td>' + (items.op_blc_pcs > 0 ? money_format_india(items.op_blc_pcs) : '') + '</td>'

									+ '<td>' + (items.op_blc_gwt > 0 ? money_format_india(parseFloat(items.op_blc_gwt).toFixed(3)) : '') + '</td>'

									+ '<td>' + (items.op_blc_nwt > 0 ? money_format_india(parseFloat(items.op_blc_nwt).toFixed(3)) : '') + '</td>'

									+ '<td></td>'

									+ '<td>' + (items.inw_pcs > 0 ? money_format_india(items.inw_pcs) : '') + '</td>'

									+ '<td>' + (items.inw_gwt > 0 ? money_format_india(parseFloat(items.inw_gwt).toFixed(3)) : '') + '</td>'

									+ '<td>' + (items.inw_nwt > 0 ? money_format_india(parseFloat(items.inw_nwt).toFixed(3)) : '') + '</td>'

									+ '<td></td>'

									+ '<td>' + (parseFloat(items.sales_pcs) + parseFloat(items.br_out_pcs) > 0 ? money_format_india(parseFloat(parseFloat(items.sales_pcs) + parseFloat(items.br_out_pcs))) : '') + '</td>'

									+ '<td>' + (parseFloat(items.sales_gwt) + parseFloat(items.br_out_gwt) > 0 ? money_format_india(parseFloat(parseFloat(items.sales_gwt) + parseFloat(items.br_out_gwt)).toFixed(3)) : '') + '</td>'

									+ '<td>' + (parseFloat(items.sales_nwt) + parseFloat(items.br_out_nwt) > 0 ? money_format_india(parseFloat(parseFloat(items.sales_nwt) + parseFloat(items.br_out_nwt)).toFixed(3)) : '') + '</td>'

									+ '<td></td>'

									+ '<td>' + (parseFloat(items.op_blc_pcs) + parseFloat(items.inw_pcs) - parseFloat(items.sales_pcs) - parseFloat(items.br_out_pcs) > 0 ? money_format_india(parseFloat(parseFloat(items.op_blc_pcs) + parseFloat(items.inw_pcs) - parseFloat(items.sales_pcs) - parseFloat(items.br_out_pcs)).toFixed(0)) : '') + '</td>'

									+ '<td>' + (parseFloat(items.op_blc_gwt) + parseFloat(items.inw_gwt) - parseFloat(items.sales_gwt) - parseFloat(items.br_out_gwt) > 0 ? money_format_india(parseFloat(parseFloat(items.op_blc_gwt) + parseFloat(items.inw_gwt) - parseFloat(items.sales_gwt) - parseFloat(items.br_out_gwt)).toFixed(3)) : '') + '</td>'

									+ '<td>' + (parseFloat(items.op_blc_nwt) + parseFloat(items.inw_nwt) - parseFloat(items.sales_nwt) - parseFloat(items.br_out_nwt) > 0 ? money_format_india(parseFloat(parseFloat(items.op_blc_nwt) + parseFloat(items.inw_nwt) - parseFloat(items.sales_nwt) - parseFloat(items.br_out_nwt)).toFixed(3)) : '') + '</td>'

									+ '<td></td>'

									+ '<td></td>'

									+ '<td></td>'

								'</tr>';

								nt_metal_op_blc_pcss += parseFloat(items.op_blc_pcs);

								nt_metal_op_blc_gwt += parseFloat(items.op_blc_gwt);

								nt_metal_op_blc_nwt += parseFloat(items.op_blc_nwt);

								nt_metal_inw_pcss += parseFloat(items.inw_pcs);

								nt_metal_inw_gwt += parseFloat(items.inw_gwt);

								nt_metal_inw_nwt += parseFloat(items.inw_nwt);

								nt_metal_closing_inw_pcs += (parseFloat(parseFloat(items.sales_pcs) + parseFloat(items.br_out_pcs)));

								nt_metal_closing_inw_gwt += parseFloat((parseFloat(items.sales_gwt) + parseFloat(items.br_out_gwt)).toFixed(3));

								nt_metal_closing_net_wt += parseFloat((parseFloat(items.sales_nwt) + parseFloat(items.br_out_nwt)).toFixed(3));

								nt_metal_outward_pcs += parseFloat((parseFloat(items.op_blc_pcs) + parseFloat(items.inw_pcs) - parseFloat(items.sales_pcs) - parseFloat(items.br_out_pcs)).toFixed(0));

								nt_metal_outward_gwt += parseFloat((parseFloat(items.op_blc_gwt) + parseFloat(items.inw_gwt) - parseFloat(items.sales_gwt) - parseFloat(items.br_out_gwt)).toFixed(3));

								nt_metal_outward_nwt += parseFloat((parseFloat(items.op_blc_nwt) + parseFloat(items.inw_nwt) - parseFloat(items.sales_nwt) - parseFloat(items.br_out_nwt)).toFixed(3));

							});

							if ($('#select_group_by').val() == 1 || $('#select_group_by').val() == 3 || $('#select_group_by').val() == 4) {

								trHTML += '<tr style="font-weight:bold;color:red">'

									+ '<td style="font-weight:bold;text-align:left;"><strong>SUB TOTAL</strong></td>'

									+ '<td>' + (parseFloat(tot_op_blc_pcs) > 0 ? money_format_india(parseFloat(tot_op_blc_pcs)) : '') + '</td>'

									+ '<td>' + (parseFloat(tot_op_blc_gwt) > 0 ? money_format_india(parseFloat(tot_op_blc_gwt).toFixed(3)) : '') + '</td>'

									+ '<td>' + (parseFloat(tot_op_blc_nwt) > 0 ? money_format_india(parseFloat(tot_op_blc_nwt).toFixed(3)) : '') + '</td>'

									+ '<td></td>'

									+ '<td>' + (parseFloat(tot_inw_pcs) > 0 ? money_format_india(parseFloat(tot_inw_pcs)) : '') + '</td>'

									+ '<td>' + (parseFloat(tot_inw_gwt) > 0 ? money_format_india(parseFloat(tot_inw_gwt).toFixed(3)) : '') + '</td>'

									+ '<td>' + (parseFloat(tot_inw_nwt) > 0 ? money_format_india(parseFloat(tot_inw_nwt).toFixed(3)) : '') + '</td>'

									+ '<td></td>'

									+ '<td>' + (parseFloat(tot_out_pcs) > 0 ? money_format_india(parseFloat(tot_out_pcs)) : '') + '</td>'

									+ '<td>' + (parseFloat(tot_out_gwt) > 0 ? money_format_india(parseFloat(tot_out_gwt).toFixed(3)) : '') + '</td>'

									+ '<td>' + (parseFloat(tot_out_nwt) > 0 ? money_format_india(parseFloat(tot_out_nwt).toFixed(3)) : '') + '</td>'

									+ '<td></td>'

									+ '<td>' + (parseFloat(tot_closing_pcs) > 0 ? money_format_india(parseFloat(tot_closing_pcs)) : '') + '</td>'

									+ '<td>' + (parseFloat(tot_closing_gwt) > 0 ? money_format_india(parseFloat(tot_closing_gwt).toFixed(3)) : '') + '</td>'

									+ '<td>' + (parseFloat(tot_closing_nwt) > 0 ? money_format_india(parseFloat(tot_closing_nwt).toFixed(3)) : '') + '</td>'

									+ '<td></td>'

									+ '<td></td>'

									+ '<td></td>'

								'</tr>';

							}

						});

						let has_metal_already = 0;

						for (var mwt in metal_wise_total) {

							if (mwt == metal_key) {

								has_metal_already = 1;

								$.each(metal_wise_total[mwt], function (keys, values) {

									if (keys == "metal_op_blc_pcss") {

										metal_wise_total[mwt].metal_op_blc_pcss = (parseFloat(values) + parseFloat(nt_metal_op_blc_pcss))

									}

									if (keys == "metal_op_blc_gwt") {

										metal_wise_total[mwt].metal_op_blc_gwt = (parseFloat(values) + parseFloat(nt_metal_op_blc_gwt)).toFixed(3)

									}

									if (keys == "metal_op_blc_nwt") {

										metal_wise_total[mwt].metal_op_blc_nwt = (parseFloat(values) + parseFloat(nt_metal_op_blc_nwt)).toFixed(3)

									}

									if (keys == "metal_inw_pcss") {

										metal_wise_total[mwt].metal_inw_pcss = (parseFloat(values) + parseFloat(nt_metal_inw_pcss));

									}

									if (keys == "metal_inw_gwt") {

										metal_wise_total[mwt].metal_inw_gwt = (parseFloat(values) + parseFloat(nt_metal_inw_gwt)).toFixed(3);

									}

									if (keys == "metal_inw_nwt") {

										metal_wise_total[mwt].metal_inw_nwt = (parseFloat(values) + parseFloat(nt_metal_inw_nwt)).toFixed(3);

									}

									if (keys == "metal_outward_pcs") {

										metal_wise_total[mwt].metal_outward_pcs = (parseFloat(values) + parseFloat(nt_metal_closing_inw_pcs));

									}

									if (keys == "metal_outward_gwt") {

										metal_wise_total[mwt].metal_outward_gwt = (parseFloat(values) + parseFloat(nt_metal_closing_inw_gwt)).toFixed(3);

									}

									if (keys == "metal_outward_nwt") {

										metal_wise_total[mwt].metal_outward_nwt = (parseFloat(values) + parseFloat(nt_metal_closing_net_wt)).toFixed(3);

									}

									if (keys == "metal_closing_inw_pcs") {

										metal_wise_total[mwt].metal_closing_inw_pcs = (parseFloat(values) + parseFloat(nt_metal_outward_pcs));

									}

									if (keys == "metal_closing_inw_gwt") {

										metal_wise_total[mwt].metal_closing_inw_gwt = (parseFloat(values) + parseFloat(nt_metal_outward_gwt)).toFixed(3);

									}

									if (keys == "metal_closing_net_wt") {

										metal_wise_total[mwt].metal_closing_net_wt = (parseFloat(values) + parseFloat(nt_metal_outward_nwt)).toFixed(3);

									}

								});

							}

						}

						if (has_metal_already == 0) {

							var metal_wise_sum = {

								"metal_op_blc_pcss": nt_metal_op_blc_pcss,

								"metal_op_blc_gwt": nt_metal_op_blc_gwt,

								"metal_op_blc_nwt": nt_metal_op_blc_nwt,

								"metal_inw_pcss": nt_metal_inw_pcss,

								"metal_inw_gwt": nt_metal_inw_gwt,

								"metal_inw_nwt": nt_metal_inw_nwt,

								"metal_outward_pcs": nt_metal_closing_inw_pcs,

								"metal_outward_gwt": nt_metal_closing_inw_gwt,

								"metal_outward_nwt": nt_metal_closing_net_wt,

								"metal_closing_inw_pcs": nt_metal_outward_pcs,

								"metal_closing_inw_gwt": nt_metal_outward_gwt,

								"metal_closing_net_wt": nt_metal_outward_nwt

							}

							metal_wise_total[metal_key] = metal_wise_sum;

						}

					});

					trHTML += '<tr style="font-weight:bold;color:blue">'

						+ '<td style="font-weight:bold;text-align:left;"><strong>NON TAG TOTAL</strong></td>'

						+ '<td>' + (parseFloat(tot_nt_op_blc_pcs) > 0 ? money_format_india(parseFloat(tot_nt_op_blc_pcs)) : '') + '</td>'

						+ '<td>' + (parseFloat(tot_nt_op_blc_gwt) > 0 ? money_format_india(parseFloat(tot_nt_op_blc_gwt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (parseFloat(tot_nt_op_blc_nwt) > 0 ? money_format_india(parseFloat(tot_nt_op_blc_nwt).toFixed(3)) : '') + '</td>'

						+ '<td></td>'

						+ '<td>' + (parseFloat(tot_nt_inw_pcs) > 0 ? money_format_india(parseFloat(tot_nt_inw_pcs)) : '') + '</td>'

						+ '<td>' + (parseFloat(tot_nt_inw_gwt) > 0 ? money_format_india(parseFloat(tot_nt_inw_gwt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (parseFloat(tot_nt_inw_nwt) > 0 ? money_format_india(parseFloat(tot_nt_inw_nwt).toFixed(3)) : '') + '</td>'

						+ '<td></td>'

						+ '<td>' + (parseFloat(tot_nt_out_pcs) > 0 ? money_format_india(parseFloat(tot_nt_out_pcs)) : '') + '</td>'

						+ '<td>' + (parseFloat(tot_nt_out_gwt) > 0 ? money_format_india(parseFloat(tot_nt_out_gwt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (parseFloat(tot_nt_out_nwt) > 0 ? money_format_india(parseFloat(tot_nt_out_nwt).toFixed(3)) : '') + '</td>'

						+ '<td></td>'

						+ '<td>' + (parseFloat(tot_nt_closing_pcs) > 0 ? money_format_india(parseFloat(tot_nt_closing_pcs)) : '') + '</td>'

						+ '<td>' + (parseFloat(tot_nt_closing_gwt) > 0 ? money_format_india(parseFloat(tot_nt_closing_gwt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (parseFloat(tot_nt_closing_nwt) > 0 ? money_format_india(parseFloat(tot_nt_closing_nwt).toFixed(3)) : '') + '</td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

					'</tr>';

				}

				trHTML += '<tr style="font-weight:bold;color:#FFA500">'

					+ '<td style="font-weight:bold;text-align:left;"><strong>GRAND TOTAL</strong></td>'

					+ '<td>' + (parseFloat(total_op_blc_pcss + tot_nt_op_blc_pcs) > 0 ? money_format_india(parseFloat(total_op_blc_pcss + tot_nt_op_blc_pcs)) : '') + '</td>'

					+ '<td>' + (parseFloat(tot_nt_op_blc_gwt + total_op_blc_gwt) > 0 ? money_format_india(parseFloat(tot_nt_op_blc_gwt + total_op_blc_gwt).toFixed(3)) : '') + '</td>'

					+ '<td>' + (parseFloat(tot_nt_op_blc_nwt + total_op_blc_nwt) > 0 ? money_format_india(parseFloat(tot_nt_op_blc_nwt + total_op_blc_nwt).toFixed(3)) : '') + '</td>'

					+ '<td>' + (parseFloat(total_op_blc_dwt) > 0 ? money_format_india(parseFloat(total_op_blc_dwt).toFixed(3)) : '') + '</td>'

					+ '<td>' + (parseFloat(tot_nt_inw_pcs + total_inw_pcss) > 0 ? money_format_india(parseFloat(tot_nt_inw_pcs + total_inw_pcss)) : '') + '</td>'

					+ '<td>' + (parseFloat(tot_nt_inw_gwt + total_inw_gwt) > 0 ? money_format_india(parseFloat(tot_nt_inw_gwt + total_inw_gwt).toFixed(3)) : '') + '</td>'

					+ '<td>' + (parseFloat(tot_nt_inw_nwt + total_inw_nwt) > 0 ? money_format_india(parseFloat(tot_nt_inw_nwt + total_inw_nwt).toFixed(3)) : '') + '</td>'

					+ '<td>' + (parseFloat(total_inw_dwt) > 0 ? money_format_india(parseFloat(total_inw_dwt).toFixed(3)) : '') + '</td>'

					+ '<td>' + (parseFloat(tot_nt_out_pcs + total_outward_pcs) > 0 ? money_format_india(parseFloat(tot_nt_out_pcs + total_outward_pcs)) : '') + '</td>'

					+ '<td>' + (parseFloat(tot_nt_out_gwt + total_outward_gwt) > 0 ? money_format_india(parseFloat(tot_nt_out_gwt + total_outward_gwt).toFixed(3)) : '') + '</td>'

					+ '<td>' + (parseFloat(tot_nt_out_nwt + total_outward_nwt) > 0 ? money_format_india(parseFloat(tot_nt_out_nwt + total_outward_nwt).toFixed(3)) : '') + '</td>'

					+ '<td>' + (parseFloat(total_outward_dwt) > 0 ? money_format_india(parseFloat(total_outward_dwt).toFixed(3)) : '') + '</td>'

					+ '<td>' + (parseFloat(tot_nt_closing_pcs + total_closing_inw_pcs) > 0 ? money_format_india(parseFloat(tot_nt_closing_pcs + total_closing_inw_pcs)) : '') + '</td>'

					+ '<td>' + (parseFloat(tot_nt_closing_gwt + total_closing_inw_gwt) > 0 ? money_format_india(parseFloat(tot_nt_closing_gwt + total_closing_inw_gwt).toFixed(3)) : '') + '</td>'

					+ '<td>' + (parseFloat(tot_nt_closing_nwt + total_closing_net_wt) > 0 ? money_format_india(parseFloat(tot_nt_closing_nwt + total_closing_net_wt).toFixed(3)) : '') + '</td>'

					+ '<td>' + (parseFloat(total_closing_dia_wt) > 0 ? money_format_india(parseFloat(total_closing_dia_wt).toFixed(3)) : '') + '</td>'

					+ '<td></td>'

					+ '<td></td>'

				'</tr>';

				console.log("metal_wise_total", metal_wise_total);

				for (var mwkey in metal_wise_total) {

					trHTML += '<tr style="font-weight:bold;">' +

						+ '<td></td>'

						+ '<td style="text-align:left;">GRAND TOTAL (' + mwkey + ')</td>'

						+ '<td>' + (metal_wise_total[mwkey].metal_op_blc_pcss > 0 ? money_format_india(metal_wise_total[mwkey].metal_op_blc_pcss) : '') + '</td>'

						+ '<td>' + (metal_wise_total[mwkey].metal_op_blc_gwt > 0 ? money_format_india(parseFloat(metal_wise_total[mwkey].metal_op_blc_gwt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (metal_wise_total[mwkey].metal_op_blc_nwt > 0 ? money_format_india(parseFloat(metal_wise_total[mwkey].metal_op_blc_nwt).toFixed(3)) : '') + '</td>'

						+ '<td></td>'

						+ '<td>' + (metal_wise_total[mwkey].metal_inw_pcss > 0 ? money_format_india(metal_wise_total[mwkey].metal_inw_pcss) : '') + '</td>'

						+ '<td>' + (metal_wise_total[mwkey].metal_inw_gwt > 0 ? money_format_india(parseFloat(metal_wise_total[mwkey].metal_inw_gwt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (metal_wise_total[mwkey].metal_inw_nwt > 0 ? money_format_india(parseFloat(metal_wise_total[mwkey].metal_inw_nwt).toFixed(3)) : '') + '</td>'

						+ '<td></td>'

						+ '<td>' + (metal_wise_total[mwkey].metal_outward_pcs > 0 ? money_format_india(metal_wise_total[mwkey].metal_outward_pcs) : '') + '</td>'

						+ '<td>' + (metal_wise_total[mwkey].metal_outward_gwt > 0 ? money_format_india(parseFloat(metal_wise_total[mwkey].metal_outward_gwt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (metal_wise_total[mwkey].metal_outward_nwt > 0 ? money_format_india(parseFloat(metal_wise_total[mwkey].metal_outward_nwt).toFixed(3)) : '') + '</td>'

						+ '<td></td>'

						+ '<td>' + (metal_wise_total[mwkey].metal_closing_inw_pcs > 0 ? money_format_india(metal_wise_total[mwkey].metal_closing_inw_pcs) : '') + '</td>'

						+ '<td>' + (metal_wise_total[mwkey].metal_closing_inw_gwt > 0 ? money_format_india(parseFloat(metal_wise_total[mwkey].metal_closing_inw_gwt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (metal_wise_total[mwkey].metal_closing_net_wt > 0 ? money_format_india(parseFloat(metal_wise_total[mwkey].metal_closing_net_wt).toFixed(3)) : '') + '</td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

					'</tr>';

				}

				$('#stock_list > tbody').html(trHTML);

				var pcs_visibility = 0;

				var weigth_visibility = 0;

				var all_visibility = 0;

				var profile = data.profile.allow_stock_type;

				if (profile == 1) {

					pcs_visibility = true;

				}

				if (profile == 2) {

					weigth_visibility = true;

				}

				if (profile == 3) {

					all_visibility = true;

				}

				// Check and initialise datatable

				if (!$.fn.DataTable.isDataTable('#stock_list')) {

					oTable = $('#stock_list').dataTable({

						"bSort": false,

						"bInfo": true,

						"scrollX": '100%',

						"dom": 'lBfrtip',

						"paging": false,

						"columnDefs": [

							{

								targets: [0],

								className: 'dt-body-left'
								
							},

							{

								targets: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14],

								className: 'dt-body-right'

							},

							{

								targets: [1, 5, 9, 13, 18],

								visible: pcs_visibility || all_visibility

							},

							{

								targets: [2, 3, 4, 6, 7, 8, 10, 11, 12, 14, 15, 16],

								visible: weigth_visibility || all_visibility

							},

						],

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: '',

								messageTop: title,

								exportOptions: {

									columns: ':visible'

								},

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', 'inherit');

								},

							},

							{

								extend: 'colvis',

								collectionLayout: 'fixed columns',

								collectionTitle: 'Column visibility control'

							},

							{

								extend: 'excel',

								footer: true,

								title: 'STOCK REPORT ' + branch_name + '-' + dt_range[0] + '-' + dt_range[1],

							}

						],

					});

				}

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

// function get_stock_details() {

// 	var title = '';

// 	$("div.overlay").css("display", "block");

// 	var dt_range = ($("#dt_range").val()).split('-');

// 	var company_name = $('#company_name').val();

// 	var from_date = date_format(dt_range[0].trim());

// 	var to_date = date_format(dt_range[1].trim());

// 	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

// 	var report_name = "STOCK REPORT";

// 	var category = $('#category option:selected').html()!= ''&& $('#category option:selected').html()!= undefined?$('#category option:selected').html() +" - " : '' ;

// 	var metal = $('#metal option:selected').html()!= ''&& $('#metal option:selected').html()!= undefined?$('#metal option:selected').html() +" - " : '' ;

// 	var prod_select = $('#prod_select option:selected').html()!= ''&& $('#prod_select option:selected').html()!= undefined?$('#prod_select option:selected').html() +" - " : '' ;

// 	var select_group_by = $('#select_group_by option:selected').html()!= ''&& $('#select_group_by option:selected').html()!= undefined?$('#select_group_by option:selected').html() +" - " : '' ;

// 	var optional = category + metal + prod_select + select_group_by;

// 	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

// 		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

// 	my_Date = new Date();

// 	$.ajax({

// 		url: base_url + "index.php/admin_ret_reports/stock_details/ajax?nocache=" + my_Date.getUTCSeconds(),

// 		data: ({ 'dt_range': $("#dt_range").val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'id_product': $('#prod_select').val(),'id_design': $('#des_select').val(),'id_metal': $('#metal').val(), 'id_category': $('#category').val(), 'group_by': $('#select_group_by').val() }),

// 		dataType: "JSON",

// 		type: "POST",

// 		success: function (data) {

// 		        $('.opqty').html(data.stocksummery.openpcs);

//     			$('.opwt').html(parseFloat( data.stocksummery.openwt).toFixed(3));

//     			$('.inqty').html(data.stocksummery.inwardpcs);

//     			$('.inwt').html(parseFloat(data.stocksummery.inwardwt).toFixed(3));

//     			$('.outqty').html(data.stocksummery.outwardpcs);

//     			$('.outwt').html(parseFloat(data.stocksummery.outwardwt).toFixed(3));

//     			$('.soldqty').html(data.stocksummery.showroomsalepcs);

//     			$('.soldwt').html(parseFloat(data.stocksummery.showroomsalegwt).toFixed(3));

//     			$('.otherqty').html(data.stocksummery.otherpcs);

//     			$('.otherwt').html(parseFloat(data.stocksummery.othergwt).toFixed(3));

//     			$('.clsqty').html(data.stocksummery.closepcs);

//     			$('.clswt').html(parseFloat(data.stocksummery.closewt).toFixed(3));

//     			$('.issqty').html(data.stocksummery.issued_pcs);

//                 $('.isswt').html(parseFloat(data.stocksummery.issued_wt).toFixed(3));

//     			$('.brinqty').html(data.stocksummery.brainw_pcs);

//     			$('.brinwt').html(parseFloat(data.stocksummery.brainw_gwt).toFixed(3));

//     			$('.lotinqty').html(data.stocksummery.lotinw_pcs);

//     			$('.lotinwt').html(parseFloat(data.stocksummery.lotinw_gwt).toFixed(3));

// 			var list = data.list;

// 			var non_tag_items = data.non_tag_items;

// 			$("#stock_list > tbody > tr").remove();

// 			$('#stock_list').dataTable().fnClearTable();

// 			$('#stock_list').dataTable().fnDestroy();

// 			if (list != null) {

// 				trHTML = '';

// 				tfootHTML = '';

// 				total_bill_amount = 0;

// 				total_bill_tax_value = 0;

// 				var metal_wise_total = [];

// 				var total_op_blc_pcss = 0;

// 				var total_op_blc_gwt = 0;

// 				var total_op_blc_nwt = 0;

// 				var total_op_blc_dwt = 0;

// 				var total_inw_pcss = 0;

// 				var total_inw_gwt = 0;

// 				var total_inw_nwt = 0;

// 				var total_inw_dwt = 0;

// 				var total_closing_inw_pcs = 0;

// 				var total_closing_inw_gwt = 0;

// 				var total_closing_net_wt = 0;

// 				var total_closing_dia_wt = 0;

// 				var total_outward_pcs = 0;

// 				var total_outward_gwt = 0;

// 				var total_outward_nwt = 0;

// 				var total_outward_dwt = 0;

// 				var tot_nt_op_blc_pcs = 0;

// 				var tot_nt_op_blc_gwt = 0;

// 				var tot_nt_op_blc_nwt = 0;

// 				var tot_nt_inw_pcs = 0;

// 				var tot_nt_inw_gwt = 0;

// 				var tot_nt_inw_nwt = 0;

// 				var tot_nt_out_pcs = 0;

// 				var tot_nt_out_gwt = 0;

// 				var tot_nt_out_nwt = 0;

// 				var tot_nt_closing_pcs =0;

// 				var tot_nt_closing_gwt = 0;

// 				var tot_nt_closing_nwt = 0;

// 				$.each(list, function (i, metal) {

// 					var metal_key = i;

// 					var metal_op_blc_pcss = 0;

// 					var metal_op_blc_gwt = 0;

// 					var metal_op_blc_nwt = 0;

// 					var metal_op_blc_dwt = 0;

// 					var metal_inw_pcss = 0;

// 					var metal_inw_gwt = 0;

// 					var metal_inw_nwt = 0;

// 					var metal_inw_dwt = 0;

// 					var metal_outward_pcs = 0;

// 					var metal_outward_gwt = 0;

// 					var metal_outward_nwt = 0;

// 					var metal_outward_dwt = 0;

// 					var metal_closing_inw_pcs = 0;

// 					var metal_closing_inw_gwt = 0;

// 					var metal_closing_net_wt = 0;

// 					var metal_closing_dia_wt = 0;

// 					if ($('#select_group_by').val() == 3) {

// 						trHTML += '<tr>'

// 							+ '<td style="text-align:left;" colspan="2"><strong>' + i + '</strong></td>'

// 							+ '<td></td>'

// 							+ '<td></td>'

// 							+ '<td></td>'

// 							+ '<td></td>'

// 							+ '<td></td>'

// 							+ '<td></td>'

// 							+ '<td></td>'

// 							+ '<td></td>'

// 							+ '<td></td>'

// 							+ '<td></td>'

// 							+ '<td></td>'

// 							+ '<td></td>'

// 							+ '<td></td>'

// 							+ '<td></td>'

// 							+ '<td></td>'

// 							+ '<td></td>'

// 							+ '<td></td>'

// 							+ '<td></td>'

// 						'</tr>';

// 					}

// 					$.each(metal, function (i, category) {

// 						var op_blc_pcss = 0;

// 						var op_blc_gwt = 0;

// 						var op_blc_nwt = 0;

// 						var op_blc_dwt = 0;

// 						var inw_pcss = 0;

// 						var inw_gwt = 0;

// 						var inw_nwt = 0;

// 						var inw_dwt = 0;

// 						var sold_pcs = 0;

// 						var sold_gwt = 0;

// 						var sold_nwt = 0;

// 						var sold_dwt = 0;

// 						var other_s_pcs = 0;

// 						var other_s_gwt = 0;

// 						var other_s_nwt = 0;

// 						var other_s_dwt = 0;

// 						var closing_inw_pcs = 0;

// 						var closing_inw_gwt = 0;

// 						var closing_net_wt = 0;

// 						var closing_dia_wt = 0;

// 						if ($('#select_group_by').val() == 1 || $('#select_group_by').val() == 3) {

// 							trHTML += '<tr>'

// 								+ '<td style="text-align:left;" colspan="2"><strong>' + i + '</strong></td>'

// 								+ '<td></td>'

// 								+ '<td></td>'

// 								+ '<td></td>'

// 								+ '<td></td>'

// 								+ '<td></td>'

// 								+ '<td></td>'

// 								+ '<td></td>'

// 								+ '<td></td>'

// 								+ '<td></td>'

// 								+ '<td></td>'

// 								+ '<td></td>'

// 								+ '<td></td>'

// 								+ '<td></td>'

// 								+ '<td></td>'

// 								+ '<td></td>'

// 								+ '<td></td>'

// 								+ '<td></td>'

// 								+ '<td></td>'

// 							'</tr>';

// 						}

// 						$.each(category, function (idx, item) {

// 							op_blc_pcss += parseFloat(item.op_blc_pcs);

// 							op_blc_gwt += parseFloat(item.op_blc_gwt);

// 							op_blc_nwt += parseFloat(item.op_blc_nwt);

// 							op_blc_dwt += parseFloat(item.op_blc_dwt);

// 							//Product Inward Details

// 							inw_pcss += parseFloat(item.inw_pcs);

// 							inw_gwt += parseFloat(item.inw_gwt);

// 							inw_nwt += parseFloat(item.inw_nwt);

// 							inw_dwt += parseFloat(item.inw_dwt);

// 							//Product Inward Details

// 							//Product SOld Details

// 							sold_pcs += parseFloat(item.sold_pcs);

// 							sold_gwt += parseFloat(item.sold_gwt);

// 							sold_nwt += parseFloat(item.sold_nwt);

// 							sold_dwt += parseFloat(item.sold_dwt);

// 							//Product SOld Details

// 							//Other Outward Details

// 							other_s_pcs += parseFloat(item.br_out_pcs);

// 							other_s_gwt += parseFloat(item.br_out_gwt);

// 							other_s_nwt += parseFloat(item.br_out_nwt);

// 							other_s_dwt += parseFloat(item.br_out_dwt);

// 							//Other Outward Details

// 							//Product closing Details

// 							var closing_pcs = parseFloat(item.op_blc_pcs) + parseFloat(item.inw_pcs) - parseFloat(parseFloat(item.sold_pcs) + parseFloat(item.br_out_pcs));

// 							var closing_gwt = parseFloat(parseFloat(item.op_blc_gwt) + parseFloat(item.inw_gwt) - parseFloat(item.sold_gwt) - parseFloat(item.br_out_gwt)).toFixed(3);

// 							var closing_nwt = parseFloat(parseFloat(item.op_blc_nwt) + parseFloat(item.inw_nwt) - parseFloat(item.sold_nwt) - parseFloat(item.br_out_nwt)).toFixed(3);

// 							var closing_dwt = parseFloat(parseFloat(item.op_blc_dwt) + parseFloat(item.inw_dwt) - parseFloat(item.sold_dwt) - parseFloat(item.br_out_dwt)).toFixed(3);

// 							//Product closing Details

// 							trHTML += '<tr>'

// 								+ '<td style="text-align:left;">' + ($('#select_group_by').val() == 1 ? item.product_name : ($('#select_group_by').val()==2 ? item.category_name:item.weight_range)) + '</td>'

// 								+ '<td>' + (item.op_blc_pcs> 0 ? item.op_blc_pcs :'')+ '</td>'

// 								+ '<td>' + money_format_india(item.op_blc_gwt) + '</td>'

// 								+ '<td>' + money_format_india(item.op_blc_nwt) + '</td>'

// 								+ '<td>' + money_format_india(item.op_blc_dwt) + '</td>'

// 								+ '<td>' + money_format_india(item.inw_pcs) + '</td>'

// 								+ '<td>' + money_format_india(item.inw_gwt) + '</td>'

// 								+ '<td>' + money_format_india(item.inw_nwt) + '</td>'

// 								+ '<td>' + money_format_india(item.inw_dwt) + '</td>'

// 								+ '<td>' + parseFloat(parseFloat(item.sold_pcs) + parseFloat(item.br_out_pcs)) + '</td>'

// 								+ '<td>' + money_format_india(parseFloat(parseFloat(item.sold_gwt) + parseFloat(item.br_out_gwt)).toFixed(3)) + '</td>'

// 								+ '<td>' + money_format_india(parseFloat(parseFloat(item.sold_nwt) + parseFloat(item.br_out_nwt)).toFixed(3)) + '</td>'

// 								+ '<td>' + money_format_india(parseFloat(parseFloat(item.sold_dwt) + parseFloat(item.br_out_dwt)).toFixed(3)) + '</td>'

// 								+ '<td>' + closing_pcs + '</td>'

// 								+ '<td>' + money_format_india(closing_gwt) + '</td>'

// 								+ '<td>' + money_format_india(closing_nwt) + '</td>'

// 								+ '<td>' + money_format_india(closing_dwt) + '</td>'

// 								+ '<td>' + item.in_trans_pcs + '</td>'

// 								+ '<td>' + money_format_india(parseFloat(parseFloat(closing_pcs) + parseFloat(item.in_trans_pcs))) + '</td>'

// 							'</tr>';

// 							closing_inw_pcs += parseFloat(closing_pcs);

// 							closing_inw_gwt += parseFloat(closing_gwt);

// 							closing_net_wt += parseFloat(closing_nwt);

// 							closing_dia_wt += parseFloat(closing_dwt);

// 						});

// 						if ($('#select_group_by').val() == 1 || $('#select_group_by').val() == 3) {

// 							trHTML += '<tr style="font-weight:bold;color:red">' +

// 								+'<td></td>'

// 								+ '<td style="text-align:left;"><strong>SUB TOTAL</strong></td>'

// 								+ '<td>' + op_blc_pcss + '</td>'

// 								+ '<td>' + money_format_india(parseFloat(op_blc_gwt).toFixed(3)) + '</td>'

// 								+ '<td>' + money_format_india(parseFloat(op_blc_nwt).toFixed(3)) + '</td>'

// 								+ '<td>' + money_format_india(parseFloat(op_blc_dwt).toFixed(3)) + '</td>'

// 								+ '<td>' + money_format_india(inw_pcss) + '</td>'

// 								+ '<td>' + money_format_india(parseFloat(inw_gwt).toFixed(3)) + '</td>'

// 								+ '<td>' + money_format_india(parseFloat(inw_nwt).toFixed(3)) + '</td>'

// 								+ '<td>' + money_format_india(parseFloat(inw_dwt).toFixed(3)) + '</td>'

// 								+ '<td>' + money_format_india(parseFloat(sold_pcs + other_s_pcs)) + '</td>'

// 								+ '<td>' + money_format_india(parseFloat(sold_gwt + other_s_gwt).toFixed(3)) + '</td>'

// 								+ '<td>' + money_format_india(parseFloat(sold_nwt + other_s_nwt).toFixed(3)) + '</td>'

// 								+ '<td>' + money_format_india(parseFloat(sold_dwt + other_s_dwt).toFixed(3)) + '</td>'

// 								+ '<td>' + money_format_india(closing_inw_pcs) + '</td>'

// 								+ '<td>' + money_format_india(parseFloat(closing_inw_gwt).toFixed(3)) + '</td>'

// 								+ '<td>' + money_format_india(parseFloat(closing_net_wt).toFixed(3)) + '</td>'

// 								+ '<td>' + money_format_india(parseFloat(closing_dia_wt).toFixed(3)) + '</td>'

// 								+ '<td></td>'

// 								+ '<td></td>'

// 							'</tr>';

// 						}

// 						metal_op_blc_pcss += parseFloat(op_blc_pcss);

// 						metal_op_blc_gwt += parseFloat(op_blc_gwt);

// 						metal_op_blc_nwt += parseFloat(op_blc_nwt);

// 						metal_op_blc_dwt += parseFloat(op_blc_dwt);

// 						metal_inw_pcss += parseFloat(inw_pcss);

// 						metal_inw_gwt += parseFloat(inw_gwt);

// 						metal_inw_nwt += parseFloat(inw_nwt);

// 						metal_inw_dwt += parseFloat(inw_dwt);

// 						metal_outward_pcs += parseFloat(sold_pcs + other_s_pcs);

// 						metal_outward_gwt += parseFloat(sold_gwt + other_s_gwt);

// 						metal_outward_nwt += parseFloat(sold_nwt + other_s_nwt);

// 						metal_outward_dwt += parseFloat(sold_dwt + other_s_dwt);

// 						metal_closing_inw_pcs += parseFloat(closing_inw_pcs);

// 						metal_closing_inw_gwt += parseFloat(closing_inw_gwt);

// 						metal_closing_net_wt += parseFloat(closing_net_wt);

// 						metal_closing_dia_wt += parseFloat(closing_dia_wt);

// 					});

// 					if ($('#select_group_by').val() == 1 || $('#select_group_by').val() == 3) {

// 						trHTML += '<tr style="font-weight:bold;color:red">' +

// 							+'<td></td>'

// 							+ '<td style="text-align:left;">TOTAL</td>'

// 							+ '<td>' + money_format_india(metal_op_blc_pcss) + '</td>'

// 							+ '<td>' + money_format_india(parseFloat(metal_op_blc_gwt).toFixed(3)) + '</td>'

// 							+ '<td>' + money_format_india(parseFloat(metal_op_blc_nwt).toFixed(3)) + '</td>'

// 							+ '<td>' + money_format_india(parseFloat(metal_op_blc_dwt).toFixed(3)) + '</td>'

// 							+ '<td>' + money_format_india(metal_inw_pcss) + '</td>'

// 							+ '<td>' + money_format_india(parseFloat(metal_inw_gwt).toFixed(3)) + '</td>'

// 							+ '<td>' + money_format_india(parseFloat(metal_inw_nwt).toFixed(3)) + '</td>'

// 							+ '<td>' + money_format_india(parseFloat(metal_inw_dwt).toFixed(3)) + '</td>'

// 							+ '<td>' + money_format_india(parseFloat(metal_outward_pcs)) + '</td>'

// 							+ '<td>' + money_format_india(parseFloat(metal_outward_gwt).toFixed(3)) + '</td>'

// 							+ '<td>' + money_format_india(parseFloat(metal_outward_nwt).toFixed(3)) + '</td>'

// 							+ '<td>' + money_format_india(parseFloat(metal_outward_dwt).toFixed(3)) + '</td>'

// 							+ '<td>' + money_format_india(metal_closing_inw_pcs) + '</td>'

// 							+ '<td>' + money_format_india(parseFloat(metal_closing_inw_gwt).toFixed(3)) + '</td>'

// 							+ '<td>' + money_format_india(parseFloat(metal_closing_net_wt).toFixed(3)) + '</td>'

// 							+ '<td>' + money_format_india(parseFloat(metal_closing_dia_wt).toFixed(3)) + '</td>'

// 							+ '<td></td>'

// 							+ '<td></td>'

// 						'</tr>';

// 					}

// 					var metal_wise_sum = {

// 						"metal_op_blc_pcss" : metal_op_blc_pcss,

// 						"metal_op_blc_gwt"	: parseFloat(metal_op_blc_gwt).toFixed(3),

// 						"metal_op_blc_nwt"	: parseFloat(metal_op_blc_nwt).toFixed(3),

// 						"metal_op_blc_dwt"	: parseFloat(metal_op_blc_dwt).toFixed(3),

// 						"metal_inw_pcss"	: metal_inw_pcss,

// 						"metal_inw_gwt"		: parseFloat(metal_inw_gwt).toFixed(3),

// 						"metal_inw_nwt"		: parseFloat(metal_inw_nwt).toFixed(3),

// 						"metal_inw_dwt"		: parseFloat(metal_inw_dwt).toFixed(3),

// 						"metal_outward_pcs" : parseFloat(metal_outward_pcs),

// 						"metal_outward_gwt"	: parseFloat(metal_outward_gwt).toFixed(3),

// 						"metal_outward_nwt"	: parseFloat(metal_outward_nwt).toFixed(3),

// 						"metal_outward_dwt"	: parseFloat(metal_outward_dwt).toFixed(3),

// 						"metal_closing_inw_pcs" : metal_closing_inw_pcs,

// 						"metal_closing_inw_gwt" : parseFloat(metal_closing_inw_gwt).toFixed(3),

// 						"metal_closing_net_wt" : parseFloat(metal_closing_net_wt).toFixed(3),

// 						"metal_closing_dia_wt" : parseFloat(metal_closing_dia_wt).toFixed(3),

// 					};

// 					metal_wise_total[metal_key] = metal_wise_sum;

// 					total_op_blc_pcss += parseFloat(metal_op_blc_pcss);

// 					total_op_blc_gwt += parseFloat(metal_op_blc_gwt);

// 					total_op_blc_nwt += parseFloat(metal_op_blc_nwt);

// 					total_op_blc_dwt += parseFloat(metal_closing_dia_wt);

// 					total_inw_pcss += parseFloat(metal_inw_pcss);

// 					total_inw_gwt += parseFloat(metal_inw_gwt);

// 					total_inw_nwt += parseFloat(metal_inw_nwt);

// 					total_inw_dwt += parseFloat(metal_inw_dwt);

// 					total_outward_pcs += parseFloat(metal_outward_pcs);

// 					total_outward_gwt += parseFloat(metal_outward_gwt);

// 					total_outward_nwt += parseFloat(metal_outward_nwt);

// 					total_outward_dwt += parseFloat(metal_outward_dwt);

// 					total_closing_inw_pcs += parseFloat(metal_closing_inw_pcs);

// 					total_closing_inw_gwt += parseFloat(metal_closing_inw_gwt);

// 					total_closing_net_wt += parseFloat(metal_closing_net_wt);

// 					total_closing_dia_wt += parseFloat(metal_closing_dia_wt);

// 				});

// 				trHTML += '<tr style="font-weight:bold;color:blue">' +

// 					+'<td></td>'

// 					+ '<td style="text-align:left;">TAG TOTAL</td>'

// 					+ '<td>' + money_format_india(total_op_blc_pcss) + '</td>'

// 					+ '<td>' + money_format_india(parseFloat(total_op_blc_gwt).toFixed(3)) + '</td>'

// 					+ '<td>' + money_format_india(parseFloat(total_op_blc_nwt).toFixed(3)) + '</td>'

// 					+ '<td>' + money_format_india(parseFloat(total_op_blc_dwt).toFixed(3)) + '</td>'

// 					+ '<td>' + money_format_india(total_inw_pcss) + '</td>'

// 					+ '<td>' + money_format_india(parseFloat(total_inw_gwt).toFixed(3)) + '</td>'

// 					+ '<td>' + money_format_india(parseFloat(total_inw_nwt).toFixed(3)) + '</td>'

// 					+ '<td>' + money_format_india(parseFloat(total_inw_dwt).toFixed(3)) + '</td>'

// 					+ '<td>' + money_format_india(parseFloat(total_outward_pcs)) + '</td>'

// 					+ '<td>' + money_format_india(parseFloat(total_outward_gwt).toFixed(3)) + '</td>'

// 					+ '<td>' + money_format_india(parseFloat(total_outward_nwt).toFixed(3)) + '</td>'

// 					+ '<td>' + money_format_india(parseFloat(total_outward_dwt).toFixed(3)) + '</td>'

// 					+ '<td>' + money_format_india(total_closing_inw_pcs) + '</td>'

// 					+ '<td>' + money_format_india(parseFloat(total_closing_inw_gwt).toFixed(3)) + '</td>'

// 					+ '<td>' + money_format_india(parseFloat(total_closing_net_wt).toFixed(3)) + '</td>'

// 					+ '<td>' + money_format_india(parseFloat(total_closing_dia_wt).toFixed(3)) + '</td>'

// 					+ '<td></td>'

// 					+ '<td></td>'

// 				'</tr>';

// 				if(non_tag_items!='')

// 				{

// 					trHTML += '<tr>'

// 						+ '<td style="font-weight:bold;text-align:left;text-transform:uppercase;" colspan="2">Non Tag Items</td>'

// 						+ '<td></td>'

// 						+ '<td></td>'

// 						+ '<td></td>'

// 						+ '<td></td>'

// 						+ '<td></td>'

// 						+ '<td></td>'

// 						+ '<td></td>'

// 						+ '<td></td>'

// 						+ '<td></td>'

// 						+ '<td></td>'

// 						+ '<td></td>'

// 						+ '<td></td>'

// 						+ '<td></td>'

// 						+ '<td></td>'

// 						+ '<td></td>'

// 						+ '<td></td>'

// 						+ '<td></td>'

// 						+ '<td></td>'

// 					'</tr>';

// 					$.each(non_tag_items, function (key, metal) {

// 						var metal_key = key;

// 						var nt_metal_op_blc_pcss = 0;

// 						var nt_metal_op_blc_gwt = 0;

// 						var nt_metal_op_blc_nwt = 0;

// 						var nt_metal_inw_pcss = 0;

// 						var nt_metal_inw_gwt = 0;

// 						var nt_metal_inw_nwt = 0;

// 						var nt_metal_closing_inw_pcs=0;

// 						var nt_metal_closing_inw_gwt=0;

// 						var nt_metal_closing_net_wt=0;

// 						var nt_metal_outward_pcs=0;

// 						var nt_metal_outward_gwt=0;

// 						var nt_metal_outward_nwt=0;

// 						$.each(metal, function (k, category) {

// 							var tot_op_blc_pcs = 0;

// 							var tot_op_blc_gwt = 0;

// 							var tot_op_blc_nwt = 0;

// 							var tot_inw_pcs = 0;

// 							var tot_inw_gwt = 0;

// 							var tot_inw_nwt = 0;

// 							var tot_out_pcs = 0;

// 							var tot_out_gwt = 0;

// 							var tot_out_nwt = 0;

// 							var tot_closing_pcs =0;

// 							var tot_closing_gwt = 0;

// 							var tot_closing_nwt = 0;

// 							if ($('#select_group_by').val() == 1) {

// 							trHTML += '<tr>'

// 								+ '<td style="font-weight:bold;text-align:left;" colspan="2">' + k + '</td>'

// 								+ '<td></td>'

// 								+ '<td></td>'

// 								+ '<td></td>'

// 								+ '<td></td>'

// 								+ '<td></td>'

// 								+ '<td></td>'

// 								+ '<td></td>'

// 								+ '<td></td>'

// 								+ '<td></td>'

// 								+ '<td></td>'

// 								+ '<td></td>'

// 								+ '<td></td>'

// 								+ '<td></td>'

// 								+ '<td></td>'

// 								+ '<td></td>'

// 								+ '<td></td>'

// 								+ '<td></td>'

// 								+ '<td></td>'

// 							'</tr>';

// 							}

// 							$.each(category, function (c, items) {

// 								tot_op_blc_pcs += parseFloat(items.op_blc_pcs);

// 								tot_op_blc_gwt += parseFloat(items.op_blc_gwt);

// 								tot_op_blc_nwt += parseFloat(items.op_blc_nwt);

// 								tot_inw_pcs += parseFloat(items.inw_pcs);

// 								tot_inw_gwt += parseFloat(items.inw_gwt);

// 								tot_inw_nwt += parseFloat(items.inw_nwt);

// 								tot_out_pcs += parseFloat(parseFloat(items.sales_pcs) + parseFloat(items.br_out_pcs));

// 								tot_out_gwt += parseFloat(parseFloat(items.sales_gwt) + parseFloat(items.br_out_gwt));

// 								tot_out_nwt += parseFloat(parseFloat(items.sales_nwt) + parseFloat(items.br_out_nwt));

// 								tot_closing_pcs += parseFloat(parseFloat(items.op_blc_pcs) + parseFloat(items.inw_pcs) - parseFloat(items.sales_pcs) - parseFloat(items.br_out_pcs));

// 								tot_closing_gwt += parseFloat(parseFloat(items.op_blc_gwt) + parseFloat(items.inw_gwt) - parseFloat(items.sales_gwt) - parseFloat(items.br_out_gwt));

// 								tot_closing_nwt += parseFloat(parseFloat(items.op_blc_nwt) + parseFloat(items.inw_nwt) - parseFloat(items.sales_nwt) - parseFloat(items.br_out_nwt));

// 								tot_nt_op_blc_pcs += parseFloat(items.op_blc_pcs);

// 								tot_nt_op_blc_gwt += parseFloat(items.op_blc_gwt);

// 								tot_nt_op_blc_nwt += parseFloat(items.op_blc_nwt);

// 								tot_nt_inw_pcs += parseFloat(items.inw_pcs);

// 								tot_nt_inw_gwt += parseFloat(items.inw_gwt);

// 								tot_nt_inw_nwt += parseFloat(items.inw_nwt);

// 								tot_nt_out_pcs += parseFloat(parseFloat(items.sales_pcs) + parseFloat(items.br_out_pcs));

// 								tot_nt_out_gwt += parseFloat(parseFloat(items.sales_gwt) + parseFloat(items.br_out_gwt));

// 								tot_nt_out_nwt += parseFloat(parseFloat(items.sales_nwt) + parseFloat(items.br_out_nwt));

// 								tot_nt_closing_pcs += parseFloat(parseFloat(items.op_blc_pcs) + parseFloat(items.inw_pcs) - parseFloat(items.sales_pcs) - parseFloat(items.br_out_pcs));

// 								tot_nt_closing_gwt += parseFloat(parseFloat(items.op_blc_gwt) + parseFloat(items.inw_gwt) - parseFloat(items.sales_gwt) - parseFloat(items.br_out_gwt));

// 								tot_nt_closing_nwt += parseFloat(parseFloat(items.op_blc_nwt) + parseFloat(items.inw_nwt) - parseFloat(items.sales_nwt) - parseFloat(items.br_out_nwt));

// 								trHTML += '<tr style="font-weight:bold;">'

// 									+ '<td style="font-weight:bold;text-align:left;">' + ($('#select_group_by').val() == 1 ? items.product_name : items.category_name) + '</td>'

// 									+ '<td>' + money_format_india(items.op_blc_pcs) + '</td>'

// 									+ '<td>' + money_format_india(items.op_blc_gwt) + '</td>'

// 									+ '<td>' + money_format_india(items.op_blc_nwt) + '</td>'

// 									+'<td></td>'

// 									+ '<td>' + money_format_india(items.inw_pcs) + '</td>'

// 									+ '<td>' + money_format_india(items.inw_gwt) + '</td>'

// 									+ '<td>' + money_format_india(items.inw_nwt) + '</td>'

// 									+'<td></td>'

// 									+ '<td>' + money_format_india(parseFloat(parseFloat(items.sales_pcs) + parseFloat(items.br_out_pcs))) + '</td>'

// 									+ '<td>' + money_format_india(parseFloat(parseFloat(items.sales_gwt) + parseFloat(items.br_out_gwt)).toFixed(3)) + '</td>'

// 									+ '<td>' + money_format_india(parseFloat(parseFloat(items.sales_nwt) + parseFloat(items.br_out_nwt)).toFixed(3)) + '</td>'

// 									+'<td></td>'

// 									+ '<td>' + money_format_india(parseFloat(parseFloat(items.op_blc_pcs) + parseFloat(items.inw_pcs) - parseFloat(items.sales_pcs) - parseFloat(items.br_out_pcs)).toFixed(0)) + '</td>'

// 									+ '<td>' + money_format_india(parseFloat(parseFloat(items.op_blc_gwt) + parseFloat(items.inw_gwt) - parseFloat(items.sales_gwt) - parseFloat(items.br_out_gwt)).toFixed(3)) + '</td>'

// 									+ '<td>' + money_format_india(parseFloat(parseFloat(items.op_blc_nwt) + parseFloat(items.inw_nwt) - parseFloat(items.sales_nwt) - parseFloat(items.br_out_nwt)).toFixed(3)) + '</td>'

// 									+'<td></td>'

// 									+ '<td></td>'

// 									+ '<td></td>'

// 								'</tr>';

// 								nt_metal_op_blc_pcss += parseFloat(items.op_blc_pcs);

// 								nt_metal_op_blc_gwt += parseFloat(items.op_blc_gwt);

// 								nt_metal_op_blc_nwt += parseFloat(items.op_blc_nwt);

// 								nt_metal_inw_pcss += parseFloat(items.inw_pcs);

// 								nt_metal_inw_gwt += parseFloat(items.inw_gwt);

// 								nt_metal_inw_nwt += parseFloat(items.inw_nwt);

// 								nt_metal_closing_inw_pcs += (parseFloat(parseFloat(items.sales_pcs)+parseFloat(items.br_out_pcs)));

// 								nt_metal_closing_inw_gwt += parseFloat((parseFloat(items.sales_gwt)+parseFloat(items.br_out_gwt)).toFixed(3));

// 								nt_metal_closing_net_wt += parseFloat((parseFloat(items.sales_nwt)+parseFloat(items.br_out_nwt)).toFixed(3));

// 								nt_metal_outward_pcs += parseFloat((parseFloat(items.op_blc_pcs)+parseFloat(items.inw_pcs)-parseFloat(items.sales_pcs)-parseFloat(items.br_out_pcs)).toFixed(0));

// 								nt_metal_outward_gwt += parseFloat((parseFloat(items.op_blc_gwt)+parseFloat(items.inw_gwt)-parseFloat(items.sales_gwt)-parseFloat(items.br_out_gwt)).toFixed(3));

// 								nt_metal_outward_nwt += parseFloat((parseFloat(items.op_blc_nwt)+parseFloat(items.inw_nwt)-parseFloat(items.sales_nwt)-parseFloat(items.br_out_nwt)).toFixed(3));

// 							});

// 							if ($('#select_group_by').val() == 1) {

// 								trHTML += '<tr style="font-weight:bold;color:red">'

// 									+ '<td style="font-weight:bold;text-align:left;"><strong>SUB TOTAL</strong></td>'

// 									+ '<td>'+money_format_india(parseFloat(tot_op_blc_pcs))+'</td>'

// 									+ '<td>'+money_format_india(parseFloat(tot_op_blc_gwt).toFixed(3))+'</td>'

// 									+ '<td>'+money_format_india(parseFloat(tot_op_blc_nwt).toFixed(3))+'</td>'

// 									+'<td></td>'

// 									+ '<td>'+money_format_india(parseFloat(tot_inw_pcs))+'</td>'

// 									+ '<td>'+money_format_india(parseFloat(tot_inw_gwt).toFixed(3))+'</td>'

// 									+ '<td>'+money_format_india(parseFloat(tot_inw_nwt).toFixed(3))+'</td>'

// 									+'<td></td>'

// 									+ '<td>'+money_format_india(parseFloat(tot_out_pcs))+'</td>'

// 									+ '<td>'+money_format_india(parseFloat(tot_out_gwt).toFixed(3))+'</td>'

// 									+ '<td>'+money_format_india(parseFloat(tot_out_nwt).toFixed(3))+'</td>'

// 									+'<td></td>'

// 									+ '<td>'+money_format_india(parseFloat(tot_closing_pcs))+'</td>'

// 									+ '<td>'+money_format_india(parseFloat(tot_closing_gwt).toFixed(3))+'</td>'

// 									+ '<td>'+money_format_india(parseFloat(tot_closing_nwt).toFixed(3))+'</td>'

// 									+'<td></td>'

// 									+ '<td></td>'

// 									+ '<td></td>'

// 								'</tr>';

// 							}

// 						});

// 						let has_metal_already = 0;

// 						for (var mwt in metal_wise_total) {

// 							if(mwt == metal_key) {

// 								has_metal_already = 1;

// 								$.each(metal_wise_total[mwt], function(keys,values){

// 									if(keys == "metal_op_blc_pcss") {

// 										metal_wise_total[mwt].metal_op_blc_pcss = (parseFloat(values) + parseFloat(nt_metal_op_blc_pcss))

// 									}

// 									if(keys == "metal_op_blc_gwt") {

// 										metal_wise_total[mwt].metal_op_blc_gwt = (parseFloat(values)  + parseFloat(nt_metal_op_blc_gwt)).toFixed(3)

// 									}

// 									if(keys == "metal_op_blc_nwt") {

// 										metal_wise_total[mwt].metal_op_blc_nwt = (parseFloat(values) + parseFloat(nt_metal_op_blc_nwt)).toFixed(3)

// 									}

// 									if(keys == "metal_inw_pcss") {

// 										metal_wise_total[mwt].metal_inw_pcss = (parseFloat(values) + parseFloat(nt_metal_inw_pcss));

// 									}

// 									if(keys == "metal_inw_gwt") {

// 										metal_wise_total[mwt].metal_inw_gwt = (parseFloat(values) + parseFloat(nt_metal_inw_gwt)).toFixed(3);

// 									}

// 									if(keys == "metal_inw_nwt") {

// 										metal_wise_total[mwt].metal_inw_nwt = (parseFloat(values) + parseFloat(nt_metal_inw_nwt)).toFixed(3);

// 									}

// 									if(keys == "metal_outward_pcs") {

// 										metal_wise_total[mwt].metal_outward_pcs = (parseFloat(values) + parseFloat(nt_metal_closing_inw_pcs));

// 									}

// 									if(keys == "metal_outward_gwt") {

// 										metal_wise_total[mwt].metal_outward_gwt = (parseFloat(values) + parseFloat(nt_metal_closing_inw_gwt)).toFixed(3);

// 									}

// 									if(keys == "metal_outward_nwt") {

// 										metal_wise_total[mwt].metal_outward_nwt = (parseFloat(values) + parseFloat(nt_metal_closing_net_wt)).toFixed(3);

// 									}

// 									if(keys == "metal_closing_inw_pcs") {

// 										metal_wise_total[mwt].metal_closing_inw_pcs = (parseFloat(values) + parseFloat(nt_metal_outward_pcs));

// 									}

// 									if(keys == "metal_closing_inw_gwt") {

// 										metal_wise_total[mwt].metal_closing_inw_gwt = (parseFloat(values) + parseFloat(nt_metal_outward_gwt)).toFixed(3);

// 									}

// 									if(keys == "metal_closing_net_wt") {

// 										metal_wise_total[mwt].metal_closing_net_wt = (parseFloat(values)+ parseFloat(nt_metal_outward_nwt)).toFixed(3);

// 									}

// 								});

// 							}

// 						}

// 						if(has_metal_already == 0) {

// 							var metal_wise_sum = {

// 								"metal_op_blc_pcss" : nt_metal_op_blc_pcss,

// 								"metal_op_blc_gwt"	: nt_metal_op_blc_gwt,

// 								"metal_op_blc_nwt"	: nt_metal_op_blc_nwt,

// 								"metal_inw_pcss"	: nt_metal_inw_pcss,

// 								"metal_inw_gwt"		: nt_metal_inw_gwt,

// 								"metal_inw_nwt"		: nt_metal_inw_nwt,

// 								"metal_outward_pcs" : nt_metal_closing_inw_pcs,

// 								"metal_outward_gwt"	: nt_metal_closing_inw_gwt,

// 								"metal_outward_nwt"	: nt_metal_closing_net_wt,

// 								"metal_closing_inw_pcs" : nt_metal_outward_pcs,

// 								"metal_closing_inw_gwt" : nt_metal_outward_gwt,

// 								"metal_closing_net_wt" : nt_metal_outward_nwt

// 							}

// 							metal_wise_total[metal_key] = metal_wise_sum;

// 						}

// 					});

// 					trHTML += '<tr style="font-weight:bold;color:blue">'

// 									+ '<td style="font-weight:bold;text-align:left;"><strong>NON TAG TOTAL</strong></td>'

// 									+ '<td>'+money_format_india(parseFloat(tot_nt_op_blc_pcs))+'</td>'

// 									+ '<td>'+money_format_india(parseFloat(tot_nt_op_blc_gwt).toFixed(3))+'</td>'

// 									+ '<td>'+money_format_india(parseFloat(tot_nt_op_blc_nwt).toFixed(3))+'</td>'

// 									+'<td></td>'

// 									+ '<td>'+money_format_india(parseFloat(tot_nt_inw_pcs))+'</td>'

// 									+ '<td>'+money_format_india(parseFloat(tot_nt_inw_gwt).toFixed(3))+'</td>'

// 									+ '<td>'+money_format_india(parseFloat(tot_nt_inw_nwt).toFixed(3))+'</td>'

// 									+'<td></td>'

// 									+ '<td>'+money_format_india(parseFloat(tot_nt_out_pcs))+'</td>'

// 									+ '<td>'+money_format_india(parseFloat(tot_nt_out_gwt).toFixed(3))+'</td>'

// 									+ '<td>'+money_format_india(parseFloat(tot_nt_out_nwt).toFixed(3))+'</td>'

// 									+'<td></td>'

// 									+ '<td>'+money_format_india(parseFloat(tot_nt_closing_pcs))+'</td>'

// 									+ '<td>'+money_format_india(parseFloat(tot_nt_closing_gwt).toFixed(3))+'</td>'

// 									+ '<td>'+money_format_india(parseFloat(tot_nt_closing_nwt).toFixed(3))+'</td>'

// 									+'<td></td>'

// 									+ '<td></td>'

// 									+ '<td></td>'

// 								'</tr>';

// 				}

// 				trHTML += '<tr style="font-weight:bold;color:#FFA500">'

// 				+ '<td style="font-weight:bold;text-align:left;"><strong>GRAND TOTAL</strong></td>'

// 				+ '<td>'+money_format_india(parseFloat(total_op_blc_pcss + tot_nt_op_blc_pcs))+'</td>'

// 				+ '<td>'+money_format_india(parseFloat(tot_nt_op_blc_gwt + total_op_blc_gwt).toFixed(3))+'</td>'

// 				+ '<td>'+money_format_india(parseFloat(tot_nt_op_blc_nwt + total_op_blc_nwt).toFixed(3))+'</td>'

// 				+ '<td>'+money_format_india(parseFloat(total_op_blc_dwt).toFixed(3))+'</td>'

// 				+ '<td>'+money_format_india(parseFloat(tot_nt_inw_pcs + total_inw_pcss))+'</td>'

// 				+ '<td>'+money_format_india(parseFloat(tot_nt_inw_gwt + total_inw_gwt).toFixed(3))+'</td>'

// 				+ '<td>'+money_format_india(parseFloat(tot_nt_inw_nwt + total_inw_nwt).toFixed(3))+'</td>'

// 				+ '<td>'+money_format_india(parseFloat(total_inw_dwt).toFixed(3))+'</td>'

// 				+ '<td>'+money_format_india(parseFloat(tot_nt_out_pcs + total_outward_pcs))+'</td>'

// 				+ '<td>'+money_format_india(parseFloat(tot_nt_out_gwt + total_outward_gwt).toFixed(3))+'</td>'

// 				+ '<td>'+money_format_india(parseFloat(tot_nt_out_nwt + total_outward_nwt ).toFixed(3))+'</td>'

// 				+ '<td>'+money_format_india(parseFloat(total_outward_dwt).toFixed(3))+'</td>'

// 				+ '<td>'+money_format_india(parseFloat(tot_nt_closing_pcs + total_closing_inw_pcs ))+'</td>'

// 				+ '<td>'+money_format_india(parseFloat(tot_nt_closing_gwt + total_closing_inw_gwt).toFixed(3))+'</td>'

// 				+ '<td>'+money_format_india(parseFloat(tot_nt_closing_nwt + total_closing_net_wt).toFixed(3))+'</td>'

// 				+ '<td>'+money_format_india(parseFloat(total_closing_dia_wt).toFixed(3))+'</td>'

// 				+ '<td></td>'

// 				+ '<td></td>'

// 			'</tr>';

// 				console.log("metal_wise_total",metal_wise_total);

// 				for (var mwkey in metal_wise_total) {

// 					trHTML += '<tr style="font-weight:bold;">' +

// 							+'<td></td>'

// 							+'<td style="text-align:left;">GRAND TOTAL ('+mwkey+')</td>'

// 							+'<td>'+money_format_india(metal_wise_total[mwkey].metal_op_blc_pcss)+'</td>'

// 							+'<td>'+money_format_india(metal_wise_total[mwkey].metal_op_blc_gwt)+'</td>'

// 							+'<td>'+money_format_india(metal_wise_total[mwkey].metal_op_blc_nwt)+'</td>'

// 							+'<td></td>'

// 							+'<td>'+money_format_india(metal_wise_total[mwkey].metal_inw_pcss)+'</td>'

// 							+'<td>'+money_format_india(metal_wise_total[mwkey].metal_inw_gwt)+'</td>'

// 							+'<td>'+money_format_india(metal_wise_total[mwkey].metal_inw_nwt)+'</td>'

// 							+'<td></td>'

// 							+'<td>'+money_format_india(metal_wise_total[mwkey].metal_outward_pcs)+'</td>'

// 							+'<td>'+money_format_india(metal_wise_total[mwkey].metal_outward_gwt)+'</td>'

// 							+'<td>'+money_format_india(metal_wise_total[mwkey].metal_outward_nwt)+'</td>'

// 							+'<td></td>'

// 							+'<td>'+money_format_india(metal_wise_total[mwkey].metal_closing_inw_pcs)+'</td>'

// 							+'<td>'+money_format_india(metal_wise_total[mwkey].metal_closing_inw_gwt)+'</td>'

// 							+'<td>'+money_format_india(metal_wise_total[mwkey].metal_closing_net_wt)+'</td>'

// 							+'<td></td>'

// 							+'<td></td>'

// 							+'<td></td>'

// 					'</tr>';

// 				}

// 				$('#stock_list > tbody').html(trHTML);

// 				// Check and initialise datatable

// 				if (!$.fn.DataTable.isDataTable('#stock_list')) {

// 					oTable = $('#stock_list').dataTable({

// 						"bSort": false,

// 						"bInfo": true,

// 						"scrollX": '100%',

// 						"dom": 'lBfrtip',

// 						"paging": false,

// 						"columnDefs": [

// 							{

// 								targets: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14],

// 								className: 'dt-body-right'

// 							}

// 						],

// 						"buttons": [

// 							{

// 								extend: 'print',

// 								footer: true,

// 								title: '',

// 								messageTop: title,

// 								customize: function (win) {

// 									$(win.document.body).find('table')

// 										.addClass('compact')

// 										.css('font-size', 'inherit');

// 								},

// 							},

// 							{

// 								extend: 'colvis',

// 								collectionLayout: 'fixed columns',

// 								collectionTitle: 'Column visibility control'

// 							},

// 							{

// 								extend: 'excel',

// 								footer: true,

// 								title: 'STOCK REPORT ' + branch_name + '-' + dt_range[0] + '-' + dt_range[1],

// 							}

// 						],

// 					});

// 				}

// 			}

// 			$("div.overlay").css("display", "none");

// 		},

// 		error: function (error) {

// 			$("div.overlay").css("display", "none");

// 		}

// 	});

// }

//stock report

$('#approval_stock_detail_search').on('click', function () {

	get_approval_stock_details();

});

function get_approval_stock_details() {

	var dt_range = ($("#dt_range").val()).split('-');

	var company_name = $('#company_name').val();

	var from_date = dt_range[0];

	var to_date = dt_range[1];

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "APPROVAL STOCK REPORT";

	var category = $('#category option:selected').html() != '' && $('#category option:selected').html() != undefined ? $('#category option:selected').html() + " - " : '';

	var prod_select = $('#prod_select option:selected').html() != '' && $('#prod_select option:selected').html() != undefined ? $('#prod_select option:selected').html() + " - " : '';

	var metal = $('#metal option:selected').html() != '' && $('#metal option:selected').html() != undefined ? $('#metal option:selected').html() + " - " : '';

	var optional = category + metal + prod_select;

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/approvalstock_details/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'dt_range': $("#dt_range").val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'id_product': $('#prod_select').val(), 'id_metal': $('#metal').val(), 'id_category': $('#category').val(), 'group_by': $('#select_group_by').val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			var non_tag_items = data.non_tag_items;

			$("#stock_list > tbody > tr").remove();

			$('#stock_list').dataTable().fnClearTable();

			$('#stock_list').dataTable().fnDestroy();

			if (list != null) {

				trHTML = '';

				tfootHTML = '';

				total_bill_amount = 0;

				total_bill_tax_value = 0;

				var total_op_blc_pcss = 0;

				var total_op_blc_gwt = 0;

				var total_op_blc_nwt = 0;

				var total_inw_pcss = 0;

				var total_inw_gwt = 0;

				var total_inw_nwt = 0;

				var total_closing_inw_pcs = 0;

				var total_closing_inw_gwt = 0;

				var total_closing_net_wt = 0;

				var total_outward_pcs = 0;

				var total_outward_gwt = 0;

				var total_outward_nwt = 0;

				$.each(list, function (i, metal) {

					var metal_op_blc_pcss = 0;

					var metal_op_blc_gwt = 0;

					var metal_op_blc_nwt = 0;

					var metal_inw_pcss = 0;

					var metal_inw_gwt = 0;

					var metal_inw_nwt = 0;

					var metal_outward_pcs = 0;

					var metal_outward_gwt = 0;

					var metal_outward_nwt = 0;

					var metal_closing_inw_pcs = 0;

					var metal_closing_inw_gwt = 0;

					var metal_closing_net_wt = 0;

					$.each(metal, function (i, category) {

						var op_blc_pcss = 0;

						var op_blc_gwt = 0;

						var op_blc_nwt = 0;

						var inw_pcss = 0;

						var inw_gwt = 0;

						var inw_nwt = 0;

						var sold_pcs = 0;

						var sold_gwt = 0;

						var sold_nwt = 0;

						var other_s_pcs = 0;

						var other_s_gwt = 0;

						var other_s_nwt = 0;

						var closing_inw_pcs = 0;

						var closing_inw_gwt = 0;

						var closing_net_wt = 0;

						if ($('#select_group_by').val() == 1) {

							trHTML += '<tr>'

								+ '<td style="text-align:left;" colspan="2"><strong>' + i + '</strong></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

							'</tr>';

						}

						$.each(category, function (idx, item) {

							op_blc_pcss += parseFloat(item.op_blc_pcs);

							op_blc_gwt += parseFloat(item.op_blc_gwt);

							op_blc_nwt += parseFloat(item.op_blc_nwt);

							//Product Inward Details

							inw_pcss += parseFloat(item.inw_pcs);

							inw_gwt += parseFloat(item.inw_gwt);

							inw_nwt += parseFloat(item.inw_nwt);

							//Product Inward Details

							//Product SOld Details

							sold_pcs += parseFloat(item.sold_pcs);

							sold_gwt += parseFloat(item.sold_gwt);

							sold_nwt += parseFloat(item.sold_nwt);

							//Product SOld Details

							//Other Outward Details

							other_s_pcs += parseFloat(item.br_out_pcs);

							other_s_gwt += parseFloat(item.br_out_gwt);

							other_s_nwt += parseFloat(item.br_out_nwt);

							//Other Outward Details

							//Product closing Details

							var closing_pcs = parseFloat(item.op_blc_pcs) + parseFloat(item.inw_pcs) - parseFloat(parseFloat(item.sold_pcs) + parseFloat(item.br_out_pcs));

							var closing_gwt = parseFloat(parseFloat(item.op_blc_gwt) + parseFloat(item.inw_gwt) - parseFloat(item.sold_gwt) - parseFloat(item.br_out_gwt)).toFixed(3);

							var closing_nwt = parseFloat(parseFloat(item.op_blc_nwt) + parseFloat(item.inw_nwt) - parseFloat(item.sold_nwt) - parseFloat(item.br_out_nwt)).toFixed(3);

							//Product closing Details

							trHTML += '<tr>'

								+ '<td style="text-align:left;">' + ($('#select_group_by').val() == 1 ? item.product_name : item.category_name) + '</td>'

								+ '<td>' + item.op_blc_pcs + '</td>'

								+ '<td>' + item.op_blc_gwt + '</td>'

								+ '<td>' + item.op_blc_nwt + '</td>'

								+ '<td>' + item.inw_pcs + '</td>'

								+ '<td>' + item.inw_gwt + '</td>'

								+ '<td>' + item.inw_nwt + '</td>'

								+ '<td>' + parseFloat(parseFloat(item.sold_pcs) + parseFloat(item.br_out_pcs)) + '</td>'

								+ '<td>' + parseFloat(parseFloat(item.sold_gwt) + parseFloat(item.br_out_gwt)).toFixed(3) + '</td>'

								+ '<td>' + parseFloat(parseFloat(item.sold_nwt) + parseFloat(item.br_out_nwt)).toFixed(3) + '</td>'

								+ '<td>' + closing_pcs + '</td>'

								+ '<td>' + closing_gwt + '</td>'

								+ '<td>' + closing_nwt + '</td>'

								+ '<td>' + item.in_trans_pcs + '</td>'

								+ '<td>' + parseFloat(parseFloat(closing_pcs) + parseFloat(item.in_trans_pcs)) + '</td>'

							'</tr>';

							closing_inw_pcs += parseFloat(closing_pcs);

							closing_inw_gwt += parseFloat(closing_gwt);

							closing_net_wt += parseFloat(closing_nwt);

						});

						if ($('#select_group_by').val() == 1) {

							trHTML += '<tr style="font-weight:bold; color:red">' +

								+'<td></td>'

								+ '<td style="text-align:left;"><strong>SUB TOTAL</strong></td>'

								+ '<td>' + op_blc_pcss + '</td>'

								+ '<td>' + money_format_india(parseFloat(op_blc_gwt).toFixed(3)) + '</td>'

								+ '<td>' + money_format_india(parseFloat(op_blc_nwt).toFixed(3)) + '</td>'

								+ '<td>' + money_format_india(inw_pcss) + '</td>'

								+ '<td>' + money_format_india(parseFloat(inw_gwt).toFixed(3)) + '</td>'

								+ '<td>' + money_format_india(parseFloat(inw_nwt).toFixed(3)) + '</td>'

								+ '<td>' + money_format_india(parseFloat(sold_pcs + other_s_pcs)) + '</td>'

								+ '<td>' + money_format_india(parseFloat(sold_gwt + other_s_gwt).toFixed(3)) + '</td>'

								+ '<td>' + money_format_india(parseFloat(sold_nwt + other_s_nwt).toFixed(3)) + '</td>'

								+ '<td>' + money_format_india(closing_inw_pcs) + '</td>'

								+ '<td>' + money_format_india(parseFloat(closing_inw_gwt).toFixed(3)) + '</td>'

								+ '<td>' + money_format_india(parseFloat(closing_net_wt).toFixed(3)) + '</td>'

								+ '<td></td>'

								+ '<td></td>'

							'</tr>';

						}

						metal_op_blc_pcss += parseFloat(op_blc_pcss);

						metal_op_blc_gwt += parseFloat(op_blc_gwt);

						metal_op_blc_nwt += parseFloat(op_blc_nwt);

						metal_inw_pcss += parseFloat(inw_pcss);

						metal_inw_gwt += parseFloat(inw_gwt);

						metal_inw_nwt += parseFloat(inw_nwt);

						metal_outward_pcs += parseFloat(sold_pcs + other_s_pcs);

						metal_outward_gwt += parseFloat(sold_gwt + other_s_gwt);

						metal_outward_nwt += parseFloat(sold_nwt + other_s_nwt);

						metal_closing_inw_pcs += parseFloat(closing_inw_pcs);

						metal_closing_inw_gwt += parseFloat(closing_inw_gwt);

						metal_closing_net_wt += parseFloat(closing_net_wt);

					});

					if ($('#select_group_by').val() == 1) {

						trHTML += '<tr style="font-weight:bold; color:red">' +

							+'<td></td>'

							+ '<td style="text-align:left;">TOTAL</td>'

							+ '<td>' + money_format_india(metal_op_blc_pcss) + '</td>'

							+ '<td>' + money_format_india(parseFloat(metal_op_blc_gwt).toFixed(3)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(metal_op_blc_nwt).toFixed(3)) + '</td>'

							+ '<td>' + money_format_india(metal_inw_pcss) + '</td>'

							+ '<td>' + money_format_india(parseFloat(metal_inw_gwt).toFixed(3)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(metal_inw_nwt).toFixed(3)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(metal_outward_pcs)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(metal_outward_gwt).toFixed(3)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(metal_outward_nwt).toFixed(3)) + '</td>'

							+ '<td>' + money_format_india(metal_closing_inw_pcs) + '</td>'

							+ '<td>' + money_format_india(parseFloat(metal_closing_inw_gwt).toFixed(3)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(metal_closing_net_wt).toFixed(3)) + '</td>'

							+ '<td></td>'

							+ '<td></td>'

						'</tr>';

					}

					total_op_blc_pcss += parseFloat(metal_op_blc_pcss);

					total_op_blc_gwt += parseFloat(metal_op_blc_gwt);

					total_op_blc_nwt += parseFloat(metal_op_blc_nwt);

					total_inw_pcss += parseFloat(metal_inw_pcss);

					total_inw_gwt += parseFloat(metal_inw_gwt);

					total_inw_nwt += parseFloat(metal_inw_nwt);

					total_outward_pcs += parseFloat(metal_outward_pcs);

					total_outward_gwt += parseFloat(metal_outward_gwt);

					total_outward_nwt += parseFloat(metal_outward_nwt);

					total_closing_inw_pcs += parseFloat(metal_closing_inw_pcs);

					total_closing_inw_gwt += parseFloat(metal_closing_inw_gwt);

					total_closing_net_wt += parseFloat(metal_closing_net_wt);

				});

				trHTML += '<tr style="font-weight:bold; color:blue">' +

					+'<td></td>'

					+ '<td style="text-align:left;">GRAND TOTAL</td>'

					+ '<td>' + money_format_india(total_op_blc_pcss) + '</td>'

					+ '<td>' + money_format_india(parseFloat(total_op_blc_gwt).toFixed(3)) + '</td>'

					+ '<td>' + money_format_india(parseFloat(total_op_blc_nwt).toFixed(3)) + '</td>'

					+ '<td>' + money_format_india(total_inw_pcss) + '</td>'

					+ '<td>' + money_format_india(parseFloat(total_inw_gwt).toFixed(3)) + '</td>'

					+ '<td>' + money_format_india(parseFloat(total_inw_nwt).toFixed(3)) + '</td>'

					+ '<td>' + money_format_india(parseFloat(total_outward_pcs)) + '</td>'

					+ '<td>' + money_format_india(parseFloat(total_outward_gwt).toFixed(3)) + '</td>'

					+ '<td>' + money_format_india(parseFloat(total_outward_nwt).toFixed(3)) + '</td>'

					+ '<td>' + money_format_india(total_closing_inw_pcs) + '</td>'

					+ '<td>' + money_format_india(parseFloat(total_closing_inw_gwt).toFixed(3)) + '</td>'

					+ '<td>' + money_format_india(parseFloat(total_closing_net_wt).toFixed(3)) + '</td>'

					+ '<td></td>'

					+ '<td></td>'

				'</tr>';

				$('#stock_list > tbody').html(trHTML);

				// Check and initialise datatable

				if (!$.fn.DataTable.isDataTable('#stock_list')) {

					oTable = $('#stock_list').dataTable({

						"bSort": false,

						"bInfo": true,

						"scrollX": '100%',

						"dom": 'lBfrtip',

						"paging": false,

						"columnDefs": [

							{

								targets: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14],

								className: 'dt-body-right'

							},

						],

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: '',

								messageTop: title,

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', 'inherit');

								},

							},

							{

								extend: 'colvis',

								collectionLayout: 'fixed columns',

								collectionTitle: 'Column visibility control'

							},

							{

								extend: 'excel',

								footer: true,

								title: 'STOCK REPORT ' + branch_name + '-' + dt_range[0] + '-' + dt_range[1],

							}

						],

					});

				}

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function stock_checking() {

	$("div.overlay").css("display", "block");

	var dt_range = ($("#dt_range").val()).split('-');

	var branch_name = $("#branch_select option:selected").text();

	var company_name = $('#company_name').val();

	var title = "<b><span style='font-size:15pt;margin-left:50%;'>" + company_name + "</span></b><b><span style='font-size:15pt;'></span></b></br>" + "<span style=font-size:13pt;margin-left:25%;>&nbsp;&nbsp;Stock Report " + ($("#branch_select").val() != '' ? "Cost Center:" + branch_name + " " : '') + "From&nbsp;:&nbsp;" + dt_range[0] + " &nbsp;&nbsp;To Date&nbsp;:&nbsp;" + dt_range[1] + "</span>";

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/stock_checking/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'dt_range': $("#dt_range").val(), 'id_branch': $("#branch_select").val(), 'id_product': $('#prod_select').val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			$("#stock_list > tbody > tr").remove();

			if (list != null) {

				trHTML = '';

				tfootHTML = '';

				total_bill_amount = 0;

				total_bill_tax_value = 0;

				$.each(list, function (i, branch) {

					var op_blc_pcss = 0;

					var op_blc_gwt = 0;

					var op_blc_nwt = 0;

					var inw_pcss = 0;

					var inw_gwt = 0;

					var inw_nwt = 0;

					var sold_pcs = 0;

					var sold_gwt = 0;

					var sold_nwt = 0;

					var closing_inw_pcs = 0;

					var closing_inw_gwt = 0;

					var closing_net_wt = 0;

					$.each(branch, function (idx, item) {

						op_blc_pcss += parseFloat(item.op_blc_pcs);

						op_blc_gwt += parseFloat(item.op_blc_gwt);

						op_blc_nwt += parseFloat(item.op_blc_nwt);

						inw_pcss += parseFloat(item.inw_pcs);

						inw_gwt += parseFloat(item.inw_gwt);

						inw_nwt += parseFloat(item.inw_nwt);

						sold_pcs += parseFloat(item.sold_pcs);

						sold_gwt += parseFloat(item.sold_gwt);

						sold_nwt += parseFloat(item.sold_nwt);

						var closing_pcs = parseFloat(item.op_blc_pcs) + parseFloat(item.inw_pcs) - parseFloat(item.sold_pcs);

						var closing_gwt = parseFloat(parseFloat(item.op_blc_gwt) + parseFloat(item.inw_gwt) - parseFloat(item.sold_gwt)).toFixed(3);

						var closing_nwt = parseFloat(parseFloat(item.op_blc_nwt) + parseFloat(item.inw_nwt) - parseFloat(item.sold_nwt)).toFixed(3);

						trHTML += '<tr>'

							+ '<td>' + item.product_name + '</td>'

							+ '<td>' + item.op_blc_pcs + '</td>'

							+ '<td>' + item.op_blc_gwt + '</td>'

							+ '<td>' + item.op_blc_nwt + '</td>'

							+ '<td>' + item.inw_pcs + '</td>'

							+ '<td>' + item.inw_gwt + '</td>'

							+ '<td>' + item.inw_nwt + '</td>'

							+ '<td>' + item.sold_pcs + '</td>'

							+ '<td>' + item.sold_gwt + '</td>'

							+ '<td>' + item.sold_nwt + '</td>'

							+ '<td>' + closing_pcs + '</td>'

							+ '<td>' + closing_gwt + '</td>'

							+ '<td>' + closing_nwt + '</td>'

						'</tr>';

						closing_inw_pcs += parseFloat(closing_pcs);

						closing_inw_gwt += parseFloat(closing_gwt);

						closing_net_wt += parseFloat(closing_nwt);

					});

					trHTML += '<tr style="font-weight:bold;">' +

						+'<td></td>'

						+ '<td>Sub Total</td>'

						+ '<td>' + op_blc_pcss + '</td>'

						+ '<td>' + parseFloat(op_blc_gwt).toFixed(3) + '</td>'

						+ '<td>' + parseFloat(op_blc_nwt).toFixed(3) + '</td>'

						+ '<td>' + inw_pcss + '</td>'

						+ '<td>' + parseFloat(inw_gwt).toFixed(3) + '</td>'

						+ '<td>' + parseFloat(inw_nwt).toFixed(3) + '</td>'

						+ '<td>' + sold_pcs + '</td>'

						+ '<td>' + parseFloat(sold_gwt).toFixed(3) + '</td>'

						+ '<td>' + parseFloat(sold_nwt).toFixed(3) + '</td>'

						+ '<td>' + closing_inw_pcs + '</td>'

						+ '<td>' + parseFloat(closing_inw_gwt).toFixed(3) + '</td>'

						+ '<td>' + parseFloat(closing_net_wt).toFixed(3) + '</td>'

					'</tr>';

				});

				$('#stock_list > tbody').html(trHTML);

				// Check and initialise datatable

				if (!$.fn.DataTable.isDataTable('#stock_list')) {

					oTable = $('#stock_list').dataTable({

						"bSort": false,

						"bInfo": true,

						"scrollX": '100%',

						"dom": 'lBfrtip',

						"paging": false,

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: title,

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', 'inherit');

								},

							},

							{

								extend: 'excel',

								footer: true,

								title: title,

							}

						],

					});

				}

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//Tag scan missing report

function tag_missing_report() {

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/tag_scan_missing/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'id_product': $('#prod_select').val(), 'id_design': $("#des_select").val(), 'id_branch': $("#branch_select").val(), 'id_weight': $('#wt_select').val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.list;

			var oTable = $('#tag_missing_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#tag_missing_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"order": [[0, "desc"]],

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: "Tag Missing Report" + ($("#branch_select").val() != '' ? '- ' + $("#branch_select option:selected").text() : ''),

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: "Tag Missing Report" + ($("#branch_select").val() != '' ? '- ' + $("#branch_select option:selected").text() : ''),

						}

					],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "branch_name" },

						{ "mDataProp": "tag_date" },

						{ "mDataProp": "tag_id" },

						{ "mDataProp": "product_name" },

						{ "mDataProp": "design_name" },

						{ "mDataProp": "piece" },

						{ "mDataProp": "gross_wt" },

						{ "mDataProp": "net_wt" },

						{ "mDataProp": "tag_mc_value" },

						{

							"mDataProp": function (row, type, val, meta) {

								if (row.tag_mc_type == 1 && row.tag_mc_value > 0) {

									var tag_mc_value = 0;

									if (row.calculation_based_on == 0 || row.calculation_based_on == 2) {

										tag_mc_value = parseFloat(row.tag_mc_value / row.gross_wt).toFixed(2);

									} else if (row.calculation_based_on == 1) {

										tag_mc_value = parseFloat(row.tag_mc_value / row.net_wt).toFixed(2);

									} else {

										tag_mc_value = '-';

									}

									return tag_mc_value;

								}

								else {

									return '-';

								}

							},

						},

						{

							"mDataProp": function (row, type, val, meta) {

								if (row.tag_mc_type == 2 && row.tag_mc_value > 0) {

									var tag_mc_value = 0;

									tag_mc_value = parseFloat(parseFloat(row.tag_mc_value) / parseFloat(row.piece)).toFixed(2);

									return tag_mc_value;

								} else {

									return '-';

								}

							},

						},

						{ "mDataProp": "sales_value" },

					],

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//Tag scan missing report

//Tag scan report

function get_scanned_details_report() {

	var dt_range = ($("#dt_range").val()).split('-');

	var company_name = $('#company_name').val();

	var from_date = dt_range[0];

	var to_date = dt_range[1];

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = $('#report_type').val() == 1 ? 'SCANNED REPORT' : 'UNSCANNED REPORT';

	var prod_select = $('#prod_select option:selected').html() != '' && $('#prod_select option:selected').html() != undefined ? $('#prod_select option:selected').html() + ' - ' : '';

	var optional = prod_select;

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/scan_report/scanned_report?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'dt_range': $("#dt_range").val(), 'id_product': $('#prod_filter').val(), 'id_design': $('#des_select').val(), 'id_sub_design': $('#sub_des_select').val(), 'category': $('#category_select').val(), 'id_section': $('#section_select').val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'report_type': $('#report_type').val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data;

			var oTable = $('#scanned_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#scanned_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"order": [[0, "desc"]],

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"columnDefs": [

						{

							targets: [10, 11, 12],

							className: 'dt-body-right'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'colvis',

							collectionLayout: 'fixed columns',

							collectionTitle: 'Column visibility control'

						},

						{

							extend: 'excel',

							footer: true,

							title: "Scan Report",

						}

					],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "id_scanned" },

						{ "mDataProp": "tag_code" },

						{ "mDataProp": "old_tag_id" },

						{

							"mDataProp": function (row, type, val, meta) {

								if (row.tag_img != null && row.tag_img != undefined && row.tag_img != '') {

									var img_src = base_url + 'assets/img/tag/' + row.tag_img;

								}

								else {

									var img_src = base_url + 'assets/img/no_image.png';

								}

								var image = "<img  class='img_src' id='img_prev' src=" + img_src + "  width='35' height='35' onClick=tag_imgprev($(this).closest('tr')) ></img>"

								return image;

							}

						},

						{ "mDataProp": "tag_date" },

						{ "mDataProp": "scanned_date" },

						{ "mDataProp": "section_name" },

						{ "mDataProp": "category_name" },

						{ "mDataProp": "product_name" },

						{ "mDataProp": "design_name" },

						{ "mDataProp": "sub_design_name" },

						{ "mDataProp": "size" },

						{ "mDataProp": "piece" },

						{ "mDataProp": "gross_wt" },

						{ "mDataProp": "net_wt" },

						{ "mDataProp": "dia_wt" },

						{ "mDataProp": "remarks" },

					],

					"footerCallback": function (row, data, start, end, display) {

						if (list.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								piece = api

									.column(12)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(12).footer()).html(parseFloat(piece).toFixed(0));

								gross_wt = api

									.column(13)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(13).footer()).html(parseFloat(gross_wt).toFixed(3));

								net_wt = api

									.column(14)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(14).footer()).html(parseFloat(net_wt).toFixed(3));

								if ($('#report_type').val() == 1) {

									dia_wt = api

										.column(15)

										.data()

										.reduce(function (a, b) {

											return intVal(a) + intVal(b);

										}, 0);

									$(api.column(15).footer()).html(parseFloat(dia_wt).toFixed(3));

								}

							}

						} else {

							var api = this.api(), data;

							$(api.column(10).footer()).html('');

							$(api.column(11).footer()).html('');

							$(api.column(12).footer()).html('');

							$(api.column(13).footer()).html('');

							$(api.column(14).footer()).html('');

							$(api.column(15).footer()).html('');

						}

					}

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function getScanned_details() {

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/scan_report/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'id_product': $('#prod_filter').val(), 'id_branch': $("#branch_scan_filter").val(), 'id_section': $('#section_filter').val(), 'id_design': $('#des_select').val(), 'id_sub_design': $('#sub_des_select').val(), 'category': $('#category_select').val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list.total_items;

			var oTable = $('#tag_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#tag_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"order": [[0, "desc"]],

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: "Stock Checking Tag Scan Report" + ($("#branch_select").val() != '' ? '- ' + $("#branch_select option:selected").text() : ''),

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'colvis',

							collectionLayout: 'fixed columns',

							collectionTitle: 'Column visibility control'

						},

						{

							extend: 'excel',

							footer: true,

							title: "Stock Checking Tag Scan Report" + ($("#branch_select").val() != '' ? '- ' + $("#branch_select option:selected").text() : ''),

						}

					],

					"aaData": list,

					"aoColumns": [

						{

							"mDataProp": function (row, type, val, meta) {

								if (row.tag_img != null && row.tag_img != undefined && row.tag_img != '') {

									var img_src = base_url + 'assets/img/tag/' + row.tag_img;

								}

								else {

									var img_src = base_url + 'assets/img/no_image.png';

								}

								var image = "<img  class='img_src' id='img_prev' src=" + img_src + "  width='35' height='35' onClick=tag_imgprev($(this).closest('tr')) ></img>"

								return image;

							}

						},

						{ "mDataProp": "branch_name" },

						{ "mDataProp": "section_name" },

						{ "mDataProp": "category_name" },

						{ "mDataProp": "product_name" },

						{ "mDataProp": "design_name" },

						{ "mDataProp": "sub_design_name" },

						{ "mDataProp": "scanned_pcs" },

						{ "mDataProp": "scanned_gwt" },

						{ "mDataProp": "scanned_nwt" },

						{ "mDataProp": "unscanned_pcs" },

						{ "mDataProp": "unscanned_gwt" },

						{ "mDataProp": "unscanned_nwt" },

						{ "mDataProp": "sold_pcs" },

						{ "mDataProp": "sold_gwt" },

						{ "mDataProp": "sold_nwt" },

						{ "mDataProp": "tot_pcs" },

						{ "mDataProp": "tot_gwt" },

						{ "mDataProp": "tot_nwt" },

					],

					"footerCallback": function (row, data, start, end, display) {

						if (list.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								scanned_pcs = api

									.column(7)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(7).footer()).html(parseFloat(scanned_pcs).toFixed(0));

								scanned_gwt = api

									.column(8)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(8).footer()).html(parseFloat(scanned_gwt).toFixed(3));

								scanned_nwt = api

									.column(9)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(9).footer()).html(parseFloat(scanned_nwt).toFixed(3));

								unscanned_pcs = api

									.column(10)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(10).footer()).html(parseFloat(unscanned_pcs).toFixed(0));

								unscanned_gwt = api

									.column(11)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(11).footer()).html(parseFloat(unscanned_gwt).toFixed(3));

								unscanned_nwt = api

									.column(12)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(12).footer()).html(parseFloat(unscanned_nwt).toFixed(3));

								sold_pcs = api

									.column(13)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(13).footer()).html(parseFloat(sold_pcs).toFixed(0));

								sold_gwt = api

									.column(14)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(14).footer()).html(parseFloat(sold_gwt).toFixed(3));

								sold_nwt = api

									.column(15)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(15).footer()).html(parseFloat(sold_nwt).toFixed(3));

								tot_pcs = api

									.column(16)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(16).footer()).html(parseFloat(tot_pcs).toFixed(0));

								tot_gwt = api

									.column(17)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(17).footer()).html(parseFloat(tot_gwt).toFixed(3));

								tot_nwt = api

									.column(18)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(18).footer()).html(parseFloat(tot_nwt).toFixed(3));

							}

						} else {

							var api = this.api(), data;

							$(api.column(5).footer()).html('');

							$(api.column(6).footer()).html('');

							$(api.column(7).footer()).html('');

							$(api.column(8).footer()).html('');

							$(api.column(9).footer()).html('');

							$(api.column(10).footer()).html('');

							$(api.column(11).footer()).html('');

							$(api.column(12).footer()).html('');

							$(api.column(13).footer()).html('');

							$(api.column(14).footer()).html('');

							$(api.column(15).footer()).html('');

							$(api.column(16).footer()).html('');

							$(api.column(17).footer()).html('');

							$(api.column(18).footer()).html('');

						}

					}

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

$("body").on("click", "#tag_scan", function () {

	$('.tag_scan_filter').css('display', 'block');

	$('.tag_details').css('display', 'none');

	$('.tag_filter').css('display', 'none');

	$('.report_filter').css('display', 'none');

	$('.scan_details').css('display', 'block');

	$('.tag_scan').css('display', 'block');

	get_ActiveProduct();

	get_branchname_list();

});

$("body").on("click", "#scanned_details", function () {

	$('.tag_scan_filter').css('display', 'none');

	$('.report_filter').css('display', 'block');

	$('.tag_details').css('display', 'block');

	$('.scan_details').css('display', 'none');

	$('.tag_scan').css('display', 'none');

	get_ActiveProduct();

	get_branchname_list();

});

$('#scan_close').on('click', function () {

	if ($('#prod_select').val() == null || $('#prod_select').val() == '') {

		$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + 'Please Select Product' });

	}

	else if ($('#branch_select').val() == '' || $('#branch_select').val() == null) {

		$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + 'Please Select Branch' });

	} else if ($('#section_select').val() == '' || $('#section_select').val() == null) {

		$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + 'Please Select Section' });

	}

	else {

		proceed = confirm("Are You Sure Want to Close This Scan ?");

		if (proceed) {

			close_tag_scan();

		}

	}

});

$('#tag_scan_search').on('click', function (e) {

	var input = $('#tag_id').val();

	var old_tag_id = $('#old_tag_id').val().replaceAll(' ', '');

	var tag_id = input.split('/')[0];

	var print_taken = input.split('/')[1];

	var validate = validate_Tag_Scan();

	if (validate) {

		get_tag_scan_details(tag_id, old_tag_id);

	}

});

$("#tag_id,#old_tag_id").keypress(function (e) {

	if (e.which == 13) {

		var old_tag_id = $('#old_tag_id').val().replaceAll(' ', '');

		var validate = validate_Tag_Scan();

		if (validate) {

			get_tag_scan_details($("#tag_id").val(), old_tag_id);

		}

	}

});

function validate_Tag_Scan() {

	var validate = true;

	var old_tag_id = $('#old_tag_id').val().replaceAll(' ', '');

	var input = $('#tag_id').val();

	var tag_id = input.split('/')[0];

	if ($('#branch_select').val() == null || $('#branch_select').val() == 0) {

		$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + 'Please Select Branch ...' });

		validate = false;

	} else if ($('#prod_select').val() == null) {

		$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + 'Please Select Product ...' });

		validate = false;

	} else if ($('#section_select').val() == null) {

		$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + 'Please Select Section ...' });

		validate = false;

	}

	else if (tag_id == '' && old_tag_id == '') {

		$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + 'Please Enter The Tag Number..' });

		validate = false;

	}

	return validate;

}

function get_tag_scan_details(tag_id, old_tag_id) {

	$("div.overlay").css("display", "block");

	var my_Date = new Date();

	$.ajax({

		url: base_url + 'index.php/admin_ret_reports/get_tag_scan_details/?nocache=' + my_Date.getUTCSeconds(),

		dataType: "json",

		method: "POST",

		data: { 'tag_id': tag_id, 'old_tag_id': old_tag_id, 'id_product': $('#prod_select').val(), 'id_branch': $('#branch_select').val(), 'id_section': $('#section_select').val(), 'design': $('#des_select').val(), 'sub_design': $('#sub_des_select').val(), 'id_size': $('#select_size').val() },

		success: function (data) {

			if (data.status) {

				set_tag_scanned_list(data.tag_details);

			} else {

				alert(data.msg);

				$("div.overlay").css("display", "none");

			}

			$('#tag_id').val('');

			$('#old_tag_id').val('');

		}

	});

}

function close_tag_scan() {

	$("div.overlay").css("display", "block");

	var my_Date = new Date();

	$.ajax({

		url: base_url + 'index.php/admin_ret_reports/close_tag_scan/?nocache=' + my_Date.getUTCSeconds(),

		dataType: "json",

		method: "POST",

		data: { 'id_product': $('#prod_select').val(), 'id_branch': $('#branch_select').val(), 'id_section': $('#section_select').val() },

		success: function (data) {

			if (data.status) {

				alert(data.msg)

				//set_tag_scanned_list(data.tag_details);

			} else {

				alert(data.msg);

			}

			$('#tag_id').val('');

		}

	});

	$("div.overlay").css("display", "none");

}

function set_tag_scanned_list(tag_details) {

	var data = tag_details;

	console.log(data);

	var trHtml = '';

	$.each(tag_details, function (key, data) {

		if (data.tag_image != null && data.tag_image != undefined && data.tag_image != '') {

			var img_src = base_url + 'assets/img/tag/' + data.tag_image;

		}

		else {

			var img_src = base_url + 'assets/img/no_image.png';

		}

		// $('#id_tag_scanned').val(data.id_tag_scanned);

		// trHtml += '<tr>'

		trHtml += '<tr data-row-id="' + data.id_tag_scanned + '">'

			+ '<td><img class="img_src"  id="img_prev" src="' + img_src + '" width="35" height="35" onclick="tag_imgprev($(this).closest(\'tr\'))"></td>'

			+ '<td><input type="hidden" class="id_tag_scanned" value="' + data.id_tag_scanned + '">' + data.tag_code + '</td>'

			+ '<td>' + data.old_tag_id + '</td>'

			+ '<td>' + data.section_name + '</td>'

			+ '<td>' + data.product_name + '</td>'

			+ '<td>' + data.design_name + '</td>'

			+ '<td>' + data.sub_design_name + '</td>'

			+ '<td>' + data.size + '</td>'

			+ '<td><input type="hidden" class="piece" value="' + data.piece + '">' + data.piece + '</td>'

			+ '<td><input type="hidden" class="gross_wt" value="' + data.gross_wt + '">' + data.gross_wt + '</td>'

			+ '<td><input type="hidden" class="net_wt" value="' + data.net_wt + '">' + data.net_wt + '</td>'

			+ '<td><input type="hidden" class="dia_wt" value="' + data.dia_wt + '">' + data.dia_wt + '</td>'

			+ '<td><input type="hidden" class="tag_mc_value" value="' + data.tag_mc_value + '">' + data.tag_mc_value + '</td>'

			+ '<td><input type="hidden" class="sales_value" value="' + data.sales_value + '">' + data.sales_value + '</td>'

			+ '<td><a href="#" onclick="update_order_description($(this).closest(\'tr\'));" class="btn btn-default btn-sm"><i class="fa fa-plus"></i></a><input type="hidden" class="remark" value=""></td>'

			// + '<td><a href="#" class="btn btn-default btn-sm" onclick="update_order_description(this);"><i class="fa fa-plus"></i></a><input type="hidden" class="remark" value=""></td>'

			+ '</tr>';

	});

	if ($('#tagging_scan_list > tbody  > tr').length > 0) {

		$('#tagging_scan_list > tbody > tr:first').before(trHtml);

	} else {

		$('#tagging_scan_list tbody').append(trHtml);

	}

	calcluate_tag_scanned();

	$("div.overlay").css("display", "none");

}

function update_order_description(curRow) {

	var row = curRow.closest('tr');

	var rowId = row.data('row-id');

	console.log(rowId);

	var remarkInput = row.find('.remark').val();

	console.log(remarkInput);

	$('#scan_id').val(rowId);

	if (remarkInput != "") {

		$('#order_des').on('shown.bs.modal', function () {

			$('#description').val(remarkInput);

		});

	}

	else {

		$('#order_des').on('shown.bs.modal', function () {

			$('#description').val('');

		});

	}

	$('#order_des').modal('show');

}

$('#add_des').on('click', function (event) {

	event.preventDefault();

	// var scan = $('.id_tag_scanned').val();

	var order_des = $('#description').val();

	var scan = $('#scan_id').val();

	$('#des').val(order_des);

	var des = $('#des').val();

	if (order_des == '') {

		$.toaster({ priority: 'danger', title: 'Warning!', message: 'Please Enter The Description' });

	} else {

		my_Date = new Date();

		$("div.overlay").css("display", "block");

		$.ajax({

			url: base_url + "index.php/admin_ret_reports/scan_report/save?nocache=" + my_Date.getUTCSeconds(),

			dataType: "JSON",

			data: { 'remark': order_des, 'id_tag_scanned': scan },

			type: "POST",

			success: function (data) {

				$("div.overlay").css("display", "none");

				$('#tagging_scan_list > tbody tr').each(function (idx, row) {

					var curRow = $(this);

					var scanned = curRow.data('row-id');

					// Loop through each remark in the data

					$.each(data.remark, function (k, items) {

						if (scanned == items.id_tag_scanned) {

							curRow.find('.remark').val(items.remark);

							$('.remark').val();

							var remark = $('.remark').val();

							console.log(remark);

							// if(remark!="")

							// {

							// $('#order_des').on('shown.bs.modal', function () {

							// 	$('#description').val(remark);

							// });

							// }

							// else{

							// 	$('#order_des').on('shown.bs.modal', function () {

							// 		$('#description').val('');

							// 	});

							// }

							// Break out of the inner loop since we found a match

							return false;

						}

					});

				});

				if (data.status) {

					$.toaster({ priority: 'success', title: 'Success!', message: data.message });

					$('#order_des').modal('hide');

				} else {

					$.toaster({ priority: 'danger', title: 'Warning!', message: data.message });

				}

			},

			error: function (error) {

				$("div.overlay").css("display", "none");

			}

		});

	}

});

function calcluate_tag_scanned() {

	var total_pcs = 0;

	var total_grs_wt = 0;

	var total_mc = 0;

	var total_sales = 0;

	var total_dia_wt = 0;

	var total_net_wt = 0;

	var trHtml = '';

	$('#tagging_scan_list > tbody tr').each(function (idx, row) {

		curRow = $(this);

		total_pcs += parseFloat(curRow.find('.piece').val());

		total_grs_wt += parseFloat(curRow.find('.gross_wt').val());

		total_dia_wt += parseFloat(curRow.find('.dia_wt').val());

		total_net_wt += parseFloat(curRow.find('.net_wt').val());

		total_mc += parseFloat(curRow.find('.tag_mc_value').val());

		total_sales += parseFloat(curRow.find('.sales_value').val());

	});

	trHtml += '<tr style="font-weight:bold;">'

		+ '<td colspan="8">Total</td>'

		+ '<td>' + total_pcs + '</td>'

		+ '<td>' + parseFloat(total_grs_wt).toFixed(3) + '</td>'

		+ '<td>' + parseFloat(total_net_wt).toFixed(3) + '</td>'

		+ '<td>' + parseFloat(total_dia_wt).toFixed(3) + '</td>'

		+ '<td>' + parseFloat(total_mc).toFixed(2) + '</td>'

		+ '<td>' + parseFloat(total_sales).toFixed(2) + '</td>'

		+ '</tr>';

	$('#tagging_scan_list > tfoot').html(trHtml);

	$('#tot_scanned_pcs').html(parseFloat(total_pcs));

}

function calculateTag() {

	var tot_pcs = 0;

	var tot_gwt = 0;

	var tot_nwt = 0;

	$('#tagging_scan_list > tbody  > tr').each(function (index, tr) {

		tot_pcs += parseFloat((isNaN($(this).find('.tot_pcs').val()) || $(this).find('.tot_pcs').val() == '') ? 0 : $(this).find('.tot_pcs').val());

	});

	console.log(tot_pcs);

	console.log(tot_gwt);

	console.log(tot_nwt);

}

//Tag scan report

// Product-wise Sales

/*function itemwise_sales()

{

	var dt_range=($("#dt_range").val()).split('-');

	var branch_name=$("#branch_select option:selected").text();

	var company_name=$('#company_name').val();

	var title="<b><span style='font-size:15pt;margin-left:50%;'>"+company_name+"</span></b><b><span style='font-size:15pt;'></span></b></br>"+"<span style=font-size:13pt;margin-left:25%;>&nbsp;&nbsp;Product Wise Sales Report "+($("#branch_select").val()!='' ? "Cost Center:"+branch_name+" ":'')+"From&nbsp;:&nbsp;"+dt_range[0]+" &nbsp;&nbsp;To Date&nbsp;:&nbsp;"+dt_range[1]+"</span>";

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		  type: 'POST',

		  url:base_url+ "index.php/admin_ret_reports/item_sales/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ( {'dt_range' :$("#dt_range").val(),'id_branch':($('#branch_filter').val()!='' && $('#branch_filter').val()!=undefined ? $('#branch_filter').val(): $("#branch_select").val()),'id_product':$('#prod_select').val(),'id_metal':$('#metal').val()}),

		  dataType : 'json',

		success:function(data){

		 $(".overlay").css("display", "none");

		var list = data.list;

		var oTable = $('#itemwise-sales').DataTable();

		oTable.clear().draw();

			if (list!= null)

			{

				$("#itemwise-sales > tbody > tr").remove();

				$('#itemwise-sales').dataTable().fnClearTable();

				$('#itemwise-sales').dataTable().fnDestroy();

				var trHtml='';

				var grand_total_pcs=0;

				var grand_total_gwt=0;

				var grand_total_nwt=0;

				var grand_total_amount=0;

				$.each(list,function(k,prod){

					var tot_pcs=0;

					var tot_gwt=0;

					var tot_nwt=0;

					var tot_amount=0;

					var product=prod.product_name;

						$.each(prod.design_details,function(key,items){

							tot_pcs+=parseFloat(items.tot_pcs);

							tot_gwt+=parseFloat(items.gross_wt);

							tot_nwt+=parseFloat(items.net_wt);

							tot_amount+=parseFloat(items.total_cost);

							grand_total_pcs+=parseFloat(items.tot_pcs);

							grand_total_gwt+=parseFloat(items.gross_wt);

							grand_total_nwt+=parseFloat(items.net_wt);

							grand_total_amount+=parseFloat(items.total_cost);

							 var url = base_url+'index.php/admin_ret_billing/billing_invoice/'+items.bill_id;

							 trHtml+='<tr>'

							 +'<td style="text-align:left;"><strong>'+product+" - "+items.design_name+'</strong></td>'

							 +'<td></td>'

							 +'<td></td>'

							 +'<td></td>'

							 +'<td></td>'

							 +'<td></td>'

							 +'<td></td>'

						 +'</tr>';

							trHtml+='<tr>'

								+'<td style="text-align:left;">'+items.sub_design_name +' </td>'

								+'<td>'+items.tot_pcs+'</td>'

								+'<td>'+items.tag_code+'</td>'

								+'<td><a href='+url+' target="_blank">'+items.bill_no+'</a></td>'

								+'<td>'+items.gross_wt+'</td>'

								+'<td>'+items.net_wt+'</td>'

								+'<td>'+items.total_cost+'</td>'

							+'</tr>';

						});

						trHtml+='<tr>'

								+'<td style="text-align:left;"><strong>SUB TOTAL</strong></td>'

								+'<td><strong>'+parseFloat(tot_pcs)+'</strong></td>'

								+'<td></td>'

								+'<td></td>'

								+'<td><strong>'+parseFloat(tot_gwt).toFixed(3)+'</strong></td>'

								+'<td><strong>'+parseFloat(tot_nwt).toFixed(3)+'</strong></td>'

								+'<td><strong>'+parseFloat(tot_amount).toFixed(3)+'</strong></td>'

							+'</tr>';

				});

				trHtml+='<tr>'

								+'<td style="text-align:left;"><strong>GRAND TOTAL</strong></td>'

								+'<td><strong>'+parseFloat(grand_total_pcs)+'</strong></td>'

								+'<td></td>'

								+'<td></td>'

								+'<td><strong>'+parseFloat(grand_total_gwt).toFixed(3)+'</strong></td>'

								+'<td><strong>'+parseFloat(grand_total_nwt).toFixed(3)+'</strong></td>'

								+'<td><strong>'+parseFloat(grand_total_amount).toFixed(2)+'</strong></td>'

							+'</tr>';

				$('#itemwise-sales > tbody').html(trHtml);

				// Check and initialise datatable

					 if ( ! $.fn.DataTable.isDataTable( '#itemwise-sales' ) ) {

						 oTable = $('#itemwise-sales').dataTable({

										"bSort": false,

										"bInfo": true,

										"scrollX":'100%',

										"dom": 'lBfrtip',

										"lengthMenu": [[-1, 25, 50, 100, 250], ["All" ,25, 50, 100, 250]],

										"buttons": [

													{

													   extend: 'print',

													   footer: true,

													   title: '',

													   messageTop: title,

													   orientation: 'landscape',

													   customize: function ( win ) {

															$(win.document.body).find('table')

															.addClass('compact');

															$(win.document.body).find( 'table' )

																.addClass('compact')

																.css('font-size','10px')

																.css('font-family','sans-serif');

														},

													 },

													 {

														extend:'excel',

														footer: true,

														title: 'STOCK AND SALES',

													  }

													 ],

									 });

					}

			}

		},

			error:function(error)

			{

			$("div.overlay").css("display", "none");

			}

		});

} */

function itemwise_sales() {

	var dt_range = ($("#dt_range").val()).split('-');

	var company_name = $('#company_name').val();

	var from_date = dt_range[0];

	var to_date = dt_range[1];

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "Product Wise Sales Report"

	var prod_select = $('#prod_select option:selected').html() != '' && $('#prod_select option:selected').html() != undefined ? $('#prod_select option:selected').html() + ' - ' : '';

	var metal = $('#metal option:selected').html() != '' && $('#metal option:selected').html() != undefined ? $('#metal option:selected').html() + ' - ' : '';

	var optional = prod_select + metal;

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		type: 'POST',

		url: base_url + "index.php/admin_ret_reports/item_sales/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'dt_range': $("#dt_range").val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'id_product': $('#prod_select').val(), 'id_metal': $('#metal').val() }),

		dataType: 'json',

		success: function (data) {

			$(".overlay").css("display", "none");

			var list = data.list;

			var oTable = $('#itemwise-sales').DataTable();

			oTable.clear().draw();

			if (list != null) {

				$("#itemwise-sales > tbody > tr").remove();

				$('#itemwise-sales').dataTable().fnClearTable();

				$('#itemwise-sales').dataTable().fnDestroy();

				var trHtml = '';

				var grand_total_pcs = 0;

				var grand_total_gwt = 0;

				var grand_total_nwt = 0;

				var grand_total_amount = 0;

				console.log(list);

				let result = Array.from( //convert new set value to set value

					new Set( // remove duplicate values from string array

						(list.map(listItem =>

							listItem.design_details.map((item) => {

								return JSON.stringify({

									'product_name': item.product_name,

									'design_name': item.design_name,

									//'sub_design_name': item.sub_design_name

								});

							})

						)).flat(Infinity)

					)

				).map(item => JSON.parse(item));

				result.forEach((item) => {

					item['list'] = (list.find(listItem => listItem.product_name == item.product_name) || {})?.design_details?.filter(designDet => designDet.design_name == item.design_name) || [];

				});

				Array.from(new Set(list.map(item => item.product_name))).forEach(product => {

					var tot_pcs = 0;

					var tot_gwt = 0;

					var tot_nwt = 0;

					var tot_amount = 0;

					let finalArr = result.filter(item => item.product_name == product);

					console.log(finalArr);

					$.each(finalArr, function (key, item) {

						trHtml += '<tr>'

							+ '<td style="text-align:left;"><strong>' + item.product_name + " - " + item.design_name + '</strong></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '</tr>';

						$.each(item.list, function (key, items) {

							tot_pcs += parseFloat(items.tot_pcs);

							tot_gwt += parseFloat(items.gross_wt);

							tot_nwt += parseFloat(items.net_wt);

							tot_amount += parseFloat(items.total_cost);

							grand_total_pcs += parseFloat(items.tot_pcs);

							grand_total_gwt += parseFloat(items.gross_wt);

							grand_total_nwt += parseFloat(items.net_wt);

							grand_total_amount += parseFloat(items.total_cost);

							var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + items.bill_id;

							trHtml += '<tr>'

								+ '<td style="text-align:left;">' + items.sub_design_name + ' </td>'

								+ '<td>' + items.tot_pcs + '</td>'

								+ '<td>' + items.tag_code + '</td>'

								+ '<td>' + items.old_tag_id + '</td>'

								+ '<td><a href=' + url + ' target="_blank">' + items.bill_no + '</a></td>'

								+ '<td>' + money_format_india(items.gross_wt) + '</td>'

								+ '<td>' + money_format_india(items.net_wt) + '</td>'

								+ '<td>' + items.cert_no + '</td>'

								+ '<td>' + items.style_code + '</td>'

								+ '<td>' + money_format_india(items.total_cost) + '</td>'

								+ '</tr>';

						});

					});

					trHtml += '<tr>'

						+ '<td style="text-align:left;color:red"><strong>SUB TOTAL</strong></td>'

						+ '<td><strong>' + parseFloat(tot_pcs) + '</strong></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td><strong>' + money_format_india(parseFloat(tot_gwt).toFixed(3)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(tot_nwt).toFixed(3)) + '</strong></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td><strong>' + money_format_india(parseFloat(tot_amount).toFixed(3)) + '</strong></td>'

						+ '</tr>';

				});

				trHtml += '<tr>'

					+ '<td style="text-align:left;color:blue"><strong>GRAND TOTAL</strong></td>'

					+ '<td><strong>' + parseFloat(grand_total_pcs) + '</strong></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td><strong>' + money_format_india(parseFloat(grand_total_gwt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(grand_total_nwt).toFixed(3)) + '</strong></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td><strong>' + money_format_india(parseFloat(grand_total_amount).toFixed(2)) + '</strong></td>'

					+ '</tr>';

				$('#itemwise-sales > tbody').html(trHtml);

				// Check and initialise datatable

				if (!$.fn.DataTable.isDataTable('#itemwise-sales')) {

					oTable = $('#itemwise-sales').dataTable({

						"bSort": false,

						"bInfo": true,

						"scrollX": '100%',

						"dom": 'lBfrtip',

						"lengthMenu": [[-1, 25, 50, 100, 250], ["All", 25, 50, 100, 250]],

						"columnDefs": [

							{

								targets: [2, 3, 4, 5, 6, 7, 8, 9],

								className: 'dt-body-right'

							},

						],

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: '',

								messageTop: title,

								orientation: 'landscape',

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact');

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', '10px')

										.css('font-family', 'sans-serif');

								},

							},

							{

								extend: 'colvis',

								collectionLayout: 'fixed columns',

								collectionTitle: 'Column visibility control'

							},

							{

								extend: 'excel',

								footer: true,

								title: 'STOCK AND SALES',

							}

						],

					});

				}

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function formatItemsRow(oTable, nTr) {

	var oData = oTable.fnGetData(nTr);

	var rowDetail = '';

	var designsTable =

		'<div class="innerDetails">' +

		'<table class="table table-responsive table-bordered text-center table-sm">' +

		'<tr class="bg-teal">' +

		'<th>Design</th>' +

		'<th>Pieces </th>' +

		'<th>Gwt </th>' +

		'<th>Nwt </th>' +

		'<th>Amount </th>' +

		'<th>Detail </th>' +

		'</tr>';

	var designs = oData.design_details;

	$.each(designs, function (idx, val) {

		var ref_no = val.design_id;

		var bills = val.bills[idx];

		var bill_details =

			'<tr class="tagsTable collapsed bg-teal ' + ref_no + ' drill-close"> ' +

			'<th>S.No</th>' +

			'<th>Bill Date </th>' +

			'<th>Bill No </th>' +

			'<th>Tag Code </th>' +

			'<th>Pcs  </th>' +

			'<th>G.wt </th>' +

			'<th>N.wt </th>' +

			'<th></th>' +

			'</tr>';

		$.each(val.bills, function (key, items) {

			var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + items.bill_id;

			bill_details +=

				'<tr class="tagsTable collapsed bg-info ' + ref_no + ' drill-close"> ' +

				'<td>' + parseFloat(key + 1) + '</td>' +

				'<td>' + items.bill_date + '</td>' +

				'<td><a href=' + url + ' target="_blank">' + items.bill_no + '</a></td>' +

				'<td>' + items.tag_code + '</td>' +

				'<td>' + items.piece + '</td>' +

				'<td>' + items.gross_wt + '</td>' +

				'<td>' + items.net_wt + '</td>' +

				'</tr><span>';

		});

		designsTable +=

			'<tr class="design_det_btn">' +

			'<td>' + val.design_name + '</td>' +

			'<td>' + val.tot_pcs + '</td>' +

			'<td>' + val.gross_wt + '</td>' +

			'<td>' + val.net_wt + '</td>' +

			'<td>' + val.total_cost + '</td>' +

			'<td><input type="hidden" id="ref_no" value="' + ref_no + '"/><i class="fa fa-chevron-circle-down text-info open"></i></i></td>' +

			bill_details +

			'</tr>';

	});

	rowDetail = designsTable + '</table></div>';

	return rowDetail;

}

// .Product-wise Sales

//bill wise transcation

function get_ActiveVillage() {

	$('#select_village option').remove();

	$('.overlay').css('display', 'block');

	$.ajax({

		type: 'POST',

		url: base_url + 'index.php/admin_settings/ajax_village_list',

		dataType: 'json',

		data: { 'id_zone': $('#select_zone').val() },

		success: function (data) {

			var id_village = '';

			$.each(data, function (key, data) {

				$('#select_village').append(

					$("<option></option>")

						.attr("value", data.id_village)

						.text(data.village_name)

				);

				$('#select_village').select2({

					placeholder: "Select Area",

					allowClear: true

				});

				$("#select_village").select2("val", (id_village != null ? id_village : ''));

			});

			$('.overlay').css('display', 'none');

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function get_bill_wise_trns_list() {

	$("div.overlay").css("display", "block");

	var dt_range = ($("#dt_range").val()).split('-');

	var company_name = $('#company_name').val();

	var from_date = dt_range[0];

	var to_date = dt_range[1];

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "BILL WISE DETAILED REPORT ";

	var village = $('#select_village option:selected').html() != undefined ? ($('#select_village option:selected').html() + " - ") : '';

	var floor = $('#floor_sel option:selected').html() != undefined ? ($('#floor_sel option:selected').html() + " - ") : '';

	var counter = $('#counter_sel option:selected').html() != undefined ? $('#counter_sel option:selected').html() + " - " : '';

	var optional = village + floor + counter;

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/bill_wise_transcation/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'dt_range': $("#dt_range").val(), 'id_product': $('#prod_select').val(), 'id_design': $("#des_select").val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'id_weight': $('#wt_select').val(), 'id_village': $('#select_village').val(), 'id_counter': $('#counter_sel').val(), 'id_metal': $('#metal').val(), 'id_category': $('#category').val(), 'bill_wise_type': $('#bill_wise_type').val(), 'id_section': $('#section_select').val(), 'id_floor': $('#floor_sel').val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			var receipt = data.receipt;

			var bill_wise_type = $('#bill_wise_type').val();

			console.log(data.list);

			$("#bill_list > tbody > tr").remove();

			$('#bill_list').dataTable().fnClearTable();

			$('#bill_list').dataTable().fnDestroy();

			if (list != null) {

				trHTML = '';

				tfootHTML = '';

				var tot_ret_amt = 0;

				var tot_net_amt = 0;

				var total_cash_amt = 0;

				var total_card_amt = 0;

				var total_net_banking_amt = 0;

				var total_chq_amt = 0;

				var total_adv_adj_amt = 0;

				var total_chit_adj_amt = 0;

				var total_adv_adj = 0;

				var tot_due_amt = 0;

				var tot_due_amt = 0;

				var tot_gift_adj = 0;

				var advance_paid_amt = 0;

				var handling_charges = 0;

				var receipt_cash_amt = 0;

				var receipt_total_cash_amt = 0;

				var receipt_card_amt = 0;

				var receipt_total_card_amt = 0;

				var receipt_chq_amt = 0;

				var receipt_total_chq_amt = 0;

				var receipt_net_banking_amt = 0;

				var receipt_total_net_banking_amt = 0;

				var receipt_total_net_amount = 0;

				var total_net_amount = 0;

				var sno = 1;

				if (list != "") {

					$.each(list, function (i, bill) {

						total_adv_adj += parseFloat(bill.order_adj_amt + bill.adv_adj_amt); // Order adj + general adj

						tot_ret_amt += parseFloat(bill.tot_ret_amt);  //tot sales return

						handling_charges += parseFloat(bill.handling_charges);

						if (bill.is_credit == 1) {

							tot_due_amt += parseFloat(bill.due_amt);

						}

						//total_chit_adj_amt+=parseFloat(bill.bill_wise_details.utilized_amt);

						//tot_gift_adj+=parseFloat(bill.bill_wise_details.gift_voucher_amt);

						var taxable_amt = 0;

						var tot_taxable_amt = 0;

						total_bill_amount = 0;

						total_bill_tax_value = 0;

						total_advance_amt = 0;

						cash_amt = 0;

						card_amt = 0;

						chq_amt = 0;

						tot_sales_ret = 0;

						net_banking_amt = 0;

						if (bill.sale_details == "") {

							var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + bill.bill_id;

							trHTML += '<tr>'

								+ '<td>' + (sno++) + '</td>'

								+ '<td>' + '<a href=' + url + ' target="_blank">' + bill.bill_no + '</td>'

								+ '<td>' + bill.bill_date + '</td>'

								+ '<td>' + bill.bill_type + '</td>'

								+ '<td>' + bill.customer_name + '</td>'

								+ '<td>' + bill.address1 + '</td>'

								+ '<td>' + bill.mobile + '</td>'

								+ '<td>' + bill.pan + '</td>'

								+ '<td>' + bill.gst_number + '</td>'

								+ '<td>' + bill.emp_name + '</td>'

								+ '<td>' + bill.village_name + '</td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

							'</tr>';

						}

						$.each(bill.sale_details, function (idx, item) {

							taxable_amt = parseFloat(item.item_cost - item.item_total_tax);

							tot_taxable_amt += parseFloat(item.item_cost - item.item_total_tax);

							advance_paid_amt += parseFloat(item.advance_amt != undefined ? item.advance_amt : 0)

							var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + item.bill_id;

							total_bill_amount += parseFloat((item.bill_type == 5 ? item.tot_bill_amount : item.item_cost));

							tot_net_amt += parseFloat((item.bill_type == 5 ? item.tot_bill_amount : item.item_cost));

							trHTML += '<tr>'

								+ '<td>' + (sno++) + '</td>'

								+ '<td>' + '<a href=' + url + ' target="_blank">' + bill.bill_no + '</td>'

								+ '<td>' + bill.bill_date + '</td>'

								+ '<td>' + bill.bill_type + '</td>'

								+ '<td>' + bill.customer_name + '</td>'

								+ '<td>' + bill.address1 + '</td>'

								+ '<td>' + bill.mobile + '</td>'

								+ '<td>' + bill.pan + '</td>'

								+ '<td>' + bill.gst_number + '</td>'

								+ '<td>' + bill.emp_name + '</td>'

								+ '<td>' + bill.village_name + '</td>'

								+ '<td>' + item.product_name + '</td>'

								+ '<td>' + item.section_name + '</td>'

								+ '<td>' + item.counter_name + '</td>'

								+ '<td>' + money_format_india((item.gross_wt != undefined ? item.gross_wt : '')) + '</td>'

								+ '<td>' + money_format_india((item.less_wt != undefined ? item.less_wt : '')) + '</td>'

								+ '<td>' + money_format_india((item.dia_wt != undefined ? item.dia_wt : '')) + '</td>'

								+ '<td>' + money_format_india((item.stone_wt != undefined ? item.stone_wt : '')) + '</td>'

								+ '<td>' + item.mc_type + '</td>'

								+ '<td>' + money_format_india((item.mc_value != undefined ? item.mc_value : '')) + '</td>'

								+ '<td>' + money_format_india((item.wastage_percent != undefined ? item.wastage_percent : '')) + '</td>'

								+ '<td>' + money_format_india((item.rate != undefined ? item.rate : '')) + '</td>'

								+ '<td>' + money_format_india((item.stone_amount != undefined ? item.stone_amount : '')) + '</td>'

								+ '<td>' + money_format_india((item.dia_amount != undefined ? item.dia_amount : '')) + '</td>'

								+ '<td>' + money_format_india((item.net_wt != undefined ? item.net_wt : '')) + '</td>'

								+ '<td>' + (item.bill_type == 'Order Advance' ? 'Order Advance' + '-' + item.order_no : item.tag_id) + '</td>'

								+ '<td>' + (item.piece != undefined ? item.piece : '') + '</td>'

								+ '<td>' + money_format_india((item.net_wt != undefined ? item.net_wt : '')) + '</td>'

								+ '<td>' + money_format_india((item.bill_discount != undefined ? item.bill_discount : '')) + '</td>'

								+ '<td>' + money_format_india(parseFloat((taxable_amt != undefined ? taxable_amt : 0)).toFixed(2)) + '</td>'

								+ '<td>' + money_format_india(parseFloat((item.total_cgst != undefined ? item.total_cgst : 0)).toFixed(2)) + '</td>'

								+ '<td>' + money_format_india(parseFloat((item.total_sgst != undefined ? item.total_sgst : 0)).toFixed(2)) + '</td>'

								+ '<td>' + money_format_india(parseFloat((item.total_igst != undefined ? item.total_igst : 0)).toFixed(2)) + '</td>'

								+ '<td><strong>' + money_format_india(parseFloat((item.item_cost != undefined ? item.item_cost : 0)).toFixed(2)) + '</strong></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td>' + money_format_india(parseFloat(item.advance_amt != undefined ? item.advance_amt : 0).toFixed(2)) + '</td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td>' + item.remark + '</td>'

								+ '<td>' + item.bill_status + '</td>'

							'</tr>';

						});

						$.each(bill.old_sales_details, function (idx, citem) {

							var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + citem.bill_id;

							trHTML += '<tr>'

								+ '<td></td>'

								+ '<td>' + '<a href=' + url + ' target="_blank">' + citem.bill_no + '</td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td>Purchase</td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td>' + citem.pur_ref_no + '</td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td>' + money_format_india(citem.gross_wt) + '</td>'

								+ '<td>' + money_format_india(citem.amount) + '</td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

							'</tr>';

							total_bill_amount -= parseFloat(citem.amount);

							tot_net_amt -= parseFloat(citem.amount);

						});

						$.each(bill.pay_details, function (idx, item) {

							if (item.payment_mode == 'Cash') {

								cash_amt += parseFloat(item.payment_amount);

								total_cash_amt += parseFloat(item.payment_amount);

							}

							if (item.payment_mode == 'CC' || item.payment_mode == 'DC') {

								card_amt += parseFloat(item.payment_amount);

								total_card_amt += parseFloat(item.payment_amount);

							}

							if (item.payment_mode == 'CHQ') {

								if (item.transcation_type == 1) {

									gen_cheque_payment += parseFloat(item.payment_amount);

									// gen_cheque_payment_rec += parseFloat(item.payment_amount);

								}

								if (item.transcation_type == 2) {

									gen_cheque_payment -= parseFloat(item.payment_amount);

									// gen_cheque_payment_pay -= parseFloat(item.payment_amount);

								}

							}

							if (item.payment_mode == 'NB') {

								net_banking_amt += parseFloat(item.payment_amount);

								total_net_banking_amt += parseFloat(item.payment_amount);

							}

						});

						var net_amount = parseFloat((total_bill_amount) - parseFloat(bill.tot_ret_amt) + parseFloat(bill.handling_charges) + parseFloat(bill.advance_deposit)).toFixed(2);

						var final_amount = parseFloat(parseFloat(cash_amt) + parseFloat(card_amt) + parseFloat(chq_amt) + parseFloat(net_banking_amt) + parseFloat(bill.order_adj_amt) + parseFloat(bill.adv_adj_amt) + parseFloat(bill.utilized_amt) + parseFloat(bill.gift_voucher_amt)).toFixed(2)

						var amount_difference = parseFloat(net_amount) - parseFloat(final_amount);

						trHTML += '<tr style="font-weight:bold;color:red">' +

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td>Total</td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td>' + parseFloat(bill.tot_ret_amt).toFixed(3) + '</td>'

							+ '<td>' + parseFloat((bill.is_credit = 1 ? bill.due_amt : 0)).toFixed(2) + '</td>'

							+ '<td>' + parseFloat(bill.advance_deposit) + '</td>'

							+ '<td>' + parseFloat(bill.handling_charges).toFixed(2) + '</td>'

							+ '<td style="width:2px;">' + money_format_india(net_amount) + '</td>'

							+ '<td>' + money_format_india(parseFloat(cash_amt).toFixed(2)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(card_amt).toFixed(2)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(chq_amt).toFixed(2)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(net_banking_amt).toFixed(2)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(bill.order_adj_amt + bill.adv_adj_amt).toFixed(2)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(bill.utilized_amt).toFixed(2)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(bill.gift_voucher_amt).toFixed(2)) + '</td>'

							+ '<td style="width:2px;">' + final_amount + '</td>'

							+ '<td></td>'

							+ '<td></td>'

						'</tr>';

					});

					trHTML += '<tr style="font-weight:bold;color:blue">' +

						+'<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td>GrandTotal</td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td>' + money_format_india(parseFloat(tot_ret_amt).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(tot_due_amt).toFixed(2)) + '</td>'

						+ '<td></td>'

						+ '<td>' + money_format_india(parseFloat(handling_charges).toFixed(2)) + '</td>'

						+ '<td style="width:2px;">' + money_format_india(parseFloat((tot_net_amt) - parseFloat(tot_ret_amt) - parseFloat(tot_due_amt) + parseFloat(advance_paid_amt) + parseFloat(handling_charges)).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(total_cash_amt).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(total_card_amt).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(total_chq_amt).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(total_net_banking_amt).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(total_adv_adj).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(total_chit_adj_amt).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(tot_gift_adj).toFixed(2)) + '</td>'

						+ '<td style="width:2px;">' + money_format_india(parseFloat(parseFloat(total_cash_amt) + parseFloat(total_card_amt) + parseFloat(total_chq_amt) + parseFloat(total_net_banking_amt) + parseFloat(total_adv_adj) + parseFloat(total_chit_adj_amt) + parseFloat(tot_gift_adj) + parseFloat(tot_gift_adj)).toFixed(2)) + '</td>'

						+ '<td></td>'

						+ '<td></td>'

					'</tr>';

				}

				if (receipt != null) {

					$.each(receipt, function (idx, item) {

						var url = base_url + 'index.php/admin_ret_billing/receipt/receipt_print/' + item.id_issue_receipt;

						trHTML += '<tr>'

							+ '<td>' + (sno++) + '</td>'

							+ '<td>' + '<a href=' + url + ' target="_blank">' + item.bill_no + '</td>'

							+ '<td>' + item.date_add + '</td>'

							+ '<td>' + item.type + '</td>'

							+ '<td>' + item.cus_name + '</td>'

							+ '<td>' + item.address + '</td>'

							+ '<td>' + item.mobile + '</td>'

							+ '<td>' + item.pan + '</td>'

							+ '<td>' + item.gst_number + '</td>'

							+ '<td>' + item.emp_name + '</td>'

							+ '<td>' + item.village_name + '</td>'

							+ '<td>&ndash;</td>'

							+ '<td>&ndash;</td>'

							+ '<td>&ndash;</td>'

							+ '<td>' + money_format_india((item.weight != undefined ? item.weight : '')) + '</td>'

							+ '<td>&ndash;</td>'

							+ '<td>&ndash;</td>'

							+ '<td>&ndash;</td>'

							+ '<td>&ndash;</td>'

							+ '<td>&ndash;</td>'

							+ '<td>&ndash;</td>'

							+ '<td>&ndash;</td>'

							+ '<td>&ndash;</td>'

							+ '<td>&ndash;</td>'

							+ '<td>&ndash;</td>'

							+ '<td>&ndash;</td>'

							+ '<td>&ndash;</td>'

							+ '<td>&ndash;</td>'

							+ '<td>&ndash;</td>'

							+ '<td>&ndash;</td>'

							+ '<td>&ndash;</td>'

							+ '<td>&ndash;</td>'

							+ '<td>&ndash;</td>'

							+ '<td>&ndash;</td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td>&ndash;</td>'

							+ '<td></td>'

							+ '<td>' + money_format_india(item.amount) + '</td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td>&ndash;</td>'

							+ '<td>&ndash;</td>'

						'</tr>';

						total_net_amount -= parseFloat(item.amount);

						receipt_total_net_amount -= parseFloat(item.amount);

						$.each(item.pay_details, function (idx, item) {

							if (item.payment_mode == 'Cash') {

								receipt_cash_amt += parseFloat(item.payment_amount);

								receipt_total_cash_amt += parseFloat(item.payment_amount);

							}

							if (item.payment_mode == 'CC' || item.payment_mode == 'DC') {

								receipt_card_amt += parseFloat(item.payment_amount);

								receipt_total_card_amt += parseFloat(item.payment_amount);

							}

							if (item.payment_mode == 'CHQ') {

								receipt_chq_amt += parseFloat(item.payment_amount);

								receipt_total_chq_amt += parseFloat(item.payment_amount);

							}

							if (item.payment_mode == 'NB') {

								receipt_net_banking_amt += parseFloat(item.payment_amount);

								receipt_total_net_banking_amt += parseFloat(item.payment_amount);

							}

						});

						var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + item.bill_id;

						trHTML += '<tr>'

							+ '<td></td>'

							+ '<td>' + '<a href=' + url + ' target="_blank">' + item.bill_no + '</td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td>Advance</td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td>&ndash;</td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							//+ '<td>' + money_format_india(item.gross_wt) + '</td>'

							//+ '<td>' + money_format_india(item.amount) + '</td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

						'</tr>';

						trHTML += '<tr style="font-weight:bold;color:red">' +

							+'<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td>Total</td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td>&ndash;</td>'

							+ '<td>&ndash;</td>'

							+ '<td>&ndash;</td>'

							+ '<td>&ndash;</td>'

							+ '<td style="width:2px;">' + money_format_india(total_net_amount) + '</td>'

							+ '<td>' + money_format_india(parseFloat(receipt_cash_amt).toFixed(2)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(receipt_card_amt).toFixed(2)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(receipt_chq_amt).toFixed(2)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(receipt_net_banking_amt).toFixed(2)) + '</td>'

							+ '<td>&ndash;</td>'

							+ '<td>&ndash;</td>'

							+ '<td>&ndash;</td>'

							+ '<td>&ndash;</td>'

							+ '<td></td>'

							+ '<td></td>'

						'</tr>';

					});

					trHTML += '<tr style="font-weight:bold;color:blue">' +

						+'<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td>GrandTotal</td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td>&ndash;</td>'

						+ '<td>&ndash;</td>'

						+ '<td></td>'

						+ '<td>&ndash;</td>'

						+ '<td>' + money_format_india(parseFloat(receipt_total_net_amount).toFixed(2)) + '</td>'

						// + '<td style="width:2px;">' + money_format_india(parseFloat((tot_net_amt) - parseFloat(tot_ret_amt) - parseFloat(tot_due_amt) + parseFloat(advance_paid_amt) + parseFloat(handling_charges)).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(receipt_total_cash_amt).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(receipt_total_card_amt).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(receipt_total_chq_amt).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(receipt_total_net_banking_amt).toFixed(2)) + '</td>'

						+ '<td>&ndash;</td>'

						+ '<td>&ndash;</td>'

						+ '<td>&ndash;</td>'

						+ '<td>&ndash;</td>'

						// + '<td style="width:2px;">' + money_format_india(parseFloat(parseFloat(total_cash_amt) + parseFloat(total_card_amt) + parseFloat(total_chq_amt) + parseFloat(total_net_banking_amt) + parseFloat(total_adv_adj) + parseFloat(total_chit_adj_amt) + parseFloat(tot_gift_adj) + parseFloat(tot_gift_adj)).toFixed(2)) + '</td>'

						+ '<td></td>'

						+ '<td></td>'

					'</tr>';

				}

				$('#bill_list > tbody').html(trHTML);

				// Check and initialise datatable

				if (!$.fn.DataTable.isDataTable('#bill_list')) {

					oTable = $('#bill_list').dataTable({

						"bSort": false,

						"bInfo": true,

						"scrollX": '100%',

						"dom": 'lBfrtip',

						"paging": false,

						"fixedHeader": true,

						"columnDefs": [

							{

								targets: [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28,

									29, 30, 31, 32, 33, 34, 35, 36],

								className: 'dt-body-right'

							},

							{

								targets: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13],

								className: 'dt-body-left'

							},

						],

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: '',

								messageTop: title,

								exportOptions: {

									columns: ':visible',

									stripHtml: false

								},

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', '12px')

										.css('font-family', 'sans-serif');

								},

							},

							'colvis',

							{

								extend: 'excel',

								footer: true,

								title: 'Bill Wise Transcation List',

							}

						],

					});

				}

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function get_bill_wise_trns_list_28_08_2023() {

	$("div.overlay").css("display", "block");

	var dt_range = ($("#dt_range").val()).split('-');

	var company_name = $('#company_name').val();

	var from_date = dt_range[0];

	var to_date = dt_range[1];

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select 			option:selected").text());

	var report_name = "BILL WISE DETAILED REPORT ";

	var village = $('#select_village option:selected').html() != undefined ? ($('#select_village option:selected').html() + " - ") : '';

	var floor = $('#floor_sel option:selected').html() != undefined ? ($('#floor_sel option:selected').html() + " - ") : '';

	var counter = $('#counter_sel option:selected').html() != undefined ? $('#counter_sel option:selected').html() + " - " : '';

	var optional = village + floor + counter;

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/bill_wise_transcation/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'dt_range': $("#dt_range").val(), 'id_product': $('#prod_select').val(), 'id_design': $("#des_select").val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'id_weight': $('#wt_select').val(), 'id_village': $('#select_village').val(), 'id_counter': $('#counter_sel').val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			$("#bill_list > tbody > tr").remove();

			$('#bill_list').dataTable().fnClearTable();

			$('#bill_list').dataTable().fnDestroy();

			if (list != null) {

				trHTML = '';

				tfootHTML = '';

				var tot_ret_amt = 0;

				var tot_net_amt = 0;

				var total_cash_amt = 0;

				var total_card_amt = 0;

				var total_net_banking_amt = 0;

				var total_chq_amt = 0;

				var total_adv_adj_amt = 0;

				var total_chit_adj_amt = 0;

				var total_adv_adj = 0;

				var tot_due_amt = 0;

				var tot_due_amt = 0;

				var tot_gift_adj = 0;

				var advance_paid_amt = 0;

				var handling_charges = 0;

				$.each(list, function (i, bill) {

					total_adv_adj += parseFloat(bill.order_adj_amt + bill.adv_adj_amt); // Order adj + general adj

					tot_ret_amt += parseFloat(bill.tot_ret_amt);  //tot sales return

					handling_charges += parseFloat(bill.handling_charges);

					if (bill.is_credit == 1) {

						tot_due_amt += parseFloat(bill.due_amt);

					}

					//total_chit_adj_amt+=parseFloat(bill.bill_wise_details.utilized_amt);

					//tot_gift_adj+=parseFloat(bill.bill_wise_details.gift_voucher_amt);

					var taxable_amt = 0;

					var tot_taxable_amt = 0;

					total_bill_amount = 0;

					total_bill_tax_value = 0;

					total_advance_amt = 0;

					cash_amt = 0;

					card_amt = 0;

					chq_amt = 0;

					tot_sales_ret = 0;

					net_banking_amt = 0;

					$.each(bill.sale_details, function (idx, item) {

						taxable_amt = parseFloat(item.item_cost - item.item_total_tax);

						tot_taxable_amt += parseFloat(item.item_cost - item.item_total_tax);

						advance_paid_amt += parseFloat(item.advance_amt != undefined ? item.advance_amt : 0)

						var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + item.bill_id;

						trHTML += '<tr>' +

							'<td>' + '<a href=' + url + ' target="_blank">' + item.bill_no + '</td>'

							+ '<td>' + bill.bill_date + '</td>'

							+ '<td>' + item.bill_type + '</td>'

							+ '<td>' + bill.customer_name + '</td>'

							+ '<td>' + item.address1 + '</td>'

							+ '<td>' + bill.mobile + '</td>'

							+ '<td>' + item.pan + '</td>'

							+ '<td>' + item.gst_number + '</td>'

							+ '<td>' + item.emp_name + '</td>'

							+ '<td>' + bill.village_name + '</td>'

							+ '<td>' + item.product_name + '</td>'

							+ '<td>' + item.section_name + '</td>'

							+ '<td>' + item.counter_name + '</td>'

							+ '<td>' + money_format_india((item.gross_wt != undefined ? item.gross_wt : '')) + '</td>'

							+ '<td>' + money_format_india((item.less_wt != undefined ? item.less_wt : '')) + '</td>'

							+ '<td>' + money_format_india((item.dia_wt != undefined ? item.dia_wt : '')) + '</td>'

							+ '<td>' + money_format_india((item.stone_wt != undefined ? item.stone_wt : '')) + '</td>'

							+ '<td>' + item.mc_type + '</td>'

							+ '<td>' + money_format_india((item.mc_value != undefined ? item.mc_value : '')) + '</td>'

							+ '<td>' + money_format_india((item.wastage_percent != undefined ? item.wastage_percent : '')) + '</td>'

							+ '<td>' + money_format_india((item.rate != undefined ? item.rate : '')) + '</td>'

							+ '<td>' + money_format_india((item.stone_amount != undefined ? item.stone_amount : '')) + '</td>'

							+ '<td>' + money_format_india((item.dia_amount != undefined ? item.dia_amount : '')) + '</td>'

							+ '<td>' + money_format_india((item.net_wt != undefined ? item.net_wt : '')) + '</td>'

							+ '<td>' + (item.bill_type == 5 ? 'Order Advance' + '-' + item.order_no : item.tag_id) + '</td>'

							+ '<td>' + (item.piece != undefined ? item.piece : '') + '</td>'

							+ '<td>' + money_format_india((item.net_wt != undefined ? item.net_wt : '')) + '</td>'

							+ '<td>' + money_format_india((item.bill_discount != undefined ? item.bill_discount : '')) + '</td>'

							+ '<td>' + money_format_india(parseFloat((taxable_amt != undefined ? taxable_amt : 0)).toFixed(2)) + '</td>'

							+ '<td>' + money_format_india(parseFloat((item.total_cgst != undefined ? item.total_cgst : 0)).toFixed(2)) + '</td>'

							+ '<td>' + money_format_india(parseFloat((item.total_sgst != undefined ? item.total_sgst : 0)).toFixed(2)) + '</td>'

							+ '<td>' + money_format_india(parseFloat((item.total_igst != undefined ? item.total_igst : 0)).toFixed(2)) + '</td>'

							+ '<td><strong>' + money_format_india(parseFloat((item.item_cost != undefined ? item.item_cost : 0)).toFixed(2)) + '</strong></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td>' + money_format_india(parseFloat(item.advance_amt != undefined ? item.advance_amt : 0).toFixed(2)) + '</td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td>' + item.remark + '</td>'

							+ '<td>' + item.bill_status + '</td>'

						'</tr>';

						total_bill_amount += parseFloat((item.bill_type == 5 ? item.tot_bill_amount : item.item_cost));

						tot_net_amt += parseFloat((item.bill_type == 5 ? item.tot_bill_amount : item.item_cost));

					});

					$.each(bill.old_sales_details, function (idx, item) {

						var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + item.bill_id;

						trHTML += '<tr>' +

							'<td>' + '<a href=' + url + ' target="_blank">' + item.bill_no + '</td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td>Purchase</td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td>' + item.pur_ref_no + '</td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td>' + money_format_india(item.gross_wt) + '</td>'

							+ '<td>' + money_format_india(item.amount) + '</td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

						'</tr>';

						total_bill_amount -= parseFloat(item.amount);

						tot_net_amt -= parseFloat(item.amount);

					});

					$.each(bill.pay_details, function (idx, item) {

						if (item.payment_mode == 'Cash') {

							cash_amt += parseFloat(item.payment_amount);

							total_cash_amt += parseFloat(item.payment_amount);

						}

						if (item.payment_mode == 'CC' || item.payment_mode == 'DC') {

							card_amt += parseFloat(item.payment_amount);

							total_card_amt += parseFloat(item.payment_amount);

						}

						if (item.payment_mode == 'CHQ') {

							chq_amt += parseFloat(item.payment_amount);

							total_chq_amt += parseFloat(item.payment_amount);

						}

						if (item.payment_mode == 'NB') {

							net_banking_amt += parseFloat(item.payment_amount);

							total_net_banking_amt += parseFloat(item.payment_amount);

						}

					});

					var net_amount = parseFloat((total_bill_amount) - parseFloat(bill.tot_ret_amt) + parseFloat(bill.handling_charges) + parseFloat(bill.advance_deposit)).toFixed(2);

					var final_amount = parseFloat(parseFloat(cash_amt) + parseFloat(card_amt) + parseFloat(chq_amt) + parseFloat(net_banking_amt) + parseFloat(bill.order_adj_amt) + parseFloat(bill.adv_adj_amt) + parseFloat(bill.utilized_amt) + parseFloat(bill.gift_voucher_amt)).toFixed(2)

					var amount_difference = parseFloat(net_amount) - parseFloat(final_amount);

					trHTML += '<tr style="font-weight:bold;color:red">' +

						+'<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td>Total</td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td>' + parseFloat(bill.tot_ret_amt).toFixed(3) + '</td>'

						+ '<td>' + parseFloat((bill.is_credit = 1 ? bill.due_amt : 0)).toFixed(2) + '</td>'

						+ '<td>' + parseFloat(bill.advance_deposit) + '</td>'

						+ '<td>' + parseFloat(bill.handling_charges).toFixed(2) + '</td>'

						+ '<td style="width:2px;">' + money_format_india(net_amount) + '</td>'

						+ '<td>' + money_format_india(parseFloat(cash_amt).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(card_amt).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(chq_amt).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(net_banking_amt).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(bill.order_adj_amt + bill.adv_adj_amt).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(bill.utilized_amt).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(bill.gift_voucher_amt).toFixed(2)) + '</td>'

						+ '<td style="width:2px;">' + final_amount + '</td>'

						+ '<td></td>'

						+ '<td></td>'

					'</tr>';

				});

				trHTML += '<tr style="font-weight:bold;color:blue">' +

					+'<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td>GrandTotal</td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td>' + tot_ret_amt + '</td>'

					+ '<td>' + money_format_india(parseFloat(tot_due_amt).toFixed(2)) + '</td>'

					+ '<td></td>'

					+ '<td>' + money_format_india(parseFloat(handling_charges).toFixed(2)) + '</td>'

					+ '<td style="width:2px;">' + money_format_india(parseFloat((tot_net_amt) - parseFloat(tot_ret_amt) - parseFloat(tot_due_amt) + parseFloat(advance_paid_amt) + parseFloat(handling_charges)).toFixed(2)) + '</td>'

					+ '<td>' + money_format_india(parseFloat(total_cash_amt).toFixed(2)) + '</td>'

					+ '<td>' + money_format_india(parseFloat(total_card_amt).toFixed(2)) + '</td>'

					+ '<td>' + money_format_india(parseFloat(total_chq_amt).toFixed(2)) + '</td>'

					+ '<td>' + money_format_india(parseFloat(total_net_banking_amt).toFixed(2)) + '</td>'

					+ '<td>' + money_format_india(parseFloat(total_adv_adj).toFixed(2)) + '</td>'

					+ '<td>' + money_format_india(parseFloat(total_chit_adj_amt).toFixed(2)) + '</td>'

					+ '<td>' + money_format_india(parseFloat(tot_gift_adj).toFixed(2)) + '</td>'

					+ '<td style="width:2px;">' + money_format_india(parseFloat(parseFloat(total_cash_amt) + parseFloat(total_card_amt) + parseFloat(total_chq_amt) + parseFloat(total_net_banking_amt) + parseFloat(total_adv_adj) + parseFloat(total_chit_adj_amt) + parseFloat(tot_gift_adj) + parseFloat(tot_gift_adj)).toFixed(2)) + '</td>'

					+ '<td></td>'

					+ '<td></td>'

				'</tr>';

				$('#bill_list > tbody').html(trHTML);

				// Check and initialise datatable

				if (!$.fn.DataTable.isDataTable('#bill_list')) {

					oTable = $('#bill_list').dataTable({

						"bSort": false,

						"bInfo": true,

						"scrollX": '100%',

						"dom": 'lBfrtip',

						"paging": false,

						"fixedHeader": true,

						"columnDefs": [

							{

								targets: [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28,

									29, 30, 31, 32, 33, 34, 35, 36],

								className: 'dt-body-right'

							},

							{

								targets: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13],

								className: 'dt-body-left'

							},

						],

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: '',

								messageTop: title,

								exportOptions: {

									columns: ':visible'

								},

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', '12px')

										.css('font-family', 'sans-serif');

								},

							},

							'colvis',

							{

								extend: 'excel',

								footer: true,

								title: 'Bill Wise Transcation List',

							}

						],

					});

				}

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//bill wise transcation

//home bills

function get_home_bill_sales() {

	var dt_range = ($("#dt_range").val()).split('-');

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var company_name = $('#company_name').val();

	var title = "<b><span style='font-size:15pt;margin-left:32%;'>" + company_name + "</span></b><b><span style='font-size:15pt;'></span></b></br>" + "<span style=font-size:13pt;margin-left:20%;>&nbsp;&nbsp;HOME BILL REPORT &nbsp;" + ($("#branch_select").val() != '' ? "Cost Center:" + branch_name + " " : '') + "From&nbsp;:&nbsp;" + dt_range[0] + " &nbsp;&nbsp;- " + dt_range[1] + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/home_bill/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'dt_range': $("#dt_range").val(), 'id_category': $("#category_select").val(), 'id_product': $("#prod_select").val(), 'id_design': $("#des_select").val(), 'id_sub_design': $("#sub_des_select").val(), 'id_metal': $("#metal").val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()) }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.list;

			var oTable = $('#bill_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#bill_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"order": [[0, "desc"]],

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'colvis',

							collectionLayout: 'fixed columns',

							collectionTitle: 'Column visibility control'

						},

						{

							extend: 'excel',

							footer: true,

							title: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						}

					],

					"aaData": list,

					"aoColumns": [

						//{ "mDataProp": "bill_no" },

						{

							"mDataProp": function (row, type, val, meta) {

								var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + row.bill_id;

								return '<a href=' + url + ' target="_blank">' + row.bill_no + '</a>';

							},

						},

						{ "mDataProp": "bill_date" },

						{ "mDataProp": "firstname" },

						{ "mDataProp": "mobile" },

						{ "mDataProp": "category_name" },

						{ "mDataProp": "metal_name" },

						{ "mDataProp": "product_name" },

						{ "mDataProp": "design_name" },

						{ "mDataProp": "sub_design_name" },

						{ "mDataProp": "tag_id" },

						{ "mDataProp": "piece" },

						{ "mDataProp": "gross_wt" },

						{ "mDataProp": "net_wt" },

						{ "mDataProp": "item_total_tax" },

						{ "mDataProp": "item_cost" },

						{ "mDataProp": "st_price" },

					],

					"footerCallback": function (row, data, start, end, display) {

						if (list.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								piece = api

									.column(10)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(10).footer()).html(parseFloat(piece).toFixed(2));

								gross_wt = api

									.column(11)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(11).footer()).html(parseFloat(gross_wt).toFixed(2));

								net_wt = api

									.column(12)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(12).footer()).html(parseFloat(net_wt).toFixed(2));

								item_total_tax = api

									.column(13)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(13).footer()).html(parseFloat(item_total_tax).toFixed(2));

								item_cost = api

									.column(14)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(14).footer()).html(parseFloat(item_cost).toFixed(2));

								stone_amt = api

									.column(15)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(15).footer()).html(parseFloat(stone_amt).toFixed(2));

							}

						} else {

							var api = this.api(), data;

							$(api.column(8).footer()).html('');

							$(api.column(9).footer()).html('');

							$(api.column(10).footer()).html('');

							$(api.column(11).footer()).html('');

							$(api.column(12).footer()).html('');

							$(api.column(13).footer()).html('');

							$(api.column(14).footer()).html('');

							$(api.column(15).footer()).html('');

						}

					}

				});

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//home bills

//order advance details

function set_order_advance() {

	var branch_name = $("#branch_select option:selected").text();

	var company_name = $('#company_name').val();

	var title = "<b><span style='font-size:15pt;margin-left:50%;'>" + company_name + "</span></b><b><span style='font-size:15pt;'></span></b></br>" + "<span style=font-size:13pt;margin-left:25%;>&nbsp;&nbsp;Order Advance Details " + ($("#branch_select").val() != '' ? "Cost Center:" + branch_name + " " : '') + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/order_advance/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'id_branch': $("#branch_select").val(), 'dt_range': $("#dt_range").val(), 'filter_by': $("#filterby").val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.list;

			var oTable = $('#adv_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#adv_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"order": [[0, "desc"]],

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: title,

						}

					],

					"aaData": list,

					"aoColumns": [{ "mDataProp": "branch_name" },

					{

						"mDataProp": function (row, type, val, meta) {

							var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + row.bill_id;

							return '<a href=' + url + ' target="_blank">' + row.bill_no;

						}

					},

					{ "mDataProp": "bill_date" },

					{ "mDataProp": "cus_name" },

					{ "mDataProp": "mobile" },

					{ "mDataProp": "order_no" },

					{ "mDataProp": "advance_amount" },

					{ "mDataProp": "advance_weight" },

					{ "mDataProp": "rate_per_gram" },

					{ "mDataProp": "bill_status" },

					],

					"footerCallback": function (row, data, start, end, display) {

						var api = this.api();

						if (list.length > 0) {

							var advance_amount = api

								.column(6)

								.data()

								.reduce(function (a, b) {

									return parseFloat(a) + parseFloat(b);

								}, 0);

							var advance_weight = api

								.column(7)

								.data()

								.reduce(function (a, b) {

									return parseFloat(a) + parseFloat(b);

								}, 0);

							var rate = api

								.column(8)

								.data()

								.reduce(function (a, b) {

									return parseFloat(a) + parseFloat(b);

								}, 0);

							$(api.column(0).footer()).html('Grand Total');

							$(api.column(6).footer()).html(parseFloat(advance_amount).toFixed(2));

							$(api.column(7).footer()).html(parseFloat(advance_weight).toFixed(2));

							$(api.column(8).footer()).html(parseFloat(rate).toFixed(2));

						} else {

							$(api.column(0).footer()).html('Grand Total');

							$(api.column(6).footer()).html('');

							$(api.column(7).footer()).html('');

							$(api.column(8).footer()).html('');

						}

					}

				});

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//order advance details

//Estimation referral

function set_estimation_referral() {

	var dt_range = ($("#dt_range").val()).split('-');

	var company_name = $('#company_name').val();

	var from_date = dt_range[0];

	var to_date = dt_range[1];

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "SALES REFERRALS"

	var metal = $('#metal option:selected').html() != '' && $('#metal option:selected ').html() != undefined ? $('#metal option:selected').html() + " - " : '';

	var category = $('#category option:selected').html() != '' && $('#category option:selected ').html() != undefined ? $('#category option:selected').html() + " - " : '';

	var prod_select = $('#prod_select').text() != '' && $('#prod_select').text() != undefined ? $('#prod_select option:selected').text().split('-') + " - " : '';

	var optional = metal + category + prod_select;

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/est_referral/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'dt_range': $("#dt_range").val(), 'id_metal': $('#metal').val(), 'id_design': $('#des_select').val(), 'id_sub_design': $('#sub_des_select').val(), 'id_employee': $('#emp_select').val(), 'id_ret_category': $('#category').val(), 'id_product': $('#prod_select').val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			var type = $('#id_report_type').val();

			if (type == 2) {

				var oTable = $('#ref_list_sum').DataTable();

				oTable.clear().draw();

				if (list != null && list.length > 0) {

					oTable = $('#ref_list_sum').dataTable({

						"bDestroy": true,

						"bInfo": true,

						"bFilter": true,

						"order": [[0, "desc"]],

						"scrollX": '100%',

						"bSort": true,

						"dom": 'lBfrtip',

						"columnDefs": [

							{

								targets: [3, 4, 5, 6, 7, 8, 9],

								className: 'dt-right'

							},

							{

								targets: [0, 1, 2],

								className: 'dt-left'

							},

						],

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: '',

								messageTop: title,

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', '10px');

								},

							},

							{

								extend: 'excel',

								footer: true,

								title: 'Employee Sales Referrals',

							}

						],

						"lengthMenu": [[-1, 25, 50, 100, 250], ["All", 25, 50, 100, 250]],

						"aaData": list,

						"aoColumns": [

							{ "mDataProp": "branch_name" },

							{ "mDataProp": "emp_name" },

							{ "mDataProp": "emp_code" },

							{ "mDataProp": "tot_est" },

							{ "mDataProp": "piece" },

							{ "mDataProp": "gross_wt" },

							{ "mDataProp": "less_wt" },

							{ "mDataProp": "net_wt" },

							{ "mDataProp": "dia_wt" },

							{

								"mDataProp": function (row, type, val, meta) {

									var tot_bill_amount = (row.tot_bill_amount)

									return money_format_india(tot_bill_amount);

								},

							},

						],

						"footerCallback": function (row, data, start, end, display) {

							if (list.length > 0) {

								var api = this.api(), data;

								for (var i = 0; i <= data.length - 1; i++) {

									var intVal = function (i) {

										return typeof i === 'string' ?

											i.replace(/[\$,]/g, '') * 1 :

											typeof i === 'number' ?

												i : 0;

									};

									$(api.column(0).footer()).html('Grand Total');

									sales = api

										.column(3)

										.data()

										.reduce(function (a, b) {

											return intVal(a) + intVal(b);

										}, 0);

									$(api.column(3).footer()).html(parseFloat(sales).toFixed(2));

									piece = api

										.column(4)

										.data()

										.reduce(function (a, b) {

											return intVal(a) + intVal(b);

										}, 0);

									$(api.column(4).footer()).html(parseFloat(piece).toFixed(2));

									gross_wt = api

										.column(5)

										.data()

										.reduce(function (a, b) {

											return intVal(a) + intVal(b);

										}, 0);

									$(api.column(5).footer()).html(parseFloat(gross_wt).toFixed(2));

									less_wt = api

										.column(6)

										.data()

										.reduce(function (a, b) {

											return intVal(a) + intVal(b);

										}, 0);

									$(api.column(6).footer()).html(parseFloat(less_wt).toFixed(2));

									net_wt = api

										.column(7)

										.data()

										.reduce(function (a, b) {

											return intVal(a) + intVal(b);

										}, 0);

									$(api.column(7).footer()).html(parseFloat(net_wt).toFixed(2));

									dia_wt = api

										.column(8)

										.data()

										.reduce(function (a, b) {

											return intVal(a) + intVal(b);

										}, 0);

									$(api.column(8).footer()).html(parseFloat(dia_wt).toFixed(2));

									amount = api

										.column(9)

										.data()

										.reduce(function (a, b) {

											return intVal(a) + intVal(b);

										}, 0);

									$(api.column(9).footer()).html(parseFloat(amount).toFixed(2));

								}

							} else {

								var api = this.api(), data;

								$(api.column(3).footer()).html('');

								$(api.column(4).footer()).html('');

								$(api.column(5).footer()).html('');

								$(api.column(6).footer()).html('');

								$(api.column(7).footer()).html('');

								$(api.column(8).footer()).html('');

								$(api.column(9).footer()).html('');

							}

						}

					});

				}

			} else {

				var trHtml = '';

				var total_pcs = 0;

				var total_gwt = 0;

				var total_net = 0;

				var total_less = 0;

				var total_dwt = 0;

				var total_amount = 0;

				$("#ref_list_det > tbody > tr").remove();

				$('#ref_list_det').dataTable().fnClearTable();

				$('#ref_list_det').dataTable().fnDestroy();

				let tot_stock_wast_per = 0;

				let tot_stock_wast_wt = 0;

				let tot_stock_wast_mc = 0;

				let tot_sale_wast_per = 0;

				let tot_sale_wast_wt = 0;

				let tot_sale_wast_mc = 0;

				let tot_diff_wast_per = 0;

				let tot_diff_wast_wt = 0;

				let tot_diff_wast_mc = 0;

				$.each(list, function (i, emp) {

					trHtml += '<tr>' +

						'<td><strong>' + emp.emp_name + '-' + emp.emp_code + '</strong></td>' +

						// '<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'</tr>';

					let stock_wast_per = 0;

					let stock_wast_wt = 0;

					let stock_wast_mc = 0;

					let sale_wast_per = 0;

					let sale_wast_wt = 0;

					let sale_wast_mc = 0;

					let diff_wast_per = 0;

					let diff_wast_wt = 0;

					let diff_wast_mc = 0;

					$.each(emp.bill_details, function (idx, val) {

						var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + val.bill_id;

						trHtml += '<tr>' +

							'<td>' + parseFloat(idx + 1) + '</td>' +

							// '<td>' + '<a href=' + url + ' target="_blank">' + val.bill_no + '</td>' +

							'<td>' + val.tag_code + '</td>' +

							'<td>' + val.product_name + '</td>' +

							'<td>' + val.design_name + '</td>' +

							'<td>' + val.sub_design_name + '</td>' +

							'<td>' + val.piece + '</td>' +

							'<td>' + val.gross_wt + '</td>' +

							'<td>' + val.less_wt + '</td>' +

							'<td>' + val.net_wt + '</td>' +

							'<td>' + val.dia_wt + '</td>' +

							'<td>' + val.wastage_percent + '</td>' +

							'<td>' + val.watsge_wt + '</td>' +

							'<td>' + val.sales_mc_value + '</td>' +

							'<td>' + val.bill_wastage + '</td>' +

							'<td>' + val.bill_wast_wt + '</td>' +

							'<td>' + val.bill_mc + '</td>' +

							'<td>' + parseFloat(val.bill_wastage - val.wastage_percent).toFixed(2) + '</td>' +

							'<td>' + parseFloat(val.bill_wast_wt - val.watsge_wt).toFixed(3) + '</td>' +

							'<td>' + parseFloat(val.bill_mc - val.sales_mc_value).toFixed(2) + '</td>' +

							'<td>' + money_format_india(val.item_cost) + '</td>' +

							'</tr>';

						stock_wast_per += parseFloat(val.wastage_percent);

						stock_wast_wt += parseFloat(val.watsge_wt);

						stock_wast_mc += parseFloat(val.sales_mc_value);

						sale_wast_per += parseFloat(val.bill_wastage);

						sale_wast_wt += parseFloat(val.bill_wast_wt);

						sale_wast_mc += parseFloat(val.bill_mc);

						diff_wast_per += parseFloat((val.bill_wastage - val.wastage_percent));

						diff_wast_wt += parseFloat((val.bill_wast_wt - val.watsge_wt));

						diff_wast_mc += parseFloat((val.bill_mc - val.sales_mc_value));

					});

					trHtml += '<tr style="color:blue" >' +

						'<td><strong> SUB TOTAL </strong></td>' +

						// '<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td>' + emp.piece + '</td>' +

						'<td>' + emp.gross_wt + '</td>' +

						'<td>' + emp.less_wt + '</td>' +

						'<td>' + emp.net_wt + '</td>' +

						'<td>' + emp.dia_wt + '</td>' +

						'<td>' + parseFloat((stock_wast_per) / emp.bill_details.length).toFixed(2) + '</td>' +

						'<td>' + parseFloat(stock_wast_wt).toFixed(3) + '</td>' +

						'<td>' + parseFloat(stock_wast_mc).toFixed(2) + '</td>' +

						'<td>' + parseFloat((sale_wast_per) / emp.bill_details.length).toFixed(2) + '</td>' +

						'<td>' + parseFloat(sale_wast_wt).toFixed(3) + '</td>' +

						'<td>' + parseFloat(sale_wast_mc).toFixed(2) + '</td>' +

						'<td>' + parseFloat((diff_wast_per) / emp.bill_details.length).toFixed(2) + '</td>' +

						'<td>' + parseFloat(diff_wast_wt).toFixed(3) + '</td>' +

						'<td>' + parseFloat(diff_wast_mc).toFixed(2) + '</td>' +

						'<td>' + money_format_india(emp.tot_bill_amount) + '</td>' +

						'</tr>';

					total_pcs += parseFloat(emp.piece);

					total_gwt += parseFloat(emp.gross_wt);

					total_net += parseFloat(emp.net_wt);

					total_less += parseFloat(emp.less_wt);

					total_dwt += parseFloat(emp.dia_wt);

					total_amount += parseFloat(emp.tot_bill_amount);

					tot_stock_wast_per += parseFloat(stock_wast_per) / emp.bill_details.length;

					tot_stock_wast_wt += parseFloat(stock_wast_wt);

					tot_stock_wast_mc += parseFloat(stock_wast_mc);

					tot_sale_wast_per += parseFloat(sale_wast_per) / emp.bill_details.length;

					tot_sale_wast_wt += parseFloat(sale_wast_wt);

					tot_sale_wast_mc += parseFloat(sale_wast_mc);

					tot_diff_wast_per += parseFloat(diff_wast_per) / emp.bill_details.length;

					tot_diff_wast_wt += parseFloat(diff_wast_wt);

					tot_diff_wast_mc += parseFloat(diff_wast_mc);

				});

				trHtml += '<tr style="color:red">' +

					'<td style="text-align:left;"><strong>GRAND TOTAL</strong></td>' +

					// '<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td>' + parseInt(total_pcs) + '</td>' +

					'<td>' + parseFloat(total_gwt).toFixed(3) + '</td>' +

					'<td>' + parseFloat(total_less).toFixed(3) + '</td>' +

					'<td>' + parseFloat(total_net).toFixed(3) + '</td>' +

					'<td>' + parseFloat(total_dwt).toFixed(3) + '</td>' +

					'<td>' + parseFloat(tot_stock_wast_per / list.length).toFixed(3) + '</td>' +

					'<td>' + parseFloat(tot_stock_wast_wt).toFixed(3) + '</td>' +

					'<td>' + parseFloat(tot_stock_wast_mc).toFixed(3) + '</td>' +

					'<td>' + parseFloat(tot_sale_wast_per / list.length).toFixed(3) + '</td>' +

					'<td>' + parseFloat(tot_sale_wast_wt).toFixed(3) + '</td>' +

					'<td>' + parseFloat(tot_sale_wast_mc).toFixed(3) + '</td>' +

					'<td>' + parseFloat(tot_diff_wast_per / list.length).toFixed(3) + '</td>' +

					'<td>' + parseFloat(tot_diff_wast_wt).toFixed(3) + '</td>' +

					'<td>' + parseFloat(tot_diff_wast_mc).toFixed(3) + '</td>' +

					'<td>' + money_format_india(parseFloat(total_amount).toFixed(3)) + '</td>' +

					'</tr>';

				$('#ref_list_det > tbody').html(trHtml);

				if (!$.fn.DataTable.isDataTable('#other_issue_list')) {

					Table = $('#ref_list_det').dataTable({

						"bSort": false,

						"bInfo": true,

						"scrollX": '100%',

						"dom": 'lBfrtip',

						"paging": false,

						"columnDefs": [

							{

								targets: [6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19],

								className: 'dt-right'

							},

							{

								targets: [0, 1, 2, 3, 4, 5],

								className: 'dt-left'

							},

						],

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: '',

								messageTop: title,

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', '10px');

								},

							},

							{

								extend: 'excel',

								footer: true,

								title: 'Employee Sales Referrals',

							}

						],

					});

				}

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

$('#id_report_type').on('change', function () {

	$('.ref_list_sum').css("display", "none");

	$('.ref_list_det').css("display", "none");

	if (this.value == 2) {

		$('.ref_list_sum').css("display", "block");

	} else {

		$('.ref_list_det').css("display", "block");

	}

});

//Estimation referral

// Other Issue

function set_other_issue() {

	var dt_range = ($("#dt_range").val()).split('-');

	var company_name = $('#company_name').val();

	var from_date = dt_range[0];

	var to_date = dt_range[1];

	var report_type = $('#issue_report_type').val();

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "Other Issue Report "

	var optional = $('#prod_select option:selected').html() != '' && $('#prod_select option:selected').html() != undefined ? $('#prod_select option:selected').html() + " - " : '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/other_issue/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'dt_range': $("#dt_range").val(), 'id_product': $('#prod_select').val(), 'id_design': $("#des_select").val(), 'group_by': $("#issue_group_by").val(), 'id_sub_design': $("#sub_des_select").val(), 'id_karigar': $("#karigar").val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'stock_type': $('#stock_type').val(), 'id_metal': $('#metal').val(), 'report_type': $('#issue_report_type').val(), 'tag_id': $("#tag_number").val(), 'id_section': $('#section_select').val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			if (list != null) {

				if (report_type == 1) {

					$("#other_issue_list > tbody > tr").remove();

					$('#other_issue_list').dataTable().fnClearTable();

					$('#other_issue_list').dataTable().fnDestroy();

					var trHTML = '';

					var pieces = 0;

					var gross_wt = 0;

					var net_wt = 0;

					var dia_wt = 0;

					$.each(list, function (i, item) {

						trHTML += '<tr>'

							+ '<td>' + item.section + '</td>'

							+ '<td>' + item.product + '</td>'

							+ '<td>' + item.design + '</td>'

							+ '<td>' + item.sub_design + '</td>'

							+ '<td>' + item.karigar_name + '</td>'

							+ '<td>' + item.tag_id + '</td>'

							+ '<td>' + item.piece + '</td>'

							+ '<td>' + money_format_india(item.gross_wt) + '</td>'

							+ '<td>' + money_format_india(item.net_wt) + '</td>'

							+ '<td>' + money_format_india(item.dia_wt) + '</td>'

							+ '<td>' + item.emp_name + '</td>'

							+ '<td>' + item.from_branch + '</td>'

							+ '<td>' + item.to_branch + '</td>'

							+ '<td>' + item.remark + '</td>'

							+ '</tr>';

						pieces += parseFloat(item.piece);

						gross_wt += parseFloat(item.gross_wt);

						net_wt += parseFloat(item.net_wt);

						dia_wt += isNaN(parseFloat(item.dia_wt)) ? 0 : parseFloat(item.dia_wt);

					});

					trHTML += '<tr style="font-weight:bold;color:red">'

						+ '<td>TOTAL</td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td>' + money_format_india(parseFloat(pieces).toFixed(0)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(gross_wt).toFixed(3)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(net_wt).toFixed(3)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(dia_wt).toFixed(3)) + '</td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '</tr>';

					$('#other_issue_list > tbody').html(trHTML);

					// Check and initialise datatable

					if (!$.fn.DataTable.isDataTable('#other_issue_list')) {

						oTable = $('#other_issue_list').dataTable({

							"bSort": false,

							"bInfo": true,

							"scrollX": '100%',

							"dom": 'lBfrtip',

							"paging": false,

							"columnDefs": [

								{

									targets: [6, 7, 8, 9],

									className: 'dt-body-right'

								},

								{

									targets: [0, 1, 2, 3, 4, 5, 10, 11, 12],

									className: 'dt-body-left'

								},

							],

							"buttons": [

								{

									extend: 'print',

									footer: true,

									title: '',

									messageTop: title,

									customize: function (win) {

										$(win.document.body).find('table')

											.addClass('compact')

											.css('font-size', '10px');

									},

								},

								{

									extend: 'colvis',

									collectionLayout: 'fixed columns',

									collectionTitle: 'Column visibility control'

								},

								{

									extend: 'excel',

									footer: true,

									title: 'Other Issue Report',

								}

							],

						});

					}

				}

				else {

					$("#other_issue_summary_list > tbody > tr").remove();

					$('#other_issue_summary_list').dataTable().fnClearTable();

					$('#other_issue_summary_list').dataTable().fnDestroy();

					var trHTML = '';

					var pieces = 0;

					var gross_wt = 0;

					var net_wt = 0;

					var dia_wt = 0;

					$.each(list, function (i, item) {

						trHTML += '<tr>'

							+ '<td>' + ($('#issue_group_by').val() == 1 ? item.metal_name : item.section) + '</td>'

							+ '<td>' + item.karigar_name + '</td>'

							+ '<td>' + item.piece + '</td>'

							+ '<td>' + money_format_india(item.gross_wt) + '</td>'

							+ '<td>' + money_format_india(item.net_wt) + '</td>'

							+ '<td>' + money_format_india(item.dia_wt) + '</td>'

							+ '<td>' + item.from_branch + '</td>'

							+ '<td>' + item.to_branch + '</td>'

							+ '<td>' + item.remark + '</td>'

							+ '</tr>';

						pieces += parseFloat(item.piece);

						gross_wt += parseFloat(item.gross_wt);

						net_wt += parseFloat(item.net_wt);

						dia_wt += isNaN(parseFloat(item.dia_wt)) ? 0 : parseFloat(item.dia_wt);

					});

					trHTML += '<tr style="font-weight:bold;color:red">'

						+ '<td>TOTAL</td>'

						+ '<td></td>'

						+ '<td>' + money_format_india(parseFloat(pieces).toFixed(0)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(gross_wt).toFixed(3)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(net_wt).toFixed(3)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(dia_wt).toFixed(3)) + '</td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '</tr>';

					$('#other_issue_summary_list > tbody').html(trHTML);

					// Check and initialise datatable

					if (!$.fn.DataTable.isDataTable('#other_issue_summary_list')) {

						oTable = $('#other_issue_summary_list').dataTable({

							"bSort": false,

							"bInfo": true,

							"scrollX": '100%',

							"dom": 'lBfrtip',

							"paging": false,

							"columnDefs": [

								{

									targets: [3, 4, 5, 6],

									className: 'dt-body-right'

								},

							],

							"buttons": [

								{

									extend: 'print',

									footer: true,

									title: '',

									messageTop: title,

									customize: function (win) {

										$(win.document.body).find('table')

											.addClass('compact')

											.css('font-size', '10px');

									},

								},

								{

									extend: 'excel',

									footer: true,

									title: 'Other Issue Report',

								}

							],

						});

					}

				}

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

// Other Issue

function get_branchname_list() {

	//$(".overlay").css('display','block');

	$('#branch_scan_filter option').remove();

	$('#branch_select option').remove();

	$.ajax({

		type: 'GET',

		url: base_url + 'index.php/branch/branchname_list',

		dataType: 'json',

		async : false,

		success: function (data) {

			var id_branch = $('#id_branch').val();

			$.each(data.branch, function (key, item) {

				$("#branch_scan_filter,#branch_select").append(

					$("<option></option>")

						.attr("value", item.id_branch)

						.text(item.name)

				);

			});

			$("#branch_scan_filter,#branch_select").select2({

				placeholder: "Select Branch",

				allowClear: true

			});

			$("#branch_select").select2("val", (id_branch != '' && id_branch > 0 ? id_branch : ''));

			if ($("#branch_scan_filter").length) {

				$("#branch_scan_filter").select2("val", (id_branch != '' && id_branch > 0 ? id_branch : ''));

			}

			$(".overlay").css("display", "none");

		}

	});

}

function set_gift_voucher_list() {

	var dt_range = ($("#dt_range").val()).split('-');

	var company_name = $('#company_name').val();

	var from_date = dt_range[0];

	var to_date = dt_range[1];

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "Gift Voucher Report";

	var optional = $('#report_type option:selected').html() != '' ? $('#report_type option:selected').html() + ' - ' : '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/gift_voucher/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'dt_range': $("#dt_range").val(), 'report_type': $('#report_type').val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			if ($('#report_type').val() == 1) {

				$('#issued').css('display', 'block');

				$('#received').css('display', 'none');

				var oTable = $('#gift_issued').DataTable();

				oTable.clear().draw();

				if (list != null && list.length > 0) {

					oTable = $('#gift_issued').dataTable({

						"bDestroy": true,

						"bInfo": true,

						"bFilter": true,

						"scrollX": '100%',

						"bSort": false,

						"dom": 'lBfrtip',

						"order": [[0, "desc"]],

						"columnDefs": [

							{

								targets: [5],

								className: 'dt-body-right'

							},

						],

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: '',

								messageTop: title,

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', '10px');

								},

							},

							{

								extend: 'colvis',

								collectionLayout: 'fixed columns',

								collectionTitle: 'Column visibility control'

							},

							{

								extend: 'excel',

								footer: true,

								title: "Gift Voucher Report",

							}

						],

						"aaData": list,

						"aoColumns": [

							{

								"mDataProp": function (row, type, val, meta) {

									if (row.status == 0) {

										return '<input type="checkbox" class="id_gift_card" name="id_gift_card[]" value="' + row.id_gift_card + '"/>' + row.id_gift_card;

									} else {

										return row.id_gift_card;

									}

								}

							},

							{ "mDataProp": "code" },

							{ "mDataProp": "branch_name" },

							{ "mDataProp": "date" },

							{ "mDataProp": "owned_by" },

							{

								"mDataProp": function (row, type, val, meta) {

									var amount = row.amount;

									return money_format_india(amount);

								}

							},

							{ "mDataProp": "gift_status" },

						],

					});

				}

			}

			else {

				$('#issued').css('display', 'none');

				$('#received').css('display', 'block');

				var oTable = $('#gift_reeived').DataTable();

				oTable.clear().draw();

				if (list != null && list.length > 0) {

					oTable = $('#gift_reeived').dataTable({

						"bDestroy": true,

						"bInfo": true,

						"bFilter": true,

						"order": [[0, "desc"]],

						"scrollX": '100%',

						"bSort": true,

						"dom": 'lBfrtip',

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: "Stock Checking Tag Scan Report" + ($("#branch_select").val() != '' ? '- ' + $("#branch_select option:selected").text() : ''),

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', 'inherit');

								},

							},

							{

								extend: 'excel',

								footer: true,

								title: "Stock Checking Tag Scan Report" + ($("#branch_select").val() != '' ? '- ' + $("#branch_select option:selected").text() : ''),

							}

						],

						"aaData": list,

						"aoColumns": [

							{ "mDataProp": "branch_name" },

							{

								"mDataProp": function (row, type, val, meta) {

									var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + row.bill_id;

									return '<a href=' + url + ' target="_blank">' + row.bill_no;

								}

							},

							{ "mDataProp": "code" },

							{ "mDataProp": "bill_date" },

							{ "mDataProp": "owned_by" },

							{ "mDataProp": "gift_voucher_amt" },

						],

					});

				}

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

$('#select_all').click(function (event) {

	$("tbody tr td input[type='checkbox']").prop('checked', $(this).prop('checked'));

	event.stopPropagation();

});

$('#cancel_gift').on('click', function () {

	if ($("input[name='id_gift_card[]']:checked").val()) {

		var selected = [];

		$("#gift_issued tbody tr").each(function (index, value) {

			if ($(value).find("input[name='id_gift_card[]']:checked").is(":checked")) {

				transData = {

					'id_gift_card': $(value).find(".id_gift_card").val(),

				}

				selected.push(transData);

			}

		});

		console.log(selected);

		update_gift_status(selected);

	} else {

		alert('Please Select Any One Gift');

	}

});

function update_gift_status(req_data) {

	my_Date = new Date();

	$("div.overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/update_gift_status?nocache=" + my_Date.getUTCSeconds() + '' + my_Date.getUTCMinutes() + '' + my_Date.getUTCHours(),

		data: { 'req_data': req_data },

		type: "POST",

		async: false,

		success: function (data) {

			set_gift_voucher_list();

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function get_order_status() {

	my_Date = new Date();

	$.ajax({

		type: 'GET',

		url: base_url + 'index.php/admin_ret_reports/order_status/order_status?nocache=' + my_Date.getUTCSeconds() + '' + my_Date.getUTCMinutes() + '' + my_Date.getUTCHours(),

		dataType: 'json',

		success: function (data) {

			var id = $("#order_status").val();

			$.each(data, function (key, item) {

				$('#order_status').append(

					$("<option></option>")

						.attr("value", item.id_order_msg)

						.text(item.order_status)

				);

			});

			$('#order_status').select2("val", '');

		}

	});

}

function set_order_status_report() {

	var urlParams = new URLSearchParams(window.location.search);

	var order_staus = urlParams.get("order_staus");

	var id_branch = urlParams.get("id_branch");

	var filter_by = urlParams.get("filter_type");

	var from_date = urlParams.get("from_date");

	var to_date = urlParams.get("to_date");

	var from = $("#rpt_payments1").text();

	var to = $("#rpt_payments2").text();

	var report_name = "ORDER STATUS REPORT";

	var company_name = $('#company_name').val();

	var optional = "";

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from, to, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/order_status/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'id_branch': (id_branch != undefined && id_branch != '' ? id_branch : $("#branch_select").val()), 'from_date': (from_date != undefined ? from_date : $("#rpt_payments1").text()), 'to_date': (to_date != undefined ? to_date : $("#rpt_payments2").text()), 'orderstatus': (order_staus != undefined && order_staus != '' ? order_staus : $('#order_status').val()), 'filter_by': (filter_by != undefined && filter_by != '' ? filter_by : $('#filter_by').val()) }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			$('#issued').css('display', 'block');

			$('#received').css('display', 'none');

			var oTable = $('#order_detail').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#order_detail').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"columnDefs": [

						{

							targets: [7, 8, 9, 21, 22, 23, 24, 25, 26],

							className: 'dt-body-right'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							exportOptions: {

								columns: ':visible'

							},

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', '12px')

									.css('font-family', 'sans-serif');

							},

						},

						'colvis',

						{

							extend: 'excel',

							footer: true,

							title: 'Order Status Report',

						}

					],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "branch_name" },

						{ "mDataProp": "order_type" },

						{ "mDataProp": "order_no" },

						{

							"mDataProp": function (row, type, val, meta) {

								var url = base_url + 'index.php/admin_ret_purchase/get_karigar_acknowladgement/' + row.purord_id;

								return '<a href=' + url + ' target="_blank">' + row.pur_no;

							},

						},

						{ "mDataProp": "tag_code" },

						{

							"mDataProp": function (row, type, val, meta) {

								return '<span class="badge bg-' + row.color + '">' + row.order_status + '</span>';

							},

						},

						{

							"mDataProp": function (row, type, val, meta) {

								if (row.bill_no != '') {

									var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + row.bill_id;

									return '<a href=' + url + ' target="_blank">' + row.bill_no;

								} else {

									return '-';

								}

							},

						},

						{

							"mDataProp": function (row, type, val, meta) {

								return money_format_india(row.advance_amount);

							},

						},

						{

							"mDataProp": function (row, type, val, meta) {

								return money_format_india(row.advance_adj_amount);

							},

						},

						{

							"mDataProp": function (row, type, val, meta) {

								return money_format_india(parseFloat(parseFloat(row.advance_amount) - parseFloat(row.advance_adj_amount)).toFixed(2));

							},

						},

						{ "mDataProp": "karigar_name" },

						{ "mDataProp": "order_date" },

						{ "mDataProp": "delivered_date" },

						{ "mDataProp": "cus_due_date" },

						{ "mDataProp": "smith_due_date" },

						{ "mDataProp": "cus_name" },

						{ "mDataProp": "mobile" },

						{

							"mDataProp": function (row, type, val, meta) {

								if (row.image_details[0] != '' && row.image_details[0] != null) {

									img_src = base_url + 'assets/img/orders/' + row.image_details[0].image;

								}

								else {

									img_src = base_url + 'assets/img/no_image.png';

								}

								return '<img src=' + img_src + ' width="50" height="55"><br><a  class="btn btn-secondary order_img"  id="edit" data-toggle="modal" data-id=' + row.id_orderdetails + '><i class="fa fa-eye"></i></a>';

							},

						},

						{ "mDataProp": "product_name" },

						{ "mDataProp": "design_name" },

						{ "mDataProp": "sub_design_name" },

						{ "mDataProp": "totalitems" },

						{ "mDataProp": "weight" },

						{ "mDataProp": "less_wt" },

						{ "mDataProp": "net_wt" },

						{ "mDataProp": "stn_amt" },

						{ "mDataProp": "wast_percent" },

						{ "mDataProp": "mc" },

						{ "mDataProp": "assigned_by" },

						{ "mDataProp": "assigned_on" },

						{ "mDataProp": "description" },

					],

					footerCallback: function (row, data, start, end, display) {

						var api = this.api();

						var intVal = function (i) {

							return typeof i === 'string' ? i.replace(/[\$,]/g, '') * 1 : typeof i === 'number' ? i : 0;

						};

						var total = "TOTAL";

						var adv_amt = api.column(7, { page: 'current' }).data().reduce(function (a, b) {

							return intVal(a) + intVal(b);

						}, 0);

						var adj_amt = api.column(8, { page: 'current' }).data().reduce(function (a, b) {

							return intVal(a) + intVal(b);

						}, 0);

						var blc_amt = api.column(9, { page: 'current' }).data().reduce(function (a, b) {

							return intVal(a) + intVal(b);

						}, 0);

						var piece = api.column(21, { page: 'current' }).data().reduce(function (a, b) {

							return intVal(a) + intVal(b);

						}, 0);

						var gross_wgt = api.column(22, { page: 'current' }).data().reduce(function (a, b) {

							return intVal(a) + intVal(b);

						}, 0);

						var less_wgt = api.column(23, { page: 'current' }).data().reduce(function (a, b) {

							return intVal(a) + intVal(b);

						}, 0);

						var net_wgt = api.column(24, { page: 'current' }).data().reduce(function (a, b) {

							return intVal(a) + intVal(b);

						}, 0);

						var stone_value = api.column(25, { page: 'current' }).data().reduce(function (a, b) {

							return intVal(a) + intVal(b);

						}, 0);

						var mc_value = api.column(26, { page: 'current' }).data().reduce(function (a, b) {

							return intVal(a) + intVal(b);

						}, 0);

						$(api.column(6).footer()).html(total);

						$(api.column(7).footer()).html(money_format_india(parseFloat(adv_amt).toFixed(2)));

						$(api.column(8).footer()).html(money_format_india(parseFloat(adj_amt).toFixed(2)));

						$(api.column(9).footer()).html(money_format_india(parseFloat(blc_amt).toFixed(2)));

						$(api.column(21).footer()).html(money_format_india(parseFloat(piece).toFixed(0)));

						$(api.column(22).footer()).html(money_format_india(parseFloat(gross_wgt).toFixed(3)));

						$(api.column(23).footer()).html(money_format_india(parseFloat(less_wgt).toFixed(3)));

						$(api.column(24).footer()).html(money_format_india(parseFloat(net_wgt).toFixed(2)));

						$(api.column(25).footer()).html(money_format_india(parseFloat(stone_value).toFixed(2)));

						$(api.column(26).footer()).html(money_format_india(parseFloat(mc_value).toFixed(2)));

					},

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

$(document).on('click', "#order_detail a.order_img", function (e) {

	e.preventDefault();

	id = $(this).data('id');

	$("#edit-id").val(id);

	view_dup_tag_history_imgs(id);

});

function view_dup_tag_history_imgs(order_id_img1) {

	update_tag_img_id1 = order_id_img1;

	data = [];

	var tag_codeimage1 = base_url + 'assets/img/orders';

	$('#imageModal_bulk_edit').modal('show');

	$(".overlay").css('display', "none");

	$.ajax({

		data: ({ 'order_id': order_id_img1 }),

		url: base_url + "index.php/admin_ret_order/get_img_by_order_id?nocache=" + my_Date.getUTCSeconds() + '' + my_Date.getUTCMinutes() + '' + my_Date.getUTCHours(),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			retrive_img = data;

			for (i = 0; i < data.length; i++) {

				img_src = data[i].image;

				var preview = $('#order_images');

				var img = tag_codeimage1 + '/' + img_src;

				if (img_src) {

					div = document.createElement("div");

					div.setAttribute('class', 'col-md-3 images');

					div.setAttribute('id', 'order_img_edit_' + [i]);

					$('.images').css('margin-right', '25px');

					key = [i];

					param = img_src;

					div.innerHTML += "<div class='form-group'><div class='image-input image-input-outline' id='kt_image_'><div class='image-input-wrapper'><img class='thumbnail' src='" + img + "'" + "style='width: 300px;height: 250px;'/><a href=" + img + " download=" + img_src + "><i class='fa fa-download btn btn-success'>Download</i></div></div></a>";

					preview.append(div);

				}

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

$("#imageModal_bulk_edit").on("hidden.bs.modal", function () {

	$('#order_images').empty();

});

// tag history

/*$('#tag_number').on('keyup',function(){

	getSearchTags(this.value);

});*/

function getSearchTags(searchTxt) {

	my_Date = new Date();

	$.ajax({

		url: base_url + 'index.php/admin_ret_reports/getTaggingBySearch/?nocache=' + my_Date.getUTCSeconds(),

		dataType: "json",

		method: "POST",

		data: { 'searchTxt': searchTxt },

		success: function (data) {

			$("#tag_number").autocomplete(

				{

					source: data,

					select: function (e, i) {

						e.preventDefault();

						$('#tag_id').val(i.item.value);

						set_tag_history();

					},

					change: function (event, ui) {

						if (ui.item === null) {

						}

					},

					response: function (e, i) {

						$('#tag_id').val('');

						// ui.content is the array that's about to be sent to the response callback.

					},

					minLength: 1,

				});

		}

	});

}

function set_tag_history() {

	var company_name = $('#company_name').val();

	var from_date = '';

	var to_date = '';

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "Tag History Report";

	var optional = '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/tag_history/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'tag_id': $("#tag_number").val(), 'old_tag_id': $("#old_tag_number").val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			var oTable = $('#tag_history').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#tag_history').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"order": [[0, "desc"]],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', '10px');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: "Tag History Report",

						}

					],

					"aaData": list,

					"aoColumns": [

						{

							"mDataProp": function (row, type, val, meta) {

								if (row.tag_image != null && row.tag_image != undefined && row.tag_image != '') {

									var img_src = base_url + 'assets/img/tag/' + row.tag_image;

								}

								else {

									var img_src = base_url + 'assets/img/no_image.png';

								}

								var image = "<img  class='img_src' id='img_prev' src=" + img_src + "  width='35' height='35' onClick=tag_imgprev($(this).closest('tr')) ></img>"

								return image;

							}

						},

						{ "mDataProp": "tag_id" },

						{ "mDataProp": "tag_code" },

						{ "mDataProp": "old_tag_id" },

						{ "mDataProp": "tag_date" },

						{ "mDataProp": "supplier_name" },

						{ "mDataProp": "product_name" },

						{ "mDataProp": "design_name" },

						{ "mDataProp": "sub_design_name" },

						{ "mDataProp": "gross_wt" },

						{ "mDataProp": "net_wt" },

						{

							"mDataProp": function (row, type, val, meta) {

								if (row.status == 1) {

									return '<span class="badge bg-green">' + row.tag_status + '</span>';

								} else {

									return '<span class="badge bg-red">' + row.tag_status + '</span>';

								}

							}

						},

						{ "mDataProp": "emp_name" },

						{

							"mDataProp": null,

							"sClass": "control center",

							"sDefaultContent": '<span class="drill-val"><i class="fa fa-chevron-circle-down text-teal"></i></span>'

						},

					],

				});

				var anOpen = [];

				$(document).on('click', "#tag_history .control", function () {

					var nTr = this.parentNode;

					var i = $.inArray(nTr, anOpen);

					if (i === -1) {

						$('.drill-val', this).html('<i class="fa fa-chevron-circle-up text-teal"></i>');

						oTable.fnOpen(nTr, fnFormatRowTagDetails(oTable, nTr), 'details');

						anOpen.push(nTr);

					}

					else {

						$('.drill-val', this).html('<i class="fa fa-chevron-circle-down text-teal"></i>');

						oTable.fnClose(nTr);

						anOpen.splice(i, 1);

					}

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function fnFormatRowTagDetails(oTable, nTr) {

	var oData = oTable.fnGetData(nTr);

	var rowDetail = '';

	var tot_row = 0;

	var prodTable =

		'<div class="innerDetails">' +

		'<table class="table table-responsive table-bordered text-center table-sm">' +

		'<tr class="bg-teal">' +

		'<th>S.No</th>' +

		'<th>Date</th>' +

		'<th>From Branch</th>' +

		'<th>To Branch</th>' +

		'<th>Status</th>' +

		'<th>Est No</th>' +

		'<th>Bill No</th>' +

		'</tr>';

	var tag_details = oData.tag_history;

	var est_details = oData.est_details;

	var bill_details = oData.bill_details;

	var section_details = oData.section_history;

	tot_row = tag_details.length;

	$.each(tag_details, function (idx, val) {

		var ref_no = val.tag_id;

		prodTable +=

			'<tr class="prod_det_btn">' +

			'<td>' + parseFloat(idx + 1) + '</td>' +

			'<td>' + val.date + '</td>' +

			'<td>' + val.from_branch + '</td>' +

			'<td>' + val.to_branch + '</td>' +

			'<td>' + val.tag_status + '</td>' +

			'<td>-</td>' +

			'<td>-</td>' +

			'</tr>';

	});

	if (est_details != null) {

		$.each(est_details, function (idx, val) {

			var bill_url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + val.bill_id;

			var est_url = base_url + 'index.php/admin_ret_estimation/generate_invoice//' + val.estimation_id;

			prodTable +=

				'<tr class="prod_det_btn">' +

				'<td>' + parseFloat(idx + tot_row + 1) + '</td>' +

				'<td>' + val.date_add + '</td>' +

				'<td>-</td>' +

				'<td>-</td>' +

				'<td>' + (val.bill_no != '' ? 'Sold Out' : 'Estimated') + '</td>' +

				'<td><a href=' + est_url + ' target="_blank">' + val.esti_no + '</a></td>' +

				'<td><a href=' + bill_url + ' target="_blank">' + (val.bill_no != '' ? val.bill_no : '-') + '</a></td>' +

				'</tr>';

		});

	}

	if (bill_details != null) {

		$.each(bill_details, function (idx, val) {

			var bill_url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + val.bill_id;

			// var est_url = base_url + 'index.php/admin_ret_estimation/generate_invoice//' + val.estimation_id;

			prodTable +=

				'<tr class="prod_det_btn">' +

				'<td>' + parseFloat(idx + tot_row + 1) + '</td>' +

				'<td>' + val.date_add + '</td>' +

				'<td>-</td>' +

				'<td>-</td>' +

				'<td>' + (val.bill_no != '' ? 'Sold Out' : 'Estimated') + '</td>' +

				'<td></td>' +

				'<td><a href=' + bill_url + ' target="_blank">' + (val.bill_no != '' ? val.bill_no : '-') + '</a></td>' +

				'</tr>';

		});

	}

	if (section_details.length > 0) {

		prodTable += '<div class="innerDetails">' +

			'<table class="table table-responsive table-bordered text-center table-sm">' +

			'<tr class="bg-teal">' +

			'<th>S.No</th>' +

			'<th>Date</th>' +

			'<th>From Section</th>' +

			'<th>To Section</th>' +

			'</tr>';

		$.each(section_details, function (idx, val) {

			prodTable +=

				'<tr class="prod_det_btn">' +

				'<td>' + parseFloat(idx + 1) + '</td>' +

				'<td>' + val.date + '</td>' +

				'<td>' + val.from_section + '</td>' +

				'<td>' + val.to_section + '</td>' +

				'</tr>';

		});

	}

	rowDetail = prodTable + '</table></div>';

	return rowDetail;

}

// tag history

//Monthly sales

function set_monthly_sales() {

	var dt_range = ($("#dt_range").val()).split('-');

	var company_name = $('#company_name').val();

	var from_date = dt_range[0];

	var to_date = dt_range[1];

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "Monthly Sales Report";

	var optional = '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/monthly_sales/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'dt_range': $("#dt_range").val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			var oTable = $('#monthly_sales').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#monthly_sales').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"order": [[0, "desc"]],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', '10px');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: "Monthly Sales Report",

						}

					],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "branch_name" },

						{ "mDataProp": "starting_bill" },

						{ "mDataProp": "ending_bill" },

						{ "mDataProp": "gold_sales" },

						{ "mDataProp": "silver_sales" },

						{ "mDataProp": "pur_starting_bill" },

						{ "mDataProp": "pur_ending_bill" },

					],

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//Monthly sales

//Old Metal Profit and Loss

function get_old_metal_type() {

	$('#karigar option').remove();

	$.ajax({

		type: 'GET',

		url: base_url + 'index.php/admin_ret_reports/get_old_metal_type',

		dataType: 'json',

		success: function (data) {

			if (ctrl_page[2] != 'categorywise_day_transaction') {

				var id_karigar = $("#karigar").val();

			}

			$("#old_metal_type").select2(

				{

					placeholder: "Select Category",

					allowClear: true

				});

			$.each(data, function (key, item) {

				$('#old_metal_type').append(

					$("<option></option>")

						.attr("value", item.id_metal_type)

						.text(item.metal_type)

				);

			});

			$("#old_metal_type").select2("val", '');

		}

	});

}

$("#branch_select").change(function () {

	var data = $("#branch_select").select2('data');

	selectedValue = $(this).val();

	$("#id_branch").val(selectedValue);

});

$("#old_metal_type").change(function () {

	var data = $("#old_metal_type").select2('data');

	selectedValue = $(this).val();

	$("#id_old_metal_type").val(selectedValue);

});

function set_old_metal_analyse_table() {

	var dt_range = ($("#dt_range").val()).split('-');

	var company_name = $('#company_name').val();

	var from_date = dt_range[0];

	var to_date = dt_range[1];

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "PURCHASE AND EXCHANGE"

	var metal = $('#filter_metal option:selected').html() != '' && $('#filter_metal option:selected ').html() != undefined ? $('#filter_metal option:selected').html() + " - " : '';

	var old_metal_type = $('#old_metal_type option:selected').html() != '' && $('#old_metal_type option:selected ').html() != undefined ? $('#old_metal_type option:selected').html() + " - " : '';

	var optional = metal + old_metal_type;

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/old_metal_analyse/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'metal': $("#filter_metal").val(), 'dt_range': $("#dt_range").val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'old_metal_type': $('#id_old_metal_type').val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.list.item_details;

			var goldrate_24ct = data.list.metal_rate.goldrate_24ct;

			$("#old_metal_report > tbody > tr").remove();

			$('#old_metal_report').dataTable().fnClearTable();

			$('#old_metal_report').dataTable().fnDestroy();

			if (list != null) {

				var return_details = data.list.return_details;

				var partly_sale_det = data.list.partly_sale_det;

				trHTML = '';

				tfootHTML = '';

				var total_gross_wt = 0;

				var total_stone_wt = 0;

				var total_dust_wt = 0;

				var total_dia_wt = 0;

				var total_pure_wt = 0;

				var total_wast_wt = 0;

				var total_net_wt = 0;

				var total_rate = 0;

				var sales_ret_gwt = 0;

				var sales_ret_nwt = 0;

				var partly_sale_gwt = 0;

				var partly_sale_nwt = 0;

				var total_purity_per = 0;

				var length = 0;

				var tot_length = 0;

				var total_touch = 0;

				//Old Metal Purchase

				$.each(list, function (i, category) {

					tot_length = tot_length + 1;

					var gross_wt = 0;

					var stone_wt = 0;

					var dust_wt = 0;

					var dia_wt = 0;

					var pure_wt = 0;

					var wast_wt = 0;

					var net_wt = 0;

					var rate = 0;

					var purity_per = 0;

					var profit_per = 0;

					var tot_pur_per = 0;

					var touch = 0;

					trHTML += '<tr>' +

						'<td><strong>' + i + '</strong></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></th>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'</tr>';

					$.each(category, function (idx, item) {

						length = length + 1;

						var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + item.bill_id;

						if (item.goldrate_24ct > 0) {

							purity_per = parseFloat(((item.rate / item.pure_wt) / item.goldrate_24ct) * 100).toFixed(2);

							tot_pur_per += parseFloat(((item.rate / item.pure_wt) / item.goldrate_24ct) * 100);

						}

						trHTML += '<tr>' +

							'<td>' + item.bill_date + '</td>' +

							'<td><a href=' + url + ' target="_blank">' + item.bill_no + '</a></td>' +

							'<td>' + money_format_india(item.gross_wt) + '</td>' +

							'<td>' + money_format_india(item.stone_wt) + '</td>' +

							'<td>' + money_format_india(item.dust_wt) + '</td>' +

							'<td>' + money_format_india(item.dia_wt) + '</td>' +

							'<td>' + money_format_india(item.pure_wt) + '</td>' +

							'<td>' + money_format_india(item.wast_wt) + '</td>' +

							'<td>' + money_format_india(item.net_wt) + '</td>' +

							'<td>' + item.touch + '</td>' +

							'<td>' + purity_per + '</td>' +

							'<td>' + money_format_india(item.rate_per_grm) + '</td>' +

							'<td>' + money_format_india(item.goldrate_24ct) + '</td>' +

							'<td>' + money_format_india(item.rate) + '</td>' +

							'<td>' + item.esti_no + '</td>' +

							'</tr>';

						gross_wt = parseFloat(gross_wt) + parseFloat(item.gross_wt);

						stone_wt = parseFloat(stone_wt) + parseFloat(item.stone_wt);

						dust_wt = parseFloat(dust_wt) + parseFloat(item.dust_wt);

						pure_wt = parseFloat(pure_wt) + parseFloat(item.pure_wt);

						wast_wt = parseFloat(wast_wt) + parseFloat(item.wast_wt);

						net_wt = parseFloat(net_wt) + parseFloat(item.net_wt);

						rate = parseFloat(rate) + parseFloat(item.rate);

						dia_wt = parseFloat(dia_wt) + parseFloat(item.dia_wt);

						touch = parseFloat(touch) + parseFloat(item.touch);

					});

					tot_pur_per = parseFloat(tot_pur_per / length);

					touch = parseFloat(touch / length);

					trHTML += '<tr style="color:red">' +

						'<td><strong>SUB TOTAL</strong></td>' +

						'<td></td>' +

						'<td><strong>' + money_format_india(parseFloat(gross_wt).toFixed(3)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(stone_wt).toFixed(3)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(dust_wt).toFixed(3)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(dia_wt).toFixed(3)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(pure_wt).toFixed(3)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(wast_wt).toFixed(3)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(net_wt).toFixed(3)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(touch).toFixed(2)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(tot_pur_per).toFixed(2)) + '</strong></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td><strong>' + money_format_india(parseFloat(rate).toFixed(2)) + '</strong></th>' +

						'<td></td>' +

						'<td></td>' +

						'</tr>';

					tfootHTML += '<tr>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td colspan="2"><strong>' + i + '</strong></td>' +

						'<td>' + parseFloat(tot_pur_per).toFixed(2) + '</td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></th>' +

						'<td></th>' +

						'<td></td>' +

						'<td></td>' +

						'</tr>';

					total_purity_per += tot_pur_per;

					total_touch += touch;

					tot_pur_per = 0;

					length = 0;

					total_gross_wt = total_gross_wt + gross_wt;

					total_stone_wt = total_stone_wt + stone_wt;

					total_dust_wt = total_dust_wt + dust_wt;

					total_dia_wt = total_dia_wt + dia_wt;

					total_pure_wt = total_pure_wt + pure_wt;

					total_wast_wt = total_wast_wt + wast_wt;

					total_net_wt = total_net_wt + net_wt;

					total_rate = total_rate + rate;

				});

				trHTML += '<tr style="color:red">' +

					'<td><strong>Grand Total</strong></td>' +

					'<td></td>' +

					'<td><strong>' + money_format_india(parseFloat(total_gross_wt).toFixed(3)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(total_stone_wt).toFixed(3)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(total_dust_wt).toFixed(3)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(total_dia_wt).toFixed(3)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(total_pure_wt).toFixed(3)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(total_wast_wt).toFixed(3)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(total_net_wt).toFixed(3)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(total_touch / tot_length).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(total_purity_per / tot_length).toFixed(2)) + '</strong></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td><strong>' + money_format_india(parseFloat(total_rate).toFixed(2)) + '</strong></th>' +

					'<td></td>' +

					'<td></td>' +

					'</tr>';

				trHTML += tfootHTML;

				//Old Metal Purchase

				$('#old_metal_report > tbody').html(trHTML);

				// Check and initialise datatable

				if (!$.fn.DataTable.isDataTable('#old_metal_report')) {

					oTable = $('#old_metal_report').dataTable({

						"bSort": false,

						"bInfo": true,

						"scrollX": '100%',

						"dom": 'lBfrtip',

						"lengthMenu": [[-1, 25, 50, 100, 250], ["All", 25, 50, 100, 250]],

						"columnDefs": [

							{

								targets: [2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14],

								className: 'dt-body-right'

							},

							{

								targets: [0, 1],

								className: 'dt-body-left'

							},

						],

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: '',

								messageTop: title,

								orientation: 'landscape',

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact');

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', '10px')

										.css('font-family', 'sans-serif');

								},

							},

							{

								extend: 'colvis',

								collectionLayout: 'fixed columns',

								collectionTitle: 'Column visibility control'

							},

							{

								extend: 'excel',

								footer: true,

								title: 'Old Metal Purchase Analyse Report',

							}

						],

					});

					// $('#old_metal_report').on('shown.bs.collapse', function () {

					// 			$($.fn.dataTable.tables(true)).DataTable()

					// 		   .columns.adjust();

					// 	 });

				}

			}

		}

	});

}

//Old Metal Profit and Loss

//Sales Analysis

$('#select_zone').on('change', function () {

	if (this.value != '') {

		get_ActiveVillage();

	}

});

$('#branch_select').on('change', function () {

	if (ctrl_page[1] == 'sales_analysis_report') {

		get_ActiveZone();

	}

	if (ctrl_page[1] == 'cash_abstract' || ctrl_page[1] == 'bill_wise_transcation') {

		get_ActiveFloors();

		get_ActiveCounters();

		if (ctrl_page[1] == 'cash_abstract') {

			get_employee("cash_abs");

		}

	}

	if (ctrl_page[1] == 'section_stock_inout' || ctrl_page[1] == 'item_sales_detail') {

		get_ActiveSections();

	}

	if (ctrl_page[1] == 'scan_report' && this.value != '' && this.value != null) {

		get_ActiveSectionsBranchWise(this.value);

	}

});

$('#branch_scan_filter').on('change', function () {

	if (this.value != '') {

		get_ActiveSectionsBranchWise(this.value);

	}

});

function get_ActiveSectionsBranchWise(id_branch) {

	$("#section_select option").remove();

	$("#section_filter option").remove();

	my_Date = new Date();

	$.ajax({

		type: 'POST',

		url: base_url + "index.php/admin_ret_catalog/get_sectionBranchwise?nocache=" + my_Date.getUTCSeconds(),

		dataType: 'json',

		data: { 'id_branch': id_branch },

		success: function (data) {

			var id = $("#id_section").val();

			$.each(data, function (key, item) {

				$("#section_select,#section_filter").append(

					$("<option></option>")

						.attr("value", item.id_section)

						.text(item.section_name)

				);

			});

			$('#section_select,#section_filter').select2({

				placeholder: "Select Section",

				allowClear: true

			});

			$("#section_select").select2("val", (id != '' && id > 0 ? id : ''));

			if ($("#section_filter").length) {

				$("#section_filter").select2("val", (id != '' && id > 0 ? id : ''));

			};

			$(".overlay").css("display", "none");

		}

	})

}

function get_ActiveZone() {

	$('#select_zone option').remove();

	$('.overlay').css('display', 'block');

	$.ajax({

		type: 'POST',

		url: base_url + 'index.php/admin_ret_reports/ajax_zone_list',

		dataType: 'json',

		data: { 'id_branch': $('#branch_select').val() },

		success: function (data) {

			var id_village = '';

			$.each(data, function (key, data) {

				$('#select_zone').append(

					$("<option></option>")

						.attr("value", data.id_zone)

						.text(data.name)

				);

				$('#select_zone').select2({

					placeholder: "Select Zone",

					allowClear: true

				});

				$("#select_zone").select2("val", '');

			});

			$('.overlay').css('display', 'none');

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

$("body").on("click", "#retail_tab", function () {

	get_sales_analysis_report();

});

$("body").on("click", "#crm_tab", function () {

	getChitAnalysisReport();

});

function getChitAnalysisReport() {

	$("div.overlay").css("display", "block");

	var company_name = $('#company_name').val();

	var dt_range = ($("#dt_range").val()).split('-');

	var title = "<b><span style='font-size:15pt;margin-left:30%;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>" + "<span style=font-size:13pt;margin-left:25%;>&nbsp;&nbsp;CHIT ANALYSIS REPORT  From&nbsp;:&nbsp;" + dt_range[0] + " &nbsp;&nbsp;To Date&nbsp;:&nbsp;" + dt_range[1] + "</span>";

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/sales_analysis_report/crm_details?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'dt_range': $("#dt_range").val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'id_village': $('#select_village').val(), 'id_zone': $('#select_zone').val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var oTable = $('#chit_analysis_list').DataTable();

			oTable.clear().draw();

			if (data != null) {

				chit_Table = $('#chit_analysis_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"order": [[0, "desc"]],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: "",

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: "Chit Analysis Report",

						}

					],

					"aaData": data,

					"aoColumns": [

						{ "mDataProp": "id_customer" },

						{ "mDataProp": "cus_name" },

						{

							"mDataProp": function (row, type, val, meta) {

								var url = base_url + 'index.php/admin_ret_reports/customer_history/list/' + row.mobile;

								return '<a href=' + url + ' target="_blank">' + row.mobile + '</a>';

							}

						},

						{ "mDataProp": "zone_name" },

						{ "mDataProp": "village_name" },

						{ "mDataProp": "tot_acc" },

						{ "mDataProp": "active_acc" },

						{ "mDataProp": "closed_acc" },

						{ "mDataProp": "tot_bill" },

					],

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function get_sales_analysis_report() {

	var company_name = $('#company_name').val();

	var from_date = $('#rpt_payments1').html();

	var to_date = $('#rpt_payments2').html();

	var branch_name = ($('#id_branch').val() != '' && $('#id_branch').val() != undefined ? $('#id_branch').val() : $("#branch_select option:selected").text());

	var report_name = "Area Analysts Report";

	var optional = '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/sales_analysis_report/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'from_date': $('#rpt_payments1').html(), 'to_date': $('#rpt_payments2').html(), 'id_branch': $('#branch_select').val(), 'id_village': $('#select_village').val(), 'id_product': $('#prod_select').val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			$("#sales_analysis_list > tbody > tr").remove();

			$('#sales_analysis_list').dataTable().fnClearTable();

			$('#sales_analysis_list').dataTable().fnDestroy();

			var data = data.list;

			var trHTML = '';

			var total_cus = 0;

			var totnew_cus = 0;

			var total_gold_wt = 0;

			var total_silver_wt = 0;

			var total_mrp_amt = 0;

			var total_acc = 0;

			var total_active_acc = 0;

			var total_closed_acc = 0;

			$i = 1;

			var oTable = $('#sales_analysis_list').DataTable();

			oTable.clear().draw();

			if (data != null && data.length > 0) {

				oTable = $('#sales_analysis_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"order": [[0, "asc"]],

					"columnDefs": [

						{

							targets: [3, 4, 5, 6, 7, 8, 9, 10, 11],

							className: 'dt-body-right'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', '10px');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: "Area Analysts Report",

						}

					],

					"aaData": data,

					"aoColumns": [

						{ "mDataProp": "id_village" },

						{ "mDataProp": "village_name" },

						{ "mDataProp": "branch_name" },

						{

							"mDataProp": function (items, type, val, meta) {

								var tot_customer = base_url + 'index.php/admin_ret_reports/sales_analysis_report/sales_details/' + items.id_village + '/' + $('#branch_select').val() + '/' + $('#rpt_payments1').html() + '/' + $('#rpt_payments2').html() + '/1';

								return '<a href=' + tot_customer + ' target="_blank">' + money_format_india(items.tot_cus) + '</a>';

							}

						},

						{

							"mDataProp": function (items, type, val, meta) {

								var tot_customer = base_url + 'index.php/admin_ret_reports/sales_analysis_report/sales_details/' + items.id_village + '/' + $('#branch_select').val() + '/' + $('#rpt_payments1').html() + '/' + $('#rpt_payments2').html() + '/2';

								return '<a href=' + tot_customer + ' target="_blank">' + money_format_india(items.totnew_cus) + '</a>';

							}

						},

						{

							"mDataProp": function (items, type, val, meta) {

								var tot_customer = base_url + 'index.php/admin_ret_reports/sales_analysis_report/without_acc_list/' + items.id_village + '/' + $('#branch_select').val() + '/' + $('#rpt_payments1').html() + '/' + $('#rpt_payments2').html() + '/3';

								return '<a href=' + tot_customer + ' target="_blank">' + money_format_india(items.without_acc) + '</a>';

							}

						},

						{

							"mDataProp": function (items, type, val, meta) {

								return '<a href=' + base_url + 'index.php/admin_ret_reports/sales_analysis_report/product_details/' + items.id_village + '/' + $('#branch_select').val() + '/' + $('#rpt_payments1').html() + '/' + $('#rpt_payments2').html() + '/1/2' + ' target="_blank">' + items.tot_gold_wt + '</a>';

							}

						},

						{

							"mDataProp": function (items, type, val, meta) {

								return '<a href=' + base_url + 'index.php/admin_ret_reports/sales_analysis_report/product_details/' + items.id_village + '/' + $('#branch_select').val() + '/' + $('#rpt_payments1').html() + '/' + $('#rpt_payments2').html() + '/2/2' + ' target="_blank">' + items.tot_silver_wt + '</a>';

							}

						},

						{

							"mDataProp": function (items, type, val, meta) {

								return '<a href=' + base_url + 'index.php/admin_ret_reports/sales_analysis_report/product_details/' + items.id_village + '/' + $('#branch_select').val() + '/' + $('#rpt_payments1').html() + '/' + $('#rpt_payments2').html() + '/1/1' + ' target="_blank">' + items.tot_amt + '</a>';

							}

						},

						{

							"mDataProp": function (items, type, val, meta) {

								return parseFloat(parseFloat(items.active_acc) + parseFloat(items.closed_acc));

							}

						},

						{

							"mDataProp": function (items, type, val, meta) {

								return '<a href=' + base_url + 'index.php/admin_ret_reports/sales_analysis_report/chit_details/' + items.id_village + '/' + $('#branch_select').val() + '/' + $('#rpt_payments1').html() + '/' + $('#rpt_payments2').html() + '/0' + ' target="_blank">' + items.active_acc + '</a>';

							}

						},

						{

							"mDataProp": function (items, type, val, meta) {

								return '<a href=' + base_url + 'index.php/admin_ret_reports/sales_analysis_report/chit_details/' + items.id_village + '/' + $('#branch_select').val() + '/' + $('#rpt_payments1').html() + '/' + $('#rpt_payments2').html() + '/1' + ' target="_blank">' + items.closed_acc + '</a>';

							}

						},

					],

					"footerCallback": function (row, data, start, end, display) {

						if (data.length > 0) {

							var api = this.api(), data;

							var tot_cus = 0;

							var new_cus = 0;

							var tot_gold = 0;

							var tot_silver = 0;

							var tot_amt = 0;

							var tot_acc = 0;

							var active_acc = 0;

							var closed_acc = 0;

							var without_acc = 0;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								tot_cus += parseInt(data[i].tot_cus);

								new_cus += parseInt(data[i].totnew_cus);

								without_acc += parseInt(data[i].without_acc);

								tot_gold += parseInt(data[i].tot_gold_wt);

								tot_silver += parseInt(data[i].tot_silver_wt);

								tot_amt += parseInt(data[i].tot_silver_wt);

								tot_acc += parseInt(parseInt(data[i].active_acc) + parseInt(data[i].closed_acc));

								active_acc += parseInt(parseInt(data[i].active_acc));

								closed_acc += parseInt(parseInt(data[i].closed_acc));

								$(api.column(3).footer()).html(money_format_india(parseFloat(tot_cus).toFixed(2)));

								$(api.column(4).footer()).html(money_format_india(parseFloat(new_cus).toFixed(2)));

								$(api.column(5).footer()).html(money_format_india(parseFloat(without_acc).toFixed(2)));

								$(api.column(6).footer()).html(money_format_india(parseFloat(tot_gold).toFixed(2)));

								$(api.column(7).footer()).html(money_format_india(parseFloat(tot_silver).toFixed(2)));

								$(api.column(8).footer()).html(money_format_india(parseFloat(tot_amt).toFixed(2)));

								$(api.column(9).footer()).html(money_format_india(parseFloat(tot_acc).toFixed(2)));

								$(api.column(10).footer()).html(money_format_india(parseFloat(active_acc).toFixed(2)));

								$(api.column(11).footer()).html(money_format_india(parseFloat(closed_acc).toFixed(2)));

							}

						} else {

							var api = this.api(), data;

							$(api.column(4).footer()).html('');

						}

					}

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function get_sales_analysis_other_city_report() {

	var company_name = $('#company_name').val();

	var from_date = $('#rpt_payments1').html();

	var to_date = $('#rpt_payments2').html();

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "SALES ANALYSIS REPORT";

	var optional = '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/sales_analysis_report/sales_analysis_other_city?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'from_date': $('#rpt_payments1').html(), 'to_date': $('#rpt_payments2').html(), 'id_branch': $('#branch_select').val(), 'id_village': $('#select_village').val(), 'id_product': $('#prod_select').val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var oTable = $('#sales_analysis_other_city_list').DataTable();

			oTable.clear().draw();

			if (data != null && data.length > 0) {

				oTable = $('#sales_analysis_other_city_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"order": [[0, "asc"]],

					"columnDefs": [

						{

							targets: [3, 4, 5, 6, 7, 8, 9, 10, 11],

							className: 'dt-body-right'

						}

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', '10px');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: "Area Analysts Report",

						}

					],

					"aaData": data,

					"aoColumns": [

						{ "mDataProp": "id_village" },

						{ "mDataProp": "village_name" },

						{ "mDataProp": "branch_name" },

						{

							"mDataProp": function (items, type, val, meta) {

								var tot_customer = base_url + 'index.php/admin_ret_reports/sales_analysis_report/sales_details/' + items.id_village + '/' + $('#branch_select').val() + '/' + $('#rpt_payments1').html() + '/' + $('#rpt_payments2').html() + '/1';

								return '<a href=' + tot_customer + ' target="_blank">' + items.tot_cus + '</a>';

							}

						},

						{

							"mDataProp": function (items, type, val, meta) {

								var tot_customer = base_url + 'index.php/admin_ret_reports/sales_analysis_report/sales_details/' + items.id_village + '/' + $('#branch_select').val() + '/' + $('#rpt_payments1').html() + '/' + $('#rpt_payments2').html() + '/2';

								return '<a href=' + tot_customer + ' target="_blank">' + items.totnew_cus + '</a>';

							}

						},

						{

							"mDataProp": function (items, type, val, meta) {

								var tot_customer = base_url + 'index.php/admin_ret_reports/sales_analysis_report/without_acc_list/' + items.id_village + '/' + $('#branch_select').val() + '/' + $('#rpt_payments1').html() + '/' + $('#rpt_payments2').html() + '/3';

								return '<a href=' + tot_customer + ' target="_blank">' + items.without_acc + '</a>';

							}

						},

						{

							"mDataProp": function (items, type, val, meta) {

								return '<a href=' + base_url + 'index.php/admin_ret_reports/sales_analysis_report/product_details/' + items.id_village + '/' + $('#branch_select').val() + '/' + $('#rpt_payments1').html() + '/' + $('#rpt_payments2').html() + '/1/2' + ' target="_blank">' + items.tot_gold_wt + '</a>';

							}

						},

						{

							"mDataProp": function (items, type, val, meta) {

								return '<a href=' + base_url + 'index.php/admin_ret_reports/sales_analysis_report/product_details/' + items.id_village + '/' + $('#branch_select').val() + '/' + $('#rpt_payments1').html() + '/' + $('#rpt_payments2').html() + '/2/2' + ' target="_blank">' + items.tot_silver_wt + '</a>';

							}

						},

						{

							"mDataProp": function (items, type, val, meta) {

								return '<a href=' + base_url + 'index.php/admin_ret_reports/sales_analysis_report/product_details/' + items.id_village + '/' + $('#branch_select').val() + '/' + $('#rpt_payments1').html() + '/' + $('#rpt_payments2').html() + '/1/1' + ' target="_blank">' + items.tot_amt + '</a>';

							}

						},

						{

							"mDataProp": function (items, type, val, meta) {

								return parseFloat(parseFloat(items.active_acc) + parseFloat(items.closed_acc));

							}

						},

						{

							"mDataProp": function (items, type, val, meta) {

								return '<a href=' + base_url + 'index.php/admin_ret_reports/sales_analysis_report/chit_details/' + items.id_village + '/' + $('#branch_select').val() + '/' + $('#rpt_payments1').html() + '/' + $('#rpt_payments2').html() + '/0' + ' target="_blank">' + items.active_acc + '</a>';

							}

						},

						{

							"mDataProp": function (items, type, val, meta) {

								return '<a href=' + base_url + 'index.php/admin_ret_reports/sales_analysis_report/chit_details/' + items.id_village + '/' + $('#branch_select').val() + '/' + $('#rpt_payments1').html() + '/' + $('#rpt_payments2').html() + '/1' + ' target="_blank">' + items.closed_acc + '</a>';

							}

						},

					],

					"footerCallback": function (row, data, start, end, display) {

						if (data.length > 0) {

							var api = this.api(), data;

							var tot_cus = 0;

							var new_cus = 0;

							var tot_gold = 0;

							var tot_silver = 0;

							var tot_amt = 0;

							var tot_acc = 0;

							var active_acc = 0;

							var closed_acc = 0;

							var without_acc = 0;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								tot_cus += parseInt(data[i].tot_cus);

								new_cus += parseInt(data[i].totnew_cus);

								without_acc += parseInt(data[i].without_acc);

								tot_gold += parseInt(data[i].tot_gold_wt);

								tot_silver += parseInt(data[i].tot_silver_wt);

								tot_amt += parseInt(data[i].tot_silver_wt);

								tot_acc += parseInt(parseInt(data[i].active_acc) + parseInt(data[i].closed_acc));

								active_acc += parseInt(parseInt(data[i].active_acc));

								closed_acc += parseInt(parseInt(data[i].closed_acc));

								$(api.column(3).footer()).html(parseFloat(tot_cus).toFixed(2));

								$(api.column(4).footer()).html(parseFloat(new_cus).toFixed(2));

								$(api.column(5).footer()).html(parseFloat(without_acc).toFixed(2));

								$(api.column(6).footer()).html(parseFloat(tot_gold).toFixed(2));

								$(api.column(7).footer()).html(parseFloat(tot_silver).toFixed(2));

								$(api.column(8).footer()).html(parseFloat(tot_amt).toFixed(2));

								$(api.column(9).footer()).html(parseFloat(tot_acc).toFixed(2));

								$(api.column(10).footer()).html(parseFloat(active_acc).toFixed(2));

								$(api.column(11).footer()).html(parseFloat(closed_acc).toFixed(2));

							}

						} else {

							var api = this.api(), data;

							$(api.column(4).footer()).html('');

						}

					}

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function foramtRowSalesDetails(oTable, nTr) {

	var oData = oTable.fnGetData(nTr);

	var rowDetail = '';

	var prodTable =

		'<div class="innerDetails">' +

		'<table class="table table-responsive table-bordered text-center table-sm">' +

		'<tr class="bg-teal">' +

		'<th>S.No</th>' +

		'<th>Design Name</th>' +

		'<th>Pcs</th>' +

		'<th>Gross Wt</th>' +

		'<th>Net Wt</th>' +

		'<th>Amount</th>' +

		'</tr>';

	var design_details = oData.design_details;

	$.each(design_details, function (idx, val) {

		prodTable +=

			'<tr class="prod_det_btn">' +

			'<td>' + parseFloat(idx + 1) + '</td>' +

			'<td>' + val.design_name + '</td>' +

			'<td>' + val.total_pcs + '</td>' +

			'<td>' + val.total_gwt + '</td>' +

			'<td>' + val.total_nwt + '</td>' +

			'<td>' + val.total_cost + '</td>' +

			'</tr>';

	});

	rowDetail = prodTable + '</table></div>';

	return rowDetail;

}

function fnFormatRowcusSalesDetails(oTable, nTr) {

	var oData = oTable.fnGetData(nTr);

	var rowDetail = '';

	var prodTable =

		'<div class="innerDetails">' +

		'<table class="table table-responsive table-bordered text-center table-sm">' +

		'<tr class="bg-teal">' +

		'<th>S.No</th>' +

		'<th>Customer</th>' +

		'<th>Mobile</th>' +

		'<th>Sales-Gold</th>' +

		'<th>Sales-Silver</th>' +

		'<th>MRP Amount</th>' +

		'<th>Purchase-Gold</th>' +

		'<th>Purchase-Silver</th>' +

		'<th>Return-Gold</th>' +

		'<th>Return-Silver</th>' +

		'</tr>';

	var cusSalesDetails = oData.cusSalesDetails;

	var sales_gold_gwt = 0;

	var sales_silver_gwt = 0;

	var old_gold_wt = 0;

	var old_silver_wt = 0;

	var return_gold = 0;

	var return_silver = 0;

	var mrp_cost = 0;

	$.each(cusSalesDetails, function (idx, val) {

		sales_gold_gwt += parseFloat(val.sales_gold_gwt);

		sales_silver_gwt += parseFloat(val.sales_silver_gwt);

		old_gold_wt += parseFloat(val.old_gold_wt);

		old_silver_wt += parseFloat(val.old_silver_wt);

		return_gold += parseFloat(val.return_gold);

		return_silver += parseFloat(val.return_silver);

		mrp_cost += parseFloat(val.mrp_cost);

		var url = base_url + 'index.php/admin_ret_reports/customer_history/list/' + val.mobile;

		prodTable +=

			'<tr class="prod_det_btn">' +

			'<td>' + parseFloat(idx + 1) + '</td>' +

			'<td>' + val.cus_name + '</td>' +

			'<td><a href=' + url + ' target="_blank">' + val.mobile + '</a></td>' +

			'<td>' + val.sales_gold_gwt + '</td>' +

			'<td>' + val.sales_silver_gwt + '</td>' +

			'<td>' + val.mrp_cost + '</td>' +

			'<td>' + val.old_gold_wt + '</td>' +

			'<td>' + val.old_silver_wt + '</td>' +

			'<td>' + val.return_gold + '</td>' +

			'<td>' + val.return_silver + '</td>' +

			'</tr>';

	});

	prodTable += '<tr class="prod_det_btn" style="font-weight:bold;">' +

		'<td>Total</td>' +

		'<td></td>' +

		'<td></td>' +

		'<td>' + parseFloat(sales_gold_gwt).toFixed(3) + '</td>' +

		'<td>' + parseFloat(sales_silver_gwt).toFixed(3) + '</td>' +

		'<td>' + parseFloat(mrp_cost).toFixed(3) + '</td>' +

		'<td>' + parseFloat(old_gold_wt).toFixed(3) + '</td>' +

		'<td>' + parseFloat(old_silver_wt).toFixed(3) + '</td>' +

		'<td>' + parseFloat(return_gold).toFixed(3) + '</td>' +

		'<td>' + parseFloat(return_silver).toFixed(3) + '</td>' +

		'</tr>';

	rowDetail = prodTable + '</table></div>';

	return rowDetail;

}

//Sales Analysis

//Customer and Tag History

$('#cus_search').on('click', function () {

	var mobile_num = $('#mobilenumber').val();

	if (mobile_num.length != 10) {

		alert('Please Enter The Valid Number..');

		$('#mobilenumber').val('');

		$('#mobilenumber').focus();

	} else {

		get_customer_details();

		$('#mobilenumber').val('');

	}

});

$('#tag_search').on('click', function () {

	if ($("#tag_number").val() != '' || $("#old_tag_number").val() != '') {

		set_tag_history();

	} else {

		$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + 'Please Enter The Tag Number..' });

	}

});

function get_customer_details() {

	$('.overlay').css('display', 'block');

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/customer_history/ajax?nocache=" + my_Date.getUTCSeconds(),

		type: 'POST',

		dataType: 'json',

		data: { 'mobile': (ctrl_page[3] != '' && ctrl_page[3] != undefined ? ctrl_page[3] : $('#mobilenumber').val()) },

		success: function (data) {

			var accHtml = '';

			var salesHtml = '';

			var purHtml = '';

			var creditHtml = '';

			var customer = data.customer;

			var accounts = data.accounts;

			var sales_details = data.sales;

			var purchase_details = data.purchase;

			var credit_details = data.credit;

			$('#cus_name').html(customer.cus_name);

			$('#cus_mobile').html(customer.mobile);

			$('#cus_mail').html(customer.email);

			$('#cus_mail').html(customer.email);

			$('#cus_country').html(customer.county_name);

			$('#cus_state').html(customer.state_name);

			$('#cus_city').html(customer.city_name);

			$('#cus_address1').html(customer.address1);

			$('#cus_address2').html(customer.address2);

			$('#cus_address3').html(customer.address3);

			if (customer.cus_img != '') {

				var image = '<img  class="img-thumbnail" src="' + base_url + 'assets/img/customer/' + customer.cus_img + '/customer.jpg" width="240" height="240" >';

			} else {

				var image = '<img  class="img-thumbnail" src="' + base_url + 'assets/img/default.png" width="240" height="240" >';

			}

			$('#cus_img').html(image);

			$.each(accounts, function (key, item) {

				var url = base_url + 'index.php/admin_reports/scheme_account_report/' + item.id_scheme_account;

				accHtml += '<tr>' +

					'<td><a href=' + url + ' target="_blank">' + item.id_scheme_account + '</a></td>' +

					'<td>' + item.scheme_acc_number + '</td>' +

					'<td>' + item.account_name + '</td>' +

					'<td>' + item.scheme_name + '</td>' +

					'<td>' + item.start_date + '</td>' +

					'<td>' + item.paid_installments + '/' + item.total_installments + '</td>' +

					'<td>' + item.status + '</td>' +

					'</tr>';

			});

			$('#account_list > tbody').html(accHtml);

			$.each(sales_details, function (key, item) {

				var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + item.bill_id;

				salesHtml += '<tr>' +

					'<td><a href=' + url + ' target="_blank">' + item.bill_no + '</a></td>' +

					'<td>' + item.bill_date + '</td>' +

					'<td>' + item.gold_wt + '</td>' +

					'<td>' + item.silver_wt + '</td>' +

					'<td>' + item.mrp_amount + '</td>' +

					'<td>' + item.tot_bill_amount + '</td>' +

					'</tr>';

			});

			$('#sales_list > tbody').html(salesHtml);

			$.each(purchase_details, function (key, item) {

				var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + item.bill_id;

				purHtml += '<tr>' +

					'<td><a href=' + url + ' target="_blank">' + item.bill_no + '</a></td>' +

					'<td>' + item.bill_date + '</td>' +

					'<td>' + item.tot_pur_amt + '</td>' +

					'</tr>';

			});

			$('#purchase_list > tbody').html(purHtml);

			$.each(credit_details, function (key, item) {

				var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + item.bill_id;

				creditHtml += '<tr>' +

					'<td><a href=' + url + ' target="_blank">' + item.bill_no + '</a></td>' +

					'<td>' + item.bill_date + '</td>' +

					'<td>' + item.due_amount + '</td>' +

					'<td>' + item.credit_status + '</td>' +

					'</tr>';

			});

			$('#credit_list > tbody').html(creditHtml);

			$('.overlay').css('display', 'none');

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//Customer and Tag History

//Unbilled Estimation

function set_unbilled_estimation() {

	var dt_range = ($("#dt_range").val()).split('-');

	var company_name = $('#company_name').val();

	var from_date = dt_range[0];

	var to_date = dt_range[1];

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "Unbilled Estimation Report";

	var optional = '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/unbilled_estimation/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'dt_range': $("#dt_range").val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'id_village': $('#select_village').val(), 'id_zone': $('#select_zone').val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var oTable = $('#unbilled_est_list').DataTable();

			oTable.clear().draw();

			if (data != null && data.length > 0) {

				oTable = $('#unbilled_est_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"order": [[0, "desc"]],

					"columnDefs": [

						{

							targets: [4],

							className: 'dt-body-right'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: "",

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: "Unbilled Estimation Report",

						}

					],

					"aaData": data,

					"aoColumns": [

						{

							"mDataProp": function (row, type, val, meta) {

								var url = base_url + 'index.php/admin_ret_estimation/generate_invoice/' + row.estimation_id;

								return '<a href=' + url + ' target="_blank">' + row.esti_no + '</a>';

							}

						},

						{ "mDataProp": "est_date" },

						{ "mDataProp": "cus_name" },

						{ "mDataProp": "mobile" },

						{

							"mDataProp": function (row, type, val, meta) {

								var total_cost = row.total_cost;

								return money_format_india(total_cost);

							}

						},

						{ "mDataProp": "emp_name" },

						{

							"mDataProp": null,

							"sClass": "control center",

							"sDefaultContent": '<span class="drill-val"><i class="fa fa-chevron-circle-down text-teal"></i></span>'

						},

					],

				});

				var anOpen = [];

				$(document).on('click', "#unbilled_est_list .control", function () {

					var nTr = this.parentNode;

					var i = $.inArray(nTr, anOpen);

					if (i === -1) {

						$('.drill-val', this).html('<i class="fa fa-chevron-circle-up text-teal"></i>');

						oTable.fnOpen(nTr, fnFormatRowUnbilledEstDetails(oTable, nTr), 'details');

						anOpen.push(nTr);

					}

					else {

						$('.drill-val', this).html('<i class="fa fa-chevron-circle-down text-teal"></i>');

						oTable.fnClose(nTr);

						anOpen.splice(i, 1);

					}

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function fnFormatRowUnbilledEstDetails(oTable, nTr) {

	var oData = oTable.fnGetData(nTr);

	var rowDetail = '';

	var prodTable =

		'<div class="innerDetails">' +

		'<table class="table table-responsive table-bordered text-center table-sm">' +

		'<tr class="bg-teal">' +

		'<th>S.No</th>' +

		'<th>Tag Id</th>' +

		'<th>Product Name</th>' +

		'<th>Design Name</th>' +

		'<th>N.wt</th>' +

		'<th>Amount</th>' +

		'</tr>';

	var est_details = oData.est_details;

	$.each(est_details, function (idx, val) {

		var ref_no = val.tag_id;

		prodTable +=

			'<tr class="prod_det_btn">' +

			'<td>' + parseFloat(idx + 1) + '</td>' +

			'<td>' + val.tag_id + '</td>' +

			'<td>' + val.product_name + '</td>' +

			'<td>' + val.design_name + '</td>' +

			'<td>' + val.net_wt + '</td>' +

			'<td>' + money_format_india(val.item_cost) + '</td>' +

			'</tr>';

	});

	rowDetail = prodTable + '</table></div>';

	return rowDetail;

}

//Unbilled Estimation

//Karigar Wise Sales

function get_karigar_wise_sales() {

	var company_name = $('#company_name').val();

	var from_date = '';

	var to_date = '';

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "Karigar Wise Sales Report";

	var optional = $('#prod_select option:selected').html() != '' && $('#prod_select option:selected').html() != undefined ? $('#prod_select option:selected').html() + ' - ' : '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/karigar_wise_sales/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: { 'id_product': $('#prod_select').val() },

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var oTable = $('#karigar_wise_sales_list').DataTable();

			oTable.clear().draw();

			if (data != null && data.length > 0) {

				oTable = $('#karigar_wise_sales_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"columnDefs": [

						{

							targets: [3, 6],

							className: 'dt-body-right'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: "",

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: "Karigar Wise Sales Report",

						}

					],

					"aaData": data,

					"aoColumns": [

						{ "mDataProp": "gold_smith" },

						{ "mDataProp": "kaigar_name" },

						{

							"mDataProp": function (row, type, val, meta) {

								var total_received_pcs = row.total_received_pcs;

								return money_format_india(total_received_pcs);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var total_received_weight = row.total_received_weight;

								return money_format_india(total_received_weight);

							}

						},

						{

							"mDataProp": null,

							"sClass": "received center",

							"sDefaultContent": '<span class="drill-val"><i class="fa fa-chevron-circle-down text-teal"></i></span>'

						},

						{ "mDataProp": "total_sold_pcs" },

						{

							"mDataProp": function (row, type, val, meta) {

								var total_sold_gwt = row.total_sold_gwt;

								return money_format_india(total_sold_gwt);

							}

						},

						{

							"mDataProp": null,

							"sClass": "control center",

							"sDefaultContent": '<span class="drill-val"><i class="fa fa-chevron-circle-down text-teal"></i></span>'

						},

					],

				});

				var anOpen = [];

				$(document).on('click', "#karigar_wise_sales_list .control", function () {

					var nTr = this.parentNode;

					var i = $.inArray(nTr, anOpen);

					if (i === -1) {

						$('.drill-val', this).html('<i class="fa fa-chevron-circle-up text-teal"></i>');

						oTable.fnOpen(nTr, fnFormatRowSaleProductDetails(oTable, nTr), 'details');

						anOpen.push(nTr);

					}

					else {

						$('.drill-val', this).html('<i class="fa fa-chevron-circle-down text-teal"></i>');

						oTable.fnClose(nTr);

						anOpen.splice(i, 1);

					}

				});

				$(document).on('click', "#karigar_wise_sales_list .received", function () {

					var nTr = this.parentNode;

					var i = $.inArray(nTr, anOpen);

					if (i === -1) {

						$('.drill-val', this).html('<i class="fa fa-chevron-circle-up text-teal"></i>');

						oTable.fnOpen(nTr, fnFormatRowInwardProductDetails(oTable, nTr), 'details');

						anOpen.push(nTr);

					}

					else {

						$('.drill-val', this).html('<i class="fa fa-chevron-circle-down text-teal"></i>');

						oTable.fnClose(nTr);

						anOpen.splice(i, 1);

					}

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function fnFormatRowInwardProductDetails(oTable, nTr) {

	var oData = oTable.fnGetData(nTr);

	var rowDetail = '';

	var prodTable =

		'<div class="innerDetails">' +

		'<table class="table table-responsive table-bordered text-center table-sm">' +

		'<tr class="bg-teal">' +

		'<th>S.No</th>' +

		'<th>Product Name</th>' +

		'<th>Total Pcs</th>' +

		'<th>Total Weight</th>' +

		'</tr>';

	var lot_details = oData.lot_details;

	var total_pcs = 0;

	var total_gwt = 0;

	$.each(lot_details, function (idx, val) {

		total_pcs += parseFloat(val.tot_pcs);

		total_gwt += parseFloat(val.tot_gwt);

		prodTable +=

			'<tr class="prod_det_btn">' +

			'<td>' + parseFloat(idx + 1) + '</td>' +

			'<td>' + val.product_name + '</td>' +

			'<td>' + val.tot_pcs + '</td>' +

			'<td>' + money_format_india(val.tot_gwt) + '</td>' +

			'</tr>';

	});

	prodTable +=

		'<tr class="prod_det_btn">' +

		'<td colspan="2"><strong>Total</strong></td>' +

		'<td><strong>' + money_format_indiaparse(Float(total_pcs)) + '</td></strong>' +

		'<td><strong>' + money_format_india(parseFloat(total_gwt).toFixed(3)); +'</strong></td>' +

			'</tr>';

	rowDetail = prodTable + '</table></div>';

	return rowDetail;

}

function fnFormatRowSaleProductDetails(oTable, nTr) {

	var oData = oTable.fnGetData(nTr);

	var rowDetail = '';

	var prodTable =

		'<div class="innerDetails">' +

		'<table class="table table-responsive table-bordered text-center table-sm">' +

		'<tr class="bg-teal">' +

		'<th>S.No</th>' +

		'<th>Product Name</th>' +

		'<th>Total Pcs</th>' +

		'<th>Total Weight</th>' +

		'</tr>';

	var sales_details = oData.sales_details;

	var total_pcs = 0;

	var total_gwt = 0;

	$.each(sales_details, function (idx, val) {

		total_pcs += parseFloat(val.tot_pcs);

		total_gwt += parseFloat(val.tot_gwt);

		prodTable +=

			'<tr class="prod_det_btn">' +

			'<td>' + parseFloat(idx + 1) + '</td>' +

			'<td>' + val.product_name + '</td>' +

			'<td>' + val.tot_pcs + '</td>' +

			'<td>' + val.tot_gwt + '</td>' +

			'</tr>';

	});

	prodTable +=

		'<tr class="prod_det_btn">' +

		'<td colspan="2"><strong>Total</strong></td>' +

		'<td><strong>' + parseFloat(total_pcs) + '</td></strong>' +

		'<td><strong>' + parseFloat(total_gwt).toFixed(3); +'</strong></td>' +

			'</tr>';

	rowDetail = prodTable + '</table></div>';

	return rowDetail;

}

//Karigar Wise Sales

//Lot History

function setLotHisory() {

	var company_name = $('#company_name').val();

	var title = "<b><span style='font-size:15pt;margin-left:30%;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>" + "<span style=font-size:13pt;margin-left:25%;>&nbsp;&nbsp;Lot History Report  From&nbsp;:&nbsp;</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/lot_history/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: { 'id_product': $('#prod_select').val() },

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var oTable = $('#lot_history_list').DataTable();

			oTable.clear().draw();

			if (data != null && data.length > 0) {

				oTable = $('#lot_history_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"order": [[0, "desc"]],

					"columnDefs": [

						{

							targets: [5, 6, 7, 8],

							className: 'dt-body-right'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: "",

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						'colvis',

						{

							extend: 'excel',

							footer: true,

							title: "Karigar Wise Sales Report",

						}

					],

					"aaData": data,

					"aoColumns": [

						{

							"mDataProp": function (row, type, val, meta) {

								var url = base_url + 'index.php/admin_ret_reports/lot_history/lot_details/' + row.lot_no;

								return '<a href=' + url + ' target="_blank">' + row.lot_no + '</a>';

							}

						},

						{ "mDataProp": "category_name" },

						{ "mDataProp": "pur_ref_no" },

						{ "mDataProp": "po_date" },

						{ "mDataProp": "kaigar_name" },

						{ "mDataProp": "total_received_pcs" },

						{

							"mDataProp": function (row, type, val, meta) {

								var total_received_weight = row.total_received_weight;

								return money_format_india(total_received_weight);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var total_sold_pcs = row.total_sold_pcs;

								return money_format_india(total_sold_pcs);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var total_sold_gwt = row.total_sold_gwt;

								return money_format_india(total_sold_gwt);

							}

						},

					],

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//Lot History

function get_lot_details() {

	var company_name = $('#company_name').val();

	var title = "<b><span style='font-size:15pt;margin-left:30%;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>" + "<span style=font-size:13pt;margin-left:25%;>&nbsp;&nbsp;Lot History Report  From&nbsp;:&nbsp;</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/lot_details?nocache=" + my_Date.getUTCSeconds(),

		data: { 'lot_no': ctrl_page[3] },

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var oTable = $('#lot_detail_list').DataTable();

			oTable.clear().draw();

			if (data != null && data.length > 0) {

				oTable = $('#lot_detail_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"order": [[0, "desc"]],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: "",

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: "Karigar Wise Sales Report",

						}

					],

					"aaData": data,

					"aoColumns": [

						{ "mDataProp": "tag_id" },

						{ "mDataProp": "tag_date" },

						{ "mDataProp": "tag_code" },

						{ "mDataProp": "branch_name" },

						{ "mDataProp": "product_name" },

						{ "mDataProp": "design_name" },

						{ "mDataProp": "sub_design_name" },

						{ "mDataProp": "piece" },

						{ "mDataProp": "net_wt" },

						{

							"mDataProp": function (row, type, val, meta) {

								if (row.tag_status == 1) {

									return '<span class="badge bg-green">' + row.tag_status_name + '</span>';

								} else {

									return '<span class="badge bg-red">' + row.tag_status_name + '</span>';

								}

							}

						},

					],

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//Green Tag Report

$('#green_tag_search').click(function (event) {

	get_getGreenTagDetails();

});

function get_getGreenTagDetails() {

	var company_name = $('#company_name').val();

	var title = "<b><span style='font-size:15pt;margin-left:30%;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>" + "<span style=font-size:13pt;margin-left:25%;>&nbsp;&nbsp;Green Tag Report &nbsp;:&nbsp;</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/green_tag/ajax?nocache=" + my_Date.getUTCSeconds(),

		dataType: "JSON",

		type: "POST",

		data: { 'from_date': $('#rpt_payments1').html(), 'to_date': $('#rpt_payments2').html(), 'id_branch': $('#branch_select').val(), 'id_category': $('#category').val(), 'id_metal': $('#metal').val() },

		success: function (data) {

			var oTable = $('#green_tag_list').DataTable();

			oTable.clear().draw();

			if (data != null && data.length > 0) {

				oTable = $('#green_tag_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"order": [[0, "desc"]],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: "",

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: "Green Tag Sales Report",

						}

					],

					"aaData": data,

					"aoColumns": [

						{

							"mDataProp": function (row, type, val, meta) {

								var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + row.bill_id;

								return '<a href=' + url + ' target="_blank">' + row.bill_no + '</a>';

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var url = base_url + 'index.php/admin_ret_estimation/generate_invoice/' + row.estimation_id;

								return '<a href=' + url + ' target="_blank">' + row.esti_no + '</a>';

							}

						},

						{ "mDataProp": "bill_date" },

						{ "mDataProp": "tag_date" },

						{ "mDataProp": "tag_code" },

						{ "mDataProp": "gross_wt" },

						{ "mDataProp": "net_wt" },

						{

							"mDataProp": function (row, type, val, meta) {

								if (row.id_metal == 1) {

									return parseFloat(row.net_wt * $('#emp_sales_incentive_gold_perg').val()).toFixed(2);

								} else {

									return parseFloat(row.net_wt * $('#emp_sales_incentive_silver_perg').val()).toFixed(2);

								}

							}

						},

						{ "mDataProp": "product_name" },

						{ "mDataProp": "item_cost" },

						{ "mDataProp": "emp_name" },

						{ "mDataProp": "emp_code" },

					],

					"footerCallback": function (row, data, start, end, display) {

						var cshtotal = 0;

						if (data.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								gross_wgt = api

									.column(6)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(6).footer()).html(parseFloat(gross_wgt).toFixed(2));

								net_wgt = api

									.column(7)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(7).footer()).html(parseFloat(net_wgt).toFixed(2));

								amount = api

									.column(5)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(5).footer()).html(parseFloat(amount).toFixed(2));

							}

						} else {

							var api = this.api(), data;

							$(api.column(6).footer()).html('');

							$(api.column(7).footer()).html('');

							$(api.column(8).footer()).html('');

						}

					}

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//Green Tag Report

//Sales Comparision

function get_sales_comparision() {

	const monthNames = ["", "Jan", "Feb", "Mar", "Apr", "May", "Jun",

		"Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];

	var chart_details = getMonthlySalesDetails();

	var line = new Morris.Line

		({

			element: 'sales_chart',

			data: chart_details.pro_details,

			xkey: 'x',

			parseTime: false,

			ykeys: ['y'],

			xLabelFormat: function (x) {

				console.log(x);

				var index = parseInt(x.src.x);

				return monthNames[index];

			},

			xLabels: "month",

			labels: ['Weight'],

			lineColors: ['#a0d0e0', '#3dbeee'],

			hideHover: 'auto'

		});

	Morris.Donut({

		element: 'metal_chart',

		data: chart_details.metal_details,

		series: {

			pie: {

				show: false,

				radius: 1,

				innerRadius: 0.5,

				resize: false,

				label: {

					show: false,

					radius: 2 / 3,

					formatter: labelFormatter,

					threshold: 0.1

				}

			}

		},

		legend: {

			show: false

		}

	});

}

function labelFormatter(label, series) {

	return '<div style="font-size:13px; text-align:center; padding:2px; color: #fff; font-weight: 600;">'

		+ label

		+ '<br>'

		+ Math.round(series.percent) + '%</div>'

}

function getMonthlySalesDetails() {

	my_Date = new Date();

	var data = "";

	$.ajax({

		type: 'POST',

		url: base_url + "index.php/admin_ret_reports/sales_comparision/ajax?nocache=" + my_Date.getUTCSeconds(),

		dataType: 'json',

		async: false,

		data: { 'id_product': $('#prod_select').val() },

		success: function (result) {

			data = result;

		},

		error: function (xhr, status, error) {

			console.log(error);

		}

	});

	return data;

}

//Sales Comparision

//Approval Pending

function getApprovalPending() {

	var company_name = $('#company_name').val();

	var title = "<b><span style='font-size:15pt;margin-left:30%;'>" + company_name + "</span>-</b><b><span style='font-size:12pt;'></span></b>" + "<span style=font-size:13pt;>&nbsp;&nbsp;Intransit Report &nbsp;&nbsp;</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/branch_trans/intransit?nocache=" + my_Date.getUTCSeconds(),

		dataType: "JSON",

		type: "POST",

		data: { 'id_branch': ctrl_page[3] },

		success: function (data) {

			var oTable = $('#approval_pending').DataTable();

			oTable.clear().draw();

			if (data != null && data.length > 0) {

				oTable = $('#approval_pending').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"order": [[0, "desc"]],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: "",

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: "Intransit Report",

						}

					],

					"aaData": data,

					"aoColumns": [

						{ "mDataProp": "branch_trans_code" },

						{ "mDataProp": "created_time" },

						{ "mDataProp": "from_branch" },

						{ "mDataProp": "to_branch" },

						{ "mDataProp": "transfer_item_type" },

						{ "mDataProp": "product" },

						{ "mDataProp": "pieces" },

						{ "mDataProp": "grs_wt" },

						{ "mDataProp": "net_wt" },

					],

					"footerCallback": function (row, data, start, end, display) {

						var cshtotal = 0;

						if (data.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								pieces = api

									.column(6)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(6).footer()).html(parseFloat(pieces).toFixed(2));

								gross_wgt = api

									.column(7)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(7).footer()).html(parseFloat(gross_wgt).toFixed(2));

								net_wgt = api

									.column(8)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(8).footer()).html(parseFloat(net_wgt).toFixed(2));

							}

						} else {

							var api = this.api(), data;

							$(api.column(6).footer()).html('');

							$(api.column(7).footer()).html('');

							$(api.column(8).footer()).html('');

						}

					}

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//Approval Pending

//Credit Pending

function set_credit_pending_list_14_02_2024() {

	var company_name = $('#company_name').val();

	var from_date = $('#rpt_from_date').html();

	var to_date = $('#rpt_to_date').html();

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "Credit Pending Report";

	var optional = '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/credit_pending/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'id_customer': $('#select_customer').val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'from_date': $('#rpt_from_date').html(), 'to_date': $('#rpt_to_date').html() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			var oTable = $('#credit_issued_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#credit_issued_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"columnDefs": [

						{

							targets: [5, 6, 7, 8, 9],

							className: 'dt-body-right'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', '10px');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: "Credit Pending Report",

						}

					],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "branch_name" },

						{ "mDataProp": "cus_name" },

						{ "mDataProp": "mobile" },

						{

							"mDataProp": function (row, type, val, meta) {

								if (row.type == 0) {

									var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + row.bill_id;

								} else {

									var url = base_url + 'index.php/admin_ret_billing/issue/issue_print/' + row.bill_id;

								}

								return '<a href=' + url + ' target="_blank">' + row.bill_no + '</a>';

							}

						},

						{ "mDataProp": "bill_date" },

						{

							"mDataProp": function (row, type, val, meta) {

								var tot_bill_amount = row.tot_bill_amount;

								return money_format_india(tot_bill_amount);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var due_amount = row.due_amount;

								return money_format_india(due_amount);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var paid_amount = row.paid_amount;

								return money_format_india(paid_amount);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var credit_ret_amt = row.credit_ret_amt;

								return money_format_india(credit_ret_amt);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var bal_amt = row.bal_amt;

								return money_format_india(bal_amt);

							}

						},

						{

							"mDataProp": null,

							"sClass": "control center",

							"sDefaultContent": '<span class="drill-val"><i class="fa fa-chevron-circle-down text-teal"></i></span>'

						},

					],

					"footerCallback": function (row, data, start, end, display) {

						var cshtotal = 0;

						if (list.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								total_bill_amount = api

									.column(5, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(5).footer()).html(money_format_india(parseFloat(total_bill_amount).toFixed(2)));

								total_due_amount = api

									.column(6, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(6).footer()).html(money_format_india(parseFloat(total_due_amount).toFixed(2)));

								total_paid_amount = api

									.column(7, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(7).footer()).html(money_format_india(parseFloat(total_paid_amount).toFixed(2)));

								total_return_amount = api

									.column(8, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(8).footer()).html(money_format_india(parseFloat(total_return_amount).toFixed(2)));

								total_amount = api

									.column(9, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(9).footer()).html(money_format_india(parseFloat(total_amount).toFixed(2)));

							}

						}

						else {

							var api = this.api(), data;

							$(api.column(7).footer()).html('');

						}

					}

				});

				var anOpen = [];

				$(document).on('click', "#credit_issued_list .control", function () {

					var nTr = this.parentNode;

					var i = $.inArray(nTr, anOpen);

					if (i === -1) {

						$('.drill-val', this).html('<i class="fa fa-chevron-circle-up text-teal"></i>');

						oTable.fnOpen(nTr, fnFormatRowCreditDetails(oTable, nTr), 'details');

						anOpen.push(nTr);

					}

					else {

						$('.drill-val', this).html('<i class="fa fa-chevron-circle-down text-teal"></i>');

						oTable.fnClose(nTr);

						anOpen.splice(i, 1);

					}

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function fnFormatRowCreditDetails_14_02_2024(oTable, nTr) {

	var oData = oTable.fnGetData(nTr);

	var rowDetail = '';

	var prodTable =

		'<div class="innerDetails">' +

		'<table class="table table-responsive table-bordered text-center table-sm">' +

		'<tr class="bg-teal">' +

		'<th>S.No</th>' +

		'<th>Bill No</th>' +

		'<th>Bill Date</th>' +

		'<th>Bill Amount</th>' +

		'<th>Discount Amount</th>' +

		'<th>Purchase Amount</th>' +

		'</tr>';

	var credit_collection = oData.credit_collection;

	$.each(credit_collection, function (idx, val) {

		var ref_no = val.tag_id + '_' + oData.product_id;

		if (val.type == 0) {

			var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + val.bill_id;

		}

		else if (val.type == 1) {

			var url = base_url + 'index.php/admin_ret_billing/receipt/receipt_print/' + val.bill_id;

		}

		prodTable +=

			'<tr class="prod_det_btn">' +

			'<td>' + parseFloat(idx + 1) + '</td>' +

			'<td><a href=' + url + ' target="_blank">' + val.bill_no + '</a></td>' +

			'<td>' + val.bill_date + '</td>' +

			'<td>' + money_format_india(val.tot_amt_received) + '</td>' +

			'<td>' + money_format_india(val.credit_disc_amt) + '</td>' +

			'<td>' + money_format_india(val.old_metal_amount) + '</td>' +

			'</tr>';

	});

	rowDetail = prodTable + '</table></div>';

	return rowDetail;

}

function set_credit_pending_list_01_03_2024() {

	var company_name = $('#company_name').val();

	// var from_date = $('#rpt_from_date').html();

	// var to_date = $('#rpt_to_date').html();

	from_date = to_date = "";

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "Credit Pending Report";

	var optional = '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/credit_pending/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'credit_reference': $('#select_influencer').val(), 'id_customer': $('#select_customer').val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'from_date': $('#rpt_from_date').html(), 'to_date': $('#rpt_to_date').html(), 'filter_type': $('#filter_type').val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			var oTable = $('#credit_issued_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#credit_issued_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"columnDefs": [

						{

							targets: [5, 6, 7, 8, 9, 10, 11],

							className: 'dt-body-right'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', '10px');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: "Credit Pending Report",

						}

					],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "branch_name" },

						{ "mDataProp": "cus_name" },

						{ "mDataProp": "mobile" },

						{

							"mDataProp": function (row, type, val, meta) {

								if (row.type == 0) {

									var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + row.bill_id;

								} else {

									var url = base_url + 'index.php/admin_ret_billing/issue/issue_print/' + row.bill_id;

								}

								return '<a href=' + url + ' target="_blank">' + row.bill_no + '</a>';

							}

						},

						{ "mDataProp": "bill_date" },

						{

							"mDataProp": function (row, type, val, meta) {

								var tot_bill_amount = row.tot_bill_amount;

								return money_format_india(tot_bill_amount);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var due_amount = row.due_amount;

								return money_format_india(parseFloat(due_amount).toFixed(2));

							}

						},

						{ "mDataProp": "credit_due_date" },

						{

							"mDataProp": function (row) {

								if (row.no_of_days != '') {

									if (row.no_of_days > 0) {

										return row.no_of_days;

									} else {

										return '<span style="color:red">' + row.no_of_days + '</span>';

									}

								} else {

									return '-';

								}

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var paid_amount = row.paid_amount;

								return money_format_india(parseFloat(paid_amount).toFixed(2));

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var credit_ret_amt = row.credit_ret_amt;

								return money_format_india(parseFloat(credit_ret_amt).toFixed(2));

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var bal_amt = row.bal_amt;

								return money_format_india(parseFloat(bal_amt).toFixed(2));

							}

						},

						{

							"mDataProp": null,

							"sClass": "control center",

							"sDefaultContent": '<span class="drill-val"><i class="fa fa-chevron-circle-down text-teal"></i></span>'

						},

					],

					"footerCallback": function (row, data, start, end, display) {

						var cshtotal = 0;

						if (list.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								total_bill_amount = api

									.column(5, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(5).footer()).html(money_format_india(parseFloat(total_bill_amount).toFixed(2)));

								total_due_amount = api

									.column(6, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(6).footer()).html(money_format_india(parseFloat(total_due_amount).toFixed(2)));

								total_paid_amount = api

									.column(9, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(9).footer()).html(money_format_india(parseFloat(total_paid_amount).toFixed(2)));

								total_return_amount = api

									.column(10, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(10).footer()).html(money_format_india(parseFloat(total_return_amount).toFixed(2)));

								total_amount = api

									.column(11, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(11).footer()).html(money_format_india(parseFloat(total_amount).toFixed(2)));

							}

						}

						else {

							var api = this.api(), data;

							$(api.column(7).footer()).html('');

						}

					}

				});

				var anOpen = [];

				$(document).on('click', "#credit_issued_list .control", function () {

					var nTr = this.parentNode;

					var i = $.inArray(nTr, anOpen);

					if (i === -1) {

						$('.drill-val', this).html('<i class="fa fa-chevron-circle-up text-teal"></i>');

						oTable.fnOpen(nTr, fnFormatRowCreditDetails(oTable, nTr), 'details');

						anOpen.push(nTr);

					}

					else {

						$('.drill-val', this).html('<i class="fa fa-chevron-circle-down text-teal"></i>');

						oTable.fnClose(nTr);

						anOpen.splice(i, 1);

					}

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function fnFormatRowCreditDetails(oTable, nTr) {

	var oData = oTable.fnGetData(nTr);

	var rowDetail = '';

	var prodTable =

		'<div class="innerDetails">' +

		'<table class="table table-responsive table-bordered text-center table-sm">' +

		'<tr class="bg-teal">' +

		'<th>S.No</th>' +

		'<th>Bill No</th>' +

		'<th>Bill Date</th>' +

		'<th>Bill Amount</th>' +

		'<th>Discount Amount</th>' +

		'<th>Purchase Amount</th>' +

		'</tr>';

	var credit_collection = oData.credit_collection;

	$.each(credit_collection, function (idx, val) {

		var ref_no = val.tag_id + '_' + oData.product_id;

		if (val.type == 0) {

			var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + val.bill_id;

		}

		else if (val.type == 1) {

			var url = base_url + 'index.php/admin_ret_billing/receipt/receipt_print/' + val.bill_id;

		}

		prodTable +=

			'<tr class="prod_det_btn">' +

			'<td>' + parseFloat(idx + 1) + '</td>' +

			'<td><a href=' + url + ' target="_blank">' + val.bill_no + '</a></td>' +

			'<td>' + val.bill_date + '</td>' +

			'<td>' + val.tot_amt_received + '</td>' +

			'<td>' + val.credit_disc_amt + '</td>' +

			'<td>' + val.old_metal_amount + '</td>' +

			'</tr>';

	});

	rowDetail = prodTable + '</table></div>';

	return rowDetail;

}

//Credit Pending

//Stock and Sales

function set_stock_and_sales_list() {

	var dt_range = ($("#dt_range").val()).split('-');

	var company_name = $('#company_name').val();

	var from_date = dt_range[0];

	var to_date = dt_range[1];

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "STOCK AND SALES";

	var optional = '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/stock_and_sales_report/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'dt_range': $("#dt_range").val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()) }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			$("#stock_details > tbody > tr").remove();

			$('#stock_details').dataTable().fnClearTable();

			$('#stock_details').dataTable().fnDestroy();

			var trHtml = '';

			var branch_inw_details = data.list.branch_inw_details;

			var branch_out_details = data.list.branch_out_details;

			var lot_details = data.list.lot_details;

			var other_issue_details = data.list.other_issue_details;

			var sales_details = data.list.sales_details;

			if (lot_details.length > 0) {

				$.each(lot_details, function (key, lot) {

					branch_summary_url = base_url + 'index.php/admin_ret_lot/branch_acknowladgement/1/' + lot.tag_lot_id + '/' + lot.current_branch;

					trHtml += '<tr>'

						+ '<td><a href=' + branch_summary_url + ' target="_blank">' + lot.tag_lot_id + '</a></td>'

						+ '<td>' + lot.inw_date + '</td>'

						+ '<td>' + lot.product_name + '</td>'

						+ '<td>' + lot.tot_pcs + '</td>'

						+ '<td>' + lot.branch_name + '</td>'

						+ '</tr>';

				});

			}

			if (branch_inw_details.length > 0) {

				trHtml += '<tr>'

					+ '<td><strong>BRANCH INWARD<strong></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '</tr>';

				trHtml += '<tr>'

					+ '<td><strong>BT Code<strong></td>'

					+ '<td><strong>From Branch<strong></td>'

					+ '<td><strong>To Branch<strong></td>'

					+ '<td><strong>Pcs<strong></td>'

					+ '<td><strong>Status<strong></td>'

					+ '</tr>';

				$.each(branch_inw_details, function (k, inw) {

					summary_url = base_url + 'index.php/admin_ret_brntransfer/branch_transfer/print/' + inw.branch_trans_code + '/' + inw.transfer_item_type + '/' + 1;

					trHtml += '<tr>'

						+ '<td><a href=' + summary_url + ' target="_blank">' + inw.branch_transfer_id + '</a></td>'

						+ '<td>' + inw.from_branch + '</td>'

						+ '<td>' + inw.to_branch + '</td>'

						+ '<td>' + inw.pieces + '</td>'

						+ '<td>' + inw.bt_status + '</td>'

						+ '</tr>';

				});

			}

			if (other_issue_details.length > 0) {

				trHtml += '<tr>'

					+ '<td><strong>OTHER ISSUE<strong></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '</tr>';

				trHtml += '<tr>'

					+ '<td><strong>BT Code<strong></td>'

					+ '<td><strong>From Branch<strong></td>'

					+ '<td><strong>To Branch<strong></td>'

					+ '<td><strong>Pcs<strong></td>'

					+ '<td><strong>Status<strong></td>'

					+ '</tr>';

				$.each(other_issue_details, function (k, out) {

					summary_url = base_url + 'index.php/admin_ret_brntransfer/branch_transfer/print/' + out.branch_trans_code + '/' + out.transfer_item_type + '/' + 1;

					trHtml += '<tr>'

						+ '<td><a href=' + summary_url + ' target="_blank">' + out.branch_transfer_id + '</a></td>'

						+ '<td>' + out.from_branch + '</td>'

						+ '<td>' + out.to_branch + '</td>'

						+ '<td>' + out.pieces + '</td>'

						+ '<td>' + out.bt_status + '</td>'

						+ '</tr>';

				});

			}

			if (branch_out_details.length > 0) {

				trHtml += '<tr>'

					+ '<td><strong>BRANCH OUTWARD<strong></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '</tr>';

				trHtml += '<tr>'

					+ '<td><strong>BT Code<strong></td>'

					+ '<td><strong>From Branch<strong></td>'

					+ '<td><strong>To Branch<strong></td>'

					+ '<td><strong>Pcs<strong></td>'

					+ '<td><strong>Status<strong></td>'

					+ '</tr>';

				$.each(branch_out_details, function (k, out) {

					summary_url = base_url + 'index.php/admin_ret_brntransfer/branch_transfer/print/' + out.branch_trans_code + '/' + out.transfer_item_type + '/' + 1;

					trHtml += '<tr>'

						+ '<td><a href=' + summary_url + ' target="_blank">' + out.branch_transfer_id + '</a></td>'

						+ '<td>' + out.from_branch + '</td>'

						+ '<td>' + out.to_branch + '</td>'

						+ '<td>' + out.pieces + '</td>'

						+ '<td>' + out.bt_status + '</td>'

						+ '</tr>';

				});

			}

			/*   if(sales_details.length>0)

			   {

				   trHtml+='<tr>'

							   +'<td colspan="5"><strong>SALES DETAILS<strong></td>'

						   +'</tr>';

					trHtml+='<tr>'

					   +'<td><strong>S.No<strong></td>'

					   +'<td><strong>Product Name<strong></td>'

					   +'<td><strong>Weight<strong></td>'

					   +'<td><strong>Pcs<strong></td>'

					   +'<td><strong>Amount<strong></td>'

				   +'</tr>';

				   var i=1;

				   var total_sales_amt=0;

				   var total_sales_wt=0;

				   var total_sales_pcs=0;

				   $.each(sales_details,function(k,s){

					   total_sales_amt+=parseFloat(s.sale_amt);

					   total_sales_wt+=parseFloat(s.tot_sale_wt);

					   total_sales_pcs+=parseFloat(s.tot_pcs);

					   trHtml+='<tr>'

							   +'<td>'+i+'</td>'

							   +'<td>'+s.product_name+'</td>'

							   +'<td>'+s.tot_sale_wt+'</td>'

							   +'<td>'+s.tot_pcs+'</td>'

							   +'<td>'+s.sale_amt+'</td>'

						   +'</tr>';

						   i++;

				   });

					trHtml+='<tr>'

					   +'<td colspan="1"><strong>TOTAL<strong></td>'

					   +'<td><strong><strong></td>'

					   +'<td><strong>'+parseFloat(total_sales_wt).toFixed(3)+'<strong></td>'

					   +'<td><strong>'+parseFloat(total_sales_pcs).toFixed(3)+'<strong></td>'

					   +'<td><strong>'+parseFloat(total_sales_amt).toFixed(2)+'<strong></td>'

				   +'</tr>';

			   }*/

			$('#stock_details > tbody').html(trHtml);

			// Check and initialise datatable

			if (!$.fn.DataTable.isDataTable('#stock_details')) {

				oTable = $('#stock_details').dataTable({

					"bSort": false,

					"bInfo": true,

					"scrollX": '100%',

					"dom": 'lBfrtip',

					"lengthMenu": [[-1, 25, 50, 100, 250], ["All", 25, 50, 100, 250]],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', '10px');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: 'STOCK AND SALES',

						}

					],

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//Stock and Sales

//Incentive

function set_incentive_report() {

	var company_name = $('#company_name').val();

	var title = "<b><span style='font-size:15pt;margin-left:30%;'>" + company_name + "</span>-</b><b><span style='font-size:12pt;'></span></b>" + "<span style=font-size:13pt;>&nbsp;&nbsp;Incentive Report &nbsp;&nbsp;</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/incentive_report/ajax?nocache=" + my_Date.getUTCSeconds(),

		dataType: "JSON",

		type: "POST",

		data: { 'from_date': $('#rpt_payments1').html(), 'to_date': $('#rpt_payments2').html() },

		success: function (data) {

			var list = data.list;

			var oTable = $('#incentive_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#incentive_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"order": [[0, "desc"]],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: "",

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: "Incentive Report",

						}

					],

					"aaData": list,

					"aoColumns": [

						{

							"mDataProp": function (row, type, val, meta) {

								chekbox = '<input type="checkbox" class="id_wallet_account" name="id_wallet_account[]" value="' + row.id_wallet_account + '"/>' + row.id_wallet_account;

								return chekbox;

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var url = base_url + 'index.php/admin_ret_reports/incentive_report/emp_list/' + row.id_wallet_account;

								return '<a href=' + url + ' target="_blank">' + row.wallet_acc_number + '</a>';

							}

						},

						{ "mDataProp": "emp_name" },

						{ "mDataProp": "branch_name" },

						{ "mDataProp": "mobile" },

						{ "mDataProp": "total_value" },

						{

							"mDataProp": function (row, type, val, meta) {

								return '<input type="text" class="form-control debit_amount" value="' + row.total_value + '" placeholder="Enter Debit Amount"><input type="hidden" class="form-control act_wallet_amt" value="' + row.total_value + '">';

							}

						},

					],

					"footerCallback": function (row, data, start, end, display) {

						var cshtotal = 0;

						if (data.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								total_value = api

									.column(5)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(5).footer()).html(parseFloat(total_value).toFixed(2));

							}

						} else {

							var api = this.api(), data;

							$(api.column(2).footer()).html('');

						}

					}

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

$(document).on('keyup', '.debit_amount', function () {

	var row = $(this).closest('tr');

	var act_wallet_amt = row.find('.act_wallet_amt').val();

	if (parseFloat(act_wallet_amt) < parseFloat(this.value)) {

		$(this).val(act_wallet_amt);

		$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + 'Exceed Amount Limit..' });

		row.find("td:first input:checkbox").prop("checked", false);

	} else {

		row.find("td:first input:checkbox").prop("checked", true);

	}

});

$('#incentive_pay').on('click', function () {

	if ($("input[name='id_wallet_account[]']:checked").val()) {

		$('#incentive_pay').prop('disabled', true);

		var selected = [];

		$("#incentive_list tbody tr").each(function (index, value) {

			if ($(value).find("input[name='id_wallet_account[]']:checked").is(":checked")) {

				transData = {

					'id_wallet_account': $(value).find(".id_wallet_account").val(),

					'debit_amount': $(value).find(".debit_amount").val(),

				}

				selected.push(transData);

			}

		})

		req_data = selected;

		debit_payment(req_data);

	}

	else {

		$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + 'Please Select Account..' });

		$('#incentive_pay').prop('disabled', false);

	}

});

function debit_payment(req_data) {

	my_Date = new Date();

	$("div.overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/debit_payment?nocache=" + my_Date.getUTCSeconds() + '' + my_Date.getUTCMinutes() + '' + my_Date.getUTCHours(),

		data: { 'req_data': req_data },

		type: "POST",

		dataType: "JSON",

		async: false,

		success: function (data) {

			if (data.status) {

				$.toaster({ priority: 'success', title: 'Warning!', message: '' + "</br>" + data.message });

			} else {

				$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + data.message });

			}

			location.reload();

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			console.log(error);

			$("div.overlay").css("display", "none");

		}

	});

}

function set_incentive_emp_list() {

	var company_name = $('#company_name').val();

	var title = "<b><span style='font-size:15pt;margin-left:30%;'>" + company_name + "</span>-</b><b><span style='font-size:12pt;'></span></b>" + "<span style=font-size:13pt;>&nbsp;&nbsp;Incentive Report &nbsp;&nbsp;</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/incentive_report/emp_report/?nocache=" + my_Date.getUTCSeconds(),

		dataType: "JSON",

		type: "POST",

		data: { 'id_wallet_account': ctrl_page[3] },

		success: function (data) {

			var list = data;

			var oTable = $('#emp_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#emp_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"order": [[0, "desc"]],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: "",

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: "Incentive Report",

						}

					],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "id_wallet_transaction" },

						{ "mDataProp": "date_transaction" },

						{

							"mDataProp": function (row, type, val, meta) {

								if (row.type == 1) {

									var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + row.bill_id;

									return '<a href=' + url + ' target="_blank">' + row.bill_no + '</a>';

								} else {

									var url = base_url + 'index.php/reports/payment/account/' + row.id_sch_ac;

									return '<a href=' + url + ' target="_blank">' + row.id_sch_ac + '</a>';

								}

							},

						},

						{

							"mDataProp": function (row, type, val, meta) {

								return '<span class="badge bg-' + row.color + '">' + row.transaction_type + '</span>';

							}

						},

						{ "mDataProp": "tag_code" },

						{ "mDataProp": "product_name" },

						{ "mDataProp": "value" },

						{ "mDataProp": "description" },

					],

					"footerCallback": function (row, data, start, end, display) {

						var cshtotal = 0;

						if (list.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								total_value = api

									.column(6)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(6).footer()).html(parseFloat(total_value).toFixed(2));

							}

						} else {

							var api = this.api(), data;

							$(api.column(2).footer()).html('');

						}

					}

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//Incentive

//Month on month sales report

function monthly_slaes_comparision() {

	var company_name = $('#company_name').val();

	var from_date = '';

	var to_date = '';

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "Monthly Comparision Report";

	var optional = $('#select_village option:selected').html() != '' && $('#select_village option:selected').html() != undefined ? $('#select_village option:selected').html() + ' - ' : '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/monthly_slaes_comparision/ajax?nocache=" + my_Date.getUTCSeconds(),

		type: "POST",

		data: { 'year': $('#cur_year').val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'id_village': $('#select_village').val() },

		dataType: "JSON",

		cache: false,

		success: function (data) {

			var list = data.list;

			$("#sales_comparision > tbody > tr").remove();

			$('#sales_comparision').dataTable().fnClearTable();

			$('#sales_comparision').dataTable().fnDestroy();

			var trHTML = '';

			var J_grand_total_gold_wt = 0;

			var J_grand_total_silver_wt = 0;

			var J_grand_total_fixed_amt = 0;

			var F_grand_total_gold_wt = 0;

			var F_grand_total_silver_wt = 0;

			var F_grand_total_fixed_amt = 0;

			var M_grand_total_gold_wt = 0;

			var M_grand_total_silver_wt = 0;

			var M_grand_total_fixed_amt = 0;

			var A_grand_total_gold_wt = 0;

			var A_grand_total_silver_wt = 0;

			var A_grand_total_fixed_amt = 0;

			var may_grand_total_gold_wt = 0;

			var may_grand_total_silver_wt = 0;

			var may_grand_total_fixed_amt = 0;

			var june_grand_total_gold_wt = 0;

			var june_grand_total_silver_wt = 0;

			var june_grand_total_fixed_amt = 0;

			var july_grand_total_gold_wt = 0;

			var july_grand_total_silver_wt = 0;

			var july_grand_total_fixed_amt = 0;

			var aug_grand_total_gold_wt = 0;

			var aug_grand_total_silver_wt = 0;

			var aug_grand_total_fixed_amt = 0;

			var sep_grand_total_gold_wt = 0;

			var sep_grand_total_silver_wt = 0;

			var sep_grand_total_fixed_amt = 0;

			var oct_grand_total_gold_wt = 0;

			var oct_grand_total_silver_wt = 0;

			var oct_grand_total_fixed_amt = 0;

			var nov_grand_total_gold_wt = 0;

			var nov_grand_total_silver_wt = 0;

			var nov_grand_total_fixed_amt = 0;

			var dec_grand_total_gold_wt = 0;

			var dec_grand_total_silver_wt = 0;

			var dec_grand_total_fixed_amt = 0;

			$.each(list, function (village, branch) {

				var id_branch = '';

				var id_village = '';

				var J_total_gold_wt = 0;

				var J_total_silver_wt = 0;

				var J_total_fixed_amt = 0;

				var F_total_gold_wt = 0;

				var F_total_silver_wt = 0;

				var F_total_fixed_amt = 0;

				var M_total_gold_wt = 0;

				var M_total_silver_wt = 0;

				var M_total_fixed_amt = 0;

				var A_total_gold_wt = 0;

				var A_total_silver_wt = 0;

				var A_total_fixed_amt = 0;

				var may_total_gold_wt = 0;

				var may_total_silver_wt = 0;

				var may_total_fixed_amt = 0;

				var june_total_gold_wt = 0;

				var june_total_silver_wt = 0;

				var june_total_fixed_amt = 0;

				var july_total_gold_wt = 0;

				var july_total_silver_wt = 0;

				var july_total_fixed_amt = 0;

				var aug_total_gold_wt = 0;

				var aug_total_silver_wt = 0;

				var aug_total_fixed_amt = 0;

				var sep_total_gold_wt = 0;

				var sep_total_silver_wt = 0;

				var sep_total_fixed_amt = 0;

				var oct_total_gold_wt = 0;

				var oct_total_silver_wt = 0;

				var oct_total_fixed_amt = 0;

				var nov_total_gold_wt = 0;

				var nov_total_silver_wt = 0;

				var nov_total_fixed_amt = 0;

				var dec_total_gold_wt = 0;

				var dec_total_silver_wt = 0;

				var dec_total_fixed_amt = 0;

				$.each(branch, function (branches, months) {

					var J_gold_wt = 0;

					var J_silver_wt = 0;

					var J_fixed_amt = 0;

					var F_gold_wt = 0;

					var F_silver_wt = 0;

					var F_fixed_amt = 0;

					var M_gold_wt = 0;

					var M_silver_wt = 0;

					var M_fixed_amt = 0;

					var A_gold_wt = 0;

					var A_silver_wt = 0;

					var A_fixed_amt = 0;

					var may_gold_wt = 0;

					var may_silver_wt = 0;

					var may_fixed_amt = 0;

					var june_gold_wt = 0;

					var june_silver_wt = 0;

					var june_fixed_amt = 0;

					var july_gold_wt = 0;

					var july_silver_wt = 0;

					var july_fixed_amt = 0;

					var aug_gold_wt = 0;

					var aug_silver_wt = 0;

					var aug_fixed_amt = 0;

					var sep_gold_wt = 0;

					var sep_silver_wt = 0;

					var sep_fixed_amt = 0;

					var oct_gold_wt = 0;

					var oct_silver_wt = 0;

					var oct_fixed_amt = 0;

					var nov_gold_wt = 0;

					var nov_silver_wt = 0;

					var nov_fixed_amt = 0;

					var dec_gold_wt = 0;

					var dec_silver_wt = 0;

					var dec_fixed_amt = 0;

					$.each(months, function (month, items) {

						id_branch = items[0].id_branch;

						id_village = items[0].id_village;

						if (month == 'January') {

							$.each(items, function (key, item) {

								if (item.metal == 'GOLD') {

									J_gold_wt += parseFloat(item.total_net_wt);

								}

								if (item.metal == 'SILVER') {

									J_silver_wt += parseFloat(item.total_net_wt);

								}

								J_fixed_amt += parseFloat(item.tot_fixed_amt);

							});

						}

						if (month == 'February') {

							$.each(items, function (key, item) {

								F_fixed_amt += parseFloat(item.tot_fixed_amt);

								if (item.metal == 'GOLD') {

									F_gold_wt += parseFloat(item.total_net_wt);

								}

								if (item.metal == 'SILVER') {

									F_silver_wt += parseFloat(item.total_net_wt);

								}

							});

						}

						if (month == 'March') {

							$.each(items, function (key, item) {

								M_fixed_amt += parseFloat(item.tot_fixed_amt);

								if (item.metal == 'GOLD') {

									M_gold_wt += parseFloat(item.total_net_wt);

								}

								if (item.metal == 'SILVER') {

									M_silver_wt += parseFloat(item.total_net_wt);

								}

							});

						}

						if (month == 'April') {

							$.each(items, function (key, item) {

								A_fixed_amt += parseFloat(item.tot_fixed_amt);

								if (item.metal == 'GOLD') {

									A_gold_wt += parseFloat(item.total_net_wt);

								}

								if (item.metal == 'SILVER') {

									A_silver_wt += parseFloat(item.total_net_wt);

								}

							});

						}

						if (month == 'May') {

							$.each(items, function (key, item) {

								may_fixed_amt += parseFloat(item.tot_fixed_amt);

								if (item.metal == 'GOLD') {

									may_gold_wt += parseFloat(item.total_net_wt);

								}

								if (item.metal == 'SILVER') {

									may_silver_wt += parseFloat(item.total_net_wt);

								}

							});

						}

						if (month == 'June') {

							$.each(items, function (key, item) {

								june_fixed_amt += parseFloat(item.tot_fixed_amt);

								if (item.metal == 'GOLD') {

									june_gold_wt += parseFloat(item.total_net_wt);

								}

								if (item.metal == 'SILVER') {

									june_silver_wt += parseFloat(item.total_net_wt);

								}

							});

						}

						if (month == 'July') {

							$.each(items, function (key, item) {

								july_fixed_amt += parseFloat(item.tot_fixed_amt);

								if (item.metal == 'GOLD') {

									july_gold_wt += parseFloat(item.total_net_wt);

								}

								if (item.metal == 'SILVER') {

									july_silver_wt += parseFloat(item.total_net_wt);

								}

							});

						}

						if (month == 'August') {

							$.each(items, function (key, item) {

								aug_fixed_amt += parseFloat(item.tot_fixed_amt);

								if (item.metal == 'GOLD') {

									aug_gold_wt += parseFloat(item.total_net_wt);

								}

								if (item.metal == 'SILVER') {

									aug_silver_wt += parseFloat(item.total_net_wt);

								}

							});

						}

						if (month == 'September') {

							$.each(items, function (key, item) {

								sep_fixed_amt += parseFloat(item.tot_fixed_amt);

								if (item.metal == 'GOLD') {

									sep_gold_wt += parseFloat(item.total_net_wt);

								}

								if (item.metal == 'SILVER') {

									sep_silver_wt += parseFloat(item.total_net_wt);

								}

							});

						}

						if (month == 'October') {

							$.each(items, function (key, item) {

								oct_fixed_amt += parseFloat(item.tot_fixed_amt);

								if (item.metal == 'GOLD') {

									oct_gold_wt += parseFloat(item.total_net_wt);

								}

								if (item.metal == 'SILVER') {

									oct_silver_wt += parseFloat(item.total_net_wt);

								}

							});

						}

						if (month == 'November') {

							$.each(items, function (key, item) {

								nov_fixed_amt += parseFloat(item.tot_fixed_amt);

								if (item.metal == 'GOLD') {

									nov_gold_wt += parseFloat(item.total_net_wt);

								}

								if (item.metal == 'SILVER') {

									nov_silver_wt += parseFloat(item.total_net_wt);

								}

							});

						}

						if (month == 'December') {

							$.each(items, function (key, item) {

								dec_fixed_amt += parseFloat(item.tot_fixed_amt);

								if (item.metal == 'GOLD') {

									dec_gold_wt += parseFloat(item.total_net_wt);

								}

								if (item.metal == 'SILVER') {

									dec_silver_wt += parseFloat(item.total_net_wt);

								}

							});

						}

					});

					trHTML += '<tr>'

						+ '<td>' + village + '</td>'

						+ '<td>' + branches + '</td>'

						+ '<td><a href=' + base_url + 'index.php/admin_ret_reports/monthly_slaes_comparision/detailed_list/?id_branch=' + id_branch + '&id_village=' + id_village + '&month=01&year=' + $('#cur_year').val() + '&id_metal=1&sales_mode=2 target="_blank">' + money_format_india(parseFloat(J_gold_wt).toFixed(3)) + '</td>'

						+ '<td><a href=' + base_url + 'index.php/admin_ret_reports/monthly_slaes_comparision/detailed_list/?id_branch=' + id_branch + '&id_village=' + id_village + '&month=01&year=' + $('#cur_year').val() + '&id_metal=2&sales_mode=2 target="_blank">' + money_format_india(parseFloat(J_silver_wt).toFixed(3)) + '</td>'

						+ '<td><a href=' + base_url + 'index.php/admin_ret_reports/monthly_slaes_comparision/detailed_list/?id_branch=' + id_branch + '&id_village=' + id_village + '&month=01&year=' + $('#cur_year').val() + '&id_metal=0&sales_mode=1 target="_blank">' + money_format_india(parseFloat(J_fixed_amt).toFixed(3)) + '</td>'

						+ '<td><a href=' + base_url + 'index.php/admin_ret_reports/monthly_slaes_comparision/detailed_list/?id_branch=' + id_branch + '&id_village=' + id_village + '&month=02&year=' + $('#cur_year').val() + '&id_metal=1&sales_mode=2 target="_blank">' + money_format_india(parseFloat(F_gold_wt).toFixed(3)) + '</td>'

						+ '<td><a href=' + base_url + 'index.php/admin_ret_reports/monthly_slaes_comparision/detailed_list/?id_branch=' + id_branch + '&id_village=' + id_village + '&month=02&year=' + $('#cur_year').val() + '&id_metal=2&sales_mode=2 target="_blank">' + money_format_india(parseFloat(F_silver_wt).toFixed(3)) + '</td>'

						+ '<td><a href=' + base_url + 'index.php/admin_ret_reports/monthly_slaes_comparision/detailed_list/?id_branch=' + id_branch + '&id_village=' + id_village + '&month=02&year=' + $('#cur_year').val() + '&id_metal=1&sales_mode=1 target="_blank">' + money_format_india(parseFloat(F_fixed_amt).toFixed(3)) + '</td>'

						+ '<td><a href=' + base_url + 'index.php/admin_ret_reports/monthly_slaes_comparision/detailed_list/?id_branch=' + id_branch + '&id_village=' + id_village + '&month=03&year=' + $('#cur_year').val() + '&id_metal=1&sales_mode=2 target="_blank">' + money_format_india(parseFloat(M_gold_wt).toFixed(3)) + '</td>'

						+ '<td><a href=' + base_url + 'index.php/admin_ret_reports/monthly_slaes_comparision/detailed_list/?id_branch=' + id_branch + '&id_village=' + id_village + '&month=03&year=' + $('#cur_year').val() + '&id_metal=2&sales_mode=2 target="_blank">' + money_format_india(parseFloat(M_silver_wt).toFixed(3)) + '</td>'

						+ '<td><a href=' + base_url + 'index.php/admin_ret_reports/monthly_slaes_comparision/detailed_list/?id_branch=' + id_branch + '&id_village=' + id_village + '&month=03&year=' + $('#cur_year').val() + '&id_metal=1&sales_mode=1 target="_blank">' + money_format_india(parseFloat(M_fixed_amt).toFixed(3)) + '</td>'

						+ '<td><a href=' + base_url + 'index.php/admin_ret_reports/monthly_slaes_comparision/detailed_list/?id_branch=' + id_branch + '&id_village=' + id_village + '&month=04&year=' + $('#cur_year').val() + '&id_metal=1&sales_mode=2 target="_blank">' + money_format_india(parseFloat(A_gold_wt).toFixed(3)) + '</td>'

						+ '<td><a href=' + base_url + 'index.php/admin_ret_reports/monthly_slaes_comparision/detailed_list/?id_branch=' + id_branch + '&id_village=' + id_village + '&month=04&year=' + $('#cur_year').val() + '&id_metal=2&sales_mode=2 target="_blank">' + money_format_india(parseFloat(A_silver_wt).toFixed(3)) + '</td>'

						+ '<td><a href=' + base_url + 'index.php/admin_ret_reports/monthly_slaes_comparision/detailed_list/?id_branch=' + id_branch + '&id_village=' + id_village + '&month=04&year=' + $('#cur_year').val() + '&id_metal=1&sales_mode=1 target="_blank">' + money_format_india(parseFloat(A_fixed_amt).toFixed(3)) + '</td>'

						+ '<td><a href=' + base_url + 'index.php/admin_ret_reports/monthly_slaes_comparision/detailed_list/?id_branch=' + id_branch + '&id_village=' + id_village + '&month=05&year=' + $('#cur_year').val() + '&id_metal=1&sales_mode=2 target="_blank">' + money_format_india(parseFloat(may_gold_wt).toFixed(3)) + '</td>'

						+ '<td><a href=' + base_url + 'index.php/admin_ret_reports/monthly_slaes_comparision/detailed_list/?id_branch=' + id_branch + '&id_village=' + id_village + '&month=05&year=' + $('#cur_year').val() + '&id_metal=2&sales_mode=2 target="_blank">' + money_format_india(parseFloat(may_silver_wt).toFixed(3)) + '</td>'

						+ '<td><a href=' + base_url + 'index.php/admin_ret_reports/monthly_slaes_comparision/detailed_list/?id_branch=' + id_branch + '&id_village=' + id_village + '&month=05&year=' + $('#cur_year').val() + '&id_metal=1&sales_mode=1 target="_blank">' + money_format_india(parseFloat(may_fixed_amt).toFixed(3)) + '</td>'

						+ '<td><a href=' + base_url + 'index.php/admin_ret_reports/monthly_slaes_comparision/detailed_list/?id_branch=' + id_branch + '&id_village=' + id_village + '&month=06&year=' + $('#cur_year').val() + '&id_metal=1&sales_mode=2 target="_blank">' + money_format_india(parseFloat(june_gold_wt).toFixed(3)) + '</td>'

						+ '<td><a href=' + base_url + 'index.php/admin_ret_reports/monthly_slaes_comparision/detailed_list/?id_branch=' + id_branch + '&id_village=' + id_village + '&month=06&year=' + $('#cur_year').val() + '&id_metal=2&sales_mode=2 target="_blank">' + money_format_india(parseFloat(june_silver_wt).toFixed(3)) + '</td>'

						+ '<td><a href=' + base_url + 'index.php/admin_ret_reports/monthly_slaes_comparision/detailed_list/?id_branch=' + id_branch + '&id_village=' + id_village + '&month=06&year=' + $('#cur_year').val() + '&id_metal=1&sales_mode=1 target="_blank">' + money_format_india(parseFloat(june_fixed_amt).toFixed(3)) + '</td>'

						+ '<td><a href=' + base_url + 'index.php/admin_ret_reports/monthly_slaes_comparision/detailed_list/?id_branch=' + id_branch + '&id_village=' + id_village + '&month=07&year=' + $('#cur_year').val() + '&id_metal=1&sales_mode=2 target="_blank">' + money_format_india(parseFloat(july_gold_wt).toFixed(3)) + '</td>'

						+ '<td><a href=' + base_url + 'index.php/admin_ret_reports/monthly_slaes_comparision/detailed_list/?id_branch=' + id_branch + '&id_village=' + id_village + '&month=07&year=' + $('#cur_year').val() + '&id_metal=2&sales_mode=2 target="_blank">' + money_format_india(parseFloat(july_silver_wt).toFixed(3)) + '</td>'

						+ '<td><a href=' + base_url + 'index.php/admin_ret_reports/monthly_slaes_comparision/detailed_list/?id_branch=' + id_branch + '&id_village=' + id_village + '&month=07&year=' + $('#cur_year').val() + '&id_metal=1&sales_mode=1 target="_blank">' + money_format_india(parseFloat(july_fixed_amt).toFixed(3)) + '</td>'

						+ '<td><a href=' + base_url + 'index.php/admin_ret_reports/monthly_slaes_comparision/detailed_list/?id_branch=' + id_branch + '&id_village=' + id_village + '&month=08&year=' + $('#cur_year').val() + '&id_metal=1&sales_mode=2 target="_blank">' + money_format_india(parseFloat(aug_gold_wt).toFixed(3)) + '</td>'

						+ '<td><a href=' + base_url + 'index.php/admin_ret_reports/monthly_slaes_comparision/detailed_list/?id_branch=' + id_branch + '&id_village=' + id_village + '&month=08&year=' + $('#cur_year').val() + '&id_metal=2&sales_mode=2 target="_blank">' + money_format_india(parseFloat(aug_silver_wt).toFixed(3)) + '</td>'

						+ '<td><a href=' + base_url + 'index.php/admin_ret_reports/monthly_slaes_comparision/detailed_list/?id_branch=' + id_branch + '&id_village=' + id_village + '&month=08&year=' + $('#cur_year').val() + '&id_metal=1&sales_mode=1 target="_blank">' + money_format_india(parseFloat(aug_fixed_amt).toFixed(3)) + '</td>'

						+ '<td><a href=' + base_url + 'index.php/admin_ret_reports/monthly_slaes_comparision/detailed_list/?id_branch=' + id_branch + '&id_village=' + id_village + '&month=09&year=' + $('#cur_year').val() + '&id_metal=1&sales_mode=2 target="_blank">' + money_format_india(parseFloat(sep_gold_wt).toFixed(3)) + '</td>'

						+ '<td><a href=' + base_url + 'index.php/admin_ret_reports/monthly_slaes_comparision/detailed_list/?id_branch=' + id_branch + '&id_village=' + id_village + '&month=09&year=' + $('#cur_year').val() + '&id_metal=2&sales_mode=2 target="_blank">' + money_format_india(parseFloat(sep_silver_wt).toFixed(3)) + '</td>'

						+ '<td><a href=' + base_url + 'index.php/admin_ret_reports/monthly_slaes_comparision/detailed_list/?id_branch=' + id_branch + '&id_village=' + id_village + '&month=09&year=' + $('#cur_year').val() + '&id_metal=1&sales_mode=1 target="_blank">' + money_format_india(parseFloat(sep_fixed_amt).toFixed(3)) + '</td>'

						+ '<td><a href=' + base_url + 'index.php/admin_ret_reports/monthly_slaes_comparision/detailed_list/?id_branch=' + id_branch + '&id_village=' + id_village + '&month=10&year=' + $('#cur_year').val() + '&id_metal=1&sales_mode=2 target="_blank">' + money_format_india(parseFloat(oct_gold_wt).toFixed(3)) + '</td>'

						+ '<td><a href=' + base_url + 'index.php/admin_ret_reports/monthly_slaes_comparision/detailed_list/?id_branch=' + id_branch + '&id_village=' + id_village + '&month=10&year=' + $('#cur_year').val() + '&id_metal=2&sales_mode=2 target="_blank">' + money_format_india(parseFloat(oct_silver_wt).toFixed(3)) + '</td>'

						+ '<td><a href=' + base_url + 'index.php/admin_ret_reports/monthly_slaes_comparision/detailed_list/?id_branch=' + id_branch + '&id_village=' + id_village + '&month=10&year=' + $('#cur_year').val() + '&id_metal=1&sales_mode=1 target="_blank">' + money_format_india(parseFloat(oct_fixed_amt).toFixed(3)) + '</td>'

						+ '<td><a href=' + base_url + 'index.php/admin_ret_reports/monthly_slaes_comparision/detailed_list/?id_branch=' + id_branch + '&id_village=' + id_village + '&month=11&year=' + $('#cur_year').val() + '&id_metal=1&sales_mode=2 target="_blank">' + money_format_india(parseFloat(nov_gold_wt).toFixed(3)) + '</td>'

						+ '<td><a href=' + base_url + 'index.php/admin_ret_reports/monthly_slaes_comparision/detailed_list/?id_branch=' + id_branch + '&id_village=' + id_village + '&month=11&year=' + $('#cur_year').val() + '&id_metal=2&sales_mode=2 target="_blank">' + money_format_india(parseFloat(nov_silver_wt).toFixed(3)) + '</td>'

						+ '<td><a href=' + base_url + 'index.php/admin_ret_reports/monthly_slaes_comparision/detailed_list/?id_branch=' + id_branch + '&id_village=' + id_village + '&month=11&year=' + $('#cur_year').val() + '&id_metal=1&sales_mode=1 target="_blank">' + money_format_india(parseFloat(nov_fixed_amt).toFixed(3)) + '</td>'

						+ '<td><a href=' + base_url + 'index.php/admin_ret_reports/monthly_slaes_comparision/detailed_list/?id_branch=' + id_branch + '&id_village=' + id_village + '&month=12&year=' + $('#cur_year').val() + '&id_metal=1&sales_mode=2 target="_blank">' + money_format_india(parseFloat(dec_gold_wt).toFixed(3)) + '</td>'

						+ '<td><a href=' + base_url + 'index.php/admin_ret_reports/monthly_slaes_comparision/detailed_list/?id_branch=' + id_branch + '&id_village=' + id_village + '&month=12&year=' + $('#cur_year').val() + '&id_metal=&sales_mode=2 target="_blank">' + money_format_india(parseFloat(dec_silver_wt).toFixed(3)) + '</td>'

						+ '<td><a href=' + base_url + 'index.php/admin_ret_reports/monthly_slaes_comparision/detailed_list/?id_branch=' + id_branch + '&id_village=' + id_village + '&month=12&year=' + $('#cur_year').val() + '&id_metal=1&sales_mode=1 target="_blank">' + money_format_india(parseFloat(dec_fixed_amt).toFixed(3)) + '</td>'

						+ '</tr>';

					J_total_gold_wt += parseFloat(J_gold_wt);

					J_total_silver_wt += parseFloat(J_silver_wt);

					J_total_fixed_amt += parseFloat(J_fixed_amt);

					F_total_gold_wt += parseFloat(F_gold_wt);

					F_total_silver_wt += parseFloat(F_silver_wt);

					F_total_fixed_amt += parseFloat(F_fixed_amt);

					M_total_gold_wt += parseFloat(M_gold_wt);

					M_total_silver_wt += parseFloat(M_silver_wt);

					M_total_fixed_amt += parseFloat(M_fixed_amt);

					A_total_gold_wt += parseFloat(A_gold_wt);

					A_total_silver_wt += parseFloat(A_silver_wt);

					A_total_fixed_amt += parseFloat(A_fixed_amt);

					may_total_gold_wt += parseFloat(may_gold_wt);

					may_total_silver_wt += parseFloat(may_silver_wt);

					may_total_fixed_amt += parseFloat(may_fixed_amt);

					june_total_gold_wt += parseFloat(june_gold_wt);

					june_total_silver_wt += parseFloat(june_silver_wt);

					june_total_fixed_amt += parseFloat(june_fixed_amt);

					july_total_gold_wt += parseFloat(july_gold_wt);

					july_total_silver_wt += parseFloat(july_silver_wt);

					july_total_fixed_amt += parseFloat(july_fixed_amt);

					aug_total_gold_wt += parseFloat(aug_gold_wt);

					aug_total_silver_wt += parseFloat(aug_silver_wt);

					aug_total_fixed_amt += parseFloat(aug_fixed_amt);

					sep_total_gold_wt += parseFloat(sep_gold_wt);

					sep_total_silver_wt += parseFloat(sep_silver_wt);

					sep_total_fixed_amt += parseFloat(sep_fixed_amt);

					oct_total_gold_wt += parseFloat(oct_gold_wt);

					oct_total_silver_wt += parseFloat(oct_silver_wt);

					oct_total_fixed_amt += parseFloat(oct_fixed_amt);

					nov_total_gold_wt += parseFloat(nov_gold_wt);

					nov_total_silver_wt += parseFloat(nov_silver_wt);

					nov_total_fixed_amt += parseFloat(nov_fixed_amt);

					dec_total_gold_wt += parseFloat(dec_gold_wt);

					dec_total_silver_wt += parseFloat(dec_silver_wt);

					dec_total_fixed_amt += parseFloat(dec_fixed_amt);

				});

				trHTML += '<tr style="color:red">'

					+ '<td><strong>SUB TOTAL</strong></td>'

					+ '<td></td>'

					+ '<td><strong>' + money_format_india(parseFloat(J_total_gold_wt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(J_total_silver_wt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(J_total_fixed_amt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(F_total_gold_wt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(F_total_silver_wt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(F_total_fixed_amt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(M_total_gold_wt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(M_total_silver_wt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(M_total_fixed_amt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(A_total_gold_wt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(A_total_silver_wt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(A_total_fixed_amt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(may_total_gold_wt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(may_total_silver_wt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(may_total_fixed_amt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(june_total_gold_wt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(june_total_silver_wt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(june_total_fixed_amt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(july_total_gold_wt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(july_total_silver_wt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(july_total_fixed_amt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(aug_total_gold_wt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(aug_total_silver_wt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(aug_total_fixed_amt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(sep_total_gold_wt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(sep_total_silver_wt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(sep_total_fixed_amt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(oct_total_gold_wt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(oct_total_silver_wt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(oct_total_fixed_amt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(nov_total_gold_wt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(nov_total_silver_wt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(nov_total_fixed_amt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(dec_total_gold_wt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(dec_total_silver_wt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(dec_total_fixed_amt).toFixed(3)) + '</strong></td>'

				J_grand_total_gold_wt += parseFloat(J_total_gold_wt);

				J_grand_total_silver_wt += parseFloat(J_total_silver_wt);

				J_grand_total_fixed_amt += parseFloat(J_total_fixed_amt);

				F_grand_total_gold_wt += parseFloat(F_total_gold_wt);

				F_grand_total_silver_wt += parseFloat(F_total_silver_wt);

				F_grand_total_fixed_amt += parseFloat(F_total_fixed_amt);

				M_grand_total_gold_wt += parseFloat(M_total_gold_wt);

				M_grand_total_silver_wt += parseFloat(M_total_silver_wt);

				M_grand_total_fixed_amt += parseFloat(M_total_fixed_amt);

				A_grand_total_gold_wt += parseFloat(A_total_gold_wt);

				A_grand_total_silver_wt += parseFloat(A_total_silver_wt);

				A_grand_total_fixed_amt += parseFloat(A_total_fixed_amt);

				may_grand_total_gold_wt += parseFloat(may_total_gold_wt);

				may_grand_total_silver_wt += parseFloat(may_total_silver_wt);

				may_grand_total_fixed_amt += parseFloat(may_total_fixed_amt);

				june_grand_total_gold_wt += parseFloat(june_total_gold_wt);

				june_grand_total_silver_wt += parseFloat(june_total_silver_wt);

				june_grand_total_fixed_amt += parseFloat(june_total_fixed_amt);

				july_grand_total_gold_wt += parseFloat(july_total_gold_wt);

				july_grand_total_silver_wt += parseFloat(july_total_silver_wt);

				july_grand_total_fixed_amt += parseFloat(july_total_fixed_amt);

				aug_grand_total_gold_wt += parseFloat(aug_total_gold_wt);

				aug_grand_total_silver_wt += parseFloat(aug_total_silver_wt);

				aug_grand_total_fixed_amt += parseFloat(aug_total_fixed_amt);

				sep_grand_total_gold_wt += parseFloat(sep_total_gold_wt);

				sep_grand_total_silver_wt += parseFloat(sep_total_silver_wt);

				sep_grand_total_fixed_amt += parseFloat(sep_total_fixed_amt);

				oct_grand_total_gold_wt += parseFloat(oct_total_gold_wt);

				oct_grand_total_silver_wt += parseFloat(oct_total_silver_wt);

				oct_grand_total_fixed_amt += parseFloat(oct_total_fixed_amt);

				nov_grand_total_gold_wt += parseFloat(nov_total_gold_wt);

				nov_grand_total_silver_wt += parseFloat(nov_total_silver_wt);

				nov_grand_total_fixed_amt += parseFloat(nov_total_fixed_amt);

				dec_grand_total_gold_wt += parseFloat(dec_total_gold_wt);

				dec_grand_total_silver_wt += parseFloat(dec_total_silver_wt);

				dec_grand_total_fixed_amt += parseFloat(dec_total_fixed_amt);

			});

			trHTML += '<tr style="color:blue">'

				+ '<td><strong>GRAND TOTAL</strong></td>'

				+ '<td></td>'

				+ '<td><strong>' + money_format_india(parseFloat(J_grand_total_gold_wt).toFixed(3)) + '</strong></td>'

				+ '<td><strong>' + money_format_india(parseFloat(J_grand_total_silver_wt).toFixed(3)) + '</strong></td>'

				+ '<td><strong>' + money_format_india(parseFloat(J_grand_total_fixed_amt).toFixed(3)) + '</strong></td>'

				+ '<td><strong>' + money_format_india(parseFloat(F_grand_total_gold_wt).toFixed(3)) + '</strong></td>'

				+ '<td><strong>' + money_format_india(parseFloat(F_grand_total_silver_wt).toFixed(3)) + '</strong></td>'

				+ '<td><strong>' + money_format_india(parseFloat(F_grand_total_fixed_amt).toFixed(3)) + '</strong></td>'

				+ '<td><strong>' + money_format_india(parseFloat(M_grand_total_gold_wt).toFixed(3)) + '</strong></td>'

				+ '<td><strong>' + money_format_india(parseFloat(M_grand_total_silver_wt).toFixed(3)) + '</strong></td>'

				+ '<td><strong>' + money_format_india(parseFloat(M_grand_total_fixed_amt).toFixed(3)) + '</strong></td>'

				+ '<td><strong>' + money_format_india(parseFloat(A_grand_total_gold_wt).toFixed(3)) + '</strong></td>'

				+ '<td><strong>' + money_format_india(parseFloat(A_grand_total_silver_wt).toFixed(3)) + '</strong></td>'

				+ '<td><strong>' + money_format_india(parseFloat(A_grand_total_fixed_amt).toFixed(3)) + '</strong></td>'

				+ '<td><strong>' + money_format_india(parseFloat(may_grand_total_gold_wt).toFixed(3)) + '</strong></td>'

				+ '<td><strong>' + money_format_india(parseFloat(may_grand_total_silver_wt).toFixed(3)) + '</strong></td>'

				+ '<td><strong>' + money_format_india(parseFloat(may_grand_total_fixed_amt).toFixed(3)) + '</strong></td>'

				+ '<td><strong>' + money_format_india(parseFloat(june_grand_total_gold_wt).toFixed(3)) + '</strong></td>'

				+ '<td><strong>' + money_format_india(parseFloat(june_grand_total_silver_wt).toFixed(3)) + '</strong></td>'

				+ '<td><strong>' + money_format_india(parseFloat(june_grand_total_fixed_amt).toFixed(3)) + '</strong></td>'

				+ '<td><strong>' + money_format_india(parseFloat(july_grand_total_gold_wt).toFixed(3)) + '</strong></td>'

				+ '<td><strong>' + money_format_india(parseFloat(july_grand_total_silver_wt).toFixed(3)) + '</strong></td>'

				+ '<td><strong>' + money_format_india(parseFloat(july_grand_total_fixed_amt).toFixed(3)) + '</strong></td>'

				+ '<td><strong>' + money_format_india(parseFloat(aug_grand_total_gold_wt).toFixed(3)) + '</strong></td>'

				+ '<td><strong>' + money_format_india(parseFloat(aug_grand_total_silver_wt).toFixed(3)) + '</strong></td>'

				+ '<td><strong>' + money_format_india(parseFloat(aug_grand_total_fixed_amt).toFixed(3)) + '</strong></td>'

				+ '<td><strong>' + money_format_india(parseFloat(sep_grand_total_gold_wt).toFixed(3)) + '</strong></td>'

				+ '<td><strong>' + money_format_india(parseFloat(sep_grand_total_silver_wt).toFixed(3)) + '</strong></td>'

				+ '<td><strong>' + money_format_india(parseFloat(sep_grand_total_fixed_amt).toFixed(3)) + '</strong></td>'

				+ '<td><strong>' + money_format_india(parseFloat(oct_grand_total_gold_wt).toFixed(3)) + '</strong></td>'

				+ '<td><strong>' + money_format_india(parseFloat(oct_grand_total_silver_wt).toFixed(3)) + '</strong></td>'

				+ '<td><strong>' + money_format_india(parseFloat(oct_grand_total_fixed_amt).toFixed(3)) + '</strong></td>'

				+ '<td><strong>' + money_format_india(parseFloat(nov_grand_total_gold_wt).toFixed(3)) + '</strong></td>'

				+ '<td><strong>' + money_format_india(parseFloat(nov_grand_total_silver_wt).toFixed(3)) + '</strong></td>'

				+ '<td><strong>' + money_format_india(parseFloat(nov_grand_total_fixed_amt).toFixed(3)) + '</strong></td>'

				+ '<td><strong>' + money_format_india(parseFloat(dec_grand_total_gold_wt).toFixed(3)) + '</strong></td>'

				+ '<td><strong>' + money_format_india(parseFloat(dec_grand_total_silver_wt).toFixed(3)) + '</strong></td>'

				+ '<td><strong>' + money_format_india(parseFloat(dec_grand_total_fixed_amt).toFixed(3)) + '</strong></td>'

				+ '</tr>';

			$('#sales_comparision > tbody').html(trHTML);

			// Check and initialise datatable

			if (!$.fn.DataTable.isDataTable('#sales_comparision')) {

				oTable = $('#sales_comparision').dataTable({

					"bSort": false,

					"bInfo": true,

					"scrollX": '100%',

					"dom": 'lBfrtip',

					"paging": false,

					"columnDefs": [

						{

							targets: [2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37],

							className: 'dt-body-right'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', '10px');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: "Monthly Comparision Report",

						}

					],

				});

			}

			$("div.overlay").css("display", "none");

		}

	});

}

function get_monthly_sales_details() {

	var urlParams = new URLSearchParams(window.location.search);

	var id_branch = urlParams.get('id_branch');

	var id_village = urlParams.get('id_village');

	var month = urlParams.get('month');

	var year = urlParams.get('year');

	var sales_mode = urlParams.get('sales_mode');

	var id_metal = urlParams.get('id_metal');

	var company_name = $('#company_name').val();

	var title = "<b><span style='font-size:15pt;margin-left:30%;'>" + company_name + "</span>-</b><b><span style='font-size:12pt;'></span></b>" + "<span style=font-size:13pt;>&nbsp;&nbsp;Monthly Sales Report &nbsp;&nbsp;</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/monthly_slaes_comparision/sales_details/?nocache=" + my_Date.getUTCSeconds(),

		dataType: "JSON",

		type: "POST",

		data: { 'id_branch': id_branch, 'id_village': id_village, 'month': month, 'year': year, 'id_metal': id_metal, 'sales_mode': sales_mode },

		success: function (data) {

			var list = data;

			var oTable = $('#sales_details').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#sales_details').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"order": [[0, "desc"]],

					"columnDefs": [

						{

							targets: [6, 7, 8],

							className: 'dt-body-right'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: "",

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: "Sales Details",

						}

					],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "bill_date" },

						{ "mDataProp": "cus_name" },

						{

							"mDataProp": function (row, type, val, meta) {

								var url = base_url + 'index.php/admin_ret_reports/customer_history/list/' + row.mobile;

								return '<a href=' + url + ' target="_blank">' + row.mobile + '</a>';

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + row.bill_id;

								return '<a href=' + url + ' target="_blank">' + row.bill_no + '</a>';

							}

						},

						{ "mDataProp": "metal" },

						{ "mDataProp": "product_name" },

						{ "mDataProp": "gross_wt" },

						{ "mDataProp": "total_net_wt" },

						{ "mDataProp": "tot_fixed_amt" },

					],

					"footerCallback": function (row, data, start, end, display) {

						var cshtotal = 0;

						if (list.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								total_value = api

									.column(6)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(6).footer()).html(parseFloat(total_value).toFixed(3));

								total_value = api

									.column(7)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(7).footer()).html(parseFloat(total_value).toFixed(3));

								total_value = api

									.column(8)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(8).footer()).html(parseFloat(total_value).toFixed(2));

							}

						} else {

							var api = this.api(), data;

							$(api.column(2).footer()).html('');

						}

					}

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//Month on month sales report

//Telecalling

$("#set_vip_cus").on('click', function () {

	if ($("input[name='id_customer[]']:checked").val()) {

		$('#set_vip_cus').prop('disabled', true);

		var selected = [];

		$("#telecalling_list tbody tr").each(function (index, value) {

			if ($(value).find("input[name='id_customer[]']:checked").is(":checked")) {

				transData = {

					'id_customer': $(value).find(".id_customer").val(),

				}

				selected.push(transData);

			}

		})

		req_data = selected;

		update_vip_customer(req_data);

	}

	else {

		$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + 'Please Select Customer..' });

		$('#set_vip_cus').prop('disabled', false);

	}

});

function update_vip_customer(req_data) {

	my_Date = new Date();

	$("div.overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/update_vip_customer?nocache=" + my_Date.getUTCSeconds() + '' + my_Date.getUTCMinutes() + '' + my_Date.getUTCHours(),

		data: { 'req_data': req_data },

		type: "POST",

		dataType: "JSON",

		async: false,

		success: function (data) {

			if (data.status) {

				$.toaster({ priority: 'success', title: 'Warning!', message: '' + "</br>" + data.message });

			} else {

				$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + data.message });

			}

			location.reload();

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			console.log(error);

			$("div.overlay").css("display", "none");

		}

	});

}

function get_telecalling_report() {

	my_Date = new Date();

	$('.overlay').css('display', 'block');

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/get_telecalling_report?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'from_date': $("#rpt_cus1").html(), 'to_date': $("#rpt_cus2").html(), 'id_zone': $('#select_zone').val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'id_village': $('#select_village').val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			set_telecalling_report(data);

			$('.overlay').css('display', 'none');

		},

		error: function (error) {

			$('.overlay').css('display', 'none');

		}

	});

}

function set_telecalling_report(data) {

	var list = data;

	var oTable = $('#telecalling_list').DataTable();

	oTable.clear().draw();

	if (list != null && list.length > 0) {

		oTable = $('#telecalling_list').dataTable({

			"bDestroy": true,

			"bInfo": true,

			"bFilter": true,

			"bSort": true,

			"dom": 'lBfrtip',

			"buttons": [

				{

					extend: 'print',

					footer: true,

					title: "",

					messageTop: "Tele Calling Details",

					customize: function (win) {

						$(win.document.body).find('table')

							.addClass('compact')

							.css('font-size', 'inherit');

					},

				},

				{

					extend: 'excel',

					footer: true,

					title: "Tele Calling Details",

				}

			],

			"aaData": list,

			"order": [[1, "desc"]],

			"aoColumns": [

				{

					"mDataProp": function (row, type, val, meta) {

						chekbox = '<input type="checkbox" class="id_customer" name="id_customer[]" value="' + row.id_customer + '"/>' + row.id_customer;

						return chekbox;

					}

				},

				{ "mDataProp": "firstname" },

				{

					"mDataProp": function (row, type, val, meta) {

						mobile_report = base_url + "index.php/admin_ret_reports/customer_history/list/" + row.mobile;

						action = '<a href="' + mobile_report + '" target="_blank">' + row.mobile;

						return action;

					}

				},

				{ "mDataProp": "vip_customer" },

				{ "mDataProp": "village_name" },

				{ "mDataProp": "zone_name" },

				{ "mDataProp": "branch_name" },

				{ "mDataProp": "estimation_no" },

				{ "mDataProp": "bill_count" },

				{ "mDataProp": "last_billdate" },

				{ "mDataProp": "gold_wt" },

				{ "mDataProp": "silver_wt" },

				{ "mDataProp": "tot_fixed_rate" },

				{ "mDataProp": "tot_account" },

				{ "mDataProp": "active_acc" },

				{ "mDataProp": "inactive_acount" },

				{ "mDataProp": "closed_count" },

				{

					"mDataProp": function (row, type, val, meta) {

						return '<a href="https://api.whatsapp.com/send?phone=+91' + row.mobile + '" target="_blank"><i class="fa fa-whatsapp" aria-hidden="true" style="font-size: 30px;color: #fff;background: linear-gradient(#25d366,#25d366) 14% 84%/16% 16% no-repeat, radial-gradient(#25d366 58%,transparent 0);"></i></a>';

					}

				},

				{

					"mDataProp": function (row, type, val, meta) {

						var id = row.id_customer;

						feedback_target = "#modal-feedback";

						action_content = '<a href=# class="btn btn-info fb_add" id="fb" data-toggle="modal"   role="button" data-id=' + id + ' data-target=' + feedback_target + '><i class="fa fa-comments-o" aria-hidden="true"></i></a>';

						return action_content;

					}

				},

			]

		});

	}

}

$(document).on('click', "#telecalling_list a.fb_add", function (e) {

	var customer_id = $(this).data('id');

	get_feedback_modal(customer_id);

});

$("#add_feedback").click(function () {

	add_feedback();

});

function add_feedback() {

	var form_data = $('#feedback_form').serialize();

	console.log(form_data);

	my_Date = new Date();

	$.ajax({

		type: "POST",

		url: base_url + "index.php/admin_ret_catalog/feedback/save?nocache=" + my_Date.getUTCSeconds(),

		cache: false,

		dataType: "JSON",

		data: form_data,

		success: function (data) {

			if (data.status) {

				$.toaster({ priority: 'success', title: 'Warning!', message: '' + "</br>" + data.message });

			} else {

				$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + data.message });

			}

			$("div.overlay").css("display", "none");

			//location.reload(true);

		}

	});

}

function get_feedback_modal(customer_id) {

	my_Date = new Date();

	$.ajax({

		type: "GET",

		url: base_url + "index.php/admin_ret_catalog/feedback/ajax?nocache=" + my_Date.getUTCSeconds(),

		cache: false,

		dataType: "JSON",

		success: function (data) {

			var feedback = data.list;

			$('#feedback_content').html("");

			var i = 1;

			$.each(feedback, function (key, item) {

				var feedbackRow = "<div class='col-md-8'><lable>" + item.name + "</label><br>"

					+ "<input type='hidden'  name='id_customer' value=" + customer_id + ">"

					+ "<input type='hidden' name='id_feedback[]' value=" + item.id_feedback + "><input type='radio' name='feedback_option_" + i + "' checked value='1' /><label for='1'> &nbsp;&nbsp; Excellent &nbsp;&nbsp;</label>"

					+ "<input type='radio' name='feedback_option_" + i + "' value='2' /><label for='2'> &nbsp;&nbsp; Good &nbsp;&nbsp;</label>"

					+ "<input type='radio' name='feedback_option_" + i + "' value='3' /><label for='3'> &nbsp;&nbsp; Fair &nbsp;&nbsp;</label>"

					+ "<input type='radio' name='feedback_option_" + i + "' value='4' /><label for='4'> &nbsp;&nbsp; Poor &nbsp;&nbsp;</label><br /><br>"

				$('#feedback_content').append(feedbackRow);

				i++;

			});

			$('#feedback_content').append("<div class='col-md-8'><label>Comments :</label><textarea name='comments' rows='3' cols='60' value='' /></div>");

		}

	});

}

function get_feedback_report() {

	my_Date = new Date();

	$('.overlay').css('display', 'block');

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/get_feedbackReport?nocache=" + my_Date.getUTCSeconds(),

		dataType: "JSON",

		type: "GET",

		success: function (data) {

			set_feedback_report(data);

			$('.overlay').css('display', 'none');

		},

		error: function (error) {

			$('.overlay').css('display', 'none');

		}

	});

}

function set_feedback_report(data) {

	var feedback = data;

	var oTable = $('#feedback_list').DataTable();

	oTable.clear().draw();

	if (feedback != null && feedback.length > 0) {

		oTable = $('#feedback_list').dataTable({

			"bDestroy": true,

			"bInfo": true,

			"bFilter": true,

			"bSort": false,

			"dom": 'T<"clear">lfrtip',

			"tableTools": { "aButtons": [{ "sExtends": "xls", "oSelectorOpts": { page: 'current' } }, { "sExtends": "pdf", "oSelectorOpts": { page: 'current' } }] },

			"aaData": feedback,

			"order": [[1, "asc"]],

			"aoColumns": [

				{

					render: function (data, type, row, meta) {

						return meta.row + 1;

					}

				},

				{ "mDataProp": "firstname" },

				{

					"mDataProp": function (row, type, val, meta) {

						var customer_mobile = row.mobile;

						var customer_id = row.id_customer;

						feedback_target = "#modal_feedback";

						action_content = '<a href=# data-toggle="modal" class="customer_fb" role="button" data-id=' + customer_id + ' data-target=' + feedback_target + '>' + customer_mobile + '</a>';

						return action_content;

					}

				},

				{ "mDataProp": "feedback_date" },

				{ "mDataProp": "feedback_takenby" },

			]

		});

	}

}

$(document).on('click', "#feedback_list a.customer_fb", function (e) {

	var customer_id = $(this).data('id');

	$.ajax({

		type: "GET",

		url: base_url + "index.php/admin_ret_reports/feedback_report/ajax/" + customer_id + "?nocache=" + my_Date.getUTCSeconds(),

		cache: false,

		dataType: "JSON",

		success(data) {

			$('#fb_report_content').html("");

			var i = 1;

			$.each(data, function (key, item) {

				// alert(item.feedback_response);

				var x = item.feedback_response;

				if (x == 1) {

					var feedbackRow = "<div class='col-md-8'><lable>" + item.name + "<br>&nbsp;&nbsp;<b>Excellent</b></label><br>"

						+ "<input type='hidden' id='cus_comm' name='comments'  value=" + item.comments + "><br>"

				}

				if (x == 2) {

					var feedbackRow = "<div class='col-md-8'><lable>" + item.name + "<br>&nbsp;&nbsp;<b>Good</b></label><br>"

						+ "<input type='hidden' id='cus_comm' name='comments'  value=" + item.comments + "><br>"

				}

				if (x == 3) {

					var feedbackRow = "<div class='col-md-8'><lable>" + item.name + "<br>&nbsp;&nbsp;<b>Fair</b></label><br>"

						+ "<input type='hidden' id='cus_comm' name='comments'  value=" + item.comments + "><br>"

				}

				if (x == 4) {

					var feedbackRow = "<div class='col-md-8'><lable>" + item.name + "<br>&nbsp;&nbsp;<b>Poor</b></label><br>"

						+ "<input type='hidden' id='cus_comm' name='comments'  value=" + item.comments + "><br>"

				}

				$('#fb_report_content').append(feedbackRow);

				i++;

			});

			var cus = $('#cus_comm').val();

			$('#fb_report_content').append("<div class='col-md-8'><label>Comments :</label><textarea disabled id='cus_comment' name='comments' rows='3' cols='60'>" + cus + "</textarea></div>");

		}

	});

});

//Telecalling

function get_Activesize(id_product) {

	$('#select_size option').remove();

	$.ajax({

		type: 'POST',

		url: base_url + 'index.php/admin_ret_catalog/get_Activesize',

		dataType: 'json',

		data: { 'id_product': id_product },

		success: function (data) {

			var size = $('#select_size').val();

			$.each(data, function (key, item) {

				$("#select_size").append(

					$("<option></option>")

						.attr("value", item.id_size)

						.text(item.name)

				);

			});

			$("#select_size").select2({

				placeholder: "Select Size",

				allowClear: true

			});

			$("#select_size").select2("val", '');

		}

	});

}

//Customer Edit Log

function set_customer_edit_log_table() {

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/customer_edit_log/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'from_date': $('#customer_edit_log_date1').text(), 'to_date': $('#customer_edit_log_date2').text() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			console.log(data);

			$("div.overlay").css("display", "none");

			var list = data.list;

			$('#total_count').text(list.length);

			var oTable = $('#customer_edit_log_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#customer_edit_log_list').DataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"bSort": true,

					"order": [[0, "desc"]],

					"order": [[0, "desc"]],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "id_customer" },

						{

							"mDataProp": function (row, type, val, meta) {

								if (row.previous_firstname != null) {

									var name = "Name&nbsp;:&nbsp;" + "<span>" + row.previous_firstname + "<br></span>"

								}

								if (row.previous_lastname != null) {

									var last_name = "Last Name&nbsp;:&nbsp;" + "<span>" + row.previous_lastname + "<br></span>"

								}

								if (row.previous_mobile != null) {

									var mobile = "Mobile&nbsp;:&nbsp;" + "<span>" + row.previous_mobile + "<br></span>"

								} if (row.previous_email != null) {

									var email = "Email&nbsp;:&nbsp;" + "<span>" + row.previous_email + "<br></span>"

								} if (row.previous_address1 != null) {

									var address1 = "Address&nbsp;:&nbsp;" + "<span>" + row.previous_address1 + "<br></span>"

								}

								content = ''.concat(name != null || name != undefined ? name : '', (last_name != null ? last_name : ''), mobile != null || mobile != undefined ? mobile : '', email != null || email != undefined ? email : '', address1 != null || address1 != undefined ? address1 : '');

								return content;

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								spanclass = 'label-success';

								if (row.updated_firstname != null) {

									var up_name = "Name&nbsp;:&nbsp;" + "<span class='label " + spanclass + "'>" + row.updated_firstname + "<br></span>"

								}

								if (row.updated_lastname != null) {

									var up_lastname = "Last Name&nbsp;:&nbsp;" + "<span class='label " + spanclass + "'>" + row.updated_lastname + "<br></span>"

								}

								if (row.updated_mobile != null) {

									var up_mobile = "Mobile&nbsp;:&nbsp;" + "<span class='label " + spanclass + "'>" + row.updated_mobile + "<br></span>"

								} if (row.updated_email != null) {

									var up_email = "Email&nbsp;:&nbsp;" + "<span class='label " + spanclass + "'>" + row.updated_email + "<br></span>"

								} if (row.updated_address1 != null) {

									var up_address1 = "Address&nbsp;:&nbsp;" + "<span class='label " + spanclass + "'>" + row.updated_address1 + "<br></span>"

								}

								up_content = ''.concat(up_name != null || up_name != undefined ? up_name : '', (up_lastname != null ? up_lastname : ''), up_mobile != null || up_mobile != undefined ? up_mobile : '', up_email != null || up_email != undefined ? up_email : '', up_address1 != null || up_address1 != undefined ? up_address1 : '');

								return up_content;

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								return row.firstname != null ? row.firstname : '-';

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								return row.updated_on != null ? row.updated_on : '-';

							}

						}

					]

				});

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//Customer Edit Log

//Green tag return report

function set_gt_return_report_table() {

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/gt_return_report/ajax_data?nocache=" + my_Date.getUTCSeconds(),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var oTable = $('#gt_return_report_list').DataTable();

			oTable.clear().draw();

			if (data != null && data.length > 0) {

				oTable = $('#gt_return_report_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"order": [[0, "desc"]],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: "",

							messageTop: "Green Tag Sales Return Report",

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: "Green Tag Sales Return Report",

						}

					],

					"aaData": data,

					"aoColumns": [

						{

							"mDataProp": function (row, type, val, meta) {

								var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + row.bill_id;

								return '<a href=' + url + ' target="_blank">' + row.bill_no + '</a>';

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var url = base_url + 'index.php/admin_ret_estimation/generate_invoice/' + row.estimation_id;

								return '<a href=' + url + ' target="_blank">' + row.esti_no + '</a>';

							}

						},

						{ "mDataProp": "bill_date" },

						{ "mDataProp": "tag_date" },

						{ "mDataProp": "tag_code" },

						{ "mDataProp": "bill_date" },

						{ "mDataProp": "gross_wt" },

						{ "mDataProp": "net_wt" },

						{

							"mDataProp": function (row, type, val, meta) {

								if (row.id_metal == 1) {

									return parseFloat(row.net_wt * $('#emp_sales_incentive_gold_perg').val()).toFixed(2);

								} else {

									return parseFloat(row.net_wt * $('#emp_sales_incentive_silver_perg').val()).toFixed(2);

								}

							}

						},

						{ "mDataProp": "product_name" },

						{ "mDataProp": "item_cost" },

						{ "mDataProp": "emp_name" },

						{ "mDataProp": "emp_code" },

					],

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//Green tag return report

function set_dashboard_estimationList() {

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/dashboard_estimationList?nocache=" + my_Date.getUTCSeconds(),

		type: "POST",

		data: { 'from_date': ctrl_page[2], 'to_date': ctrl_page[3], 'type': ctrl_page[4], 'id_branch': ctrl_page[5] },

		dataType: "JSON",

		cache: false,

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.estimate_list;

			var oTable = $('#dash_est_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#dash_est_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: 'Estimation',

						}

					],

					"aaData": list,

					"aoColumns": [{

						render: function (data, type, row, meta) {

							return meta.row + 1;

						}

					},

					{

						"mDataProp": function (row, type, val, meta) {

							var url = base_url + 'index.php/admin_ret_estimation/generate_invoice/' + row.estimation_id;

							return '<a href=' + url + ' target="_blank">' + row.esti_no + '</a>';

						}

					},

					{ "mDataProp": "firstname" },

					{ "mDataProp": "date" },

					{ "mDataProp": "total_cost" },

					],

					"footerCallback": function (row, data, start, end, display) {

						if (list.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								total_val = api

									.column(4)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(4).footer()).html(parseFloat(total_val).toFixed(2));

							}

						} else {

							var api = this.api(), data;

							$(api.column(4).footer()).html('');

						}

					}

				});

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function set_dashboard_salesList() {

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/dashboard_salesList?nocache=" + my_Date.getUTCSeconds(),

		type: "POST",

		data: { 'from_date': ctrl_page[2], 'to_date': ctrl_page[3], 'type': ctrl_page[4], 'id_branch': ctrl_page[5] },

		dataType: "JSON",

		cache: false,

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.sales_list;

			var oTable = $('#dash_sales_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#dash_sales_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: 'Sales',

						}

					],

					"aaData": list,

					"aoColumns": [{

						render: function (data, type, row, meta) {

							return meta.row + 1;

						}

					},

					{

						"mDataProp": function (row, type, val, meta) {

							var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + row.bill_id;

							return '<a href=' + url + ' target="_blank">' + row.bill_no + '</a>';

						}

					},

					{ "mDataProp": "firstname" },

					{ "mDataProp": "bill_date" },

					{ "mDataProp": "product_name" },

					{ "mDataProp": "piece" },

					{ "mDataProp": "tot_bill_amount" },

					{ "mDataProp": "net_wt" },

					],

					"footerCallback": function (row, data, start, end, display) {

						if (list.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								total_val = api

									.column(6)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(6).footer()).html(parseFloat(total_val).toFixed(2));

								total_wt = api

									.column(7)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(7).footer()).html(parseFloat(total_wt).toFixed(2));

							}

						} else {

							var api = this.api(), data;

							$(api.column(6).footer()).html('');

							$(api.column(7).footer()).html('');

						}

					}

				});

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function set_dashboard_greentagList() {

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/dashboard_greentagList?nocache=" + my_Date.getUTCSeconds(),

		type: "POST",

		data: { 'from_date': ctrl_page[2], 'to_date': ctrl_page[3], 'id_branch': ctrl_page[4] },

		dataType: "JSON",

		cache: false,

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.greentag_list;

			var oTable = $('#dash_greentag_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#dash_greentag_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: 'Green Tag Sales',

						}

					],

					"aaData": list,

					"aoColumns": [{

						render: function (data, type, row, meta) {

							return meta.row + 1;

						}

					},

					{

						"mDataProp": function (row, type, val, meta) {

							var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + row.bill_id;

							return '<a href=' + url + ' target="_blank">' + row.bill_no + '</a>';

						}

					},

					{ "mDataProp": "firstname" },

					{ "mDataProp": "bill_date" },

					{ "mDataProp": "product_name" },

					{ "mDataProp": "piece" },

					{

						"mDataProp": function (row, type, val, meta) {

							if (row.net_wt > 0) {

								if (row.id_metal == 1) {

									return parseFloat(row.net_wt * $('#emp_sales_incentive_gold_perg').val()).toFixed(2);

								} else {

									return parseFloat(row.net_wt * $('#emp_sales_incentive_silver_perg').val()).toFixed(2);

								}

							} else {

								return 0;

							}

						}

					},

					{ "mDataProp": "net_wt" },

					],

					"footerCallback": function (row, data, start, end, display) {

						if (list.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								total_pcs = api

									.column(5)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(5).footer()).html(parseFloat(total_pcs));

								total_val = api

									.column(6)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(6).footer()).html(parseFloat(total_val).toFixed(2));

								total_wt = api

									.column(7)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(7).footer()).html(parseFloat(total_wt).toFixed(3));

							}

						} else {

							var api = this.api(), data;

							$(api.column(5).footer()).html('');

							$(api.column(6).footer()).html('');

							$(api.column(7).footer()).html('');

						}

					}

				});

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function set_dashboard_oldmetalList() {

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/dashboard_oldmetalList?nocache=" + my_Date.getUTCSeconds(),

		type: "POST",

		data: { 'from_date': ctrl_page[2], 'to_date': ctrl_page[3], 'type': ctrl_page[4], 'id_branch': ctrl_page[5] },

		dataType: "JSON",

		cache: false,

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.oldmetal_list;

			var oTable = $('#dash_oldmetal_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#dash_oldmetal_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: 'Old Metal',

						}

					],

					"aaData": list,

					"aoColumns": [{

						render: function (data, type, row, meta) {

							return meta.row + 1;

						}

					},

					{ "mDataProp": "firstname" },

					{

						"mDataProp": function (row, type, val, meta) {

							var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + row.bill_id;

							return '<a href=' + url + ' target="_blank">' + row.bill_no + '</a>';

						}

					},

					{ "mDataProp": "bill_date" },

					{ "mDataProp": "metal_type" },

					{ "mDataProp": "amount" },

					{ "mDataProp": "weight" },

					],

					"footerCallback": function (row, data, start, end, display) {

						if (list.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								total_amt = api

									.column(5)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(5).footer()).html(parseFloat(total_amt).toFixed(2));

								total_val = api

									.column(6)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(6).footer()).html(parseFloat(total_val).toFixed(3));

							}

						} else {

							var api = this.api(), data;

							$(api.column(5).footer()).html('');

							$(api.column(6).footer()).html('');

						}

					}

				});

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function set_dashboard_creditsalesList() {

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/dashboard_creditsalesList?nocache=" + my_Date.getUTCSeconds(),

		type: "POST",

		data: { 'from_date': ctrl_page[2], 'to_date': ctrl_page[3], 'type': ctrl_page[4], 'id_branch': ctrl_page[5] },

		dataType: "JSON",

		cache: false,

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.issrec_list;

			var oTable = $('#dash_issrec_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#dash_issrec_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: 'Credit Sales',

						}

					],

					"aaData": list,

					"aoColumns": [{

						render: function (data, type, row, meta) {

							return meta.row + 1;

						}

					},

					{

						"mDataProp": function (row, type, val, meta) {

							var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + row.bill_id;

							return '<a href=' + url + ' target="_blank">' + row.bill_no + '</a>';

						}

					},

					{ "mDataProp": "firstname" },

					{ "mDataProp": "bill_date" },

					{ "mDataProp": "amount" },

					],

					"footerCallback": function (row, data, start, end, display) {

						if (list.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								total_amt = api

									.column(4)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(4).footer()).html(parseFloat(total_amt).toFixed(2));

							}

						} else {

							var api = this.api(), data;

							$(api.column(4).footer()).html('');

						}

					}

				});

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function set_dashboard_giftcardList() {

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/dashboard_giftcardList?nocache=" + my_Date.getUTCSeconds(),

		type: "POST",

		data: { 'from_date': ctrl_page[2], 'to_date': ctrl_page[3], 'type': ctrl_page[4], 'id_branch': ctrl_page[5] },

		dataType: "JSON",

		cache: false,

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.giftcard_list;

			var oTable = $('#dash_giftcard_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#dash_giftcard_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: 'Gift Card',

						}

					],

					"aaData": list,

					"aoColumns": [{

						render: function (data, type, row, meta) {

							return meta.row + 1;

						}

					},

					{ "mDataProp": "firstname" },

					{ "mDataProp": "date" },

					{ "mDataProp": "amount" },

					],

					"footerCallback": function (row, data, start, end, display) {

						if (list.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								total_amt = api

									.column(3)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(3).footer()).html(parseFloat(total_amt).toFixed(2));

							}

						} else {

							var api = this.api(), data;

							$(api.column(4).footer()).html('');

						}

					}

				});

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function set_dashboard_virtualsalesList() {

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/dashboard_virtualsalesList?nocache=" + my_Date.getUTCSeconds(),

		type: "POST",

		data: { 'from_date': ctrl_page[2], 'to_date': ctrl_page[3], 'type': ctrl_page[4], 'id_branch': ctrl_page[5] },

		dataType: "JSON",

		cache: false,

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.virtual_list;

			var oTable = $('#dash_virtual_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#dash_virtual_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: 'Virtual Tag Sales',

						}

					],

					"aaData": list,

					"aoColumns": [{

						render: function (data, type, row, meta) {

							return meta.row + 1;

						}

					},

					{

						"mDataProp": function (row, type, val, meta) {

							var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + row.bill_id;

							return '<a href=' + url + ' target="_blank">' + row.bill_no + '</a>';

						}

					},

					{ "mDataProp": "firstname" },

					{ "mDataProp": "bill_date" },

					{ "mDataProp": "pcs" },

					{ "mDataProp": "gross_wt" },

					{ "mDataProp": "item_cost" },

					],

					"footerCallback": function (row, data, start, end, display) {

						if (list.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								total_pcs = api

									.column(4)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(4).footer()).html(parseFloat(total_pcs));

								total_wt = api

									.column(5)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(5).footer()).html(parseFloat(total_wt).toFixed(3));

								total_amt = api

									.column(6)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(6).footer()).html(parseFloat(total_amt).toFixed(2));

							}

						} else {

							var api = this.api(), data;

							$(api.column(4).footer()).html('');

							$(api.column(5).footer()).html('');

							$(api.column(6).footer()).html('');

						}

					}

				});

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function set_dashboard_lottagList() {

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/dashboard_lottagList?nocache=" + my_Date.getUTCSeconds(),

		type: "POST",

		data: { 'from_date': ctrl_page[2], 'to_date': ctrl_page[3], 'type': ctrl_page[4], 'id_branch': ctrl_page[5] },

		dataType: "JSON",

		cache: false,

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.lottag_list;

			var oTable = $('#dash_lottag_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#dash_lottag_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: 'Lot & Tag',

						}

					],

					"aaData": list,

					"aoColumns": [{

						render: function (data, type, row, meta) {

							return meta.row + 1;

						}

					},

					{ "mDataProp": "date" },

					{ "mDataProp": "piece" },

					{ "mDataProp": "gross_wt" },

					],

					"footerCallback": function (row, data, start, end, display) {

						if (list.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								total_pcs = api

									.column(2)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(2).footer()).html(parseFloat(total_pcs));

								total_wt = api

									.column(3)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(3).footer()).html(parseFloat(total_wt).toFixed(3));

							}

						} else {

							var api = this.api(), data;

							$(api.column(4).footer()).html('');

							$(api.column(5).footer()).html('');

							$(api.column(6).footer()).html('');

						}

					}

				});

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function set_dashboard_customerorderList() {

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/dashboard_customerorderList?nocache=" + my_Date.getUTCSeconds(),

		type: "POST",

		data: { 'from_date': ctrl_page[2], 'to_date': ctrl_page[3], 'type': ctrl_page[4], 'id_branch': ctrl_page[5] },

		dataType: "JSON",

		cache: false,

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.customerorder_list;

			var oTable = $('#dash_customerorder_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#dash_customerorder_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: 'Customer Order',

						}

					],

					"aaData": list,

					"aoColumns": [{

						render: function (data, type, row, meta) {

							return meta.row + 1;

						}

					},

					{ "mDataProp": "orderno" },

					{ "mDataProp": "branch" },

					{ "mDataProp": "order_date" },

					{ "mDataProp": "product_name" },

					{ "mDataProp": "weight" },

					{ "mDataProp": "rate" },

					],

					"footerCallback": function (row, data, start, end, display) {

						if (list.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								total_wt = api

									.column(5)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(5).footer()).html(parseFloat(total_wt).toFixed(3));

								total_rate = api

									.column(6)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(6).footer()).html(parseFloat(total_rate).toFixed(2));

							}

						} else {

							var api = this.api(), data;

							$(api.column(5).footer()).html('');

							$(api.column(6).footer()).html('');

						}

					}

				});

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function set_dashboard_greentagincentList() {

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/dashboard_greentagList_incent?nocache=" + my_Date.getUTCSeconds(),

		type: "POST",

		data: { 'from_date': ctrl_page[2], 'to_date': ctrl_page[3], 'id_branch': ctrl_page[4] },

		dataType: "JSON",

		cache: false,

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.greentagincent_list;

			var oTable = $('#dash_greentagincent_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#dash_greentagincent_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: 'Customer Order',

						}

					],

					"aaData": list,

					"aoColumns": [{

						render: function (data, type, row, meta) {

							return meta.row + 1;

						}

					},

					{

						"mDataProp": function (row, type, val, meta) {

							var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + row.bill_id;

							return '<a href=' + url + ' target="_blank">' + row.bill_no + '</a>';

						}

					},

					{ "mDataProp": "bill_date" },

					{ "mDataProp": "tag_id" },

					{ "mDataProp": "tag_date" },

					{ "mDataProp": "tag_code" },

					{ "mDataProp": "emp_name" },

					{ "mDataProp": "emp_code" },

					],

				});

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function set_dashboard_salereturnList() {

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/dashboard_salereturnList?nocache=" + my_Date.getUTCSeconds(),

		type: "POST",

		data: { 'from_date': ctrl_page[2], 'to_date': ctrl_page[3], 'id_branch': ctrl_page[4] },

		dataType: "JSON",

		cache: false,

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.salereturn_list;

			var oTable = $('#dash_salereturn_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#dash_salereturn_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: 'Sale Return',

						}

					],

					"aaData": list,

					"aoColumns": [{

						render: function (data, type, row, meta) {

							return meta.row + 1;

						}

					},

					{

						"mDataProp": function (row, type, val, meta) {

							var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + row.bill_id;

							return '<a href=' + url + ' target="_blank">' + row.bill_no + '</a>';

						}

					},

					{ "mDataProp": "bill_date" },

					{ "mDataProp": "firstname" },

					{ "mDataProp": "pcs" },

					{ "mDataProp": "wt" },

					],

					"footerCallback": function (row, data, start, end, display) {

						if (list.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								total_pcs = api

									.column(4)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(4).footer()).html(parseFloat(total_pcs));

								total_wt = api

									.column(5)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(5).footer()).html(parseFloat(total_wt).toFixed(3));

							}

						} else {

							var api = this.api(), data;

							$(api.column(5).footer()).html('');

							$(api.column(6).footer()).html('');

						}

					}

				});

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function set_dashboard_lotList() {

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/dashboard_lotList?nocache=" + my_Date.getUTCSeconds(),

		type: "POST",

		data: { 'from_date': ctrl_page[2], 'to_date': ctrl_page[3], 'type': ctrl_page[4], 'id_branch': ctrl_page[5] },

		dataType: "JSON",

		cache: false,

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.lot_list;

			var oTable = $('#dash_lot_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#dash_lot_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: 'Lot',

						}

					],

					"aaData": list,

					"aoColumns": [{

						render: function (data, type, row, meta) {

							return meta.row + 1;

						}

					},

					{

						"mDataProp": function (row, type, val, meta) {

							var url = base_url + 'index.php/admin_ret_tagging/get_tag_detail_list/' + row.lot_no;

							return '<a href=' + url + ' target="_blank">' + row.lot_no + '</a>';

						}

					},

					{ "mDataProp": "date" },

					{ "mDataProp": "firstname" },

					{ "mDataProp": "piece" },

					{ "mDataProp": "gross_wt" },

					],

					"footerCallback": function (row, data, start, end, display) {

						if (list.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								total_pcs = api

									.column(4)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(4).footer()).html(parseFloat(total_pcs));

								total_wt = api

									.column(5)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(5).footer()).html(parseFloat(total_wt).toFixed(3));

							}

						} else {

							var api = this.api(), data;

							$(api.column(4).footer()).html('');

							$(api.column(5).footer()).html('');

							$(api.column(6).footer()).html('');

						}

					}

				});

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function set_dashboard_tagList() {

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/dashboard_tagList?nocache=" + my_Date.getUTCSeconds(),

		type: "POST",

		data: { 'from_date': ctrl_page[2], 'to_date': ctrl_page[3], 'type': ctrl_page[4], 'id_branch': ctrl_page[5] },

		dataType: "JSON",

		cache: false,

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.tag_list;

			var oTable = $('#dash_tag_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#dash_tag_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: 'Tag',

						}

					],

					"aaData": list,

					"aoColumns": [{

						render: function (data, type, row, meta) {

							return meta.row + 1;

						}

					},

					{ "mDataProp": "tag_code" },

					{ "mDataProp": "design_name" },

					{ "mDataProp": "product_name" },

					{ "mDataProp": "date" },

					{ "mDataProp": "piece" },

					{ "mDataProp": "gross_wt" },

					{ "mDataProp": "net_wt" },

					],

					"footerCallback": function (row, data, start, end, display) {

						if (list.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								total_pcs = api

									.column(5)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(5).footer()).html(parseFloat(total_pcs));

								total_gwt = api

									.column(6)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(6).footer()).html(parseFloat(total_gwt).toFixed(3));

								total_nwt = api

									.column(7)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(7).footer()).html(parseFloat(total_nwt).toFixed(3));

							}

						} else {

							var api = this.api(), data;

							$(api.column(5).footer()).html('');

							$(api.column(6).footer()).html('');

							$(api.column(7).footer()).html('');

						}

					}

				});

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//Metal Stock Details

$('#report_type').on('change', function () {

	$('.purchase_item_details').css("display", "none");

	$('.sales_details').css("display", "none");

	if (this.value == 1 || this.value == 2 || this.value == 5) {

		$('.sales_details').css("display", "block");

	}

	else if (this.value == 3 || this.value == 4) {

		$('.purchase_item_details').css("display", "block");

	}

	if (ctrl_page[1] == 'cash_abstract') {

		$('.groupBy').css("display", "none");

		if (this.value == 1) {

			$('.groupBy').css("display", "block");

		}

	}

	if (ctrl_page[1] == 'branch_trans') {

		if (this.value == 2) {

			$('.groupBy').css("display", "block");

		}

		else {

			$('.groupBy').css("display", "none");

		}

	}

});

function get_metal_stock_details() {

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/metal_stock_details/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: { 'from_date': $('#rpt_payments1').html(), 'to_date': $('#rpt_payments2').html(), 'id_branch': $('#branch_select').val(), 'report_type': $('#report_type').val() },

		type: "POST",

		dataType: "JSON",

		cache: false,

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.list;

			$('#sales_details').dataTable().fnClearTable();

			var oTable = $('#sales_details').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#sales_details').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"columnDefs": [

						{

							targets: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12],

							className: 'dt-body-right'

						},

						{

							targets: [0],

							className: 'dt-body-left'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: 'Tag',

						}

					],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "product_name" },

						{

							"mDataProp": function (row, type, val, meta) {

								var op_blc_pcs = row.op_blc_pcs;

								return money_format_india(op_blc_pcs);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var op_blc_gwt = row.op_blc_gwt;

								return money_format_india(op_blc_gwt);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var op_blc_nwt = row.op_blc_nwt;

								return money_format_india(op_blc_nwt);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var inw_pcs = row.inw_pcs;

								return money_format_india(inw_pcs);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var inw_gwt = row.inw_gwt;

								return money_format_india(inw_gwt);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var inw_nwt = row.inw_nwt;

								return money_format_india(inw_nwt);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var outward_pcs = row.outward_pcs;

								return money_format_india(outward_pcs);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var outward_gwt = row.outward_gwt;

								return money_format_india(outward_gwt);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var outward_nwt = row.outward_nwt;

								return money_format_india(outward_nwt);

							}

						},

						{ "mDataProp": "closing_pcs" },

						{ "mDataProp": "closing_gwt" },

						{ "mDataProp": "closing_nwt" },

					],

					"footerCallback": function (row, data, start, end, display) {

						var cshtotal = 0;

						if (list.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								op_blc_pcs = api

									.column(1)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(1).footer()).html(parseFloat(op_blc_pcs).toFixed(0));

								op_blc_gwt = api

									.column(2)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(2).footer()).html(parseFloat(op_blc_gwt).toFixed(3));

								op_blc_nwt = api

									.column(3)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(3).footer()).html(parseFloat(op_blc_nwt).toFixed(3));

								inw_pcs = api

									.column(4)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(4).footer()).html(parseFloat(inw_pcs).toFixed(0));

								inw_gwt = api

									.column(5)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(5).footer()).html(parseFloat(inw_gwt).toFixed(3));

								inw_nwt = api

									.column(6)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(6).footer()).html(parseFloat(inw_nwt).toFixed(3));

								out_w_pcs = api

									.column(7)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(7).footer()).html(money_format_india(parseFloat(out_w_pcs).toFixed(0)));

								out_w_gwt = api

									.column(8)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(8).footer()).html(money_format_india(parseFloat(out_w_gwt).toFixed(3)));

								out_w_nwt = api

									.column(9)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(9).footer()).html(money_format_india(parseFloat(out_w_nwt).toFixed(3)));

								clc_pcs = api

									.column(10)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(10).footer()).html(parseFloat(clc_pcs).toFixed(0));

								clc_gwt = api

									.column(11)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(11).footer()).html(money_format_india(parseFloat(clc_gwt).toFixed(3)));

								clc_nwt = api

									.column(12)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(12).footer()).html(money_format_india(parseFloat(clc_nwt).toFixed(3)));

							}

						}

						else {

							var api = this.api(), data;

							$(api.column(7).footer()).html('');

						}

					}

				});

			}

		}

	});

}

function get_old_metal_stock_details() {

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/metal_stock_details/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: { 'from_date': $('#rpt_payments1').html(), 'to_date': $('#rpt_payments2').html(), 'id_branch': $('#branch_select').val(), 'report_type': $('#report_type').val() },

		type: "POST",

		dataType: "JSON",

		cache: false,

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.list;

			$('#purchase_item_details').dataTable().fnClearTable();

			var oTable = $('#purchase_item_details').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#purchase_item_details').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: 'Tag',

						}

					],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "metal_type" },

						{ "mDataProp": "op_blc_gwt" },

						{ "mDataProp": "op_blc_nwt" },

						{ "mDataProp": "inw_gwt" },

						{ "mDataProp": "inw_nwt" },

						{ "mDataProp": "br_out_gwt" },

						{ "mDataProp": "br_out_nwt" },

						{ "mDataProp": "closing_gwt" },

						{ "mDataProp": "closing_nwt" },

					],

					"footerCallback": function (row, data, start, end, display) {

						var cshtotal = 0;

						if (list.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								op_blc_gwt = api

									.column(1)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(1).footer()).html(parseFloat(op_blc_gwt).toFixed(3));

								op_blc_nwt = api

									.column(2)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(2).footer()).html(parseFloat(op_blc_nwt).toFixed(3));

								inw_gwt = api

									.column(3)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(3).footer()).html(parseFloat(inw_gwt).toFixed(3));

								inw_nwt = api

									.column(4)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(4).footer()).html(parseFloat(inw_nwt).toFixed(3));

								br_out_gwt = api

									.column(5)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(5).footer()).html(parseFloat(br_out_gwt).toFixed(3));

								br_out_nwt = api

									.column(6)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(6).footer()).html(parseFloat(br_out_nwt).toFixed(3));

								closing_gwt = api

									.column(7)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(7).footer()).html(parseFloat(closing_gwt).toFixed(3));

								closing_nwt = api

									.column(8)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(8).footer()).html(parseFloat(closing_nwt).toFixed(3));

							}

						}

						else {

							var api = this.api(), data;

							$(api.column(7).footer()).html('');

						}

					}

				});

			}

		}

	});

}

$('#acc_stock_report_type').on('change', function () {

	$('#old_metal').css("display", "none");

	$('#old_metal_process').css("display", "none");

	$('#stone_details').css("display", "none");

	if (this.value == 0) {

		$('#old_metal').css("display", "block");

	}

	else {

		$('#old_metal_process').css("display", "block");

	}

});

function get_metal_available_stock_details() {

	var company_name = $('#company_name').val();

	var from_date = '';

	var to_date = '';

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "Available Stock Report";

	var optional = '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/metal_available_stock_details/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: { 'id_branch': $('#branch_select').val() },

		type: "POST",

		dataType: "JSON",

		cache: false,

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.list;

			var oTable = $('#stock_details').DataTable();

			var groupColumn = 0;

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#stock_details').dataTable({

					"columnDefs": [

						{ "visible": false, "targets": groupColumn }

					],

					"drawCallback": function (settings) {

						var api = this.api();

						var rows = api.rows({ page: 'current' }).nodes();

						var last = null;

						api.column(groupColumn, { page: 'current' }).data().each(function (group, i) {

							if (last !== group) {

								$(rows).eq(i).before(

									'<tr class="group"><td colspan="6" style="text-align: left;"><b>' + group + '</b></td></tr>'

								);

								last = group;

							}

						});

					},

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"ordering": false,

					"dom": 'lBfrtip',

					"lengthMenu": [[-1, 25, 50, 100, 250], ["All", 25, 50, 100, 250]],

					"columnDefs": [

						{

							targets: [2, 3, 5],

							className: 'dt-body-right'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', '10px');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: 'Available Stock Report',

						}

					],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "type" },

						{

							"mDataProp": function (row, type, val, meta) {

								url = base_url + 'index.php/admin_ret_reports/acc_stock_details/list/' + row.id_stock_summary;

								action_content = '<a href="' + url + '" target="_blank" >' + row.product_name + '</a>'

								return action_content;

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var gross_wt = row.gross_wt;

								return money_format_india(gross_wt);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var net_wt = row.net_wt;

								return money_format_india(net_wt);

							}

						},

						{ "mDataProp": "purity" },

						{

							"mDataProp": function (row, type, val, meta) {

								if (row.rate == '-') {

									return row.rate

								} else {

									return money_format_india(parseFloat(row.rate));

								}

							}

						},

						{

							"mDataProp": null,

							"sClass": "control center",

							"sDefaultContent": '<span class="drill-val"><i class="fa fa-chevron-circle-down text-teal"></i></span>'

						},

					],

				});

				var anOpen = [];

				$(document).on('click', "#stock_details .control", function () {

					var nTr = this.parentNode;

					var i = $.inArray(nTr, anOpen);

					if (i === -1) {

						$('.drill-val', this).html('<i class="fa fa-chevron-circle-up text-teal"></i>');

						oTable.fnOpen(nTr, fnFormatRowOldMetalDetails(oTable, nTr), 'details');

						anOpen.push(nTr);

					}

					else {

						$('.drill-val', this).html('<i class="fa fa-chevron-circle-down text-teal"></i>');

						oTable.fnClose(nTr);

						anOpen.splice(i, 1);

					}

				});

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function fnFormatRowOldMetalDetails(oTable, nTr) {

	var oData = oTable.fnGetData(nTr);

	if (oData.item_type == 0) {

		var rowDetail = '';

		var prodTable =

			'<div class="innerDetails">' +

			'<table class="table table-responsive table-bordered text-center table-sm">' +

			'<tr class="bg-teal">' +

			'<th>S.No</th>' +

			'<th>Bill Date</th>' +

			'<th>Branch</th>' +

			'<th>Bill No</th>' +

			'<th>Customer</th>' +

			'<th>Gross Wt</th>' +

			'<th>Net Wt</th>' +

			'<th>Purity</th>' +

			'</tr>';

		var sales_details = oData.item_details;

		var total_gross_wt = 0;

		var total_net_wt = 0;

		$.each(sales_details, function (idx, val) {

			total_net_wt += parseFloat(val.net_wt);

			total_gross_wt += parseFloat(val.gross_wt);

			print_url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + val.bill_id;

			prodTable +=

				'<tr class="prod_det_btn">' +

				'<td>' + parseFloat(idx + 1) + '</td>' +

				'<td>' + val.bill_date + '</td>' +

				'<td>' + val.bill_from + '</td>' +

				'<td><a href="' + print_url + '" target="_blank" title="Billing Receipt">' + val.bill_no + '</a></td>' +

				'<td>' + val.cus_name + '</td>' +

				'<td>' + val.gross_wt + '</td>' +

				'<td>' + val.net_wt + '</td>' +

				'<td>' + val.purity + '</td>' +

				'</tr>';

		});

		prodTable +=

			'<tr class="prod_det_btn;color:red">' +

			'<td colspan="5"><strong>Total</strong></td>' +

			'<td><strong>' + money_format_india(parseFloat(total_gross_wt).toFixed(3)) + '</td></strong>' +

			'<td><strong>' + money_format_india(parseFloat(total_net_wt).toFixed(3)); +'</strong></td>' +

				'</tr>';

		rowDetail = prodTable + '</table></div>';

	}

	else if (oData.item_type == 1) {

		var rowDetail = '';

		var prodTable =

			'<div class="innerDetails">' +

			'<table class="table table-responsive table-bordered text-center table-sm">' +

			'<tr class="bg-teal">' +

			'<th>S.No</th>' +

			'<th>Tag No</th>' +

			'<th>Gross Wt</th>' +

			'<th>Net Wt</th>' +

			'<th>Sold Gwt</th>' +

			'<th>Sold Nwt</th>' +

			'<th>Blc Gwt</th>' +

			'<th>Blc Nwt</th>' +

			'</tr>';

		var sales_details = oData.item_details;

		var total_gross_wt = 0;

		var total_net_wt = 0;

		$.each(sales_details, function (idx, val) {

			total_net_wt += parseFloat(val.blc_nwt);

			total_gross_wt += parseFloat(val.blc_gwt);

			print_url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + val.bill_id;

			prodTable +=

				'<tr class="prod_det_btn">' +

				'<td>' + parseFloat(idx + 1) + '</td>' +

				'<td>' + val.tag_code + '</td>' +

				'<td>' + val.gross_wt + '</td>' +

				'<td>' + val.net_wt + '</td>' +

				'<td>' + val.sold_gwt + '</td>' +

				'<td>' + val.sold_nwt + '</td>' +

				'<td>' + val.blc_gwt + '</td>' +

				'<td>' + val.blc_nwt + '</td>' +

				'</tr>';

		});

		prodTable +=

			'<tr class="prod_det_btn">' +

			'<td colspan="6"><strong>Total</strong></td>' +

			'<td><strong>' + parseFloat(total_gross_wt).toFixed(3) + '</td></strong>' +

			'<td><strong>' + parseFloat(total_net_wt).toFixed(3); +'</strong></td>' +

				'</tr>';

		rowDetail = prodTable + '</table></div>';

	}

	else if (oData.item_type == 2) {

		var rowDetail = '';

	}

	return rowDetail;

}

//Metal Stock Details

//PO Bills details start here

function get_po_bills_details() {

	var company_name = $('#company_name').val();

	var from_date = $('#rpt_from_date').html();

	var to_date = $('#rpt_to_date').html();

	var branch_name = ''

	var report_name = "SUPPLIER BILL REPORT"

	var optional = '';

	var report_type = $('#report_type').val();

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/purchase/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: {

			'from_date': from_date, 'to_date': to_date, 'karigar': $('#karigar').val(), 'grn_type': $('#grn_type').val(), 'id_category': $('#category').val(), 'id_product': $('#prod_select').val(), 'id_design': $('#des_select').val(),

			'id_sub_design': $('#sub_des_select').val(), 'id_metal': $('#metal').val(), 'report_type': $('#report_type').val(),

			'bill_type': $('#bill_type').val(), 'type': $('#purchase_type').val()

		},

		type: "POST",

		dataType: "JSON",

		cache: false,

		success: function (data) {

			$("div.overlay").css("display", "none");

			var bill_details = data.list;

			$("#purchase_bills > tbody > tr").remove();

			$('#purchase_bills').dataTable().fnClearTable();

			$('#purchase_bills').dataTable().fnDestroy();

			$("#summary_bills > tbody > tr").remove();

			$('#summary_bills').dataTable().fnClearTable();

			$('#summary_bills').dataTable().fnDestroy();

			if (bill_details != '') {

				if (report_type == 1) {

					var trHtml = '';

					var tot_no_of_pcs = 0;

					var tot_gross_wt = 0;

					var tot_less_wt = 0;

					var tot_net_wt = 0;

					var tot_stwt = 0;

					var tot_otheramount = 0;

					var tot_stamount = 0;

					var tot_item_cost = 0;

					var tot_item_tax = 0;

					var tot_purewt = 0;

					var tot_nt_stwt = 0;

					$.each(bill_details, function (key, item_details) {

						var no_of_pcs = 0;

						var gross_wt = 0;

						var less_wt = 0;

						var net_wt = 0;

						var stwt = 0;

						var otheramount = 0;

						var stamount = 0;

						var item_cost = 0;

						var item_tax = 0;

						var purewt = 0;

						var nt_stwt = 0;

						$.each(item_details, function (key, val) {

							no_of_pcs += parseFloat(val.no_of_pcs);

							gross_wt += (val.stone_type != 2 ? parseFloat(val.gross_wt) : 0);

							less_wt += parseFloat(val.less_wt);

							net_wt += (val.stone_type != 2 ? parseFloat(val.net_wt) : 0);

							stwt += (val.stone_type == 2 ? parseFloat(val.gross_wt) : parseFloat(val.stwt));

							nt_stwt += parseFloat(val.nt_stwt);

							purewt += parseFloat(val.purewt);

							otheramount += parseFloat(val.otheramount);

							stamount += parseFloat(val.stamount);

							item_cost += parseFloat(parseFloat(val.item_cost));

							item_tax += parseFloat(val.total_tax);

							tot_no_of_pcs += parseFloat(val.no_of_pcs);

							tot_gross_wt += (val.stone_type != 2 ? parseFloat(val.gross_wt) : 0);

							tot_less_wt += parseFloat(val.less_wt);

							tot_net_wt += (val.stone_type != 2 ? parseFloat(val.net_wt) : 0);

							tot_stwt += (val.stone_type == 2 ? parseFloat(val.gross_wt) : parseFloat(val.stwt));

							tot_nt_stwt += parseFloat(val.nt_stwt);

							tot_purewt += parseFloat(val.purewt);

							tot_otheramount += parseFloat(val.otheramount);

							tot_stamount += parseFloat(val.stamount);

							tot_item_cost += parseFloat(parseFloat(val.item_cost));

							tot_item_tax += parseFloat(val.total_tax);

							if (val.stamount > 0) {

								action_content = '<a href=# class="" onclick="po_stone_details(' + val.po_item_id + ');">' + money_format_india(val.stamount) + '</a>';

							}

							else {

								action_content = money_format_india(val.stamount);

							}

							trHtml += '<tr>'

								+ '<td>' + parseFloat(key + 1) + '</td>'

								+ '<td>' + val.grn_ref_no + '</td>'

								+ '<td>' + val.po_ref_no + '</td>'

								+ '<td>' + val.po_date + '</td>'

								+ '<td>' + val.karigar + '</td>'

								+ '<td>' + val.category_name + '</td>'

								+ '<td>' + val.purity + '</td>'

								+ '<td>' + val.product_name + '</td>'

								+ '<td>' + val.design_name + '</td>'

								+ '<td>' + val.sub_design_name + '</td>'

								+ '<td>' + val.no_of_pcs + '</td>'

								+ '<td>' + (val.stone_type != 2 ? (val.gross_wt + ' ' + val.uom_name) : '0.000') + '</td>'

								+ '<td>' + val.less_wt + '</td>'

								+ '<td>' + (val.stone_type != 2 ? val.net_wt : '0.000') + '</td>'

								+ '<td>' + (val.stone_type == 2 ? val.gross_wt : val.stwt) + '</td>'

								+ '<td>' + val.nt_stwt + '</td>'

								+ '<td>' + val.item_wastage + '</td>'

								+ '<td>' + val.mc_type + '</td>'

								+ '<td>' + val.mc_value + '</td>'

								+ '<td>' + val.purchase_touch + '</td>'

								+ '<td>' + val.purewt + '</td>'

								+ '<td>' + val.fix_rate_per_grm + '</td>'

								+ '<td>' + money_format_india(val.otheramount) + '</td>'

								+ '<td>' + action_content + '</td>'

								+ '<td>' + money_format_india(parseFloat(val.item_cost - val.total_tax).toFixed(2)) + '</td>'

								+ '<td>' + money_format_india(parseFloat(val.total_tax).toFixed(2)) + '</td>'

								+ '<td>' + money_format_india(parseFloat(val.item_cost).toFixed(2)) + '</td>'

								+ '<td>' + val.remark + '</td>'

								+ '<td>' + val.emp_name + '</td>'

								+ '</tr>';

						});

						trHtml += '<tr style="font-weight:bold; color:red">'

							+ '<td><strong>SUB TOTAL</strong></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td><strong>' + parseFloat(no_of_pcs) + '</strong></td>'

							+ '<td><strong>' + parseFloat(gross_wt).toFixed(3) + '</strong></td>'

							+ '<td><strong>' + parseFloat(less_wt).toFixed(3) + '</strong></td>'

							+ '<td><strong>' + parseFloat(net_wt).toFixed(3) + '</strong></td>'

							+ '<td><strong>' + parseFloat(stwt).toFixed(3) + '</strong></td>'

							+ '<td><strong>' + parseFloat(nt_stwt).toFixed(3) + '</strong></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td>' + parseFloat(purewt).toFixed(3) + '</strong></td>'

							+ '<td></td>'

							+ '<td><strong>' + money_format_india(parseFloat(otheramount).toFixed(2)) + '</strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(stamount).toFixed(2)) + '</strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(parseFloat(item_cost) - parseFloat(item_tax)).toFixed(2)) + '</strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(item_tax).toFixed(2)) + '</strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(item_cost).toFixed(2)) + '</strong></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '</tr>';

					});

					trHtml += '<tr style="font-weight:bold; color: blue">'

						+ '<td><strong>GRAND TOTAL</b></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td><strong>' + parseFloat(tot_no_of_pcs) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(tot_gross_wt).toFixed(3)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(tot_less_wt).toFixed(3)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(tot_net_wt).toFixed(3)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(tot_stwt).toFixed(3)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(tot_nt_stwt).toFixed(3)) + '</strong></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td><strong>' + parseFloat(tot_purewt).toFixed(3) + '</strong></td>'

						+ '<td></td>'

						+ '<td><strong>' + money_format_india(parseFloat(tot_otheramount).toFixed(2)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(tot_stamount).toFixed(2)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(parseFloat(tot_item_cost) - parseFloat(tot_item_tax)).toFixed(2)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(tot_item_tax).toFixed(2)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(tot_item_cost).toFixed(2)) + '</strong></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '</tr>';

					$('#purchase_bills > tbody').html(trHtml);

					// Check and initialise datatable

					if (!$.fn.DataTable.isDataTable('#purchase_bills')) {

						oTable = $('#purchase_bills').dataTable({

							"bSort": false,

							"bInfo": true,

							"scrollX": '100%',

							"dom": 'lBfrtip',

							"paging": false,

							"fixedHeader": true,

							"autoWidth": true,

							"columnDefs": [

								{

									targets: [9, 10, 11, 12, 13, 14, 15, 16, 17, 18, , 19, 20, 21, 22, 23, 24],

									className: 'dt-body-right'

								}

							],

							"buttons": [

								{

									extend: 'print',

									footer: true,

									title: '',

									messageTop: title,

									exportOptions: {

										columns: ':visible'

									},

									customize: function (win) {

										$(win.document.body).find('table')

											.addClass('compact')

											.css('font-size', '10px')

										// .css('font-family', 'sans-serif');

									},

								},

								'colvis',

								{

									extend: 'excel',

									footer: true,

									title: 'PURCHASE BILL REPORT',

								}

							],

						});

					}

				} else {

					$("#summary_bills > tbody > tr").remove();

					$('#summary_bills').dataTable().fnClearTable();

					$('#summary_bills').dataTable().fnDestroy();

					var trHtml = '';

					var sno = 1;

					var tot_no_of_pcs = 0;

					var tot_gross_wt = 0;

					var tot_less_wt = 0;

					var tot_net_wt = 0;

					var tot_stwt = 0;

					var tot_nt_stwt = 0;

					var tot_otheramount = 0;

					var tot_stamount = 0;

					var tot_item_cost = 0;

					var tot_purewt = 0;

					var total_item_tax = 0;

					$.each(bill_details, function (vkey, item_details) {

						var no_of_pcs = 0;

						var gross_wt = 0;

						var less_wt = 0;

						var net_wt = 0;

						var stwt = 0;

						var nt_stwt = 0;

						var otheramount = 0;

						var stamount = 0;

						var item_cost = 0;

						var purewt = 0;

						var item_tax = 0;

						$.each(item_details, function (tkey, val) {

							no_of_pcs += parseFloat(val.no_of_pcs);

							gross_wt += (val.stone_type != 2 ? parseFloat(val.gross_wt) : 0);

							less_wt += parseFloat(val.less_wt);

							net_wt += (val.stone_type != 2 ? parseFloat(val.net_wt) : 0);

							stwt += (val.stone_type == 2 ? parseFloat(val.gross_wt) : parseFloat(val.stwt));

							purewt += parseFloat(val.purewt);

							otheramount += parseFloat(val.otheramount);

							stamount += parseFloat(val.stamount);

							item_cost += parseFloat(val.item_cost);

							tot_no_of_pcs += parseFloat(val.no_of_pcs);

							tot_gross_wt += (val.stone_type != 2 ? parseFloat(val.gross_wt) : 0);

							tot_less_wt += parseFloat(val.less_wt);

							tot_net_wt += (val.stone_type != 2 ? parseFloat(val.net_wt) : 0);

							tot_stwt += (val.stone_type == 2 ? parseFloat(val.gross_wt) : parseFloat(val.stwt));

							tot_nt_stwt += parseFloat(val.nt_stwt);

							tot_purewt += parseFloat(val.purewt);

							tot_otheramount += parseFloat(val.otheramount);

							tot_stamount += parseFloat(val.stamount);

							tot_item_cost += parseFloat(val.item_cost);

							total_item_tax += parseFloat(val.total_tax);

							if (val.stamount > 0) {

								action_content = '<a href=# class="" onclick="po_stone_details(' + val.po_item_id + ');">' + money_format_india(val.stamount) + '</a>';

							}

							else {

								action_content = money_format_india(val.stamount);

							}

							console.log(tkey);

							trHtml += '<tr>'

								+ '<td>' + sno + '</td>'

								+ '<td>' + val.grn_ref_no + '</td>'

								+ '<td>' + val.po_ref_no + '</td>'

								+ '<td>' + val.po_date + '</td>'

								+ '<td>' + val.karigar + '</td>'

								+ '<td>' + val.no_of_pcs + '</td>'

								+ '<td>' + (val.stone_type != 2 ? parseFloat(val.gross_wt) : '0.000') + '</td>'

								+ '<td>' + val.less_wt + '</td>'

								+ '<td>' + (val.stone_type != 2 ? parseFloat(val.net_wt) : '0.000') + '</td>'

								+ '<td>' + (val.stone_type == 2 ? parseFloat(val.gross_wt) : parseFloat(val.stwt)) + '</td>'

								+ '<td>' + val.nt_stwt + '</td>'

								+ '<td>' + val.item_wastage + '</td>'

								+ '<td>' + val.mc_type + '</td>'

								+ '<td>' + val.mc_value + '</td>'

								+ '<td>' + val.purchase_touch + '</td>'

								+ '<td>' + val.purewt + '</td>'

								+ '<td>' + val.fix_rate_per_grm + '</td>'

								+ '<td>' + money_format_india(val.otheramount) + '</td>'

								+ '<td>' + action_content + '</td>'

								+ '<td>' + money_format_india(parseFloat(parseFloat(val.item_cost) - parseFloat(val.total_tax)).toFixed(2)) + '</td>'

								+ '<td>' + money_format_india(parseFloat(val.total_tax).toFixed(2)) + '</td>'

								+ '<td>' + money_format_india(parseFloat(val.item_cost).toFixed(2)) + '</td>'

								+ '<td>' + val.emp_name + '</td>'

								+ '</tr>';

							sno++;

						});

					});

					trHtml += '<tr style="font-weight:bold; color: blue">'

						+ '<td><b>GRAND TOTAL</b></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td>' + parseFloat(tot_no_of_pcs) + '</td>'

						+ '<td>' + money_format_india(parseFloat(tot_gross_wt).toFixed(3)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(tot_less_wt).toFixed(3)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(tot_net_wt).toFixed(3)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(tot_stwt).toFixed(3)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(tot_nt_stwt).toFixed(3)) + '</td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td>' + parseFloat(tot_purewt).toFixed(3) + '</td>'

						+ '<td></td>'

						+ '<td>' + money_format_india(parseFloat(tot_otheramount).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(tot_stamount).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(parseFloat(tot_item_cost) - parseFloat(total_item_tax)).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(total_item_tax).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(parseFloat(tot_item_cost)).toFixed(2)) + '</td>'

						+ '<td></td>'

						+ '</tr>';

					$('#summary_bills > tbody').html(trHtml);

					// Check and initialise datatable

					if (!$.fn.DataTable.isDataTable('#summary_bills')) {

						oTable = $('#summary_bills').dataTable({

							"bSort": false,

							"bInfo": true,

							"scrollX": '100%',

							"dom": 'lBfrtip',

							"paging": false,

							"fixedHeader": true,

							"autoWidth": true,

							"columnDefs": [

								{

									targets: [4, 5, 6, 7, 8, 9, 11, 12, 13, 14, 15, 16, 17, 18, 19],

									className: 'dt-body-right'

								}

							],

							"buttons": [

								{

									extend: 'print',

									footer: true,

									title: '',

									messageTop: title,

									exportOptions: {

										columns: ':visible'

									},

									customize: function (win) {

										$(win.document.body).find('table')

											.addClass('compact')

											.css('font-size', '12px')

											.css('font-family', 'sans-serif');

									},

								},

								'colvis',

								{

									extend: 'excel',

									footer: true,

									title: 'PURCHASE BILL REPORT',

								}

							],

						});

					}

				}

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

$('#pur_type').on('change', function () {

	$('.stock_details').css("display", "none");

	$('.summary_details').css("display", "none");

	if (this.value == 1) {

		$('.stock_details').css("display", "block");

		$('.pur_product').css("display", "block");

		$('.pur_category').css("display", "block");

		$('.pur_design').css("display", "block");

		$('.pur_sub_design').css("display", "block");

		$('.tag_code').css("display", "block");

		$('.bt_code').css("display", "block");

	} else if (this.value == 2) {

		$('.summary_details').css("display", "block");

		$('.pur_product').css("display", "none");

		$('.pur_category').css("display", "none");

		$('.pur_design').css("display", "none");

		$('.pur_sub_design').css("display", "none");

		$('.tag_code').css("display", "none");

		$('.bt_code').css("display", "none");

	}

});

//PO Bills details end here

//GRN Bills details start here

$('#grn_report_type').on('change', function () {

	$('.cat_filter').css("display", "none");

	if (this.value == 2) {

		$('.cat_filter').css("display", "block");

	}

});

function get_charges() {

	my_Date = new Date();

	$.ajax({

		url: base_url + 'index.php/admin_ret_catalog/charges/getActiveChargesList/?nocache=' + my_Date.getUTCSeconds(),

		dataType: "json",

		method: "GET",

		success: function (data) {

			charges_master_details = data;

		}

	});

}

function get_grn_bills_details() {

	var from_date = $('#rpt_from_date').html();

	var to_date = $('#rpt_to_date').html();

	var report_type = $('#grn_report_type').val();

	var company_name = $('#company_name').val();

	var from_date = $('#rpt_from_date').html();

	var to_date = $('#rpt_to_date').html();

	var branch_name = ''

	var report_name = "GRN BIll REPORT"

	var optional = '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/grnbills/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: { 'from_date': $('#rpt_from_date').html(), 'to_date': $('#rpt_to_date').html(), 'type': $('#pur_type').val(), 'karigar': $('#karigar').val(), 'id_category': $('#category').val(), 'report_type': $('#grn_report_type').val(), 'bill_type': $('#bill_type').val(), 'grn_type': $('#grn_type').val() },

		type: "POST",

		dataType: "JSON",

		cache: false,

		success: function (data) {

			$("div.overlay").css("display", "none");

			$("div.overlay").css("display", "none");

			var grn_bills = data.list;

			$("#grn_bills > tbody > tr").remove();

			$('#grn_bills').dataTable().fnClearTable();

			$('#grn_bills').dataTable().fnDestroy();

			if (grn_bills != '') {

				var trHtml = '';

				var tot_grn_gross_wt = 0;

				var tot_grn_less_wt = 0;

				var tot_grn_net_wt = 0;

				var tot_grnstonewt = 0;

				var tot_grndiaamount = 0;

				var tot_taxable_amt = 0;

				var tot_grn_item_cgst = 0;

				var tot_grn_item_sgst = 0;

				var tot_grn_item_igst = 0;

				var tot_grn_item_gst_rate = 0;

				var tot_grn_pay_tds_value = 0;

				var tot_grn_tcs_value = 0;

				var tot_otherchargecgst = 0;

				var tot_otherchargesgst = 0;

				var tot_otherchargeigst = 0;

				var tot_grn_other_charges_tds_value = 0;

				var tot_grn_discount = 0;

				var tot_grn_round_off = 0;

				var tot_grn_purchase_amt = 0;

				var tot_grnothercharge = 0;

				var charge_details = '';

				$.each(charges_master_details, function (k, val) {

					charge_details += '<td></td>';

				});

				$.each(grn_bills, function (key, item_details) {

					var taxable_amt = 0;

					var grn_gross_wt = 0;

					var grn_less_wt = 0;

					var grn_net_wt = 0;

					var grnstonewt = 0;

					var grndiaamount = 0;

					var grn_item_cgst = 0;

					var grn_item_sgst = 0;

					var grn_item_igst = 0;

					var grn_item_gst_rate = 0;

					var grn_pay_tds_percent = 0;

					var grn_tcs_percent = 0;

					var grn_pay_tds_value = 0;

					var grn_tcs_value = 0;

					var grnothercharge = 0;

					var otherchargecgst = 0;

					var otherchargesgst = 0;

					var otherchargeigst = 0;

					var grn_other_charges_tds_percent = 0;

					var grn_other_charges_tds_value = 0;

					var grn_discount = 0;

					var grn_purchase_amt = 0;

					var grn_round_off = 0;

					var grn_charge_details = [];

					$.each(item_details, function (key, val) {

						grn_charge_details = val.grn_charges_details;

						var item_taxable_amt = parseFloat(parseFloat(val.grn_item_cost) - parseFloat(val.grn_item_gst_rate)).toFixed(2);

						taxable_amt += parseFloat(parseFloat(val.grn_item_cost) - parseFloat(val.grn_item_gst_rate));

						grn_gross_wt += parseFloat(val.grn_gross_wt);

						grn_less_wt += parseFloat(val.grn_less_wt);

						grn_net_wt += parseFloat(val.grn_net_wt);

						grnstonewt += parseFloat(val.grnstonewt);

						grndiaamount += parseFloat(val.grndiaamount);

						grn_item_cgst += parseFloat(val.grn_item_cgst);

						grn_item_sgst += parseFloat(val.grn_item_sgst);

						grn_item_igst += parseFloat(val.grn_item_igst);

						grn_item_gst_rate += parseFloat(val.grn_item_gst_rate);

						grn_pay_tds_value = parseFloat(val.grn_pay_tds_value);

						grn_pay_tds_percent = parseFloat(val.grn_pay_tds_percent);

						grn_tcs_percent = parseFloat(val.grn_tcs_percent);

						grn_tcs_value = parseFloat(val.grn_tcs_value);

						grnothercharge = parseFloat(val.grnothercharge);

						otherchargecgst = parseFloat(val.otherchargecgst);

						otherchargesgst = parseFloat(val.otherchargesgst);

						otherchargeigst = parseFloat(val.otherchargeigst);

						grn_other_charges_tds_percent = parseFloat(val.grn_other_charges_tds_percent);

						grn_other_charges_tds_value = parseFloat(val.grn_other_charges_tds_value);

						grn_discount = parseFloat(val.grn_discount);

						grn_purchase_amt = parseFloat(val.grn_purchase_amt);

						grn_round_off = parseFloat(val.grn_round_off);

						var grn_other_itm_grs_weight = 0;

						var charges_html = '';

						$.each(grn_charge_details, function (k, ch) {

							if (report_type == 2) {

								charges_html += '<td></td>';

							} else {

								charges_html += '<td style="text-align:right;">' + ch.grn_charge_value + '</td>';

							}

						});

						$.each(val.other_metal_details, function (k, omd) {

							grn_other_itm_grs_weight += parseFloat(omd.grn_other_itm_grs_weight);

						});

						trHtml += '<tr>'

							+ '<td>' + val.grn_ref_no + '</td>'

							+ '<td>' + val.grndate + '</td>'

							+ '<td>' + val.grn_ref_date + '</td>'

							+ '<td>' + val.karigar + '</td>'

							+ '<td>' + val.grn_supplier_ref_no + '</td>'

							+ '<td>' + val.address + '</td>'

							+ '<td>' + val.statename + '</td>'

							+ '<td>' + val.gst_number + '</td>'

							+ '<td>' + val.panno + '</td>'

							+ '<td>' + val.category + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(parseFloat(val.grn_gross_wt).toFixed(3)) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(val.grn_less_wt) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(val.grn_net_wt) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(val.grnstonewt) + '</td>'

							+ '<td style="text-align:right;">' + (val.grndiaamount) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(val.grn_wastage) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(item_taxable_amt) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(val.grn_item_gst_value) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(val.grn_item_cgst) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(val.grn_item_sgst) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(val.grn_item_igst) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(val.grn_item_gst_rate) + '</td>'

							+ '<td style="text-align:right;">' + (report_type == 1 ? money_format_india(val.grn_pay_tds_percent) : '') + '</td>'

							+ '<td style="text-align:right;">' + (report_type == 1 ? money_format_india(val.grn_pay_tds_value) : '') + '</td>'

							+ '<td style="text-align:right;">' + (report_type == 1 ? money_format_india(val.grn_tcs_percent) : '') + '</td>'

							+ '<td style="text-align:right;">' + (report_type == 1 ? money_format_india(val.grn_tcs_value) : '') + '</td>'

							+ charges_html

							+ '<td style="text-align:right;">' + (report_type == 1 ? money_format_india(val.otherchargecgst) : '') + '</td>'

							+ '<td style="text-align:right;">' + (report_type == 1 ? money_format_india(val.otherchargesgst) : '') + '</td>'

							+ '<td style="text-align:right;">' + (report_type == 1 ? money_format_india(val.otherchargeigst) : '') + '</td>'

							+ '<td style="text-align:right;">' + (report_type == 1 ? money_format_india(val.grn_other_charges_tds_percent) : '') + '</td>'

							+ '<td style="text-align:right;">' + (report_type == 1 ? money_format_india(val.grn_other_charges_tds_value) : '') + '</td>'

							+ '<td style="text-align:right;">' + (report_type == 1 ? money_format_india(val.grn_discount) : '') + '</td>'

							+ '<td style="text-align:right;">' + (report_type == 1 ? money_format_india(val.grn_round_off) : '') + '</td>'

							+ '<td style="text-align:right;">' + (report_type == 1 ? money_format_india(val.grn_purchase_amt) : '') + '</td>'

							+ '</tr>';

						if (report_type == 2) {

							var other_metal_details = val.other_metal_details;

							if (other_metal_details.length > 0) {

								$.each(other_metal_details, function (k, omd) {

									trHtml += '<tr>'

										+ '<td></td>'

										+ '<td></td>'

										+ '<td></td>'

										+ '<td></td>'

										+ '<td></td>'

										+ '<td></td>'

										+ '<td></td>'

										+ '<td></td>'

										+ '<td></td>'

										+ '<td>' + omd.cat_name + '</td>'

										+ '<td></td>'

										+ '<td></td>'

										+ '<td style="text-align:right;">' + omd.grn_other_itm_grs_weight + '</td>'

										+ '<td></td>'

										+ '<td></td>'

										+ '<td></td>'

										+ '<td style="text-align:right;">' + omd.grn_other_itm_amount + '</td>'

										+ '<td></td>'

										+ '<td></td>'

										+ '<td></td>'

										+ '<td></td>'

										+ '<td></td>'

										+ '<td></td>'

										+ '<td></td>'

										+ '<td></td>'

										+ '<td></td>'

										+ charges_html

										+ '<td></td>'

										+ '<td></td>'

										+ '<td></td>'

										+ '<td></td>'

										+ '<td></td>'

										+ '<td></td>'

										+ '<td></td>'

										+ '<td></td>'

										+ '</tr>';

								});

							}

						}

					});

					if (report_type == 2) {

						var sub_total_charges_html = '';

						$.each(grn_charge_details, function (k, ch) {

							sub_total_charges_html += '<td style="text-align:right;">' + ch.grn_charge_value + '</td>';

						});

						trHtml += '<tr style="font-weight:bold;">'

							+ '<td>SUB TOTAL</td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td style="text-align:right;">' + money_format_india(parseFloat(grn_gross_wt).toFixed(3)) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(parseFloat(grn_less_wt).toFixed(3)) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(parseFloat(grn_net_wt).toFixed(3)) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(parseFloat(grnstonewt).toFixed(3)) + '</td>'

							+ '<td style="text-align:right;">' + parseFloat(grndiaamount).toFixed(3) + '</td>'

							+ '<td></td>'

							+ '<td style="text-align:right;">' + money_format_india(parseFloat(taxable_amt).toFixed(2)) + '</td>'

							+ '<td></td>'

							+ '<td style="text-align:right;">' + money_format_india(parseFloat(grn_item_cgst).toFixed(2)) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(parseFloat(grn_item_sgst).toFixed(2)) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(parseFloat(grn_item_igst).toFixed(2)) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(parseFloat(grn_item_gst_rate).toFixed(2)) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(parseFloat(grn_pay_tds_percent).toFixed(2)) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(parseFloat(grn_pay_tds_value).toFixed(2)) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(parseFloat(grn_tcs_percent).toFixed(2)) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(parseFloat(grn_tcs_value).toFixed(2)) + '</td>'

							+ sub_total_charges_html

							+ '<td style="text-align:right;">' + money_format_india(parseFloat(otherchargecgst).toFixed(2)) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(parseFloat(otherchargesgst).toFixed(2)) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(parseFloat(otherchargeigst).toFixed(2)) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(parseFloat(grn_other_charges_tds_percent).toFixed(2)) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(parseFloat(grn_other_charges_tds_value).toFixed(2)) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(parseFloat(grn_discount).toFixed(2)) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(parseFloat(grn_round_off).toFixed(2)) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(parseFloat(grn_purchase_amt).toFixed(2)) + '</td>'

							+ '</tr>';

					}

					tot_grn_gross_wt = parseFloat(tot_grn_gross_wt) + parseFloat(grn_gross_wt);

					tot_grn_less_wt = parseFloat(tot_grn_less_wt) + parseFloat(grn_less_wt);

					tot_grn_net_wt = parseFloat(tot_grn_net_wt) + parseFloat(grn_net_wt);

					tot_grnstonewt = parseFloat(tot_grnstonewt) + parseFloat(grnstonewt);

					tot_grndiaamount = parseFloat(tot_grndiaamount) + parseFloat(grndiaamount);

					tot_taxable_amt = parseFloat(tot_taxable_amt) + parseFloat(taxable_amt);

					tot_grn_item_cgst = parseFloat(tot_grn_item_cgst) + parseFloat(grn_item_cgst);

					tot_grn_item_sgst = parseFloat(tot_grn_item_sgst) + parseFloat(grn_item_sgst);

					tot_grn_item_igst = parseFloat(tot_grn_item_igst) + parseFloat(grn_item_igst);

					tot_grn_item_gst_rate = parseFloat(tot_grn_item_gst_rate) + parseFloat(grn_item_gst_rate);

					tot_grn_pay_tds_value = parseFloat(tot_grn_pay_tds_value) + parseFloat(grn_pay_tds_value);

					tot_grn_tcs_value = parseFloat(tot_grn_tcs_value) + parseFloat(grn_tcs_value);

					tot_grnothercharge = parseFloat(tot_grnothercharge) + parseFloat(grnothercharge);

					tot_otherchargecgst = parseFloat(tot_otherchargecgst) + parseFloat(otherchargecgst);

					tot_otherchargesgst = parseFloat(tot_otherchargesgst) + parseFloat(otherchargesgst);

					tot_otherchargeigst = parseFloat(tot_otherchargeigst) + parseFloat(otherchargeigst);

					tot_grn_other_charges_tds_value = parseFloat(tot_grn_other_charges_tds_value) + parseFloat(grn_other_charges_tds_value);

					tot_grn_discount = parseFloat(tot_grn_discount) + parseFloat(grn_discount);

					tot_grn_round_off = parseFloat(tot_grn_round_off) + parseFloat(grn_round_off);

					tot_grn_purchase_amt = parseFloat(tot_grn_purchase_amt) + parseFloat(grn_purchase_amt);

				});

				console.log(charge_details);

				trHtml += '<tr style="font-weight:bold;">'

					+ '<td>GRAND TOTAL</td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td style="text-align:right;">' + money_format_india(parseFloat(tot_grn_gross_wt).toFixed(3)) + '</td>'

					+ '<td style="text-align:right;">' + money_format_india(parseFloat(tot_grn_less_wt).toFixed(3)) + '</td>'

					+ '<td style="text-align:right;">' + money_format_india(parseFloat(tot_grn_net_wt).toFixed(3)) + '</td>'

					+ '<td style="text-align:right;">' + money_format_india(parseFloat(tot_grnstonewt).toFixed(3)) + '</td>'

					+ '<td style="text-align:right;">' + parseFloat(tot_grndiaamount).toFixed(3) + '</td>'

					+ '<td></td>'

					+ '<td style="text-align:right;">' + money_format_india(parseFloat(tot_taxable_amt).toFixed(2)) + '</td>'

					+ '<td></td>'

					+ '<td style="text-align:right;">' + money_format_india(parseFloat(tot_grn_item_cgst).toFixed(2)) + '</td>'

					+ '<td style="text-align:right;">' + money_format_india(parseFloat(tot_grn_item_sgst).toFixed(2)) + '</td>'

					+ '<td style="text-align:right;">' + money_format_india(parseFloat(tot_grn_item_igst).toFixed(2)) + '</td>'

					+ '<td style="text-align:right;">' + money_format_india(parseFloat(tot_grn_item_gst_rate).toFixed(2)) + '</td>'

					+ '<td></td>'

					+ '<td style="text-align:right;">' + money_format_india(parseFloat(tot_grn_pay_tds_value).toFixed(2)) + '</td>'

					+ '<td></td>'

					+ '<td style="text-align:right;">' + money_format_india(parseFloat(tot_grn_tcs_value).toFixed(2)) + '</td>'

					+ charge_details

					+ '<td style="text-align:right;">' + money_format_india(parseFloat(tot_otherchargecgst).toFixed(2)) + '</td>'

					+ '<td style="text-align:right;">' + money_format_india(parseFloat(tot_otherchargesgst).toFixed(2)) + '</td>'

					+ '<td>' + money_format_india(parseFloat(tot_otherchargeigst).toFixed(2)) + '</td>'

					+ '<td></td>'

					+ '<td style="text-align:right;">' + money_format_india(parseFloat(tot_grn_other_charges_tds_value).toFixed(2)) + '</td>'

					+ '<td style="text-align:right;">' + money_format_india(parseFloat(tot_grn_discount).toFixed(2)) + '</td>'

					+ '<td style="text-align:right;">' + money_format_india(parseFloat(tot_grn_round_off).toFixed(2)) + '</td>'

					+ '<td style="text-align:right;">' + money_format_india(parseFloat(tot_grn_purchase_amt).toFixed(2)) + '</td>'

					+ '</tr>';

				$('#grn_bills > tbody').html(trHtml);

				// Check and initialise datatable

				if (!$.fn.DataTable.isDataTable('#grn_bills')) {

					oTable = $('#grn_bills').dataTable({

						"bSort": false,

						"bInfo": true,

						"scrollX": '100%',

						"dom": 'lBfrtip',

						"paging": false,

						"fixedHeader": true,

						"autoWidth": true,

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: '',

								messageTop: title,

								exportOptions: {

									columns: ':visible'

								},

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', '12px')

										.css('font-family', 'sans-serif');

								},

							},

							'colvis',

							{

								extend: 'excel',

								footer: true,

								title: 'GRN REPORT',

							}

						],

					});

				}

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//GRN Bills details end here

//purchase return

$('#purchase_return_search').click(function (event) {

	get_purchase_return_details();

});

/*function get_purchase_return_details() {

	var from_date = $('#rpt_from_date').html();

	var to_date = $('#rpt_to_date').html();

	var report_type = $('#grn_report_type').val();

	var company_name = $('#company_name').val();

	var from_date = $('#rpt_from_date').html();

	var to_date = $('#rpt_to_date').html();

	var branch_name = ''

	var report_name = "PURCHASE RETURN BIll REPORT"

	var optional = '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/purchase_return/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: { 'from_date': $('#rpt_from_date').html(), 'to_date': $('#rpt_to_date').html(), 'type': $('#pur_type').val(), 'karigar': $('#karigar').val(), 'id_category': $('#category').val(), 'report_type': $('#grn_report_type').val(), 'bill_type': $('#bill_type').val(), 'grn_type': $('#grn_type').val() },

		type: "POST",

		dataType: "JSON",

		cache: false,

		success: function (data) {

			$("div.overlay").css("display", "none");

			$("div.overlay").css("display", "none");

			var purchase_return = data.list;

			$("#purchase_return > tbody > tr").remove();

			$('#purchase_return').dataTable().fnClearTable();

			$('#purchase_return').dataTable().fnDestroy();

			if (purchase_return != '') {

				var trHtml = '';

				var total_taxable_amt = 0;

				var total_gross_wt = 0;

				var total_net_wt = 0;

				var total_diawt = 0;

				var total_dia_wt_amount = 0;

				var grand_total_cgst = 0;

				var grand_total_sgst = 0;

				var grand_total_igst = 0;

				var total_pur_ret_tax_rate = 0;

				var total_pur_ret_tds_percent = 0;

				var total_pur_ret_tds_value = 0;

				var total_pur_ret_tcs_percent = 0;

				var total_pur_ret_tcs_value = 0;

				var total_charges_igst_cost = 0;

				var total_charges_sgst_cost = 0;

				var total_charges_cgst_cost = 0;

				var pur_ret_other_charges_tds_percent = 0;

				var total_pur_ret_other_charges_tds_value = 0;

				var total_pur_ret_discount = 0;

				var total_return_total_cost = 0;

				var total_pur_ret_round_off = 0;

				var grand_total_charge_details = [];

				$.each(purchase_return, function (key, item_details) {

					var taxable_amt = 0;

					var gross_wt = 0;

					var net_wt = 0;

					var diawt = 0;

					var dia_wt_amount = 0;

					var total_cgst = 0;

					var total_sgst = 0;

					var total_igst = 0;

					var pur_ret_tax_rate = 0;

					var pur_ret_tds_percent = 0;

					var pur_ret_tds_value = 0;

					var pur_ret_tcs_percent = 0;

					var pur_ret_tcs_value = 0;

					var charges_igst_cost = 0;

					var charges_sgst_cost = 0;

					var charges_cgst_cost = 0;

					var pur_ret_other_charges_tds_percent = 0;

					var pur_ret_other_charges_tds_value = 0;

					var pur_ret_discount = 0;

					var return_total_cost = 0;

					var pur_ret_round_off = 0;

					var return_charges_details = [];

					$.each(item_details, function (key, val) {

						return_charges_details = val.return_charges_details;

						grand_total_charge_details = val.return_charges_details;

						var item_taxable_amt = parseFloat(parseFloat(val.taxable_amount)).toFixed(2);

						taxable_amt += parseFloat(parseFloat(val.taxable_amount));

						total_taxable_amt += parseFloat(parseFloat(val.taxable_amount));

						gross_wt += parseFloat(val.gross_wt);

						net_wt += parseFloat(val.net_wt);

						diawt += parseFloat(val.diawt);

						dia_wt_amount += parseFloat(val.diawt);

						total_cgst += parseFloat(val.total_cgst);

						total_sgst += parseFloat(val.total_sgst);

						total_igst += parseFloat(val.total_igst);

						pur_ret_tax_rate += parseFloat(val.total_tax);

						pur_ret_tds_value = parseFloat(val.pur_ret_tds_value);

						pur_ret_tds_percent = parseFloat(val.pur_ret_tds_percent);

						pur_ret_tcs_percent = parseFloat(val.pur_ret_tcs_percent);

						pur_ret_tcs_value = parseFloat(val.pur_ret_tcs_value);

						charges_cgst_cost = parseFloat(val.charges_cgst_cost);

						charges_sgst_cost = parseFloat(val.charges_sgst_cost);

						charges_igst_cost = parseFloat(val.charges_igst_cost);

						pur_ret_other_charges_tds_percent = parseFloat(val.pur_ret_other_charges_tds_percent);

						pur_ret_other_charges_tds_value = parseFloat(val.pur_ret_other_charges_tds_value);

						pur_ret_discount = parseFloat(val.pur_ret_discount);

						return_total_cost = parseFloat(val.return_total_cost);

						pur_ret_round_off = parseFloat(val.pur_ret_round_off);

						total_gross_wt += parseFloat(val.gross_wt);

						total_net_wt += parseFloat(val.net_wt);

						total_diawt += parseFloat(val.diawt);

						total_dia_wt_amount += parseFloat(val.diawt);

						grand_total_cgst += parseFloat(val.total_cgst);

						grand_total_sgst += parseFloat(val.total_sgst);

						grand_total_igst += parseFloat(val.total_igst);

						total_pur_ret_tax_rate += parseFloat(val.total_tax);

						total_pur_ret_tds_value += parseFloat(val.pur_ret_tds_value);

						total_pur_ret_tcs_value += parseFloat(val.pur_ret_tcs_value);

						total_charges_cgst_cost += parseFloat(val.charges_cgst_cost);

						total_charges_sgst_cost += parseFloat(val.charges_sgst_cost);

						total_charges_igst_cost += parseFloat(val.charges_igst_cost);

						total_pur_ret_other_charges_tds_value += parseFloat(val.pur_ret_other_charges_tds_value);

						total_pur_ret_discount += parseFloat(val.pur_ret_discount);

						total_return_total_cost += parseFloat(val.return_total_cost);

						total_pur_ret_round_off += parseFloat(val.pur_ret_round_off);

						var charges_html = '';

						$.each(return_charges_details, function (k, ch) {

							if (report_type == 2) {

								charges_html += '<td></td>';

							} else {

								charges_html += '<td style="text-align:right;">' + ch.charge_value + '</td>';

							}

						});

						trHtml += '<tr>'

							+ '<td>' + val.pur_ret_ref_no + '</td>'

							+ '<td>' + val.bill_date + '</td>'

							+ '<td>' + val.karigar + '</td>'

							+ '<td>' + val.address + '</td>'

							+ '<td>' + val.state_name + '</td>'

							+ '<td>' + val.gst_number + '</td>'

							+ '<td>' + val.pan_no + '</td>'

							+ '<td>' + val.category_name + '</td>'

							+ '<td style="text-align:right;">' + (report_type == 2 ? money_format_india(parseFloat(val.gross_wt).toFixed(3)) : money_format_india(val.gross_wt)) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(val.net_wt) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(val.diawt) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(val.dia_wt_amount) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(item_taxable_amt) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(val.pur_ret_tax_rate) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(val.total_cgst) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(val.total_sgst) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(val.total_igst) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(val.total_tax) + '</td>'

							+ '<td style="text-align:right;">' + (report_type == 1 ? val.pur_ret_tds_percent : '') + '</td>'

							+ '<td style="text-align:right;">' + (report_type == 1 ? money_format_india(val.pur_ret_tds_value) : '') + '</td>'

							+ '<td style="text-align:right;">' + (report_type == 1 ? money_format_india(val.pur_ret_tcs_percent) : '') + '</td>'

							+ '<td style="text-align:right;">' + (report_type == 1 ? money_format_india(val.pur_ret_tcs_value) : '') + '</td>'

							+ charges_html

							+ '<td style="text-align:right;">' + (report_type == 1 ? money_format_india(val.charges_cgst_cost) : '') + '</td>'

							+ '<td style="text-align:right;">' + (report_type == 1 ? money_format_india(val.charges_sgst_cost) : '') + '</td>'

							+ '<td style="text-align:right;">' + (report_type == 1 ? money_format_india(val.charges_igst_cost) : '') + '</td>'

							+ '<td style="text-align:right;">' + (report_type == 1 ? money_format_india(val.pur_ret_other_charges_tds_percent) : '') + '</td>'

							+ '<td style="text-align:right;">' + (report_type == 1 ? money_format_india(val.pur_ret_other_charges_tds_value) : '') + '</td>'

							+ '<td style="text-align:right;">' + (report_type == 1 ? money_format_india(val.pur_ret_discount) : '') + '</td>'

							+ '<td style="text-align:right;">' + (report_type == 1 ? money_format_india(val.pur_ret_round_off) : '') + '</td>'

							+ '<td style="text-align:right;">' + (report_type == 1 ? money_format_india(val.return_total_cost) : '') + '</td>'

							+ '</tr>';

						if (report_type == 2) {

							var other_metal_details = val.other_metal_details;

							if (other_metal_details.length > 0) {

								$.each(other_metal_details, function (k, omd) {

									trHtml += '<tr>'

										+ '<td></td>'

										+ '<td></td>'

										+ '<td></td>'

										+ '<td></td>'

										+ '<td></td>'

										+ '<td></td>'

										+ '<td></td>'

										+ '<td>' + omd.cat_name + '</td>'

										+ '<td></td>'

										+ '<td style="text-align:right;">' + money_format_india(omd.ret_other_itm_grs_weight) + '</td>'

										+ '<td></td>'

										+ '<td></td>'

										+ '<td style="text-align:right;">' + money_format_india(omd.ret_other_itm_amount) + '</td>'

										+ '<td></td>'

										+ '<td></td>'

										+ '<td></td>'

										+ '<td></td>'

										+ '<td></td>'

										+ '<td></td>'

										+ '<td></td>'

										+ '<td></td>'

										+ '<td></td>'

										+ '<td></td>'

										+ '<td></td>'

										+ '<td></td>'

										+ '<td></td>'

										+ charges_html

										+ '<td></td>'

										+ '<td></td>'

										+ '<td></td>'

										+ '<td></td>'

										+ '</tr>';

								});

							}

						}

					});

					if (report_type == 2) {

						var sub_total_charges_html = '';

						$.each(return_charges_details, function (k, ch) {

							sub_total_charges_html += '<td style="text-align:right;">' + ch.charge_value + '</td>';

						});

						trHtml += '<tr style="font-weight:bold;">'

							+ '<td>SUB TOTAL</td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td style="text-align:right;">' + money_format_india(parseFloat(gross_wt).toFixed(3)) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(parseFloat(net_wt).toFixed(3)) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(parseFloat(diawt).toFixed(3)) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(parseFloat(dia_wt_amount).toFixed(3)) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(parseFloat(taxable_amt).toFixed(2)) + '</td>'

							+ '<td></td>'

							+ '<td style="text-align:right;">' + money_format_india(parseFloat(total_cgst).toFixed(2)) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(parseFloat(total_sgst).toFixed(2)) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(parseFloat(total_igst).toFixed(2)) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(parseFloat(pur_ret_tax_rate).toFixed(2)) + '</td>'

							+ '<td style="text-align:right;">' + (parseFloat(pur_ret_tds_percent).toFixed(2)) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(parseFloat(pur_ret_tds_value).toFixed(2)) + '</td>'

							+ '<td style="text-align:right;">' + (parseFloat(pur_ret_tcs_percent).toFixed(2)) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(parseFloat(pur_ret_tcs_value).toFixed(2)) + '</td>'

							+ sub_total_charges_html

							+ '<td style="text-align:right;">' + money_format_india(parseFloat(charges_cgst_cost).toFixed(2)) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(parseFloat(charges_sgst_cost).toFixed(2)) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(parseFloat(charges_igst_cost).toFixed(2)) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(parseFloat(pur_ret_other_charges_tds_percent).toFixed(2)) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(parseFloat(pur_ret_other_charges_tds_value).toFixed(2)) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(parseFloat(pur_ret_discount).toFixed(2)) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(parseFloat(pur_ret_round_off).toFixed(2)) + '</td>'

							+ '<td style="text-align:right;">' + money_format_india(parseFloat(return_total_cost).toFixed(2)) + '</td>'

							+ '</tr>';

					}

				});

				var charges_html = '';

				$.each(grand_total_charge_details, function (k, ch) {

					charges_html += '<td style="text-align:right;">' + ch.charge_value + '</td>';

				});

				trHtml += '<tr style="font-weight:bold;">'

					+ '<td>GRAND TOTAL</td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td style="text-align:right;">' + money_format_india(parseFloat(total_gross_wt).toFixed(3)) + '</td>'

					+ '<td style="text-align:right;">' + money_format_india(parseFloat(total_net_wt).toFixed(3)) + '</td>'

					+ '<td style="text-align:right;">' + money_format_india(parseFloat(total_diawt).toFixed(3)) + '</td>'

					+ '<td style="text-align:right;">' + money_format_india(parseFloat(total_dia_wt_amount).toFixed(3)) + '</td>'

					+ '<td style="text-align:right;">' + money_format_india(parseFloat(total_taxable_amt).toFixed(2)) + '</td>'

					+ '<td></td>'

					+ '<td style="text-align:right;">' + money_format_india(parseFloat(grand_total_cgst).toFixed(2)) + '</td>'

					+ '<td style="text-align:right;">' + money_format_india(parseFloat(grand_total_sgst).toFixed(2)) + '</td>'

					+ '<td style="text-align:right;">' + money_format_india(parseFloat(grand_total_igst).toFixed(2)) + '</td>'

					+ '<td style="text-align:right;">' + money_format_india(parseFloat(total_pur_ret_tax_rate).toFixed(2)) + '</td>'

					+ '<td style="text-align:right;"></td>'

					+ '<td style="text-align:right;">' + money_format_india(parseFloat(total_pur_ret_tds_value).toFixed(2)) + '</td>'

					+ '<td style="text-align:right;"></td>'

					+ '<td style="text-align:right;">' + money_format_india(parseFloat(total_pur_ret_tcs_value).toFixed(2)) + '</td>'

					+ charges_html

					+ '<td style="text-align:right;">' + money_format_india(parseFloat(total_charges_cgst_cost).toFixed(2)) + '</td>'

					+ '<td style="text-align:right;">' + money_format_india(parseFloat(total_charges_sgst_cost).toFixed(2)) + '</td>'

					+ '<td style="text-align:right;">' + money_format_india(parseFloat(total_charges_igst_cost).toFixed(2)) + '</td>'

					+ '<td style="text-align:right;"></td>'

					+ '<td style="text-align:right;">' + money_format_india(parseFloat(total_pur_ret_other_charges_tds_value).toFixed(2)) + '</td>'

					+ '<td style="text-align:right;">' + money_format_india(parseFloat(total_pur_ret_discount).toFixed(2)) + '</td>'

					+ '<td style="text-align:right;">' + money_format_india(parseFloat(total_pur_ret_round_off).toFixed(2)) + '</td>'

					+ '<td style="text-align:right;">' + money_format_india(parseFloat(total_return_total_cost).toFixed(2)) + '</td>'

					+ '</tr>';

				$('#purchase_return > tbody').html(trHtml);

				// Check and initialise datatable

				if (!$.fn.DataTable.isDataTable('#purchase_return')) {

					oTable = $('#purchase_return').dataTable({

						"bSort": false,

						"bInfo": true,

						"scrollX": '100%',

						"dom": 'lBfrtip',

						"paging": false,

						"fixedHeader": true,

						"autoWidth": true,

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: '',

								messageTop: title,

								exportOptions: {

									columns: ':visible'

								},

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', '12px')

										.css('font-family', 'sans-serif');

								},

							},

							'colvis',

							{

								extend: 'excel',

								footer: true,

								title: 'PURCHASE RETURN BIll REPORT',

							}

						],

					});

				}

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}*/

function get_purchase_return_details() {

	var company_name = $('#company_name').val();

	var from_date = $('#rpt_from_date').html();

	var to_date = $('#rpt_to_date').html();

	var branch_name = ''

	var report_name = "SUPPLIER BILL REPORT"

	var optional = '';

	var report_type = $('#pur_type').val();

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/purchase_return/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: {

			'from_date': from_date, 'to_date': to_date, 'karigar': $('#karigar').val(), 'grn_type': $('#grn_type').val(), 'id_category': $('#category').val(), 'id_product': $('#prod_select').val(), 'id_design': $('#des_select').val(), 'id_sub_design': $('#sub_des_select').val(), 'id_metal': $('#metal').val(), 'report_type': $('#pur_type').val(),

			'bill_type': $('#bill_type').val(), 'type': $('#purchase_type').val(), 'tag_code': $('#tag_code').val(), 'bt_code': $('#bt_code').val(), 'transcation_type': $('#transcation_type').val(), 'purchase_type': $('#return_purchase_type').val()

		},

		type: "POST",

		dataType: "JSON",

		cache: false,

		success: function (data) {

			$("div.overlay").css("display", "none");

			var bill_details = data.list;

			$("#purchase_return_bills > tbody > tr").remove();

			$('#purchase_return_bills').dataTable().fnClearTable();

			$('#purchase_return_bills').dataTable().fnDestroy();

			$("#summary_return_bills > tbody > tr").remove();

			$('#summary_return_bills').dataTable().fnClearTable();

			$('#summary_return_bills').dataTable().fnDestroy();

			if (bill_details != '') {

				if (report_type == 1) {

					var trHtml = '';

					var tot_no_of_pcs = 0;

					var tot_gross_wt = 0;

					var tot_less_wt = 0;

					var tot_net_wt = 0;

					var tot_stwt = 0;

					var tot_otheramount = 0;

					var tot_stamount = 0;

					var tot_item_cost = 0;

					var tot_item_tax = 0;

					var tot_purewt = 0;

					var tot_nt_stwt = 0;

					$.each(bill_details, function (key, item_details) {

						var no_of_pcs = 0;

						var gross_wt = 0;

						var less_wt = 0;

						var net_wt = 0;

						var stwt = 0;

						var otheramount = 0;

						var stamount = 0;

						var item_cost = 0;

						var item_tax = 0;

						var purewt = 0;

						var nt_stwt = 0;

						$.each(item_details, function (key, val) {

							no_of_pcs += parseFloat(val.no_of_pcs);

							gross_wt += (val.stone_type != 2 ? parseFloat(val.gross_wt) : 0);

							less_wt += parseFloat(val.less_wt);

							net_wt += (val.stone_type != 2 ? parseFloat(val.net_wt) : 0);

							stwt += (val.stone_type == 2 ? parseFloat(val.gross_wt) : parseFloat(val.stwt));

							nt_stwt += parseFloat(val.nt_stwt);

							purewt += parseFloat(val.purewt);

							otheramount += parseFloat(val.otheramount);

							stamount += parseFloat(val.stamount);

							item_cost += parseFloat(parseFloat(val.item_cost));

							item_tax += parseFloat(val.total_tax);

							tot_no_of_pcs += parseFloat(val.no_of_pcs);

							tot_gross_wt += (val.stone_type != 2 ? parseFloat(val.gross_wt) : 0);

							tot_less_wt += parseFloat(val.less_wt);

							tot_net_wt += (val.stone_type != 2 ? parseFloat(val.net_wt) : 0);

							tot_stwt += (val.stone_type == 2 ? parseFloat(val.gross_wt) : parseFloat(val.stwt));

							tot_nt_stwt += parseFloat(val.nt_stwt);

							tot_purewt += parseFloat(val.purewt);

							tot_otheramount += parseFloat(val.otheramount);

							tot_stamount += parseFloat(val.stamount);

							tot_item_cost += parseFloat(parseFloat(val.item_cost));

							tot_item_tax += parseFloat(val.total_tax);

							var pur_url = base_url + 'index.php/admin_ret_purchase/purchase/job_receipt/' + val.po_id;

							var ret_url = base_url + 'index.php/admin_ret_purchase/return_receipt_acknowladgement/' + val.pur_return_id;

							trHtml += '<tr>'

								+ '<td>' + parseFloat(key + 1) + '</td>'

								+ '<td><a href=' + ret_url + ' target="_blank">' + (val.pur_ret_ref_no != '' ? val.pur_ret_ref_no : '-') + '</a></td>'

								+ '<td><a href=' + pur_url + ' target="_blank">' + (val.po_ref_no != '' ? val.po_ref_no : '-') + '</a></td>'

								+ '<td>' + val.po_date + '</td>'

								+ '<td>' + val.bt_number + '</td>'

								+ '<td>' + val.karigar + '</td>'

								+ '<td>' + val.category_name + '</td>'

								+ '<td>' + val.product_name + '</td>'

								+ '<td>' + val.design_name + '</td>'

								+ '<td>' + val.sub_design_name + '</td>'

								+ '<td>' + val.no_of_pcs + '</td>'

								+ '<td>' + (val.stone_type != 2 ? val.gross_wt : 0.000) + '</td>'

								+ '<td>' + val.less_wt + '</td>'

								+ '<td>' + (val.stone_type != 2 ? val.net_wt : 0.000) + '</td>'

								+ '<td>' + (val.stone_type == 2 ? val.gross_wt : val.stwt) + '</td>'

								+ '<td>' + val.nt_stwt + '</td>'

								+ '<td>' + val.item_wastage + '</td>'

								+ '<td>' + val.mc_type + '</td>'

								+ '<td>' + val.mc_value + '</td>'

								+ '<td>' + val.purchase_touch + '</td>'

								+ '<td>' + val.purewt + '</td>'

								+ '<td>' + val.fix_rate_per_grm + '</td>'

								+ '<td>' + money_format_india(val.otheramount) + '</td>'

								+ '<td>' + val.stamount + '</td>'

								+ '<td>' + money_format_india(parseFloat(val.item_cost - val.total_tax).toFixed(2)) + '</td>'

								+ '<td>' + money_format_india(parseFloat(val.total_tax).toFixed(2)) + '</td>'

								+ '<td>' + money_format_india(parseFloat(val.item_cost).toFixed(2)) + '</td>'

								+ '<td>' + val.remark + '</td>'

								+ '<td>' + val.transaction_type + '</td>'

								+ '<td>' + val.emp_name + '</td>'

								+ '</tr>';

						});

						trHtml += '<tr style="font-weight:bold; color:red">'

							+ '<td>SUB TOTAL</td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td>' + parseFloat(no_of_pcs) + '</td>'

							+ '<td>' + parseFloat(gross_wt).toFixed(3) + '</td>'

							+ '<td>' + parseFloat(less_wt).toFixed(3) + '</td>'

							+ '<td>' + parseFloat(net_wt).toFixed(3) + '</td>'

							+ '<td>' + parseFloat(stwt).toFixed(3) + '</td>'

							+ '<td>' + parseFloat(nt_stwt).toFixed(3) + '</td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td>' + parseFloat(purewt).toFixed(3) + '</td>'

							+ '<td></td>'

							+ '<td>' + money_format_india(parseFloat(otheramount).toFixed(2)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(stamount).toFixed(2)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(parseFloat(item_cost) - parseFloat(item_tax)).toFixed(2)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(item_tax).toFixed(2)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(item_cost).toFixed(2)) + '</td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '</tr>';

					});

					trHtml += '<tr style="font-weight:bold; color: blue">'

						+ '<td><b>GRAND TOTAL</b></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td>' + parseFloat(tot_no_of_pcs) + '</td>'

						+ '<td>' + money_format_india(parseFloat(tot_gross_wt).toFixed(3)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(tot_less_wt).toFixed(3)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(tot_net_wt).toFixed(3)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(tot_stwt).toFixed(3)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(tot_nt_stwt).toFixed(3)) + '</td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td>' + parseFloat(tot_purewt).toFixed(3) + '</td>'

						+ '<td></td>'

						+ '<td>' + money_format_india(parseFloat(tot_otheramount).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(tot_stamount).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(parseFloat(tot_item_cost) - parseFloat(tot_item_tax)).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(tot_item_tax).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(tot_item_cost).toFixed(2)) + '</td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '</tr>';

					$('#purchase_return_bills > tbody').html(trHtml);

					// Check and initialise datatable

					if (!$.fn.DataTable.isDataTable('#purchase_return_bills')) {

						oTable = $('#purchase_return_bills').dataTable({

							"bSort": false,

							"bInfo": true,

							"scrollX": '100%',

							"dom": 'lBfrtip',

							"paging": false,

							"fixedHeader": true,

							"autoWidth": true,

							"columnDefs": [

								{

									targets: [9, 10, 11, 12, 13, 14, 15, 16, 17, 18, , 19, 20, 21, 22, 23, 24, 25, 26],

									className: 'dt-body-right'

								}

							],

							"buttons": [

								{

									extend: 'print',

									footer: true,

									title: '',

									messageTop: title,

									exportOptions: {

										columns: ':visible'

									},

									customize: function (win) {

										$(win.document.body).find('table')

											.addClass('compact')

											.css('font-size', '10px')

										// .css('font-family', 'sans-serif');

									},

								},

								'colvis',

								{

									extend: 'excel',

									footer: true,

									title: 'PURCHASE RETURN REPORT',

								}

							],

						});

					}

				} else {

					$("#summary_return_bills > tbody > tr").remove();

					$('#summary_return_bills').dataTable().fnClearTable();

					$('#summary_return_bills').dataTable().fnDestroy();

					var trHtml = '';

					var sno = 1;

					var tot_no_of_pcs = 0;

					var tot_gross_wt = 0;

					var tot_less_wt = 0;

					var tot_net_wt = 0;

					var tot_stwt = 0;

					var tot_nt_stwt = 0;

					var tot_otheramount = 0;

					var tot_stamount = 0;

					var tot_item_cost = 0;

					var tot_purewt = 0;

					var total_item_tax = 0;

					$.each(bill_details, function (vkey, item_details) {

						var no_of_pcs = 0;

						var gross_wt = 0;

						var less_wt = 0;

						var net_wt = 0;

						var stwt = 0;

						var nt_stwt = 0;

						var otheramount = 0;

						var stamount = 0;

						var item_cost = 0;

						var purewt = 0;

						var item_tax = 0;

						$.each(item_details, function (tkey, val) {

							no_of_pcs += parseFloat(val.no_of_pcs);

							gross_wt += (val.stone_type != 2 ? parseFloat(val.gross_wt) : 0);

							less_wt += parseFloat(val.less_wt);

							net_wt += (val.stone_type != 2 ? parseFloat(val.net_wt) : 0);

							stwt += (val.stone_type == 2 ? parseFloat(val.gross_wt) : parseFloat(val.stwt));

							purewt += parseFloat(val.purewt);

							otheramount += parseFloat(val.otheramount);

							stamount += parseFloat(val.stamount);

							item_cost += parseFloat(val.item_cost);

							tot_no_of_pcs += parseFloat(val.no_of_pcs);

							tot_gross_wt += (val.stone_type != 2 ? parseFloat(val.gross_wt) : 0);

							tot_less_wt += parseFloat(val.less_wt);

							tot_net_wt += (val.stone_type != 2 ? parseFloat(val.net_wt) : 0);

							tot_stwt += (val.stone_type == 2 ? parseFloat(val.gross_wt) : parseFloat(val.stwt));

							tot_nt_stwt += parseFloat(val.nt_stwt);

							tot_purewt += parseFloat(val.purewt);

							tot_otheramount += parseFloat(val.otheramount);

							tot_stamount += parseFloat(val.stamount);

							tot_item_cost += parseFloat(val.item_cost);

							total_item_tax += parseFloat(val.total_tax);

							// if (val.stamount > 0) {

							// 	action_content = '<a href=# class="" onclick="po_stone_details(' + val.po_item_id + ');">' + money_format_india(val.stamount) + '</a>';

							// }

							// else {

							// 	action_content = money_format_india(val.stamount);

							// }

							var ret_url = base_url + 'index.php/admin_ret_purchase/return_receipt_acknowladgement/' + val.pur_return_id;

							var pur_url = base_url + 'index.php/admin_ret_purchase/purchase/job_receipt/' + val.po_id;

							console.log(tkey);

							trHtml += '<tr>'

								+ '<td>' + sno + '</td>'

								+ '<td><a href=' + ret_url + ' target="_blank">' + (val.pur_ret_ref_no != '' ? val.pur_ret_ref_no : '-') + '</a></td>'

								+ '<td><a href=' + pur_url + ' target="_blank">' + (val.po_ref_no != '' ? val.po_ref_no : '-') + '</a></td>'

								+ '<td>' + val.po_date + '</td>'

								+ '<td>' + val.bt_number + '</td>'

								+ '<td>' + val.karigar + '</td>'

								+ '<td>' + val.no_of_pcs + '</td>'

								+ '<td>' + (val.stone_type != 2 ? val.gross_wt : 0.000) + '</td>'

								+ '<td>' + val.less_wt + '</td>'

								+ '<td>' + (val.stone_type != 2 ? val.net_wt : 0.000) + '</td>'

								+ '<td>' + (val.stone_type == 2 ? val.gross_wt : val.stwt) + '</td>'

								+ '<td>' + val.nt_stwt + '</td>'

								+ '<td>' + val.item_wastage + '</td>'

								+ '<td>' + val.mc_type + '</td>'

								+ '<td>' + val.mc_value + '</td>'

								+ '<td>' + val.purchase_touch + '</td>'

								+ '<td>' + val.purewt + '</td>'

								+ '<td>' + val.fix_rate_per_grm + '</td>'

								+ '<td>' + money_format_india(val.otheramount) + '</td>'

								+ '<td>' + val.stamount + '</td>'

								+ '<td>' + money_format_india(parseFloat(parseFloat(val.item_cost) - parseFloat(val.total_tax)).toFixed(2)) + '</td>'

								+ '<td>' + money_format_india(parseFloat(val.total_tax).toFixed(2)) + '</td>'

								+ '<td>' + money_format_india(parseFloat(val.item_cost).toFixed(2)) + '</td>'

								+ '<td>' + val.transaction_type + '</td>'

								+ '<td>' + val.emp_name + '</td>'

								+ '</tr>';

							sno++;

						});

					});

					trHtml += '<tr style="font-weight:bold; color: blue">'

						+ '<td><b>GRAND TOTAL</b></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td>' + parseFloat(tot_no_of_pcs) + '</td>'

						+ '<td>' + money_format_india(parseFloat(tot_gross_wt).toFixed(3)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(tot_less_wt).toFixed(3)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(tot_net_wt).toFixed(3)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(tot_stwt).toFixed(3)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(tot_nt_stwt).toFixed(3)) + '</td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td>' + parseFloat(tot_purewt).toFixed(3) + '</td>'

						+ '<td></td>'

						+ '<td>' + money_format_india(parseFloat(tot_otheramount).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(tot_stamount).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(parseFloat(tot_item_cost) - parseFloat(total_item_tax)).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(total_item_tax).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(parseFloat(tot_item_cost)).toFixed(2)) + '</td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '</tr>';

					$('#summary_return_bills > tbody').html(trHtml);

					// Check and initialise datatable

					if (!$.fn.DataTable.isDataTable('#summary_return_bills')) {

						oTable = $('#summary_return_bills').dataTable({

							"bSort": false,

							"bInfo": true,

							"scrollX": '100%',

							"dom": 'lBfrtip',

							"paging": false,

							"fixedHeader": true,

							"autoWidth": true,

							"columnDefs": [

								{

									targets: [4, 5, 6, 7, 8, 9, 11, 12, 13, 14, 15, 16, 17, 18, 19],

									className: 'dt-body-right'

								}

							],

							"buttons": [

								{

									extend: 'print',

									footer: true,

									title: '',

									messageTop: title,

									exportOptions: {

										columns: ':visible'

									},

									customize: function (win) {

										$(win.document.body).find('table')

											.addClass('compact')

											.css('font-size', '12px')

											.css('font-family', 'sans-serif');

									},

								},

								'colvis',

								{

									extend: 'excel',

									footer: true,

									title: 'PURCHASE RETURN REPORT',

								}

							],

						});

					}

				}

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//purchase return

//PO Payment details start here

function get_po_payment_details() {

	var company_name = $('#company_name').val();

	var from_date = $('#rpt_payments1').html();

	var to_date = $('#rpt_payments2').html();

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "Purchase payment";

	var karigar = $('#karigar option:selected').html() != '' && $('#karigar option:selected').html() != undefined ? $('#karigar option:selected').html() + ' - ' : '';

	var optional = karigar;

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/popayments/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: { 'from_date': from_date, 'to_date': to_date, 'karigar': $('#karigar').val() },

		type: "POST",

		dataType: "JSON",

		cache: false,

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.list;

			var oTable = $('#purchase_pay_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#purchase_pay_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"columnDefs": [{

						targets: [8],

						className: 'dt-body-right'

					}],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: 'Payment Report',

						}

					],

					"aaData": list,

					"aoColumns": [{ "mDataProp": "pay_refno" },

					{ "mDataProp": "payment_date" },

					{ "mDataProp": "suppliername" },

					{ "mDataProp": "contactno1" },

					{ "mDataProp": "bank_name" },

					{ "mDataProp": "ref_date" },

					{ "mDataProp": "pay_mode" },

					{ "mDataProp": "ref_no" },

					{

						"mDataProp": function (row, type, val, meta) {

							var payment_amount = (row.payment_amount)

							return money_format_india(parseFloat(payment_amount).toFixed(2));

						},

					},

					],

					"footerCallback": function (row, data, start, end, display) {

						if (list.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								total_cost = api

									.column(7)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(7).footer()).html(money_format_india(parseFloat(total_cost).toFixed(2)));

							}

						} else {

							var api = this.api(), data;

							$(api.column(7).footer()).html('');

						}

					}

				});

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//PO Payment details end here

//PO QC Issue / Receipt

function get_qc_issue_details() {

	var company_name = $('#company_name').val();

	var from_date = '';

	var to_date = '';

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "QC Issue/ Receipt Report	";

	var optional = '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/qcstatus/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: { 'from_date': $('#rpt_from_date').html(), 'to_date': $('#rpt_to_date').html(), 'po_ref_no': $('#select_po_ref_no').val() },

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			var oTable = $('#purchase_qcbills').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#purchase_qcbills').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"bSort": true,

					"order": [[0, "desc"]],

					"dom": 'lBfrtip',

					"columnDefs": [

						{

							targets: [7, 8, 9, 12, 13, 14, 15, 16, 17, 18],

							className: 'dt-right'

						},

					],

					"buttons": [

						{

							extend: 'excel',

							footer: true,

							title: 'QC Issue/ Receipt Report',

						},

						{

							extend: 'colvis',

							collectionLayout: 'fixed columns',

							collectionTitle: 'Column visibility control'

						},

						{

							extend: 'excel',

							footer: true,

							title: 'QC Issue/ Receipt Report',

						}

					],

					"tableTools": { "buttons": [{ "sExtends": "xls", "oSelectorOpts": { page: 'current' } }, { "sExtends": "pdf", "oSelectorOpts": { page: 'current' } }] },

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "po_ref_no" },

						{ "mDataProp": "date_add" },

						{ "mDataProp": "emp_name" },

						{ "mDataProp": "product_name" },

						{ "mDataProp": "design_name" },

						{ "mDataProp": "sub_design_name" },

						{

							"mDataProp": function (row, type, val, meta) {

								var total_pcs = row.total_pcs;

								return money_format_india(total_pcs);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var gross_wt = row.gross_wt;

								return money_format_india(gross_wt);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var less_wt = row.less_wt;

								return money_format_india(less_wt);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var net_wt = row.net_wt;

								return money_format_india(net_wt);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								return '<span class="badge bg-' + (row.status == 1 ? 'red' : 'green') + '">' + row.qc_status + '</span>';

							},

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var qc_passed_pcs = row.qc_passed_pcs;

								return money_format_india(qc_passed_pcs);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var qc_passed_gwt = row.qc_passed_gwt;

								return money_format_india(qc_passed_gwt);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var qc_passed_lwt = row.qc_passed_lwt;

								return money_format_india(qc_passed_lwt);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var qc_passed_nwt = row.qc_passed_nwt;

								return money_format_india(qc_passed_nwt);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var qc_failed_pcs = row.qc_failed_pcs;

								return money_format_india(qc_failed_pcs);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var qc_failed_gwt = row.qc_failed_gwt;

								return money_format_india(qc_failed_gwt);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var qc_failed_lwt = row.qc_failed_lwt;

								return money_format_india(qc_failed_lwt);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var qc_failed_nwt = row.qc_failed_nwt;

								return money_format_india(qc_failed_nwt);

							}

						},

					],

					"footerCallback": function (row, data, start, end, display) {

						if (list.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								total_pcs = api

									.column(6)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(6).footer()).html(money_format_india(parseFloat(total_pcs)));

								var total_gwt = api

									.column(7)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(7).footer()).html(money_format_india(parseFloat(total_gwt).toFixed(3)));

								total_lswt = api

									.column(8)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(8).footer()).html(money_format_india(parseFloat(total_lswt).toFixed(3)));

								total_nwt = api

									.column(9)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(9).footer()).html(money_format_india(parseFloat(total_nwt).toFixed(3)));

								var total_accpcs = api

									.column(11)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(11).footer()).html(money_format_india(parseFloat(total_accpcs).toFixed(0)));

								var total_accgwt = api

									.column(12)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(12).footer()).html(money_format_india(parseFloat(total_accgwt).toFixed(3)));

								var total_accnwt = api

									.column(13)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(13).footer()).html(money_format_india(parseFloat(total_accnwt).toFixed(3)));

								var total_acclwt = api

									.column(14)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(14).footer()).html(money_format_india(parseFloat(total_acclwt).toFixed(3)));

								var total_accpcs = api

									.column(15)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(15).footer()).html(money_format_india(parseFloat(total_accpcs).toFixed(0)));

								var total_accgwt = api

									.column(16)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(16).footer()).html(money_format_india(parseFloat(total_accgwt).toFixed(3)));

								var total_accnwt = api

									.column(17)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(17).footer()).html(money_format_india(parseFloat(total_accnwt).toFixed(3)));

								var total_acclwt = api

									.column(18)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(18).footer()).html(money_format_india(parseFloat(total_acclwt).toFixed(3)));

							}

						} else {

							var api = this.api(), data;

							$(api.column(6).footer()).html('');

							$(api.column(7).footer()).html('');

							$(api.column(8).footer()).html('');

							$(api.column(9).footer()).html('');

							$(api.column(10).footer()).html('');

							$(api.column(11).footer()).html('');

							$(api.column(12).footer()).html('');

							$(api.column(13).footer()).html('');

						}

					}

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//PO QC Issue / Receipt

function get_hm_issue_details() {

	var company_name = $('#company_name').val();

	var from_date = '';

	var to_date = '';

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "Halmarking Issue/ Receipt Report";

	var optional = '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	my_Date = new Date();

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/pohmstatus/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: { 'from_date': $('#rpt_from_date').html(), 'to_date': $('#rpt_to_date').html(), 'id_karigar': $('#karigar').val() },

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			var oTable = $('#purchase_hmbills').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#purchase_hmbills').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"bSort": true,

					"order": [[0, "desc"]],

					"dom": 'lBfrtip',

					"columnDefs": [

						{

							targets: [3, 4, 5, 6, 7],

							className: 'dt-body-right'

						},

					],

					"buttons": ['excel',

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', '10px');

							},

						},

						{

							extend: 'colvis',

							collectionLayout: 'fixed columns',

							collectionTitle: 'Column visibility control'

						},

					],

					"tableTools": { "buttons": [{ "sExtends": "xls", "oSelectorOpts": { page: 'current' } }, { "sExtends": "pdf", "oSelectorOpts": { page: 'current' } }] },

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "hm_ref_no" },

						{ "mDataProp": "issue_date" },

						{ "mDataProp": "karigar_name" },

						{ "mDataProp": "hm_process_pcs" },

						{ "mDataProp": "hm_process_gwt" },

						{ "mDataProp": "hm_process_lwt" },

						{ "mDataProp": "hm_process_nwt" },

						{ "mDataProp": "total_hm_charges" },

						{

							"mDataProp": function (row, type, val, meta) {

								return '<span class="badge bg-' + (row.status == 1 ? 'red' : 'green') + '">' + row.hm_status + '</span>';

							},

						},

					],

					"footerCallback": function (row, data, start, end, display) {

						if (list.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								total_pcs = api

									.column(3)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(3).footer()).html(money_format_india(parseFloat(total_pcs)));

								var total_gwt = api

									.column(4)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(4).footer()).html(money_format_india(parseFloat(total_gwt).toFixed(3)));

								total_lswt = api

									.column(5)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(5).footer()).html(money_format_india(parseFloat(total_lswt).toFixed(3)));

								total_nwt = api

									.column(6)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(6).footer()).html(money_format_india(parseFloat(total_nwt).toFixed(3)));

								var total_hmchrg = api

									.column(7)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(7).footer()).html(money_format_india(parseFloat(total_hmchrg).toFixed(3)));

							}

						} else {

							var api = this.api(), data;

							$(api.column(3).footer()).html('');

							$(api.column(4).footer()).html('');

							$(api.column(5).footer()).html('');

							$(api.column(6).footer()).html('');

							$(api.column(7).footer()).html('');

						}

					}

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//tag wise profit list

/*

function get_tag_wise_profit_list() {

	var dt_range = ($("#dt_range").val()).split('-');

	var company_name = $('#company_name').val();

	var from_date = dt_range[0];

	var to_date = dt_range[1];

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "TAG WISE PROFIT REPORT";

	var optional = '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/tagwiseprofit/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'dt_range': $("#dt_range").val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()) }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			$("#tagprofit_details > tbody > tr").remove();

			$('#tagprofit_details').dataTable().fnClearTable();

			$('#tagprofit_details').dataTable().fnDestroy();

			if (list != null) {

				trHTML = '';

				tfootHTML = '';

				var tot_ret_amt = 0;

				var tot_sales_wast = 0;

				var total_pur_wast = 0;

				$.each(list, function (i, plbill) {

					trHTML += '<tr>' +

						'<td><strong>' + i + '</strong></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

					'</tr>';

					var tot_pcs = 0;

					var tot_salesgwt = 0;

					var tot_salesnwt = 0;

					var tot_saleswast = 0;

					var tot_saleamt = 0;

					var tot_wastprofit = 0;

					var tot_profitamt = 0;

					var tot_tag_purchase_cost = 0;

					$.each(plbill, function (ekey, bill) {

						tot_pcs += parseInt(bill.piece);

						tot_salesgwt += parseFloat(bill.salegrosswt);

						tot_salesnwt += parseFloat(bill.salenetwt);

						tot_saleswast += parseFloat(bill.wastagewt);

						tot_saleamt += parseFloat(bill.tot_bill_amount);

						tot_wastprofit += parseFloat(bill.wastageprofit);

						tot_profitamt += parseFloat(bill.profitamt);

						tot_tag_purchase_cost += parseFloat(bill.tag_purchase_cost);

						trHTML += '<tr>' +

							'<td>' + bill.product_name + '</td>'

							+ '<td>' + bill.design_name + '</td>'

							+ '<td>' + bill.sub_design_name + '</td>'

							+ '<td>' + bill.bill_no + '</td>'

							+ '<td>' + bill.bill_date + '</td>'

							+ '<td>' + bill.tag_code + '</td>'

							+ '<td>' + bill.piece + '</td>'

							+ '<td>' + bill.salegrosswt + '</td>'

							+ '<td>' + bill.salenetwt + '</td>'

							+ '<td>' + bill.wastagewt + '</td>'

							+ '<td>' + money_format_india(bill.rate_per_grm) + '</td>'

							+ '<td>' + money_format_india(bill.tot_bill_amount) + '</td>'

							+ '<td>' + money_format_india(bill.purwastagewt) + '</td>'

							+ '<td></td>'

							+ '<td>' + money_format_india(bill.tag_purchase_cost) + '</td>'

							+ '<td>' + bill.wastageprofit + '</td>'

							+ '<td>' + bill.profitwastper + '</td>'

							+ '<td>' + money_format_india(bill.profitamt) + '</td>'

						'</tr>';

					});

					trHTML += '<tr style="color:red">' +

						'<td><strong>' + i + ' Total </strong></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td><strong>' + tot_pcs + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(tot_salesgwt).toFixed(3)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(tot_salesnwt).toFixed(3)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(tot_saleswast).toFixed(3)) + '</strong></td>'

						+ '<td></td>'

						+ '<td><strong>' + money_format_india(parseFloat(tot_saleamt).toFixed(3)) + '</strong></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td><strong>' + money_format_india(parseFloat(tot_tag_purchase_cost).toFixed(2)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(tot_wastprofit).toFixed(3)) + '</strong></td>'

						+ '<td></td>'

						+ '<td><strong>' + money_format_india(parseFloat(tot_profitamt).toFixed(2)) + '</strong></td>'

					'</tr>';

				});

				$('#tagprofit_details > tbody').html(trHTML);

				// Check and initialise datatable

				if (!$.fn.DataTable.isDataTable('#tagprofit_details')) {

					oTable = $('#tagprofit_details').dataTable({

						"bSort": false,

						"bInfo": true,

						"scrollX": '100%',

						"dom": 'lBfrtip',

						"paging": false,

						"fixedHeader": true,

						"columnDefs": [

							{

								targets: [7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17],

								className: 'dt-body-right'

							},

							{

								targets: [0, 1, 2, 3, 4, 5,],

								className: 'dt-body-left'

							},

						],

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: '',

								messageTop: title,

								exportOptions: {

									columns: ':visible'

								},

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', '12px')

										.css('font-family', 'sans-serif');

								},

							},

							'colvis',

							{

								extend: 'excel',

								footer: true,

								title: 'Tag Wise Profit List',

							}

						],

					});

				}

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}*/

//tag wise profit list

function get_tag_wise_profit_list() {

	var dt_range = ($("#dt_range").val()).split('-');

	var company_name = $('#company_name').val();

	var from_date = dt_range[0];

	var to_date = dt_range[1];

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "BILL WISE DETAILED REPORT ";

	var optional = '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/tagwiseprofit/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'dt_range': $("#dt_range").val(), 'group_by': $('#group_by').val(), 'id_metal': $('#metal').val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()) }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			$("#tagprofit_details > tbody > tr").remove();

			$('#tagprofit_details').dataTable().fnClearTable();

			$('#tagprofit_details').dataTable().fnDestroy();

			if (list != null) {

				trHTML = '';

				tfootHTML = '';

				var tot_ret_amt = 0;

				var tot_sales_wast = 0;

				var total_pur_wast = 0;

				var count = 0;

				var grand_tot_pcs = 0;

				var grand_tot_salesgwt = 0;

				var grand_tot_salesnwt = 0;

				var grand_tot_saleswast = 0;

				var grand_tot_saleamt = 0;

				var grand_tot_wastprofit = 0;

				var grand_tot_profitamt = 0;

				var grand_tot_tag_purchase_cost = 0;

				var grand_tot_va = 0;

				var grand_tot_mc = 0;

				var grand_tot_taxable = 0;

				var grand_tot_total_tax = 0;

				var grand_tot_profitwastper = 0;

				var grand_tot_purwastagewt = 0;

				var grand_tot_pur_total_tax = 0;

				var grand_tot_pur_total_taxable = 0;

				var grand_tot_tag_purchase_cost = 0;

				var grand_tot_wastageprofit = 0;

				var grand_tot_stn_pcs = 0;

				var grand_tot_stn_wt = 0;

				var grand_tot_stn_amt = 0;

				var grand_tot_dia_pcs = 0;

				var grand_tot_dia_wt = 0;

				var grand_tot_dia_amt = 0;

				var grand_tot_dia_pur_amt = 0;

				var grand_tot_stn_pur_amt = 0;

				var tot_wastageprofit = 0;

				var grand_tot_purwastage = 0;

				$.each(list, function (i, plbill) {

					trHTML += '<tr>' +

						'<td><strong>' + i + '</strong></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

					'</tr>';

					var tot_pcs = 0;

					var tot_salesgwt = 0;

					var tot_salesnwt = 0;

					var tot_saleswast = 0;

					var tot_saleamt = 0;

					var tot_wastprofit = 0;

					var tot_profitamt = 0;

					var tot_tag_purchase_cost = 0;

					var tot_va = 0;

					var tot_mc = 0;

					var tot_taxable = 0;

					var tot_total_tax = 0;

					var tot_profitwastper = 0;

					var tot_purwastagewt = 0;

					var tot_purwastage = 0;

					var tot_pur_total_tax = 0;

					var tot_pur_total_taxable = 0;

					var tot_tag_purchase_cost = 0;

					var tot_stn_pcs = 0;

					var tot_stn_wt = 0;

					var tot_stn_amt = 0;

					var tot_dia_pcs = 0;

					var tot_dia_wt = 0;

					var tot_dia_amt = 0;

					var tot_dia_pur_amt = 0;

					var tot_stn_pur_amt = 0;

					var tot_wastageprofit = 0;

					$.each(plbill, function (ekey, bill) {

						var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + bill.bill_id;

						tot_pcs += parseInt(bill.piece);

						tot_salesgwt += parseFloat(bill.salegrosswt);

						tot_salesnwt += parseFloat(bill.salenetwt);

						tot_saleswast += parseFloat(bill.wastagewt);

						tot_saleamt += parseFloat(bill.tot_bill_amount);

						tot_wastprofit += parseFloat(bill.wastageprofit);

						tot_profitamt += parseFloat(bill.profitamt);

						tot_tag_purchase_cost += parseFloat(bill.tag_purchase_cost);

						tot_va += parseFloat(bill.wastage_percent);

						tot_mc += parseFloat(bill.making_charge);

						tot_taxable += parseFloat(bill.taxable_amt);

						tot_total_tax += parseFloat(bill.item_total_tax);

						tot_profitwastper += parseFloat(bill.profitwastper);

						tot_purwastagewt += parseFloat(bill.purwastagewt);

						tot_pur_total_tax += parseFloat(bill.pur_total_tax);

						tot_pur_total_taxable += parseFloat(bill.tag_purchase_cost - bill.pur_total_tax);

						tot_wastageprofit += parseFloat(bill.wastageprofit);

						tot_stn_pcs += parseFloat(bill.sale_stn_pcs);

						tot_stn_wt += parseFloat(bill.sale_stn_wt);

						tot_stn_amt += parseFloat(bill.sale_stn_amt);

						tot_dia_pcs += parseFloat(bill.sale_dia_pcs);

						tot_dia_wt += parseFloat(bill.sale_dia_wt);

						tot_dia_amt += parseFloat(bill.sale_dia_amt);

						tot_dia_pur_amt += parseFloat(bill.dia_amt);

						tot_stn_pur_amt += parseFloat(bill.stn_amt);

						tot_purwastage += parseFloat(bill.purwastage);

						trHTML += '<tr>' +

							'<td>' + bill.product_name + '</td>'

							+ '<td>' + bill.design_name + '</td>'

							+ '<td>' + bill.sub_design_name + '</td>'

							// +'<td>'+bill.bill_no+'</td>'

							+ '<td><a href=' + url + ' target="_blank">' + bill.bill_no + '</a></td>'

							+ '<td>' + bill.bill_date + '</td>'

							+ '<td>' + bill.tag_code + '</td>'

							+ '<td>' + bill.piece + '</td>'

							+ '<td>' + bill.salegrosswt + '</td>'

							+ '<td>' + bill.salenetwt + '</td>'

							+ '<td>' + bill.sale_stn_pcs + '</td>'

							+ '<td>' + bill.sale_stn_wt + '</td>'

							+ '<td>' + bill.sale_dia_pcs + '</td>'

							+ '<td>' + bill.sale_dia_wt + '</td>'

							+ '<td>' + bill.wastage_percent + '</td>'

							+ '<td>' + bill.wastagewt + '</td>'

							+ '<td>' + bill.making_charge + '</td>'

							+ '<td>' + bill.sale_stn_amt + '</td>'

							+ '<td>' + bill.sale_dia_amt + '</td>'

							+ '<td>' + bill.rate_per_grm + '</td>'

							+ '<td>' + bill.taxable_amt + '</td>'

							+ '<td>' + bill.item_total_tax + '</td>'

							+ '<td>' + parseFloat(bill.purwastage).toFixed(2) + '</td>'

							+ '<td>' + bill.purwastagewt + '</td>'

							+ '<td>' + bill.stn_amt + '</td>'

							+ '<td>' + bill.dia_amt + '</td>'

							+ '<td>' + bill.fix_rate_per_grm + '</td>'

							+ '<td>' + parseFloat(bill.tag_purchase_cost - bill.pur_total_tax).toFixed(2) + '</td>'

							+ '<td>' + bill.pur_total_tax + '</td>'

							+ '<td>' + bill.tot_bill_amount + '</td>'

							+ '<td>' + bill.tag_purchase_cost + '</td>'

							+ '<td>' + bill.wastageprofit + '</td>'

							+ '<td>' + bill.profitwastper + '</td>'

							+ '<td>' + bill.profitamt + '</td>'

						'</tr>';

						count = count + 1;

					});

					grand_tot_pcs += parseInt(tot_pcs);

					grand_tot_salesgwt += parseFloat(tot_salesgwt);

					grand_tot_salesnwt += parseFloat(tot_salesnwt);

					grand_tot_saleswast += parseFloat(tot_saleswast);

					grand_tot_saleamt += parseFloat(tot_saleamt);

					grand_tot_wastprofit += parseFloat(tot_wastprofit);

					grand_tot_profitamt += parseFloat(tot_profitamt);

					grand_tot_tag_purchase_cost += parseFloat(tot_tag_purchase_cost);

					grand_tot_va += parseFloat(tot_va);

					grand_tot_mc += parseFloat(tot_mc);

					grand_tot_taxable += parseFloat(tot_taxable);

					grand_tot_total_tax += parseFloat(tot_total_tax);

					grand_tot_profitwastper += parseFloat(tot_profitwastper);

					grand_tot_purwastagewt += parseFloat(tot_purwastagewt);

					grand_tot_purwastage += parseFloat(tot_purwastage);

					grand_tot_pur_total_tax += parseFloat(tot_pur_total_tax);

					grand_tot_pur_total_taxable += parseFloat(tot_pur_total_taxable);

					grand_tot_pur_total_taxable += parseFloat(tot_pur_total_taxable);

					grand_tot_pur_total_taxable += parseFloat(tot_pur_total_taxable);

					grand_tot_pur_total_taxable += parseFloat(tot_pur_total_taxable);

					grand_tot_pur_total_taxable += parseFloat(tot_pur_total_taxable);

					grand_tot_pur_total_taxable += parseFloat(tot_pur_total_taxable);

					grand_tot_pur_total_taxable += parseFloat(tot_pur_total_taxable);

					grand_tot_pur_total_taxable += parseFloat(tot_pur_total_taxable);

					grand_tot_pur_total_taxable += parseFloat(tot_pur_total_taxable);

					grand_tot_stn_pcs += parseFloat(tot_stn_pcs);

					grand_tot_stn_wt += parseFloat(tot_stn_wt);

					grand_tot_stn_amt += parseFloat(tot_stn_amt);

					grand_tot_dia_pcs += parseFloat(tot_dia_pcs);

					grand_tot_dia_wt += parseFloat(tot_dia_wt);

					grand_tot_dia_amt += parseFloat(tot_dia_amt);

					grand_tot_dia_pur_amt += parseFloat(tot_dia_pur_amt);

					grand_tot_stn_pur_amt += parseFloat(tot_stn_pur_amt);

					//grand_tot_wastageprofit +=parseFloat(tot_wastageprofit);

					trHTML += '<tr>' +

						'<td><strong>' + i + ' Total </strong></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td><strong>' + tot_pcs + '</strong></td>'

						+ '<td><strong>' + parseFloat(tot_salesgwt).toFixed(3) + '</strong></td>'

						+ '<td><strong>' + parseFloat(tot_salesnwt).toFixed(3) + '</strong></td>'

						+ '<td><strong>' + parseFloat(tot_stn_pcs).toFixed(2) + '</strong></td>'

						+ '<td><strong>' + parseFloat(tot_stn_wt).toFixed(3) + '</strong></td>'

						+ '<td><strong>' + parseFloat(tot_dia_pcs).toFixed(2) + '</strong></td>'

						+ '<td><strong>' + parseFloat(tot_dia_wt).toFixed(3) + '</strong></td>'

						+ '<td><strong>' + parseFloat(tot_va / plbill.length).toFixed(2) + '</strong></td>'

						+ '<td><strong>' + parseFloat(tot_saleswast).toFixed(3) + '</strong></td>'

						+ '<td><strong>' + parseFloat(tot_mc).toFixed(2) + '</strong></td>'

						+ '<td><strong>' + parseFloat(tot_stn_amt).toFixed(2) + '</strong></td>'

						+ '<td><strong>' + parseFloat(tot_dia_amt).toFixed(2) + '</strong></td>'

						+ '<td></td>'

						+ '<td><strong>' + parseFloat(tot_taxable).toFixed(2) + '</strong></td>'

						+ '<td><strong>' + parseFloat(tot_total_tax).toFixed(2) + '</strong></td>'

						+ '<td><strong>' + parseFloat(tot_purwastage / plbill.length).toFixed(2) + '</strong></td>'

						+ '<td><strong>' + parseFloat(tot_purwastagewt).toFixed(3) + '</strong></td>'

						+ '<td><strong>' + parseFloat(tot_stn_pur_amt).toFixed(2) + '</strong></td>'

						+ '<td><strong>' + parseFloat(tot_dia_pur_amt).toFixed(2) + '</strong></td>'

						+ '<td></td>'

						+ '<td><strong>' + parseFloat(tot_pur_total_taxable).toFixed(2) + '</strong></td>'

						+ '<td><strong>' + parseFloat(tot_pur_total_tax).toFixed(2) + '</strong></td>'

						+ '<td><strong>' + parseFloat(tot_saleamt).toFixed(2) + '</strong></td>'

						+ '<td><strong>' + parseFloat(tot_tag_purchase_cost).toFixed(2) + '</strong></td>'

						+ '<td><strong>' + parseFloat(tot_wastprofit).toFixed(3) + '</strong></td>'

						+ '<td><strong>' + parseFloat(tot_profitwastper / plbill.length).toFixed(2) + '</strong></td>'

						+ '<td><strong>' + parseFloat(tot_profitamt).toFixed(2) + '</strong></td>'

					'</tr>';

				});

				trHTML += '<tr>' +

					'<td><strong> GRAND TOTAL </strong></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td><strong>' + grand_tot_pcs + '</strong></td>'

					+ '<td><strong>' + parseFloat(grand_tot_salesgwt).toFixed(3) + '</strong></td>'

					+ '<td><strong>' + parseFloat(grand_tot_salesnwt).toFixed(3) + '</strong></td>'

					+ '<td><strong>' + parseFloat(grand_tot_stn_pcs).toFixed(0) + '</strong></td>'

					+ '<td><strong>' + parseFloat(grand_tot_stn_wt).toFixed(3) + '</strong></td>'

					+ '<td><strong>' + parseFloat(grand_tot_dia_pcs).toFixed(0) + '</strong></td>'

					+ '<td><strong>' + parseFloat(grand_tot_dia_wt).toFixed(3) + '</strong></td>'

					+ '<td><strong>' + parseFloat(grand_tot_va / count).toFixed(2) + '</strong></td>'

					+ '<td><strong>' + parseFloat(grand_tot_saleswast).toFixed(3) + '</strong></td>'

					+ '<td><strong>' + parseFloat(grand_tot_mc).toFixed(2) + '</strong></td>'

					+ '<td><strong>' + parseFloat(grand_tot_stn_amt).toFixed(2) + '</strong></td>'

					+ '<td><strong>' + parseFloat(grand_tot_dia_amt).toFixed(2) + '</strong></td>'

					+ '<td></td>'

					+ '<td><strong>' + parseFloat(grand_tot_taxable).toFixed(2) + '</strong></td>'

					+ '<td><strong>' + parseFloat(grand_tot_total_tax).toFixed(2) + '</strong></td>'

					+ '<td><strong>' + parseFloat(grand_tot_purwastage / count).toFixed(2) + '</strong></td>'

					+ '<td><strong>' + parseFloat(grand_tot_purwastagewt).toFixed(3) + '</strong></td>'

					+ '<td><strong>' + parseFloat(grand_tot_stn_pur_amt).toFixed(2) + '</strong></td>'

					+ '<td><strong>' + parseFloat(grand_tot_dia_pur_amt).toFixed(2) + '</strong></td>'

					+ '<td></td>'

					+ '<td><strong>' + parseFloat(grand_tot_pur_total_taxable).toFixed(2) + '</strong></td>'

					+ '<td><strong>' + parseFloat(grand_tot_pur_total_tax).toFixed(2) + '</strong></td>'

					+ '<td><strong>' + parseFloat(grand_tot_saleamt).toFixed(2) + '</strong></td>'

					+ '<td><strong>' + parseFloat(grand_tot_tag_purchase_cost).toFixed(2) + '</strong></td>'

					+ '<td><strong>' + parseFloat(grand_tot_wastprofit).toFixed(3) + '</strong></td>'

					+ '<td><strong>' + parseFloat(grand_tot_profitwastper / count).toFixed(2) + '</strong></td>'

					+ '<td><strong>' + parseFloat(grand_tot_profitamt).toFixed(2) + '</strong></td>'

				'</tr>';

				/* += '<tr style="font-weight:bold;">' +

							+'<td></td>'

							+'<td></td>'

							+'<td></td>'

							+'<td></td>'

							+'<td></td>'

							+'<td>GrandTotal</td>'

							+'<td></td>'

							+'<td></td>'

							+'<td></td>'

							+'<td></td>'

							+'<td></td>'

							+'<td></td>'

							+'<td></td>'

							+'<td></td>'

							+'<td></td>'

							+'<td></td>'

							'</tr>';*/

				$('#tagprofit_details > tbody').html(trHTML);

				// Check and initialise datatable

				if (!$.fn.DataTable.isDataTable('#tagprofit_details')) {

					oTable = $('#tagprofit_details').dataTable({

						"bSort": false,

						"bInfo": true,

						"scrollX": '100%',

						"dom": 'lBfrtip',

						"paging": false,

						"fixedHeader": true,

						"columnDefs": [{

							targets: [0, 1, 2, 3, 4, 5],

							className: 'dt-left'

						},

						{

							targets: [6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32],

							className: 'dt-right'

						}

						],

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: '',

								messageTop: title,

								exportOptions: {

									columns: ':visible'

								},

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', '12px')

										.css('font-family', 'sans-serif');

								},

							},

							'colvis',

							{

								extend: 'excel',

								footer: true,

								title: 'Tag Wise Profit List',

							}

						],

					});

				}

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//tag wise profit list

//Approval tag item report

function set_approval_tagged_items() {

	var company_name = $('#company_name').val();

	var from_date = '';

	var to_date = '';

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "Design-wise Tag Items";

	var prod_select = $('#prod_select option:selected').html() != '' && $('#prod_select option:selected').html() != undefined ? $('#prod_select option:selected').html() + ' - ' : '';

	var des_select = $('#des_select option:selected').html() != '' && $('#des_select option:selected').html() != undefined ? $('#des_select option:selected').html() + ' - ' : '';

	var select_size = $('#select_size option:selected').html() != '' && $('#select_size option:selected').html() != undefined ? $('#select_size option:selected').html() + ' - ' : '';

	var from_weight = $('#from_weight').val() != '' ? $('#from_weight').val() + ' - ' : '';

	var to_weight = $('#to_weight').val() != '' ? $('#to_weight').val() + ' - ' : '';

	var weight = from_weight != '' && to_weight != '' ? from_weight + to_weight : '';

	var optional = prod_select + des_select + weight + select_size;

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/approvaltag_items_designwise/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'id_product': $('#prod_select').val(), 'id_design': $("#des_select").val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'from_weight': $('#from_weight').val(), 'to_weight': $('#to_weight').val(), 'id_size': $('#select_size').val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.list;

			var stock_details = data.stock_details;

			var tot_weight = 0;

			$.each(list, function (key, item) {

				tot_weight += parseFloat(item.gross_wt);

			})

			$('#total_count').text(list.length);

			$('#total_wt').text(parseFloat(tot_weight).toFixed(3));

			$("#tag_item_branchwise > tbody > tr").remove();

			if ((stock_details.length > 0) && ($("#branch_select").val() == 0)) {

				var trHtml = '';

				var tot_pcs = 0;

				var tot_gross_wt = 0;

				var tot_net_wt = 0;

				$.each(stock_details, function (key, items) {

					tot_pcs += parseFloat(items.piece);

					tot_gross_wt += parseFloat(items.gross_wt);

					tot_net_wt += parseFloat(items.gross_wt);

					trHtml += '<tr>'

						+ '<td>' + items.branch_name + '</td>'

						+ '<td>' + money_format_india(items.piece) + '</td>'

						+ '<td>' + money_format_india(items.gross_wt) + '</td>'

						+ '<td>' + money_format_india(items.net_wt) + '</td>'

						+ '</tr>';

				});

				trHtml += '<tr style="font-weight:bold;color:red">'

					+ '<td>TOTAL</td>'

					+ '<td>' + money_format_india(parseFloat(tot_pcs).toFixed(2)) + '</td>'

					+ '<td>' + money_format_india(parseFloat(tot_gross_wt).toFixed(2)) + '</td>'

					+ '<td>' + money_format_india(parseFloat(tot_net_wt).toFixed(2)) + '</td>'

					+ '</tr>';

				$('#tag_item_branchwise').append(trHtml);

			}

			var oTable = $('#tag_items_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#tag_items_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"order": [[0, "desc"]],

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"columnDefs": [

						{

							targets: [9, 10, 11, 12, 13, 14, 15, 16],

							className: 'dt-body-right'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', '10px');

							},

						},

						{

							extend: 'colvis',

							collectionLayout: 'fixed columns',

							collectionTitle: 'Column visibility control'

						},

						{

							extend: 'excel',

							footer: true,

							title: "Design-wise Tag Items",

						}

					],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "tag_lot_id" },

						{ "mDataProp": "po_ref_no" },

						{ "mDataProp": "karigar" },

						{ "mDataProp": "tag_code" },

						{ "mDataProp": "tag_date" },

						{ "mDataProp": "branch_name" },

						{ "mDataProp": "product_name" },

						{ "mDataProp": "design_name" },

						{ "mDataProp": "sub_design_name" },

						{ "mDataProp": "piece" },

						{ "mDataProp": "gross_wt" },

						{ "mDataProp": "net_wt" },

						{ "mDataProp": "size_name" },

						{ "mDataProp": "retail_max_wastage_percent" },

						{

							"mDataProp": function (row, type, val, meta) {

								if (row.tag_mc_type == 2) {

									return row.tag_mc_value;

								} else {

									return '-';

								}

							},

						},

						{

							"mDataProp": function (row, type, val, meta) {

								if (row.tag_mc_type == 1) {

									return row.tag_mc_value;

								} else {

									return '-';

								}

							},

						},

						{

							"mDataProp": function (row, type, val, meta) {

								return money_format_india(row.sales_value);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								return '<span class="badge bg-red">' + row.tot_est + '</span>';

							}

						},

					],

				});

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

////Approval tag item report

//Customer Ledger

function get_CustomerLedger() {

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/customer_ledger_statement/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: {},

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			var oTable = $('#customer_ledgere_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#customer_ledgere_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: "Cusomer Ledger",

							messageTop: "Cusomer Ledger",

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: "Cusomer Ledger",

						}

					],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "cusName" },

						{ "mDataProp": "Debit" },

						{ "mDataProp": "Credit" },

						{ "mDataProp": "balance" },

						{

							"mDataProp": null,

							"sClass": "control center",

							"sDefaultContent": '<span class="drill-val"><i class="fa fa-chevron-circle-down text-teal"></i></span>'

						},

					],

				});

				var anOpen = [];

				$(document).on('click', "#customer_ledgere_list .control", function () {

					var nTr = this.parentNode;

					var i = $.inArray(nTr, anOpen);

					if (i === -1) {

						$('.drill-val', this).html('<i class="fa fa-chevron-circle-up text-teal"></i>');

						oTable.fnOpen(nTr, fnFormatRowLedgerDetails(oTable, nTr), 'details');

						anOpen.push(nTr);

					}

					else {

						$('.drill-val', this).html('<i class="fa fa-chevron-circle-down text-teal"></i>');

						oTable.fnClose(nTr);

						anOpen.splice(i, 1);

					}

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function fnFormatRowLedgerDetails(oTable, nTr) {

	var oData = oTable.fnGetData(nTr);

	var rowDetail = '';

	var prodTable =

		'<div class="innerDetails">' +

		'<table class="table table-responsive table-bordered text-center table-sm">' +

		'<tr class="bg-teal">' +

		'<th>Date</th>' +

		'<th>Ref No</th>' +

		'<th>Acc type</th>' +

		'<th>Debit</th>' +

		'<th>Credit</th>' +

		'<th>Balance</th>' +

		'</tr>';

	var ledger_details = oData.statements;

	var total_pcs = 0;

	var total_gwt = 0;

	$.each(ledger_details, function (idx, val) {

		prodTable +=

			'<tr class="prod_det_btn">' +

			'<td>' + val.billDate + '</td>' +

			'<td>' + val.refNo + '</td>' +

			'<td>' + val.accType + '</td>' +

			'<td>' + val.Debit + '</td>' +

			'<td>' + val.Credit + '</td>' +

			'<td>' + val.balance + '</td>' +

			'</tr>';

	});

	rowDetail = prodTable + '</table></div>';

	return rowDetail;

}

//Customer Ledger

//Supplier Ledger

function getSupplierLedger() {

	var dt_range = ($("#dt_range").val()).split('-');

	var from_date = dt_range[0];

	var to_date = dt_range[1];

	var company_name = $('#company_name').val();

	var branch_name = ''

	var report_name = "SUPPLIER LEDGER"

	var optional = '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	var dt_range = ($("#dt_range").val()).split('-');

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/supplierledger/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: { 'dt_range': $("#dt_range").val(), "ledgerType": $("input[name='ledger_type']:checked").val(), "partyId": $("#karigar").val() },

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var opening_value = "";

			var closing_value = "";

			var list = data.list;

			$.each(data.list, function (key, item) {

				if (key == 0) {

					opening_value = "Opening Balance : " + item.openingbalance;

				}

				if (data.list.length - 1 == key) {

					closing_value = "Closing Balance : " + (item.balance);

				}

			});

			var oTable = $('#supplier_ledgere_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#supplier_ledgere_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": false,

					"dom": 'lBfrtip',

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: "",

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: "Supplier Ledger",

						}

					],

					"columnDefs": [

						{

							targets: [4, 5, 6],

							className: 'dt-body-right'

						},

						{

							targets: [0, 3],

							className: 'dt-body-left'

						}

					],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "firstname" },

						{ "mDataProp": "transdate" },

						{

							"mDataProp": function (row, type, val, meta) {

								return row.ref_no;

							}

						},

						{ "mDataProp": "accType" },

						{

							"mDataProp": function (row, type, val, meta) {

								return money_format_india(row.Debit);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								return money_format_india(row.Credit);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								return money_format_india(row.balance) + '' + row.balancetype;

							}

						},

					],

				});

			}

			//$( "<p>Test</p>" ).insertAfter(  ".dt-buttons"  );

			if ($(".insertopenclose").length > 0) {

				$(".insertopenclose").remove();

			}

			$(".dt-buttons").after('<div class="col-md-6 insertopenclose" style="font-weight: bold;text-align: center;">' + opening_value + ' \t\t ' + closing_value + '</div>');

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//Supplier Ledger

//smith Ledger

$('#smith_ledger_search').on('click', function () {

	get_SmithTransactions();

});

$('#smith_transactions').on('click', function () {

	get_SmithAllTransactions();

});

function get_SmithTransactions() {

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	var dt_range = ($("#dt_range").val()).split('-');

	var group_by_required = 0;

	if ($("#group_by_required").prop('checked') == true) {

		group_by_required = 1;

	}

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/smithtransaction/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: { 'dt_range': $("#dt_range").val(), "partyId": $("#karigar").val(), "metalType": $("#stoneType").val(), "id_metal": $("#metal").val(), "group_by_required": group_by_required },

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var dt_range = ($("#dt_range").val()).split('-');

			var supplier_name = $("#karigar option:selected").text();

			var currentdate = new Date();

			var datetime = "Report Time : " + currentdate.getDate() + "/"

				+ (currentdate.getMonth() + 1) + "/"

				+ currentdate.getFullYear() + " @ "

				+ currentdate.getHours() + ":"

				+ currentdate.getMinutes() + ":"

				+ currentdate.getSeconds();

			var title = "<div style='text-align: center;'><b><span style='font-size:12pt;'>Smith / Supplier Ledger Report </span></b></br>"

				+ "<span style='font-size:11pt;'>" + ($("#karigar").val() != '' ? "Karigar :" + supplier_name + " " : '') + "</span></br>"

				+ "<span style=font-size:12pt;>From&nbsp;:&nbsp;" + dt_range[0] + " &nbsp;&nbsp;To Date&nbsp;:&nbsp;" + dt_range[1] + "</br> </span></br>"

				+ "<span style=font-size:12pt;>" + datetime + "</span></div>";

			$("#smith_ledgere_list > tbody > tr").remove();

			$('#smith_ledgere_list').dataTable().fnClearTable();

			$('#smith_ledgere_list').dataTable().fnDestroy();

			var list = data.list;

			console.log(list);

			var trHTML = '';

			var opening_value = "";

			var closing_value = "";

			var opening_wt = "";

			var closing_wt = "";

			var list = data.list;

			var issuePcs = 0;

			var issueGrs = 0;

			var issueNet = 0;

			var issuePur = 0;

			var receiptPcs = 0;

			var receiptGrs = 0;

			var receiptNet = 0;

			var receiptPur = 0;

			var debitAmt = 0;

			var creditAmt = 0;

			var blcPcs = 0;

			var blcgrsWt = 0;

			var blcnetWt = 0;

			var blcpurWt = 0;

			var blcAmt = 0;

			var allBlcAmt = 0;

			var allBlcgrsWt = 0;

			var allBlcgnetWt = 0;

			var allBlcpurWt = 0;

			var tFtrHTML = "";

			$.each(data.list, function (key, item) {

				if (key == 0) {

					/*opening_value = "Outstanding Amt(Rs) : " + parseFloat(item.opening).toFixed(2) + " Outstanding Pure Wt(Grms): " + parseFloat(item.openingpure).toFixed(3);*/

					opening_value = "<div style='display:flex;width:100%;text-align:left'><div style='width:38%'>Outstanding Amt(Rs)</div><div style='width:10%;text-align:right'>:</div><div style='width:30%;text-align:right'>" + parseFloat(item.opening).toFixed(2) + "</div></div><div style='display:flex;width:100%'><div style='width:38%;text-align:left'>Outstanding Pure Wt(Grms)</div><div style='width:10%;text-align:right'>:</div><div style='width:30%;text-align:right'>" + parseFloat(item.openingpure).toFixed(3) + "</div></div>";

				}

				if (data.list.length - 1 == key) {

					//var amttype = item.balance > 0 ? "(Dr)" : "(Cr)";

					//var mettype = item.purebalance > 0 ? "(Dr)" : "(Cr)";

					//closing_value = "Outstanding Amt(Rs) : " + item.balance + "\t\t Outstanding Pure Wt(Grms): " + item.purebalance;

					closing_value = "<div style='display:flex;width:100%;text-align:left'><div style='width:38%'>Outstanding Amt(Rs)</div><div style='width:10%;text-align:right'>:</div><div style='width:30%;text-align:right'>" + item.balance + "</div></div><div style='display:flex;width:100%'><div style='width:38%;text-align:left'>Outstanding Pure Wt(Grms)</div><div style='width:10%;text-align:right'>:</div><div style='width:30%;text-align:right'>" + item.purebalance + "</div></div>";

					blcPcs = parseInt(item.RunningBalancePcs);

					blcgrsWt = money_format_india(parseFloat(item.RunningBalanceGwt).toFixed(3));

					blcnetWt = money_format_india(parseFloat(item.RunningBalanceNwt).toFixed(3));

					blcpurWt = money_format_india(parseFloat(item.RunningBalancePwt).toFixed(3));

					blcAmt = money_format_india(parseFloat(item.RunningBalance).toFixed(3));

				}

				issuePcs += isNaN(item.IssuePcs) ? 0 : parseInt(item.IssuePcs);

				issueGrs += isNaN(parseFloat(item.IssueGrsWt)) ? 0 : parseFloat(item.IssueGrsWt);

				issueNet += isNaN(parseFloat(item.IssueNetWt)) ? 0 : parseFloat(item.IssueNetWt);

				issuePur += isNaN(parseFloat(item.IssuePureWt)) ? 0 : parseFloat(item.IssuePureWt);

				receiptPcs += isNaN(item.ReceiptPcs) ? 0 : parseInt(item.ReceiptPcs);

				receiptGrs += isNaN(parseFloat(item.ReceiptGrsWt)) ? 0 : parseFloat(item.ReceiptGrsWt);

				receiptNet += isNaN(parseFloat(item.ReceiptNetWt)) ? 0 : parseFloat(item.ReceiptNetWt);

				receiptPur += isNaN(parseFloat(item.ReceiptPureWt)) ? 0 : parseFloat(item.ReceiptPureWt);

				debitAmt += isNaN(parseFloat(item.Debit)) ? 0 : parseFloat(item.Debit);

				creditAmt += isNaN(parseFloat(item.Credit)) ? 0 : parseFloat(item.Credit);

				allBlcAmt += isNaN(parseFloat(item.RunningBalance)) ? 0 : parseFloat(item.RunningBalance);

				allBlcgrsWt += isNaN(parseFloat(item.RunningBalanceGwt)) ? 0 : parseFloat(item.RunningBalanceGwt);

				allBlcgnetWt += isNaN(parseFloat(item.RunningBalanceNwt)) ? 0 : parseFloat(item.RunningBalanceNwt);

				allBlcpurWt += isNaN(parseFloat(item.RunningBalancePwt)) ? 0 : parseFloat(item.RunningBalancePwt);

			});

			if (list != null) {

				if ($("#karigar").val() == null || $("#karigar").val() == 0) {

					blcAmt = money_format_india(parseFloat(allBlcAmt).toFixed(2));

					blcgrsWt = money_format_india(parseFloat(allBlcgrsWt).toFixed(3));

					blcnetWt = money_format_india(parseFloat(allBlcgnetWt).toFixed(3));

					blcpurWt = money_format_india(parseFloat(allBlcpurWt).toFixed(3));

				}

				var sub_metal_issue_wt = 0;

				var sub_metal_pure_wt = 0;

				var tot_metal_weight = 0;

				var tot_metal_pur_weight = 0;

				var subclosingblc = 0;

				var retuom = $("#stoneType").val() == 2 ? "CT" : "Grm";

				$.each(list, function (idx, item) {

					if (item.trans_rec_type == 1) {

						trHTML += '<tr>'

							+ '<td style="text-align: left;">' + item.particulars + '</td>'

							+ '<td style="text-align: left;">' + item.transrefno + '</td>'

							+ '<td>' + item.trans_date + '</td>'

							+ '<td style="text-align: right;">' + item.IssuePcs + '</td>'

							+ '<td style="text-align: right;">' + item.IssueGrsWt + '</td>'

							+ '<td style="text-align: right;">' + item.IssueNetWt + '</td>'

							+ '<td style="text-align: right;">' + item.IssuePureWt + '</td>'

							+ '<td style="text-align: right;">' + item.dispuom + '</td>'

							+ '<td style="text-align: right;">' + item.ReceiptPcs + '</td>'

							+ '<td style="text-align: right;">' + item.ReceiptGrsWt + '</td>'

							+ '<td style="text-align: right;">' + item.ReceiptNetWt + '</td>'

							+ '<td style="text-align: right;">' + item.ReceiptPureWt + '</td>'

							+ '<td style="text-align: right;">' + item.dispuom + '</td>'

							+ '<td style="text-align: right;">' + money_format_india(item.Debit) + '</td>'

							+ '<td style="text-align: right;">' + money_format_india(item.Credit) + '</td>'

							+ '<td style="text-align: right;">' + parseInt(item.RunningBalancePcs) + '</td>'

							+ '<td style="text-align: right;">' + item.RunningBalanceGwt + '</td>'

							+ '<td style="text-align: right;">' + item.RunningBalanceNwt + '</td>'

							+ '<td style="text-align: right;">' + item.RunningBalancePwt + '</td>'

							+ '<td style="text-align: right;">' + money_format_india(item.RunningBalance) + '</td>'

							+ '<td style="text-align: right;">' + item.purchase_touch + '</td>'

							+ '<td style="text-align: right;">' + item.rate + '</td>'

							+ '<td style="text-align: left;">' + item.narration + '</td>'

						'</tr>';

					} else {

						trHTML += '<tr>'

							+ '<td style="text-align: left;">' + item.particulars + '</td>'

							+ '<td style="text-align: left;">' + item.transrefno + '</td>'

							+ '<td>' + item.trans_date + '</td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td style="text-align: right;">' + money_format_india(item.Debit) + '</td>'

							+ '<td style="text-align: right;">' + money_format_india(item.Credit) + '</td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td style="text-align: right;">' + money_format_india(item.RunningBalance) + '</td>'

							+ '<td style="text-align: right;">' + item.purchase_touch + '</td>'

							+ '<td style="text-align: right;">' + item.rate + '</td>'

							+ '<td style="text-align: left;">' + item.narration + '</td>'

						'</tr>';

					}

				});

				tFtrHTML = '<tr>'

					+ '<td style="text-align: left;font-weight:bold;">Total : </td>'

					+ '<td style="text-align: left;"></td>'

					+ '<td></td>'

					+ '<td style="text-align: right;font-weight:bold;">' + parseInt(issuePcs) + '</td>'

					+ '<td style="text-align: right;font-weight:bold;">' + money_format_india(parseFloat(issueGrs).toFixed(3)) + '</td>'

					+ '<td style="text-align: right;font-weight:bold;">' + money_format_india(parseFloat(issueNet).toFixed(3)) + '</td>'

					+ '<td style="text-align: right;font-weight:bold;">' + money_format_india(parseFloat(issuePur).toFixed(3)) + '</td>'

					+ '<td></td>'

					+ '<td style="text-align: right;font-weight:bold;">' + parseInt(receiptPcs) + '</td>'

					+ '<td style="text-align: right;font-weight:bold;">' + money_format_india(parseFloat(receiptGrs).toFixed(3)) + '</td>'

					+ '<td style="text-align: right;font-weight:bold;">' + money_format_india(parseFloat(receiptNet).toFixed(3)) + '</td>'

					+ '<td style="text-align: right;font-weight:bold;">' + money_format_india(parseFloat(receiptPur).toFixed(3)) + '</td>'

					+ '<td></td>'

					+ '<td style="text-align: right;font-weight:bold;">' + money_format_india(parseFloat(debitAmt).toFixed(2)) + '</td>'

					+ '<td style="text-align: right;font-weight:bold;">' + money_format_india(parseFloat(creditAmt).toFixed(2)) + '</td>'

					+ '<td style="text-align: right;font-weight:bold;">' + blcPcs + '</td>'

					+ '<td style="text-align: right;font-weight:bold;">' + blcgrsWt + '</td>'

					+ '<td style="text-align: right;font-weight:bold;">' + blcnetWt + '</td>'

					+ '<td style="text-align: right;font-weight:bold;">' + blcpurWt + '</td>'

					+ '<td style="text-align: right;font-weight:bold;">' + blcAmt + '</td>'

					+ '<td style="text-align: right;"></td>'

					+ '<td style="text-align: right;"></td>'

					+ '<td style="text-align: left;"></td>'

				'</tr>';

			}

			$('#smith_ledgere_list > tbody').html(trHTML);

			$('#smith_ledgere_list > tfoot').html(tFtrHTML);

			// Check and initialise datatable

			if (!$.fn.DataTable.isDataTable('#smith_ledgere_list')) {

				oTable = $('#smith_ledgere_list').dataTable({

					"bSort": false,

					"bInfo": true,

					"scrollX": '100%',

					"dom": 'lBfrtip',

					"paging": false,

					"fixedHeader": true,

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

						},

						{

							extend: 'colvis',

							collectionLayout: 'fixed columns',

							collectionTitle: 'Column visibility control'

						},

					]/*,

					"columnDefs": [

						{

							targets: [0, 1, 2],

							className: 'dt-body-left'

						},

						{

							targets: [3, 4, 5, 6, 7, 8,9,10,11,12,13,14,15,16,17,18,19,20],

							className: 'dt-body-right'

						},

					]*/

				});

			}

			$(".dt-buttons").after('<h4><div class="col-md-6 insertopenclose" style="font-weight: bold;text-align: center;margin-left: 80px;">' + closing_value + '</div></h4>');

			//' + opening_value + ' \t\t '

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function get_SmithAllTransactions() {

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	var dt_range = ($("#dt_range").val()).split('-');

	var title = "Smith Transactions";

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/smithalltransactions/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: { 'dt_range': $("#dt_range").val(), "partyId": $("#karigar").val() },

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var opening_value = "";

			var closing_value = "";

			var amtopening_value = "";

			var amtclosing_value = "";

			var list = data.list;

			$.each(data.list, function (key, item) {

				if (key == 0) {

					opening_value = "Opening Balance Wt : " + item.met_openingbalance;

					amtopening_value = "Opening Balance Amount : " + item.amt_openingbalance;

				}

				if (data.list.length - 1 == key) {

					closing_value = "Closing Balance Wt: " + item.met_balance;

					amtclosing_value = "Closing Balance Amount: " + item.amt_balance;

				}

			});

			var oTable = $('#smith_ledgere_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#smith_ledgere_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"order": [[0, "asc"]],

					"lengthMenu": [[-1, 25, 50, 100, 250], ["All", 25, 50, 100, 250]],

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"columnDefs": [

						{

							targets: [0, 1, 2],

							className: 'dt-body-left'

						},

						{

							targets: [3, 4, 5, 6, 7, 8],

							className: 'dt-body-right'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: "Smith Transactions",

							messageTop: "Smith Transactions",

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'colvis',

							collectionLayout: 'fixed columns',

							collectionTitle: 'Column visibility control'

						},

						{

							extend: 'excel',

							footer: true,

							title: "Smith Transactions",

						}

					],

					"aaData": list,

					"aoColumns": [

						{

							"mDataProp": function (row, type, val, meta) {

								return $('#karigar').val() == 0 || $('#karigar').val() == null ? row.sup_name : row.transdate;

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								return $('#karigar').val() == 0 || $('#karigar').val() == null ? '' : row.ref_no;

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								return $('#karigar').val() == 0 || $('#karigar').val() == null ? '' : row.accType;

							}

						},

						{ "mDataProp": "met_debit" },

						{ "mDataProp": "met_credit" },

						{ "mDataProp": "met_balance" },

						{

							"mDataProp": function (row, type, val, meta) {

								return money_format_india(row.amt_debit);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								return money_format_india(row.amt_credit);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								return row.amt_balance;

							}

						}

					],

					"footerCallback": function (row, data, start, end, display) {

						if (data.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								var totdebit = api

									.column(3, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(3).footer()).html(parseFloat(totdebit).toFixed(3));

								var totcredit = api

									.column(4, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(4).footer()).html(parseFloat(totcredit).toFixed(3));

								/*var totbalance = api

								.column(5, {search:'applied'})

								.data()

								.reduce( function (a, b) {

									return intVal(parseFloat(a)) + intVal(parseFloat(b));

								}, 0 );

								$(api.column(5).footer()).html(parseFloat(totbalance).toFixed(3));*/

								var totamtdebit = api

									.column(6, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(6).footer()).html(money_format_india(parseFloat(totamtdebit).toFixed(2)));

								var totamtcredit = api

									.column(7, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(7).footer()).html(money_format_india(parseFloat(totamtcredit).toFixed(2)));

							}

						} else {

							var api = this.api(), data;

							$(api.column(1).footer()).html('');

						}

					}

				});

			}

			//$( "<p>Test</p>" ).insertAfter(  ".dt-buttons"  );

			if ($(".insertopenclose").length > 0) {

				$(".insertopenclose").remove();

			}

			$(".dt-buttons").after('<div class="col-md-6 insertopenclose" style="font-weight: bold;text-align: center;">' + opening_value + ' \t\t ' + closing_value + '<br />' + amtopening_value + ' \t\t ' + amtclosing_value + '</div>');

			$("div.overlay").css("display", "none");

			//var title = "Smith Transactions";

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//smith Ledger

//Supplier Ledger

$('#supplier_ledger_search').on('click', function () {

	get_SupplierTransactions();

});

function get_SupplierTransactions() {

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	var dt_range = ($("#dt_range").val()).split('-');

	var metal_wise_required = 0;

	if ($("#metal_wise_required").prop('checked') == true) {

		metal_wise_required = 1;

	}

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/suppliertransaction/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: { 'dt_range': $("#dt_range").val(), "partyId": $("#karigar").val(), 'id_metal': $('#metal').val(), 'metal_wise_required': metal_wise_required },

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var dt_range = ($("#dt_range").val()).split('-');

			var supplier_name = $("#karigar option:selected").text();

			var currentdate = new Date();

			var datetime = "Report Time : " + currentdate.getDate() + "/"

				+ (currentdate.getMonth() + 1) + "/"

				+ currentdate.getFullYear() + " @ "

				+ currentdate.getHours() + ":"

				+ currentdate.getMinutes() + ":"

				+ currentdate.getSeconds();

			var title = "<div style='text-align: center;'><b><span style='font-size:12pt;'>Smith / Supplier Ledger Report </span></b></br>"

				+ "<span style='font-size:11pt;'>" + ($("#karigar").val() != '' ? "Karigar :" + supplier_name + " " : '') + "</span></br>"

				+ "<span style=font-size:12pt;>From&nbsp;:&nbsp;" + dt_range[0] + " &nbsp;&nbsp;To Date&nbsp;:&nbsp;" + dt_range[1] + "</br> </span></br>"

				+ "<span style=font-size:12pt;>" + datetime + "</span></div>";

			if (metal_wise_required == 0) {

				$('#smith_ledgere_metal_list_sip').css('display', 'none');

				$('#smith_ledgere_list_sip').css('display', 'block');

				$("#smith_ledgere_list > tbody > tr").remove();

				$('#smith_ledgere_list').dataTable().fnClearTable();

				$('#smith_ledgere_list').dataTable().fnDestroy();

				var list = data.list;

				console.log(list);

				var trHTML = '';

				var opening_value = "";

				var closing_value = "";

				var opening_wt = "";

				var closing_wt = "";

				var list = data.list;

				var issuePcs = 0;

				var issueGrs = 0;

				var issueNet = 0;

				var issuePur = 0;

				var receiptPcs = 0;

				var receiptGrs = 0;

				var receiptNet = 0;

				var receiptPur = 0;

				var debitAmt = 0;

				var creditAmt = 0;

				var blcPcs = 0;

				var blcgrsWt = 0;

				var blcnetWt = 0;

				var blcpurWt = 0;

				var blcAmt = 0;

				var alblcPcs = 0;

				var allblcgrsWt = 0;

				var allblcnetWt = 0;

				var allblcpurWt = 0;

				var allblcAmt = 0;

				var tFtrHTML = "";

				$.each(data.list, function (key, item) {

					if (key == 0) {

						/*opening_value = "Outstanding Amt(Rs) : " + parseFloat(item.opening).toFixed(2) + " Outstanding Pure Wt(Grms): " + parseFloat(item.openingpure).toFixed(3);*/

						opening_value = "<div style='display:flex;width:100%;text-align:left'><div style='width:38%'>Outstanding Amt(Rs)</div><div style='width:10%;text-align:right'>:</div><div style='width:30%;text-align:right'>" + parseFloat(item.opening).toFixed(2) + "</div></div><div style='display:flex;width:100%'><div style='width:38%;text-align:left'>Outstanding Pure Wt(Grms)</div><div style='width:10%;text-align:right'>:</div><div style='width:30%;text-align:right'>" + parseFloat(item.openingpure).toFixed(3) + "</div></div>";

					}

					if (data.list.length - 1 == key) {

						//var amttype = item.balance > 0 ? "(Dr)" : "(Cr)";

						//var mettype = item.purebalance > 0 ? "(Dr)" : "(Cr)";

						//closing_value = "Outstanding Amt(Rs) : " + item.balance + "\t\t Outstanding Pure Wt(Grms): " + item.purebalance;

						closing_value = "<div style='display:flex;width:100%;text-align:left'><div style='width:38%'>Outstanding Amt(Rs)</div><div style='width:10%;text-align:right'>:</div><div style='width:30%;text-align:right'>" + item.balance + "</div></div><div style='display:flex;width:100%'><div style='width:38%;text-align:left'>Outstanding Pure Wt(Grms)</div><div style='width:10%;text-align:right'>:</div><div style='width:30%;text-align:right'>" + item.purebalance + "</div></div>";

						blcPcs = parseInt(item.RunningBalancePcs);

						blcgrsWt = money_format_india(parseFloat(item.RunningBalanceGwt).toFixed(3));

						blcnetWt = money_format_india(parseFloat(item.RunningBalanceNwt).toFixed(3));

						blcpurWt = money_format_india(parseFloat(item.RunningBalancePwt).toFixed(3));

						blcAmt = money_format_india(parseFloat(item.RunningBalance).toFixed(3));

					}

					issuePcs += isNaN(item.IssuePcs) ? 0 : parseInt(item.IssuePcs);

					issueGrs += isNaN(parseFloat(item.IssueGrsWt)) ? 0 : parseFloat(item.IssueGrsWt);

					issueNet += isNaN(parseFloat(item.IssueNetWt)) ? 0 : parseFloat(item.IssueNetWt);

					issuePur += isNaN(parseFloat(item.IssuePureWt)) ? 0 : parseFloat(item.IssuePureWt);

					receiptPcs += isNaN(item.ReceiptPcs) ? 0 : parseInt(item.ReceiptPcs);

					receiptGrs += isNaN(parseFloat(item.ReceiptGrsWt)) ? 0 : parseFloat(item.ReceiptGrsWt);

					receiptNet += isNaN(parseFloat(item.ReceiptNetWt)) ? 0 : parseFloat(item.ReceiptNetWt);

					receiptPur += isNaN(parseFloat(item.ReceiptPureWt)) ? 0 : parseFloat(item.ReceiptPureWt);

					debitAmt += isNaN(parseFloat(item.Debit)) ? 0 : parseFloat(item.Debit);

					creditAmt += isNaN(parseFloat(item.Credit)) ? 0 : parseFloat(item.Credit);

					alblcPcs += parseInt(item.RunningBalancePcs);

					allblcgrsWt += parseFloat(item.RunningBalanceGwt);

					allblcnetWt += parseFloat(item.RunningBalanceNwt);

					allblcpurWt += parseFloat(item.RunningBalancePwt);

					allblcAmt += parseFloat(item.RunningBalance);

				});

				if (list != null) {

					var sub_metal_issue_wt = 0;

					var sub_metal_pure_wt = 0;

					var tot_metal_weight = 0;

					var tot_metal_pur_weight = 0;

					var subclosingblc = 0;

					if ($('#karigar').val() == null || $('#karigar').val() == 0) {

						blcPcs = alblcPcs;

						blcgrsWt = money_format_india(parseFloat(allblcgrsWt).toFixed(3));

						blcnetWt = money_format_india(parseFloat(allblcnetWt).toFixed(3));

						blcpurWt = money_format_india(parseFloat(allblcpurWt).toFixed(3));

						blcAmt = money_format_india(parseFloat(allblcAmt).toFixed(2));

						//closing_value = "Outstanding Amt(Rs) : " + blcAmt + "\t\t Outstanding Pure Wt(Grms): " + blcpurWt;

						closing_value = "<div style='display:flex;width:100%;text-align:left'><div style='width:38%'>Outstanding Amt(Rs)</div><div style='width:10%;text-align:right'>:</div><div style='width:30%;text-align:right'>" + blcAmt + "</div></div><div style='display:flex;width:100%'><div style='width:38%;text-align:left'>Outstanding Pure Wt(Grms)</div><div style='width:10%;text-align:right'>:</div><div style='width:30%;text-align:right'>" + blcpurWt + "</div></div>";

					}

					$.each(list, function (idx, item) {

						if (item.trans_rec_type == 1) {

							trHTML += '<tr>'

								+ '<td style="text-align: left;">' + item.particulars + '</td>'

								+ '<td style="text-align: left;">' + item.transrefno + '</td>'

								+ '<td>' + item.trans_date + '</td>'

								+ '<td style="text-align: right;">' + item.IssuePcs + '</td>'

								+ '<td style="text-align: right;">' + item.IssueGrsWt + '</td>'

								+ '<td style="text-align: right;">' + item.IssueNetWt + '</td>'

								+ '<td style="text-align: right;">' + item.IssuePureWt + '</td>'

								+ '<td style="text-align: right;">' + item.ReceiptPcs + '</td>'

								+ '<td style="text-align: right;">' + money_format_india(parseFloat(item.ReceiptGrsWt, 3)) + '</td>'

								+ '<td style="text-align: right;">' + money_format_india(parseFloat(item.ReceiptNetWt, 3)) + '</td>'

								+ '<td style="text-align: right;">' + money_format_india(parseFloat(item.ReceiptPureWt, 3)) + '</td>'

								+ '<td style="text-align: right;">' + money_format_india(item.Debit) + '</td>'

								+ '<td style="text-align: right;">' + money_format_india(item.Credit) + '</td>'

								+ '<td style="text-align: right;">' + parseInt(item.RunningBalancePcs) + '</td>'

								+ '<td style="text-align: right;">' + money_format_india(item.RunningBalanceGwt) + '</td>'

								+ '<td style="text-align: right;">' + money_format_india(item.RunningBalanceNwt) + '</td>'

								+ '<td style="text-align: right;">' + money_format_india(item.RunningBalancePwt) + '</td>'

								+ '<td style="text-align: right;">' + money_format_india(item.RunningBalance) + '</td>'

								+ '<td style="text-align: right;">' + item.purchase_touch + '</td>'

								+ '<td style="text-align: right;">' + item.rate + '</td>'

								+ '<td style="text-align: left;">' + item.narration + '</td>'

							'</tr>';

						} else {

							trHTML += '<tr>'

								+ '<td style="text-align: left;">' + item.particulars + '</td>'

								+ '<td style="text-align: left;">' + item.transrefno + '</td>'

								+ '<td>' + item.trans_date + '</td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td style="text-align: right;">' + money_format_india(item.Debit) + '</td>'

								+ '<td style="text-align: right;">' + money_format_india(item.Credit) + '</td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td style="text-align: right;">' + money_format_india(item.RunningBalance) + '</td>'

								+ '<td style="text-align: right;">' + item.purchase_touch + '</td>'

								+ '<td style="text-align: right;">' + item.rate + '</td>'

								+ '<td style="text-align: left;">' + item.narration + '</td>'

							'</tr>';

						}

					});

					tFtrHTML = '<tr>'

						+ '<td style="text-align: left;font-weight:bold;">Total : </td>'

						+ '<td style="text-align: left;"></td>'

						+ '<td></td>'

						+ '<td style="text-align: right;font-weight:bold;">' + parseInt(issuePcs) + '</td>'

						+ '<td style="text-align: right;font-weight:bold;">' + money_format_india(parseFloat(issueGrs).toFixed(3)) + '</td>'

						+ '<td style="text-align: right;font-weight:bold;">' + money_format_india(parseFloat(issueNet).toFixed(3)) + '</td>'

						+ '<td style="text-align: right;font-weight:bold;">' + money_format_india(parseFloat(issuePur).toFixed(3)) + '</td>'

						+ '<td style="text-align: right;font-weight:bold;">' + parseInt(receiptPcs) + '</td>'

						+ '<td style="text-align: right;font-weight:bold;">' + money_format_india(parseFloat(receiptGrs).toFixed(3)) + '</td>'

						+ '<td style="text-align: right;font-weight:bold;">' + money_format_india(parseFloat(receiptNet).toFixed(3)) + '</td>'

						+ '<td style="text-align: right;font-weight:bold;">' + money_format_india(parseFloat(receiptPur).toFixed(3)) + '</td>'

						+ '<td style="text-align: right;font-weight:bold;">' + money_format_india(parseFloat(debitAmt).toFixed(2)) + '</td>'

						+ '<td style="text-align: right;font-weight:bold;">' + money_format_india(parseFloat(creditAmt).toFixed(2)) + '</td>'

						+ '<td style="text-align: right;font-weight:bold;">' + blcPcs + '</td>'

						+ '<td style="text-align: right;font-weight:bold;">' + blcgrsWt + '</td>'

						+ '<td style="text-align: right;font-weight:bold;">' + blcnetWt + '</td>'

						+ '<td style="text-align: right;font-weight:bold;">' + blcpurWt + '</td>'

						+ '<td style="text-align: right;font-weight:bold;">' + blcAmt + '</td>'

						+ '<td style="text-align: right;"></td>'

						+ '<td style="text-align: right;"></td>'

						+ '<td style="text-align: left;"></td>'

					'</tr>';

				}

				$('#smith_ledgere_list > tbody').html(trHTML);

				$('#smith_ledgere_list > tfoot').html(tFtrHTML);

				// Check and initialise datatable

				if (!$.fn.DataTable.isDataTable('#smith_ledgere_list')) {

					oTable = $('#smith_ledgere_list').dataTable({

						"bSort": false,

						"bInfo": true,

						"scrollX": '100%',

						"dom": 'lBfrtip',

						"paging": false,

						"fixedHeader": true,

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: '',

								messageTop: title,

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', 'inherit');

								},

								exportOptions: {

									columns: ':visible',

									stripHtml: false

								}

							},

							{

								extend: 'excel',

								footer: true,

								exportOptions: {

									columns: ':visible',

									stripHtml: false

								}

							},

							{

								extend: 'colvis',

								collectionLayout: 'fixed columns',

								collectionTitle: 'Column visibility control'

							},

						]/*,

						"columnDefs": [

							{

								targets: [0, 1, 2],

								className: 'dt-body-left'

							},

							{

								targets: [3, 4, 5, 6, 7, 8,9,10,11,12,13,14,15,16,17,18,19,20],

								className: 'dt-body-right'

							},

						]*/

					});

				}

			} else {

				$('#smith_ledgere_list_sip').css('display', 'none');

				$('#smith_ledgere_metal_list_sip').css('display', 'block');

				$("#smith_ledgere_metal_list > tbody > tr").remove();

				$('#smith_ledgere_metal_list').dataTable().fnClearTable();

				$('#smith_ledgere_metal_list').dataTable().fnDestroy();

				var list = data.metalwisedata;

				var opening_value = "";

				var closing_value = "";

				var opening_wt = "";

				var closing_wt = "";

				var trHTML = '';

				var gold_value = 0;

				var silver_value = 0;

				var platinum_wt = 0;

				var amount = 0;

				var tFtrHTML = "";

				$.each(list, function (key, item) {

					gold_value += parseFloat(item.goldwt);

					silver_value += parseFloat(item.silverwt);

					platinum_wt += parseFloat(item.platinumwt);

					amount += parseFloat(item.balanceamt);

				});

				if (list != null) {

					$.each(list, function (idx, item) {

						trHTML += '<tr>'

							+ '<td style="text-align: left;">' + item.firstname + '</td>'

							+ '<td style="text-align: right;">' + money_format_india(parseFloat(item.goldwt).toFixed(3)) + '</td>'

							+ '<td style="text-align: right;">' + money_format_india(parseFloat(item.silverwt).toFixed(3)) + '</td>'

							+ '<td style="text-align: right;">' + money_format_india(parseFloat(item.platinumwt).toFixed(3)) + '</td>'

							+ '<td style="text-align: right;">' + money_format_india(parseFloat(item.balanceamt).toFixed(2)) + '</td>'

						'</tr>';

					});

					tFtrHTML = '<tr>'

						+ '<td style="text-align: left;font-weight:bold;">Total : </td>'

						+ '<td style="text-align: right;font-weight:bold;">' + money_format_india(parseFloat(gold_value).toFixed(3)) + '</td>'

						+ '<td style="text-align: right;font-weight:bold;">' + money_format_india(parseFloat(silver_value).toFixed(3)) + '</td>'

						+ '<td style="text-align: right;font-weight:bold;">' + money_format_india(parseFloat(platinum_wt).toFixed(3)) + '</td>'

						+ '<td style="text-align: right;font-weight:bold;">' + money_format_india(parseFloat(amount).toFixed(3)) + '</td>'

					'</tr>';

				}

				$('#smith_ledgere_metal_list > tbody').html(trHTML);

				$('#smith_ledgere_metal_list > tfoot').html(tFtrHTML);

				// Check and initialise datatable

				if (!$.fn.DataTable.isDataTable('#smith_ledgere_metal_list')) {

					oTable = $('#smith_ledgere_metal_list').dataTable({

						"bSort": false,

						"bInfo": true,

						"scrollX": '100%',

						"dom": 'lBfrtip',

						"paging": false,

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: '',

								messageTop: title,

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', 'inherit');

								},

							},

							{

								extend: 'excel',

								footer: true,

							},

							{

								extend: 'colvis',

								collectionLayout: 'fixed columns',

								collectionTitle: 'Column visibility control'

							},

						]/*,

						"columnDefs": [

							{

								targets: [0],

								className: 'dt-body-left'

							},

							{

								targets: [1, 2, 3,4],

								className: 'dt-body-right'

							},

						]*/

					});

				}

			}

			$(".dt-buttons").after('<h4><div class="col-md-6 insertopenclose" style="font-weight: bold;text-align: center;margin-left: 80px;">' + closing_value + '</div></h4>');

			//' + opening_value + ' \t\t '

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//Supplier Ledger

//Supplier Approval Ledger

$('#supplier_approval_ledger_search').on('click', function () {

	get_SupplierApprovalTransactions();

});

function get_SupplierApprovalTransactions() {

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	var dt_range = ($("#dt_range").val()).split('-');

	var metal_wise_required = 0;

	if ($("#metal_wise_required").prop('checked') == true && ($('#karigar').val() == null || $('#karigar').val() == 0)) {

		metal_wise_required = 1;

	}

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/supplier_approval_transaction/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: { 'dt_range': $("#dt_range").val(), "partyId": $("#karigar").val(), 'id_metal': $('#metal').val(), 'metal_wise_required': metal_wise_required },

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var dt_range = ($("#dt_range").val()).split('-');

			var supplier_name = $("#karigar option:selected").text();

			var currentdate = new Date();

			var datetime = "Report Time : " + currentdate.getDate() + "/"

				+ (currentdate.getMonth() + 1) + "/"

				+ currentdate.getFullYear() + " @ "

				+ currentdate.getHours() + ":"

				+ currentdate.getMinutes() + ":"

				+ currentdate.getSeconds();

			var title = "<div style='text-align: center;'><b><span style='font-size:12pt;'>Smith / Supplier Ledger Report </span></b></br>"

				+ "<span style='font-size:11pt;'>" + ($("#karigar").val() != '' ? "Karigar :" + supplier_name + " " : '') + "</span></br>"

				+ "<span style=font-size:12pt;>From&nbsp;:&nbsp;" + dt_range[0] + " &nbsp;&nbsp;To Date&nbsp;:&nbsp;" + dt_range[1] + "</br> </span></br>"

				+ "<span style=font-size:12pt;>" + datetime + "</span></div>";

			if (metal_wise_required == 0) {

				$('#smith_ledgere_metal_list_sip').css('display', 'none');

				$('#smith_ledgere_list_sip').css('display', 'block');

				$("#smith_ledgere_list > tbody > tr").remove();

				$('#smith_ledgere_list').dataTable().fnClearTable();

				$('#smith_ledgere_list').dataTable().fnDestroy();

				var list = data.list;

				console.log(list);

				var trHTML = '';

				var opening_value = "";

				var closing_value = "";

				var opening_wt = "";

				var closing_wt = "";

				var list = data.list;

				var issuePcs = 0;

				var issueGrs = 0;

				var issueNet = 0;

				var issuePur = 0;

				var receiptPcs = 0;

				var receiptGrs = 0;

				var receiptNet = 0;

				var receiptPur = 0;

				var debitAmt = 0;

				var creditAmt = 0;

				var blcPcs = 0;

				var blcgrsWt = 0;

				var blcnetWt = 0;

				var blcpurWt = 0;

				var blcAmt = 0;

				var alblcPcs = 0;

				var allblcgrsWt = 0;

				var allblcnetWt = 0;

				var allblcpurWt = 0;

				var allblcAmt = 0;

				var tFtrHTML = "";

				$.each(data.list, function (key, item) {

					if (key == 0) {

						/*opening_value = "Outstanding Amt(Rs) : " + parseFloat(item.opening).toFixed(2) + " Outstanding Pure Wt(Grms): " + parseFloat(item.openingpure).toFixed(3);*/

						opening_value = "<div style='display:flex;width:100%;text-align:left'><div style='width:38%'>Outstanding Amt(Rs)</div><div style='width:10%;text-align:right'>:</div><div style='width:30%;text-align:right'>" + parseFloat(item.opening).toFixed(2) + "</div></div><div style='display:flex;width:100%'><div style='width:38%;text-align:left'>Outstanding Pure Wt(Grms)</div><div style='width:10%;text-align:right'>:</div><div style='width:30%;text-align:right'>" + parseFloat(item.openingpure).toFixed(3) + "</div></div>";

					}

					if (data.list.length - 1 == key) {

						//var amttype = item.balance > 0 ? "(Dr)" : "(Cr)";

						//var mettype = item.purebalance > 0 ? "(Dr)" : "(Cr)";

						//closing_value = "Outstanding Amt(Rs) : " + item.balance + "\t\t Outstanding Pure Wt(Grms): " + item.purebalance;

						closing_value = "<div style='display:flex;width:100%;text-align:left'><div style='width:38%'>Outstanding Amt(Rs)</div><div style='width:10%;text-align:right'>:</div><div style='width:30%;text-align:right'>" + item.balance + "</div></div><div style='display:flex;width:100%'><div style='width:38%;text-align:left'>Outstanding Pure Wt(Grms)</div><div style='width:10%;text-align:right'>:</div><div style='width:30%;text-align:right'>" + item.purebalance + "</div></div>";

						blcPcs = parseInt(item.RunningBalancePcs);

						blcgrsWt = money_format_india(parseFloat(item.RunningBalanceGwt).toFixed(3));

						blcnetWt = money_format_india(parseFloat(item.RunningBalanceNwt).toFixed(3));

						blcpurWt = money_format_india(parseFloat(item.RunningBalancePwt).toFixed(3));

						blcAmt = money_format_india(parseFloat(item.RunningBalance).toFixed(3));

					}

					issuePcs += isNaN(item.IssuePcs) ? 0 : parseInt(item.IssuePcs);

					issueGrs += isNaN(parseFloat(item.IssueGrsWt)) ? 0 : parseFloat(item.IssueGrsWt);

					issueNet += isNaN(parseFloat(item.IssueNetWt)) ? 0 : parseFloat(item.IssueNetWt);

					issuePur += isNaN(parseFloat(item.IssuePureWt)) ? 0 : parseFloat(item.IssuePureWt);

					receiptPcs += isNaN(item.ReceiptPcs) ? 0 : parseInt(item.ReceiptPcs);

					receiptGrs += isNaN(parseFloat(item.ReceiptGrsWt)) ? 0 : parseFloat(item.ReceiptGrsWt);

					receiptNet += isNaN(parseFloat(item.ReceiptNetWt)) ? 0 : parseFloat(item.ReceiptNetWt);

					receiptPur += isNaN(parseFloat(item.ReceiptPureWt)) ? 0 : parseFloat(item.ReceiptPureWt);

					debitAmt += isNaN(parseFloat(item.Debit)) ? 0 : parseFloat(item.Debit);

					creditAmt += isNaN(parseFloat(item.Credit)) ? 0 : parseFloat(item.Credit);

					alblcPcs += parseInt(item.RunningBalancePcs);

					allblcgrsWt += parseFloat(item.RunningBalanceGwt);

					allblcnetWt += parseFloat(item.RunningBalanceNwt);

					allblcpurWt += parseFloat(item.RunningBalancePwt);

					allblcAmt += parseFloat(item.RunningBalance);

				});

				if (list != null) {

					var sub_metal_issue_wt = 0;

					var sub_metal_pure_wt = 0;

					var tot_metal_weight = 0;

					var tot_metal_pur_weight = 0;

					var subclosingblc = 0;

					if ($('#karigar').val() == null || $('#karigar').val() == 0) {

						blcPcs = alblcPcs;

						blcgrsWt = money_format_india(parseFloat(allblcgrsWt).toFixed(3));

						blcnetWt = money_format_india(parseFloat(allblcnetWt).toFixed(3));

						blcpurWt = money_format_india(parseFloat(allblcpurWt).toFixed(3));

						blcAmt = money_format_india(parseFloat(allblcAmt).toFixed(2));

						//closing_value = "Outstanding Amt(Rs) : " + blcAmt + "\t\t Outstanding Pure Wt(Grms): " + blcpurWt;

						closing_value = "<div style='display:flex;width:100%;text-align:left'><div style='width:38%'>Outstanding Amt(Rs)</div><div style='width:10%;text-align:right'>:</div><div style='width:30%;text-align:right'>" + blcAmt + "</div></div><div style='display:flex;width:100%'><div style='width:38%;text-align:left'>Outstanding Pure Wt(Grms)</div><div style='width:10%;text-align:right'>:</div><div style='width:30%;text-align:right'>" + blcpurWt + "</div></div>";

					}

					$.each(list, function (idx, item) {

						if (item.trans_rec_type == 1) {

							trHTML += '<tr>'

								+ '<td style="text-align: left;">' + item.particulars + '</td>'

								+ '<td style="text-align: left;">' + item.transrefno + '</td>'

								+ '<td>' + item.trans_date + '</td>'

								+ '<td style="text-align: right;">' + item.IssuePcs + '</td>'

								+ '<td style="text-align: right;">' + item.IssueGrsWt + '</td>'

								+ '<td style="text-align: right;">' + item.IssueNetWt + '</td>'

								+ '<td style="text-align: right;">' + item.IssuePureWt + '</td>'

								+ '<td style="text-align: right;">' + item.ReceiptPcs + '</td>'

								+ '<td style="text-align: right;">' + money_format_india(parseFloat(item.ReceiptGrsWt, 3)) + '</td>'

								+ '<td style="text-align: right;">' + money_format_india(parseFloat(item.ReceiptNetWt, 3)) + '</td>'

								+ '<td style="text-align: right;">' + money_format_india(parseFloat(item.ReceiptPureWt, 3)) + '</td>'

								+ '<td style="text-align: right;">' + money_format_india(item.Debit) + '</td>'

								+ '<td style="text-align: right;">' + money_format_india(item.Credit) + '</td>'

								+ '<td style="text-align: right;">' + parseInt(item.RunningBalancePcs) + '</td>'

								+ '<td style="text-align: right;">' + money_format_india(item.RunningBalanceGwt) + '</td>'

								+ '<td style="text-align: right;">' + money_format_india(item.RunningBalanceNwt) + '</td>'

								+ '<td style="text-align: right;">' + money_format_india(item.RunningBalancePwt) + '</td>'

								+ '<td style="text-align: right;">' + money_format_india(item.RunningBalance) + '</td>'

								+ '<td style="text-align: right;">' + item.purchase_touch + '</td>'

								+ '<td style="text-align: right;">' + item.rate + '</td>'

								+ '<td style="text-align: left;">' + item.narration + '</td>'

							'</tr>';

						} else {

							trHTML += '<tr>'

								+ '<td style="text-align: left;">' + item.particulars + '</td>'

								+ '<td style="text-align: left;">' + item.transrefno + '</td>'

								+ '<td>' + item.trans_date + '</td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td style="text-align: right;">' + money_format_india(item.Debit) + '</td>'

								+ '<td style="text-align: right;">' + money_format_india(item.Credit) + '</td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td></td>'

								+ '<td style="text-align: right;">' + money_format_india(item.RunningBalance) + '</td>'

								+ '<td style="text-align: right;">' + item.purchase_touch + '</td>'

								+ '<td style="text-align: right;">' + item.rate + '</td>'

								+ '<td style="text-align: left;">' + item.narration + '</td>'

							'</tr>';

						}

					});

					tFtrHTML = '<tr>'

						+ '<td style="text-align: left;font-weight:bold;">Total : </td>'

						+ '<td style="text-align: left;"></td>'

						+ '<td></td>'

						+ '<td style="text-align: right;font-weight:bold;">' + parseInt(issuePcs) + '</td>'

						+ '<td style="text-align: right;font-weight:bold;">' + money_format_india(parseFloat(issueGrs).toFixed(3)) + '</td>'

						+ '<td style="text-align: right;font-weight:bold;">' + money_format_india(parseFloat(issueNet).toFixed(3)) + '</td>'

						+ '<td style="text-align: right;font-weight:bold;">' + money_format_india(parseFloat(issuePur).toFixed(3)) + '</td>'

						+ '<td style="text-align: right;font-weight:bold;">' + parseInt(receiptPcs) + '</td>'

						+ '<td style="text-align: right;font-weight:bold;">' + money_format_india(parseFloat(receiptGrs).toFixed(3)) + '</td>'

						+ '<td style="text-align: right;font-weight:bold;">' + money_format_india(parseFloat(receiptNet).toFixed(3)) + '</td>'

						+ '<td style="text-align: right;font-weight:bold;">' + money_format_india(parseFloat(receiptPur).toFixed(3)) + '</td>'

						+ '<td style="text-align: right;font-weight:bold;">' + money_format_india(parseFloat(debitAmt).toFixed(2)) + '</td>'

						+ '<td style="text-align: right;font-weight:bold;">' + money_format_india(parseFloat(creditAmt).toFixed(2)) + '</td>'

						+ '<td style="text-align: right;font-weight:bold;">' + blcPcs + '</td>'

						+ '<td style="text-align: right;font-weight:bold;">' + blcgrsWt + '</td>'

						+ '<td style="text-align: right;font-weight:bold;">' + blcnetWt + '</td>'

						+ '<td style="text-align: right;font-weight:bold;">' + blcpurWt + '</td>'

						+ '<td style="text-align: right;font-weight:bold;">' + blcAmt + '</td>'

						+ '<td style="text-align: right;"></td>'

						+ '<td style="text-align: right;"></td>'

						+ '<td style="text-align: left;"></td>'

					'</tr>';

				}

			} else {

				$('#smith_ledgere_list_sip').css('display', 'none');

				$('#smith_ledgere_metal_list_sip').css('display', 'block');

				$("#smith_ledgere_metal_list > tbody > tr").remove();

				$('#smith_ledgere_metal_list').dataTable().fnClearTable();

				$('#smith_ledgere_metal_list').dataTable().fnDestroy();

				var list = data.metalwisedata;

				var opening_value = "";

				var closing_value = "";

				var opening_wt = "";

				var closing_wt = "";

				var trHTML = '';

				var gold_value = 0;

				var silver_value = 0;

				var platinum_wt = 0;

				var amount = 0;

				var tFtrHTML = "";

				$.each(list, function (key, item) {

					gold_value += parseFloat(item.goldwt);

					silver_value += parseFloat(item.silverwt);

					platinum_wt += parseFloat(item.platinumwt);

					amount += parseFloat(item.balanceamt);

				});

				if (list != null) {

					$.each(list, function (idx, item) {

						trHTML += '<tr>'

							+ '<td style="text-align: left;">' + item.firstname + '</td>'

							+ '<td style="text-align: right;">' + money_format_india(parseFloat(item.goldwt).toFixed(3)) + '</td>'

							+ '<td style="text-align: right;">' + money_format_india(parseFloat(item.silverwt).toFixed(3)) + '</td>'

							+ '<td style="text-align: right;">' + money_format_india(parseFloat(item.platinumwt).toFixed(3)) + '</td>'

							+ '<td style="text-align: right;">' + money_format_india(parseFloat(item.balanceamt).toFixed(2)) + '</td>'

						'</tr>';

					});

					tFtrHTML = '<tr>'

						+ '<td style="text-align: left;font-weight:bold;">Total : </td>'

						+ '<td style="text-align: right;font-weight:bold;">' + money_format_india(parseFloat(gold_value).toFixed(3)) + '</td>'

						+ '<td style="text-align: right;font-weight:bold;">' + money_format_india(parseFloat(silver_value).toFixed(3)) + '</td>'

						+ '<td style="text-align: right;font-weight:bold;">' + money_format_india(parseFloat(platinum_wt).toFixed(3)) + '</td>'

						+ '<td style="text-align: right;font-weight:bold;">' + money_format_india(parseFloat(amount).toFixed(3)) + '</td>'

					'</tr>';

				}

				$('#smith_ledgere_metal_list > tbody').html(trHTML);

				$('#smith_ledgere_metal_list > tfoot').html(tFtrHTML);

				// Check and initialise datatable

				if (!$.fn.DataTable.isDataTable('#smith_ledgere_metal_list')) {

					oTable = $('#smith_ledgere_metal_list').dataTable({

						"bSort": false,

						"bInfo": true,

						"scrollX": '100%',

						"dom": 'lBfrtip',

						"paging": false,

						"fixedHeader": true,

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: '',

								messageTop: title,

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', 'inherit');

								},

								exportOptions: {

									columns: ':visible',

									stripHtml: false

								}

							},

							{

								extend: 'excel',

								footer: true,

								exportOptions: {

									columns: ':visible',

									stripHtml: false

								}

							},

							{

								extend: 'colvis',

								collectionLayout: 'fixed columns',

								collectionTitle: 'Column visibility control'

							},

						]/*,

						"columnDefs": [

							{

								targets: [0],

								className: 'dt-body-left'

							},

							{

								targets: [1, 2, 3,4],

								className: 'dt-body-right'

							},

						]*/

					});

				}

			}

			$('#smith_ledgere_list > tbody').html(trHTML);

			$('#smith_ledgere_list > tfoot').html(tFtrHTML);

			// Check and initialise datatable

			if (!$.fn.DataTable.isDataTable('#smith_ledgere_list')) {

				oTable = $('#smith_ledgere_list').dataTable({

					"bSort": false,

					"bInfo": true,

					"scrollX": '100%',

					"dom": 'lBfrtip',

					"paging": false,

					"fixedHeader": true,

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

						},

						{

							extend: 'colvis',

							collectionLayout: 'fixed columns',

							collectionTitle: 'Column visibility control'

						},

					]/*,

					"columnDefs": [

						{

							targets: [0, 1, 2],

							className: 'dt-body-left'

						},

						{

							targets: [3, 4, 5, 6, 7, 8,9,10,11,12,13,14,15,16,17,18,19,20],

							className: 'dt-body-right'

						},

					]*/

				});

			}

			$(".dt-buttons").after('<h4><div class="col-md-6 insertopenclose" style="font-weight: bold;text-align: center;margin-left: 80px;">' + closing_value + '</div></h4>');

			//' + opening_value + ' \t\t '

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//Supplier Approval Ledger

//Lot Vs Tagged

$('#lotvstageed_issue').on('click', function () {

	get_LotVsTaggedTransactions();

});

function get_LotVsTaggedTransactions() {

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	var dt_range = ($("#dt_range").val()).split('-');

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/lottagvault/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: { 'dt_range': $("#dt_range").val(), "partyId": $("#karigar").val(), "lotId": $("#lotno").val(), "id_metal": $('#metal').val(), "id_category": $('#category').val() },

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var dt_range = ($("#dt_range").val()).split('-');

			var supplier_name = $("#karigar option:selected").text();

			var currentdate = new Date();

			var datetime = "Report Time : " + currentdate.getDate() + "/"

				+ (currentdate.getMonth() + 1) + "/"

				+ currentdate.getFullYear() + " @ "

				+ currentdate.getHours() + ":"

				+ currentdate.getMinutes() + ":"

				+ currentdate.getSeconds();

			/*var title = "<div style='text-align: center;'><b><span style='font-size:12pt;'>Lot Vs Tagged Vault </span></b></br>"

				+ "<span style='font-size:11pt;'>" + ($("#karigar").val() != '' ? "Karigar :" + supplier_name + " " : '') + "</span></br>"

				+ "<span style=font-size:12pt;>From&nbsp;:&nbsp;" + dt_range[0] + " &nbsp;&nbsp;To Date&nbsp;:&nbsp;" + dt_range[1] + "</br> </span></br>"

				+ "<span style=font-size:12pt;>" + datetime + "</span></div>";*/

			var company_name = $('#company_name').val();

			var from_date = dt_range[0];

			var to_date = dt_range[1];

			var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

			var report_name = "Lot Vs Tagged Vault"

			var optional = '';

			var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

				+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

			$("#lotvstag_list > tbody > tr").remove();

			$('#lotvstag_list').dataTable().fnClearTable();

			$('#lotvstag_list').dataTable().fnDestroy();

			var list = data.list;

			console.log(list);

			var trHTML = '';

			var tot_blc_pcs = 0;

			var tot_blc_grswt = 0;

			var tot_blc_netwt = 0;

			var tot_blc_diapcs = 0;

			var tot_blc_diawt = 0;

			var tot_blc_stpcs = 0;

			var tot_blc_stwt = 0;

			var tFtrHTML = "";

			if (list != null) {

				$.each(list, function (idx, item) {

					var blc_pcs = parseInt(item.lotpcs) - parseInt(item.taggedpcs) - parseInt(item.recpcs) - parseInt(item.lmpcs);

					var blc_grswt = parseFloat(item.lotgrswt) - parseFloat(item.taggrswt) - parseFloat(item.recgrswt) - parseFloat(item.lmgrswt);

					var blc_netwt = parseFloat(item.lotnetwt) - parseFloat(item.tagnetwt) - parseFloat(item.recnetwt) - parseFloat(item.lmnetwt);

					var blc_dia_pcs = parseFloat(item.lotdiapcs) - parseFloat(item.tagdiapcs) - parseFloat(item.recdiapcs) - parseFloat(item.lmdiapcs);

					var blc_dia_wt = parseFloat(item.lotdiawt) - parseFloat(item.tagdiawt) - parseFloat(item.recdiawt) - parseFloat(item.lmdiawt);

					var blc_st_pcs = parseFloat(item.lotstpcs) - parseFloat(item.tagstpcs) - parseFloat(item.recstpcs) - parseFloat(item.lmstpcs);

					var blc_st_wt = parseFloat(item.lotstwt) - parseFloat(item.tagstwt) - parseFloat(item.recstwt) - parseFloat(item.lmstwt);

					tot_blc_pcs += blc_pcs;

					tot_blc_grswt += blc_grswt;

					tot_blc_netwt += blc_netwt;

					tot_blc_diapcs += blc_dia_pcs;

					tot_blc_diawt += blc_dia_wt;

					tot_blc_stpcs += blc_st_pcs;

					tot_blc_stwt += blc_st_wt;

					trHTML += '<tr>'

						+ '<td style="text-align: left;">' + item.karigarname + '</td>'

						+ '<td style="text-align: left;">' + item.po_ref_no + '</td>'

						+ '<td style="text-align: left;">' + item.po_date + '</td>'

						+ '<td style="text-align: left;">' + item.product + '</td>'

						+ '<td style="text-align: left;border-left: 1px solid black;">' + item.lotno + '</td>'

						+ '<td>' + item.lotdate + '</td>'

						+ '<td style="text-align: right;">' + parseInt(item.lotpcs) + '</td>'

						+ '<td style="text-align: right;">' + parseFloat(item.lotgrswt).toFixed(3) + '</td>'

						+ '<td style="text-align: right;">' + parseFloat(item.lotnetwt).toFixed(3) + '</td>'

						+ '<td style="text-align: right;">' + parseInt(item.lotdiapcs) + '</td>'

						+ '<td style="text-align: right;">' + parseFloat(item.lotdiawt).toFixed(3) + '</td>'

						+ '<td style="text-align: right;">' + parseInt(item.lotstpcs) + '</td>'

						+ '<td style="text-align: right;">' + parseFloat(item.lotstwt).toFixed(3) + '</td>'

						+ '<td style="text-align: right;border-left: 1px solid black;"">' + parseInt(parseInt(item.taggedpcs) + parseInt(item.recpcs) + parseInt(item.lmpcs)) + '</td>'

						+ '<td style="text-align: right;">' + parseFloat(parseFloat(item.taggrswt) + parseFloat(item.recgrswt) + parseFloat(item.lmgrswt)).toFixed(3) + '</td>'

						+ '<td style="text-align: right;">' + parseFloat(parseFloat(item.tagnetwt) + parseFloat(item.recnetwt) + parseFloat(item.lmnetwt)).toFixed(3) + '</td>'

						+ '<td style="text-align: right;">' + parseInt(parseInt(item.tagdiapcs) + parseInt(item.recdiapcs) + parseInt(item.lmdiapcs)) + '</td>'

						+ '<td style="text-align: right;">' + parseFloat(parseFloat(item.tagdiawt) + parseFloat(item.recdiawt) + parseFloat(item.lmdiawt)).toFixed(3) + '</td>'

						+ '<td style="text-align: right;">' + parseInt(parseInt(item.tagstpcs) + parseInt(item.recstpcs) + parseInt(item.lmstpcs)) + '</td>'

						+ '<td style="text-align: right;">' + parseFloat(parseFloat(item.tagstwt) + parseFloat(item.recstwt) + parseFloat(item.lmstwt)).toFixed(3) + '</td>'

						+ '<td style="text-align: right;border-left: 1px solid black;"">' + parseInt(blc_pcs) + '</td>'

						+ '<td style="text-align: right;">' + parseFloat(blc_grswt).toFixed(3) + '</td>'

						+ '<td style="text-align: right;">' + parseFloat(blc_netwt).toFixed(3) + '</td>'

						+ '<td style="text-align: right;">' + parseInt(blc_dia_pcs) + '</td>'

						+ '<td style="text-align: right;">' + parseFloat(blc_dia_wt).toFixed(3) + '</td>'

						+ '<td style="text-align: right;">' + parseInt(blc_st_pcs) + '</td>'

						+ '<td style="text-align: right;">' + parseFloat(blc_st_wt).toFixed(3) + '</td>'

						+ '<td style="text-align: left;border-left: 1px solid black;"">' + item.emp_name + '</td>'

						+ '<td style="text-align: left;">' + (item.startTag != null ? item.startTag : '') + '</td>'

						+ '<td style="text-align: left;">' + (item.endTag != null ? item.endTag : '') + '</td>'

						+ '<td style="text-align: center;">' + (item.remarks != "" ? item.remarks + ' : ' + item.lm_lotno : '') + '</td>'

					'</tr>';

				});

				tFtrHTML = '<tr>'

					+ '<td style="text-align: left;font-weight:bold;">Total</td>'

					+ '<td style="text-align: left;"></td>'

					+ '<td style="text-align: left;"></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td style="text-align: right;font-weight:bold;"></td>'

					+ '<td style="text-align: right;font-weight:bold;"></td>'

					+ '<td style="text-align: right;font-weight:bold;"></td>'

					+ '<td style="text-align: right;font-weight:bold;"></td>'

					+ '<td style="text-align: right;font-weight:bold;"></td>'

					+ '<td style="text-align: right;font-weight:bold;"></td>'

					+ '<td style="text-align: right;font-weight:bold;"></td>'

					+ '<td style="text-align: right;font-weight:bold;"></td>'

					+ '<td style="text-align: right;font-weight:bold;"></td>'

					+ '<td style="text-align: right;font-weight:bold;"></td>'

					+ '<td style="text-align: right;font-weight:bold;"></td>'

					+ '<td style="text-align: right;font-weight:bold;"></td>'

					+ '<td style="text-align: right;font-weight:bold;"></td>'

					+ '<td style="text-align: right;font-weight:bold;"></td>'

					+ '<td style="text-align: right;font-weight:bold;"></td>'

					+ '<td style="text-align: right;font-weight:bold;">' + parseInt(tot_blc_pcs) + '</td>'

					+ '<td style="text-align: right;font-weight:bold;">' + parseFloat(tot_blc_grswt).toFixed(3) + '</td>'

					+ '<td style="text-align: right;font-weight:bold;">' + parseFloat(tot_blc_netwt).toFixed(3) + '</td>'

					+ '<td style="text-align: right;font-weight:bold;">' + parseInt(tot_blc_diapcs) + '</td>'

					+ '<td style="text-align: right;font-weight:bold;">' + parseFloat(tot_blc_diawt).toFixed(3) + '</td>'

					+ '<td style="text-align: right;font-weight:bold;">' + parseInt(tot_blc_stpcs) + '</td>'

					+ '<td style="text-align: right;font-weight:bold;">' + parseFloat(tot_blc_stwt).toFixed(3) + '</td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

				'</tr>';

			}

			$('#lotvstag_list > tbody').html(trHTML);

			$('#lotvstag_list > tfoot').html(tFtrHTML);

			// Check and initialise datatable

			if (!$.fn.DataTable.isDataTable('#lotvstag_list')) {

				oTable = $('#lotvstag_list').dataTable({

					"bSort": false,

					"bInfo": true,

					"scrollX": '100%',

					"dom": 'lBfrtip',

					"paging": false,

					"buttons": [

						{

							extend: 'print',

							footer: false,

							title: '',

							messageTop: title,

							orientation: 'landscape',

							customize: function (win) {

								var last = null;

								var current = null;

								var bod = [];

								var css = '@page { size: landscape; }',

									head = win.document.head || win.document.getElementsByTagName('head')[0],

									style = win.document.createElement('style');

								style.type = 'text/css';

								style.media = 'print';

								if (style.styleSheet) {

									style.styleSheet.cssText = css;

								}

								else {

									style.appendChild(win.document.createTextNode(css));

								}

								head.appendChild(style);

							},

							exportOptions: {

								columns: ':visible',

								stripHtml: false

							}

						},

						{

							extend: 'excel',

							footer: true,

							title: 'Lot Vs Tagged Vault',

						},

						{

							extend: 'colvis',

							collectionLayout: 'fixed columns',

							collectionTitle: 'Column visibility control'

						},

					]

				});

			}

			//' + opening_value + ' \t\t '

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//Lot Vs Tagged

//Old tag import

$("#import_tags").on('submit', function (evt) {

	evt.preventDefault();

});

function import_tagas() {

	file = $('#csv_file')[0].files[0];

	/*if ($('#branch_select').val() == null || $('#branch_select').val() == '') {

		$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + 'Select Branch..' });

		return false;

	}

	else */ if ($('input[name="is_check_import_type"]:checked').val() == '' || $('input[name="is_check_import_type"]:checked').val() == undefined) {

		$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + 'Select Import Type..' });

		return false;

	}

	else if (file == null || file == '') {

		$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + 'Select File..' });

		return false;

	}

	is_check_import_type = $('input[name="is_check_import_type"]:checked').val();

	if (is_check_import_type == 1) {

		import_type = "file_upload_tags";

	} else {

		import_type = "file_upload_stones";

	}

	file_update_importtags(import_type);

}

function file_update_importtags(import_type) {

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	file = $('#csv_file')[0].files[0];

	if (file != undefined) {

		formData = new FormData();

		//formData.append("id_branch", $('#branch_select').val());

		formData.append("filepath", file);

		$.ajax({

			url: base_url + "index.php/admin_ret_reports/" + import_type + "?nocache=" + my_Date.getUTCSeconds() + '' + my_Date.getUTCMinutes() + '' + my_Date.getUTCHours(),

			type: "POST",

			data: formData,

			dataType: "JSON",

			processData: false,

			contentType: false,

			success: function (data) {

				console.log(data);

				if (data.staus) {

					$.toaster({ priority: 'success', title: 'Success!', message: '' + "</br>" + data.message });

					window.location.reload(true);

				}

				else {

					$.toaster({ priority: 'warning', title: 'Warning!', message: '' + "</br>" + data.message });

				}

				$("div.overlay").css("display", "none");

			}

		});

	}

}

$("#upload_csv").on('submit', function (evt) {

	evt.preventDefault();

});

function uploadFile_new() {

	file = $('#csv_file')[0].files[0];

	if ($('#branch_select').val() == null || $('#branch_select').val() == '') {

		$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + 'Select Branch..' });

		return false;

	}

	else if ($('input[name="is_check_import_type"]:checked').val() == '' || $('input[name="is_check_import_type"]:checked').val() == undefined) {

		$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + 'Select Import Type..' });

		return false;

	}

	else if (file == null || file == '') {

		$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + 'Select File..' });

		return false;

	}

	is_check_import_type = $('input[name="is_check_import_type"]:checked').val();

	if (is_check_import_type == 1) {

		import_type = "file_upload_new_tags";

	} else {

		import_type = "file_upload_old_tags";

	}

	file_update(import_type);

}

function get_old_sale_report_report() {

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/old_sale_report/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'from_date': $('#old_tag_report_date1').html(), 'to_date': $('#old_tag_report_date2').html() }),

		dataType: "JSON",

		cache: false,

		type: "POST",

		success: function (data) {

			console.log(data);

			var finance = data.list;

			var oTable = $('#old_tag_report_list').DataTable();

			oTable.clear().draw();

			if (finance != null && finance.length > 0) {

				oTable = $('#old_tag_report_list').DataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"bSort": true,

					"order": [[0, "desc"]],

					"order": [[0, "desc"]],

					"aaData": finance,

					"aoColumns": [

						{

							"mDataProp": function (row, type, val, meta) {

								return row.import_date != null && row.import_date != "" ? row.import_date : '-';

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								return row.total != null ? row.total : '-';

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								return row.upt_tag != null ? row.upt_tag : '-';

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								return row.mis_tag != null ? row.mis_tag : '-';

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								return row.name != null ? row.name : '-';

							}

						}

					]

				});

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		},

		complete: function (data) {

		}

	});

}

function file_update(import_type) {

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	file = $('#csv_file')[0].files[0];

	if (file != undefined) {

		formData = new FormData();

		formData.append("id_branch", $('#branch_select').val());

		formData.append("filepath", file);

		$.ajax({

			url: base_url + "index.php/admin_ret_reports/" + import_type + "?nocache=" + my_Date.getUTCSeconds() + '' + my_Date.getUTCMinutes() + '' + my_Date.getUTCHours(),

			type: "POST",

			data: formData,

			dataType: "JSON",

			processData: false,

			contentType: false,

			success: function (data) {

				console.log(data);

				if (data.staus) {

					$.toaster({ priority: 'success', title: 'Success!', message: '' + "</br>" + data.message });

					window.location.reload(true);

				}

				else {

					$.toaster({ priority: 'warning', title: 'Warning!', message: '' + "</br>" + data.message });

				}

				$("div.overlay").css("display", "none");

			}

		});

	}

}

//Old tag import

//Advance Details Report

function get_advance_details() {

	var company_name = $('#company_name').val();

	var from_date = $('#rpt_from_date').html();

	var to_date = $('#rpt_to_date').html();

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select 			option:selected").text());

	var report_name = "Advance Detailed Report"

	var optional = '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/advance_total_details/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'customer_id': $('#Cus_id').val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'from_date': $('#rpt_from_date').html(), 'to_date': $('#rpt_to_date').html() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data;

			$("div.overlay").css("display", "none");

			var oTable = $('#advance_total_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#advance_total_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"bSort": true,

					"order": [[0, "asc"]],

					"aaData": list,

					"dom": 'lBfrtip',

					"columnDefs": [

						{

							targets: [2, 3, 4, 5],

							className: 'dt-body-right'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'colvis',

							collectionLayout: 'fixed columns',

							collectionTitle: 'Column visibility control'

						},

						{

							extend: 'excel',

							footer: true,

							title: 'Advance Detailed Report'

						}

					],

					"aoColumns": [

						{ "mDataProp": "cus_name" },

						{ "mDataProp": "mobile" },

						{

							"mDataProp": function (row, type, val, meta) {

								var advance_amount = row.advance_amount;

								return money_format_india(advance_amount);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var utilized_amount = row.utilized_amount;

								return money_format_india(utilized_amount);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var refund_amount = row.refund_amount;

								return money_format_india(refund_amount);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var transfer_amount = row.transfer_amount;

								return money_format_india(transfer_amount);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var balance_amount = row.balance_amount;

								return money_format_india(balance_amount);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var received_weight = row.received_weight;

								return money_format_india(received_weight);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var utilized_weight = row.utilized_weight;

								return money_format_india(utilized_weight);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var balance_weight = row.balance_weight;

								return money_format_india(balance_weight);

							}

						},

						{

							"mDataProp": null,

							"sClass": "control center",

							"sDefaultContent": '<span class="drill-val"><i class="fa fa-chevron-circle-down text-teal"></i></span>'

						},

					],

					"footerCallback": function (row, data, start, end, display) {

						if (list.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i < data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								total_adv_amt = api

									.column(2)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(2).footer()).html(money_format_india(parseFloat(total_adv_amt).toFixed(2)));

								total_utilized_amt = api

									.column(3)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(3).footer()).html(money_format_india(parseFloat(total_utilized_amt).toFixed(2)));

								total_transfer_amt = api

									.column(4)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(4).footer()).html(money_format_india(parseFloat(total_transfer_amt).toFixed(2)));

								total_refund_amt = api

									.column(5)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(5).footer()).html(money_format_india(parseFloat(total_refund_amt).toFixed(2)));

								total_balance_amt = api

									.column(6)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(6).footer()).html(money_format_india(parseFloat(total_balance_amt).toFixed(2)));

								total_received_wt = api

									.column(7)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(7).footer()).html(money_format_india(parseFloat(total_received_wt).toFixed(3)));

								total_util_wt = api

									.column(8)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(8).footer()).html(money_format_india(parseFloat(total_util_wt).toFixed(3)));

								total_balance_wt = api

									.column(9)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(9).footer()).html(money_format_india(parseFloat(total_balance_wt).toFixed(3)));

							}

						} else {

							var api = this.api(), data;

							$(api.column(6).footer()).html('');

							$(api.column(4).footer()).html('');

							$(api.column(5).footer()).html('');

							$(api.column(7).footer()).html('');

							$(api.column(8).footer()).html('');

							$(api.column(9).footer()).html('');

						}

					}

				});

				var anOpen = [];

				$(document).on('click', "#advance_total_list .control", function () {

					var nTr = this.parentNode;

					var i = $.inArray(nTr, anOpen);

					if (i === -1) {

						$('.drill-val', this).html('<i class="fa fa-chevron-circle-up text-teal"></i>');

						oTable.fnOpen(nTr, fnFormatRowAdvanceDetails(oTable, nTr), 'details');

						anOpen.push(nTr);

					}

					else {

						$('.drill-val', this).html('<i class="fa fa-chevron-circle-down text-teal"></i>');

						oTable.fnClose(nTr);

						anOpen.splice(i, 1);

					}

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function fnFormatRowAdvanceDetails(oTable, nTr) {

	var oData = oTable.fnGetData(nTr);

	var rowDetail = '';

	var tot_row = 0;

	var prodTable =

		'<div class="innerDetails">' +

		'<table class="table table-responsive table-bordered text-center table-sm">' +

		'<tr class="bg-teal">' +

		'<th>S.No</th>' +

		'<th>Bill No</th>' +

		'<th>Bill Date</th>' +

		'<th>Amount</th>' +

		'<th>Weight</th>' +

		'<th>Type</th>' +

		'</tr>';

	var details = oData.advance_details;

	tot_row = details.length;

	$.each(details, function (idx, val) {

		if (val.type == 'Advance') {

			url = base_url + 'index.php/admin_ret_billing/receipt/receipt_print/' + val.id_issue_receipt;

			action_content = '<a href="' + url + '" target="_blank" title="Billing Receipt">' + val.bill_no + '</a>'

		}

		else if (val.type == 'Utilized') {

			print_url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + val.bill_id;

			action_content = '<a href="' + print_url + '" target="_blank" title="Billing Receipt">' + val.bill_no + '</a>'

		}

		else if (val.type == 'CHIT') {

			print_url = base_url + 'index.php/payment/invoice/' + val.id_payment + '/' + val.id_scheme_account;

			action_content = '<a href="' + print_url + '" target="_blank" title="Payment Receipt">' + val.bill_no + '</a>'

		}

		else if (val.type == 'Transfer') {

			print_url = base_url + 'index.php/admin_ret_billing/receipt/receipt_print/' + val.id_issue_receipt;

			action_content = '<a href="' + print_url + '" target="_blank" title="Advance Transfer">' + val.bill_no + '</a>'

		}

		prodTable +=

			'<tr class="prod_det_btn">' +

			'<td>' + parseFloat(idx + 1) + '</td>' +

			'<td>' + (val.bill_no == null ? '-' : action_content) + '</td>' +

			'<td>' + (val.bill_date == null ? '-' : val.bill_date) + '</td>' +

			'<td style="text-align:right">' + money_format_india((val.amount == null ? '-' : val.amount)) + '</td>' +

			'<td style="text-align:right">' + (val.weight ? money_format_india(val.weight) : '-') + '</td>' +

			'<td>' + val.type + '</td>' +

			'</tr>';

	});

	rowDetail = prodTable + '</table></div>';

	return rowDetail;

}

jQuery("#Mob_search").on("input", function () {

	var mob_ledger = $("#Mob_search").val();

	if (mob_ledger.length >= 3) {

		getMobileSearch(mob_ledger);

	}

});

function getMobileSearch(searchTxt) {

	my_Date = new Date();

	$.ajax({

		url: base_url + 'index.php/admin_ret_reports/advance_total_details/mobileBySearch/?nocache=' + my_Date.getUTCSeconds(),

		dataType: "json",

		method: "POST",

		data: { 'mob_no': searchTxt },

		success: function (data) {

			$("#Mob_search").autocomplete(

				{

					source: data,

					select: function (e, i) {

						e.preventDefault();

						$("#Mob_search").val(i.item.label);

						$("#Cus_id").val(i.item.value);

					},

					response: function (e, i) {

						// ui.content is the array that's about to be sent to the response callback.

						if (i.content.length === 0) {

							$("#mob_err").html('<p style="color:red">Enter a valid Mobile Number</p>');

							$('#Cus_id').val('');

						}

						else {

							$("#mob_err").html('');

						}

					},

					minLength: 0,

				});

		}

	});

}

//Advance Details Report

// Sales Return Report

$('#sales_return_search').on('click', function () {

	get_sales_return();

});

function get_sales_return() {

	var dt_range = ($("#dt_range").val()).split('-');

	var company_name = $('#company_name').val();

	var from_date = dt_range[0];

	var to_date = dt_range[1];

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_filter option:selected").text());

	var report_name = "SALES RETURN REPORT";

	var optional = $('#filter_metal option:selected').html() != '' && $('#filter_metal option:selected').html() != undefined ? $('#filter_metal option:selected').html() + " - " : '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + 'index.php/admin_ret_reports/sales_return/ajax/?nocache=' + my_Date.getUTCSeconds(),

		data: ({ 'metal': $("#filter_metal").val(), 'dt_range': $("#dt_range").val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()) }),

		dataType: "json",

		type: "POST",

		success: function (data) {

			$("div.overlay").css("dislpay", "none");

			var list = data.list;

			//console.log(list);

			var oTable = $('#sales_return_report').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#sales_return_report').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"order": [[0, "desc"]],

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"columnDefs": [

						{

							targets: [9, 10, 11, 12],

							className: 'dt-body-right'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', '10px');

							},

						},

						{

							extend: 'colvis',

							collectionLayout: 'fixed columns',

							collectionTitle: 'Column visibility control'

						},

						{

							extend: 'excel',

							footer: true,

							title: 'SALES RETURN REPORT',

						}

					],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "branch_name" },

						{

							"mDataProp": function (row, type, val, meta) {

								print_url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + row.bill_id;

								action_content = '<a href="' + print_url + '" target="_blank" title="Billing Receipt">' + row.bill_no + '</a>'

								return action_content;

							}

						},

						{ "mDataProp": "bill_date" },

						{ "mDataProp": "emp_name" },

						{ "mDataProp": "emp_code" },

						{ "mDataProp": "tag_code" },

						{ "mDataProp": "product_name" },

						{ "mDataProp": "design_name" },

						{ "mDataProp": "sub_design_name" },

						{ "mDataProp": "gross_wt" },

						{ "mDataProp": "net_wt" },

						{ "mDataProp": "wastage_percent" },

						{

							"mDataProp": function (row, type, val, meta) {

								var item_cost = row.item_cost;

								return money_format_india(item_cost);

							}

						},

						{ "mDataProp": "customer" },

						{ "mDataProp": "tag_process" }

					],

					"footerCallback": function (row, data, start, end, display) {

						if (list.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i < data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								gross_wt = api

									.column(9)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(9).footer()).html(parseFloat(gross_wt).toFixed(3));

								net_wt = api

									.column(10)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(10).footer()).html(parseFloat(net_wt).toFixed(3));

							}

						} else {

							var api = this.api(), data;

							$(api.column(6).footer()).html('');

							$(api.column(4).footer()).html('');

							$(api.column(5).footer()).html('');

						}

					}

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

// Sales Return Report

function set_dashboard_btlist() {

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/dashboard_btList?nocache=" + my_Date.getUTCSeconds(),

		type: "POST",

		data: { 'from_date': ctrl_page[2], 'to_date': ctrl_page[3], 'type': ctrl_page[4], 'id_branch': ctrl_page[5], 'id_product': ctrl_page[6] },

		dataType: "JSON",

		cache: false,

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.bt_list;

			console.log(list);

			var oTable = $('#dash_bt_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#dash_bt_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: 'Branch Transfer',

						}

					],

					"aaData": list,

					"aoColumns": [{

						render: function (data, type, row, meta) {

							return meta.row + 1;

						}

					},

					{ "mDataProp": "from_branch_name" },

					{ "mDataProp": "to_branch_name" },

					{ "mDataProp": "product_name" },

					{ "mDataProp": "tot_pcs" },

					{ "mDataProp": "tot_gwt" },

					{

						"mDataProp": function (row, type, val, meta) {

							if (row.status == 1) {

								return 'Approval Pending';

							}

							else {

								return 'Download Pending';

							}

						}

					},

					],

					"footerCallback": function (row, data, start, end, display) {

						if (list.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								tot_pcs = api

									.column(4)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(4).footer()).html(parseFloat(tot_pcs));

								tot_gwt = api

									.column(5)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(5).footer()).html(parseFloat(tot_gwt).toFixed(3));

							}

						} else {

							var api = this.api(), data;

							$(api.column(4).footer()).html('');

							$(api.column(5).footer()).html('');

						}

					}

				});

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

$('#tag_stone_search').click(function (event) {

	set_tag_stone();

});

function set_tag_stone() {

	var company_name = $('#company_name').val();

	var from_date = '';

	var to_date = '';

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "Stone Available Report";

	var prod_select = $('#prod_select option:selected').html() != '' && $('#prod_select option:selected').html() != undefined ? $('#prod_select option:selected').html() + ' - ' : '';

	var metal = $('#metal option:selected').html() != '' && $('#metal option:selected').html() != undefined ? $('#metal option:selected').html() + " - " : '';

	var tag_category = $('#tag_category option:selected').html() != '' && $('#tag_category option:selected').html() != undefined ? $('#tag_category option:selected').html() + " - " : '';

	var des_select = $('#des_select option:selected').html() != '' && $('#des_select option:selected').html() != undefined ? $('#des_select option:selected').html() + " - " : '';

	var select_size = $('#select_size option:selected').html() != '' && $('#select_size option:selected').html() != undefined ? $('#select_size option:selected').html() + " - " : '';

	var from_weight = $('#from_weight').val() != '' ? $('#from_weight').val() + ' - ' : '';

	var to_weight = $('#to_weight').val() != '' ? $('#to_weight').val() + ' - ' : '';

	var weight = from_weight != '' && to_weight != '' ? from_weight + to_weight : '';

	var optional = metal + tag_category + prod_select + des_select + weight + select_size;

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/tag_stone/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'id_category': $('#tag_category').val(), 'id_metal': $('#metal').val(), 'id_product': $('#prod_select').val(), 'id_design': $("#des_select").val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'from_weight': $('#from_weight').val(), 'to_weight': $('#to_weight').val(), 'id_size': $('#select_size').val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.list;

			console.log(list);

			var oTable = $('#tag_items_stone_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#tag_items_stone_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"order": [[0, "asc"]],

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"columnDefs": [

						{

							targets: [1, 2, 3, 4, 5, 6, 7, 8, 11, 12, 14, 15],

							className: 'dt-body-left'

						},

						{

							targets: [9, 10, 13, 16, 17],

							className: 'dt-body-right'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', '10px');

							},

						},

						{

							extend: 'colvis',

							collectionLayout: 'fixed columns',

							collectionTitle: 'Column visibility control'

						},

						{

							extend: 'excel',

							footer: true,

							title: 'Stone Available Report',

						}

					],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "lotno" },

						{ "mDataProp": "karigarname" },

						{ "mDataProp": "tag_code" },

						{ "mDataProp": "tag_date" },

						{ "mDataProp": "branchname" },

						{ "mDataProp": "catname" },

						{ "mDataProp": "product_name" },

						{ "mDataProp": "design_name" },

						{ "mDataProp": "sub_design_name" },

						{ "mDataProp": "gross_wt" },

						{ "mDataProp": "net_wt" },

						{ "mDataProp": "stone_name" },

						{ "mDataProp": "pieces" },

						{ "mDataProp": "wt" },

						{ "mDataProp": "uom_name" },

						{

							"mDataProp": function (row, type, val, meta) {

								if (row.stone_cal_type == 1) {

									return 'Weight';

								}

								else {

									return 'Piece';

								}

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var rate_per_gram = row.rate_per_gram;

								return money_format_india(rate_per_gram);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var amount = row.amount;

								return money_format_india(amount);

							}

						}

					],

				});

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function get_Tagcategory($id_metal = '') {

	$(".overlay").css("display", "block");

	$('#tag_category option').remove();

	my_Date = new Date();

	$.ajax({

		type: 'POST',

		url: base_url + 'index.php/admin_ret_reports/active_tagcategory',

		data: { 'id_metal': $('#metal').val() },

		dataType: 'json',

		success: function (data) {

			$("#tag_category").append(

				$("<option></option>")

					.attr("value", 0)

					.text('All')

			);

			$.each(data, function (key, item) {

				$('#tag_category').append(

					$("<option></option>")

						.attr("value", item.id_ret_category)

						.text(item.name)

				);

			});

			$("#tag_category").select2({

				placeholder: "Select Category",

				allowClear: true

			});

			$(".overlay").css("display", "none");

		}

	});

}

function set_acc_stock_details() {

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/acc_stock_details/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'id_stock_summary': ctrl_page[3] }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			$("div.overlay").css("display", "none");

			var oTable = $('#acc_stock_details').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#acc_stock_details').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"bSort": true,

					"dom": 'lBfrtip',

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: "Account Stock Details",

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: "Account Stock Details",

						}

					],

					"order": [[0, "asc"]],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "product_name" },

						{ "mDataProp": "trans_type" },

						{ "mDataProp": "date_add" },

						{

							"mDataProp": function (row, type, val, meta) {

								if (row.transcation_type == 1) {

									if (row.debit_type == 1) {

										var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + row.ref_no;

										return '<a href=' + url + ' target="_blank">' + row.ref_no + '</a>';

									}

								}

								else {

									return row.ref_no;

								}

							}

						},

						{ "mDataProp": "piece" },

						{ "mDataProp": "gross_wt" },

						{ "mDataProp": "net_wt" },

						{ "mDataProp": "remarks" },

					],

					"footerCallback": function (row, data, start, end, display) {

						if (list.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								total_gwt = api

									.column(4)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(4).footer()).html(parseFloat(total_gwt).toFixed(3));

								total_nwt = api

									.column(5)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(5).footer()).html(parseFloat(total_nwt).toFixed(3));

							}

						} else {

							var api = this.api(), data;

							$(api.column(3).footer()).html('');

							$(api.column(4).footer()).html('');

						}

					}

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//retag report

$('#retag_report_type').on('change', function () {

	$('.old_metal').css("display", "none");

	$('.sales_return').css("display", "none");

	$('.partly_sale').css("display", "none");

	if (this.value == 4) {

		$('.old_metal').css("display", "block");

	}

	if (this.value == 3) {

		$('.partly_sale').css("display", "block");

	}

	else {

		$('.sales_return').css("display", "block");

	}

	get_retag_report_details();

});

$('#retag_report_search').on('click', function () {

	get_retag_report_details();

});

function get_retag_report_details() {

	var company_name = $('#company_name').val();

	var from_date = $('#rpt_payments1').html();

	var to_date = $('#rpt_payments2').html();

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "RE-TAGGING REPORT";

	var optional = $('#retag_report_type option:selected').html() != '' && $('#retag_report_type option:selected').html() != undefined ? $('#retag_report_type option:selected').html() + " - " : '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/retag_report/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'from_date': $('#rpt_payments1').html(), 'to_date': $('#rpt_payments2').html(), 'retag_report_type': $('#retag_report_type').val(), 'id_metal': $('#metal').val(), 'id_karigar': $('#karigar').val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			if ($('#retag_report_type').val() == 4) {

				$("div.overlay").css("display", "none");

				var oTable = $('#retag_list').DataTable();

				oTable.clear().draw();

				if (list != null && list.length > 0) {

					oTable = $('#retag_list').dataTable({

						"bDestroy": true,

						"bInfo": true,

						"bFilter": true,

						"bSort": true,

						"order": [[0, "asc"]],

						"dom": 'lBfrtip',

						"columnDefs": [

							{

								targets: [5, 6],

								className: 'dt-body-right'

							},

						],

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: '',

								messageTop: title,

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', '10px');

								},

							},

							{

								extend: 'excel',

								footer: true,

								title: "ReTagging Report",

							}

						],

						"aaData": list,

						"aoColumns": [

							{ "mDataProp": "id_process" },

							{ "mDataProp": "date_add" },

							{ "mDataProp": "metal_name" },

							{ "mDataProp": "type" },

							{ "mDataProp": "process_for" },

							{ "mDataProp": "product_name" },

							{

								"mDataProp": function (row, type, val, meta) {

									var weight = row.weight;

									return money_format_india(weight);

								}

							},

							{

								"mDataProp": function (row, type, val, meta) {

									var net_weight = row.net_weight;

									return money_format_india(net_weight);

								}

							},

						],

						"footerCallback": function (row, data, start, end, display) {

							if (data.length > 0) {

								var api = this.api(), data;

								for (var i = 0; i <= data.length - 1; i++) {

									var intVal = function (i) {

										return typeof i === 'string' ?

											i.replace(/[\$,]/g, '') * 1 :

											typeof i === 'number' ?

												i : 0;

									};

									$(api.column(0).footer()).html('Total');

									gross_wgt = api

										.column(6)

										.data()

										.reduce(function (a, b) {

											return intVal(a) + intVal(b);

										}, 0);

									$(api.column(6).footer()).html(money_format_india(parseFloat(gross_wgt).toFixed(3)));

									net_wgt = api

										.column(7)

										.data()

										.reduce(function (a, b) {

											return intVal(a) + intVal(b);

										}, 0);

									$(api.column(7).footer()).html(money_format_india(parseFloat(net_wgt).toFixed(3)));

								}

							} else {

								var api = this.api(), data;

								$(api.column(5).footer()).html('');

								$(api.column(6).footer()).html('');

								$(api.column(7).footer()).html('');

							}

						}

					});

				}

				$("div.overlay").css("display", "none");

			}

			else if ($('#retag_report_type').val() == 3) {

				$("div.overlay").css("display", "none");

				var oTable = $('#partly_sale_list').DataTable();

				oTable.clear().draw();

				if (list != null && list.length > 0) {

					oTable = $('#partly_sale_list').dataTable({

						"bDestroy": true,

						"bInfo": true,

						"bFilter": true,

						"bSort": true,

						"order": [[0, "asc"]],

						"dom": 'lBfrtip',

						"columnDefs": [

							{

								targets: [6, 7],

								className: 'dt-body-right'

							},

						],

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: '',

								messageTop: title,

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', '10px');

								},

							},

							{

								extend: 'excel',

								footer: true,

								title: 'RE -TAGGING REPORT',

							}

						],

						"aaData": list,

						"aoColumns": [

							{ "mDataProp": "id_process" },

							{ "mDataProp": "date_add" },

							{ "mDataProp": "metal_name" },

							{ "mDataProp": "type" },

							{ "mDataProp": "process_for" },

							{ "mDataProp": "karigar_name" },

							{ "mDataProp": "tag_code" },

							{ "mDataProp": "product_name" },

							{ "mDataProp": "weight" },

							{ "mDataProp": "net_weight" },

						],

						"footerCallback": function (row, data, start, end, display) {

							if (data.length > 0) {

								var api = this.api(), data;

								for (var i = 0; i <= data.length - 1; i++) {

									var intVal = function (i) {

										return typeof i === 'string' ?

											i.replace(/[\$,]/g, '') * 1 :

											typeof i === 'number' ?

												i : 0;

									};

									$(api.column(0).footer()).html('Total');

									gross_wgt = api

										.column(8)

										.data()

										.reduce(function (a, b) {

											return intVal(a) + intVal(b);

										}, 0);

									$(api.column(8).footer()).html(money_format_india(parseFloat(gross_wgt).toFixed(3)));

									net_wgt = api

										.column(9)

										.data()

										.reduce(function (a, b) {

											return intVal(a) + intVal(b);

										}, 0);

									$(api.column(9).footer()).html(money_format_india(parseFloat(net_wgt).toFixed(3)));

								}

							} else {

								var api = this.api(), data;

								$(api.column(8).footer()).html('');

								$(api.column(9).footer()).html('');

							}

						}

					});

				}

				$("div.overlay").css("display", "none");

			}

			else {

				$("div.overlay").css("display", "none");

				var oTable = $('#salesreturn_retag_list').DataTable();

				oTable.clear().draw();

				if (list != null && list.length > 0) {

					oTable = $('#salesreturn_retag_list').dataTable({

						"bDestroy": true,

						"bInfo": true,

						"bFilter": true,

						"bSort": true,

						"order": [[0, "asc"]],

						"dom": 'lBfrtip',

						"columnDefs": [

							{

								targets: [8, 9],

								className: 'dt-body-right'

							},

							{

								targets: [0, 1, 2, 3],

								className: 'dt-body-left'

							},

						],

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: "Re-Tagging Report",

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', 'inherit');

								},

							},

							{

								extend: 'excel',

								footer: true,

								title: "ReTagging Report",

							}

						],

						"aaData": list,

						"aoColumns": [

							{ "mDataProp": "id_process" },

							{ "mDataProp": "branch" },

							{

								"mDataProp": function (row, type, val, meta) {

									var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + row.bill_id;

									return '<a href=' + url + ' target="_blank">' + row.bill_no + '</a>';

								}

							},

							{ "mDataProp": "bill_date" },

							{ "mDataProp": "metal_name" },

							{ "mDataProp": "karigar_name" },

							{ "mDataProp": "tag_no" },

							{ "mDataProp": "product" },

							{ "mDataProp": "date_add" },

							{ "mDataProp": "new_tag" },

							{ "mDataProp": "gross_wt" },

							{ "mDataProp": "net_wt" },

							{ "mDataProp": "type" },

							{ "mDataProp": "process_for" },

						],

						"footerCallback": function (row, data, start, end, display) {

							if (data.length > 0) {

								var api = this.api(), data;

								for (var i = 0; i <= data.length - 1; i++) {

									var intVal = function (i) {

										return typeof i === 'string' ?

											i.replace(/[\$,]/g, '') * 1 :

											typeof i === 'number' ?

												i : 0;

									};

									$(api.column(0).footer()).html('Total');

									gross_wgt = api

										.column(10)

										.data()

										.reduce(function (a, b) {

											return intVal(a) + intVal(b);

										}, 0);

									$(api.column(10).footer()).html(money_format_india(parseFloat(gross_wgt).toFixed(3)));

									net_wgt = api

										.column(11)

										.data()

										.reduce(function (a, b) {

											return intVal(a) + intVal(b);

										}, 0);

									$(api.column(11).footer()).html(money_format_india(parseFloat(net_wgt).toFixed(3)));

								}

							} else {

								var api = this.api(), data;

								$(api.column(10).footer()).html('');

								$(api.column(11).footer()).html('');

							}

						}

					});

				}

				$("div.overlay").css("display", "none");

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//retag report

//purchase item wise

$('#purchase_item_wise_search').on('click', function () {

	get_purchase_itemwise();

});

function get_purchase_itemwise() {

	var company_name = $('#company_name').val();

	var from_date = $('#rpt_payments1').html();

	var to_date = $('#rpt_payments2').html();

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "Bill Wise Detailed Report";

	var prod_select = $('#prod_select option:selected').html() != '' && $('#prod_select option:selected').html() != undefined ? $('#prod_select option:selected').html() + ' - ' : '';

	var karigar = $('#karigar option:selected').html() != '' && $('#karigar option:selected').html() != undefined ? $('#karigar option:selected').html() + ' - ' : '';

	var des_select = $('#des_select option:selected').html() != '' && $('#des_select option:selected').html() != undefined ? $('#des_select option:selected').html() + ' - ' : '';

	var sub_des_select = $('#sub_des_select option:selected').html() != '' && $('#sub_des_select option:selected').html() != undefined ? $('#sub_des_select option:selected').html() + ' - ' : '';

	var optional = prod_select + karigar + des_select + sub_des_select;

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/purchase_itemwise/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'from_date': $('#rpt_payments1').html(), 'to_date': $('#rpt_payments2').html(), 'id_karigar': $('#karigar').val(), 'id_product': $('#prod_select').val(), 'id_design': $('#des_select').val(), 'id_sub_design': $('#sub_des_select').val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			$("div.overlay").css("display", "none");

			var oTable = $('#item_wise_list').DataTable();

			oTable.clear().draw();

			if (list != null) {

				var trHtml = '';

				$("#item_wise_list > tbody > tr").remove();

				$('#item_wise_list').dataTable().fnClearTable();

				$('#item_wise_list').dataTable().fnDestroy();

				var grand_total_pcs = 0;

				var grand_total_gross_wt = 0;

				var grand_total_less_wt = 0;

				var grand_total_net_wt = 0;

				var grand_total_item_cost = 0;

				$.each(list, function (key, po_details) {

					trHtml += '<tr style="font-weight:bold;">'

						+ '<td>' + key + '</td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '</tr>';

					var total_pcs = 0;

					var total_gross_wt = 0;

					var total_less_wt = 0;

					var total_net_wt = 0;

					var total_item_cost = 0;

					$.each(po_details, function (k, val) {

						total_pcs += parseFloat(val.no_of_pcs);

						total_gross_wt += parseFloat(val.gross_wt);

						total_less_wt += parseFloat(val.less_wt);

						total_net_wt += parseFloat(val.net_wt);

						total_item_cost += parseFloat(val.item_cost);

						grand_total_pcs += parseFloat(val.no_of_pcs);

						grand_total_gross_wt += parseFloat(val.gross_wt);

						grand_total_less_wt += parseFloat(val.less_wt);

						grand_total_net_wt += parseFloat(val.net_wt);

						grand_total_item_cost += parseFloat(val.item_cost);

						if (val.po_stone_amount > 0) {

							action_content = '<a href=# class="" onclick="po_stone_details(' + val.po_item_id + ');">' + val.po_stone_amount + '</a>';

						} else {

							action_content = val.po_stone_amount;

						}

						trHtml += '<tr>'

							+ '<td>' + val.product_name + '</td>'

							+ '<td>' + val.design_name + '</td>'

							+ '<td>' + val.sub_design_name + '</td>'

							+ '<td>' + val.no_of_pcs + '</td>'

							+ '<td>' + money_format_india(val.gross_wt) + '</td>'

							+ '<td>' + money_format_india(val.less_wt) + '</td>'

							+ '<td>' + money_format_india(val.net_wt) + '</td>'

							+ '<td>' + val.item_wastage + '</td>'

							+ '<td>' + val.mc_value + '</td>'

							+ '<td>' + money_format_india(val.fix_rate_per_grm) + '</td>'

							+ '<td>' + action_content + '</td>'

							+ '<td>' + money_format_india(val.item_cost) + '</td>'

							+ '</tr>';

					});

					trHtml += '<tr style="font-weight:bold;color:red">'

						+ '<td>SUB TOTAL</td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td>' + total_pcs + '</td>'

						+ '<td>' + money_format_india(parseFloat(total_gross_wt).toFixed(3)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(total_less_wt).toFixed(3)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(total_net_wt).toFixed(3)) + '</td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td>' + money_format_india(parseFloat(total_item_cost).toFixed(3)) + '</td>'

						+ '</tr>';

				});

				trHtml += '<tr style="font-weight:bold;color:blue">'

					+ '<td>GRAND TOTAL</td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td>' + grand_total_pcs + '</td>'

					+ '<td>' + money_format_india(parseFloat(grand_total_gross_wt).toFixed(3)) + '</td>'

					+ '<td>' + money_format_india(parseFloat(grand_total_less_wt).toFixed(3)) + '</td>'

					+ '<td>' + money_format_india(parseFloat(grand_total_net_wt).toFixed(3)) + '</td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td>' + money_format_india(parseFloat(grand_total_item_cost).toFixed(3)) + '</td>'

					+ '</tr>';

				$('#item_wise_list > tbody').html(trHtml);

				// Check and initialise datatable

				if (!$.fn.DataTable.isDataTable('#item_wise_list')) {

					oTable = $('#item_wise_list').dataTable({

						"bSort": false,

						"bInfo": true,

						"scrollX": '100%',

						"dom": 'lBfrtip',

						"paging": false,

						"fixedHeader": true,

						"columnDefs": [

							{

								targets: [3, 4, 5, 6, 7, 8, 9, 10, 11],

								className: 'dt-body-right'

							},

							{

								targets: [0, 1, 2],

								className: 'dt-body-left'

							},

						],

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: '',

								messageTop: title,

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', '10px');

								},

							},

							'colvis',

							{

								extend: 'excel',

								footer: true,

								title: 'Bill Wise Detailed Report',

							}

						],

					});

				}

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function po_stone_details(po_item_id) {

	$("div.overlay").css("display", "block");

	$('#stone_modal #stone_details > tbody').empty();

	my_Date = new Date();

	$.ajax({

		type: 'POST',

		url: base_url + 'index.php/admin_ret_reports/purchase_itemwise/stn_details',

		data: { 'po_item_id': po_item_id },

		dataType: 'json',

		success: function (data) {

			var trHtml = '';

			if (data.length > 0) {

				$('#stone_modal').modal('toggle');

				$.each(data, function (key, items) {

					trHtml += '<tr>'

						+ '<td>' + items.stone_name + '</td>'

						+ '<td>' + items.po_stone_pcs + '</td>'

						+ '<td>' + items.po_stone_wt + '</td>'

						+ '<td>' + items.po_stone_rate + '</td>'

						+ '<td>' + items.po_stone_amount + '</td>'

						+ '</tr>';

				});

				$('#stone_modal #stone_details > tbody').append(trHtml);

				$("div.overlay").css("display", "none");

			}

			else {

				$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + 'No Records Found..' });

				$("div.overlay").css("display", "none");

			}

		}

	});

}

//purchase item wise

//sales import

$('#sales_import_search').on('click', function () {

	get_sales_import();

});

function get_sales_import() {

	var company_name = $('#company_name').val();

	var from_date = $('#rpt_payments1').html();

	var to_date = $('#rpt_payments2').html();

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "SALES IMPORT REPORT";

	var optional = '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/sales_import/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: { 'from_date': $('#rpt_payments1').html(), 'to_date': $('#rpt_payments2').html(), 'id_branch': $('#branch_select').val() },

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			var oTable = $('#sales_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#sales_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"columnDefs": [

						{

							targets: [15, 16, 17, 18, 19, 20, 21, 22, 23, 24],

							className: 'dt-body-right'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', '10px');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: "SALES IMPORT",

						}

					],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "INVOICEDATE" },

						{ "mDataProp": "INVOICENO" },

						{ "mDataProp": "VOUCHERTYPE" },

						{ "mDataProp": "PARTYCODE" },

						{ "mDataProp": "PARTYNAME" },

						{ "mDataProp": "PARTYGROUP" },

						{ "mDataProp": "GSTNO" },

						{ "mDataProp": "ADRESS1" },

						{ "mDataProp": "ADRESS2" },

						{ "mDataProp": "ADRESS3" },

						{ "mDataProp": "CONTACTNO" },

						{ "mDataProp": "PRODUCTGROUP" },

						{ "mDataProp": "PRODUCTCODE" },

						{ "mDataProp": "PRODUCTNAME" },

						{ "mDataProp": "QTY" },

						{

							"mDataProp": function (row, type, val, meta) {

								var RATE = row.RATE;

								return money_format_india(RATE);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var VALUE = row.VALUE;

								return money_format_india(VALUE);

							}

						},

						{ "mDataProp": "SALESTAX" },

						{

							"mDataProp": function (row, type, val, meta) {

								var SALESTAXAMT = row.SALESTAXAMT;

								return money_format_india(SALESTAXAMT);

							}

						},

						{ "mDataProp": "SERVICEAMT" },

						{ "mDataProp": "WEIGHT" },

						{

							"mDataProp": function (row, type, val, meta) {

								var TOTAL = row.TOTAL;

								return money_format_india(TOTAL);

							}

						},

						{ "mDataProp": "REMARKS" },

						{ "mDataProp": "GROSSWT" },

						{ "mDataProp": "NETWT" },

					],

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//sales import

//purchase import

$('#purchase_import_search').on('click', function () {

	get_purchase_import();

});

function get_purchase_import() {

	var company_name = $('#company_name').val();

	var from_date = $('#rpt_payments1').html();

	var to_date = $('#rpt_payments2').html();

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "PURCHASE IMPORT";

	var optional = '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/purchase_import/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: { 'from_date': $('#rpt_payments1').html(), 'to_date': $('#rpt_payments2').html(), 'id_branch': $('#branch_select').val() },

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			var oTable = $('#purchase_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#purchase_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"columnDefs": [

						{

							targets: [15, 16, 19, 20, 22, 23],

							className: 'dt-body-right'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', '10px');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: "PURCHASE IMPORT",

						}

					],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "INVOICEDATE" },

						{ "mDataProp": "INVOICENO" },

						{ "mDataProp": "VOUCHERTYPE" },

						{ "mDataProp": "PARTYCODE" },

						{ "mDataProp": "PARTYNAME" },

						{ "mDataProp": "PARTYGROUP" },

						{ "mDataProp": "GSTNO" },

						{ "mDataProp": "ADRESS1" },

						{ "mDataProp": "ADRESS2" },

						{ "mDataProp": "ADRESS3" },

						{ "mDataProp": "CONTACTNO" },

						{ "mDataProp": "PRODUCTGROUP" },

						{ "mDataProp": "PRODUCTCODE" },

						{ "mDataProp": "PRODUCTNAME" },

						{ "mDataProp": "QTY" },

						{

							"mDataProp": function (row, type, val, meta) {

								var RATE = row.RATE;

								return money_format_india(RATE);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var VALUE = row.VALUE;

								return money_format_india(VALUE);

							}

						},

						{ "mDataProp": "SALESTAX" },

						{ "mDataProp": "SALESTAXAMT" },

						{ "mDataProp": "WEIGHT" },

						{

							"mDataProp": function (row, type, val, meta) {

								var TOTAL = row.TOTAL;

								return money_format_india(TOTAL);

							}

						},

						{ "mDataProp": "REMARKS" },

						{ "mDataProp": "GRSWT" },

						{ "mDataProp": "NETWT" },

					],

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//purchase import

//payment mode import

$('#payment_mode_import_search').on('click', function () {

	get_payment_mode_import();

});

function get_payment_mode_import() {

	var company_name = $('#company_name').val();

	var from_date = $('#rpt_payments1').html();

	var to_date = $('#rpt_payments2').html();

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "PAYMENT MODE IMPORT";

	var optional = '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/payment_mode_import/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: { 'from_date': $('#rpt_payments1').html(), 'to_date': $('#rpt_payments2').html(), 'id_branch': $('#branch_select').val() },

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			var oTable = $('#pay_mode_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#pay_mode_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"columnDefs": [

						{

							targets: [3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21],

							className: 'dt-body-right'

						},

						{

							targets: [0, 1, 2],

							className: 'dt-body-left'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', '10px');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: "PAYMENT MODE IMPORT",

						}

					],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "bill_date" },

						{ "mDataProp": "bill_id" },

						{ "mDataProp": "PARTICULAR" },

						{

							"mDataProp": function (row, type, val, meta) {

								var GRSWT = row.GRSWT;

								return money_format_india(GRSWT);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var AMOUNT = row.AMOUNT;

								return money_format_india(AMOUNT);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var GST = row.GST;

								return money_format_india(GST);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var CASH = row.CASH;

								return money_format_india(CASH);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var CHEQUE = row.CHEQUE;

								return money_format_india(CHEQUE);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var card_amt = row.card_amt;

								return money_format_india(card_amt);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var SCHEME = row.SCHEME;

								return money_format_india(SCHEME);

							}

						},

						{ "mDataProp": "SCH_BONUS" },

						{ "mDataProp": "SCH_PRIZE" },

						{ "mDataProp": "DISCOUNT" },

						{

							"mDataProp": function (row, type, val, meta) {

								var ADVANCE = row.ADVANCE;

								return money_format_india(ADVANCE);

							}

						},

						{ "mDataProp": "DUE" },

						{ "mDataProp": "OTHERS" },

						{ "mDataProp": "sales_return" },

						{ "mDataProp": "gold_pur" },

						{ "mDataProp": "sil_pur" },

						{ "mDataProp": "plat_pur" },

						{ "mDataProp": "dia_pur" },

						{ "mDataProp": "stn_pur" },

					],

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//payment mode import

//stock rotation

$('#stock_rotation_search').on('click', function () {

	get_stock_rotation_list();

});

function get_stock_rotation_list() {

	var company_name = $('#company_name').val();

	var from_date = $('#rpt_payments1').html();

	var to_date = $('#rpt_payments2').html();

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "PURCHASE IMPORT";

	var optional = $('#prod_select option:selected').html() != '' && $('#prod_select option:selected').html() != undefined ? $('#prod_select option:selected').html() + ' - ' : '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/stock_rotation/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: { 'from_date': $('#rpt_payments1').html(), 'to_date': $('#rpt_payments2').html(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'id_product': $('#prod_select').val() },

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			var oTable = $('#item_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#item_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"columnDefs": [

						{

							targets: [5, 6, 7, 8, 9],

							className: 'dt-body-right'

						},

						{

							targets: [0, 1, 2, 3],

							className: 'dt-body-left'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', '10px');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: "PURCHASE IMPORT",

						}

					],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "product_name" },

						{ "mDataProp": "design_name" },

						{ "mDataProp": "sub_design_name" },

						{ "mDataProp": "weight_description" },

						{ "mDataProp": "sales_pcs" },

						{ "mDataProp": "sales_gwt" },

						{

							"mDataProp": function (row, type, val, meta) {

								return parseFloat(row.avg_stock_wt).toFixed(3);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								return parseFloat(row.avg_stock_pcs).toFixed(3);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								return parseFloat(row.no_of_rotation_wt).toFixed(3);

							}

						},

						{ "mDataProp": "no_of_rotation" },

					],

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function oldget_stock_rotation_list() {

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/stock_rotation/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: { 'from_date': $('#rpt_payments1').html(), 'to_date': $('#rpt_payments2').html(), 'id_branch': $('#branch_select').val(), 'id_product': $('#prod_select').val() },

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			var oTable = $('#item_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#item_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: "PURCHASE IMPORT",

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: "PURCHASE IMPORT",

						}

					],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "product_name" },

						{ "mDataProp": "design_name" },

						{ "mDataProp": "sub_design_name" },

						{ "mDataProp": "weight_description" },

						{ "mDataProp": "sales_pcs" },

						{ "mDataProp": "sales_gwt" },

					],

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//stock rotation

//ACCOUNTS REPORTS

//Gst Abstract

$('#gst_abstract_search').on('click', function () {

	get_gst_abstract_details();

});

$('#day_trans_search').on('click', function () {

	getdaytransactions_details();

});

/*function get_gst_abstract_details()

{

	var branch_name=($('#branch_name').val()!='' && $('#branch_name').val()!=undefined ? $('#branch_name').val() : $('#branch_select option:selected').toArray().map(item => item.text).join());

	var company_code=$('#company_code').val();

	var company_address1=$('#company_address1').val();

	var company_address2=$('#company_address2').val();

	var company_city=$('#company_city').val();

	var pincode=$('#pincode').val();

	var company_email=$('#company_email').val();

	var company_gst_number=$('#company_gst_number').val();

	var phone=$('#phone').val();

	var report_type=$('#sale_ret_filter').find(':selected').text();

	var title="<div style='text-align: center;'><b><span style='font-size:12pt;'>"+company_code+"</span></b></br>"

	+"<span style='font-size:11pt;'>"+company_address1+"</span></br>"

	+"<span style='font-size:11pt;'>"+company_address2 + company_city+"-"+pincode+"</span></br>"

	+"<span style='font-size:11pt;'>GSTIN:"+company_gst_number +", EMAIL:"+ company_email+"</span></br>"

	+"<span style='font-size:11pt;'>Contact :"+phone +"</span></br>"

	+"<span style=font-size:12pt;>&nbsp;&nbsp;Sales Abstract GST Report - "+report_type + " - " +branch_name+" &nbsp;From&nbsp;:&nbsp;"+$('#rpt_from_date').html()+" &nbsp;&nbsp;- to "+$('#rpt_to_date').html() + " - " + $('.hidden-xs').html()+ "</span></div>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

	url:base_url+ "index.php/admin_ret_reports/gst_abstract/ajax?nocache=" + my_Date.getUTCSeconds(),

	dataType:"JSON",

	data:{'report':$('#report_format').val(),'group_by':$('#gst_group_by').val(),'id_branch':$('#branch_select').val(),'from_date':$('#rpt_from_date').html(),'to_date' :$('#rpt_to_date').html(),'report_type':$('#report_type').val(),'gst_filter':$('#gst_filter').val(),'sale_ret_filter':$('#sale_ret_filter').val()},

	type:"POST",

	success:function(data)

	{

			var company_bills=data.list.B2B;

			var customer_bills=data.list.B2C;

			var sales_transfer=data.list.sales_transfer;

			var repair=data.list.repair;

			var overseas = data.list.overseas;

			var cmp_round_off=0;

			var cus_round_off=0;

			var rep_round_off=0;

			var overseas_round_off=0;

		   var trHTML='';

		   $("#gst_abstract_list > tbody > tr").remove();

		   $('#gst_abstract_list').dataTable().fnClearTable();

			   $('#gst_abstract_list').dataTable().fnDestroy();

			   var cmp_pcs=0;

			   var cmp_gwt=0;

			   var cmp_nwt=0;

			   var cmp_sgst=0;

			   var cmp_cgst=0;

			   var cmp_igst=0;

			   var cmp_gst=0;

			   var cmp_total_amt=0;

			   var cmp_taxable_amt=0;

			   var cus_pcs=0;

			   var cus_gwt=0;

			   var cus_nwt=0;

			   var cus_sgst=0;

			   var cus_cgst=0;

			   var cus_igst=0;

			   var cus_gst=0;

			   var cus_total_amt=0;

			   var cus_taxable_amt=0;

				var rep_pcs=0;

				var rep_gwt=0;

				var rep_taxable=0;

				var rep_sgst=0;

				var rep_cgst=0;

				var rep_igst=0;

				var rep_tax=0;

				var rep_tot_amount=0;

				var overseas_pcs=0;

				var overseas_gwt=0;

				var overseas_taxable=0;

				var overseas_sgst=0;

				var overseas_cgst=0;

				var overseas_igst=0;

				var overseas_tax=0;

				var overseas_tot_amount=0;

				var st_pcs=0;

				var st_gwt=0;

				var st_taxable=0;

				var st_sgst=0;

				var st_cgst=0;

				var st_igst=0;

				var st_tax=0;

				var st_tot_amount=0;

				var st_round_off=0;

		   if(company_bills.length>0)

		   {

			   trHTML+='<tr>'

					   +'<td><strong>B2B BILLS</strong></td>'

					   +'<td></td>'

					   +'<td></td>'

					   +'<td></td>'

					   +'<td></td>'

					   +'<td></td>'

					   // +'<td></td>'s

					   +'<td></td>'

					   +'<td></td>'

					   +'<td></td>'

					   +'<td></td>'

					   +'<td></td>'

					   +'</tr>';

			   $.each(company_bills,function(key,items){

				   cmp_pcs+=parseFloat(items.piece);

				   cmp_gwt+=parseFloat(items.gross_wt);

				   cmp_nwt+=parseFloat(items.net_wt);

				   cmp_taxable_amt+=parseFloat(items.taxable_amt);

				   cmp_sgst+=parseFloat(items.total_sgst);

				   cmp_cgst+=parseFloat(items.total_cgst);

				   cmp_igst+=parseFloat(items.total_igst);

				   cmp_gst+=parseFloat(items.tax_amt);

				   cmp_total_amt+=parseFloat(items.total_amount);

				   cmp_round_off+=parseFloat(items.round_off);

				   trHTML+='<tr>'

					+'<td><strong>'+items.category_name+'</strong></td>'

					   +'<td>'+($('#report_format').val() == 1 ? (items.starting_bill+' - '+items.ending_bill) : items.sales_ref_no)+'</td>'

					   +'<td>'+items.piece+'</td>'

					   +'<td>'+items.gross_wt+'</td>'

					   +'<td>'+items.net_wt+'</td>'

					   +'<td>'+items.taxable_amt+'</td>'

					   +'<td>'+items.total_sgst+'</td>'

					   +'<td>'+items.total_cgst+'</td>'

					   +'<td>'+items.total_igst+'</td>'

					   +'<td>'+items.tax_amt+'</td>'

					   +'<td>'+parseFloat(items.round_off).toFixed(2)+'</td>'

					   +'<td>'+items.total_amount+'</td>'

					   +'</tr>';

			   });

			   trHTML+='<tr>'

					   +'<td><strong>SUB TOTAL</strong></td>'

					   +'<td></td>'

					   +'<td><strong>'+cmp_pcs+'</td>'

					   +'<td><strong>'+parseFloat(cmp_gwt).toFixed(3)+'</strong></td>'

					   +'<td><strong>'+parseFloat(cmp_nwt).toFixed(3)+'</strong></td>'

					   +'<td><strong>'+parseFloat(cmp_taxable_amt).toFixed(2)+'</strong></td>'

					   +'<td><strong>'+parseFloat(cmp_sgst).toFixed(2)+'</strong></td>'

					   +'<td><strong>'+parseFloat(cmp_cgst).toFixed(2)+'</strong></td>'

					   +'<td><strong>'+parseFloat(cmp_igst).toFixed(2)+'</strong></td>'

					   +'<td><strong>'+parseFloat(cmp_gst).toFixed(2)+'</strong></td>'

					   +'<td><strong>'+parseFloat(cmp_round_off).toFixed(2)+'</strong></td>'

					   +'<td><strong>'+parseFloat(cmp_total_amt).toFixed(2)+'</strong></td>'

				+'</tr>';

		   }

		   if(customer_bills.length>0)

		   {

			   trHTML+='<tr>'

					   +'<td><strong>B2C BILLS</strong></td>'

					   +'<td></td>'

					   +'<td></td>'

					   +'<td></td>'

					   +'<td></td>'

					   +'<td></td>'

					   +'<td></td>'

					   +'<td></td>'

					   +'<td></td>'

					   +'<td></td>'

					   +'<td></td>'

					   +'<td></td>'

					   +'</tr>';

			   $.each(customer_bills,function(key,items){

				   cus_pcs+=parseFloat(items.piece);

				   cus_gwt+=parseFloat(items.gross_wt);

				   cus_nwt+=parseFloat(items.net_wt);

				   cus_taxable_amt+=parseFloat(items.taxable_amt);

				   cus_sgst+=parseFloat(items.total_sgst);

				   cus_cgst+=parseFloat(items.total_cgst);

				   cus_igst+=parseFloat(items.total_igst);

				   cus_gst+=parseFloat(items.tax_amt);

				   cus_total_amt+=parseFloat(items.total_amount);

				   cus_round_off+=parseFloat(items.round_off);

				   trHTML+='<tr>'

					+'<td><strong>'+items.category_name+'</strong></td>'

						+'<td>'+( $('#report_format').val() == 1 ? (items.starting_bill+' - '+items.ending_bill) : items.sales_ref_no)+'</td>'

					   +'<td>'+items.piece+'</td>'

					   +'<td>'+items.gross_wt+'</td>'

					   +'<td>'+items.net_wt+'</td>'

					   +'<td>'+items.taxable_amt+'</td>'

					   +'<td>'+items.total_sgst+'</td>'

					   +'<td>'+items.total_cgst+'</td>'

					   +'<td>'+items.total_igst+'</td>'

					   +'<td>'+items.tax_amt+'</td>'

					   +'<td>'+parseFloat(items.round_off).toFixed(2)+'</td>'

					   +'<td>'+items.total_amount+'</td>'

					   +'</tr>';

			   });

			   trHTML+='<tr>'

					   +'<td><strong>SUB TOTAL</strong></td>'

					   +'<td></td>'

					   +'<td><strong>'+cus_pcs+'</strong></td>'

					   +'<td><strong>'+parseFloat(cus_gwt).toFixed(3)+'</strong></td>'

					   +'<td><strong>'+parseFloat(cus_nwt).toFixed(3)+'</strong></td>'

					   +'<td><strong>'+parseFloat(cus_taxable_amt).toFixed(2)+'</strong></td>'

					   +'<td><strong>'+parseFloat(cus_sgst).toFixed(2)+'</strong></td>'

					   +'<td><strong>'+parseFloat(cus_cgst).toFixed(2)+'</strong></td>'

					   +'<td><strong>'+parseFloat(cus_igst).toFixed(2)+'</strong></td>'

					   +'<td><strong>'+parseFloat(cus_gst).toFixed(2)+'</strong></td>'

					   +'<td><strong>'+parseFloat(cus_round_off).toFixed(2)+'</strong></td>'

					   +'<td><strong>'+parseFloat(cus_total_amt).toFixed(2)+'</strong></td>'

				+'</tr>';

		   }

		   if(overseas.length>0)

				{

					trHTML+='<tr>'

					+'<td><strong>OVERSEAS BILLS</strong></td>'

					+'<td></td>'

					+'<td></td>'

					+'<td></td>'

					+'<td></td>'

					+'<td></td>'

					+'<td></td>'

					+'<td></td>'

					+'<td></td>'

					+'<td></td>'

					+'<td></td>'

					+'<td></td>'

					+'</tr>';

					$.each(overseas,function(key,items){

					overseas_pcs+=parseFloat(items.piece);

					overseas_gwt+=parseFloat(items.gross_wt);

					overseas_taxable+=parseFloat(items.taxable_amt);

					overseas_sgst+=parseFloat(items.total_sgst);

					overseas_cgst+=parseFloat(items.total_cgst);

					overseas_igst+=parseFloat(items.total_igst);

					overseas_tax+=parseFloat(items.tax_amt);

					overseas_tot_amount+=parseFloat(items.total_amount);

					overseas_round_off+=parseFloat(items.round_off);

					trHTML+='<tr>'

					 +'<td>'+items.category_name+'</td>'

					+'<td>'+( $('#report_format').val() == 1 ? (items.starting_bill+' - '+items.ending_bill) : items.sales_ref_no)+'</td>'

					+'<td>'+items.piece+'</td>'

					+'<td>'+items.gross_wt+'</td>'

					+'<td></td>'

					+'<td>'+items.taxable_amt+'</td>'

					+'<td>'+items.total_sgst+'</td>'

					+'<td>'+items.total_cgst+'</td>'

					+'<td>'+items.total_igst+'</td>'

					+'<td>'+items.tax_amt+'</td>'

					+'<td>'+parseFloat(items.round_off).toFixed(2)+'</td>'

					+'<td>'+items.total_amount+'</td>'

					+'</tr>';

					});

					trHTML+='<tr>'

					+'<td><strong>SUB TOTAL</strong></td>'

					+'<td></td>'

					+'<td><strong>'+overseas_pcs+'</strong></td>'

					+'<td><strong>'+parseFloat(overseas_gwt).toFixed(3)+'</strong></td>'

					+'<td><strong></strong></td>'

					+'<td><strong>'+parseFloat(overseas_taxable).toFixed(2)+'</strong></td>'

					+'<td><strong>'+parseFloat(overseas_sgst).toFixed(2)+'</strong></td>'

					+'<td><strong>'+parseFloat(overseas_cgst).toFixed(2)+'</strong></td>'

					+'<td><strong>'+parseFloat(overseas_igst).toFixed(2)+'</strong></td>'

					+'<td><strong>'+parseFloat(overseas_tax).toFixed(2)+'</strong></td>'

					+'<td><strong>'+parseFloat(overseas_round_off).toFixed(2)+'</strong></td>'

					+'<td><strong>'+parseFloat(overseas_tot_amount).toFixed(2)+'</strong></td>'

					 +'</tr>';

				}

			if(customer_bills.length>0 || company_bills.length>0 || overseas.length>0){

				trHTML+='<tr>'

				+'<td><strong>GRAND TOTAL</strong></td>'

				+'<td></td>'

				+'<td><strong>'+parseFloat(cus_pcs+cmp_pcs+overseas_pcs)+'</strong></td>'

				+'<td><strong>'+parseFloat(cus_gwt+cmp_gwt+overseas_gwt).toFixed(3)+'</strong></td>'

				+'<td><strong>'+parseFloat(cus_nwt+cmp_nwt).toFixed(3)+'</strong></td>'

				+'<td><strong>'+parseFloat(cus_taxable_amt+cmp_taxable_amt+overseas_taxable).toFixed(2)+'</strong></td>'

				+'<td><strong>'+parseFloat(cus_sgst+cmp_sgst+overseas_sgst).toFixed(2)+'</strong></td>'

				+'<td><strong>'+parseFloat(cus_cgst+cmp_cgst+overseas_cgst).toFixed(2)+'</strong></td>'

				+'<td><strong>'+parseFloat(cus_igst+cmp_igst+overseas_igst).toFixed(2)+'</strong></td>'

				+'<td><strong>'+parseFloat(cus_gst+cmp_gst+overseas_tax).toFixed(2)+'</strong></td>'

				+'<td><strong>'+parseFloat(cus_round_off+cmp_round_off+overseas_round_off).toFixed(2)+'</strong></td>'

				+'<td><strong>'+parseFloat(cus_total_amt+cmp_total_amt+overseas_tot_amount).toFixed(2)+'</strong></td>'

				+'</tr>';

			}

			if(repair.length>0)

			{

			   trHTML+='<tr>'

					   +'<td><strong>REPAIR CHARGES</strong></td>'

					   +'<td></td>'

					   +'<td></td>'

					   +'<td></td>'

					   +'<td></td>'

					   +'<td></td>'

					   +'<td></td>'

					   +'<td></td>'

					   +'<td></td>'

					   +'<td></td>'

					   +'<td></td>'

					   +'<td></td>'

					   +'</tr>';

			   $.each(repair,function(key,items){

				   rep_pcs+=parseFloat(items.pcs);

				   rep_gwt+=parseFloat(items.weight);

				   rep_taxable+=parseFloat(items.tot_taxable);

				   rep_sgst+=parseFloat(items.tot_sgst);

				   rep_cgst+=parseFloat(items.tot_cgst);

				   rep_igst+=parseFloat(items.tot_igst);

				   rep_tax+=parseFloat(items.tot_tax);

				   rep_tot_amount+=parseFloat(items.amount);

				   rep_round_off+=parseFloat(items.round_off);

				   trHTML+='<tr>'

					+'<td><strong>'+items.name+'</strong></td>'

					   +'<td>'+($('#report_format').val() == 1 ? (items.starting_bill+' - '+items.ending_bill): items.bill_no)+'</td>'

					   +'<td>'+items.pcs+'</td>'

					   +'<td>'+items.weight+'</td>'

					   +'<td></td>'

					   +'<td>'+items.tot_taxable+'</td>'

					   +'<td>'+items.tot_sgst+'</td>'

					   +'<td>'+items.tot_cgst+'</td>'

					   +'<td>'+items.tot_igst+'</td>'

					   +'<td>'+items.tot_tax+'</td>'

					   +'<td>'+parseFloat(items.round_off).toFixed(2)+'</td>'

					   +'<td>'+items.amount+'</td>'

					   +'</tr>';

			   });

			   trHTML+='<tr>'

					   +'<td><strong>GRANT TOTAL</strong></td>'

					   +'<td></td>'

					   +'<td><strong>'+rep_pcs+'</strong></td>'

					   +'<td><strong>'+parseFloat(rep_gwt).toFixed(3)+'</strong></td>'

					   +'<td><strong></strong></td>'

					   +'<td><strong>'+parseFloat(rep_taxable).toFixed(2)+'</strong></td>'

					   +'<td><strong>'+parseFloat(rep_sgst).toFixed(2)+'</strong></td>'

					   +'<td><strong>'+parseFloat(rep_cgst).toFixed(2)+'</strong></td>'

					   +'<td><strong>'+parseFloat(rep_igst).toFixed(2)+'</strong></td>'

					   +'<td><strong>'+parseFloat(rep_tax).toFixed(2)+'</strong></td>'

					   +'<td><strong>'+parseFloat(rep_round_off).toFixed(2)+'</strong></td>'

					   +'<td><strong>'+parseFloat(rep_tot_amount).toFixed(2)+'</strong></td>'

				+'</tr>';

				  }

		   $('#gst_abstract_list > tbody').html(trHTML);

			if(!$.fn.DataTable.isDataTable('#gst_abstract_list'))

			{

					oTable = $('#gst_abstract_list').dataTable({

					"bSort": false,

					"bDestroy": true,

					"bInfo": true,

					"scrollX":'100%',

					"paging": false,

					"dom": 'Bfrtip',

					"bAutoWidth": false,

					"responsive": true,

					"buttons": [

					{

					extend: 'print',

					footer: false,

					title: '',

					messageTop: title,

				orientation: 'landscape',

					customize: function(win)

					{

					var last = null;

					var current = null;

					var bod = [];

					var css = '@page { size: landscape; }',

					head = win.document.head || win.document.getElementsByTagName('head')[0],

					style = win.document.createElement('style');

					style.type = 'text/css';

					style.media = 'print';

					if (style.styleSheet)

					{

					style.styleSheet.cssText = css;

					}

					else

					{

					style.appendChild(win.document.createTextNode(css));

					}

					head.appendChild(style);

					},

					exportOptions: {

					columns: ':visible',

					stripHtml: false

					}

					},

					{

					extend:'excel',

					footer: true,

					title: 'GST Abstract Report',

					}

					],

					});

		   }

					$("div.overlay").css("display", "none");

	},

	 error:function(error)

	 {

			$("div.overlay").css("display", "none");

	 }

	 });

}*/

function get_gst_abstract_details() {

	/*var branch_name=($('#branch_name').val()!='' && $('#branch_name').val()!=undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());*/

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $('#branch_select option:selected').toArray().map(item => item.text).join());

	var company_code = $('#company_code').val();

	var company_address1 = $('#company_address1').val();

	var company_address2 = $('#company_address2').val();

	var company_city = $('#company_city').val();

	var pincode = $('#pincode').val();

	var company_email = $('#company_email').val();

	var company_gst_number = $('#company_gst_number').val();

	var phone = $('#phone').val();

	var report_type = $('#sale_ret_filter').find(':selected').text();

	var title = "<div style='text-align: center;'><b><span style='font-size:12pt;'>" + company_code + "</span></b></br>"

		+ "<span style='font-size:11pt;'>" + company_address1 + "</span></br>"

		+ "<span style='font-size:11pt;'>" + company_address2 + company_city + "-" + pincode + "</span></br>"

		+ "<span style='font-size:11pt;'>GSTIN:" + company_gst_number + ", EMAIL:" + company_email + "</span></br>"

		+ "<span style='font-size:11pt;'>Contact :" + phone + "</span></br>"

		+ "<span style=font-size:12pt;>&nbsp;&nbsp;Sales Abstract GST Report - " + report_type + " - " + branch_name + " &nbsp;From&nbsp;:&nbsp;" + $('#rpt_from_date').html() + " &nbsp;&nbsp;- to " + $('#rpt_to_date').html() + " - " + $('.hidden-xs').html() + "&nbsp;&nbsp;" + getDisplayDateTime() + "</span></div>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/gst_abstract/ajax?nocache=" + my_Date.getUTCSeconds(),

		dataType: "JSON",

		data: { 'group_by': $('#gst_group_by').val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'from_date': $('#rpt_from_date').html(), 'to_date': $('#rpt_to_date').html(), 'report_type': $('#report_type').val(), 'id_metal': $('#metal').val(), 'gst_filter': $('#gst_filter').val(), 'sale_ret_filter': $('#sale_ret_filter').val(), 'report': $('#report_format').val(), 'id_category': ($('#category').val() != '' && $('#category').val() != undefined && $('#category').val() != null) ? $('#category').val() : 0 },

		type: "POST",

		success: function (data) {

			var company_bills = data.list.B2B;

			var customer_bills = data.list.B2C;

			var sales_transfer = data.list.sales_transfer;

			var repair = data.list.repair;

			var overseas = data.list.overseas;

			var cmp_round_off = 0;

			var cus_round_off = 0;

			var rep_round_off = 0;

			var overseas_round_off = 0;

			var tot_cmp_round_off = 0;

			var tot_cus_round_off = 0;

			var tot_rep_round_off = 0;

			var tot_overseas_round_off = 0;

			var trHTML = '';

			$("#gst_abstract_list > tbody > tr").remove();

			$('#gst_abstract_list').dataTable().fnClearTable();

			$('#gst_abstract_list').dataTable().fnDestroy();

			var cmp_pcs = 0;

			var cmp_gwt = 0;

			var cmp_nwt = 0;

			var cmp_lwt = 0;

			var cmp_sgst = 0;

			var cmp_cgst = 0;

			var cmp_igst = 0;

			var cmp_gst = 0;

			var cmp_total_amt = 0;

			var cmp_taxable_amt = 0;

			var tot_cmp_pcs = 0;

			var tot_cmp_gwt = 0;

			var tot_cmp_nwt = 0;

			var tot_cmp_lwt = 0;

			var tot_cmp_sgst = 0;

			var tot_cmp_cgst = 0;

			var tot_cmp_igst = 0;

			var tot_cmp_gst = 0;

			var tot_cmp_total_amt = 0;

			var tot_cmp_taxable_amt = 0;

			var cus_pcs = 0;

			var cus_gwt = 0;

			var cus_nwt = 0;

			var cus_lwt = 0;

			var cus_sgst = 0;

			var cus_cgst = 0;

			var cus_igst = 0;

			var cus_gst = 0;

			var cus_total_amt = 0;

			var cus_taxable_amt = 0;

			var tot_cus_pcs = 0;

			var tot_cus_gwt = 0;

			var tot_cus_nwt = 0;

			var tot_cus_lwt = 0;

			var tot_cus_sgst = 0;

			var tot_cus_cgst = 0;

			var tot_cus_igst = 0;

			var tot_cus_gst = 0;

			var tot_cus_total_amt = 0;

			var tot_cus_taxable_amt = 0;

			var rep_pcs = 0;

			var rep_gwt = 0;

			var rep_taxable = 0;

			var rep_sgst = 0;

			var rep_cgst = 0;

			var rep_igst = 0;

			var rep_tax = 0;

			var rep_tot_amount = 0;

			var tot_rep_pcs = 0;

			var tot_rep_gwt = 0;

			var tot_rep_taxable = 0;

			var tot_rep_sgst = 0;

			var tot_rep_cgst = 0;

			var tot_rep_igst = 0;

			var tot_rep_tax = 0;

			var tot_rep_tot_amount = 0;

			var overseas_pcs = 0;

			var overseas_gwt = 0;

			var overseas_taxable = 0;

			var overseas_sgst = 0;

			var overseas_cgst = 0;

			var overseas_igst = 0;

			var overseas_tax = 0;

			var overseas_tot_amount = 0;

			var tot_overseas_pcs = 0;

			var tot_overseas_gwt = 0;

			var tot_overseas_taxable = 0;

			var tot_overseas_sgst = 0;

			var tot_overseas_cgst = 0;

			var tot_overseas_igst = 0;

			var tot_overseas_tax = 0;

			var tot_overseas_tot_amount = 0;

			var st_pcs = 0;

			var st_gwt = 0;

			var st_taxable = 0;

			var st_sgst = 0;

			var st_cgst = 0;

			var st_igst = 0;

			var st_tax = 0;

			var st_tot_amount = 0;

			var st_round_off = 0;

			if (company_bills != '') {

				trHTML += '<tr>'

					+ '<td><strong>B2B BILLS</strong></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '</tr>';

				$.each(company_bills, function (key, cat) {

					if ($('#report_format').val() == 2) {

						trHTML += '<tr>'

							+ '<td><strong>' + key + '</strong></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '</tr>';

					}

					$.each(cat, function (k, items) {

						cmp_pcs += parseFloat(items.piece);

						cmp_gwt += parseFloat(items.gross_wt);

						cmp_nwt += parseFloat(items.net_wt);

						cmp_lwt += parseFloat(items.less_wt);

						cmp_taxable_amt += parseFloat(items.taxable_amt);

						cmp_sgst += parseFloat(items.total_sgst);

						cmp_cgst += parseFloat(items.total_cgst);

						cmp_igst += parseFloat(items.total_igst);

						cmp_gst += parseFloat(items.tax_amt);

						cmp_total_amt += parseFloat(items.total_amount);

						cmp_round_off += parseFloat(items.round_off);

						tot_cmp_pcs += parseFloat(items.piece);

						tot_cmp_gwt += parseFloat(items.gross_wt);

						tot_cmp_nwt += parseFloat(items.net_wt);

						tot_cmp_lwt += parseFloat(items.less_wt);

						tot_cmp_taxable_amt += parseFloat(items.taxable_amt);

						tot_cmp_sgst += parseFloat(items.total_sgst);

						tot_cmp_cgst += parseFloat(items.total_cgst);

						tot_cmp_igst += parseFloat(items.total_igst);

						tot_cmp_gst += parseFloat(items.tax_amt);

						tot_cmp_total_amt += parseFloat(items.total_amount);

						tot_cmp_round_off += parseFloat(items.round_off);

						print_url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + items.bill_id;

						action_content = '<a href="' + print_url + '" target="_blank" title="Billing Receipt">SA-' + items.short_name + '-' + items.metal_code + '-' + items.sales_ref_no + '</a>'

						trHTML += '<tr>'

							+ '<td><strong>' + ($('#report_format').val() == 1 ? items.category_name : '') + '</strong></td>'

							+ '<td><strong>' + items.hsn_code + '</strong></td>'

							+ '<td><strong>' + items.metal_name + '</strong></td>'

							+ '<td>' + ($('#report_format').val() == 1 ? ('SA-' + items.short_name + '-' + items.metal_code + '-' + items.starting_bill + ' - ' + 'SA-' + items.short_name + '-' + items.metal_code + '-' + items.ending_bill) : action_content) + '</td>'

							+ '<td>' + ($('#report_format').val() == 2 ? items.bill_date : '') + '</td>'

							+ '<td>' + ($('#report_format').val() == 2 ? items.cus_name : '') + '</td>'

							+ '<td>' + ($('#report_format').val() == 2 ? items.statename : '') + '</td>'

							+ '<td>' + money_format_india(items.piece) + '</td>'

							+ '<td>' + money_format_india(items.gross_wt) + '</td>'

							+ '<td>' + money_format_india(items.net_wt) + '</td>'

							+ '<td>' + money_format_india(items.less_wt) + '</td>'

							+ '<td>' + money_format_india(items.taxable_amt) + '</td>'

							+ '<td>' + money_format_india(items.tax_percentage) + '</td>'

							+ '<td>' + money_format_india(items.total_sgst) + '</td>'

							+ '<td>' + money_format_india(items.total_cgst) + '</td>'

							+ '<td>' + money_format_india(items.total_igst) + '</td>'

							+ '<td>' + money_format_india(items.tax_amt) + '</td>'

							+ '<td>' + parseFloat(items.round_off).toFixed(2) + '</td>'

							+ '<td>' + money_format_india(items.total_amount) + '</td>'

							+ '<td>' + items.gst_number + '</td>'

							+ '<td>' + items.pan + '</td>'

							+ '</tr>';

					});

					if ($('#report_format').val() == 2) {

						trHTML += '<tr style="color:red">'

							+ '<td><strong>SUB TOTAL</strong></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td><strong>' + cmp_pcs + '</strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(cmp_gwt).toFixed(3)) + '</strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(cmp_nwt).toFixed(3)) + '</strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(cmp_lwt).toFixed(3)) + '</strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(cmp_taxable_amt).toFixed(2)) + '</strong></td>'

							+ '<td></td>'

							+ '<td><strong>' + money_format_india(parseFloat(cmp_sgst).toFixed(2)) + '</strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(cmp_cgst).toFixed(2)) + '</strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(cmp_igst).toFixed(2)) + '</strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(cmp_gst).toFixed(2)) + '</strong></td>'

							+ '<td><strong>' + parseFloat(cmp_round_off).toFixed(2) + '</strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(cmp_total_amt).toFixed(2)) + '</strong></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '</tr>';

						cmp_pcs = 0;

						cmp_gwt = 0;

						cmp_nwt = 0;

						cmp_lwt = 0;

						cmp_sgst = 0;

						cmp_cgst = 0;

						cmp_igst = 0;

						cmp_gst = 0;

						cmp_total_amt = 0;

						cmp_taxable_amt = 0;

					}

				});

				if ($('#report_format').val() == 1) {

					trHTML += '<tr style="color:red">'

						+ '<td><strong>SUB TOTAL</strong></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td><strong>' + cmp_pcs + '</td>'

						+ '<td><strong>' + money_format_india(parseFloat(cmp_gwt).toFixed(3)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(cmp_nwt).toFixed(3)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(cmp_lwt).toFixed(3)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(cmp_taxable_amt).toFixed(2)) + '</strong></td>'

						+ '<td></td>'

						+ '<td><strong>' + money_format_india(parseFloat(cmp_sgst).toFixed(2)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(cmp_cgst).toFixed(2)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(cmp_igst).toFixed(2)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(cmp_gst).toFixed(2)) + '</strong></td>'

						+ '<td><strong>' + parseFloat(cmp_round_off).toFixed(2) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(cmp_total_amt).toFixed(2)) + '</strong></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '</tr>';

				}

			}

			if (customer_bills != '') {

				trHTML += '<tr>'

					+ '<td><strong>B2C BILLS</strong></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '</tr>';

				$.each(customer_bills, function (key, cat) {

					if ($('#report_format').val() == 2) {

						trHTML += '<tr>'

							+ '<td><strong>' + key + '</strong></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '</tr>';

					}

					$.each(cat, function (k, items) {

						cus_pcs += parseFloat(items.piece);

						cus_gwt += parseFloat(items.gross_wt);

						cus_nwt += parseFloat(items.net_wt);

						cus_lwt += parseFloat(items.less_wt);

						cus_taxable_amt += parseFloat(items.taxable_amt);

						cus_sgst += parseFloat(items.total_sgst);

						cus_cgst += parseFloat(items.total_cgst);

						cus_igst += parseFloat(items.total_igst);

						cus_gst += parseFloat(items.tax_amt);

						cus_total_amt += parseFloat(items.total_amount);

						cus_round_off += parseFloat(items.round_off);

						tot_cus_pcs += parseFloat(items.piece);

						tot_cus_gwt += parseFloat(items.gross_wt);

						tot_cus_nwt += parseFloat(items.net_wt);

						tot_cus_lwt += parseFloat(items.less_wt);

						tot_cus_taxable_amt += parseFloat(items.taxable_amt);

						tot_cus_sgst += parseFloat(items.total_sgst);

						tot_cus_cgst += parseFloat(items.total_cgst);

						tot_cus_igst += parseFloat(items.total_igst);

						tot_cus_gst += parseFloat(items.tax_amt);

						tot_cus_total_amt += parseFloat(items.total_amount);

						tot_cus_round_off += parseFloat(items.round_off);

						print_url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + items.bill_id;

						action_content = '<a href="' + print_url + '" target="_blank" title="Billing Receipt">SA-' + items.short_name + '-' + items.metal_code + '-' + items.sales_ref_no + '</a>'

						trHTML += '<tr>'

							+ '<td><strong>' + ($('#report_format').val() == 1 ? items.category_name : '') + '</strong></td>'

							+ '<td><strong>' + items.hsn_code + '</strong></td>'

							+ '<td><strong>' + items.metal_name + '</strong></td>'

							+ '<td>' + ($('#report_format').val() == 1 ? ('SA-' + items.short_name + '-' + items.metal_code + '-' + items.starting_bill + ' - ' + 'SA-' + items.short_name + '-' + items.metal_code + '-' + items.ending_bill) : action_content) + '</td>'

							+ '<td>' + ($('#report_format').val() == 2 ? items.bill_date : '') + '</td>'

							+ '<td>' + ($('#report_format').val() == 2 ? items.cus_name : '') + '</td>'

							+ '<td>' + ($('#report_format').val() == 2 ? items.statename : '') + '</td>'

							+ '<td>' + money_format_india(items.piece) + '</td>'

							+ '<td>' + money_format_india(items.gross_wt) + '</td>'

							+ '<td>' + money_format_india(items.net_wt) + '</td>'

							+ '<td>' + money_format_india(items.less_wt) + '</td>'

							+ '<td>' + money_format_india(items.taxable_amt) + '</td>'

							+ '<td>' + money_format_india(items.tax_percentage) + '</td>'

							+ '<td>' + money_format_india(items.total_sgst) + '</td>'

							+ '<td>' + money_format_india(items.total_cgst) + '</td>'

							+ '<td>' + money_format_india(items.total_igst) + '</td>'

							+ '<td>' + money_format_india(items.tax_amt) + '</td>'

							+ '<td>' + parseFloat(items.round_off).toFixed(2) + '</td>'

							+ '<td>' + money_format_india(items.total_amount) + '</td>'

							+ '<td>' + items.gst_number + '</td>'

							+ '<td>' + items.pan + '</td>'

							+ '</tr>';

					});

					if ($('#report_format').val() == 2) {

						trHTML += '<tr style="color:red">'

							+ '<td><strong>SUB TOTAL</strong></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td><strong>' + cus_pcs + '</strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(cus_gwt).toFixed(3)) + '</strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(cus_nwt).toFixed(3)) + '</strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(cus_lwt).toFixed(3)) + '</strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(cus_taxable_amt).toFixed(2)) + '</strong></td>'

							+ '<td></td>'

							+ '<td><strong>' + money_format_india(parseFloat(cus_sgst).toFixed(2)) + '</strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(cus_cgst).toFixed(2)) + '</strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(cus_igst).toFixed(2)) + '</strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(cus_gst).toFixed(2)) + '</strong></td>'

							+ '<td><strong>' + parseFloat(cus_round_off).toFixed(2) + '</strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(cus_total_amt).toFixed(2)) + '</strong></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '</tr>';

						cus_pcs = 0;

						cus_gwt = 0;

						cus_nwt = 0;

						cus_lwt = 0;

						cus_sgst = 0;

						cus_cgst = 0;

						cus_igst = 0;

						cus_gst = 0;

						cus_total_amt = 0;

						cus_taxable_amt = 0;

					}

				});

				if ($('#report_format').val() == 1) {

					trHTML += '<tr style="color:red">'

						+ '<td><strong>SUB TOTAL</strong></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td><strong>' + cus_pcs + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(cus_gwt).toFixed(3)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(cus_nwt).toFixed(3)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(cus_lwt).toFixed(3)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(cus_taxable_amt).toFixed(2)) + '</strong></td>'

						+ '<td></td>'

						+ '<td><strong>' + money_format_india(parseFloat(cus_sgst).toFixed(2)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(cus_cgst).toFixed(2)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(cus_igst).toFixed(2)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(cus_gst).toFixed(2)) + '</strong></td>'

						+ '<td><strong>' + parseFloat(cus_round_off).toFixed(2) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(cus_total_amt).toFixed(2)) + '</strong></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '</tr>';

				}

			}

			if (overseas != '') {

				trHTML += '<tr>'

					+ '<td><strong>OVERSEAS BILLS</strong></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '</tr>';

				$.each(overseas, function (key, cat) {

					if ($('#report_format').val() == 2) {

						trHTML += '<tr>'

							+ '<td><strong>' + key + '</strong></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '</tr>';

					}

					$.each(cat, function (k, items) {

						overseas_pcs += parseFloat(items.piece);

						overseas_gwt += parseFloat(items.gross_wt);

						overseas_taxable += parseFloat(items.taxable_amt);

						overseas_sgst += parseFloat(items.total_sgst);

						overseas_cgst += parseFloat(items.total_cgst);

						overseas_igst += parseFloat(items.total_igst);

						overseas_tax += parseFloat(items.tax_amt);

						overseas_tot_amount += parseFloat(items.total_amount);

						overseas_round_off += parseFloat(items.round_off);

						tot_overseas_pcs += parseFloat(items.piece);

						tot_overseas_gwt += parseFloat(items.gross_wt);

						tot_overseas_taxable += parseFloat(items.taxable_amt);

						tot_overseas_sgst += parseFloat(items.total_sgst);

						tot_overseas_cgst += parseFloat(items.total_cgst);

						tot_overseas_igst += parseFloat(items.total_igst);

						tot_overseas_tax += parseFloat(items.tax_amt);

						tot_overseas_tot_amount += parseFloat(items.total_amount);

						tot_overseas_round_off += parseFloat(items.round_off);

						print_url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + items.bill_id;

						action_content = '<a href="' + print_url + '" target="_blank" title="Billing Receipt">' + items.metal_code + '-' + items.sales_ref_no + '</a>'

						trHTML += '<tr>'

							+ '<td><strong>' + ($('#report_format').val() == 1 ? items.category_name : '') + '</strong></td>'

							+ '<td><strong>' + items.hsn_code + '</strong></td>'

							+ '<td><strong>' + items.metal_name + '</strong></td>'

							+ '<td>' + ($('#report_format').val() == 1 ? (items.metal_code + '-' + items.starting_bill + ' - ' + items.metal_code + '-' + items.ending_bill) : action_content) + '</td>'

							+ '<td>' + ($('#report_format').val() == 2 ? items.bill_date : '') + '</td>'

							+ '<td>' + ($('#report_format').val() == 2 ? items.cus_name : '') + '</td>'

							+ '<td></td>'

							+ '<td>' + money_format_india(items.piece) + '</td>'

							+ '<td>' + money_format_india(items.gross_wt) + '</td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td>' + money_format_india(items.taxable_amt) + '</td>'

							+ '<td>' + money_format_india(items.tax_percentage) + '</td>'

							+ '<td>' + money_format_india(items.total_sgst) + '</td>'

							+ '<td>' + money_format_india(items.total_cgst) + '</td>'

							+ '<td>' + money_format_india(items.total_igst) + '</td>'

							+ '<td>' + money_format_india(items.tax_amt) + '</td>'

							+ '<td>' + parseFloat(items.round_off).toFixed(2) + '</td>'

							+ '<td>' + money_format_india(items.total_amount) + '</td>'

							+ '<td>' + items.gst_number + '</td>'

							+ '<td>' + items.pan + '</td>'

							+ '</tr>';

					});

					if ($('#report_format').val() == 2) {

						trHTML += '<tr style="color:red">'

							+ '<td><strong>SUB TOTAL</strong></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td><strong>' + overseas_pcs + '</strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(overseas_gwt).toFixed(3)) + '</strong></td>'

							+ '<td><strong></strong></td>'

							+ '<td><strong></strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(overseas_taxable).toFixed(2)) + '</strong></td>'

							+ '<td></td>'

							+ '<td><strong>' + money_format_india(parseFloat(overseas_sgst).toFixed(2)) + '</strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(overseas_cgst).toFixed(2)) + '</strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(overseas_igst).toFixed(2)) + '</strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(overseas_tax).toFixed(2)) + '</strong></td>'

							+ '<td><strong>' + parseFloat(overseas_round_off).toFixed(2) + '</strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(overseas_tot_amount).toFixed(2)) + '</strong></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '</tr>';

						overseas_pcs = 0;

						overseas_gwt = 0;

						overseas_taxable = 0;

						overseas_sgst = 0;

						overseas_cgst = 0;

						overseas_igst = 0;

						overseas_tax = 0;

						overseas_tot_amount = 0;

					}

				});

				if ($('#report_format').val() == 1) {

					trHTML += '<tr color:red>'

						+ '<td><strong>SUB TOTAL</strong></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td><strong>' + overseas_pcs + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(overseas_gwt).toFixed(3)) + '</strong></td>'

						+ '<td><strong></strong></td>'

						+ '<td><strong></strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(overseas_taxable).toFixed(2)) + '</strong></td>'

						+ '<td></td>'

						+ '<td><strong>' + money_format_india(parseFloat(overseas_sgst).toFixed(2)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(overseas_cgst).toFixed(2)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(overseas_igst).toFixed(2)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(overseas_tax).toFixed(2)) + '</strong></td>'

						+ '<td><strong>' + parseFloat(overseas_round_off).toFixed(2) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(overseas_tot_amount).toFixed(2)) + '</strong></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '</tr>';

				}

			}

			if (customer_bills != '' || company_bills.length != '' || overseas.length != '') {

				trHTML += '<tr style="color:blue">'

					+ '<td><strong>GRAND TOTAL</strong></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td><strong>' + money_format_india(parseFloat(tot_cus_pcs + tot_cmp_pcs + overseas_pcs)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(tot_cus_gwt + tot_cmp_gwt + overseas_gwt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(tot_cus_nwt + tot_cmp_nwt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(tot_cus_lwt + tot_cmp_lwt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(tot_cus_taxable_amt + tot_cmp_taxable_amt + tot_overseas_taxable).toFixed(2)) + '</strong></td>'

					+ '<td></td>'

					+ '<td><strong>' + money_format_india(parseFloat(tot_cus_sgst + tot_cmp_sgst + tot_overseas_sgst).toFixed(2)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(tot_cus_cgst + tot_cmp_cgst + tot_overseas_cgst).toFixed(2)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(tot_cus_igst + tot_cmp_igst + tot_overseas_igst).toFixed(2)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(tot_cus_gst + tot_cmp_gst + tot_overseas_tax).toFixed(2)) + '</strong></td>'

					+ '<td><strong>' + parseFloat(tot_cus_round_off + tot_cmp_round_off + tot_overseas_round_off).toFixed(2) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(tot_cus_total_amt + tot_cmp_total_amt + tot_overseas_tot_amount).toFixed(2)) + '</strong></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '</tr>';

			}

			if (repair != '') {

				trHTML += '<tr>'

					+ '<td><strong>REPAIR CHARGES</strong></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '</tr>';

				$.each(repair, function (key, cat) {

					if ($('#report_format').val() == 2) {

						trHTML += '<tr>'

							+ '<td><strong>' + key + '</strong></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '</tr>';

					}

					$.each(cat, function (k, items) {

						rep_pcs += parseFloat(items.pcs);

						rep_gwt += parseFloat(items.weight);

						rep_taxable += parseFloat(items.tot_taxable);

						rep_sgst += parseFloat(items.tot_sgst);

						rep_cgst += parseFloat(items.tot_cgst);

						rep_igst += parseFloat(items.tot_igst);

						rep_tax += parseFloat(items.tot_tax);

						rep_tot_amount += parseFloat(items.amount);

						rep_round_off += parseFloat(items.round_off);

						tot_rep_pcs += parseFloat(items.pcs);

						tot_rep_gwt += parseFloat(items.weight);

						tot_rep_taxable += parseFloat(items.tot_taxable);

						tot_rep_sgst += parseFloat(items.tot_sgst);

						tot_rep_cgst += parseFloat(items.tot_cgst);

						tot_rep_igst += parseFloat(items.tot_igst);

						tot_rep_tax += parseFloat(items.tot_tax);

						tot_rep_tot_amount += parseFloat(items.amount);

						tot_rep_round_off += parseFloat(items.round_off);

						print_url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + items.bill_id;

						action_content = '<a href="' + print_url + '" target="_blank" title="Billing Receipt">' + items.bill_no + '</a>'

						trHTML += '<tr>'

							+ '<td><strong>' + ($('#report_format').val() == 1 ? items.name : '') + '</strong></td>'

							+ '<td>' + (items.hsn_code) + '</td>'

							+ '<td>' + (items.metal_name) + '</td>'

							+ '<td>' + ($('#report_format').val() == 1 ? (items.starting_bill + ' - ' + items.ending_bill) : action_content) + '</td>'

							+ '<td>' + ($('#report_format').val() == 2 ? items.bill_date : '') + '</td>'

							+ '<td>' + ($('#report_format').val() == 2 ? items.cus_name : '') + '</td>'

							+ '<td></td>'

							+ '<td>' + money_format_india(items.pcs) + '</td>'

							+ '<td>' + money_format_india(items.weight) + '</td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td>' + money_format_india(items.tot_taxable) + '</td>'

							+ '<td>' + money_format_india(items.tax_percentage) + '</td>'

							+ '<td>' + money_format_india(items.tot_sgst) + '</td>'

							+ '<td>' + money_format_india(items.tot_cgst) + '</td>'

							+ '<td>' + money_format_india(items.tot_igst) + '</td>'

							+ '<td>' + money_format_india(items.tot_tax) + '</td>'

							+ '<td>' + parseFloat(items.round_off).toFixed(2) + '</td>'

							+ '<td>' + money_format_india(items.amount) + '</td>'

							+ '<td>' + items.gst_number + '</td>'

							+ '<td>' + items.pan + '</td>'

							+ '</tr>';

					});

					if ($('#report_format').val() == 2) {

						trHTML += '<tr>'

							+ '<td><strong> SUB TOTAL</strong></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td><strong>' + rep_pcs + '</strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(rep_gwt).toFixed(3)) + '</strong></td>'

							+ '<td><strong></strong></td>'

							+ '<td><strong></strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(rep_taxable).toFixed(2)) + '</strong></td>'

							+ '<td><strong></strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(rep_sgst).toFixed(2)) + '</strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(rep_cgst).toFixed(2)) + '</strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(rep_igst).toFixed(2)) + '</strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(rep_tax).toFixed(2)) + '</strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(rep_round_off).toFixed(2)) + '</strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(rep_tot_amount).toFixed(2)) + '</strong></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '</tr>';

						rep_pcs = 0;

						rep_gwt = 0;

						rep_taxable = 0;

						rep_sgst = 0;

						rep_cgst = 0;

						rep_igst = 0;

						rep_tax = 0;

						rep_tot_amount = 0;

						rep_round_off = 0;

					}

				});

				trHTML += '<tr style="color:blue">'

					+ '<td><strong>GRANT TOTAL</strong></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td><strong>' + money_format_india(tot_rep_pcs) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(tot_rep_gwt).toFixed(3)) + '</strong></td>'

					+ '<td><strong></strong></td>'

					+ '<td><strong></strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(tot_rep_taxable).toFixed(2)) + '</strong></td>'

					+ '<td><strong></strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(tot_rep_sgst).toFixed(2)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(tot_rep_cgst).toFixed(2)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(tot_rep_igst).toFixed(2)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(tot_rep_tax).toFixed(2)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(tot_rep_round_off).toFixed(2)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(tot_rep_tot_amount).toFixed(2)) + '</strong></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '</tr>';

			}

			$('#gst_abstract_list > tbody').html(trHTML);

			if (!$.fn.DataTable.isDataTable('#gst_abstract_list')) {

				oTable = $('#gst_abstract_list').dataTable({

					columnDefs: [{

						"defaultContent": "-",

						"targets": "_all"

					}],

					"bSort": false,

					"bDestroy": true,

					"bInfo": true,

					"scrollX": '100%',

					"paging": false,

					"dom": 'Bfrtip',

					"bAutoWidth": false,

					"responsive": true,

					"columnDefs": [

						{

							targets: [6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16],

							className: 'dt-body-right'

						},

					],

					/*"buttons": [

					{

					extend: 'print',

					footer: true,

					title: '',

					messageTop: title,

					customize: function ( win ) {

					$(win.document.body).find('table')

					.addClass('compact');

					$(win.document.body).find( 'table' )

					.addClass('compact')

					.css('font-size','10px')

					.css('font-family','sans-serif');

					},

					exportOptions: {

					columns: ':visible',

					stripHtml: false

					}

					},

					{

					extend:'excel',

					footer: true,

					title: 'GST Abstract Report',

					}

					], */

					/* "buttons": [

						{

							extend: 'print',

							footer: false,

							title: '',

							messageTop: title,

							orientation: 'landscape',

							customize: function (win) {

								var last = null;

								var current = null;

								var bod = [];

								var css = '@page {size: A4 landscape,width:100%;}',

									head = win.document.head || win.document.getElementsByTagName('head')[0],

									style = win.document.createElement('style');

								style.type = 'text/css';

								style.media = 'print';

								if (style.styleSheet) {

									style.styleSheet.cssText = css;

								 }

								else {

									style.appendChild(win.document.createTextNode(css));

								}

								head.appendChild(style);

							},

							exportOptions: {

								columns: ':visible',

								stripHtml: false

							}

						},

						{

							extend: 'excel',

							footer: true,

							title: 'GST Abstract Report',

						}

					], */

					"buttons": [

						{

							extend: 'print',

							footer: false,

							title: '',

							messageTop: title,

							orientation: 'landscape',

							customize: function (win) {

								// Apply custom styles for A4 print view

								var customStyle = `

							<style>

								@media print {

									body {

										width: 380mm;

										//height: 297mm;

									}

									table {

										width: 100%;

									}

									th, td {

										word-break: break-word;

									}

								}

							</style>

						`;

								$(win.document.head).append(customStyle);

							},

							exportOptions: {

								modifier: {

									page: 'landscape', // Set landscape orientation

									size: 'A4', // Set paper size

								},

							}

						},

						{

							extend: 'excel',

							footer: true,

							title: 'GST Abstract',

						}

					],

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//gst abstract search

//sales return abstract

$('#sales_ret_abstract_search').on('click', function () {

	sales_return_details();

});

function sales_return_details() {

	/*var branch_name=($('#branch_name').val()!='' && $('#branch_name').val()!=undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());*/

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $('#branch_select option:selected').toArray().map(item => item.text).join());

	var company_name = $('#company_name').val();

	var company_code = $('#company_code').val();

	var company_code = $('#company_code').val();

	var company_address1 = $('#company_address1').val();

	var company_address2 = $('#company_address2').val();

	var company_city = $('#company_city').val();

	var pincode = $('#pincode').val();

	var company_email = $('#company_email').val();

	var company_gst_number = $('#company_gst_number').val();

	var phone = $('#phone').val();

	var title = "<div style='text-align: center;'><b><span style='font-size:12pt;'>" + company_code + "</span></b></br>"

		+ "<span style='font-size:11pt;'>" + company_address1 + "</span></br>"

		+ "<span style='font-size:11pt;'>" + company_address2 + company_city + "-" + pincode + "</span></br>"

		+ "<span style='font-size:11pt;'>GSTIN:" + company_gst_number + ", EMAIL:" + company_email + "</span></br>"

		+ "<span style='font-size:11pt;'>Contact :" + phone + "</span></br>"

		+ "<span style=font-size:12pt;>&nbsp;&nbsp;SALE RETURN ABSTRACT REPORT - " + branch_name + " &nbsp;From&nbsp;:&nbsp;" + $('#rpt_from_date').html() + " &nbsp;&nbsp;- to " + $('#rpt_to_date').html() + " - " + $('.hidden-xs').html() + "&nbsp;&nbsp;" + getDisplayDateTime() + "</span>"

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/sales_return_abstract/ajax?nocache=" + my_Date.getUTCSeconds(),

		dataType: "JSON",

		data: { 'group_by': $('#sale_ret_group_by').val(), 'id_branch': $('#branch_select').val(), 'from_date': $('#rpt_from_date').html(), 'to_date': $('#rpt_to_date').html(), 'billing_for': $('#sales_report_type').val(), 'id_category': ($('#category').val() != '' && $('#category').val() != undefined && $('#category').val() != null) ? $('#category').val() : 0, 'id_metal': $('#metal').val() },

		type: "POST",

		success: function (data) {

			if ($('#sale_ret_group_by').val() == 0) {

				var list = data.list;

				var trHTML = '';

				$("#sales_ret_abstract > tbody > tr").remove();

				$('#sales_ret_abstract').dataTable().fnClearTable();

				$('#sales_ret_abstract').dataTable().fnDestroy();

				var tot_piece = 0;

				var tot_gross_wt = 0;

				var tot_netwt = 0;

				var tot_diawt = 0;

				var tot_cgst = 0;

				var tot_sgst = 0;

				var tot_igst = 0;

				var tot_gst = 0;

				var tot_taxable_amt = 0;

				var tot_item_amount = 0;

				$.each(list, function (k, bill_details) {

					var piece = 0;

					var gross_wt = 0;

					var netwt = 0;

					var diawt = 0;

					var cgst = 0;

					var sgst = 0;

					var igst = 0;

					var gst = 0;

					var taxable_amt = 0;

					var item_amount = 0;

					trHTML += '<tr style="font-weight:bold;">' +

						'<td style="text-align: left;">' + k + '</td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'</tr>';

					$.each(bill_details, function (key, items) {

						tot_piece += parseFloat(items.piece);

						tot_gross_wt += parseFloat(items.gross_wt);

						tot_netwt += parseFloat(items.net_wt);

						tot_diawt += parseFloat(items.tot_dia_wt);

						tot_taxable_amt += parseFloat(items.taxable_amt);

						tot_sgst += parseFloat(items.total_sgst);

						tot_cgst += parseFloat(items.total_cgst);

						tot_igst += parseFloat(items.total_igst);

						tot_gst += parseFloat(items.tax_amt);

						tot_item_amount += parseFloat(items.total_amount);

						piece += parseFloat(items.piece);

						gross_wt += parseFloat(items.gross_wt);

						netwt += parseFloat(items.net_wt);

						diawt += parseFloat(items.tot_dia_wt);

						taxable_amt += parseFloat(items.taxable_amt);

						sgst += parseFloat(items.total_sgst);

						cgst += parseFloat(items.total_cgst);

						igst += parseFloat(items.total_igst);

						gst += parseFloat(items.tax_amt);

						item_amount += parseFloat(items.total_amount);

						var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + items.sales_bill_id;

						var returnurl = base_url + 'index.php/admin_ret_billing/billing_invoice/' + items.ret_bill_id;

						var returnbillurl = '<a href="' + returnurl + '" target="_blank" title="Billing Receipt">' + items.ret_bill_no + '</a>';

						var salebillurl = '<a href="' + url + '" target="_blank" title="Billing Receipt">' + items.sales_bill_no + '</a>';

						trHTML += '<tr>' +

							'<td></td>' +

							'<td>' + items.metal_name + '</td>' +

							'<td>' + items.hsn_code + '</td>' +

							'<td>' + returnbillurl + '</td>' +

							'<td>' + items.ret_bill_date + '</td>' +

							'<td>' + money_format_india(items.piece) + '</td>' +

							'<td>' + money_format_india(items.gross_wt) + '</td>' +

							'<td>' + money_format_india(items.net_wt) + '</td>' +

							'<td>' + money_format_india(items.tot_dia_wt) + '</td>' +

							'<td>' + money_format_india(items.taxable_amt) + '</td>' +

							'<td>' + money_format_india(items.total_sgst) + '</td>' +

							'<td>' + money_format_india(items.total_cgst) + '</td>' +

							'<td>' + money_format_india(items.total_igst) + '</td>' +

							'<td>' + money_format_india(items.tax_amt) + '</td>' +

							'<td>' + money_format_india(items.total_amount) + '</td>' +

							'<td>' + salebillurl + '</td>' +

							'<td>' + items.sales_date + '</td>' +

							'</tr>';

					});

					trHTML += '<tr style="font-weight:bold;color:red">' +

						'<td>SUB TOTAL</td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td>' + piece + '</td>' +

						'<td>' + money_format_india(parseFloat(gross_wt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(netwt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(diawt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(taxable_amt).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(sgst).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(cgst).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(igst).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(gst).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(item_amount).toFixed(2)) + '</td>' +

						'<td></td>' +

						'<td></td>' +

						'</tr>';

					/* tot_piece+=parseFloat(tot_piece)+parseFloat(piece);

					 tot_gross_wt+=parseFloat(tot_gross_wt)+parseFloat(gross_wt);

					 tot_netwt+=parseFloat(tot_netwt)+parseFloat(netwt);

					 tot_sgst+=parseFloat(tot_sgst)+parseFloat(sgst);

					 tot_cgst+=parseFloat(tot_cgst)+parseFloat(cgst);

					 tot_igst+=parseFloat(tot_igst)+parseFloat(igst);

					 tot_taxable_amt+=parseFloat(tot_taxable_amt)+parseFloat(taxable_amt);

					 tot_gst+=parseFloat(tot_gst)+parseFloat(gst);

					 tot_item_amount+=parseFloat(tot_item_amount)+parseFloat(item_amount);*/

				});

				trHTML += '<tr style="font-weight:bold;color:blue">' +

					'<td>GRAND TOTAL</td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td>' + tot_piece + '</td>' +

					'<td>' + money_format_india(parseFloat(tot_gross_wt).toFixed(3)) + '</td>' +

					'<td>' + money_format_india(parseFloat(tot_netwt).toFixed(3)) + '</td>' +

					'<td>' + money_format_india(parseFloat(tot_diawt).toFixed(3)) + '</td>' +

					'<td>' + money_format_india(parseFloat(tot_taxable_amt).toFixed(2)) + '</td>' +

					'<td>' + money_format_india(parseFloat(tot_sgst).toFixed(2)) + '</td>' +

					'<td>' + money_format_india(parseFloat(tot_cgst).toFixed(2)) + '</td>' +

					'<td>' + money_format_india(parseFloat(tot_igst).toFixed(2)) + '</td>' +

					'<td>' + money_format_india(parseFloat(tot_gst).toFixed(2)) + '</td>' +

					'<td>' + money_format_india(parseFloat(tot_item_amount).toFixed(2)) + '</td>' +

					'<td></td>' +

					'<td></td>' +

					'</tr>';

				//$('#sales_ret_abstract > tbody').html(trHTML);

				$('#sales_ret_abstract > tbody').html(trHTML);

			}

			else {

				var list = data.list;

				var trHTML = '';

				$("#sales_ret_abstract > tbody > tr").remove();

				$('#sales_ret_abstract').dataTable().fnClearTable();

				$('#sales_ret_abstract').dataTable().fnDestroy();

				var tot_piece = 0;

				var tot_gross_wt = 0;

				var tot_netwt = 0;

				var tot_diawt = 0;

				var tot_cgst = 0;

				var tot_sgst = 0;

				var tot_igst = 0;

				var tot_gst = 0;

				var tot_taxable_amt = 0;

				var tot_item_amount = 0;

				$.each(list, function (k, bill_details) {

					var piece = 0;

					var gross_wt = 0;

					var netwt = 0;

					var diawt = 0;

					var cgst = 0;

					var sgst = 0;

					var igst = 0;

					var gst = 0;

					var taxable_amt = 0;

					var item_amount = 0;

					$.each(bill_details, function (key, items) {

						tot_piece += parseFloat(items.piece);

						tot_gross_wt += parseFloat(items.gross_wt);

						tot_netwt += parseFloat(items.net_wt);

						tot_diawt += parseFloat(items.tot_dia_wt);

						tot_taxable_amt += parseFloat(items.taxable_amt);

						tot_sgst += parseFloat(items.total_sgst);

						tot_cgst += parseFloat(items.total_cgst);

						tot_igst += parseFloat(items.total_igst);

						tot_gst += parseFloat(items.tax_amt);

						tot_item_amount += parseFloat(items.total_amount);

						piece += parseFloat(items.piece);

						gross_wt += parseFloat(items.gross_wt);

						netwt += parseFloat(items.net_wt);

						diawt += parseFloat(items.tot_dia_wt);

						taxable_amt += parseFloat(items.taxable_amt);

						sgst += parseFloat(items.total_sgst);

						cgst += parseFloat(items.total_cgst);

						igst += parseFloat(items.total_igst);

						gst += parseFloat(items.tax_amt);

						item_amount += parseFloat(items.total_amount);

						//var url = base_url+'index.php/admin_ret_billing/billing_invoice/'+items.sales_bill_id;

						trHTML += '<tr>' +

							'<td style="font-weight:bold;">' + k + '</td>' +

							'<td>' + items.metal_name + '</td>' +

							'<td>' + items.hsn_code + '</td>' +

							'<td></td>' +

							'<td></td>' +

							'<td>' + money_format_india(items.piece) + '</td>' +

							'<td>' + money_format_india(items.gross_wt) + '</td>' +

							'<td>' + money_format_india(items.net_wt) + '</td>' +

							'<td>' + money_format_india(items.tot_dia_wt) + '</td>' +

							'<td>' + money_format_india(items.taxable_amt) + '</td>' +

							'<td>' + money_format_india(items.total_sgst) + '</td>' +

							'<td>' + money_format_india(items.total_cgst) + '</td>' +

							'<td>' + money_format_india(items.total_igst) + '</td>' +

							'<td>' + money_format_india(items.tax_amt) + '</td>' +

							'<td>' + money_format_india(items.total_amount) + '</td>' +

							'<td></td>' +

							'<td></td>' +

							'</tr>';

					});

					trHTML += '<tr style="font-weight:bold;color:red">' +

						'<td>SUB TOTAL</td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td>' + piece + '</td>' +

						'<td>' + money_format_india(parseFloat(gross_wt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(netwt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(diawt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(taxable_amt).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(sgst).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(cgst).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(igst).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(gst).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(item_amount).toFixed(2)) + '</td>' +

						'<td></td>' +

						'<td></td>' +

						'</tr>';

				});

				trHTML += '<tr style="font-weight:bold;color:blue">' +

					'<td>GRAND TOTAL</td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td>' + tot_piece + '</td>' +

					'<td>' + money_format_india(parseFloat(tot_gross_wt).toFixed(3)) + '</td>' +

					'<td>' + money_format_india(parseFloat(tot_netwt).toFixed(3)) + '</td>' +

					'<td>' + money_format_india(parseFloat(tot_diawt).toFixed(3)) + '</td>' +

					'<td>' + money_format_india(parseFloat(tot_taxable_amt).toFixed(2)) + '</td>' +

					'<td>' + money_format_india(parseFloat(tot_sgst).toFixed(2)) + '</td>' +

					'<td>' + money_format_india(parseFloat(tot_cgst).toFixed(2)) + '</td>' +

					'<td>' + money_format_india(parseFloat(tot_igst).toFixed(2)) + '</td>' +

					'<td>' + money_format_india(parseFloat(tot_gst).toFixed(2)) + '</td>' +

					'<td>' + money_format_india(parseFloat(tot_item_amount).toFixed(2)) + '</td>' +

					'<td></td>' +

					'<td></td>' +

					'</tr>';

				$('#sales_ret_abstract > tbody').html(trHTML);

			}

			if (!$.fn.DataTable.isDataTable('#sales_ret_abstract')) {

				oTable = $('#sales_ret_abstract').dataTable({

					"bSort": false,

					"bDestroy": true,

					"bInfo": true,

					"scrollX": '100%',

					"paging": false,

					"dom": 'Bfrtip',

					"bAutoWidth": false,

					"responsive": true,

					"columnDefs": [

						{

							targets: [3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15],

							className: 'dt-body-right'

						},

					],

					/* "buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							orientation: 'landscape',

							customize: function (win) {

								var last = null;

								var current = null;

								var bod = [];

								var css = '@page { size: landscape; }',

									head = win.document.head || win.document.getElementsByTagName('head')[0],

									style = win.document.createElement('style');

								style.type = 'text/css';

								style.media = 'print';

								if (style.styleSheet) {

									style.styleSheet.cssText = css;

								}

								else {

									style.appendChild(win.document.createTextNode(css));

								}

								head.appendChild(style);

							},

							exportOptions: {

								columns: ':visible',

								stripHtml: false

							}

						},

						{

							extend: 'excel',

							footer: true,

							title: 'GST Abstract Report',

						}

					], */

					"buttons": [

						{

							extend: 'print',

							footer: false,

							title: '',

							messageTop: title,

							orientation: 'landscape',

							customize: function (win) {

								// Apply custom styles for A4 print view

								var customStyle = `

							<style>

								@media print {

									body {

										width: 380mm;

										//height: 297mm;

									}

									table {

										width: 100%;

									}

									th, td {

										word-break: break-word;

									}

								}

							</style>

						`;

								$(win.document.head).append(customStyle);

							},

							exportOptions: {

								modifier: {

									page: 'landscape', // Set landscape orientation

									size: 'A4', // Set paper size

								},

							}

						},

						{

							extend: 'excel',

							footer: true,

							title: 'Sales Return Abstract',

						}

					],

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//sales return details

//card collection report

$('#card_collection_search').on('click', function () {

	get_card_collection_report();

});

function get_card_collection_report() {

	/*var branch_name=($('#branch_name').val()!='' && $('#branch_name').val()!=undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());*/

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $('#branch_select option:selected').toArray().map(item => item.text).join());

	var company_name = $('#company_name').val();

	var company_code = $('#company_code').val();

	var company_code = $('#company_code').val();

	var company_address1 = $('#company_address1').val();

	var company_address2 = $('#company_address2').val();

	var company_city = $('#company_city').val();

	var pincode = $('#pincode').val();

	var company_email = $('#company_email').val();

	var company_gst_number = $('#company_gst_number').val();

	var phone = $('#phone').val();

	var title = "<div style='text-align: center;'><b><span style='font-size:12pt;'>" + company_code + "</span></b></br>"

		+ "<span style='font-size:11pt;'>" + company_address1 + "</span></br>"

		+ "<span style='font-size:11pt;'>" + company_address2 + company_city + "-" + pincode + "</span></br>"

		+ "<span style='font-size:11pt;'>GSTIN:" + company_gst_number + ", EMAIL:" + company_email + "</span></br>"

		+ "<span style='font-size:11pt;'>Contact :" + phone + "</span></br>"

		+ "<span style=font-size:12pt;>&nbsp;&nbsp;CARD COLLECTION REPORT - " + branch_name + " &nbsp;FROM&nbsp;:&nbsp;" + $('#rpt_payments1').html() + " &nbsp;&nbsp;TO&nbsp;&nbsp; " + $('#rpt_payments2').html() + " - " + $('.hidden-xs').html() + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/card_collection_report/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({

			'from_date': $('#rpt_payments1').html(),

			'to_date': $('#rpt_payments2').html(),

			'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()),

			'source_type': $('#source_by').val(),

			'selectedcat': $('#device').val()

		}),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			$("#card_collection_list > tbody > tr").remove();

			$('#card_collection_list').dataTable().fnClearTable();

			$('#card_collection_list').dataTable().fnDestroy();

			var oTable = $('#card_collection_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#card_collection_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"order": [[0, "asc"]],

					"lengthMenu": [[-1, 25, 50, 100, 250], ["All", 25, 50, 100, 250]],

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"columnDefs": [

						{

							targets: 5,

							className: 'dt-body-right'

						}

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							stripHtml: false,

							title: "",

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							//messageTop: "Categorywise BT Report - "+ branch_name  + " From: "+dt_range[0]+ " To:" +dt_range[1],

							title: "Card Collection Report - " + branch_name + " From: " + $('#rpt_payments1').html() + " To:" + $('#rpt_payments2').html(),

						}

					],

					"aaData": list,

					"aoColumns": [

						{

							"mDataProp": function (row, type, val, meta) {

								var url = '';

								if (row.report_type == 'billing') {

									var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + row.bill_id;

								} else if (row.report_type == 'issue_receipt') {

									var url = base_url + 'index.php/admin_ret_billing/receipt/receipt_print/' + row.id_issue_receipt;

								}

								else {

									var url = base_url + 'index.php/payment/invoice/' + row.bill_no + '/' + row.id_scheme_account;

								}

								return '<a href=' + url + ' target="_blank">' + row.bill_no + '</a>';

							}

						},

						{ "mDataProp": "bill_date" },

						{ "mDataProp": "branch_name" },

						{ "mDataProp": "card_name" },

						{ "mDataProp": "card_no" },

						{ "mDataProp": "payment_amount" },

						{ "mDataProp": "approvalno" },

						{ "mDataProp": "device_name" },

						{ "mDataProp": "cus_name" },

					],

					"footerCallback": function (row, data, start, end, display) {

						if (data.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								tot_amt = api

									.column(5, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(5).footer()).html(parseFloat(tot_amt).toFixed(2));

							}

						} else {

							var api = this.api(), data;

							$(api.column(5).footer()).html('');

						}

					}

				});

			}

			if (list != null) {

				/*trHTML = '';

				tfootHTML = '';

				total_debit_payment=0;

				$.each(list, function (i, bank) {

					var debit_payment=0;

					$.each(bank, function (idx, item) {

						if(item.bill_id==undefined && item.id_issue_receipt!=''){

							print_url=base_url+'index.php/admin_ret_billing/receipt/receipt_print/'+item.id_issue_receipt;

						}

						else{

							print_url=base_url+'index.php/admin_ret_billing/billing_invoice/'+item.bill_id;

						}

						action_content='<a href="'+print_url+'" target="_blank" title="Billing Receipt">'+item.bill_no+'</a>'

						trHTML += '<tr>' +

						'<td>'+action_content+'</td>'

						+'<td>'+item.bill_date+'</td>'

						+'<td>'+item.branch_name+'</td>'

						+'<td>'+item.card_name+'</td>'

						+'<td>'+item.card_no+'</td>'

						+'<td>'+item.payment_amount+'</td>'

						+'<td>'+item.approvalno+'</td>'

						+'<td>'+item.device_name+'</td>'

						+'<td>'+item.cus_name+'</td>'

						'</tr>';

						debit_payment = parseFloat(debit_payment) + parseFloat(item.payment_amount);

					});

					trHTML += '<tr style="font-weight:bold;">' +

					+'<td></td>'

					+'<td></td>'

					+'<td></td>'

					+'<td></td>'

					+'<td></td>'

					+'<td><strong>SUB TOTAL</strong></td>'

					+'<td><strong>'+parseFloat(debit_payment).toFixed(2)+'</strong></td>'

					+'<td></td>'

					+'<td></td>'

					+'<td></td>'

					'</tr>';

					total_debit_payment=total_debit_payment+debit_payment;

				});

					trHTML += '<tr style="font-weight:bold;">' +

					+'<td></td>'

					+'<td></td>'

					+'<td></td>'

					+'<td></td>'

					+'<td></td>'

					+'<td><strong>GRAND TOTAL</strong></td>'

					+'<td><strong>'+parseFloat(total_debit_payment).toFixed(2)+'<strong></td>'

					+'<td></td>'

					+'<td></td>'

					+'<td></td>'

					'</tr>';

				$('#card_collection_list > tbody').html(trHTML);

				// Check and initialise datatable

				if ( ! $.fn.DataTable.isDataTable( '#card_collection_list' ) ) {

				oTable = $('#card_collection_list').dataTable({

				"bSort": false,

				"bInfo": true,

				"scrollX":'100%',

				"dom": 'lBfrtip',

				"paging":false,

				"buttons": [

				{

				extend: 'print',

				footer: true,

				title: '',

				messageTop :title,

				customize: function ( win ) {

				$(win.document.body).find( 'table' )

				.addClass( 'compact' )

				.css( 'font-size', 'inherit' );

				},

				},

				{

				extend:'excel',

				footer: true,

				}

				],

				});

				}*/

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

$('#cheque_collection_search').on('click', function () {

	get_cheque_collection_report();

});

//Cheque Collection Report

function get_cheque_collection_report() {

	var dt_range = ($("#dt_range").val()).split('-');

	var from_date = dt_range[0];

	var to_date = dt_range[1];

	/*var branch_name=($('#branch_name').val()!='' && $('#branch_name').val()!=undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());*/

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $('#branch_select option:selected').toArray().map(item => item.text).join());

	var company_name = $('#company_name').val();

	var company_code = $('#company_code').val();

	var company_code = $('#company_code').val();

	var company_address1 = $('#company_address1').val();

	var company_address2 = $('#company_address2').val();

	var company_city = $('#company_city').val();

	var pincode = $('#pincode').val();

	var company_email = $('#company_email').val();

	var company_gst_number = $('#company_gst_number').val();

	var phone = $('#phone').val();

	var title = "<div style='text-align: center;'><b><span style='font-size:12pt;'>" + company_code + "</span></b></br>"

		+ "<span style='font-size:11pt;'>" + company_address1 + "</span></br>"

		+ "<span style='font-size:11pt;'>" + company_address2 + company_city + "-" + pincode + "</span></br>"

		+ "<span style='font-size:11pt;'>GSTIN:" + company_gst_number + ", EMAIL:" + company_email + "</span></br>"

		+ "<span style='font-size:11pt;'>Contact :" + phone + "</span></br>"

		+ "<span style=font-size:12pt;>&nbsp;&nbsp;CHEQUE COLLECTION REPORT - " + branch_name + " &nbsp;FROM&nbsp;:&nbsp;" + $('#rpt_payments1').html() + " &nbsp;&nbsp;TO&nbsp;&nbsp; " + $('#rpt_payments2').html() + " - " + $('.hidden-xs').html() + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/cheque_collection_report/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'dt_range': $("#dt_range").val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()) }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			$("#cheque_collection_list > tbody > tr").remove();

			$('#cheque_collection_list').dataTable().fnClearTable();

			$('#cheque_collection_list').dataTable().fnDestroy();

			if (list != null) {

				trHTML = '';

				tfootHTML = '';

				total_debit_payment = 0;

				$.each(list, function (idx, chq) {

					var debit_payment = 0;

					trHTML += '<tr>' +

						'<td><strong>' + idx + '</strong></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

					'</tr>';

					$.each(chq, function (idx, item) {

						if (item.bill_id == undefined && item.id_issue_receipt != '') {

							var url = base_url + 'index.php/admin_ret_billing/receipt/receipt_print/' + item.id_issue_receipt;

							action_content = '<a href="' + url + '" target="_blank" title="Billing Receipt">' + item.bill_no + '</a>';

						}

						else {

							var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + item.bill_id;

							action_content = '<a href="' + url + '" target="_blank" title="Billing Receipt">' + item.bill_no + '</a>';

						}

						trHTML += '<tr>' +

							'<td>' + action_content + '</td>'

							+ '<td>' + item.bill_date + '</td>'

							+ '<td>' + item.branch_name + '</td>'

							+ '<td>' + item.type + '</td>'

							+ '<td>' + item.cheque_no + '</td>'

							+ '<td>' + item.cheque_date + '</td>'

							+ '<td>' + money_format_india(item.payment_amount) + '</td>'

							+ '<td>' + item.cus_name + '</td>'

						'</tr>';

						debit_payment = parseFloat(debit_payment) + parseFloat(item.payment_amount);

					});

					trHTML += '<tr style="font-weight:bold;color:blue">' +

						+'<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td><strong>SUB TOTAL</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(debit_payment).toFixed(2)) + '<strong></td>'

						+ '<td></td>'

					'</tr>';

					total_debit_payment = total_debit_payment + debit_payment;

				});

				trHTML += '<tr style="font-weight:bold;color:blue">' +

					+'<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td><strong>GRAND TOTAL</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(total_debit_payment).toFixed(2)) + '<strong></td>'

					+ '<td></td>'

				'</tr>';

				$('#cheque_collection_list > tbody').html(trHTML);

				// Check and initialise datatable

				if (!$.fn.DataTable.isDataTable('#cheque_collection_list')) {

					oTable = $('#cheque_collection_list').dataTable({

						"bSort": false,

						"bInfo": true,

						"scrollX": '100%',

						"dom": 'lBfrtip',

						"paging": false,

						"columnDefs": [

							{

								targets: [6],

								className: 'dt-body-right'

							},

						],

						/* "buttons": [

							{

								extend: 'print',

								footer: true,

								title: '',

								messageTop: title,

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', 'inherit');

								},

							},

							{

								extend: 'excel',

								footer: true,

								title:'CHEQUE COLLECTION REPORT',

							}

						], */

						"buttons": [

							{

								extend: 'print',

								footer: false,

								title: '',

								messageTop: title,

								orientation: 'landscape',

								customize: function (win) {

									// Apply custom styles for A4 print view

									var customStyle = `

							<style>

								@media print {

									body {

										width: 380mm;

										//height: 297mm;

									}

									table {

										width: 100%;

									}

									th, td {

										word-break: break-word;

									}

								}

							</style>

						`;

									$(win.document.head).append(customStyle);

								},

								exportOptions: {

									modifier: {

										page: 'landscape', // Set landscape orientation

										size: 'A4', // Set paper size

									},

								}

							},

							{

								extend: 'excel',

								footer: true,

								title: 'Cheque Collection Report',

							}

						],

					});

				}

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

$('#nb_collection_search').click(function (event) {

	get_netbanking_collection_report();

});

function get_netbanking_collection_report_15_02_2024() {

	$('div.overlay').css('display', 'block');

	/*var branch_name=($('#branch_name').val()!='' && $('#branch_name').val()!=undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());*/

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $('#branch_select option:selected').toArray().map(item => item.text).join());

	var company_name = $('#company_name').val();

	var company_code = $('#company_code').val();

	var company_code = $('#company_code').val();

	var company_address1 = $('#company_address1').val();

	var company_address2 = $('#company_address2').val();

	var company_city = $('#company_city').val();

	var pincode = $('#pincode').val();

	var company_email = $('#company_email').val();

	var company_gst_number = $('#company_gst_number').val();

	var phone = $('#phone').val();

	var title = "<div style='text-align: center;'><b><span style='font-size:12pt;'>" + company_code + "</span></b></br>"

		+ "<span style='font-size:11pt;'>" + company_address1 + "</span></br>"

		+ "<span style='font-size:11pt;'>" + company_address2 + company_city + "-" + pincode + "</span></br>"

		+ "<span style='font-size:11pt;'>GSTIN:" + company_gst_number + ", EMAIL:" + company_email + "</span></br>"

		+ "<span style='font-size:11pt;'>Contact :" + phone + "</span></br>"

		+ "<span style=font-size:12pt;>&nbsp;&nbsp;Net Banking Collection Report - " + branch_name + " &nbsp;From&nbsp;:&nbsp;" + $('#nb_coll_rpt1').html() + " &nbsp;&nbsp;- to " + $('#nb_coll_rpt2').html() + " - " + $('.hidden-xs').html() + "</span>";

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/netbanking_collection_report/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({

			'dt_range': $("#dt_range").val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'nb_type': $('#nb_group_by').val(), 'nb_source_type': $('#nb_source_by').val(), 'id_bank': $('#bank').val(),

			'id_device': $('#device_name').val()

		}),

		dataType: "JSON",

		cache: false,

		type: "POST",

		success: function (data) {

			$("#nb_collection_list > tbody > tr").remove();

			$('#nb_collection_list').dataTable().fnClearTable();

			$('#nb_collection_list').dataTable().fnDestroy();

			var list = data.list;

			var trHTML = '';

			console.log(list);

			// var oTable = $('#nb_collection_list').DataTable();

			// oTable.clear().draw();

			if (list != null) {

				var tot_payment = 0;

				$.each(list, function (idx, item) {

					var sub_tot_payment = 0;

					trHTML += '<tr>'

						+ '<th>' + idx + '</th>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

					'</tr>';

					$.each(item, function (key, val) {

						if (val.bill_id != undefined) {

							print_url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + val.bill_id;

							action_content = '<a href="' + print_url + '" target="_blank" title="Billing Receipt">' + val.bill_no + '</a>'

						} else {

							print_url = base_url + 'index.php/admin_ret_billing/receipt/receipt_print/' + val.id_issue_receipt;

							action_content = '<a href="' + print_url + '" target="_blank" title="Billing Receipt">' + val.bill_no + '</a>'

						}

						sub_tot_payment += parseFloat(val.payment_amount);

						trHTML += '<tr>'

							+ '<td>' + action_content + '</td>'

							+ '<td>' + val.bill_date + '</td>'

							+ '<td>' + val.payment_date + '</td>'

							+ '<td>' + val.name + '</td>'

							+ '<td>' + val.nb_type + '</td>'

							+ '<td>' + val.payment_type + '</td>'

							+ '<td>' + val.payment_ref_number + '</td>'

							+ '<td>' + money_format_india(val.payment_amount) + '</td>'

							+ '<td>' + val.firstname + '</td>'

							+ '<td>' + val.mobile + '</td>'

						'</tr>';

					});

					tot_payment += parseFloat(sub_tot_payment);

					trHTML += '<tr style="color:red">'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<th>SUB TOTAL</th>'

						+ '<th>' + money_format_india(sub_tot_payment) + '</th>'

						+ '<td></td>'

						+ '<td></td>'

					'</tr>';

				});

				trHTML += '<tr style="color:blue">'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<th>GRAND TOTAL</th>'

					+ '<th>' + money_format_india(tot_payment) + '</th>'

					+ '<td></td>'

					+ '<td></td>'

				'</tr>';

			}

			$('#nb_collection_list > tbody').html(trHTML);

			// Check and initialise datatable

			if (!$.fn.DataTable.isDataTable('#nb_collection_list')) {

				oTable = $('#nb_collection_list').dataTable({

					"bSort": false,

					"bInfo": true,

					"scrollX": '100%',

					"dom": 'lBfrtip',

					"paging": false,

					"columnDefs": [

						{

							targets: [7],

							className: 'dt-body-right'

						},

					],

					/* "buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: 'Net Banking Collection Report',

						}

					], */

					"buttons": [

						{

							extend: 'print',

							footer: false,

							title: '',

							messageTop: title,

							orientation: 'landscape',

							customize: function (win) {

								// Apply custom styles for A4 print view

								var customStyle = `

							<style>

								@media print {

									body {

										width: 380mm;

										//height: 297mm;

									}

									table {

										width: 100%;

									}

									th, td {

										word-break: break-word;

									}

								}

							</style>

						`;

								$(win.document.head).append(customStyle);

							},

							exportOptions: {

								modifier: {

									page: 'landscape', // Set landscape orientation

									size: 'A4', // Set paper size

								},

							}

						},

						{

							extend: 'excel',

							footer: true,

							title: 'Net Banking Collection Report',

						}

					],

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function get_netbanking_collection_report() {

	$('div.overlay').css('display', 'block');

	/*var branch_name=($('#branch_name').val()!='' && $('#branch_name').val()!=undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());*/

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $('#branch_select option:selected').toArray().map(item => item.text).join());

	var company_name = $('#company_name').val();

	var company_code = $('#company_code').val();

	var company_code = $('#company_code').val();

	var company_address1 = $('#company_address1').val();

	var company_address2 = $('#company_address2').val();

	var company_city = $('#company_city').val();

	var pincode = $('#pincode').val();

	var company_email = $('#company_email').val();

	var company_gst_number = $('#company_gst_number').val();

	var phone = $('#phone').val();

	var title = "<div style='text-align: center;'><b><span style='font-size:12pt;'>" + company_code + "</span></b></br>"

		+ "<span style='font-size:11pt;'>" + company_address1 + "</span></br>"

		+ "<span style='font-size:11pt;'>" + company_address2 + company_city + "-" + pincode + "</span></br>"

		+ "<span style='font-size:11pt;'>GSTIN:" + company_gst_number + ", EMAIL:" + company_email + "</span></br>"

		+ "<span style='font-size:11pt;'>Contact :" + phone + "</span></br>"

		+ "<span style=font-size:12pt;>&nbsp;&nbsp;Net Banking Collection Report - " + branch_name + " &nbsp;From&nbsp;:&nbsp;" + $('#nb_coll_rpt1').html() + " &nbsp;&nbsp;- to " + $('#nb_coll_rpt2').html() + " - " + $('.hidden-xs').html() + "</span>";

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/netbanking_collection_report/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({

			'from_date': $('#nb_coll_rpt1').html(), 'to_date': $('#nb_coll_rpt2').html(),

			'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()),

			'nb_type': $('#nb_group_by').val(), 'nb_source_type': $('#nb_source_by').val(), 'id_bank': $('#bank').val(),

			'id_device': $('#device_name').val()

		}),

		dataType: "JSON",

		cache: false,

		type: "POST",

		success: function (data) {

			$("#nb_collection_list > tbody > tr").remove();

			$('#nb_collection_list').dataTable().fnClearTable();

			$('#nb_collection_list').dataTable().fnDestroy();

			var list = data.list;

			var trHTML = '';

			console.log(list);

			// var oTable = $('#nb_collection_list').DataTable();

			// oTable.clear().draw();

			if (list != null) {

				var tot_payment = 0;

				$.each(list, function (idx, item) {

					var sub_tot_payment = 0;

					trHTML += '<tr>'

						+ '<th>' + idx + '</th>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

					'</tr>';

					$.each(item, function (key, val) {

						// if (val.bill_id != undefined) {

						// 	print_url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + val.bill_id;

						// 	action_content = '<a href="' + print_url + '" target="_blank" title="Billing Receipt">' + val.bill_no + '</a>'

						// } else {

						// 	print_url = base_url + 'index.php/admin_ret_billing/receipt/receipt_print/' + val.id_issue_receipt;

						// 	action_content = '<a href="' + print_url + '" target="_blank" title="Billing Receipt">' + val.bill_no + '</a>'

						// }

						if (val.payment_type == "Chit Receipt") {

							print_url = base_url + 'index.php/payment/invoice/' + val.bill_id + '/' + val.payment_ref_number;

							action_content = '<a href="' + print_url + '" target="_blank" title="Chit Receipt">' + val.bill_no + '</a>'

						} else if (val.bill_id == undefined) {

							print_url = base_url + 'index.php/admin_ret_billing/receipt/receipt_print/' + val.id_issue_receipt;

							action_content = '<a href="' + print_url + '" target="_blank" title="issue Receipt">' + val.bill_no + '</a>'

						} else {

							print_url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + val.bill_id;

							action_content = '<a href="' + print_url + '" target="_blank" title="Billing Receipt">' + val.bill_no + '</a>'

						}

						sub_tot_payment += parseFloat(val.payment_amount);

						trHTML += '<tr>'

							+ '<td>' + action_content + '</td>'

							+ '<td>' + val.bill_date + '</td>'

							+ '<td>' + val.payment_date + '</td>'

							+ '<td>' + val.name + '</td>'

							+ '<td>' + val.bank_name + '</td>'

							+ '<td>' + val.device_name + '</td>'

							+ '<td>' + val.nb_type + '</td>'

							+ '<td>' + val.payment_type + '</td>'

							+ '<td>' + val.payment_ref_number + '</td>'

							+ '<td>' + money_format_india(val.payment_amount) + '</td>'

							+ '<td>' + val.firstname + '</td>'

							+ '<td>' + val.mobile + '</td>'

						'</tr>';

					});

					tot_payment += parseFloat(sub_tot_payment);

					trHTML += '<tr style="color:red">'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<th>SUB TOTAL</th>'

						+ '<th>' + money_format_india(sub_tot_payment) + '</th>'

						+ '<td></td>'

						+ '<td></td>'

					'</tr>';

				});

				trHTML += '<tr style="color:blue">'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<th>GRAND TOTAL</th>'

					+ '<th>' + money_format_india(tot_payment) + '</th>'

					+ '<td></td>'

					+ '<td></td>'

				'</tr>';

			}

			$('#nb_collection_list > tbody').html(trHTML);

			// Check and initialise datatable

			if (!$.fn.DataTable.isDataTable('#nb_collection_list')) {

				oTable = $('#nb_collection_list').dataTable({

					"bSort": false,

					"bInfo": true,

					"scrollX": '100%',

					"dom": 'lBfrtip',

					"paging": false,

					"columnDefs": [

						{

							targets: [9],

							className: 'dt-body-right'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: 'Net Banking Collection Report',

						}

					],

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

$('#advance_list_search').on('click', function () {

	set_advance_receipt_table();

});

function set_advance_receipt_table() {

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $('#branch_select option:selected').toArray().map(item => item.text).join());

	var company_name = $('#company_name').val();

	var company_code = $('#company_code').val();

	var company_code = $('#company_code').val();

	var company_address1 = $('#company_address1').val();

	var company_address2 = $('#company_address2').val();

	var company_city = $('#company_city').val();

	var pincode = $('#pincode').val();

	var company_email = $('#company_email').val();

	var company_gst_number = $('#company_gst_number').val();

	var phone = $('#phone').val();

	var title = "<div style='text-align: center;'><b><span style='font-size:12pt;'>" + company_code + "</span></b></br>"

		+ "<span style='font-size:11pt;'>" + company_address1 + "</span></br>"

		+ "<span style='font-size:11pt;'>" + company_address2 + company_city + "-" + pincode + "</span></br>"

		+ "<span style='font-size:11pt;'>GSTIN:" + company_gst_number + ", EMAIL:" + company_email + "</span></br>"

		+ "<span style='font-size:11pt;'>Contact :" + phone + "</span></br>"

		+ "<span style=font-size:12pt;>&nbsp;&nbsp;Advance Receipt Report - " + branch_name + " &nbsp;From&nbsp;:&nbsp;" + $('#advance_list_report_date1').html() + " &nbsp;&nbsp;- to " + $('#advance_list_report_date2').html() + " - " + $('.hidden-xs').html() + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/advance_receipt_report/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'from_date': $('#advance_list_report_date1').html(), 'to_date': $('#advance_list_report_date2').html(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()) }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			$("#advance_list > tbody > tr").remove();

			$('#advance_list').dataTable().fnClearTable();

			$('#advance_list').dataTable().fnDestroy();

			if (list != null) {

				trHTML = '';

				if (list.advance_receipt.length > 0) {

					advance_receipt_amount = 0;

					trHTML += '<tr style="font-weight:bold;">' +

						'<td><strong>ADVANCE RECEIPT</strong></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'</tr>';

					$.each(list.advance_receipt, function (idx, item) {

						if (item.bill_id != undefined) {

							print_url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + item.bill_id;

							action_content = '<a href="' + print_url + '" target="_blank" title="Billing Receipt">' + item.bill_no + '</a>'

						} else {

							print_url = base_url + 'index.php/admin_ret_billing/receipt/receipt_print/' + item.id_issue_receipt;

							action_content = '<a href="' + print_url + '" target="_blank" title="Advance Receipt">' + item.bill_no + '</a>'

						}

						trHTML += '<tr>' +

							'<td>' + action_content + '</td>'

							+ '<td>' + item.bill_date + '</td>'

							+ '<td>' + item.firstname + '</td>'

							+ '<td>' + item.mobile + '</td>'

							+ '<td>' + item.name + '</td>'

							+ '<td>' + money_format_india(parseFloat(item.amount).toFixed(2)) + '</td>'

						'</tr>';

						advance_receipt_amount = parseFloat(advance_receipt_amount) + parseFloat(item.amount);

					});

					trHTML += '<tr style="font-weight:bold;color:red">' +

						+'<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td><strong>TOTAL</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(advance_receipt_amount).toFixed(2)) + '</strong></td>'

					'</tr>';

					// total_debit_payment=total_debit_payment+debit_payment;

				}

				// ADVANCE UTILIZED

				if (list.advance_utilized.length > 0) {

					advance_adjusted_amount = 0;

					trHTML += '<tr style="font-weight:bold;">' +

						'<td><strong>ADVANCE UTILIZED</strong></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'</tr>';

					$.each(list.advance_utilized, function (idx, item) {

						if (item.bill_id != undefined) {

							print_url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + item.bill_id;

							action_content = '<a href="' + print_url + '" target="_blank" title="Billing Receipt">' + item.bill_no + '</a>'

						} else {

							print_url = base_url + 'index.php/admin_ret_billing/receipt/receipt_print/' + item.id_issue_receipt;

							action_content = '<a href="' + print_url + '" target="_blank" title="Advance Receipt">' + item.bill_no + '</a>'

						}

						trHTML += '<tr>' +

							'<td>' + action_content + '</td>'

							+ '<td>' + item.bill_date + '</td>'

							+ '<td>' + item.firstname + '</td>'

							+ '<td>' + item.mobile + '</td>'

							+ '<td>' + item.name + '</td>'

							+ '<td>' + money_format_india(parseFloat(item.advance_adj).toFixed(2)) + '</td>'

						'</tr>';

						advance_adjusted_amount = parseFloat(advance_adjusted_amount) + parseFloat(item.advance_adj);

					});

					trHTML += '<tr style="font-weight:bold; color:red">' +

						+'<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td><strong>TOTAL</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(advance_adjusted_amount).toFixed(2)) + '</strong></td>'

					'</tr>';

				}

				//ADVANCE REFUND

				if (list.advance_refund.length > 0) {

					advance_refund_amount = 0;

					trHTML += '<tr style="font-weight:bold;">' +

						'<td><strong>ADVANCE REFUND</strong></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'</tr>';

					$.each(list.advance_refund, function (idx, item) {

						if (item.bill_id != undefined) {

							print_url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + item.bill_id;

							action_content = '<a href="' + print_url + '" target="_blank" title="Billing Receipt">' + item.bill_no + '</a>'

						} else {

							print_url = base_url + 'index.php/admin_ret_billing/receipt/receipt_print/' + item.id_issue_receipt;

							action_content = '<a href="' + print_url + '" target="_blank" title="Advance Receipt">' + item.bill_no + '</a>'

						}

						trHTML += '<tr>' +

							'<td>' + action_content + '</td>'

							+ '<td>' + item.bill_date + '</td>'

							+ '<td>' + item.firstname + '</td>'

							+ '<td>' + item.mobile + '</td>'

							+ '<td>' + item.name + '</td>'

							+ '<td>' + parseFloat(item.amount).toFixed(2) + '</td>'

						'</tr>';

						advance_refund_amount = parseFloat(advance_refund_amount) + parseFloat(item.amount);

					});

					trHTML += '<tr style="font-weight:bold; color:red">' +

						+'<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td><strong>TOTAL</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(advance_refund_amount).toFixed(2)) + '</strong></td>'

					'</tr>';

				}

				//ADVANCE REFUND

				$('#advance_list > tbody').html(trHTML);

				// Check and initialise datatable

				if (!$.fn.DataTable.isDataTable('#advance_list')) {

					oTable = $('#advance_list').dataTable({

						"bSort": false,

						"bInfo": true,

						"scrollX": '100%',

						"dom": 'lBfrtip',

						"paging": false,

						"columnDefs": [

							{

								targets: [5],

								className: 'dt-body-right'

							},

						],

						"buttons": [

							{

								extend: 'print',

								footer: false,

								title: '',

								messageTop: title,

								orientation: 'landscape',

								customize: function (win) {

									// Apply custom styles for A4 print view

									var customStyle = `

							<style>

								@media print {

									body {

										width: 380mm;

										//height: 297mm;

									}

									table {

										width: 100%;

									}

									th, td {

										word-break: break-word;

									}

								}

							</style>

						`;

									$(win.document.head).append(customStyle);

								},

								exportOptions: {

									modifier: {

										page: 'landscape', // Set landscape orientation

										size: 'A4', // Set paper size

									},

								}

							},

							{

								extend: 'excel',

								footer: true,

								title: 'Advance Receipt Report',

							}

						],

					});

				}

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

$('#categorywise_bt_search').click(function (event) {

	get_category_bt_report();

});

$('#categorywise_stock_search').click(function (event) {

	get_category_stock_report();

});

$('#categorywise_bookstock_search').click(function (event) {

	get_categorybookstock_report();

});

$('#transitemtype').on('change', function (e) {

	if (this.value == 3) {

		$(".disp-purchasetype").css("display", "block");

	} else {

		$("#transpurchasetype").val(0);

		$(".disp-purchasetype").css("display", "none");

	}

});

$('#selecttransitemtypes').on('change', function (e) {

	console.log(this.value);

});

$('#selecttransitemtypes').on('select2:select', function (e) {

	var data = e.params.data;

	console.log(data);

	const array = $('#selecttransitemtypes').val();

	if ($('#selecttransitemtypes').val().length > 1) {

		if ($.inArray("0", $('#selecttransitemtypes').val()) !== -1) {

			const index = array.indexOf('0');

			if (index > -1) { // only splice array when item is found

				array.splice(index, 1);

				$('#selecttransitemtypes').select2({}).select2('val', array); // 2nd parameter means remove one item only

			}

		}

	}

	if (data.id == "5") {

		$('#selecttransitemtypes').select2({}).select2('val', [5]);

		$(".other-category").css("display", "none");

		$(".oldcategory").css("display", "block");

	} else if (data.id == "0") {

		$('#selecttransitemtypes').select2({}).select2('val', [0]);

		$(".other-category").css("display", "none");

		$(".oldcategory").css("display", "none");

		$('#category').val(0);

		$('#oldcategory').val(0);

	} else {

		const index = array.indexOf('5');

		if (index > -1) { // only splice array when item is found

			array.splice(index, 1);

			$('#selecttransitemtypes').select2({}).select2('val', array); // 2nd parameter means remove one item only

		}

		$(".other-category").css("display", "block");

		$(".oldcategory").css("display", "none");

	}

	//$('#selecttransitemtypes').select2({}).select2('val', [1,2]);

	//$('#selecttransitemtypes').val();

});

// $('#transtype').on('change', function (e) {

// 	if (this.value == 1) {

// 		$('#branch_select').select2({

// 			placeholder: "To Centre",

// 			allowClear: true

// 		});

// 		$('.trans_centre').html("To Centre");

// 	} else {

// 		$('#branch_select').select2({

// 			placeholder: "From Centre",

// 			allowClear: true

// 		});

// 		$('.trans_centre').html("From Centre");

// 	}

// });

function get_category_bt_report() {

	$("div.overlay").css("display", "block");

	var dt_range = ($("#dt_range").val()).split('-');

	var company_name = $('#company_name').val();

	var company_code = $('#company_code').val();

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $('#branch_select option:selected').toArray().map(item => item.text).join());

	var company_code = $('#company_code').val();

	var company_address1 = $('#company_address1').val();

	var company_address2 = $('#company_address2').val();

	var company_city = $('#company_city').val();

	var pincode = $('#pincode').val();

	var company_email = $('#company_email').val();

	var company_gst_number = $('#company_gst_number').val();

	var phone = $('#phone').val();

	var title = "<div style='text-align: center;'><b><span style='font-size:12pt;'>" + company_code + "</span></b></br>"

		+ "<span style='font-size:11pt;'>" + company_address1 + "</span></br>"

		+ "<span style='font-size:11pt;'>" + company_address2 + company_city + "-" + pincode + "</span></br>"

		+ "<span style='font-size:11pt;'>GSTIN:" + company_gst_number + ", EMAIL:" + company_email + "</span></br>"

		+ "<span style='font-size:11pt;'>Contact :" + phone + "</span></br>"

		+ "<span style=font-size:12pt;>Categorywise BT Report - " + branch_name + " &nbsp;&nbsp; From: " + dt_range[0] + " To:" + dt_range[1] + " - " + $('.hidden-xs').html() + "</span>";

	my_Date = new Date();

	var transitemtype = $('#selecttransitemtypes').val();

	var selectedcat = 0;

	if (transitemtype == '0') {

		selectedcat = 0;

	} else if (transitemtype == '5') {

		selectedcat = $('#oldcategory').val();

	} else {

		selectedcat = $('#category').val();

	}

	//($('#transitemtype').val()!='' && $('#transitemtype').val()!=undefined && $('#transitemtype').val() != null) ? $('#transitemtype').val(): 0

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/categorywise_bt_report/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({

			'transtype': $("#transtype").val(),

			'dt_range': $("#dt_range").val(),

			'id_branch': $("#branch_select").val(),

			'from_branch': $('#branch_select_to').val(),

			'id_category': selectedcat,

			'transitemtype': $('#selecttransitemtypes').val()

		}),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			console.log(data);

			var list = data.list;

			print_stock_issue = list;

			console.log(data);

			var oTable = $('#categorywise_bt_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#categorywise_bt_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"order": [[0, "asc"]],

					"lengthMenu": [[-1, 25, 50, 100, 250], ["All", 25, 50, 100, 250]],

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"columnDefs": [

						{

							targets: [3, 4, 5, 6, 7, 8, 9, 10, 11],

							className: 'dt-body-right'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							stripHtml: false,

							title: "",

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							//messageTop: "Categorywise BT Report - "+ branch_name  + " From: "+dt_range[0]+ " To:" +dt_range[1],

							title: "Categorywise BT Report - " + branch_name + " From: " + dt_range[0] + " To:" + dt_range[1],

						}

					],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "category_name" },

						{ "mDataProp": "from_branch" },

						{ "mDataProp": "to_branch_name" },

						{ "mDataProp": "piece" },

						{ "mDataProp": "grs_wt" },

						{ "mDataProp": "net_wt" },

						{ "mDataProp": "totaldiawt" },

						{

							"mDataProp": function (row, type, val, meta) {

								var sales_value = row.sales_value;

								return money_format_india(sales_value);

							}

						},

						{ "mDataProp": "trans_code" },

						{ "mDataProp": "branch_transfer_id" },

						{ "mDataProp": "approvedon" },

						{ "mDataProp": "downloadedon" }

					],

					"footerCallback": function (row, data, start, end, display) {

						if (data.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								pcs = api

									.column(3, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(3).footer()).html(money_format_india(parseFloat(pcs).toFixed(0)));

								gross_wgt = api

									.column(4, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(4).footer()).html(money_format_india(parseFloat(gross_wgt).toFixed(3)));

								net_wgt = api

									.column(5, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(5).footer()).html(money_format_india(parseFloat(net_wgt).toFixed(3)));

								dia_wgt = api

									.column(6, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(6).footer()).html(money_format_india(parseFloat(dia_wgt).toFixed(3)));

								tot_amt = api

									.column(7, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(7).footer()).html(money_format_india(parseFloat(tot_amt).toFixed(3)));

							}

						} else {

							var api = this.api(), data;

							$(api.column(8).footer()).html('');

						}

					}

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function get_category_bt_report_on01082022() {

	$("div.overlay").css("display", "block");

	var dt_range = ($("#dt_range").val()).split('-');

	var company_name = $('#company_name').val();

	var company_code = $('#company_code').val();

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $('#branch_select option:selected').toArray().map(item => item.text).join());

	var company_code = $('#company_code').val();

	var company_address1 = $('#company_address1').val();

	var company_address2 = $('#company_address2').val();

	var company_city = $('#company_city').val();

	var pincode = $('#pincode').val();

	var company_email = $('#company_email').val();

	var company_gst_number = $('#company_gst_number').val();

	var phone = $('#phone').val();

	var title = "<div style='text-align: center;'><b><span style='font-size:12pt;'>" + company_code + "</span></b></br>"

		+ "<span style='font-size:11pt;'>" + company_address1 + "</span></br>"

		+ "<span style='font-size:11pt;'>" + company_address2 + company_city + "-" + pincode + "</span></br>"

		+ "<span style='font-size:11pt;'>GSTIN:" + company_gst_number + ", EMAIL:" + company_email + "</span></br>"

		+ "<span style='font-size:11pt;'>Contact :" + phone + "</span></br>"

		+ "<span style=font-size:12pt;>Categorywise BT Report - " + branch_name + " &nbsp;&nbsp; From: " + dt_range[0] + " To:" + dt_range[1] + " - " + $('.hidden-xs').html() + "</span>";

	my_Date = new Date();

	var transitemtype = 0;

	if ($("#transpurchasetype").val() == 0) {

		transitemtype = $('#transitemtype').val();

	} else {

		if ($("#transpurchasetype").val() == 1) { // Old Metal

			transitemtype = 4;

		} else if ($("#transpurchasetype").val() == 2) { // Sales Return

			transitemtype = 5;

		} else if ($("#transpurchasetype").val() == 2) { // Partly Sale

			transitemtype = 6;

		}

	}

	//($('#transitemtype').val()!='' && $('#transitemtype').val()!=undefined && $('#transitemtype').val() != null) ? $('#transitemtype').val(): 0

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/categorywise_bt_report/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'transtype': $("#transtype").val(), 'dt_range': $("#dt_range").val(), 'id_branch': $("#branch_select").val(), 'from_branch': $('#branch_select_to').val(), 'id_category': ($('#category').val() != '' && $('#category').val() != undefined && $('#category').val() != null) ? $('#category').val() : 0, 'transitemtype': transitemtype }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			console.log(data);

			var list = data.list;

			print_stock_issue = list;

			console.log(data);

			var oTable = $('#categorywise_bt_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#categorywise_bt_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"order": [[0, "asc"]],

					"lengthMenu": [[-1, 25, 50, 100, 250], ["All", 25, 50, 100, 250]],

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"buttons": [

						{

							extend: 'print',

							footer: true,

							stripHtml: false,

							title: "",

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							//messageTop: "Categorywise BT Report - "+ branch_name  + " From: "+dt_range[0]+ " To:" +dt_range[1],

							title: "Categorywise BT Report - " + branch_name + " From: " + dt_range[0] + " To:" + dt_range[1],

						}

					],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "category_name" },

						{ "mDataProp": "from_branch" },

						{ "mDataProp": "to_branch_name" },

						{ "mDataProp": "piece" },

						{ "mDataProp": "grs_wt" },

						{ "mDataProp": "net_wt" },

						{ "mDataProp": "totaldiawt" },

						{ "mDataProp": "sales_value" },

						{ "mDataProp": "trans_code" },

						{ "mDataProp": "branch_transfer_id" },

						{ "mDataProp": "approvedon" },

						{ "mDataProp": "downloadedon" }

					],

					"footerCallback": function (row, data, start, end, display) {

						if (data.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								pcs = api

									.column(3, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(3).footer()).html(parseFloat(pcs).toFixed(0));

								gross_wgt = api

									.column(4, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(4).footer()).html(parseFloat(gross_wgt).toFixed(3));

								net_wgt = api

									.column(5, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(5).footer()).html(parseFloat(net_wgt).toFixed(3));

								dia_wgt = api

									.column(6, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(6).footer()).html(parseFloat(dia_wgt).toFixed(3));

								tot_amt = api

									.column(7, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(7).footer()).html(parseFloat(tot_amt).toFixed(3));

							}

						} else {

							var api = this.api(), data;

							$(api.column(8).footer()).html('');

						}

					}

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//ACCOUNTS REPORTS

$('#item_sale_detail_search').click(function (event) {

	itemwise_sales_detail();

});

$('#sales_report_type').on('change', function () {

	$('.summary_report').css("display", "none");

	$('.detail_report').css("display", "none");

	if (this.value == 2) {

		$('.detail_report').css("display", "block");

	} else {

		$('.summary_report').css("display", "block");

	}

});

function itemwise_sales_detail() {

	var dt_range = ($("#dt_range").val()).split('-');

	var company_name = $('#company_name').val();

	var from_date = dt_range[0];

	var to_date = dt_range[1];

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "Product Wise Sales Report";

	var metal = $('#metal option:selected').html() != '' && $('#metal option:selected').html() != undefined ? $('#metal option:selected').html() + ' - ' : '';

	var category = $('#category option:selected').html() != '' && $('#category option:selected').html() != undefined ? $('#category option:selected').html() + ' - ' : '';

	var prod_select = $('#prod_select option:selected').html() != '' && $('#prod_select option:selected').html() != undefined ? $('#prod_select option:selected').html() + ' - ' : '';

	var optional = metal + category + prod_select;

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	var tag_type = $("input[name='tag_or_nontag']:checked").val();

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		type: 'POST',

		url: base_url + "index.php/admin_ret_reports/item_sales/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'dt_range': $("#dt_range").val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'id_product': $('#prod_select').val(), 'id_category': $('#category').val(), 'id_metal': $('#metal').val(), 'id_section': $('#section_select').val(), 'tag_type': tag_type, 'sales_report_type': $('#sales_report_type').val() , 'huid': $('#tag_huid').val() }),

		dataType: 'json', 

		success: function (data) {

			$(".overlay").css("display", "none");

			var list = data.list;

			if ($('#sales_report_type').val() == 2) {

				var oTable = $('#itemwise-sales_detail').DataTable();

				oTable.clear().draw();

				if (list != null) {

					$("#itemwise-sales_detail > tbody > tr").remove();

					$('#itemwise-sales_detail').dataTable().fnClearTable();

					$('#itemwise-sales_detail').dataTable().fnDestroy();

					var trHtml = '';

					var total_section_pcs = 0;

					var total_section_gwt = 0;

					var total_section_lwt = 0;

					var total_section_nwt = 0;

					var total_section_dia_wt = 0;

					var total_section_tag_gross_wt = 0;

					var total_section_tag_diff_wt = 0;

					var total_section_wastage_percent = 0;

					var total_section_wast_wgt = 0;

					var total_section_mc_value = 0;

					var total_section_amt_without_tax = 0;

					var total_section_total_cgst = 0;

					var total_section_total_sgst = 0;

					var total_section_total_igst = 0;

					var total_section_total_cost = 0;

					var total_est_section_total_cost = 0;

					var total_section_stn_amt = 0;

					$.each(list, function (s, section) {

						var section_pcs = 0;

						var section_gwt = 0;

						var section_lwt = 0;

						var section_nwt = 0;

						var section_dia_wt = 0;

						var section_tag_gross_wt = 0;

						var section_tag_diff_wt = 0;

						var section_wastage_percent = 0;

						var section_wast_wgt = 0;

						var section_mc_value = 0;

						var section_amt_without_tax = 0;

						var section_total_cgst = 0;

						var section_total_sgst = 0;

						var section_total_igst = 0;

						var section_total_cost = 0;

						var section_est_total_cost = 0;

						var section_stn_amt = 0;

						trHtml += '<tr style="font-weight:bold;">'

							+ '<td>' + s + '</td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '</tr>';

						$.each(section, function (key, items) {

							section_pcs += parseFloat(items.tot_pcs);

							section_gwt += parseFloat(items.gross_wt);

							section_lwt += parseFloat(items.less_wt);

							section_nwt += parseFloat(items.net_wt);

							section_dia_wt += parseFloat(items.dia_wt);

							section_tag_gross_wt += parseFloat(items.tag_gross_wt);

							section_tag_diff_wt += (items.tag_gross_wt > 0 ? parseFloat(items.tag_gross_wt) - parseFloat(items.gross_wt) : 0);

							section_wastage_percent += parseFloat(items.wastage_percent);

							section_wast_wgt += parseFloat(items.wast_wgt);

							section_mc_value += parseFloat(items.mc_value);

							section_amt_without_tax += parseFloat(items.amt_without_tax);

							section_total_cgst += parseFloat(items.total_cgst);

							section_total_sgst += parseFloat(items.total_sgst);

							section_total_igst += parseFloat(items.total_igst);

							section_total_cost += parseFloat(items.total_cost);

							section_est_total_cost += parseFloat(items.estimation_rate);

							section_stn_amt += parseFloat(items.stn_amt);

							total_section_pcs += parseFloat(items.tot_pcs);

							total_section_gwt += parseFloat(items.gross_wt);

							total_section_lwt += parseFloat(items.less_wt);

							total_section_nwt += parseFloat(items.net_wt);

							total_section_dia_wt += parseFloat(items.dia_wt);

							total_section_tag_gross_wt += parseFloat(items.tag_gross_wt);

							total_section_tag_diff_wt += (items.tag_gross_wt > 0 ? parseFloat(items.tag_gross_wt) - parseFloat(items.gross_wt) : 0);

							total_section_wastage_percent += parseFloat(items.wastage_percent);

							total_section_wast_wgt += parseFloat(items.wast_wgt);

							total_section_mc_value += parseFloat(items.mc_value);

							total_section_amt_without_tax += parseFloat(items.amt_without_tax);

							total_section_total_cgst += parseFloat(items.total_cgst);

							total_section_total_sgst += parseFloat(items.total_sgst);

							total_section_total_igst += parseFloat(items.total_igst);

							total_section_total_cost += parseFloat(items.total_cost);

							total_est_section_total_cost += parseFloat(items.estimation_rate);

							total_section_stn_amt += parseFloat(items.stn_amt);

							var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + items.bill_id;

							if (items.tag_image != null && items.tag_image != undefined && items.tag_image != '') {

								var img_src = base_url + 'assets/img/tag/' + items.tag_image;

							}

							else {

								var img_src = base_url + 'assets/img/no_image.png';

							}

							let estimate_url = "";

							if (items.esti_no > 0) {

								estimate_url = '<a href="' + base_url + 'index.php/admin_ret_estimation/generate_invoice/' + items.esti_id + '" target="_blank">' + items.esti_no + '</a>';

							}

							trHtml += '<tr>'

								+ '<td>' + items.branch + '</td>'

								+ '<td><a href=' + url + ' target="_blank">' + items.bill_no + '</a></td>'

								+ '<td>' + items.bill_date + '</td>'

								+ '<td>' + estimate_url + '</td>'

								+ '<td>' + items.cus_name + '</td>'

								+ '<td>' + items.cus_address + '</td>'

								+ '<td>' + items.state_name + '</td>'

								+ '<td>' + items.gst_number + '</td>'

								+ '<td>' + items.karigar + '</td>'

								+ '<td> <img class="img_src"  id="img_prev" src="' + img_src + '" width="35" height="35" onclick="tag_imgprev($(this).closest(\'tr\'))"></td>'

								+ '<td>' + items.tag_code + '</td>'

								+ '<td>' + items.old_tag_id + '</td>'

								+ '<td>' + items.section_name + '</td>'

								+ '<td>' + items.huid + '</td>'

								+ '<td>' + items.purity + '</td>'

								+ '<td>' + items.product_name + '</td>'

								+ '<td>' + items.design_name + '</td>'

								+ '<td>' + items.sub_design_name + ' </td>'

								+ '<td>' + items.hsn_code + '</td>'

								+ '<td>' + items.tot_pcs + '</td>'

								+ '<td>' + money_format_india(items.gross_wt) + '</td>'

								+ '<td>' + money_format_india(items.less_wt) + '</td>'

								+ '<td>' + money_format_india(items.net_wt) + '</td>'

								+ '<td>' + money_format_india(items.dia_wt) + '</td>'

								+ '<td>' + money_format_india(items.tag_gross_wt) + '</td>'

								+ '<td>' + (items.tag_gross_wt > 0 ? money_format_india(parseFloat(parseFloat(items.tag_gross_wt) - parseFloat(items.gross_wt)).toFixed(3)) : 0) + '</td>'

								+ '<td>' + money_format_india(items.wastage_percent) + '</td>'

								+ '<td>' + money_format_india(items.wast_wgt) + '</td>'

								+ '<td>' + money_format_india(parseFloat(items.mc_value).toFixed(2)) + '</td>'

								+ '<td>' + money_format_india(items.amt_without_tax) + '</td>'

								+ '<td>' + money_format_india(items.total_cgst) + '</td>'

								+ '<td>' + money_format_india(items.total_sgst) + '</td>'

								+ '<td>' + money_format_india(items.total_igst) + '</td>'

								+ '<td>' + money_format_india(items.estimation_rate) + '</td>'

								+ '<td>' + money_format_india(items.total_cost) + '</td>'

								+ '<td>' + money_format_india(items.stn_amt) + '</td>'

								+ '<td>' + items.age + '</td>'

								+ '<td>' + items.cert_no + '</td>'

								+ '<td>' + items.style_code + '</td>'

								+ '<td>' + items.partial_status + '</td>'

								+ '</tr>';

						});

						trHtml += '<tr style="color:blue">'

							+ '<td style="text-align:left;"><strong>SUB TOTAL</strong></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td><strong>' + parseFloat(section_pcs) + '</strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(section_gwt).toFixed(3)) + '</strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(section_lwt).toFixed(3)) + '</strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(section_nwt).toFixed(3)) + '</strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(section_dia_wt).toFixed(3)) + '</strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(section_tag_gross_wt).toFixed(3)) + '</strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(section_tag_diff_wt).toFixed(3)) + '</strong></td>'

							+ '<td><strong></strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(section_wast_wgt).toFixed(3)) + '</strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(section_mc_value).toFixed(2)) + '</strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(section_amt_without_tax).toFixed(2)) + '</strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(section_total_cgst).toFixed(2)) + '</strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(section_total_sgst).toFixed(2)) + '</strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(section_total_igst).toFixed(2)) + '</strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(section_est_total_cost).toFixed(2)) + '</strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(section_total_cost).toFixed(2)) + '</strong></td>'

							+ '<td><strong>' + money_format_india(parseFloat(section_stn_amt).toFixed(2)) + '</strong></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '</tr>';

					});

					trHtml += '<tr style="color:blue">'

						+ '<td style="text-align:left;"><strong>GRAND TOTAL</strong></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td><strong>' + parseFloat(total_section_pcs) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(total_section_gwt).toFixed(3)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(total_section_lwt).toFixed(3)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(total_section_nwt).toFixed(3)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(total_section_dia_wt).toFixed(3)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(total_section_tag_gross_wt).toFixed(3)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(total_section_tag_diff_wt).toFixed(3)) + '</strong></td>'

						+ '<td><strong></strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(total_section_wast_wgt).toFixed(3)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(total_section_mc_value).toFixed(3)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(total_section_amt_without_tax).toFixed(2)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(total_section_total_cgst).toFixed(2)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(total_section_total_sgst).toFixed(2)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(total_section_total_igst).toFixed(2)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(total_est_section_total_cost).toFixed(2)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(total_section_total_cost).toFixed(2)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(total_section_stn_amt).toFixed(2)) + '</strong></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '</tr>';

					$('#itemwise-sales_detail > tbody').html(trHtml);

					// Check and initialise datatable

					if (!$.fn.DataTable.isDataTable('#itemwise-sales_detail')) {

						oTable = $('#itemwise-sales_detail').dataTable({

							"bSort": false,

							"bInfo": true,

							"scrollX": '100%',

							"dom": 'lBfrtip',

							"columnDefs": [

								{

									targets: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15],

									className: 'dt-body-left'

								},

								{

									targets: [16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35],

									className: 'dt-body-right'

								},

							],

							"lengthMenu": [[-1, 25, 50, 100, 250], ["10", 25, 50, 100, 250]],

							"buttons": [

								{

									extend: 'print',

									footer: true,

									title: '',

									messageTop: title,

									customize: function (win) {

										$(win.document.body).find('table')

											.addClass('compact')

											.css('font-size', '10px');

									},

									exportOptions: {

										columns: ':visible',

										stripHtml: true

									}

								},

								{

									extend: 'colvis',

									collectionLayout: 'fixed columns',

									collectionTitle: 'Column visibility control'

								},

								{

									extend: 'excel',

									footer: true,

									title: 'Product Wise Sales Report',

								}

							],

						});

					}

				}

			}

			else {

				var oTable = $('#sales_summary_report').DataTable();

				if (list != null) {

					$("#sales_summary_report > tbody > tr").remove();

					$('#sales_summary_report').dataTable().fnClearTable();

					$('#sales_summary_report').dataTable().fnDestroy();

					var trHtml = '';

					var tagcount = 0;

					var tot_pcs = 0;

					var gross_wt = 0;

					var diawt = 0;

					var net_wt = 0;

					var tag_gross_wt = 0;

					var diff_wt = 0;

					var wast_wt = 0;

					var mc_value = 0;

					var total_cost = 0;

					var stn_amt = 0;

					$.each(list, function (key, val) {

						tagcount += parseFloat(val.tagcount);

						tot_pcs += parseFloat(val.tot_pcs);

						gross_wt += parseFloat(val.gross_wt);

						diawt += parseFloat(val.diawt);

						net_wt += parseFloat(val.net_wt);

						tag_gross_wt += parseFloat(val.tag_gross_wt);

						wast_wt += parseFloat(val.wast_wt);

						mc_value += parseFloat(val.mc_value);

						total_cost += parseFloat(val.total_cost);

						stn_amt += parseFloat(val.stn_amt);

						diff_wt += parseFloat(parseFloat(val.tag_gross_wt) - parseFloat(val.gross_wt));

						trHtml += '<tr >'

							+ '<td>' + val.section_name + '</td>'

							+ '<td>' + val.purity + '</td>'

							+ '<td>' + val.tagcount + '</td>'

							+ '<td>' + val.tot_pcs + '</td>'

							+ '<td>' + money_format_india(val.gross_wt) + '</td>'

							+ '<td>' + money_format_india(val.diawt) + '</td>'

							+ '<td>' + money_format_india(val.net_wt) + '</td>'

							+ '<td>' + money_format_india(val.tag_gross_wt) + '</td>'

							+ '<td>' + money_format_india(parseFloat(parseFloat(val.tag_gross_wt) - parseFloat(val.gross_wt)).toFixed(2)) + '</td>'

							+ '<td>' + parseFloat(val.wastage_percent / (val.tagcount > 0 ? val.tagcount : val.tot_pcs)).toFixed(2) + '</td>'

							+ '<td>' + money_format_india(val.wast_wt) + '</td>'

							+ '<td>' + money_format_india(val.mc_value) + '</td>'

							+ '<td>' + money_format_india(val.total_cost) + '</td>'

							+ '<td>' + money_format_india(val.stn_amt) + '</td>'

							+ '</tr>';

					});

					trHtml += '<tr style="font-weight:bold;color:blue;">'

						+ '<td style="font-weight:bold;">GRAND TOTAL</td>'

						+ '<td></td>'

						+ '<td>' + tagcount + '</td>'

						+ '<td>' + money_format_india(parseFloat(tot_pcs).toFixed(3)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(gross_wt).toFixed(3)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(diawt).toFixed(3)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(net_wt).toFixed(3)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(tag_gross_wt).toFixed(3)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(diff_wt).toFixed(3)) + '</td>'

						+ '<td></td>'

						+ '<td>' + money_format_india(parseFloat(wast_wt).toFixed(3)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(mc_value).toFixed(3)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(total_cost).toFixed(3)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(stn_amt).toFixed(3)) + '</td>'

						+ '</tr>';

					$('#sales_summary_report > tbody').html(trHtml);

					// Check and initialise datatable

					if (!$.fn.DataTable.isDataTable('#sales_summary_report')) {

						oTable = $('#sales_summary_report').dataTable({

							"bSort": false,

							"bInfo": true,

							"scrollX": '100%',

							"dom": 'lBfrtip',

							"columnDefs": [

								{

									targets: [0],

									className: 'dt-body-left'

								},

								{

									targets: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13],

									className: 'dt-body-right'

								},

							],

							"lengthMenu": [[-1, 25, 50, 100, 250], ["10", 25, 50, 100, 250]],

							"buttons": [

								{

									extend: 'print',

									footer: true,

									title: '',

									messageTop: title,

									customize: function (win) {

										$(win.document.body).find('table')

											.addClass('compact')

											.css('font-size', '10px');

									},

									exportOptions: {

										columns: ':visible',

										stripHtml: true

									}

								},

								{

									extend: 'colvis',

									collectionLayout: 'fixed columns',

									collectionTitle: 'Column visibility control'

								},

								{

									extend: 'excel',

									footer: true,

									title: 'Product Wise Sales Report',

								}

							],

						});

					}

				}

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//device wise collection

$('#device_pay_search').click(function (event) {

	set_devicepayBills();

});

function get_ActiveDevicename() {

	$('#device_name option').remove();

	$.ajax({

		url: base_url + 'index.php/admin_ret_reports/get_ActiveDevicename',

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var id = $("#id_pay_device").val();

			$("#device_name").append(

				$("<option></option>")

					.attr("value", 0)

					.text('All')

			);

			$.each(data, function (key, item) {

				$("#device_name").append(

					$("<option></option>")

						.attr("value", item.id_device)

						.text(item.device_name)

				);

			});

			$("#device_name").select2(

				{

					placeholder: "Select Device Name",

					allowClear: true

				});

			$("#device_name").select2("val", (id != '' && id > 0 ? id : ''));

			if ($("#device_name").length) {

				$("#device_name").select2("val", (id != '' && id > 0 ? id : ''));

			}

		}

	});

}

function set_devicepayBills() {

	var dt_range = ($("#dt_range").val()).split('-');

	var company_name = $('#company_name').val();

	var from_date = dt_range[0];

	var to_date = dt_range[1];

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "Pay Device Report"

	var optional = $('#device_name option:selected').html() != '' && $('#device_name option:selected').html() != undefined ? $('#device_name option:selected').html() + ' - ' : '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/pay_device/ajax?noncache=" + my_Date.getUTCSeconds(),

		data: ({ 'dt_range': $("#dt_range").val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'id_pay_device': $("#device_name").val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.list;

			var oTable = $('#pay_device_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				$('#total_count').text(list.length);

				oTable = $('#pay_device_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"order": [[0, "desc"]],

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"columnDefs": [

						{

							targets: [5],

							className: 'dt-body-right'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', '10px');

							},

						},

						{

							extend: 'colvis',

							collectionLayout: 'fixed columns',

							collectionTitle: 'Column visibility control'

						},

						{

							extend: 'excel',

							footer: true,

							title: "Pay Device Report - " + $("#dt_range").val(),

						}

					],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "branch" },

						{

							"mDataProp": function (row, type, val, meta) {

								var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + row.bill_id;

								return '<a href=' + url + ' target="_blank">' + row.bill_no + '</a>';

							}

						},

						{ "mDataProp": "bill_date" },

						{ "mDataProp": "payment_ref_number" },

						{ "mDataProp": "device_name" },

						{

							"mDataProp": function (row, type, val, meta) {

								var amount = row.amount;

								return money_format_india(amount);

							}

						},

					],

					"footerCallback": function (row, data, start, end, display) {

						if (data.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								amount = api

									.column(5)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(5).footer()).html(money_format_india(parseFloat(amount).toFixed(2)));

							}

						} else {

							var api = this.api(), data;

							$(api.column(5).footer()).html('');

						}

					}

				});

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//device wise collection

$('#weight_range_sales_search').click(function (event) {

	get_weight_range_wise_sales_list();

});

function get_weight_range_wise_sales_list() {

	var company_name = $('#company_name').val();

	var from_date = $('#rpt_payments1').html();

	var to_date = $('#rpt_payments2').html();

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "PURCHASE IMPORT";

	var prod_select = $('#prod_select option:selected').html() != '' && $('#prod_select option:selected ').html() != undefined ? $('#prod_select option:selected').html() + " - " : '';

	var des_select = $('#des_select option:selected').html() != '' && $('#des_select option:selected ').html() != undefined ? $('#des_select option:selected').html() + " - " : '';

	var sub_des_select = $('#sub_des_select option:selected').html() != '' && $('#sub_des_select option:selected ').html() != undefined ? $('#sub_des_select option:selected').html() + " - " : '';

	var wt_select = $('#wt_select option:selected').html() != '' && $('#wt_select option:selected ').html() != undefined ? $('#wt_select option:selected').html() + " - " : '';

	var karigar = $('#karigar option:selected').html() != '' && $('#karigar option:selected ').html() != undefined ? $('#karigar option:selected').html() + " - " : '';

	var optional = prod_select + des_select + sub_des_select + wt_select + karigar;

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/weight_range_sales/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: { 'from_date': $('#rpt_payments1').html(), 'to_date': $('#rpt_payments2').html(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'id_product': $('#prod_select').val(), 'id_design': $('#des_select').val(), 'id_sub_design': $('#sub_des_select').val(), 'id_weight': $('#wt_select').val(), 'id_karigar': $('#karigar').val() },

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			var oTable = $('#stock_sales_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#stock_sales_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"columnDefs": [

						{

							targets: [4, 5, 6, 7, 8],

							className: 'dt-body-right'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', '10px');

							},

						},

						{

							extend: 'colvis',

							collectionLayout: 'fixed columns',

							collectionTitle: 'Column visibility control'

						},

						{

							extend: 'excel',

							footer: true,

							title: "PURCHASE IMPORT",

						}

					],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "product_name" },

						{ "mDataProp": "design_name" },

						{ "mDataProp": "sub_design_name" },

						{ "mDataProp": "weight_description" },

						{ "mDataProp": "sales_pcs" },

						{ "mDataProp": "sales_gwt" },

						{ "mDataProp": "age" },

						{ "mDataProp": "min_pcs" },

						{ "mDataProp": "max_pcs" },

					],

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

$('#staff_incentive_search').on('click', function () {

	get_staff_incentive_report();

});

function get_staff_incentive_report() {

	var company_name = $('#company_name').val();

	var from_date = $("#rpt_payments1").html();

	var to_date = $("#rpt_payments2").html();

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "Staff Incentive Report";

	var optional = '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/staff_incentive_report/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'from_date': $("#rpt_payments1").html(), 'to_date': $("#rpt_payments2").html(), 'id_branch': $('#branch_select').val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			var oTable = $('#emp_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#emp_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					//"order": [[ 0, "ASC" ]],

					"columnDefs": [

						{

							targets: [8],

							className: 'dt-body-right'

						}

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', '10px');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: "Staff Incentive Report",

						}

					],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "id_employee" },

						{ "mDataProp": "emp_name" },

						{ "mDataProp": "emp_code" },

						{ "mDataProp": "branch_name" },

						{

							"mDataProp": function (row, type, val, meta) {

								var url = base_url + 'index.php/admin_ret_reports/staff_incentive_report/detailed/' + row.id_employee + '/' + $("#rpt_payments1").html() + '/' + $("#rpt_payments2").html() + '/' + '1';

								return '<a href=' + url + ' target="_blank">' + row.tot_acc_joined + '</a>';

							},

						},

						{ "mDataProp": "sch_join_amt" },

						{

							"mDataProp": function (row, type, val, meta) {

								var url = base_url + 'index.php/admin_ret_reports/staff_incentive_report/detailed/' + row.id_employee + '/' + $("#rpt_payments1").html() + '/' + $("#rpt_payments2").html() + '/' + '2';

								return '<a href=' + url + ' target="_blank">' + row.total_acc_closed + '</a>';

							},

						},

						{ "mDataProp": "closing_benefit_amt" },

						{

							"mDataProp": function (row, type, val, meta) {

								var total_amount = row.total_amount;

								return money_format_india(total_amount);

							}

						},

					],

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function get_staff_incentive_detailed_report() {

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/staff_incentive_report/account_details?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'id_employee': ctrl_page[3], 'from_date': ctrl_page[4], 'to_date': ctrl_page[5], 'type': ctrl_page[6] }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data;

			var oTable = $('#emp_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#emp_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					//"order": [[ 0, "ASC" ]],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: "",

							messageTop: 'Above Two Lakhs Report',

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: "Above Two Lakhs Report",

						}

					],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "id_scheme_account" },

						{ "mDataProp": "cus_name" },

						{ "mDataProp": "mobile" },

						{ "mDataProp": "acc_num" },

						{ "mDataProp": "paid_installments" },

						{ "mDataProp": "start_date" },

						{ "mDataProp": "closing_date" },

						{ "mDataProp": "closing_balance" },

						{ "mDataProp": "clsoing_benefit" },

						{ "mDataProp": "emp_incentive_amt" },

					],

					"footerCallback": function (row, data, start, end, display) {

						if (data.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								total_amount = api

									.column(9)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(9).footer()).html(parseFloat(total_amount).toFixed(2));

							}

						} else {

							var api = this.api(), data;

							$(api.column(8).footer()).html('');

						}

					}

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

$('#karigar_metal_issue').on('click', function () {

	get_karigar_metal_issue_itemwise();

});

function get_karigar_metal_issue_itemwise() {

	var company_name = $('#company_name').val();

	var from_date = $('#rpt_from_date').html();

	var to_date = $('#rpt_to_date').html();

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "Karigar Metal Issue / Receipt Report ";

	var product = $('#product').val() != '' && $('#product').val() != undefined ? $('#product').val() + " - " : '';

	var category = $('#category option:selected').val() != '' && $('#category option:selected').val() != undefined ? $('#category option:selected').html() + " - " : '';

	var optional = '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/karigar_metal_issue/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'from_date': $('#rpt_from_date').html(), 'to_date': $('#rpt_to_date').html(), 'id_karigar': $('#karigar').val(), 'id_metal': $('#metal').val(), 'id_category': $('#category').val(), 'id_product': $('#prod_select').val(), 'report_type': $('#report_type').val(), 'bill_type': $('#bill_type').val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			$("#karigar_metal_issue_list > tbody > tr").remove();

			$('#karigar_metal_issue_list').dataTable().fnClearTable();

			$('#karigar_metal_issue_list').dataTable().fnDestroy();

			var list = data.list;

			var trHTML = '';

			if (list != null) {

				var sub_metal_issue_wt = 0;

				var sub_metal_issue_dia_wt = 0;

				var sub_metal_pure_wt = 0;

				var tot_metal_weight = 0;

				var tot_metal_dia_weight = 0;

				var tot_metal_pur_weight = 0;

				var sno = 1;

				$.each(list, function (idx, item) {

					// if($('#report_type').val() == 1)

					// {

					// trHTML += '<tr style="font-weight:bold;">'

					//     + '<td style="font-weight:bold;text-align:left;">' + idx + '</td>'

					// 	+ '<td></td>'

					// 	+ '<td></td>'

					// 	+ '<td></td>'

					// 	+ '<td></td>'

					// 	+ '<td></td>'

					// 	+ '<td></td>'

					// 	+ '<td></td>'

					// 	+ '<td></td>'

					// 	+ '<td></td>'

					// 	+ '<td></td>'

					// 	+ '<td></td>'

					//     + '<td></td>'

					// 	+ '<td></td>'

					// '</tr>';

					// }

					$.each(item, function (key, val) {

						sub_metal_issue_wt += (val.stone_type != 2 ? parseFloat(val.issue_metal_wt) : 0);

						sub_metal_issue_dia_wt += (val.stone_type == 2 ? parseFloat(val.issue_metal_wt) : 0);

						sub_metal_pure_wt += parseFloat(val.issue_metal_pur_wt)

						var pur_url = base_url + 'index.php/admin_ret_purchase/purchase/job_receipt/' + val.po_id;

						trHTML += '<tr>'

							+ '<td>' + (sno++) + '</td>'

							+ '<td><a href=' + pur_url + ' target="_blank">' + (val.po_no != '' ? val.po_no : '-') + '</a></td>'

							+ '<td>' + val.po_date + '</td>'

							+ '<td>' + val.metal_issue_date + '</td>'

							+ '<td>' + val.met_issue_ref_id + '</td>'

							+ '<td>' + val.bt_number + '</td>'

							+ '<td>' + val.karigar_name + '</td>'

							+ '<td>' + val.metal_name + '</td>'

							+ '<td>' + val.category_name + '</td>'

							+ '<td>' + val.product_name + '</td>'

							+ '<td>' + (val.stone_type != 2 ? money_format_india(val.issue_metal_wt) : 0.000) + '</td>'

							+ '<td>' + (val.stone_type != 2 ? money_format_india(val.issue_metal_wt) : 0.000) + '</td>'

							+ '<td>' + (val.stone_type == 2 ? money_format_india(val.issue_metal_wt) : 0.000) + '</td>'

							+ '<td>' + money_format_india(val.issue_metal_pur_wt) + '</td>'

							+ '<td> ' + val.issue_uom + '</td>'

							+ '<td>' + val.emp_name + '</td>'

							+ '<td>' + val.issue_from + '</td>'

							+ '<td>' + val.remark + '</td>'

						'</tr>'

					});

					tot_metal_weight += parseFloat(sub_metal_issue_wt);

					tot_metal_dia_weight += parseFloat(sub_metal_issue_dia_wt);

					tot_metal_pur_weight += parseFloat(sub_metal_pure_wt);

					if ($('#report_type').val() == 1) {

						trHTML += '<tr style="color:red">'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<th class="sales">GRAND TOTAL</strong></td>'

							+ '<th><strong>' + money_format_india((sub_metal_issue_wt).toFixed(3)) + '</strong></th>'

							+ '<th><strong>' + money_format_india((sub_metal_issue_wt).toFixed(3)) + '</strong></th>'

							+ '<th><strong>' + money_format_india((sub_metal_issue_dia_wt).toFixed(3)) + '</strong></th>'

							+ '<th><strong>' + money_format_india((sub_metal_pure_wt).toFixed(3)) + '</strong></th>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

						'</tr>';

					}

					sub_metal_issue_wt = 0

					sub_metal_issue_dia_wt = 0

					sub_metal_pure_wt = 0

				});

				trHTML += '<tr style="color:blue">'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<th class="sales">GRAND TOTAL</strong></th>'

					+ '<th class="sales">' + money_format_india((tot_metal_weight).toFixed(3)) + '</strong></th>'

					+ '<th class="sales">' + money_format_india((tot_metal_weight).toFixed(3)) + '</strong></th>'

					+ '<th class="sales">' + money_format_india((tot_metal_dia_weight).toFixed(3)) + '</strong></th>'

					+ '<th class="sales">' + money_format_india((tot_metal_pur_weight).toFixed(3)) + '</strong></th>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

				'</tr>';

			}

			$('#karigar_metal_issue_list > tbody').html(trHTML);

			// Check and initialise datatable

			if (!$.fn.DataTable.isDataTable('#karigar_metal_issue_list')) {

				oTable = $('#karigar_metal_issue_list').dataTable({

					"bSort": false,

					"bInfo": true,

					"scrollX": '100%',

					"dom": 'lBfrtip',

					"paging": false,

					"columnDefs": [

						{

							targets: [10, 11, 12, 13],

							className: 'dt-body-right'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

							exportOptions: {

								columns: ':visible',

								stripHtml: false

							}

						},

						{

							extend: 'colvis',

							collectionLayout: 'fixed columns',

							collectionTitle: 'Column visibility control'

						},

						{

							extend: 'excel',

							footer: true,

							exportOptions: {

								columns: ':visible',

								stripHtml: false

							}

						}

					],

				});

			}

			$("div.overlay").css("display", "none");

		},

	})

}

function fnFormatRowMetalDetails(oTable, nTr) {

	var oData = oTable.fnGetData(nTr);

	var rowDetail = '';

	var tot_row = 0;

	var prodTable =

		'<div class="innerDetails">' +

		'<table class="table table-responsive table-bordered text-center table-sm">' +

		'<tr class="bg-teal">' +

		'<th>S.No</th>' +

		'<th>Category Name</th>' +

		'<th>Metal </th>' +

		'<th>Product </th>' +

		'<th>Weight</th>' +

		'</tr>';

	var issue_details = oData.issue_detilas;

	console.log(issue_details);

	tot_row = issue_details.length;

	$.each(issue_details, function (idx, val) {

		console.log(val);

		prodTable +=

			'<tr class="prod_det_btn">' +

			'<td>' + parseFloat(idx + 1) + '</td>' +

			'<td>' + val.category_name + '</td>' +

			'<td>' + val.metal + '</td>' +

			'<td>' + val.product_name + '</td>' +

			'<td>' + val.issue_metal_pur_wt + '</td>' +

			'</tr>';

	});

	rowDetail = prodTable + '</table></div>';

	return rowDetail;

}

$('#customer_detail_search').click(function (event) {

	get_customer_details_report();

});

function get_customer_details_report() {

	var company_name = $('#company_name').val();

	var from_date = $("#rpt_cus1").html();

	var to_date = $("#rpt_cus2").html();

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "CUSTOMER DETAILS REPORT";

	var optional = '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/get_customer_details_report?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'from_date': $("#rpt_cus1").html(), 'to_date': $("#rpt_cus2").html(), 'id_zone': $('#select_zone').val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'id_village': $('#select_village').val(), 'is_vip': $('#vip_fil').val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data;

			var customerTable = $('#customer_details tbody');

			customerTable.empty(); // Clear existing rows

			if (list != null && list.length > 0) {

				for (var i = 0; i < list.length; i++) {

					var rowData = list[i];

					var row = '<tr>' +

						'<td>' + rowData.id_customer + '</td>' +

						'<td>' + rowData.cus_name + '</td>' +

						'<td>' + rowData.mobile + '</td>' +

						'<td>' + rowData.email + '</td>' +

						'<td style="width:200px;">' + rowData.address1 + '</td>' +

						'<td>' + rowData.address2 + '</td>' +

						'<td>' + rowData.address3 + '</td>' +

						'<td>' + rowData.village + '</td>' +

						'<td>' + rowData.city_name + '</td>' +

						'<td>' + rowData.state_name + '</td>' +

						'<td>' + rowData.pan_no + '</td>' +

						'<td>' + rowData.aadhar + '</td>' +

						'<td>' + rowData.date_of_birth + '</td>' +

						'<td>' + rowData.pincode + '</td>' +

						'<td>' + rowData.wedding_date + '</td>' +

						'<td>' + rowData.vip + '</td>' +

						'<td>' + rowData.vip_marked + '</td>' +

						'</tr>';

					customerTable.append(row);

				}

				// Initialize DataTable after appending rows

				var oTable = $('#customer_details').DataTable({

					dom: 'Bfrtip',

					buttons: [

						'excel'

					]

				});

			}

			$('.overlay').css('display', 'none');

		}

	});

}

///DAY CLOSING REPORT

$('#day_close_report_search').on('click', function () {

	day_closing_report();

});

function day_closing_report() {

	var company_name = $('#company_name').val();

	var from_date = '';

	var to_date = '';

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "Day Close Report";

	var optional = "Day Close : " + $('.datePicker').val() + ' - ';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/day_closing_report/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'stock_date': $('.datePicker').val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()) }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			$("div.overlay").css("display", "none");

			var oTable = $('#day_close_report').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#day_close_report').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"bSort": true,

					"dom": 'lBfrtip',

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: "Account Stock Details",

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: "Account Stock Details",

						}

					],

					"order": [[0, "asc"]],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "branch_name" },

						{ "mDataProp": "stockType" },

						{ "mDataProp": "records" },

						{

							"mDataProp": function (row, type, val, meta) {

								if (row.records == 0) {

									return '<button type="button"  class="btn btn-primary" style="padding: 4px;" onclick ="update_stock_details(' + row.stock_type + ',' + row.id_branch + ');" >Update Stock</button>';

								}

								else {

									return '-';

								}

							}

						},

					],

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function update_stock_details(stock_type, id_branch) {

	$('#confirm-add').modal('toggle');

	$('#stock_branch').val(id_branch);

	$('#stock_type').val(stock_type);

}

$('#update_stock').on('click', function () {

	$("div.overlay").css("display", "block");

	if ($('#stock_type').val() == 1) {

		stock_url = base_url + 'index.php/admin_ret_services/stock_balance/manual/' + $('#stock_branch').val() + '/' + date_format($('.datePicker').val())

	} else {

		stock_url = base_url + 'index.php/admin_ret_services/stock_balance/manual/' + $('#stock_branch').val() + '/' + date_format($('.datePicker').val())

	}

	$.ajax({

		type: 'POST',

		url: stock_url,

		dataType: 'json',

		success: function (data) {

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

		}

	});

});

///DAY CLOSING REPORT

function getdaytransactions_details() {

	var branch_name = $('#branch_filter').find(':selected').text();

	var company_code = $('#company_code').val();

	var company_address1 = $('#company_address1').val();

	var company_address2 = $('#company_address2').val();

	var company_city = $('#company_city').val();

	var pincode = $('#pincode').val();

	var company_email = $('#company_email').val();

	var company_gst_number = $('#company_gst_number').val();

	var phone = $('#phone').val();

	var report_type = $('#mode_select').find(':selected').text();

	var today = new Date();

	var dispdate = today.getFullYear() + '-' + (today.getMonth() + 1) + '-' + today.getDate();

	var disptime = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();

	var title = "<div style='text-align: center;'><b><span style='font-size:12pt;'>" + company_code + "</span></b></br>"

		+ "<span style='font-size:11pt;'>" + company_address1 + "</span></br>"

		+ "<span style='font-size:11pt;'>" + company_address2 + company_city + "-" + pincode + "</span></br>"

		+ "<span style='font-size:11pt;'>GSTIN:" + company_gst_number + ", EMAIL:" + company_email + "</span></br>"

		+ "<span style='font-size:11pt;'>Contact :" + phone + "</span></br>"

		+ "<span style=font-size:12pt;>&nbsp;&nbsp;Day Transactions Report - " + report_type + " - " + branch_name + " &nbsp;From&nbsp;:&nbsp;" + $('#rpt_from_date').html() + " &nbsp;&nbsp;- to " + $('#rpt_to_date').html() + " &nbsp;&nbsp; " + dispdate + " " + disptime + " - " + $('.hidden-xs').html() + "</span></div>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".summery_description").html(report_type + " - " + branch_name + " &nbsp;From&nbsp;:&nbsp;" + $('#rpt_from_date').html() + " &nbsp;&nbsp;- to " + $('#rpt_to_date').html() + " &nbsp;&nbsp; (" + dispdate + " " + disptime + " ) ");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/daytransactions/ajax?nocache=" + my_Date.getUTCSeconds(),

		dataType: "JSON",

		data: { 'from_date': $('#rpt_from_date').html(), 'to_date': $('#rpt_to_date').html(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'mode': $('#mode_select').val() },

		type: "POST",

		success: function (data) {

			var list = data.list;

			$("div.overlay").css("display", "none");

			var oTable = $('#day_transactiton_list').DataTable();

			oTable.clear().draw();

			if (data.paymodes != undefined) {

				$('.total_cash_receipts').html(data.paymodes.receipts.total_cash);

				$('.total_card_receipts').html(data.paymodes.receipts.total_card);

				$('.total_cashfree_receipts').html(data.paymodes.receipts.total_cashfree);

				$('.total_cheque_receipts').html(data.paymodes.receipts.total_cheque);

				$('.total_nb_receipts').html(data.paymodes.receipts.total_nb);

				$('.total_paytm_receipts').html(data.paymodes.receipts.total_paytm);

				$('.total_amt_receipts').html(data.paymodes.receipts.total_receipts);

				$('.total_cash_paymet').html(data.paymodes.payments.total_cash);

				$('.total_card_paymet').html(data.paymodes.payments.total_card);

				$('.total_cashfree_paymet').html(data.paymodes.payments.total_cashfree);

				$('.total_cheque_paymet').html(data.paymodes.payments.total_cheque);

				$('.total_nb_paymet').html(data.paymodes.payments.total_nb);

				$('.total_paytm_paymet').html(data.paymodes.payments.total_paytm);

				$('.total_amt_payments').html(data.paymodes.payments.total_payments);

			}

			if (list != null && list.length > 0) {

				oTable = $('#day_transactiton_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"bSort": true,

					"dom": 'lBfrtip',

					"columnDefs": [

						{

							targets: [4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 26, 28, 29, 30],

							className: 'dt-body-right'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: company_code + ' - ' + branch_name + ' - Transations' + dispdate + " " + disptime,

						}

					],

					"order": [[0, "asc"]],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "voucher_no" },

						{ "mDataProp": "billdate" },

						{ "mDataProp": "firstname" },

						{ "mDataProp": "mobile" },

						{ "mDataProp": "grsswt", "mRender": function (data, type, full) { return money_format_india(parseFloat(data).toFixed(3)); } },

						{ "mDataProp": "netwt", "mRender": function (data, type, full) { return money_format_india(parseFloat(data).toFixed(3)); } },

						{ "mDataProp": "diawt", "mRender": function (data, type, full) { return money_format_india(parseFloat(data).toFixed(3)); } },

						{ "mDataProp": "total_item_cost", "mRender": function (data, type, full) { return money_format_india(parseFloat(data).toFixed(2)); } },

						{ "mDataProp": "total_sgst", "mRender": function (data, type, full) { return money_format_india(parseFloat(data).toFixed(2)); } },

						{ "mDataProp": "total_cgst", "mRender": function (data, type, full) { return money_format_india(parseFloat(data).toFixed(2)); } },

						{ "mDataProp": "total_igst", "mRender": function (data, type, full) { return money_format_india(parseFloat(data).toFixed(2)); } },

						{ "mDataProp": "total_tax", "mRender": function (data, type, full) { return money_format_india(parseFloat(data).toFixed(2)); } },

						{ "mDataProp": "tot_bill_amount", "mRender": function (data, type, full) { return money_format_india(parseFloat(data).toFixed(2)); } },

						{ "mDataProp": "total_cash", "mRender": function (data, type, full) { return money_format_india(parseFloat(data).toFixed(2)); } },

						{ "mDataProp": "total_card", "mRender": function (data, type, full) { return money_format_india(parseFloat(data).toFixed(2)); } },

						{ "mDataProp": "total_paytm", "mRender": function (data, type, full) { return money_format_india(parseFloat(data).toFixed(2)); } },

						{ "mDataProp": "total_cheque", "mRender": function (data, type, full) { return money_format_india(parseFloat(data).toFixed(2)); } },

						{ "mDataProp": "total_nb", "mRender": function (data, type, full) { return money_format_india(parseFloat(data).toFixed(2)); } },

						{ "mDataProp": "total_cashfree", "mRender": function (data, type, full) { return money_format_india(parseFloat(data).toFixed(2)); } },

						{ "mDataProp": "total_chit_utlize", "mRender": function (data, type, full) { return money_format_india(parseFloat(data).toFixed(2)); } },

						{ "mDataProp": "dueamount", "mRender": function (data, type, full) { return money_format_india(parseFloat(data).toFixed(2)); } },

						{ "mDataProp": "tot_discount", "mRender": function (data, type, full) { return money_format_india(parseFloat(data).toFixed(2)); } },

						{ "mDataProp": "handling_charges", "mRender": function (data, type, full) { return money_format_india(parseFloat(data).toFixed(2)); } },

						{ "mDataProp": "total_order_adv_adj", "mRender": function (data, type, full) { return money_format_india(parseFloat(data).toFixed(2)); } },

						{ "mDataProp": "total_adv_adj", "mRender": function (data, type, full) { return money_format_india(parseFloat(data).toFixed(2)); } },

						{ "mDataProp": "pur_ref_no" },

						{ "mDataProp": "total_old_metal_cost", "mRender": function (data, type, full) { return money_format_india(parseFloat(data).toFixed(2)); } },

						{ "mDataProp": "s_ret_refno" },

						{ "mDataProp": "ret_bill_amt", "mRender": function (data, type, full) { return money_format_india(parseFloat(data).toFixed(2)); } },

						{ "mDataProp": "total_gift_utlize", "mRender": function (data, type, full) { return money_format_india(parseFloat(data).toFixed(2)); } },

						{ "mDataProp": "roundoff", "mRender": function (data, type, full) { return money_format_india(parseFloat(data).toFixed(2)); } },

					],

					"footerCallback": function (row, data, start, end, display) {

						if (data.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								grswt = api

									.column(4, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								// $(api.column(4).footer()).html(parseFloat(grswt).toFixed(3));

								net_wgt = api

									.column(5, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								// $(api.column(5).footer()).html(parseFloat(net_wgt).toFixed(3));

								dia_wgt = api

									.column(6, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								// $(api.column(6).footer()).html(parseFloat(dia_wgt).toFixed(3));

								amt = api

									.column(7, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								// $(api.column(7).footer()).html(parseFloat(amt).toFixed(2));

								sgst = api

									.column(8, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								// $(api.column(8).footer()).html(parseFloat(sgst).toFixed(2));

								cgst = api

									.column(9, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								// $(api.column(9).footer()).html(parseFloat(cgst).toFixed(2));

								igst = api

									.column(10, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								// $(api.column(10).footer()).html(parseFloat(igst).toFixed(2));

								gst = api

									.column(11, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								// $(api.column(11).footer()).html(parseFloat(gst).toFixed(2));

								total = api

									.column(12, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								// $(api.column(12).footer()).html(parseFloat(total).toFixed(2));

								cash = api

									.column(13, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								// $(api.column(13).footer()).html(parseFloat(cash).toFixed(2));

								card = api

									.column(14, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								// $(api.column(14).footer()).html(parseFloat(card).toFixed(2));

								paytm = api

									.column(15, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								// $(api.column(15).footer()).html(parseFloat(paytm).toFixed(2));

								cheque = api

									.column(16, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								// $(api.column(16).footer()).html(parseFloat(cheque).toFixed(2));

								nb = api

									.column(17, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								// $(api.column(17).footer()).html(parseFloat(nb).toFixed(2));

								cashfree = api

									.column(18, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								// $(api.column(18).footer()).html(parseFloat(cashfree).toFixed(2));

								chituti = api

									.column(19, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								// $(api.column(19).footer()).html(parseFloat(chituti).toFixed(2));

								due = api

									.column(20, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								// $(api.column(20).footer()).html(parseFloat(due).toFixed(2));

								discount = api

									.column(21, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								// $(api.column(21).footer()).html(parseFloat(discount).toFixed(2));

								handling = api

									.column(22, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								// $(api.column(22).footer()).html(parseFloat(handling).toFixed(2));

								orderadv = api

									.column(23, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								// $(api.column(23).footer()).html(parseFloat(orderadv).toFixed(2));

								advadj = api

									.column(24, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								// $(api.column(24).footer()).html(parseFloat(advadj).toFixed(2));

								purchase = api

									.column(26, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								// $(api.column(26).footer()).html(parseFloat(purchase).toFixed(2));

								salesreturn = api

									.column(28, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								// $(api.column(28).footer()).html(parseFloat(salesreturn).toFixed(2));

								totgiftut = api

									.column(29, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								// $(api.column(29).footer()).html(parseFloat(totgiftut).toFixed(2));

								roundoff = api

									.column(30, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								// $(api.column(30).footer()).html(parseFloat(roundoff).toFixed(2));

								$(api.column(4).footer()).html(money_format_india(parseFloat(grswt).toFixed(3)));

								$(api.column(5).footer()).html(money_format_india(parseFloat(net_wgt).toFixed(3)));

								$(api.column(6).footer()).html(money_format_india(parseFloat(dia_wgt).toFixed(3)));

								$(api.column(7).footer()).html(money_format_india(parseFloat(amt).toFixed(2)));

								$(api.column(8).footer()).html(money_format_india(parseFloat(sgst).toFixed(2)));

								$(api.column(9).footer()).html(money_format_india(parseFloat(cgst).toFixed(2)));

								$(api.column(10).footer()).html(money_format_india(parseFloat(igst).toFixed(2)));

								$(api.column(11).footer()).html(money_format_india(parseFloat(gst).toFixed(2)));

								$(api.column(12).footer()).html(money_format_india(parseFloat(total).toFixed(2)));

								$(api.column(13).footer()).html(money_format_india(parseFloat(cash).toFixed(2)));

								$(api.column(14).footer()).html(money_format_india(parseFloat(card).toFixed(2)));

								$(api.column(15).footer()).html(money_format_india(parseFloat(paytm).toFixed(2)));

								$(api.column(16).footer()).html(money_format_india(parseFloat(cheque).toFixed(2)));

								$(api.column(17).footer()).html(money_format_india(parseFloat(nb).toFixed(2)));

								$(api.column(18).footer()).html(money_format_india(parseFloat(cashfree).toFixed(2)));

								$(api.column(19).footer()).html(money_format_india(parseFloat(chituti).toFixed(2)));

								$(api.column(20).footer()).html(money_format_india(parseFloat(due).toFixed(2)));

								$(api.column(21).footer()).html(money_format_india(parseFloat(discount).toFixed(2)));

								$(api.column(22).footer()).html(money_format_india(parseFloat(handling).toFixed(2)));

								$(api.column(23).footer()).html(money_format_india(parseFloat(orderadv).toFixed(2)));

								$(api.column(24).footer()).html(money_format_india(parseFloat(advadj).toFixed(2)));

								$(api.column(26).footer()).html(money_format_india(parseFloat(purchase).toFixed(2)));

								$(api.column(28).footer()).html(money_format_india(parseFloat(salesreturn).toFixed(2)));

								$(api.column(29).footer()).html(money_format_india(parseFloat(totgiftut).toFixed(2)));

								$(api.column(30).footer()).html(money_format_india(parseFloat(roundoff).toFixed(2)));

							}

						} else {

							var api = this.api(), data;

							//$(api.column(30).footer()).html('');

						}

					}

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function get_category_stock_report() {

	$("div.overlay").css("display", "block");

	var dt_range = ($("#dt_range").val()).split('-');

	var company_name = $('#company_name').val();

	var company_code = $('#company_code').val();

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $('#branch_select option:selected').toArray().map(item => item.text).join());

	var company_code = $('#company_code').val();

	var company_address1 = $('#company_address1').val();

	var company_address2 = $('#company_address2').val();

	var company_city = $('#company_city').val();

	var pincode = $('#pincode').val();

	var company_email = $('#company_email').val();

	var company_gst_number = $('#company_gst_number').val();

	var phone = $('#phone').val();

	var title = "<div style='text-align: center;'><b><span style='font-size:12pt;'>" + company_code + "</span></b></br>"

		+ "<span style='font-size:11pt;'>" + company_address1 + "</span></br>"

		+ "<span style='font-size:11pt;'>" + company_address2 + company_city + "-" + pincode + "</span></br>"

		+ "<span style='font-size:11pt;'>GSTIN:" + company_gst_number + ", EMAIL:" + company_email + "</span></br>"

		+ "<span style='font-size:11pt;'>Contact :" + phone + "</span></br>"

		+ "<span style=font-size:12pt;>Categorywise Stock Report - " + branch_name + " &nbsp;&nbsp; From: " + dt_range[0] + " To:" + dt_range[1] + " - " + $('.hidden-xs').html() + "</span>";

	my_Date = new Date();

	var transitemtype = $('#selecttransitemtypes').val();

	var selectedcat = 0;

	if (transitemtype == '0') {

		selectedcat = 0;

	} else if (transitemtype == '5') {

		selectedcat = $('#oldcategory').val();

	} else {

		selectedcat = $('#category').val();

	}

	//($('#transitemtype').val()!='' && $('#transitemtype').val()!=undefined && $('#transitemtype').val() != null) ? $('#transitemtype').val(): 0

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/categorywise_stock_report/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({

			'dt_range': $("#dt_range").val(),

			'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()),

			'id_category': selectedcat,

			'transitemtype': $('#selecttransitemtypes').val()

		}),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			console.log(data);

			var list = data.list;

			print_stock_issue = list;

			console.log(data);

			var oTable = $('#categorywise_stock_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#categorywise_stock_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"order": [[0, "asc"]],

					"lengthMenu": [[-1, 25, 50, 100, 250], ["All", 25, 50, 100, 250]],

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"columnDefs": [

						{

							targets: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15],

							className: 'dt-body-right'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							stripHtml: false,

							title: "",

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: "Categorywise Stock Report - " + branch_name + " From: " + dt_range[0] + " To:" + dt_range[1],

						}

					],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "category_name" },

						{

							"mDataProp": function (row, type, val, meta) {

								var op_blc_pcs = row.op_blc_pcs;

								return money_format_india(op_blc_pcs);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var op_blc_gwt = row.op_blc_gwt;

								return money_format_india(op_blc_gwt);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var op_blc_nwt = row.op_blc_nwt;

								return money_format_india(op_blc_nwt);

							}

						},

						{ "mDataProp": "op_blc_value" },

						{

							"mDataProp": function (row, type, val, meta) {

								var inw_pcs = row.inw_pcs;

								return money_format_india(inw_pcs);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var inw_gwt = row.inw_gwt;

								return money_format_india(inw_gwt);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var inw_nwt = row.inw_nwt;

								return money_format_india(inw_nwt);

							}

						},

						{ "mDataProp": "inw_blc_value" },

						{

							"mDataProp": function (row, type, val, meta) {

								var out_piece = row.out_piece;

								return money_format_india(out_piece);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var out_gwt = row.out_gwt;

								return money_format_india(out_gwt);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var out_netwt = row.out_netwt;

								return money_format_india(out_netwt);

							}

						},

						{ "mDataProp": "out_blc_value" },

						{

							"mDataProp": function (row, type, val, meta) {

								var closing_pcs = row.closing_pcs;

								return money_format_india(closing_pcs);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var closing_gwt = row.closing_gwt;

								return money_format_india(closing_gwt);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var closing_nwt = row.closing_nwt;

								return money_format_india(closing_nwt);

							}

						},

						{ "mDataProp": "closing_blc_value" },

					],

					"footerCallback": function (row, data, start, end, display) {

						if (data.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								opcs = api

									.column(1, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(1).footer()).html(money_format_india(parseFloat(opcs).toFixed(0)));

								ogwt = api

									.column(2, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(2).footer()).html(money_format_india(parseFloat(ogwt).toFixed(3)));

								onwt = api

									.column(3, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(3).footer()).html(money_format_india(parseFloat(onwt).toFixed(3)));

								/*opvalue = api

								.column(4, {search:'applied'})

								.data()

								.reduce( function (a, b) {

									return intVal(a) + intVal(b);

								}, 0 );

								$(api.column(4).footer()).html(money_format_india(parseFloat(opvalue).toFixed(2)));*/

								inpcs = api

									.column(5, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(5).footer()).html(money_format_india(parseFloat(inpcs).toFixed(0)));

								ingwt = api

									.column(6, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(6).footer()).html(money_format_india(parseFloat(ingwt).toFixed(3)));

								innwt = api

									.column(7, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(7).footer()).html(money_format_india(parseFloat(innwt).toFixed(3)));

								/*invalue = api

								.column(8, {search:'applied'})

								.data()

								.reduce( function (a, b) {

									return intVal(a) + intVal(b);

								}, 0 );

								$(api.column(8).footer()).html(money_format_india(parseFloat(opvalue).toFixed(2)));*/

								outpcs = api

									.column(9, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(9).footer()).html(money_format_india(parseFloat(outpcs).toFixed(0)));

								outgwt = api

									.column(10, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(10).footer()).html(money_format_india(parseFloat(outgwt).toFixed(3)));

								outnwt = api

									.column(11, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(11).footer()).html(money_format_india(parseFloat(outnwt).toFixed(3)));

								/*outvalue = api

								.column(12, {search:'applied'})

								.data()

								.reduce( function (a, b) {

									return intVal(a) + intVal(b);

								}, 0 );

								$(api.column(12).footer()).html(money_format_india(parseFloat(outvalue).toFixed(2)));*/

								clpcs = api

									.column(13, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(13).footer()).html(money_format_india(parseFloat(clpcs).toFixed(0)));

								clgwt = api

									.column(14, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(14).footer()).html(money_format_india(parseFloat(clgwt).toFixed(3)));

								clnwt = api

									.column(15, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(15).footer()).html(money_format_india(parseFloat(clnwt).toFixed(3)));

								/*clvalue = api

								.column(16, {search:'applied'})

								.data()

								.reduce( function (a, b) {

									return intVal(a) + intVal(b);

								}, 0 );

								$(api.column(16).footer()).html(parseFloat(clvalue).toFixed(2));*/

							}

						} else {

							var api = this.api(), data;

							$(api.column(1).footer()).html('');

						}

					}

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

// function getDisplayDateTime() {

// 	var today = new Date();

// 	var dispdate = today.getDate() + '-' + (today.getMonth() + 1) + '-' + today.getFullYear();

// 	var disptime = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();

// 	return dispdate + " " + disptime;

// }

$('#bank_deposit_search').on('click', function () {

	get_bnk_deposits();

});

function get_bnk_deposits() {

	my_Date = new Date();

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var company_name = $('#company_name').val();

	let dt_range = ($("#dt_range").val()).split('-');

	let from_date = date_format(dt_range[0].trim());

	let to_date = date_format(dt_range[1].trim());

	let type = $("#cash_type").val();

	// let branch =  $("#dep_branch").val();

	let branch = ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#dep_branch").val());

	var title = "<b><span style='font-size:15pt;'>" + company_name + "</span> - </b><span style=font-size:13pt;>Bank Deposit Report, From&nbsp;:&nbsp;" + from_date + " &nbsp;&nbsp;To Date&nbsp;:&nbsp;" + to_date + "</span>";

	$("div.overlay").css("display", "block");

	var oTable = $('#bank_deposit_report').DataTable();

	$.ajax({

		type: 'POST',

		url: base_url + 'index.php/admin_ret_reports/deposit_report/ajax?nocache=' + my_Date.getUTCSeconds(),

		dataType: 'json',

		data: ({ 'from_date': from_date, 'to_date': to_date, 'type': type, 'branch': branch }),

		success: function (data) {

			$("#closing_amt").html(data.closing);

			var access = data.access;

			console.log(data);

			$('#total_count').text(data.deposits.length);

			if (access.add == '0') {

				$('#bank_deposit_report').attr('disabled', 'disabled');

			}

			oTable = $('#bank_deposit_report').dataTable({

				"bSort": false,

				"bDestroy": true,

				"bInfo": true,

				"scrollX": '100%',

				"paging": false,

				"dom": 'Bfrtip',

				"bAutoWidth": false,

				"responsive": true,

				"aaSorting": [[0, "asc"]],

				"buttons": [

					{

						extend: 'print',

						footer: true,

						title: '',

						messageTop: title,

						customize: function (win) {

							$(win.document.body).find('table')

								.addClass('compact');

							$(win.document.body).find('table')

								.addClass('compact')

								.css('font-size', '10px')

								.css('font-family', 'sans-serif');

							$(win.document.body).find('table tbody td:nth-child(4), table tbody td:nth-child(5), table tbody td:nth-child(6), table tbody td:nth-child(8)').

								css('text-align', 'right');

						},

						exportOptions: {

							columns: ':visible',

							stripHtml: false

						}

					},

					{

						extend: 'excel',

						footer: true,

						title: '',

					},

				],

				"aaData": data.deposits,

				"aoColumns": [

					{ "mDataProp": "deposited_date" },

					{ "mDataProp": "created_on" },

					{ "mDataProp": "dep_ref_id" },

					{ "mDataProp": "opening" },

					{ "mDataProp": "cash_inw" },

					{ "mDataProp": "dep_amount" },

					{ "mDataProp": "deposit_type" },

					{ "mDataProp": "closing" },

				],

				"footerCallback": function (row, data, start, end, display) {

					var api = this.api(), data;

					// Remove the formatting to get integer data for summation

					var intVal = function (i) {

						return typeof i === 'string' ?

							i.replace(/[\$,]/g, '') * 1 :

							typeof i === 'number' ?

								i : 0;

					};

					let inward_amt = api

						.column(4)

						.data()

						.reduce(function (a, b) {

							return intVal(a) + intVal(b);

						}, 0);

					let deposited_amt = api

						.column(5)

						.data()

						.reduce(function (a, b) {

							return intVal(a) + intVal(b);

						}, 0);

					$(api.column(4).footer()).html(parseFloat(inward_amt).toFixed(2));

					$(api.column(5).footer()).html(parseFloat(deposited_amt).toFixed(2));

				}

			});

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function getDepositBranch() {

	$('#dep_branch option').remove();

	$.ajax({

		type: 'GET',

		url: base_url + 'index.php/branch/branchname_list',

		dataType: 'json',

		success: function (data) {

			$.each(data.branch, function (key, item) {

				$("#dep_branch").append(

					$("<option></option>")

						.attr("value", item.id_branch)

						.text(item.name)

				);

			});

			get_bnk_deposits();

		}

	});

}

$('#rate_fixed_search').on('click', function () {

	get_rate_fixed_details();

});

function get_rate_fixed_details() {

	my_Date = new Date();

	var company_name = $('#company_name').val();

	var branch_name = "";

	let from_date = "";

	let to_date = "";

	var report_name = "Rate Fixed Report";

	var optional = $('#karigar option:selected').html() != '' && $('#karigar option:selected').html() != undefined ? $('#karigar option:selected').html() + " - " : '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	var oTable = $('#rate_fixed_list').DataTable();

	$.ajax({

		type: 'POST',

		url: base_url + 'index.php/admin_ret_reports/rate_fixed/ajax?nocache=' + my_Date.getUTCSeconds(),

		dataType: 'json',

		data: ({ 'id_karigar': $('#karigar').val(), 'from_date': $('#rpt_from_date').html(), 'to_date': $('#rpt_to_date').html(), 'id_metal': $('#metal').val() }),

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.list;

			$("#rate_fixed_list > tbody > tr").remove();

			$('#rate_fixed_list').dataTable().fnClearTable();

			$('#rate_fixed_list').dataTable().fnDestroy();

			if (list != null && list != '') {

				var trHTML = '';

				var tot_pur_wt = 0;

				var tot_rate_fix_wt = 0;

				var tot_rateFix_rate = 0;

				var tot_total_amt = 0;

				var tot_grn_pur_amt = 0;

				$.each(list, function (key, fixed_details) {

					var pur_wt = 0;

					var rateFix_wt = 0;

					var rateFix_rate = 0;

					var tot_amt = 0;

					var grn_pur_amt = 0;

					var grn_purchase_amt = 0;

					var balance_amount = 0;

					$.each(fixed_details, function (key, val) {

						pur_wt += parseFloat(val.tot_purchase_wt);

						rateFix_wt += parseFloat(val.rate_fix_wt);

						rateFix_rate += parseFloat(val.rate_fix_rate);

						tot_amt += parseFloat(val.fixed_amount);

						grn_pur_amt = fixed_details[0].grn_purchase_amt;

						trHTML += '<tr>' +

							'<td>' + val.grn_ref_no + '</td>' +

							'<td>' + val.grn_purchase_amt + '</td>' +

							'<td>' + val.po_ref_no + '</td>' +

							'<td>' + val.apprv_ref_no + '</td>' +

							'<td>' + val.grn_date + '</td>' +

							'<td>' + val.suppliername + '</td>' +

							'<td>' + val.metal + '</td>' +

							'<td>' + val.ratefixeddate + '</td>' +

							'<td>' + parseFloat(val.rate_fix_wt).toFixed(3) + '</td>' +

							'<td>' + parseFloat(val.rate_fix_rate).toFixed(2) + '</td>' +

							'<td>' + money_format_india(parseFloat(val.fixed_amount).toFixed(2)) + '</td>' +

							'<td></td>' +

							'</tr>';

					});

					tot_pur_wt += parseFloat(pur_wt);

					tot_rate_fix_wt += parseFloat(rateFix_wt);

					tot_rateFix_rate += parseFloat(rateFix_rate);

					tot_total_amt += parseFloat(tot_amt);

					tot_grn_pur_amt += parseFloat(grn_pur_amt);

					trHTML += '<tr style="font-weight:bold; color:red">' +

						'<td><strong>SUB TOTAL</strong></td>' +

						'<td>' + money_format_india(parseFloat(grn_pur_amt).toFixed(2)) + '</td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td><strong>' + parseFloat(rateFix_wt).toFixed(3) + '</strong></td>' +

						'<td><strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(tot_amt).toFixed(2)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(parseFloat(grn_pur_amt) - parseFloat(tot_amt)).toFixed(2)) + '</strong></td>' +

						'</tr>';

				});

				trHTML += '<tr style="font-weight:bold; color:blue">' +

					'<td><strong>GRAND TOTAL</strong></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_rate_fix_wt).toFixed(3)) + '</strong></td>' +

					'<td><strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_total_amt).toFixed(2)) + '</strong></td>' +

					'<td></td>' +

					'</tr>';

				$('#rate_fixed_list > tbody').html(trHTML);

				// Check and initialise datatable

				if (!$.fn.DataTable.isDataTable('#rate_fixed_list')) {

					oTable = $('#rate_fixed_list').dataTable({

						"bSort": false,

						"bDestroy": true,

						"bInfo": true,

						"scrollX": '100%',

						"paging": false,

						"dom": 'Bfrtip',

						"bAutoWidth": false,

						"responsive": true,

						"columnDefs": [

							{

								targets: [1, 8, 9, 10],

								className: 'dt-body-right'

							}

						],

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: '',

								messageTop: title,

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact');

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', '10px')

										.css('font-family', 'sans-serif');

								},

								exportOptions: {

									columns: ':visible',

									stripHtml: false

								}

							},

							{

								extend: 'excel',

								footer: true,

								title: 'Rate Fixed Report',

							},

							{

								extend: 'colvis',

								collectionLayout: 'fixed columns',

								collectionTitle: 'Column visibility control'

							},

						],

					});

				}

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

/*Rate Fixed Reports*/

/*Unfixing Report*/

$('#unfixing_search').on('click', function () {

	get_unfixing_details();

})

function get_unfixing_details() {

	my_Date = new Date();

	var company_name = $('#company_name').val();

	var branch_name = "";

	let from_date = "";

	let to_date = "";

	var report_name = "Unfixing Report";

	var category = $('#category option:selected').html() != '' && $('#category option:selected').html() != undefined ? $('#category option:selected').html() + " - " : '';

	var karigar = $('#karigar option:selected').html() != '' && $('#karigar option:selected').html() != undefined ? $('#karigar option:selected').html() + " - " : '';

	var optional = category + karigar;

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	var oTable = $('#unfixing_list').DataTable();

	$.ajax({

		type: 'POST',

		url: base_url + 'index.php/admin_ret_reports/unfixing_report/ajax?nocache=' + my_Date.getUTCSeconds(),

		dataType: 'json',

		data: ({ 'cat_id': $('#category').val(), 'id_karigar': $('#karigar').val(), 'metal': $('#metal').val(), 'pur_type': $('#purchase_type').val() }),

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.list;

			$("#unfixing_list > tbody > tr").remove();

			$('#unfixing_list').dataTable().fnClearTable();

			$('#unfixing_list').dataTable().fnDestroy();

			if (list != '') {

				var trHTML = '';

				var tot_grs_wt = 0;

				var tot_net_wt = 0;

				var tot_stn_wt = 0;

				var tot_pure_wt = 0;

				var tot_taxable_amount = 0;

				var tot_stnamount = 0;

				var tot_grn_item_gst_rate = 0;

				var tot_grn_item_cost = 0;

				var tot_balance_weight = 0;

				var tot_fixed_weight = 0;

				$.each(list, function (key, unfixing_det) {

					var grs_wt = 0;

					var net_wt = 0;

					var stn_wt = 0;

					var pure_wt = 0;

					var taxable_amount = 0;

					var stnamount = 0;

					var grn_item_gst_rate = 0;

					var grn_item_cost = 0;

					var tot_purchase_wt = 0;

					var ratefixwt = 0;

					var balance_weight = 0;

					var unfixblcwt = 0;

					var dispunfixblcwt = 0;

					var totUnFixWt = 0;

					var tot_return_weight = 0;

					$.each(unfixing_det, function (key, val) {

						grs_wt += isNaN(parseFloat(val.gross_wt)) ? 0 : parseFloat(val.gross_wt);

						net_wt += isNaN(parseFloat(val.net_wt)) ? 0 : parseFloat(val.net_wt);

						stn_wt += isNaN(parseFloat(val.stone_wt)) ? 0 : parseFloat(val.stone_wt);

						pure_wt += isNaN(parseFloat(val.pure_wt)) ? 0 : parseFloat(val.pure_wt);

						taxable_amount += isNaN(parseFloat(val.taxable_amount)) ? 0 : parseFloat(val.taxable_amount);

						stnamount += isNaN(parseFloat(val.stnamount)) ? 0 : parseFloat(val.stnamount);

						grn_item_gst_rate += isNaN(parseFloat(val.grn_item_gst_rate)) ? 0 : parseFloat(val.grn_item_gst_rate);

						grn_item_cost += isNaN(parseFloat(val.grn_item_cost)) ? 0 : parseFloat(val.grn_item_cost);

						balance_weight = val.balance_weight;

						ratefixwt += parseFloat(val.ratefixwt);

						tot_fixed_weight += parseFloat(val.ratefixwt);

						tot_purchase_wt = val.tot_purchase_wt;

						unfixblcwt += parseFloat(val.ratefixwt);

						tot_return_weight += parseFloat(val.pur_ret_pur_wt);

						if (!isNaN(parseFloat(val.pure_wt))) {

							totUnFixWt = parseFloat(val.pure_wt);

						}

						dispunfixblcwt = totUnFixWt - parseFloat(unfixblcwt) - parseFloat(tot_return_weight);

						var grsWt = isNaN(parseFloat(val.gross_wt)) ? "" : money_format_india(parseFloat(val.gross_wt).toFixed(3));

						var netWt = isNaN(parseFloat(val.net_wt)) ? "" : money_format_india(parseFloat(val.net_wt).toFixed(3));

						var stWt = isNaN(parseFloat(val.stone_wt)) ? "" : money_format_india(parseFloat(val.stone_wt).toFixed(3));

						var stn_amount = isNaN(parseFloat(val.stnamount)) ? "" : money_format_india(parseFloat(val.stnamount).toFixed(3));

						var txAmt = isNaN(parseFloat(val.taxable_amount)) ? "" : money_format_india(parseFloat(val.taxable_amount).toFixed(2));

						var gstRate = isNaN(parseFloat(val.grn_item_gst_rate)) ? "" : money_format_india(parseFloat(val.grn_item_gst_rate).toFixed(2));

						var itmCost = isNaN(parseFloat(val.grn_item_cost)) ? "" : money_format_india(parseFloat(val.grn_item_cost).toFixed(2));

						var purWt = isNaN(parseFloat(val.pure_wt)) ? "" : money_format_india(parseFloat(val.pure_wt).toFixed(3));

						var url = base_url + 'index.php/admin_ret_purchase/CrDr_noteinv/' + val.rate_fix_id;

						trHTML += '<tr>'

							+ '<td>' + val.grn_ref_no + '</td>'

							+ '<td>' + val.po_ref_no + '</td>'

							+ '<td>' + val.grndate + '</td>'

							+ '<td>' + val.category_name + '</td>'

							+ '<td>' + val.supplier_name + '</td>'

							+ '<td>' + grsWt + '</td>'

							+ '<td>' + netWt + '</td>'

							+ '<td>' + stWt + '</td>'

							+ '<td>' + stn_amount + '</td>'

							+ '<td>' + txAmt + '</td>'

							+ '<td>' + gstRate + '</td>'

							+ '<td>' + itmCost + '</td>'

							+ '<td>' + purWt + '</td>'

							+ '<td>' + money_format_india(parseFloat(val.unfixrate).toFixed(2)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(val.ratefixwt).toFixed(3)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(val.pur_ret_pur_wt).toFixed(3)) + '</td>'

							+ '<td>' + parseFloat(dispunfixblcwt).toFixed(3) + '</td>'

							+ '<td>' + money_format_india(parseFloat(val.fixrate).toFixed(2)) + '</td>'

							+ '<td><a href=' + url + ' target="_blank">' + val.crdr + '</a></td>'

							+ '</tr>';

					});

					tot_balance_weight += parseFloat(dispunfixblcwt);

					tot_grs_wt += parseFloat(grs_wt);

					tot_net_wt += parseFloat(net_wt);

					tot_stn_wt += parseFloat(stn_wt);

					tot_pure_wt += parseFloat(pure_wt);

					tot_taxable_amount += parseFloat(taxable_amount);

					tot_stnamount += parseFloat(stnamount);

					tot_grn_item_gst_rate += parseFloat(grn_item_gst_rate);

					tot_grn_item_cost += parseFloat(grn_item_cost);

					trHTML += '<tr style="font-weight:bold; color:red">'

						+ '<td><strong>SUB TOTAL</strong></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td><strong>' + money_format_india(parseFloat(grs_wt).toFixed(3)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(net_wt).toFixed(3)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(stn_wt).toFixed(3)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(stnamount).toFixed(3)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(taxable_amount).toFixed(2)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(grn_item_gst_rate).toFixed(2)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(grn_item_cost).toFixed(2)) + '</strong></td>'

						+ '<td><strong>' + money_format_india(parseFloat(pure_wt).toFixed(3)) + '</strong></td>'

						+ '<td></td>'

						+ '<td><strong>' + money_format_india(parseFloat(ratefixwt).toFixed(3)) + '</strong></td>'

						+ '<td></td>'

						+ '<td><strong>' + money_format_india(parseFloat(dispunfixblcwt).toFixed(3)) + '</strong></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '</tr>';

				});

				trHTML += '<tr style="font-weight:bold; color:blue">'

					+ '<td><strong>GRAND TOTAL</strong></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td><strong>' + money_format_india(parseFloat(tot_grs_wt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(tot_net_wt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(tot_stn_wt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(tot_stnamount).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(tot_taxable_amount).toFixed(2)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(tot_grn_item_gst_rate).toFixed(2)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(tot_grn_item_cost).toFixed(2)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(tot_pure_wt).toFixed(3)) + '</strong></td>'

					+ '<td></td>'

					+ '<td><strong>' + money_format_india(parseFloat(tot_fixed_weight).toFixed(3)) + '</strong></td>'

					+ '<td></td>'

					+ '<td><strong>' + money_format_india(parseFloat(tot_balance_weight).toFixed(3)) + '</strong></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '</tr>';

				$('#unfixing_list > tbody').html(trHTML);

				// Check and initialise datatable

				if (!$.fn.DataTable.isDataTable('#unfixing_list')) {

					oTable = $('#unfixing_list').dataTable({

						"bSort": false,

						"bInfo": true,

						"scrollX": '100%',

						"dom": 'lBfrtip',

						"paging": false,

						"fixedHeader": true,

						"autoWidth": true,

						"columnDefs": [

							{

								targets: [5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16],

								className: 'dt-body-right'

							}

						],

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: '',

								messageTop: title,

								exportOptions: {

									columns: ':visible',

									stripHtml: false

								},

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', '12px')

										.css('font-family', 'sans-serif');

								},

							},

							{

								extend: 'excel',

								footer: true,

								title: 'UNFIXING REPORT',

							},

							{

								extend: 'colvis',

								collectionLayout: 'fixed columns',

								collectionTitle: 'Column visibility control'

							},

						],

					});

				}

			}

		}

	});

}

/*Unfixing Report*/

$("input[name='app[approval_for]']:radio").on('change', function () {

	// alert();

	$('.wastages').css('display', 'block');

	$('.stones').css('display', 'none');

	if (this.value == 0) {

		get_supplier_contract();

		$('.wastages').css('display', 'block');

		$('.stones').css('display', 'none');

	} else {

		get_Karigar_wise_Stones();

		$('.wastages').css('display', 'none');

		$('.stones').css('display', 'block');

	}

});

$('#supplier_contract_search').on('click', function () {

	if ($('input[name="app[approval_for]"]:checked').val() == 0) {

		get_supplier_contract();

	} else {

		get_Karigar_wise_Stones();

	}

});

function get_supplier_contract() {

	var company_name = $('#company_name').val();

	var from_date = '';

	var to_date = '';

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "SUPPLIER WISE CONTRACT REPORT";

	var Karigar = $('#karigar option:selected').html() != '' && $('#karigar option:selected').html() != undefined ? $('#karigar option:selected').html() + " - " : '';

	var price_status = $('#price_status option:selected').html() != '' && $('#price_status option:selected').html() != undefined ? $('#price_status option:selected').html() + " - " : '';

	var optional = karigar + price_status;

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		type: "POST",

		url: base_url + "index.php/admin_ret_reports/supplier_contract_wise/ajax",

		data: { 'id_karigar': $('#karigar').val(), 'price_status': $('#price_status').val() },

		dataType: 'JSON',

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.list;

			var oTable = $('#supplier_contract_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#supplier_contract_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"order": [[0, "asc"]],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', '10px');

							},

						},

						{

							extend: 'colvis',

							collectionLayout: 'fixed columns',

							collectionTitle: 'Column visibility control'

						},

						{

							extend: 'excel',

							footer: true,

							title: 'SUPPLIER WISE CONTRACT REPORT',

						}

					],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "id_karigar" },

						{ "mDataProp": "firstname" },

						{ "mDataProp": "created_on" },

						{ "mDataProp": "approved_on" },

						{ "mDataProp": "rejected_on" },

						{ "mDataProp": "product_name" },

						{ "mDataProp": "design_name" },

						{ "mDataProp": "sub_design_name" },

						{ "mDataProp": "mc_type" },

						{ "mDataProp": "mc_value" },

						{ "mDataProp": "pur_touch" },

						{ "mDataProp": "wastage_per" },

						{ "mDataProp": "status" },

						{ "mDataProp": "created_by" },

						{ "mDataProp": "approved_by" },

						{ "mDataProp": "rejected_by" },

					],

				});

			}

		}

	});

}

function get_Karigar_wise_Stones() {

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/supplier_contract_wise/stone_details/?nocache=" + my_Date.getUTCSeconds(),

		data: { 'id_karigar': $('#karigar').val(), 'price_status': $('#price_status').val() },

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data;

			var oTable = $('#karigar_stones_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#karigar_stones_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"order": [[0, "asc"]],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: 'SUPPLIER WISE CONTRACT REPORT',

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', '10px');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: 'SUPPLIER WISE CONTRACT REPORT',

						}

					],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "id_karigar" },

						{ "mDataProp": "karigar" },

						{ "mDataProp": "created_on" },

						{ "mDataProp": "approved_on" },

						{ "mDataProp": "rejected_on" },

						{ "mDataProp": "stone_type" },

						{ "mDataProp": "stone_name" },

						{ "mDataProp": "uom_name" },

						{ "mDataProp": "stn_cal_type" },

						{ "mDataProp": "from_wt" },

						{ "mDataProp": "to_wt" },

						{ "mDataProp": "quality_code" },

						{ "mDataProp": "clarity" },

						{ "mDataProp": "color" },

						{ "mDataProp": "cut" },

						{ "mDataProp": "shape" },

						{ "mDataProp": "stn_rate" },

						{ "mDataProp": "created_by" },

						{ "mDataProp": "approved_by" },

						{ "mDataProp": "rejected_by" },

					],

				});

			}

			$(".overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	})

}

function get_stock_detail_list() {

	var company_name = $('#company_name').val();

	var branch_name = ctrl_page[5];

	let from_date = ctrl_page[3];

	let to_date = ctrl_page[4];

	var report_name = "Stock Report";

	var optional = "";

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/get_stock_detail_list/ajax?nocache=" + my_Date.getUTCSeconds(),

		type: "POST",

		data: { 'from_date': ctrl_page[3], 'to_date': ctrl_page[4], 'id_branch': ctrl_page[5], 'id_metal': ctrl_page[6] },

		dataType: "JSON",

		cache: false,

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.list;

			//var non_tag_items = data.non_tag_items;

			$("#dash_sales_list > tbody > tr").remove();

			$('#dash_sales_list').dataTable().fnClearTable();

			$('#dash_sales_list').dataTable().fnDestroy();

			if (list != null) {

				trHTML = '';

				tfootHTML = '';

				total_bill_amount = 0;

				total_bill_tax_value = 0;

				var total_op_blc_pcss = 0;

				var total_op_blc_gwt = 0;

				var total_op_blc_nwt = 0;

				var total_inw_pcss = 0;

				var total_inw_gwt = 0;

				var total_inw_nwt = 0;

				var total_closing_inw_pcs = 0;

				var total_closing_inw_gwt = 0;

				var total_closing_net_wt = 0;

				$.each(list, function (i, metal) {

					var metal_op_blc_pcss = 0;

					var metal_op_blc_gwt = 0;

					var metal_op_blc_nwt = 0;

					var metal_inw_pcss = 0;

					var metal_inw_gwt = 0;

					var metal_inw_nwt = 0;

					var metal_closing_inw_pcs = 0;

					var metal_closing_inw_gwt = 0;

					var metal_closing_net_wt = 0;

					$.each(metal, function (i, category) {

						var op_blc_pcss = 0;

						var op_blc_gwt = 0;

						var op_blc_nwt = 0;

						var inw_pcss = 0;

						var inw_gwt = 0;

						var inw_nwt = 0;

						var sold_pcs = 0;

						var sold_gwt = 0;

						var sold_nwt = 0;

						var other_s_pcs = 0;

						var other_s_gwt = 0;

						var other_s_nwt = 0;

						var closing_inw_pcs = 0;

						var closing_inw_gwt = 0;

						var closing_net_wt = 0;

						trHTML += '<tr>'

							+ '<td style="text-align:left;" colspan="2"><strong>' + i + '</strong></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

						'</tr>';

						$.each(category, function (idx, item) {

							op_blc_pcss += parseFloat(item.op_blc_pcs);

							op_blc_gwt += parseFloat(item.op_blc_gwt);

							op_blc_nwt += parseFloat(item.op_blc_nwt);

							//Product Inward Details

							inw_pcss += parseFloat(item.inw_pcs);

							inw_gwt += parseFloat(item.inw_gwt);

							inw_nwt += parseFloat(item.inw_nwt);

							//Product Inward Details

							//Product SOld Details

							sold_pcs += parseFloat(item.sold_pcs);

							sold_gwt += parseFloat(item.sold_gwt);

							sold_nwt += parseFloat(item.sold_nwt);

							//Product SOld Details

							//Other Outward Details

							other_s_pcs += parseFloat(item.br_out_pcs);

							other_s_gwt += parseFloat(item.br_out_gwt);

							other_s_nwt += parseFloat(item.br_out_nwt);

							//Other Outward Details

							//Product closing Details

							var closing_pcs = parseFloat(item.op_blc_pcs) + parseFloat(item.inw_pcs) - parseFloat(parseFloat(item.sold_pcs) + parseFloat(item.br_out_pcs));

							var closing_gwt = parseFloat(parseFloat(item.op_blc_gwt) + parseFloat(item.inw_gwt) - parseFloat(item.sold_gwt) - parseFloat(item.br_out_gwt)).toFixed(3);

							var closing_nwt = parseFloat(parseFloat(item.op_blc_nwt) + parseFloat(item.inw_nwt) - parseFloat(item.sold_nwt) - parseFloat(item.br_out_nwt)).toFixed(3);

							//Product closing Details

							trHTML += '<tr>'

								+ '<td style="text-align:left;">' + item.product_name + '</td>'

								+ '<td>' + money_format_india(item.op_blc_pcs) + '</td>'

								+ '<td>' + money_format_india(item.op_blc_gwt) + '</td>'

								+ '<td>' + money_format_india(item.op_blc_nwt) + '</td>'

								+ '<td>' + money_format_india(item.inw_pcs) + '</td>'

								+ '<td>' + money_format_india(item.inw_gwt) + '</td>'

								+ '<td>' + money_format_india(item.inw_nwt) + '</td>'

								+ '<td>' + money_format_india(parseFloat(parseFloat(item.sold_pcs) + parseFloat(item.br_out_pcs))) + '</td>'

								+ '<td>' + money_format_india(parseFloat(parseFloat(item.sold_gwt) + parseFloat(item.br_out_gwt)).toFixed(3)) + '</td>'

								+ '<td>' + money_format_india(parseFloat(parseFloat(item.sold_nwt) + parseFloat(item.br_out_nwt)).toFixed(3)) + '</td>'

								+ '<td>' + money_format_india(closing_pcs) + '</td>'

								+ '<td>' + money_format_india(closing_gwt) + '</td>'

								+ '<td>' + money_format_india(closing_nwt) + '</td>'

								+ '<td>' + money_format_india(item.in_trans_pcs) + '</td>'

								+ '<td>' + money_format_india(parseFloat(parseFloat(closing_pcs) + parseFloat(item.in_trans_pcs))) + '</td>'

							'</tr>';

							closing_inw_pcs += parseFloat(closing_pcs);

							closing_inw_gwt += parseFloat(closing_gwt);

							closing_net_wt += parseFloat(closing_nwt);

						});

						trHTML += '<tr style="font-weight:bold;color:red">' +

							+'<td></td>'

							+ '<td style="text-align:left;"><strong>SUB TOTAL</strong></td>'

							+ '<td>' + money_format_india(op_blc_pcss) + '</td>'

							+ '<td>' + money_format_india(parseFloat(op_blc_gwt).toFixed(3)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(op_blc_nwt).toFixed(3)) + '</td>'

							+ '<td>' + money_format_india(inw_pcss) + '</td>'

							+ '<td>' + money_format_india(parseFloat(inw_gwt).toFixed(3)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(inw_nwt).toFixed(3)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(sold_pcs + other_s_pcs)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(sold_gwt + other_s_gwt).toFixed(3)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(sold_nwt + other_s_nwt).toFixed(3)) + '</td>'

							+ '<td>' + money_format_india(closing_inw_pcs) + '</td>'

							+ '<td>' + money_format_india(parseFloat(closing_inw_gwt).toFixed(3)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(closing_net_wt).toFixed(3)) + '</td>'

							+ '<td></td>'

							+ '<td></td>'

						'</tr>';

						metal_op_blc_pcss += parseFloat(op_blc_pcss);

						metal_op_blc_gwt += parseFloat(op_blc_gwt);

						metal_op_blc_nwt += parseFloat(op_blc_nwt);

						metal_inw_pcss += parseFloat(inw_pcss);

						metal_inw_gwt += parseFloat(inw_gwt);

						metal_inw_nwt += parseFloat(inw_nwt);

						metal_closing_inw_pcs += parseFloat(closing_inw_pcs);

						metal_closing_inw_gwt += parseFloat(closing_inw_gwt);

						metal_closing_net_wt += parseFloat(closing_net_wt);

					});

					trHTML += '<tr style="font-weight:bold;color:red">' +

						+'<td></td>'

						+ '<td style="text-align:left;">TOTAL</td>'

						+ '<td>' + money_format_india(metal_op_blc_pcss) + '</td>'

						+ '<td>' + money_format_india(parseFloat(metal_op_blc_gwt).toFixed(3)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(metal_op_blc_nwt).toFixed(3)) + '</td>'

						+ '<td>' + money_format_india(metal_inw_pcss) + '</td>'

						+ '<td>' + money_format_india(parseFloat(metal_inw_gwt).toFixed(3)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(metal_inw_nwt).toFixed(3)) + '</td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td>' + money_format_india(metal_closing_inw_pcs) + '</td>'

						+ '<td>' + money_format_india(parseFloat(metal_closing_inw_gwt).toFixed(3)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(metal_closing_net_wt).toFixed(3)) + '</td>'

						+ '<td></td>'

						+ '<td></td>'

					'</tr>';

					total_op_blc_pcss += parseFloat(metal_op_blc_pcss);

					total_op_blc_gwt += parseFloat(metal_op_blc_gwt);

					total_op_blc_nwt += parseFloat(metal_op_blc_nwt);

					total_inw_pcss += parseFloat(metal_inw_pcss);

					total_inw_gwt += parseFloat(metal_inw_gwt);

					total_inw_nwt += parseFloat(metal_inw_nwt);

					total_closing_inw_pcs += parseFloat(metal_closing_inw_pcs);

					total_closing_inw_gwt += parseFloat(metal_closing_inw_gwt);

					total_closing_net_wt += parseFloat(metal_closing_net_wt);

				});

				trHTML += '<tr style="font-weight:bold;color:blue">' +

					+'<td></td>'

					+ '<td style="text-align:left;">GRAND TOTAL</td>'

					+ '<td>' + money_format_india(total_op_blc_pcss) + '</td>'

					+ '<td>' + money_format_india(parseFloat(total_op_blc_gwt).toFixed(3)) + '</td>'

					+ '<td>' + money_format_india(parseFloat(total_op_blc_nwt).toFixed(3)) + '</td>'

					+ '<td>' + money_format_india(total_inw_pcss) + '</td>'

					+ '<td>' + money_format_india(parseFloat(total_inw_gwt).toFixed(3)) + '</td>'

					+ '<td>' + money_format_india(parseFloat(total_inw_nwt).toFixed(3)) + '</td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td>' + money_format_india(total_closing_inw_pcs) + '</td>'

					+ '<td>' + money_format_india(parseFloat(total_closing_inw_gwt).toFixed(3)) + '</td>'

					+ '<td>' + money_format_india(parseFloat(total_closing_net_wt).toFixed(3)) + '</td>'

					+ '<td></td>'

					+ '<td></td>'

				'</tr>';

				// $.each(non_tag_items, function (key, metal) {

				// 	trHTML += '<tr>'

				// 		+ '<td style="font-weight:bold;text-align:left;text-transform:uppercase;" colspan="2">Non Tag Items</td>'

				// 		+ '<td></td>'

				// 		+ '<td></td>'

				// 		+ '<td></td>'

				// 		+ '<td></td>'

				// 		+ '<td></td>'

				// 		+ '<td></td>'

				// 		+ '<td></td>'

				// 		+ '<td></td>'

				// 		+ '<td></td>'

				// 		+ '<td></td>'

				// 		+ '<td></td>'

				// 		+ '<td></td>'

				// 		+ '<td></td>'

				// 		+ '<td></td>'

				// 	'</tr>';

				// 	$.each(metal, function (k, category) {

				// 		trHTML += '<tr>'

				// 			+ '<td style="font-weight:bold;text-align:left;" colspan="2">' + k + '</td>'

				// 			+ '<td></td>'

				// 			+ '<td></td>'

				// 			+ '<td></td>'

				// 			+ '<td></td>'

				// 			+ '<td></td>'

				// 			+ '<td></td>'

				// 			+ '<td></td>'

				// 			+ '<td></td>'

				// 			+ '<td></td>'

				// 			+ '<td></td>'

				// 			+ '<td></td>'

				// 			+ '<td></td>'

				// 			+ '<td></td>'

				// 			+ '<td></td>'

				// 		'</tr>';

				// 		$.each(category, function (c, items) {

				// 			trHTML += '<tr style="font-weight:bold;">'

				// 				+ '<td style="font-weight:bold;text-align:left;">' + items.product_name + '</td>'

				// 				+ '<td>' + items.op_blc_pcs + '</td>'

				// 				+ '<td>' + items.op_blc_gwt + '</td>'

				// 				+ '<td>' + items.op_blc_nwt + '</td>'

				// 				+ '<td>' + items.inw_pcs + '</td>'

				// 				+ '<td>' + items.inw_gwt + '</td>'

				// 				+ '<td>' + items.inw_nwt + '</td>'

				// 				+ '<td>' + items.out_pcs + '</td>'

				// 				+ '<td>' + items.out_gwt + '</td>'

				// 				+ '<td>' + items.out_nwt + '</td>'

				// 				+ '<td>' + parseFloat(parseFloat(items.op_blc_pcs) + parseFloat(items.inw_pcs) - parseFloat(items.out_pcs)).toFixed(3) + '</td>'

				// 				+ '<td>' + parseFloat(parseFloat(items.op_blc_gwt) + parseFloat(items.inw_gwt) - parseFloat(items.out_gwt)).toFixed(3) + '</td>'

				// 				+ '<td>' + parseFloat(parseFloat(items.op_blc_nwt) + parseFloat(items.inw_nwt) - parseFloat(items.out_nwt)).toFixed(3) + '</td>'

				// 				+ '<td></td>'

				// 				+ '<td></td>'

				// 			'</tr>';

				// 		});

				// 	});

				// });

				$('#dash_sales_list > tbody').html(trHTML);

				// Check and initialise datatable

				if (!$.fn.DataTable.isDataTable('#dash_sales_list')) {

					oTable = $('#dash_sales_list').dataTable({

						"bSort": false,

						"bInfo": true,

						"scrollX": '100%',

						"dom": 'lBfrtip',

						"paging": false,

						"columnDefs": [

							{

								targets: [2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14],

								className: 'dt-body-right'

							},

						],

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: '',

								messageTop: title,

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', 'inherit');

								},

							},

							{

								extend: 'excel',

								footer: true,

								title: 'STOCK REPORT ' + branch_name + '-' + from_date + '-' + to_date,

							}

						],

					});

				}

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

$('#weight_range_design_search').click(function (event) {

	weight_rage_report();

});

function weight_rage_report() {

	var company_name = $('#company_name').val();

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "Selling V.A & M.C Report"

	var optional = '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, '', '', optional) + "</span>";

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/weight_rage_report/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'id_product': $("#prod_select").val(), 'category_id': $("#category").val(), 'id_design': $("#des_select").val(), 'id_sub_design': $('#sub_des_select').val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			var oTable = $('#weight_rage_report_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#weight_rage_report_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"order": [[0, "desc"]],

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"fixedHeader": true,

					"paging": false,

					"autoWidth": true,

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', '10px');

							},

						},

						{

							extend: 'colvis',

							collectionLayout: 'fixed columns',

							collectionTitle: 'Column visibility control'

						},

						{

							extend: 'excel',

							footer: true,

							title: 'Discount Bill Report',

						}

					],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "product_name" },

						{ "mDataProp": "design_name" },

						{ "mDataProp": "sub_design_name" },

						{ "mDataProp": "wc_from_weight" },

						{ "mDataProp": "wc_to_weight" },

						{ "mDataProp": "wc_percent" },

						{ "mDataProp": "mc" },

						{ "mDataProp": "mcrg_min" },

						{ "mDataProp": "mcrg_max" },

						{ "mDataProp": "wc_min" },

						{ "mDataProp": "wc_max" },

					],

				});

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function tag_imgprev(curRow) {

	$('#imagepreview').attr('src', curRow.find('#img_prev').attr('src'));

	$('#imagemodal').modal('show');

}

$('#emp_wise_tag_search').click(function (event) {

	set_employee_wise_sales_tag();

});

function set_employee_wise_sales_tag() {

	var dt_range = ($("#dt_range").val()).split('-');

	var company_name = $('#company_name').val();

	var from_date = dt_range[0];

	var to_date = dt_range[1];

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "Employee Wise Tag Report ";

	var employee = $('#emp_select option:selected').val() != '' && $('#emp_select option:selected').val() != undefined ? $('#emp_select option:selected').html() + " - " : '';

	var product = $('#prod_select option:selected').val() != '' && $('#prod_select option:selected').val() != undefined ? $('#prod_select option:selected').html() + " - " : '';

	var design = $('#des_select option:selected').val() != '' && $('#des_select option:selected').val() != undefined ? $('#des_select option:selected').html() + " - " : '';

	var sub_design = $('#sub_des_select option:selected').val() != '' && $('#sub_des_select option:selected').val() != undefined ? $('#sub_des_select option:selected').html() + " - " : '';

	var optional = employee + product + design + sub_design;

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		type: "POST",

		url: base_url + "index.php/admin_ret_reports/employee_wise_tag/ajax?nocache=" + my_Date.getUTCSeconds(),

		dataType: 'JSON',

		data: { 'id_emp': $('#emp_select').val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'dt_range': $("#dt_range").val(), 'id_product': $('#prod_select').val(), 'id_design': $('#des_select').val(), 'id_sub_design': $('#sub_des_select').val() },

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.list;

			$('#emp_name').val(list.emp_name);

			let a = 1;

			console.log(list);

			var oTable = $('#emp_wise_tag_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#emp_wise_tag_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"order": [[0, "asc"]],

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"fixedHeader": true,

					"paging": true,

					"autoWidth": true,

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', '10px');

							},

						},

						{

							extend: 'colvis',

							collectionLayout: 'fixed columns',

							collectionTitle: 'Column visibility control'

						},

						{

							extend: 'excel',

							footer: true,

							title: "EMPLOYEE WISE TAG REPORT- " + $("#dt_range").val(),

						}

					],

					"aaData": list,

					"aoColumns": [

						{

							"mDataProp": function (row, type, val, meta) {

								return a++;

							}

						},

						{ "mDataProp": "emp_name" },

						{ "mDataProp": "tag_date" },

						{ "mDataProp": "old_tag_id" },

						{ "mDataProp": "tag_code" },

						{ "mDataProp": "lot_no" },

						{

							"mDataProp": function (row, type, val, meta) {

								if (row.tag_img != null && row.tag_img != undefined && row.tag_img != '') {

									var img_src = base_url + 'assets/img/tag/' + row.tag_img;

								}

								else {

									var img_src = base_url + 'assets/img/no_image.png';

								}

								var image = "<img  class='img_src' id='img_prev' src=" + img_src + "  width='35' height='35' onClick=tag_imgprev($(this).closest('tr')) ></img>"

								return image;

							}

						},

						{ "mDataProp": "size" },

						{ "mDataProp": "product_name" },

						{ "mDataProp": "design_name" },

						{ "mDataProp": "sub_design_name" },

						{ "mDataProp": "gross_wt" },

						{ "mDataProp": "less_wt" },

						{ "mDataProp": "net_wt" },

						{ "mDataProp": "retail_max_wastage_percent" },

						{ "mDataProp": "tag_mc_value" },

						{ "mDataProp": "mc_type" },

					],

					"footerCallback": function (row, data, start, end, display) {

						var api = this.api(), data;

						// Remove the formatting to get integer data for summation

						var intVal = function (i) {

							return typeof i === 'string' ?

								i.replace(/[\$,]/g, '') * 1 :

								typeof i === 'number' ?

									i : 0;

						};

						let grs_wt = api

							.column(11)

							.data()

							.reduce(function (a, b) {

								return intVal(a) + intVal(b);

							}, 0);

						$(api.column(11).footer()).html(parseFloat(grs_wt).toFixed(3));

						let lwt = api

							.column(12)

							.data()

							.reduce(function (a, b) {

								return intVal(a) + intVal(b);

							}, 0);

						$(api.column(12).footer()).html(parseFloat(lwt).toFixed(3));

						let net_wt = api

							.column(13)

							.data()

							.reduce(function (a, b) {

								return intVal(a) + intVal(b);

							}, 0);

						$(api.column(13).footer()).html(parseFloat(net_wt).toFixed(3));

						let mc_tot = api

							.column(15)

							.data()

							.reduce(function (a, b) {

								return intVal(a) + intVal(b);

							}, 0);

						$(api.column(15).footer()).html(parseFloat(mc_tot).toFixed(2));

					}

				});

			}

		}

	});

}

function get_telecalling_report_cus(fliter_values) {

	console.log(fliter_values);

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $('#branch_select option:selected').toArray().map(item => item.text).join());

	var company_name = $('#company_name').val();

	var company_code = $('#company_code').val();

	var company_code = $('#company_code').val();

	var company_address1 = $('#company_address1').val();

	var company_address2 = $('#company_address2').val();

	var company_city = $('#company_city').val();

	var pincode = $('#pincode').val();

	var company_email = $('#company_email').val();

	var company_gst_number = $('#company_gst_number').val();

	var phone = $('#phone').val();

	var title = "<div style='text-align: center;'><b><span style='font-size:12pt;'>" + company_code + "</span></b></br>"

		+ "<span style='font-size:11pt;'>" + company_address1 + "</span></br>"

		+ "<span style='font-size:11pt;'>" + company_address2 + company_city + "-" + pincode + "</span></br>"

		+ "<span style='font-size:11pt;'>GSTIN:" + company_gst_number + ", EMAIL:" + company_email + "</span></br>"

		+ "<span style='font-size:11pt;'>Contact :" + phone + "</span></br>"

		+ "<span style=font-size:12pt;>&nbsp;&nbsp;Customer Analysis - " + branch_name + " &nbsp;FROM&nbsp;:&nbsp;" + $('#rpt_payments1').html() + " &nbsp;&nbsp;TO&nbsp;&nbsp; " + $('#rpt_payments2').html() + " - " + $('.hidden-xs').html() + "</span>";

	my_Date = new Date();

	$('.overlay').css('display', 'block');

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/customer_analysis/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'from_date': $('#rpt_payments1').html(), 'to_date': $('#rpt_payments2').html(), 'filter_condtions': fliter_values, 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()) }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			set_telecalling_report_cus(data);

			$('.overlay').css('display', 'none');

		},

		error: function (error) {

			$('.overlay').css('display', 'none');

		}

	});

}

function set_telecalling_report_cus(data) {

	var list = data;

	var oTable = $('#telecalling_list').DataTable();

	oTable.clear().draw();

	if (list != null && list.length > 0) {

		oTable = $('#telecalling_list').dataTable({

			"bDestroy": true,

			"bInfo": true,

			"bFilter": true,

			"scrollX": '100%',

			"bSort": true,

			"dom": 'lBfrtip',

			"buttons": [

				{

					extend: 'print',

					footer: true,

					customize: function (win) {

						$(win.document.body).find('table')

							.addClass('compact')

							.css('font-size', 'inherit');

					},

				},

				{

					extend: 'excel',

					footer: true,

					title: ''

					//title: $("#rpt_payments1").html()+"-"+"PAYMENTS",

				}

			],

			"aaData": list,

			"aoColumns": [

				{

					"mDataProp": function (row, type, val, meta) {

						chekbox = '<input type="checkbox" class="id_customer" name="id_customer[]" value="' + row.id_customer + '"/>' + row.id_customer;

						return chekbox;

					}

				},

				{

					"mDataProp": function (row, type, val, meta) {

						cus_report = base_url + "index.php/admin_ret_reports/customer_history/list/" + row.mobile;

						action = '<a href="' + cus_report + '" target="_blank">' + row.firstname;

						return action;

					}

				},

				{

					"mDataProp": function (row, type, val, meta) {

						mobile_report = base_url + "index.php/admin_ret_reports/customer_history/list/" + row.mobile;

						action = '<a href="' + mobile_report + '" target="_blank">' + row.mobile;

						return action;

					}

				},

				{

					"mDataProp": function (row, type, val, meta) {

						if (row.vip_customer == 'YES') {

							return '<span class="badge bg-green">' + row.vip_customer + '</span>';

						}

						else {

							return row.vip_customer

						}

					}

				},

				{ "mDataProp": "branch_name" },

				{ "mDataProp": "estimation_no" },

				{ "mDataProp": "bill_count" },

				{ "mDataProp": "item_cost" },

				{ "mDataProp": "last_billdate" },

				{ "mDataProp": "gold_wt" },

				{ "mDataProp": "silver_wt" },

				{ "mDataProp": "discount" },

				{ "mDataProp": "tot_discount" },

				// { "mDataProp": function ( row, type, val, meta )

				// {

				// return '<a href="https://api.whatsapp.com/send?phone=+91'+row.mobile+'" target="_blank"><i class="fa fa-whatsapp" aria-hidden="true" style="font-size: 30px;color: #fff;background: linear-gradient(#25d366,#25d366) 14% 84%/16% 16% no-repeat, radial-gradient(#25d366 58%,transparent 0);"></i></a>';

				// // }},

				// { "mDataProp": function ( row, type, val, meta )

				// {

				// var id = row.id_customer;

				// feedback_target="#modal-feedback";

				// action_content= '<a href=# class="btn btn-info fb_add" id="fb" data-toggle="modal"   role="button" data-id='+id+' data-target='+feedback_target+'><i class="fa fa-comments-o" aria-hidden="true"></i></a>';

				// return action_content;

				// }},

			],

			"footerCallback": function (row, data, start, end, display) {

				var api = this.api(), data;

				// Remove the formatting to get integer data for summation

				var intVal = function (i) {

					return typeof i === 'string' ?

						i.replace(/[\$,]/g, '') * 1 :

						typeof i === 'number' ?

							i : 0;

				};

				sold_gross_wgt = api

					.column(8)

					.data()

					.reduce(function (a, b) {

						return intVal(a) + intVal(b);

					}, 0);

				mrp_cost = api

					.column(9)

					.data()

					.reduce(function (a, b) {

						return intVal(a) + intVal(b);

					}, 0);

				tot_discount = api

					.column(10)

					.data()

					.reduce(function (a, b) {

						return intVal(a) + intVal(b);

					}, 0);

				mrp_discount = api

					.column(11)

					.data()

					.reduce(function (a, b) {

						return intVal(a) + intVal(b);

					}, 0);

				console.log('solditems', sold_gross_wgt);

				console.log('mrp_cost', mrp_cost);

				console.log('tot_discount', tot_discount);

				console.log('mrp_discount', mrp_discount);

				// Update footer

				$(api.column(8).footer()).html(parseFloat(sold_gross_wgt).toFixed(3))

				$(api.column(9).footer()).html(parseFloat(mrp_cost).toFixed(2));

				$(api.column(10).footer()).html(parseFloat(tot_discount).toFixed(2));

				$(api.column(11).footer()).html(parseFloat(mrp_discount).toFixed(2));

			}

		});

	}

}

$("#set_vip_cus").on('click', function () {

	if ($("input[name='id_customer[]']:checked").val()) {

		$('#set_vip_cus').prop('disabled', true);

		var selected = [];

		$("#telecalling_list tbody tr").each(function (index, value) {

			if ($(value).find("input[name='id_customer[]']:checked").is(":checked")) {

				transData = {

					'id_customer': $(value).find(".id_customer").val(),

				}

				selected.push(transData);

			}

		})

		req_data = selected;

		update_vip_customer(req_data);

	}

	else {

		$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + 'Please Select Customer..' });

		$('#set_vip_cus').prop('disabled', false);

	}

});

function update_vip_customer(req_data) {

	my_Date = new Date();

	$("div.overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/customer_analysis/update_vip_customer?nocache=" + my_Date.getUTCSeconds() + '' + my_Date.getUTCMinutes() + '' + my_Date.getUTCHours(),

		data: { 'req_data': req_data },

		type: "POST",

		dataType: "JSON",

		async: false,

		success: function (data) {

			if (data.status) {

				$.toaster({ priority: 'success', title: 'Warning!', message: '' + "</br>" + data.message });

			}

			else {

				$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + data.message });

			}

			location.reload();

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			console.log(error);

			$("div.overlay").css("display", "none");

		}

	})

}

$(document).on('click', "#tag_product_list a.tag_img", function (e) {

	e.preventDefault();

	id = $(this).data('id');

	console.log(id);

	$("#edit-id").val(id);

	view_dup_tag_history_imgs(id);

});

function get_ActiveSections() {

	$("#section_select option").remove();

	my_Date = new Date();

	$.ajax({

		type: 'POST',

		url: base_url + "index.php/admin_ret_catalog/get_sectionBranchwise?nocache=" + my_Date.getUTCSeconds(),

		data: { 'id_branch': $('#branch_select').val() },

		dataType: 'json',

		success: function (data) {

			var id = $("#id_section").val();

			$.each(data, function (key, item) {

				$("#section_select").append(

					$("<option></option>")

						.attr("value", item.id_section)

						.text(item.section_name)

				);

			});

			$('#section_select').select2({

				placeholder: "Select Section",

				allowClear: true

			});

			$("#section_select").select2("val", (id != '' && id > 0 ? id : ''));

			$(".overlay").css("display", "none");

		}

	})

}

$('#tobe_history_search').click(function (event) {

	set_tobe_history_table();

});

function set_tobe_history_table() {

	var dt_range = ($("#dt_range").val()).split('-');

	var from_date = dt_range[0];

	var to_date = dt_range[1];

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var company_name = $('#company_name').val();

	var report_name = 'TOBE SALES HISTORY REPORT';

	var optional = "";

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/tobe_history/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'id_customer': $('#select_customer').val(), 'dt_range': $("#dt_range").val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()) }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			$("#tobe_history_list > tbody > tr").remove();

			$('#tobe_history_list').dataTable().fnClearTable();

			$('#tobe_history_list').dataTable().fnDestroy();

			if (list != null && list != '') {

				trHTML = '';

				tfootHTML = '';

				total_bill_amount = 0;

				total_paid_amount = 0;

				total_bal_amount = 0;

				total_credit_disc_amt = 0;

				total_old_metal_amount = 0;

				$.each(list, function (i, branch) {

					var bill_amount = 0;

					var paid_amount = 0;

					var bal_amount = 0;

					var bill_bal_amt = 0;

					var credit_disc_amt = 0;

					var old_metal_amount = 0;

					$.each(branch, function (idx, item) {

						if (item.type == 0) {

							var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + item.bill_id;

						} else {

							var url = base_url + 'index.php/admin_ret_billing/issue/issue_print/' + item.bill_id;

						}

						trHTML += '<tr>' +

							'<td>' + item.branch_name + '</td>'

							+ '<td>' + item.cus_name + '</td>'

							+ '<td>' + item.mobile + '</td>'

							+ '<td><a href=' + url + ' target="_blank">' + item.bill_no + '</a></td>'

							+ '<td>' + item.bill_date + '</td>'

							+ '<td>' + money_format_india(parseFloat(item.tot_bill_amount).toFixed(2)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(item.tot_amt_received).toFixed(2)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(item.credit_disc_amt).toFixed(2)) + '</td>'

							+ '<td></td>'

							+ '<td>' + money_format_india(parseFloat(item.bal_amt).toFixed(2)) + '</td>'

						'</tr>';

						bill_amount = parseFloat(bill_amount) + parseFloat(item.tot_bill_amount);

						paid_amount = parseFloat(paid_amount) + parseFloat(item.tot_amt_received);

						bill_bal_amt = parseFloat(item.bal_amt);

						if ((item.credit_collection).length > 0) {

							$.each(item.credit_collection, function (key, value) {

								var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + value.bill_id;

								bill_bal_amt = parseFloat(bill_bal_amt) - parseFloat(value.tot_amt_received) - parseFloat(value.credit_disc_amt) - parseFloat(value.old_metal_amount);

								credit_disc_amt += parseFloat(value.credit_disc_amt);

								old_metal_amount += parseFloat(value.old_metal_amount);

								if (item.type == 0) {

									var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + value.bill_id;

								} else {

									var url = base_url + 'index.php/admin_ret_billing/receipt/receipt_print/' + value.bill_id;

								}

								trHTML += '<tr>' +

									+'<td></td>'

									+ '<td></td>'

									+ '<td></td>'

									+ '<td></td>'

									+ '<td><a href=' + url + ' target="_blank">' + value.bill_no + '</a></td>'

									+ '<td>' + value.bill_date + '</td>'

									+ '<td>' + money_format_india((parseFloat(value.tot_bill_amount) + parseFloat(value.credit_disc_amt)).toFixed(2)) + '</td>'

									+ '<td>' + money_format_india(parseFloat(value.tot_amt_received).toFixed(2)) + '</td>'

									+ '<td>' + money_format_india(parseFloat(value.credit_disc_amt).toFixed(2)) + '</td>'

									+ '<td>' + money_format_india(parseFloat(value.old_metal_amount).toFixed(2)) + '</td>'

									+ '<td>' + money_format_india(parseFloat(bill_bal_amt).toFixed(2)) + '</td>'

								'</tr>';

								paid_amount = parseFloat(paid_amount) + parseFloat(value.tot_amt_received);

							});

						}

					});

					trHTML += '<tr style="font-weight:bold;">' +

						'<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td>Sub Total</td>'

						+ '<td>' + money_format_india(bill_amount) + '</td>'

						+ '<td>' + money_format_india(paid_amount) + '</td>'

						+ '<td>' + money_format_india(credit_disc_amt) + '</td>'

						+ '<td>' + money_format_india(old_metal_amount) + '</td>'

						+ '<td>' + money_format_india(parseFloat(parseFloat(bill_amount) - parseFloat(paid_amount) - parseFloat(credit_disc_amt) - parseFloat(old_metal_amount)).toFixed(2)); +'</td>'

							+ '<td></td>'

					'</tr>';

					total_bill_amount = total_bill_amount + bill_amount;

					total_paid_amount = total_paid_amount + paid_amount;

					total_bal_amount = total_bal_amount + (parseFloat(bill_amount) - parseFloat(paid_amount) - parseFloat(credit_disc_amt) - parseFloat(old_metal_amount));

					total_credit_disc_amt = total_credit_disc_amt + credit_disc_amt;

					total_old_metal_amount = total_old_metal_amount + old_metal_amount;

				});

				trHTML += '<tr style="font-weight:bold;">' +

					'<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td>Grand Total</td>'

					+ '<td>' + money_format_india(total_bill_amount) + '</td>'

					+ '<td>' + money_format_india(total_paid_amount) + '</td>'

					+ '<td>' + money_format_india(total_credit_disc_amt) + '</td>'

					+ '<td>' + money_format_india(total_old_metal_amount) + '</td>'

					+ '<td>' + money_format_india(total_bal_amount) + '</td>'

					+ '<td></td>'

				'</tr>';

				$('#tobe_history_list > tbody').html(trHTML);

				// Check and initialise datatable

				if (!$.fn.DataTable.isDataTable('#tobe_history_list')) {

					oTable = $('#tobe_history_list').dataTable({

						"bSort": false,

						"bInfo": true,

						"scrollX": '100%',

						"dom": 'lBfrtip',

						"columnDefs": [

							{

								targets: [5, 6, 7, 8, 9],

								className: 'dt-body-right'

							},

						],

						"paging": false,

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: '',

								messageTop: title,

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', '10px')

										.css('font-family', 'sans-serif');

								},

							},

							{

								extend: 'excel',

								footer: true,

								title: title,

							}

						],

					});

				}

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

$('#tobe_pending_search').click(function (event) {

	set_tobe_pending_list();

});

function set_tobe_pending_list() {

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	//var from_date = $('#rpt_from_date').html();

	//var to_date = $('#rpt_to_date').html();

	from_date = to_date = '';

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var company_name = $('#company_name').val();

	var report_name = 'TOBE PENDING REPORT';

	var optional = "";

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/tobe_pending/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'id_customer': $('#select_customer').val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'from_date': $('#rpt_from_date').html(), 'to_date': $('#rpt_to_date').html() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			var oTable = $('#tobe_issued_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#tobe_issued_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"columnDefs": [

						{

							targets: [5, 6, 7, 8, 9],

							className: 'dt-body-right'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: "",

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: 'TOBE PENDING REPORT',

						}

					],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "branch_name" },

						{ "mDataProp": "cus_name" },

						{ "mDataProp": "mobile" },

						{

							"mDataProp": function (row, type, val, meta) {

								if (row.type == 0) {

									var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + row.bill_id;

								} else {

									var url = base_url + 'index.php/admin_ret_billing/issue/issue_print/' + row.bill_id;

								}

								return '<a href=' + url + ' target="_blank">' + row.bill_no + '</a>';

							}

						},

						{ "mDataProp": "bill_date" },

						{

							"mDataProp": function (row, type, val, meta) {

								var total_bill_amount = row.tot_bill_amount;

								return money_format_india(total_bill_amount);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var due_amount = row.due_amount;

								return money_format_india(due_amount);

							}

						},

						{ "mDataProp": "credit_due_date" },

						{

							"mDataProp": function (row, type, val, meta) {

								if (row.due_date_cnt != '') {

									var due_date_cnt = parseFloat(row.due_date_cnt);

									if (due_date_cnt > 0) {

										trhtml = '<span>' + due_date_cnt + '</span>';

									} else {

										trhtml = '<span style ="color:red;">' + due_date_cnt + '</span>';

									}

								} else {

									trhtml = '';

								}

								return trhtml;

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var paid_amount = row.paid_amount;

								return money_format_india(paid_amount);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var credit_ret_amt = row.credit_ret_amt;

								return money_format_india(credit_ret_amt);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var bal_amt = row.bal_amt;

								return money_format_india(bal_amt);

							}

						},

						{

							"mDataProp": null,

							"sClass": "control center",

							"sDefaultContent": '<span class="drill-val"><i class="fa fa-chevron-circle-down text-teal"></i></span>'

						},

					],

					"footerCallback": function (row, data, start, end, display) {

						var cshtotal = 0;

						if (list.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								total_bill_amount = api

									.column(5, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(5).footer()).html(money_format_india(parseFloat(total_bill_amount).toFixed(2)));

								total_due_amount = api

									.column(6, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(6).footer()).html(money_format_india(parseFloat(total_due_amount).toFixed(2)));

								total_paid_amount = api

									.column(9, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(9).footer()).html(money_format_india(parseFloat(total_paid_amount).toFixed(2)));

								total_return_amount = api

									.column(10, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(10).footer()).html(money_format_india(parseFloat(total_return_amount).toFixed(2)));

								total_amount = api

									.column(11, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(11).footer()).html(money_format_india(parseFloat(total_amount).toFixed(2)));

							}

						}

						else {

							var api = this.api(), data;

							$(api.column(7).footer()).html('');

						}

					}

				});

				var anOpen = [];

				$(document).on('click', "#tobe_issued_list .control", function () {

					var nTr = this.parentNode;

					var i = $.inArray(nTr, anOpen);

					if (i === -1) {

						$('.drill-val', this).html('<i class="fa fa-chevron-circle-up text-teal"></i>');

						oTable.fnOpen(nTr, fnFormatRowCreditDetails(oTable, nTr), 'details');

						anOpen.push(nTr);

					}

					else {

						$('.drill-val', this).html('<i class="fa fa-chevron-circle-down text-teal"></i>');

						oTable.fnClose(nTr);

						anOpen.splice(i, 1);

					}

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

$('#reserve_order_search').on('click', function () {

	get_reserve_order();

});

//Reserve Order

function get_reserve_order() {

	var company_name = $('#company_name').val();

	var from_date = '';

	var to_date = '';

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "RESERVE ORDER REPORT";

	var select_order = $('#select_order option:selected').html() != '' && $('#select_order option:selected').html() != undefined ? $('#select_order option:selected').html() + " - " : '';

	var status = $('#status').val() == 3 ? 'WORK IN PROCESS REPORT - ' : ($('#select_order').val() ? 'DELIVERY READY REPORT - ' : '');

	var customer = $('#ro_cus_name').html() != '' && $('#ro_cus_name').html() != undefined ? $('#ro_cus_name').html() : '';

	var product = $('#prod_select option:selected').html() != '' && $('#prod_select option:selected').html() != undefined ? $('#prod_select option:selected').html() + " - " : '';

	var design = $('#des_select option:selected').html() != '' && $('#des_select option:selected').html() != undefined ? $('#des_select option:selected').html() + " - " : '';

	var sub_design = $('#sub_des_select option:selected').html() != '' && $('#sub_des_select option:selected').html() != undefined ? $('#sub_des_select option:selected').html() + " - " : '';

	var optional = status + select_order + customer + product + design + sub_design;

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		type: "POST",

		url: base_url + "index.php/admin_ret_reports/stock_reserve_order/ajax",

		data: {

			'id_branch': $('#branch_select').val() != '' ? $('#branch_select').val() : $('#branch_filter').val(),

			'dt_range': $('#dt_range').val(),

			'status': $('#status').val(),

			'id_product': $('#prod_select').val(),

			'id_design': $('#des_select').val(),

			'id_sub_design': $('#sub_des_select').val(),

			'id_order_no': $('#select_order').val(), 'ro_cus_id': $('#ro_cus_id').val()

		},

		dataType: 'JSON',

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.list;

			$('#emp_name').val(list.emp_name);

			let a = 1;

			console.log(list);

			var oTable = $('#reserve_order_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#reserve_order_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"order": [[0, "asc"]],

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"fixedHeader": true,

					"paging": true,

					"autoWidth": true,

					"columnDefs": [

						{

							targets: [10, 11],

							className: 'dt-body-right'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', '10px');

							},

						},

						{

							extend: 'colvis',

							collectionLayout: 'fixed columns',

							collectionTitle: 'Column visibility control'

						},

						{

							extend: 'excel',

							footer: true,

							title: "Reserve Report",

						}

					],

					"aaData": list,

					"aoColumns": [

						{

							"mDataProp": function (row, type, val, meta) {

								return a++;

							}

						},

						{ "mDataProp": "branch" },

						{ "mDataProp": "customer_name" },

						{ "mDataProp": "order_no" },

						{ "mDataProp": "tag_date" },

						{ "mDataProp": "old_tag_id" },

						{ "mDataProp": "tag_code" },

						{ "mDataProp": "product_name" },

						{ "mDataProp": "design_name" },

						{ "mDataProp": "sub_design_name" },

						{ "mDataProp": "gross_wt" },

						{ "mDataProp": "net_wt" },

						{

							"mDataProp": function (row, type, val, meta) {

								if (row.status == 3) {

									status = "WORK IN READY";

								}

								else if (row.status == 4) {

									status = "DELIVERY READY";

								} else {

									status == '-'

								}

								return status;

							}

						},

					]

				});

			}

		}

	});

}

function get_customer_reserveOrders() {

	$('#select_order option').remove();

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/get_customer_reserveOrders?nocache=" + my_Date.getUTCSeconds() + '' + my_Date.getUTCMinutes() + '' + my_Date.getUTCHours(),

		type: "POST",

		data: { 'id_branch': $('#branch_select').val(), 'fin_year_code': $('#order_fin_year_select').val() },

		dataType: "JSON",

		success: function (data) {

			$.each(data, function (key, item) {

				$("#select_order").append(

					$("<option></option>")

						.attr("value", item.id_customerorder)

						.text(item.order_no)

				);

			});

			$("#select_order").select2({

				placeholder: "Select Order",

				allowClear: true

			});

			$('#select_order').select2("val", "");

			$(".overlay").css("display", "none");

		},

		error: function (error) {

		}

	});

}

$("#ro_cus_name").on("keyup", function (e) {

	var customer = $("#ro_cus_name").val();

	if (customer.length >= 2) {

		getSearchCustomers(customer);

	}

});

function getSearchCustomers(searchTxt) {

	my_Date = new Date();

	$.ajax({

		url: base_url + 'index.php/admin_ret_reports/getCustomersBySearch/?nocache=' + my_Date.getUTCSeconds(),

		dataType: "json",

		method: "POST",

		data: { 'searchTxt': searchTxt },

		success: function (data) {

			$("#ro_cus_name").autocomplete(

				{

					source: data,

					select: function (e, i) {

						e.preventDefault();

						$("#cus_info").html('');

						$("#ro_cus_name").val(i.item.label);

						$("#ro_cus_id").val(i.item.value);

					},

					change: function (event, ui) {

						if (ui.item === null) {

							$(this).val('');

							$('#ro_cus_name').val('');

							$("#ro_cus_id").val("");

						}

					},

					response: function (e, i) {

						// ui.content is the array that's about to be sent to the response callback.

						if (searchTxt != "") {

							if (i.content.length === 0) {

								$("#customerAlert").html('<p style="color:red">Enter a valid customer name / mobile</p>');

							} else {

								$("#customerAlert").html('');

							}

						} else {

						}

					},

					minLength: 3,

				});

		}

	});

}

$('#section_stock_search').on('click', function () {

	if ($('#branch_select').val() == '' && $('#branch_select').val() == null && $('#branch_filter').val() == '') {

		$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + 'Please Select Branch' });

	}

	else {

		get_section_stock_inoutdetails();

	}

});

$('#stock_group_by').on('change', function () {

	$('#stock_group_by').val(this.value);

	if (this.value == 1) {

		$('.sect').css("display", "block");

		$('.pro').css("display", "none");

		$('#prod_select').val('');

	}

	else {

		$('.sect').css("display", "none");

		$('.pro').css("display", "block");

		$('#section_select').val('');

	}

});

// function get_section_stock_inoutdetails()

// {

// 	var dt_range=($("#dt_range").val()).split('-');

// 	var sec_out_check = $('#sec_out_check').is(':checked') ? 1 : 0;

// 	var company_name    = $('#company_name').val();

// 	var from_date = dt_range[0];

// 	var to_date = dt_range[1];

// 	var branch_name    = ($('#branch_name').val()!='' && $('#branch_name').val()!=undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

// 	var report_name = "SECTION WISE STOCK REPORT";

// 	var prod_select = $('#prod_select option:selected').html() != '' && $('#prod_select option:selected').html() != undefined ? $('#prod_select option:selected').html() + ' - ' : '';

// 	var metal = $('#metal option:selected').html() != '' && $('#metal option:selected').html() != undefined ? $('#metal option:selected').html() + ' - ': '';

// 	var category = $('#category option:selected').html() != '' && $('#category option:selected').html() != undefined ? $('#category option:selected').html() + ' - ' : '';

// 	var select_group_by = $('#select_group_by option:selected').html() != '' && $('#select_group_by option:selected').html() != undefined ? $('#select_group_by option:selected').html() + ' - ' : '';

// 	var optional =  metal + category + prod_select + select_group_by;

// 	var title="<div style='text-align: center;'><b><span style='font-size:15pt;'>"+company_name+"</span></b><b><span style='font-size:12pt;'></span></b></br>"

// 	+"<span>"+report_print(branch_name,report_name,from_date,to_date,optional)+"</span>";

// 	$("div.overlay").css("display", "block");

// 	my_Date = new Date();

// 	$(".overlay").css("display", "block");

// 	$.ajax({

// 		url:base_url+ "index.php/admin_ret_reports/section_stock_inout/ajax?nocache=" + my_Date.getUTCSeconds(),

// 		data: ( {'dt_range' :$("#dt_range").val(),'id_branch':($('#branch_filter').val()!='' && $('#branch_filter').val()!=undefined ? $('#branch_filter').val(): $("#branch_select").val()),'id_section':$('#section_select').val(),'pro_id':$('#prod_select').val(),'GroupBy':$('#stock_group_by').val(),'id_metal': $('#metal').val()}),

// 		dataType:"JSON",

// 		type:"POST",

// 		success:function(data)

// 		{

// 			var list = data.list;

// 			var non_tag_items = data.non_tag_items;

// 			$("#section_stock_list > tbody > tr").remove();

// 	 		$('#section_stock_list').dataTable().fnClearTable();

//     		$('#section_stock_list').dataTable().fnDestroy();

// 				trHTML = '';

// 				tfootHTML = '';

// 				total_bill_amount = 0;

// 				total_bill_tax_value = 0;

// 				var total_op_blc_pcss = 0;

// 				var total_op_blc_gwt = 0;

// 				var total_op_blc_nwt = 0;

// 				var total_op_blc_diawt = 0;

// 				var total_op_tags = 0;

// 				var total_inw_pcss = 0;

// 				var total_inw_gwt = 0;

// 				var total_inw_nwt = 0;

// 				var total_inw_diawt = 0;

// 				var total_inw_tags = 0;

// 				var total_closing_inw_pcs=0;

// 				var total_closing_inw_gwt=0;

// 				var total_closing_net_wt=0;

// 				var total_closing_dia_wt=0;

// 				var total_closing_tags=0;

// 				var total_outward_pcs=0;

// 				var total_outward_gwt=0;

// 				var total_outward_nwt=0;

// 				var total_outward_diawt=0;

// 				var total_outward_tags=0;

// 				$.each(list, function (i, section)

// 				{

// 					var op_blc_pcss = 0;

// 					var op_blc_gwt = 0;

// 					var op_blc_nwt = 0;

// 					var op_blc_diawt = 0;

// 					var blc_tags = 0;

// 					var inw_pcss = 0;

// 					var inw_gwt = 0;

// 					var inw_nwt = 0;

// 					var inw_diawt = 0;

// 					var inw_tags = 0;

// 					var sold_pcs = 0;

// 					var sold_gwt = 0;

// 					var sold_nwt = 0;other_s_tags

// 					var sold_diawt = 0;

// 					var sold_tags = 0;

// 					var sect_out_pcs = 0;

// 					var sect_out_gwt = 0;

// 					var sect_out_nwt =0;

// 					var sect_out_dwt=0;

// 					var sect_out_tags=0;

// 					var item_sect_out_pcs = 0;

// 					var item_sect_out_gwt = 0;

// 					var item_sect_out_nwt =0;

// 					var item_sect_out_dwt=0;

// 					var item_sect_out_tags=0;

// 					var item_sect_out_diawt=0;

// 					var other_s_pcs = 0;

// 					var other_s_gwt = 0;

// 					var other_s_nwt = 0;

// 					var other_s_diawt = 0;

// 					var other_s_tags = 0;

// 					var closing_inw_pcs=0;

// 					var closing_inw_gwt=0;

// 					var closing_net_wt=0;

// 					var closing_dia_wt=0;

// 					var closing_tags=0;

// 					if($('#stock_group_by').val()==2)

// 					{

// 					    trHTML += '<tr>'

// 									+'<td style="text-align:left;" colspan="2"><strong>'+i+'</strong></td>'

// 									+'<td></td>'

// 								    +'<td></td>'

// 							    	+'<td></td>'

// 							    	+'<td></td>'

// 									+'<td></td>'

// 									+'<td></td>'

// 									+'<td></td>'

// 									+'<td></td>'

// 									+'<td></td>'

// 								    +'<td></td>'

// 							    	+'<td></td>'

// 							    	+'<td></td>'

// 							    	+'<td></td>'

// 							    	+'<td></td>'

// 							    	+'<td></td>'

// 							    	+'<td></td>'

// 									+'<td></td>'

// 							    	+'<td></td>'

// 							    	+'<td></td>'

// 							    	+'<td></td>'

// 							    	+'<td></td>'

// 							    	+'<td></td>'

// 					   			'</tr>';

// 					}

// 					$.each(section, function (idx, item)

// 					{

// 						op_blc_pcss+=parseFloat(item.op_blc_pcs);

// 						op_blc_gwt+=parseFloat(item.op_blc_gwt);

// 						op_blc_nwt+=parseFloat(item.op_blc_nwt);

// 						op_blc_diawt+=parseFloat(item.op_blc_diawt);

// 						blc_tags+=parseFloat(item.blc_tags)

// 						//Product Inward Details

// 						inw_pcss+=parseFloat(item.inw_pcs);

// 						inw_gwt+=parseFloat(item.inw_gwt);

// 						inw_nwt+=parseFloat(item.inw_nwt);

// 						inw_diawt+=parseFloat(item.inw_diawt);

// 						inw_tags+=parseFloat(item.inw_tags);

// 						//Product Inward Details

// 						//Product SOld Details

// 						sold_pcs+=parseFloat(item.sold_pcs);

// 						sold_gwt+=parseFloat(item.sold_gwt);

// 						sold_nwt+=parseFloat(item.sold_nwt);

// 						sold_diawt+=parseFloat(item.sold_diawt);

// 						sold_tags+=parseFloat(item.sold_tags);

// 						//Product SOld Details

// 						//Section Out Details

// 						if(sec_out_check==1){

// 							sect_out_pcs+=parseFloat(item.sect_out_pcs);

// 							sect_out_gwt+=parseFloat(item.sect_out_gwt);

// 							sect_out_nwt+=parseFloat(item.sect_out_nwt);

// 							sect_out_dwt+=parseFloat(item.sect_out_diawt);

// 							sect_out_tags+=parseFloat(item.sect_out_tags);

// 							item_sect_out_pcs =parseFloat(item.sect_out_pcs);

// 							item_sect_out_gwt =parseFloat(item.sect_out_gwt);

// 							item_sect_out_nwt =parseFloat(item.sect_out_nwt);

// 							item_sect_out_dwt =parseFloat(item.sect_out_diawt);

// 							item_sect_out_tags =parseFloat(item.sect_out_tags);

// 							item_sect_out_diawt =parseFloat(item.sect_out_diawt)

// 						}

// 						//Section Out Details

// 						//Other Outward Details

// 						other_s_pcs+=parseFloat(item.br_out_pcs);

// 						other_s_gwt+=parseFloat(item.br_out_gwt);

// 						other_s_nwt+=parseFloat(item.br_out_nwt);

// 						other_s_diawt+=parseFloat(item.br_out_diawt);

// 						other_s_tags+=parseFloat(item.brout_tags);

// 						//Other Outward Details

// 						//Product closing Details

// 						var closing_pcs=parseFloat(item.op_blc_pcs)+parseFloat(item.inw_pcs)-parseFloat(parseFloat(item.sold_pcs)+parseFloat(item.br_out_pcs)+parseFloat(item_sect_out_pcs));

// 						var closing_gwt=parseFloat(parseFloat(item.op_blc_gwt)+parseFloat(item.inw_gwt)-parseFloat(item.sold_gwt)-parseFloat(item.br_out_gwt)-parseFloat(item_sect_out_gwt)).toFixed(3);

// 						var closing_nwt=parseFloat(parseFloat(item.op_blc_nwt)+parseFloat(item.inw_nwt)-parseFloat(item.sold_nwt)-parseFloat(item.br_out_nwt)-parseFloat(item_sect_out_nwt)).toFixed(3);

// 						var closing_diawt=parseFloat(parseFloat(item.op_blc_diawt)+parseFloat(item.inw_diawt)-parseFloat(item.sold_diawt)-parseFloat(item.br_out_diawt)-parseFloat(item_sect_out_diawt)).toFixed(3);

// 						var closing_tag=parseFloat(parseFloat(item.blc_tags)+parseFloat(item.inw_tags)-parseFloat(item.sold_tags)-parseFloat(item.brout_tags)-parseFloat(item_sect_out_tags));

// 						trHTML += '<tr>'

// 							+'<td style="text-align:left;">'+($('#stock_group_by').val()==1 ? item.section_name : item.product_name)+'</td>'

// 							+'<td>'+money_format_india(item.blc_tags)+'</td>'

// 							+'<td>'+money_format_india(item.op_blc_pcs)+'</td>'

// 							+'<td>'+money_format_india(item.op_blc_gwt)+'</td>'

// 							+'<td>'+money_format_india(item.op_blc_nwt)+'</td>'

// 							+'<td>'+money_format_india(item.op_blc_diawt)+'</td>'

// 							+'<td>'+money_format_india(item.inw_tags)+'</td>'

// 							+'<td>'+money_format_india(item.inw_pcs)+'</td>'

// 							+'<td>'+money_format_india(item.inw_gwt)+'</td>'

// 							+'<td>'+money_format_india(item.inw_nwt)+'</td>'

// 							+'<td>'+money_format_india(item.inw_diawt)+'</td>'

// 							+'<td>'+money_format_india(parseFloat(parseFloat(item.sold_tags)+parseFloat(item.brout_tags)+parseFloat(item_sect_out_tags)))+'</td>'

// 							+'<td>'+money_format_india(parseFloat(parseFloat(item.sold_pcs)+parseFloat(item.br_out_pcs)+parseFloat(item_sect_out_pcs)))+'</td>'

// 							+'<td>'+money_format_india(parseFloat(parseFloat(item.sold_gwt)+parseFloat(item.br_out_gwt)+parseFloat(item_sect_out_gwt)).toFixed(3))+'</td>'

// 							+'<td>'+money_format_india(parseFloat(parseFloat(item.sold_nwt)+parseFloat(item.br_out_nwt)+parseFloat(item_sect_out_nwt)).toFixed(3))+'</td>'

// 							+'<td>'+money_format_india(parseFloat(parseFloat(item.sold_diawt)+parseFloat(item.br_out_diawt)+parseFloat(item_sect_out_diawt)).toFixed(3))+'</td>'

// 							+'<td>'+money_format_india(closing_tag)+'</td>'

// 							+'<td>'+money_format_india(closing_pcs)+'</td>'

// 							+'<td>'+money_format_india(closing_gwt)+'</td>'

// 							+'<td>'+money_format_india(closing_nwt)+'</td>'

// 							+'<td>'+money_format_india(closing_diawt)+'</td>'

// 							+'<td>'+money_format_india(item.in_trans_pcs)+'</td>'

// 							+'<td>'+money_format_india(parseFloat(parseFloat(closing_pcs)+parseFloat(item.in_trans_pcs)))+'</td>'

// 						'</tr>';

// 						closing_inw_pcs+=parseFloat(closing_pcs);

// 					   	closing_inw_gwt+=parseFloat(closing_gwt);

// 					   	closing_net_wt+=parseFloat(closing_nwt);

// 					   	closing_dia_wt+=parseFloat(closing_diawt);

// 					   	closing_tags+=parseFloat(closing_tag);

// 					});

// 					if($('#stock_group_by').val()==2)

// 					{

// 						trHTML += '<tr style="font-weight:bold;color:blue">' +

// 							+'<td></td>'

// 							+'<td style="text-align:left;">SUB TOTAL</td>'

// 							+'<td>'+money_format_india(blc_tags)+'</td>'

// 							+'<td>'+money_format_india(op_blc_pcss)+'</td>'

// 							+'<td>'+money_format_india(parseFloat(op_blc_gwt).toFixed(3))+'</td>'

// 							+'<td>'+money_format_india(parseFloat(op_blc_nwt).toFixed(3))+'</td>'

// 							+'<td>'+money_format_india(parseFloat(op_blc_diawt).toFixed(3))+'</td>'

// 							+'<td>'+money_format_india(inw_tags)+'</td>'

// 							+'<td>'+money_format_india(inw_pcss)+'</td>'

// 							+'<td>'+money_format_india(parseFloat(inw_gwt).toFixed(3))+'</td>'

// 							+'<td>'+money_format_india(parseFloat(inw_nwt).toFixed(3))+'</td>'

// 							+'<td>'+money_format_india(parseFloat(inw_diawt).toFixed(3))+'</td>'

// 							+'<td>'+money_format_india(parseFloat(sold_tags+other_s_pcs+sect_out_tags))+'</td>'

// 							+'<td>'+money_format_india(parseFloat(sold_pcs+other_s_pcs+sect_out_pcs))+'</td>'

// 							+'<td>'+money_format_india(parseFloat(sold_gwt+other_s_gwt+sect_out_gwt).toFixed(3))+'</td>'

// 							+'<td>'+money_format_india(parseFloat(sold_nwt+other_s_nwt+sect_out_nwt).toFixed(3))+'</td>'

// 							+'<td>'+money_format_india(parseFloat(sold_diawt+other_s_diawt+sect_out_dwt).toFixed(3))+'</td>'

// 							+'<td>'+money_format_india(closing_tags)+'</td>'

// 							+'<td>'+money_format_india(closing_inw_pcs)+'</td>'

// 							+'<td>'+money_format_india(parseFloat(closing_inw_gwt).toFixed(3))+'</td>'

// 							+'<td>'+money_format_india(parseFloat(closing_net_wt).toFixed(3))+'</td>'

// 							+'<td>'+money_format_india(parseFloat(closing_dia_wt).toFixed(3))+'</td>'

// 							+'<td></td>'

// 							+'<td></td>'

// 						'</tr>';

// 					}

// 					total_op_blc_pcss+=parseFloat(op_blc_pcss);

// 					total_op_blc_gwt+=parseFloat(op_blc_gwt);

// 					total_op_blc_nwt+=parseFloat(op_blc_nwt);

// 					total_op_blc_diawt+=parseFloat(op_blc_diawt);

// 					total_op_tags+=parseFloat(blc_tags);

// 					total_inw_pcss+=parseFloat(inw_pcss);

// 					total_inw_gwt+=parseFloat(inw_gwt);

// 					total_inw_nwt+=parseFloat(inw_nwt);

// 					total_inw_diawt+=parseFloat(inw_diawt);

// 					total_inw_tags+=parseFloat(inw_tags);

// 					total_outward_pcs+=parseFloat(sold_pcs+other_s_pcs+sect_out_pcs);

// 					total_outward_gwt+=parseFloat(sold_gwt+other_s_gwt+sect_out_gwt);

// 					total_outward_nwt+=parseFloat(sold_nwt+other_s_nwt+sect_out_nwt);

// 					total_outward_diawt+=parseFloat(sold_diawt+other_s_diawt+sect_out_dwt);

// 					total_outward_tags+=parseFloat(sold_tags+other_s_tags+sect_out_tags);

// 					total_closing_inw_pcs+=parseFloat(closing_inw_pcs);

// 					total_closing_inw_gwt+=parseFloat(closing_inw_gwt);

// 					total_closing_net_wt+=parseFloat(closing_net_wt);

// 					total_closing_dia_wt+=parseFloat(closing_dia_wt);

// 					total_closing_tags+=parseFloat(closing_tags);

// 				});

//                 trHTML += '<tr style="font-weight:bold;color:blue;">' +

// 						+'<td></td>'

// 						+'<td style="text-align:left;">GRAND TOTAL</td>'

// 						+'<td>'+money_format_india(total_op_tags)+'</td>'

// 						+'<td>'+money_format_india(total_op_blc_pcss)+'</td>'

// 						+'<td>'+money_format_india(parseFloat(total_op_blc_gwt).toFixed(3))+'</td>'

// 						+'<td>'+money_format_india(parseFloat(total_op_blc_nwt).toFixed(3))+'</td>'

// 						+'<td>'+money_format_india(parseFloat(total_op_blc_diawt).toFixed(3))+'</td>'

// 						+'<td>'+money_format_india(total_inw_tags)+'</td>'

// 						+'<td>'+money_format_india(total_inw_pcss)+'</td>'

// 						+'<td>'+money_format_india(parseFloat(total_inw_gwt).toFixed(3))+'</td>'

// 						+'<td>'+money_format_india(parseFloat(total_inw_nwt).toFixed(3))+'</td>'

// 						+'<td>'+money_format_india(parseFloat(total_inw_diawt).toFixed(3))+'</td>'

// 						+'<td>'+money_format_india(parseFloat(total_outward_tags))+'</td>'

// 						+'<td>'+money_format_india(parseFloat(total_outward_pcs))+'</td>'

// 					    +'<td>'+money_format_india(parseFloat(total_outward_gwt).toFixed(3))+'</td>'

// 						+'<td>'+money_format_india(parseFloat(total_outward_nwt).toFixed(3))+'</td>'

// 						+'<td>'+money_format_india(parseFloat(total_outward_diawt).toFixed(3))+'</td>'

// 						+'<td>'+money_format_india(total_closing_tags)+'</td>'

// 						+'<td>'+money_format_india(total_closing_inw_pcs)+'</td>'

// 						+'<td>'+money_format_india(parseFloat(total_closing_inw_gwt).toFixed(3))+'</td>'

// 						+'<td>'+money_format_india(parseFloat(total_closing_net_wt).toFixed(3))+'</td>'

// 						+'<td>'+money_format_india(parseFloat(total_closing_dia_wt).toFixed(3))+'</td>'

// 						+'<td></td>'

// 						+'<td></td>'

// 	    		 '</tr>';

// 				 var nontag_total_op_blc_pcss = 0;

// 				 var nontag_total_op_blc_gwt = 0;

// 				 var nontag_total_op_blc_nwt = 0;

// 				 var nontag_total_inw_pcss = 0;

// 				 var nontag_total_inw_gwt = 0;

// 				 var nontag_total_inw_nwt = 0;

// 				 var nontag_total_closing_inw_pcs=0;

// 				 var nontag_total_closing_inw_gwt=0;

// 				 var nontag_total_closing_net_wt=0;

// 				 var nontag_total_outward_pcs=0;

// 				 var nontag_total_outward_gwt=0;

// 				 var nontag_total_outward_nwt=0;

// 				 if(non_tag_items!='')

// 				 {

// 					 trHTML += '<tr>'

// 									+ '<td style="font-weight:bold;text-align:left;text-transform:uppercase;">Non Tag Items</td>'

// 									+'<td></td>'

// 								    +'<td></td>'

// 							    	+'<td></td>'

// 							    	+'<td></td>'

// 									+'<td></td>'

// 									+'<td></td>'

// 									+'<td></td>'

// 									+'<td></td>'

// 									+'<td></td>'

// 								    +'<td></td>'

// 							    	+'<td></td>'

// 							    	+'<td></td>'

// 							    	+'<td></td>'

// 							    	+'<td></td>'

// 							    	+'<td></td>'

// 							    	+'<td></td>'

// 									+'<td></td>'

// 							    	+'<td></td>'

// 							    	+'<td></td>'

// 							    	+'<td></td>'

// 							    	+'<td></td>'

// 							    	+'<td></td>'

// 					   			'</tr>';

// 				 }

// 				$.each(non_tag_items, function (key, section) {

// 							if($('#stock_group_by').val()==2)

// 							{

// 								trHTML += '<tr>'

// 											+'<td style="text-align:left;" colspan="2"><strong>'+key+'</strong></td>'

// 											+'<td></td>'

// 											+'<td></td>'

// 											+'<td></td>'

// 											+'<td></td>'

// 											+'<td></td>'

// 											+'<td></td>'

// 											+'<td></td>'

// 											+'<td></td>'

// 											+'<td></td>'

// 											+'<td></td>'

// 											+'<td></td>'

// 											+'<td></td>'

// 											+'<td></td>'

// 											+'<td></td>'

// 											+'<td></td>'

// 											+'<td></td>'

// 											+'<td></td>'

// 											+'<td></td>'

// 											+'<td></td>'

// 											+'<td></td>'

// 											+'<td></td>'

// 											+'<td></td>'

// 										'</tr>';

// 							}

// 							$.each(section, function (k, items) {

// 									trHTML += '<tr>'

// 										+'<td style="text-align:left;">'+($('#stock_group_by').val()==1 ? items.section_name : items.product_name)+'</td>'

// 										+'<td></td>'

// 										+ '<td>' + money_format_india(items.op_blc_pcs) + '</td>'

// 										+ '<td>' + money_format_india(items.op_blc_gwt) + '</td>'

// 										+ '<td>' + money_format_india(items.op_blc_nwt) + '</td>'

// 										+'<td></td>'

// 										+'<td></td>'

// 										+ '<td>' + money_format_india(items.inw_pcs) + '</td>'

// 										+ '<td>' + money_format_india(items.inw_gwt) + '</td>'

// 										+ '<td>' + money_format_india(items.inw_nwt) + '</td>'

// 										+'<td></td>'

// 										+'<td></td>'

// 										+ '<td>' + money_format_india(parseFloat(parseFloat(items.sales_pcs) + parseFloat(items.br_out_pcs))) + '</td>'

// 										+ '<td>' + money_format_india(parseFloat(parseFloat(items.sales_gwt) + parseFloat(items.br_out_gwt)).toFixed(3)) + '</td>'

// 										+ '<td>' + money_format_india(parseFloat(parseFloat(items.sales_nwt) + parseFloat(items.br_out_nwt)).toFixed(3)) + '</td>'

// 										+'<td></td>'

// 										+'<td></td>'

// 										+ '<td>' + money_format_india(parseFloat(parseFloat(items.op_blc_pcs) + parseFloat(items.inw_pcs) - parseFloat(items.sales_pcs) - parseFloat(items.br_out_pcs)).toFixed(0)) + '</td>'

// 										+ '<td>' + money_format_india(parseFloat(parseFloat(items.op_blc_gwt) + parseFloat(items.inw_gwt) - parseFloat(items.sales_gwt) - parseFloat(items.br_out_gwt)).toFixed(3)) + '</td>'

// 										+ '<td>' + money_format_india(parseFloat(parseFloat(items.op_blc_nwt) + parseFloat(items.inw_nwt) - parseFloat(items.sales_nwt) - parseFloat(items.br_out_nwt)).toFixed(3)) + '</td>'

// 										+'<td></td>'

// 										+ '<td></td>'

// 										+ '<td></td>'

// 									'</tr>';

// 									nontag_total_op_blc_pcss +=parseFloat(items.op_blc_pcs);

// 									nontag_total_op_blc_gwt +=parseFloat(items.op_blc_gwt);

// 									nontag_total_op_blc_nwt +=parseFloat(items.op_blc_nwt);

// 									nontag_total_inw_pcss +=parseFloat(items.inw_pcs);

// 								    nontag_total_inw_gwt +=parseFloat(items.inw_gwt);

// 									nontag_total_inw_nwt +=parseFloat(items.inw_nwt);

// 									nontag_total_closing_inw_pcs+=parseFloat(parseFloat(parseFloat(items.op_blc_pcs) + parseFloat(items.inw_pcs) - parseFloat(items.sales_pcs) - parseFloat(items.br_out_pcs)));

// 									nontag_total_closing_inw_gwt+=parseFloat(parseFloat(parseFloat(items.op_blc_gwt) + parseFloat(items.inw_gwt) - parseFloat(items.sales_gwt) - parseFloat(items.br_out_gwt)));

// 									nontag_total_closing_net_wt+=parseFloat(parseFloat(parseFloat(items.op_blc_nwt) + parseFloat(items.inw_nwt) - parseFloat(items.sales_nwt) - parseFloat(items.br_out_nwt)));

// 									nontag_total_outward_pcs+=parseFloat(parseFloat(items.sales_pcs) + parseFloat(items.br_out_pcs));

// 									nontag_total_outward_gwt+=parseFloat(parseFloat(items.sales_gwt) + parseFloat(items.br_out_gwt));

// 									nontag_total_outward_nwt+=parseFloat(parseFloat(items.sales_nwt) + parseFloat(items.br_out_nwt));

// 							});

// 		});

// 				trHTML += '<tr style="font-weight:bold; color:blue;">' +

// 				+'<td></td>'

// 				+ '<td style="text-align:left;">GRAND TOTAL</td>'

// 				+'<td></td>'

// 				+ '<td>' + money_format_india(nontag_total_op_blc_pcss) + '</td>'

// 				+ '<td>' + money_format_india(parseFloat(nontag_total_op_blc_gwt).toFixed(3)) + '</td>'

// 				+ '<td>' + money_format_india(parseFloat(nontag_total_op_blc_nwt).toFixed(3)) + '</td>'

// 				+'<td></td>'

// 				+'<td></td>'

// 				+ '<td>' + money_format_india(nontag_total_inw_pcss) + '</td>'

// 				+ '<td>' + money_format_india(parseFloat(nontag_total_inw_gwt).toFixed(3)) + '</td>'

// 				+ '<td>' + money_format_india(parseFloat(nontag_total_inw_nwt).toFixed(3)) + '</td>'

// 				+'<td></td>'

// 				+'<td></td>'

// 				+ '<td>' + money_format_india(parseFloat(nontag_total_outward_pcs)) + '</td>'

// 				+ '<td>' + money_format_india(parseFloat(nontag_total_outward_gwt).toFixed(3)) + '</td>'

// 				+ '<td>' + money_format_india(parseFloat(nontag_total_outward_nwt).toFixed(3)) + '</td>'

// 				+'<td></td>'

// 				+'<td></td>'

// 				+ '<td>' + money_format_india(parseFloat(nontag_total_closing_inw_pcs).toFixed(0)) + '</td>'

// 				+ '<td>' + money_format_india(parseFloat(nontag_total_closing_inw_gwt).toFixed(3)) + '</td>'

// 				+ '<td>' + money_format_india(parseFloat(nontag_total_closing_net_wt).toFixed(3)) + '</td>'

// 				+'<td></td>'

// 				+ '<td></td>'

// 				+ '<td></td>'

// 		    '</tr>';

// 				trHTML += '<tr style="font-weight:bold;color:red;">' +

// 				+'<td></td>'

// 				+'<td style="text-align:left;">GRAND TOTAL</td>'

// 				+'<td>'+money_format_india(total_op_tags)+'</td>'

// 				+'<td>'+money_format_india(total_op_blc_pcss + nontag_total_op_blc_pcss)+'</td>'

// 				+'<td>'+money_format_india(parseFloat(total_op_blc_gwt + nontag_total_op_blc_gwt).toFixed(3))+'</td>'

// 				+'<td>'+money_format_india(parseFloat(total_op_blc_nwt + nontag_total_op_blc_nwt).toFixed(3))+'</td>'

// 				+'<td>'+money_format_india(parseFloat(total_op_blc_diawt).toFixed(3))+'</td>'

// 				+'<td>'+money_format_india(total_inw_tags)+'</td>'

// 				+'<td>'+money_format_india(total_inw_pcss + nontag_total_inw_pcss)+'</td>'

// 				+'<td>'+money_format_india(parseFloat(total_inw_gwt + nontag_total_inw_gwt).toFixed(3))+'</td>'

// 				+'<td>'+money_format_india(parseFloat(total_inw_nwt + nontag_total_inw_nwt).toFixed(3))+'</td>'

// 				+'<td>'+money_format_india(parseFloat(total_inw_diawt).toFixed(3))+'</td>'

// 				+'<td>'+money_format_india(parseFloat(total_outward_tags))+'</td>'

// 				+'<td>'+money_format_india(parseFloat(total_outward_pcs + nontag_total_outward_pcs))+'</td>'

// 				+'<td>'+money_format_india(parseFloat(total_outward_gwt + nontag_total_outward_gwt).toFixed(3))+'</td>'

// 				+'<td>'+money_format_india(parseFloat(total_outward_nwt + nontag_total_outward_nwt ).toFixed(3))+'</td>'

// 				+'<td>'+money_format_india(parseFloat(total_outward_diawt).toFixed(3))+'</td>'

// 				+'<td>'+money_format_india(total_closing_tags)+'</td>'

// 				+'<td>'+money_format_india(total_closing_inw_pcs + nontag_total_closing_inw_pcs)+'</td>'

// 				+'<td>'+money_format_india(parseFloat(total_closing_inw_gwt + nontag_total_closing_inw_gwt).toFixed(3))+'</td>'

// 				+'<td>'+money_format_india(parseFloat(total_closing_net_wt + nontag_total_closing_net_wt).toFixed(3))+'</td>'

// 				+'<td>'+money_format_india(parseFloat(total_closing_dia_wt).toFixed(3))+'</td>'

// 				+'<td></td>'

// 				+'<td></td>'

// 	        '</tr>';

// 				 trHTML += '<tr style="font-weight:bold;">' +

// 				 +'<td></td>'

// 				 + '<td style="text-align:left;">TOTAL SUMMARY</td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 			 '</tr>';

// 			 trHTML += '<tr style="font-weight:bold;">' +

// 				 +'<td></td>'

// 				 + '<td style="text-align:left;">#</td>'

// 				 + '<td>No.Tags</td>'

// 				 + '<td>PCS</td>'

// 				 + '<td>G.WT</td>'

// 				 + '<td>N.WT</td>'

// 				 + '<td>D.WT</td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 			 '</tr>';

// 			 trHTML += '<tr style="font-weight:bold;">' +

// 				 +'<td></td>'

// 				 + '<td style="text-align:left;">OPENING</td>'

// 				 + '<td>' + money_format_india(total_op_tags) + '</td>'

// 				 + '<td>' + money_format_india(total_op_blc_pcss + nontag_total_op_blc_pcss) + '</td>'

// 				 + '<td>' + money_format_india(parseFloat(total_op_blc_gwt + nontag_total_op_blc_gwt).toFixed(3)) + '</td>'

// 				 + '<td>' + money_format_india(parseFloat(total_op_blc_nwt + nontag_total_op_blc_nwt).toFixed(3)) + '</td>'

// 				 + '<td>' + money_format_india(parseFloat(total_op_blc_diawt).toFixed(3)) + '</td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 			 '</tr>';

// 			 trHTML += '<tr style="font-weight:bold;">' +

// 				 +'<td></td>'

// 				 + '<td style="text-align:left;">INWARD</td>'

// 				 + '<td>' + money_format_india(total_inw_tags) + '</td>'

// 				 + '<td>' + money_format_india(total_inw_pcss + nontag_total_inw_pcss) + '</td>'

// 				 + '<td>' + money_format_india(parseFloat(total_inw_gwt + nontag_total_inw_gwt).toFixed(3)) + '</td>'

// 				 + '<td>' + money_format_india(parseFloat(total_inw_nwt + nontag_total_inw_nwt).toFixed(3)) + '</td>'

// 				 + '<td>' + money_format_india(parseFloat(total_inw_diawt).toFixed(3)) + '</td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 			 '</tr>';

// 			 trHTML += '<tr style="font-weight:bold;">' +

// 				 +'<td></td>'

// 				 + '<td style="text-align:left;">OUTWARD</td>'

// 				 + '<td>' + money_format_india(parseFloat(total_outward_tags)) + '</td>'

// 				 + '<td>' + money_format_india(parseFloat(total_outward_pcs + nontag_total_outward_pcs)) + '</td>'

// 				 + '<td>' + money_format_india(parseFloat(total_outward_gwt + nontag_total_outward_gwt).toFixed(3)) + '</td>'

// 				 + '<td>' + money_format_india(parseFloat(total_outward_nwt  + nontag_total_outward_nwt ).toFixed(3)) + '</td>'

// 				 + '<td>' + money_format_india(parseFloat(total_outward_diawt).toFixed(3)) + '</td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 			 '</tr>';

// 			 trHTML += '<tr style="font-weight:bold;">' +

// 				 +'<td></td>'

// 				 + '<td style="text-align:left;">CLOSING</td>'

// 				 + '<td>' + money_format_india(total_closing_tags) + '</td>'

// 				 + '<td>' + money_format_india(total_closing_inw_pcs + nontag_total_closing_inw_pcs) + '</td>'

// 				 + '<td>' + money_format_india(parseFloat(total_closing_inw_gwt + nontag_total_closing_inw_gwt).toFixed(3)) + '</td>'

// 				 + '<td>' + money_format_india(parseFloat(total_closing_net_wt + nontag_total_closing_net_wt).toFixed(3)) + '</td>'

// 				 + '<td>' + money_format_india(parseFloat(total_closing_dia_wt).toFixed(3)) + '</td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 				 + '<td></td>'

// 			 '</tr>';

// 				$('#section_stock_list > tbody').html(trHTML);

// 				// Check and initialise datatable

// 				if ( ! $.fn.DataTable.isDataTable( '#section_stock_list' ) )

// 				{

// 					oTable = $('#section_stock_list').dataTable({

// 					"bSort": false,

// 					"bInfo": true,

// 					"scrollX":'100%',

// 					"dom": 'lBfrtip',

// 					"paging":false,

// 					"bAutoWidth": false,

// 					"columnDefs": [

// 						{

// 							targets: [1, 2, 3, 4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22],

// 							className: 'dt-body-right'

// 						},

// 					],

// 					"buttons": [

// 					{

// 						extend: 'print',

// 						footer: true,

// 						title: '',

// 						messageTop: title,

// 						customize: function ( win ) {

// 						$(win.document.body).find( 'table' )

// 						.addClass( 'compact' )

// 						.css( 'font-size', 'inherit' );

// 						},

// 					},

// 					{

//                         extend: 'colvis',

//                         collectionLayout: 'fixed columns',

//                         collectionTitle: 'Column visibility control'

//                     },

// 					{

// 						extend:'excel',

// 						footer: true,

// 						title: 'SECTION WISE STOCK REPORT '+branch_name+'-'+dt_range[0]+'-'+dt_range[1],

// 					}

// 					],

// 					});

// 				}

// 			$(".overlay").css("display", "none");

// 		}

// 	});

// }

function get_section_stock_inoutdetails_16_10_2023() {

	var dt_range = ($("#dt_range").val()).split('-');

	var sec_out_check = $('#sec_out_check').is(':checked') ? 1 : 0;

	var company_name = $('#company_name').val();

	var from_date = dt_range[0];

	var to_date = dt_range[1];

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "SECTION WISE STOCK REPORT";

	var prod_select = $('#prod_select option:selected').html() != '' && $('#prod_select option:selected').html() != undefined ? $('#prod_select option:selected').html() + ' - ' : '';

	var metal = $('#metal option:selected').html() != '' && $('#metal option:selected').html() != undefined ? $('#metal option:selected').html() + ' - ' : '';

	var category = $('#category option:selected').html() != '' && $('#category option:selected').html() != undefined ? $('#category option:selected').html() + ' - ' : '';

	var select_group_by = $('#select_group_by option:selected').html() != '' && $('#select_group_by option:selected').html() != undefined ? $('#select_group_by option:selected').html() + ' - ' : '';

	var optional = metal + category + prod_select + select_group_by;

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/section_stock_inout/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'dt_range': $("#dt_range").val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'id_section': $('#section_select').val(), 'pro_id': $('#prod_select').val(), 'GroupBy': $('#stock_group_by').val(), 'id_metal': $('#metal').val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			var non_tag_items = data.non_tag_items;

			$("#section_stock_list > tbody > tr").remove();

			$('#section_stock_list').dataTable().fnClearTable();

			$('#section_stock_list').dataTable().fnDestroy();

			trHTML = '';

			tfootHTML = '';

			total_bill_amount = 0;

			total_bill_tax_value = 0;

			var total_op_blc_pcss = 0;

			var total_op_blc_gwt = 0;

			var total_op_blc_nwt = 0;

			var total_op_blc_diawt = 0;

			var total_op_tags = 0;

			var total_inw_pcss = 0;

			var total_inw_gwt = 0;

			var total_inw_nwt = 0;

			var total_inw_diawt = 0;

			var total_inw_tags = 0;

			var total_closing_inw_pcs = 0;

			var total_closing_inw_gwt = 0;

			var total_closing_net_wt = 0;

			var total_closing_dia_wt = 0;

			var total_closing_tags = 0;

			var total_outward_pcs = 0;

			var total_outward_gwt = 0;

			var total_outward_nwt = 0;

			var total_outward_diawt = 0;

			var total_outward_tags = 0;

			$.each(list, function (i, section) {

				var op_blc_pcss = 0;

				var op_blc_gwt = 0;

				var op_blc_nwt = 0;

				var op_blc_diawt = 0;

				var blc_tags = 0;

				var inw_pcss = 0;

				var inw_gwt = 0;

				var inw_nwt = 0;

				var inw_diawt = 0;

				var inw_tags = 0;

				var sold_pcs = 0;

				var sold_gwt = 0;

				var sold_nwt = 0; other_s_tags

				var sold_diawt = 0;

				var sold_tags = 0;

				var sect_out_pcs = 0;

				var sect_out_gwt = 0;

				var sect_out_nwt = 0;

				var sect_out_dwt = 0;

				var sect_out_tags = 0;

				var item_sect_out_pcs = 0;

				var item_sect_out_gwt = 0;

				var item_sect_out_nwt = 0;

				var item_sect_out_dwt = 0;

				var item_sect_out_tags = 0;

				var item_sect_out_diawt = 0;

				var other_s_pcs = 0;

				var other_s_gwt = 0;

				var other_s_nwt = 0;

				var other_s_diawt = 0;

				var other_s_tags = 0;

				var closing_inw_pcs = 0;

				var closing_inw_gwt = 0;

				var closing_net_wt = 0;

				var closing_dia_wt = 0;

				var closing_tags = 0;

				if ($('#stock_group_by').val() == 2) {

					trHTML += '<tr>'

						+ '<td style="text-align:left;" colspan="2"><strong>' + i + '</strong></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

					'</tr>';

				}

				$.each(section, function (idx, item) {

					op_blc_pcss += parseFloat(item.op_blc_pcs);

					op_blc_gwt += parseFloat(item.op_blc_gwt);

					op_blc_nwt += parseFloat(item.op_blc_nwt);

					op_blc_diawt += parseFloat(item.op_blc_diawt);

					blc_tags += parseFloat(item.blc_tags)

					//Product Inward Details

					inw_pcss += parseFloat(item.inw_pcs);

					inw_gwt += parseFloat(item.inw_gwt);

					inw_nwt += parseFloat(item.inw_nwt);

					inw_diawt += parseFloat(item.inw_diawt);

					inw_tags += parseFloat(item.inw_tags);

					//Product Inward Details

					//Product SOld Details

					sold_pcs += parseFloat(item.sold_pcs);

					sold_gwt += parseFloat(item.sold_gwt);

					sold_nwt += parseFloat(item.sold_nwt);

					sold_diawt += parseFloat(item.sold_diawt);

					sold_tags += parseFloat(item.sold_tags);

					//Product SOld Details

					//Section Out Details

					if (sec_out_check == 1) {

						sect_out_pcs += parseFloat(item.sect_out_pcs);

						sect_out_gwt += parseFloat(item.sect_out_gwt);

						sect_out_nwt += parseFloat(item.sect_out_nwt);

						sect_out_dwt += parseFloat(item.sect_out_diawt);

						sect_out_tags += parseFloat(item.sect_out_tags);

						item_sect_out_pcs = parseFloat(item.sect_out_pcs);

						item_sect_out_gwt = parseFloat(item.sect_out_gwt);

						item_sect_out_nwt = parseFloat(item.sect_out_nwt);

						item_sect_out_dwt = parseFloat(item.sect_out_diawt);

						item_sect_out_tags = parseFloat(item.sect_out_tags);

						item_sect_out_diawt = parseFloat(item.sect_out_diawt)

					}

					//Section Out Details

					//Other Outward Details

					other_s_pcs += parseFloat(item.br_out_pcs);

					other_s_gwt += parseFloat(item.br_out_gwt);

					other_s_nwt += parseFloat(item.br_out_nwt);

					other_s_diawt += parseFloat(item.br_out_diawt);

					other_s_tags += parseFloat(item.brout_tags);

					//Other Outward Details

					//Product closing Details

					var closing_pcs = parseFloat(item.op_blc_pcs) + parseFloat(item.inw_pcs) - parseFloat(parseFloat(item.sold_pcs) + parseFloat(item.br_out_pcs) + parseFloat(item_sect_out_pcs));

					var closing_gwt = parseFloat(parseFloat(item.op_blc_gwt) + parseFloat(item.inw_gwt) - parseFloat(item.sold_gwt) - parseFloat(item.br_out_gwt) - parseFloat(item_sect_out_gwt)).toFixed(3);

					var closing_nwt = parseFloat(parseFloat(item.op_blc_nwt) + parseFloat(item.inw_nwt) - parseFloat(item.sold_nwt) - parseFloat(item.br_out_nwt) - parseFloat(item_sect_out_nwt)).toFixed(3);

					var closing_diawt = parseFloat(parseFloat(item.op_blc_diawt) + parseFloat(item.inw_diawt) - parseFloat(item.sold_diawt) - parseFloat(item.br_out_diawt) - parseFloat(item_sect_out_diawt)).toFixed(3);

					var closing_tag = parseFloat(parseFloat(item.blc_tags) + parseFloat(item.inw_tags) - parseFloat(item.sold_tags) - parseFloat(item.brout_tags) - parseFloat(item_sect_out_tags));

					trHTML += '<tr>'

						+ '<td style="text-align:left;">' + ($('#stock_group_by').val() == 1 ? item.section_name : item.product_name) + '</td>'

						+ '<td>' + (item.blc_tags > 0 ? money_format_india(item.blc_tags) : '') + '</td>'

						+ '<td>' + (item.op_blc_pcs > 0 ? money_format_india(item.op_blc_pcs) : '') + '</td>'

						+ '<td>' + (item.op_blc_gwt > 0 ? money_format_india(item.op_blc_gwt) : '') + '</td>'

						+ '<td>' + (item.op_blc_nwt > 0 ? money_format_india(item.op_blc_nwt) : '') + '</td>'

						+ '<td>' + (item.op_blc_diawt > 0 ? money_format_india(item.op_blc_diawt) : '') + '</td>'

						+ '<td>' + (item.inw_tags > 0 ? money_format_india(item.inw_tags) : '') + '</td>'

						+ '<td>' + (item.inw_pcs > 0 ? money_format_india(item.inw_pcs) : '') + '</td>'

						+ '<td>' + (item.inw_gwt > 0 ? money_format_india(item.inw_gwt) : '') + '</td>'

						+ '<td>' + (item.inw_nwt > 0 ? money_format_india(item.inw_nwt) : '') + '</td>'

						+ '<td>' + (item.inw_diawt > 0 ? money_format_india(item.inw_diawt) : '') + '</td>'

						+ '<td>' + (item.sold_tags > 0 || item.brout_tags > 0 || item_sect_out_tags > 0 ? money_format_india(parseFloat(parseFloat(item.sold_tags) + parseFloat(item.brout_tags) + parseFloat(item_sect_out_tags))) : '') + '</td>'

						+ '<td>' + (item.sold_pcs > 0 || item.br_out_pcs > 0 || item_sect_out_pcs > 0 ? money_format_india(parseFloat(parseFloat(item.sold_pcs) + parseFloat(item.br_out_pcs) + parseFloat(item_sect_out_pcs)).toFixed(3)) : '') + '</td>'

						+ '<td>' + (item.sold_gwt > 0 || item.br_out_gwt > 0 || item_sect_out_gwt > 0 ? money_format_india(parseFloat(parseFloat(item.sold_gwt) + parseFloat(item.br_out_gwt) + parseFloat(item_sect_out_gwt)).toFixed(3)) : '') + '</td>'

						+ '<td>' + (item.sold_nwt > 0 || item.br_out_nwt > 0 || item_sect_out_nwt > 0 ? money_format_india(parseFloat(parseFloat(item.sold_nwt) + parseFloat(item.br_out_nwt) + parseFloat(item_sect_out_nwt)).toFixed(3)) : '') + '</td>'

						+ '<td>' + (item.sold_diawt > 0 || item.br_out_diawt > 0 || item_sect_out_diawt > 0 ? money_format_india(parseFloat(parseFloat(item.sold_diawt) + parseFloat(item.br_out_diawt) + parseFloat(item_sect_out_diawt)).toFixed(3)) : '') + '</td>'

						+ '<td>' + (closing_tag > 0 ? money_format_india(closing_tag) : '') + '</td>'

						+ '<td>' + (closing_pcs > 0 ? money_format_india(closing_pcs) : '') + '</td>'

						+ '<td>' + (closing_gwt > 0 ? money_format_india(closing_gwt) : '') + '</td>'

						+ '<td>' + (closing_nwt > 0 ? money_format_india(closing_nwt) : '') + '</td>'

						+ '<td>' + (closing_diawt > 0 ? money_format_india(closing_diawt) : '') + '</td>'

						+ '<td>' + (item.in_trans_pcs > 0 ? money_format_india(item.in_trans_pcs) : '') + '</td>'

						+ '<td>' + (closing_pcs || item.in_trans_pcs > 0 ? money_format_india(parseFloat(parseFloat(closing_pcs) + parseFloat(item.in_trans_pcs))) : '') + '</td>'

					'</tr>';

					closing_inw_pcs += parseFloat(closing_pcs);

					closing_inw_gwt += parseFloat(closing_gwt);

					closing_net_wt += parseFloat(closing_nwt);

					closing_dia_wt += parseFloat(closing_diawt);

					closing_tags += parseFloat(closing_tag);

				});

				if ($('#stock_group_by').val() == 2) {

					trHTML += '<tr style="font-weight:bold;color:blue">' +

						+'<td></td>'

						+ '<td style="text-align:left;">SUB TOTAL</td>'

						+ '<td>' + (blc_tags > 0 ? money_format_india(blc_tags) : '') + '</td>'

						+ '<td>' + (op_blc_pcss > 0 ? money_format_india(op_blc_pcss) : '') + '</td>'

						+ '<td>' + (op_blc_gwt > 0 ? money_format_india(parseFloat(op_blc_gwt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (op_blc_nwt > 0 ? money_format_india(parseFloat(op_blc_nwt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (op_blc_diawt > 0 ? money_format_india(parseFloat(op_blc_diawt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (inw_tags > 0 ? money_format_india(inw_tags) : '') + '</td>'

						+ '<td>' + (inw_pcss > 0 ? money_format_india(inw_pcss) : '') + '</td>'

						+ '<td>' + (inw_gwt > 0 ? money_format_india(parseFloat(inw_gwt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (inw_nwt > 0 ? money_format_india(parseFloat(inw_nwt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (inw_diawt > 0 ? money_format_india(parseFloat(inw_diawt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (sold_tags || other_s_pcs || sect_out_tags > 0 ? money_format_india(parseFloat(sold_tags + other_s_pcs + sect_out_tags)) : '') + '</td>'

						+ '<td>' + (sold_pcs || other_s_pcs || sect_out_pcs > 0 ? money_format_india(parseFloat(sold_pcs + other_s_pcs + sect_out_pcs)) : '') + '</td>'

						+ '<td>' + (sold_gwt || other_s_gwt || sect_out_gwt > 0 ? money_format_india(parseFloat(sold_gwt + other_s_gwt + sect_out_gwt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (sold_nwt || other_s_nwt || sect_out_nwt > 0 ? money_format_india(parseFloat(sold_nwt + other_s_nwt + sect_out_nwt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (sold_diawt || other_s_diawt || sect_out_dwt > 0 ? money_format_india(parseFloat(sold_diawt + other_s_diawt + sect_out_dwt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (closing_tags > 0 ? money_format_india(closing_tags) : '') + '</td>'

						+ '<td>' + (closing_inw_pcs > 0 ? money_format_india(closing_inw_pcs) : '') + '</td>'

						+ '<td>' + (closing_inw_gwt > 0 ? money_format_india(parseFloat(closing_inw_gwt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (closing_net_wt > 0 ? money_format_india(parseFloat(closing_net_wt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (closing_dia_wt > 0 ? money_format_india(parseFloat(closing_dia_wt).toFixed(3)) : '') + '</td>'

						+ '<td></td>'

						+ '<td></td>'

					'</tr>';

				}

				total_op_blc_pcss += parseFloat(op_blc_pcss);

				total_op_blc_gwt += parseFloat(op_blc_gwt);

				total_op_blc_nwt += parseFloat(op_blc_nwt);

				total_op_blc_diawt += parseFloat(op_blc_diawt);

				total_op_tags += parseFloat(blc_tags);

				total_inw_pcss += parseFloat(inw_pcss);

				total_inw_gwt += parseFloat(inw_gwt);

				total_inw_nwt += parseFloat(inw_nwt);

				total_inw_diawt += parseFloat(inw_diawt);

				total_inw_tags += parseFloat(inw_tags);

				total_outward_pcs += parseFloat(sold_pcs + other_s_pcs + sect_out_pcs);

				total_outward_gwt += parseFloat(sold_gwt + other_s_gwt + sect_out_gwt);

				total_outward_nwt += parseFloat(sold_nwt + other_s_nwt + sect_out_nwt);

				total_outward_diawt += parseFloat(sold_diawt + other_s_diawt + sect_out_dwt);

				total_outward_tags += parseFloat(sold_tags + other_s_tags + sect_out_tags);

				total_closing_inw_pcs += parseFloat(closing_inw_pcs);

				total_closing_inw_gwt += parseFloat(closing_inw_gwt);

				total_closing_net_wt += parseFloat(closing_net_wt);

				total_closing_dia_wt += parseFloat(closing_dia_wt);

				total_closing_tags += parseFloat(closing_tags);

			});

			trHTML += '<tr style="font-weight:bold;color:blue;">' +

				+'<td></td>'

				+ '<td style="text-align:left;">GRAND TOTAL</td>'

				+ '<td>' + (total_op_tags > 0 ? money_format_india(total_op_tags) : '') + '</td>'

				+ '<td>' + (total_op_blc_pcss > 0 ? money_format_india(total_op_blc_pcss) : '') + '</td>'

				+ '<td>' + (total_op_blc_gwt > 0 ? money_format_india(parseFloat(total_op_blc_gwt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_op_blc_nwt > 0 ? money_format_india(parseFloat(total_op_blc_nwt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_op_blc_diawt > 0 ? money_format_india(parseFloat(total_op_blc_diawt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_inw_tags > 0 ? money_format_india(total_inw_tags) : '') + '</td>'

				+ '<td>' + (total_inw_pcss > 0 ? money_format_india(total_inw_pcss) : '') + '</td>'

				+ '<td>' + (total_inw_gwt > 0 ? money_format_india(parseFloat(total_inw_gwt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_inw_nwt > 0 ? money_format_india(parseFloat(total_inw_nwt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_inw_diawt > 0 ? money_format_india(parseFloat(total_inw_diawt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_outward_tags > 0 ? money_format_india(parseFloat(total_outward_tags)) : '') + '</td>'

				+ '<td>' + (total_outward_pcs > 0 ? money_format_india(parseFloat(total_outward_pcs)) : '') + '</td>'

				+ '<td>' + (total_outward_gwt > 0 ? money_format_india(parseFloat(total_outward_gwt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_outward_nwt > 0 ? money_format_india(parseFloat(total_outward_nwt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_outward_diawt > 0 ? money_format_india(parseFloat(total_outward_diawt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_closing_tags > 0 ? money_format_india(total_closing_tags) : '') + '</td>'

				+ '<td>' + (total_closing_inw_pcs > 0 ? money_format_india(total_closing_inw_pcs) : '') + '</td>'

				+ '<td>' + (total_closing_inw_gwt > 0 ? money_format_india(parseFloat(total_closing_inw_gwt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_closing_net_wt > 0 ? money_format_india(parseFloat(total_closing_net_wt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_closing_dia_wt > 0 ? money_format_india(parseFloat(total_closing_dia_wt).toFixed(3)) : '') + '</td>'

				+ '<td></td>'

				+ '<td></td>'

			'</tr>';

			var nontag_total_op_blc_pcss = 0;

			var nontag_total_op_blc_gwt = 0;

			var nontag_total_op_blc_nwt = 0;

			var nontag_total_inw_pcss = 0;

			var nontag_total_inw_gwt = 0;

			var nontag_total_inw_nwt = 0;

			var nontag_total_closing_inw_pcs = 0;

			var nontag_total_closing_inw_gwt = 0;

			var nontag_total_closing_net_wt = 0;

			var nontag_total_outward_pcs = 0;

			var nontag_total_outward_gwt = 0;

			var nontag_total_outward_nwt = 0;

			if (non_tag_items != '') {

				trHTML += '<tr>'

					+ '<td style="font-weight:bold;text-align:left;text-transform:uppercase;">Non Tag Items</td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

				'</tr>';

			}

			$.each(non_tag_items, function (key, section) {

				if ($('#stock_group_by').val() == 2) {

					trHTML += '<tr>'

						+ '<td style="text-align:left;" colspan="2"><strong>' + key + '</strong></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

					'</tr>';

				}

				$.each(section, function (k, items) {

					trHTML += '<tr>'

						+ '<td style="text-align:left;">' + ($('#stock_group_by').val() == 1 ? items.section_name : items.product_name) + '</td>'

						+ '<td></td>'

						+ '<td>' + (items.op_blc_pcs > 0 ? money_format_india(items.op_blc_pcs) : '') + '</td>'

						+ '<td>' + (items.op_blc_gwt > 0 ? money_format_india(items.op_blc_gwt) : '') + '</td>'

						+ '<td>' + (items.op_blc_nwt > 0 ? money_format_india(items.op_blc_nwt) : '') + '</td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td>' + (items.inw_pcs > 0 ? money_format_india(items.inw_pcs) : '') + '</td>'

						+ '<td>' + (items.inw_gwt > 0 ? money_format_india(items.inw_gwt) : '') + '</td>'

						+ '<td>' + (items.inw_nwt > 0 ? money_format_india(items.inw_nwt) : '') + '</td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td>' + (items.sales_pcs > 0 || items.br_out_pcs > 0 ? money_format_india(parseFloat(parseFloat(items.sales_pcs) + parseFloat(items.br_out_pcs))) : '') + '</td>'

						+ '<td>' + (items.sales_gwt > 0 || items.br_out_gwt > 0 ? money_format_india(parseFloat(parseFloat(items.sales_gwt) + parseFloat(items.br_out_gwt)).toFixed(3)) : '') + '</td>'

						+ '<td>' + (items.sales_nwt > 0 || items.br_out_nwt > 0 ? money_format_india(parseFloat(parseFloat(items.sales_nwt) + parseFloat(items.br_out_nwt)).toFixed(3)) : '') + '</td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td>' + (items.op_blc_pcs > 0 || items.inw_pcs > 0 || items.sales_pcs > 0 || items.br_out_pcs > 0 ? money_format_india(parseFloat(parseFloat(items.op_blc_pcs) + parseFloat(items.inw_pcs) - parseFloat(items.sales_pcs) - parseFloat(items.br_out_pcs)).toFixed(0)) : '') + '</td>'

						+ '<td>' + (items.op_blc_gwt > 0 || items.inw_gwt > 0 || items.sales_gwt > 0 || items.br_out_gwt > 0 ? money_format_india(parseFloat(parseFloat(items.op_blc_gwt) + parseFloat(items.inw_gwt) - parseFloat(items.sales_gwt) - parseFloat(items.br_out_gwt)).toFixed(3)) : '') + '</td>'

						+ '<td>' + (items.op_blc_nwt > 0 || items.inw_nwt > 0 || items.sales_nwt > 0 || items.br_out_nwt > 0 ? money_format_india(parseFloat(parseFloat(items.op_blc_nwt) + parseFloat(items.inw_nwt) - parseFloat(items.sales_nwt) - parseFloat(items.br_out_nwt)).toFixed(3)) : '') + '</td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

					'</tr>';

					nontag_total_op_blc_pcss += parseFloat(items.op_blc_pcs);

					nontag_total_op_blc_gwt += parseFloat(items.op_blc_gwt);

					nontag_total_op_blc_nwt += parseFloat(items.op_blc_nwt);

					nontag_total_inw_pcss += parseFloat(items.inw_pcs);

					nontag_total_inw_gwt += parseFloat(items.inw_gwt);

					nontag_total_inw_nwt += parseFloat(items.inw_nwt);

					nontag_total_closing_inw_pcs += parseFloat(parseFloat(parseFloat(items.op_blc_pcs) + parseFloat(items.inw_pcs) - parseFloat(items.sales_pcs) - parseFloat(items.br_out_pcs)));

					nontag_total_closing_inw_gwt += parseFloat(parseFloat(parseFloat(items.op_blc_gwt) + parseFloat(items.inw_gwt) - parseFloat(items.sales_gwt) - parseFloat(items.br_out_gwt)));

					nontag_total_closing_net_wt += parseFloat(parseFloat(parseFloat(items.op_blc_nwt) + parseFloat(items.inw_nwt) - parseFloat(items.sales_nwt) - parseFloat(items.br_out_nwt)));

					nontag_total_outward_pcs += parseFloat(parseFloat(items.sales_pcs) + parseFloat(items.br_out_pcs));

					nontag_total_outward_gwt += parseFloat(parseFloat(items.sales_gwt) + parseFloat(items.br_out_gwt));

					nontag_total_outward_nwt += parseFloat(parseFloat(items.sales_nwt) + parseFloat(items.br_out_nwt));

				});

			});

			trHTML += '<tr style="font-weight:bold; color:blue;">' +

				+'<td></td>'

				+ '<td style="text-align:left;">GRAND TOTAL</td>'

				+ '<td></td>'

				+ '<td>' + (nontag_total_op_blc_pcss > 0 ? money_format_india(nontag_total_op_blc_pcss) : "") + '</td>'

				+ '<td>' + (nontag_total_op_blc_gwt > 0 ? money_format_india(parseFloat(nontag_total_op_blc_gwt).toFixed(3)) : "") + '</td>'

				+ '<td>' + (nontag_total_op_blc_nwt > 0 ? money_format_india(parseFloat(nontag_total_op_blc_nwt).toFixed(3)) : "") + '</td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td>' + (nontag_total_inw_pcss > 0 ? money_format_india(nontag_total_inw_pcss) : "") + '</td>'

				+ '<td>' + (nontag_total_inw_gwt > 0 ? money_format_india(parseFloat(nontag_total_inw_gwt).toFixed(3)) : "") + '</td>'

				+ '<td>' + (nontag_total_inw_nwt > 0 ? money_format_india(parseFloat(nontag_total_inw_nwt).toFixed(3)) : "") + '</td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td>' + (nontag_total_outward_pcs > 0 ? money_format_india(parseFloat(nontag_total_outward_pcs)) : "") + '</td>'

				+ '<td>' + (nontag_total_outward_gwt > 0 ? money_format_india(parseFloat(nontag_total_outward_gwt).toFixed(3)) : "") + '</td>'

				+ '<td>' + (nontag_total_outward_nwt > 0 ? money_format_india(parseFloat(nontag_total_outward_nwt).toFixed(3)) : "") + '</td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td>' + (nontag_total_closing_inw_pcs > 0 ? money_format_india(parseFloat(nontag_total_closing_inw_pcs).toFixed(0)) : "") + '</td>'

				+ '<td>' + (nontag_total_closing_inw_gwt > 0 ? money_format_india(parseFloat(nontag_total_closing_inw_gwt).toFixed(3)) : "") + '</td>'

				+ '<td>' + (nontag_total_closing_net_wt > 0 ? money_format_india(parseFloat(nontag_total_closing_net_wt).toFixed(3)) : "") + '</td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

			'</tr>';

			trHTML += '<tr style="font-weight:bold;color:red;">' +

				+'<td></td>'

				+ '<td style="text-align:left;">GRAND TOTAL</td>'

				+ '<td>' + (total_op_tags > 0 ? money_format_india(total_op_tags) : '') + '</td>'

				+ '<td>' + (total_op_blc_pcss || nontag_total_op_blc_pcss > 0 ? money_format_india(parseFloat(total_op_blc_pcss + nontag_total_op_blc_pcss)) : '') + '</td>'

				+ '<td>' + (total_op_blc_gwt || nontag_total_op_blc_gwt > 0 ? money_format_india(parseFloat(total_op_blc_gwt + nontag_total_op_blc_gwt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_op_blc_nwt || nontag_total_op_blc_nwt > 0 ? money_format_india(parseFloat(total_op_blc_nwt + nontag_total_op_blc_nwt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_op_blc_diawt > 0 ? money_format_india(parseFloat(total_op_blc_diawt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_inw_tags > 0 ? money_format_india(total_inw_tags) : '') + '</td>'

				+ '<td>' + (total_inw_pcss || nontag_total_inw_pcss > 0 ? money_format_india(parseFloat(total_inw_pcss + nontag_total_inw_pcss)) : '') + '</td>'

				+ '<td>' + (total_inw_gwt || nontag_total_inw_gwt > 0 ? money_format_india(parseFloat(total_inw_gwt + nontag_total_inw_gwt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_inw_nwt || nontag_total_inw_nwt > 0 ? money_format_india(parseFloat(total_inw_nwt + nontag_total_inw_nwt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_inw_diawt > 0 ? money_format_india(parseFloat(total_inw_diawt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_outward_tags > 0 ? money_format_india(parseFloat(total_outward_tags).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_outward_pcs || nontag_total_outward_pcs > 0 ? money_format_india(parseFloat(total_outward_pcs + nontag_total_outward_pcs)) : '') + '</td>'

				+ '<td>' + (total_outward_gwt || nontag_total_outward_gwt > 0 ? money_format_india(parseFloat(total_outward_gwt + nontag_total_outward_gwt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_outward_nwt || nontag_total_outward_nwt > 0 ? money_format_india(parseFloat(total_outward_nwt + nontag_total_outward_nwt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_outward_diawt > 0 ? money_format_india(parseFloat(total_outward_diawt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_closing_tags > 0 ? money_format_india(total_closing_tags) : '') + '</td>'

				+ '<td>' + (total_closing_inw_pcs || nontag_total_closing_inw_pcs > 0 ? money_format_india(total_closing_inw_pcs + nontag_total_closing_inw_pcs) : '') + '</td>'

				+ '<td>' + (total_closing_inw_gwt || nontag_total_closing_inw_gwt > 0 ? money_format_india(parseFloat(total_closing_inw_gwt + nontag_total_closing_inw_gwt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_closing_net_wt || nontag_total_closing_net_wt > 0 ? money_format_india(parseFloat(total_closing_net_wt + nontag_total_closing_net_wt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_closing_dia_wt > 0 ? money_format_india(parseFloat(total_closing_dia_wt).toFixed(3)) : '') + '</td>'

				+ '<td></td>'

				+ '<td></td>'

			'</tr>';

			trHTML += '<tr style="font-weight:bold;">' +

				+'<td></td>'

				+ '<td style="text-align:left;">TOTAL SUMMARY</td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

			'</tr>';

			trHTML += '<tr style="font-weight:bold;">' +

				+'<td></td>'

				+ '<td style="text-align:left;">#</td>'

				+ '<td>No.Tags</td>'

				+ '<td>PCS</td>'

				+ '<td>G.WT</td>'

				+ '<td>N.WT</td>'

				+ '<td>D.WT</td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

			'</tr>';

			trHTML += '<tr style="font-weight:bold;">' +

				+'<td></td>'

				+ '<td style="text-align:left;">OPENING</td>'

				+ '<td>' + (total_op_tags > 0 ? money_format_india(total_op_tags) : '') + '</td>'

				+ '<td>' + (total_op_blc_pcss || nontag_total_op_blc_pcss > 0 ? money_format_india(total_op_blc_pcss + nontag_total_op_blc_pcss) : '') + '</td>'

				+ '<td>' + (total_op_blc_gwt || nontag_total_op_blc_gwt > 0 ? money_format_india(parseFloat(total_op_blc_gwt + nontag_total_op_blc_gwt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_op_blc_nwt || nontag_total_op_blc_nwt > 0 ? money_format_india(parseFloat(total_op_blc_nwt + nontag_total_op_blc_nwt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_op_blc_diawt > 0 ? money_format_india(parseFloat(total_op_blc_diawt).toFixed(3)) : '') + '</td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

			'</tr>';

			trHTML += '<tr style="font-weight:bold;">' +

				+'<td></td>'

				+ '<td style="text-align:left;">INWARD</td>'

				+ '<td>' + (total_inw_tags > 0 ? money_format_india(total_inw_tags) : '') + '</td>'

				+ '<td>' + (total_inw_pcss || nontag_total_inw_pcss > 0 ? money_format_india(total_inw_pcss + nontag_total_inw_pcss) : '') + '</td>'

				+ '<td>' + (total_inw_gwt || nontag_total_inw_gwt > 0 ? money_format_india(parseFloat(total_inw_gwt + nontag_total_inw_gwt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_inw_nwt || nontag_total_inw_nwt > 0 ? money_format_india(parseFloat(total_inw_nwt + nontag_total_inw_nwt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_inw_diawt > 0 ? money_format_india(parseFloat(total_inw_diawt).toFixed(3)) : '') + '</td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

			'</tr>';

			trHTML += '<tr style="font-weight:bold;">' +

				+'<td></td>'

				+ '<td style="text-align:left;">OUTWARD</td>'

				+ '<td>' + (total_outward_tags > 0 ? money_format_india(parseFloat(total_outward_tags)) : '') + '</td>'

				+ '<td>' + (total_outward_pcs || nontag_total_outward_pcs > 0 ? money_format_india(parseFloat(total_outward_pcs + nontag_total_outward_pcs)) : '') + '</td>'

				+ '<td>' + (total_outward_gwt || nontag_total_outward_gwt > 0 ? money_format_india(parseFloat(total_outward_gwt + nontag_total_outward_gwt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_outward_nwt || nontag_total_outward_nwt > 0 ? money_format_india(parseFloat(total_outward_nwt + nontag_total_outward_nwt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_outward_diawt > 0 ? money_format_india(parseFloat(total_outward_diawt).toFixed(3)) : '') + '</td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

			'</tr>';

			trHTML += '<tr style="font-weight:bold;">' +

				+'<td></td>'

				+ '<td style="text-align:left;">CLOSING</td>'

				+ '<td>' + (total_closing_tags > 0 ? money_format_india(total_closing_tags) : '') + '</td>'

				+ '<td>' + (total_closing_inw_pcs || nontag_total_closing_inw_pcs > 0 ? money_format_india(total_closing_inw_pcs + nontag_total_closing_inw_pcs) : '') + '</td>'

				+ '<td>' + (total_closing_inw_gwt || nontag_total_closing_inw_gwt > 0 ? money_format_india(parseFloat(total_closing_inw_gwt + nontag_total_closing_inw_gwt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_closing_net_wt || nontag_total_closing_net_wt > 0 ? money_format_india(parseFloat(total_closing_net_wt + nontag_total_closing_net_wt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_closing_dia_wt > 0 ? money_format_india(parseFloat(total_closing_dia_wt).toFixed(3)) : '') + '</td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

			'</tr>';

			$('#section_stock_list > tbody').html(trHTML);

			// Check and initialise datatable

			if (!$.fn.DataTable.isDataTable('#section_stock_list')) {

				oTable = $('#section_stock_list').dataTable({

					"bSort": false,

					"bInfo": true,

					"scrollX": '100%',

					"dom": 'lBfrtip',

					"paging": false,

					"bAutoWidth": false,

					"columnDefs": [

						{

							targets: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22],

							className: 'dt-body-right'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'colvis',

							collectionLayout: 'fixed columns',

							collectionTitle: 'Column visibility control'

						},

						{

							extend: 'excel',

							footer: true,

							title: 'SECTION WISE STOCK REPORT ' + branch_name + '-' + dt_range[0] + '-' + dt_range[1],

						}

					],

				});

			}

			$(".overlay").css("display", "none");

		}

	});

}

function get_section_stock_inoutdetails() {

	var dt_range = ($("#dt_range").val()).split('-');

	var sec_out_check = $('#sec_out_check').is(':checked') ? 1 : 0;

	var company_name = $('#company_name').val();

	var from_date = dt_range[0];

	var to_date = dt_range[1];

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "SECTION WISE STOCK REPORT";

	var prod_select = $('#prod_select option:selected').html() != '' && $('#prod_select option:selected').html() != undefined ? $('#prod_select option:selected').html() + ' - ' : '';

	var metal = $('#metal option:selected').html() != '' && $('#metal option:selected').html() != undefined ? $('#metal option:selected').html() + ' - ' : '';

	var category = $('#category option:selected').html() != '' && $('#category option:selected').html() != undefined ? $('#category option:selected').html() + ' - ' : '';

	var select_group_by = $('#select_group_by option:selected').html() != '' && $('#select_group_by option:selected').html() != undefined ? $('#select_group_by option:selected').html() + ' - ' : '';

	var optional = metal + category + prod_select + select_group_by;

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/section_stock_inout/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'dt_range': $("#dt_range").val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'id_section': $('#section_select').val(), 'pro_id': $('#prod_select').val(), 'GroupBy': $('#stock_group_by').val(), 'id_metal': $('#metal').val(), 'des_id': $('#des_select').val(), 'subdes_id': $('#sub_des_select').val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			var non_tag_items = data.non_tag_items;

			$("#section_stock_list > tbody > tr").remove();

			$('#section_stock_list').dataTable().fnClearTable();

			$('#section_stock_list').dataTable().fnDestroy();

			trHTML = '';

			tfootHTML = '';

			total_bill_amount = 0;

			total_bill_tax_value = 0;

			//Grand total

			var total_op_blc_pcss = 0;

			var total_op_blc_gwt = 0;

			var total_op_blc_nwt = 0;

			var total_op_blc_diawt = 0;

			var total_op_tags = 0;

			var total_op_blc_grm_wt = 0;

			var total_op_blc_ct_wt = 0;

			var total_inw_pcss = 0;

			var total_inw_gwt = 0;

			var total_inw_nwt = 0;

			var total_inw_diawt = 0;

			var total_inw_tags = 0;

			var total_inw_grm_wt = 0;

			var total_inw_ct_wt = 0;

			var total_closing_inw_pcs = 0;

			var total_closing_inw_gwt = 0;

			var total_closing_net_wt = 0;

			var total_closing_dia_wt = 0;

			var total_closing_tags = 0;

			var total_closing_grm_wt = 0;

			var total_closing_ct_wt = 0;

			var total_outward_pcs = 0;

			var total_outward_gwt = 0;

			var total_outward_nwt = 0;

			var total_outward_diawt = 0;

			var total_outward_tags = 0;

			var total_outward_grm_wt = 0;

			var total_outward_ct_wt = 0;

			$.each(list, function (i, section) {

				//product grand total

				var gt_total_op_blc_pcss = 0;

				var gt_total_op_blc_gwt = 0;

				var gt_total_op_blc_nwt = 0;

				var gt_total_op_blc_diawt = 0;

				var gt_total_op_tags = 0;

				var gt_total_op_blc_grm_wt = 0;

				var gt_total_op_blc_ct_wt = 0;

				var gt_total_inw_pcss = 0;

				var gt_total_inw_gwt = 0;

				var gt_total_inw_nwt = 0;

				var gt_total_inw_diawt = 0;

				var gt_total_inw_tags = 0;

				var gt_total_inw_grm_wt = 0;

				var gt_total_inw_ct_wt = 0;

				var gt_total_outward_pcs = 0;

				var gt_total_outward_gwt = 0;

				var gt_total_outward_nwt = 0;

				var gt_total_outward_diawt = 0;

				var gt_total_outward_tags = 0;

				var gt_total_outward_grm_wt = 0;

				var gt_total_outward_ct_wt = 0;

				var gt_total_closing_inw_pcs = 0;

				var gt_total_closing_inw_gwt = 0;

				var gt_total_closing_net_wt = 0;

				var gt_total_closing_dia_wt = 0;

				var gt_total_closing_tags = 0;

				var gt_total_closing_grm_wt = 0;

				var gt_total_closing_ct_wt = 0;

				if ($('#stock_group_by').val() == 2 || $('#stock_group_by').val() == 3) {

					trHTML += '<tr>'

						+ '<td style="text-align:left;" colspan="2"><strong>' + i + '</strong></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

					'</tr>';

				}

				$.each(section, function (idx, product) {

					//sub total

					var op_blc_pcss = 0;

					var op_blc_gwt = 0;

					var op_blc_nwt = 0;

					var op_blc_diawt = 0;

					var blc_tags = 0;

					var op_blc_grm_wt = 0;

					var op_blc_ct_wt = 0;

					var inw_pcss = 0;

					var inw_gwt = 0;

					var inw_nwt = 0;

					var inw_diawt = 0;

					var inw_tags = 0;

					var inw_grm_wt = 0;

					var inw_ct_wt = 0;

					var sold_pcs = 0;

					var sold_gwt = 0;

					var sold_nwt = 0;

					var sold_diawt = 0;

					var sold_tags = 0;

					var sold_grm_wt = 0;

					var sold_ct_wt = 0;

					var sect_out_pcs = 0;

					var sect_out_gwt = 0;

					var sect_out_nwt = 0;

					var sect_out_dwt = 0;

					var sect_out_tags = 0;

					var sect_out_grm_wt = 0;

					var sect_out_ct_wt = 0;

					var item_sect_out_pcs = 0;

					var item_sect_out_gwt = 0;

					var item_sect_out_nwt = 0;

					var item_sect_out_dwt = 0;

					var item_sect_out_tags = 0;

					var item_sect_out_diawt = 0;

					var item_sect_out_grm_wt = 0;

					var item_sect_out_ct_wt = 0;

					var other_s_pcs = 0;

					var other_s_gwt = 0;

					var other_s_nwt = 0;

					var other_s_diawt = 0;

					var other_s_tags = 0;

					var other_s_grm_wt = 0;

					var other_s_ct_wt = 0;

					var ret_pcs = 0;

					var ret_gwt = 0;

					var ret_nwt = 0;

					var ret_diawt = 0;

					var ret_tags = 0;

					var ret_grm_wt = 0;

					var ret_ct_wt = 0;

					var issue_pcs = 0;

					var issue_gwt = 0;

					var issue_nwt = 0;

					var issue_diawt = 0;

					var issue_tags = 0;

					var issue_grm_wt = 0;

					var issue_ct_wt = 0;

					var closing_inw_pcs = 0;

					var closing_inw_gwt = 0;

					var closing_net_wt = 0;

					var closing_dia_wt = 0;

					var closing_tags = 0;

					var closing_grm_wt = 0;

					var closing_ct_wt = 0;

					if ($('#stock_group_by').val() == 3) {

						trHTML += '<tr>'

							+ '<td style="text-align:left;" colspan="2"><strong>' + idx + '</strong></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

						'</tr>';

					}

					$.each(product, function (idx, item) {

						op_blc_pcss += parseFloat(parseFloat(item.op_blc_pcs) + parseFloat(item.op_grm_blc_pcs) + parseFloat(item.op_ct_blc_pcs));

						op_blc_gwt += parseFloat(item.op_blc_gwt);

						op_blc_nwt += parseFloat(item.op_blc_nwt);

						op_blc_diawt += parseFloat(item.op_blc_diawt);

						blc_tags += parseFloat(parseFloat(item.blc_tags) + parseFloat(item.grm_blc_tags) + parseFloat(item.ct_blc_tags));

						op_blc_grm_wt += parseFloat(item.op_grm_blc_wt);

						op_blc_ct_wt += parseFloat(item.op_ct_blc_wt);

						//Product Inward Details

						inw_pcss += parseFloat(parseFloat(item.inw_pcs) + parseFloat(item.grm_inw_pcs) + parseFloat(item.ct_inw_pcs));

						inw_gwt += parseFloat(item.inw_gwt);

						inw_nwt += parseFloat(item.inw_nwt);

						inw_diawt += parseFloat(item.inw_diawt);

						inw_tags += parseFloat(parseFloat(item.inw_tags) + parseFloat(item.grm_inw_tags) + parseFloat(item.ct_inw_tags));

						inw_grm_wt += parseFloat(item.grm_inw_wt);

						inw_ct_wt += parseFloat(item.ct_inw_wt);

						//Product Inward Details

						//Product SOld Details

						sold_pcs += parseFloat(item.sold_pcs);

						sold_gwt += parseFloat(item.sold_gwt);

						sold_nwt += parseFloat(item.sold_nwt);

						sold_diawt += parseFloat(item.sold_diawt);

						sold_tags += parseFloat(item.sold_tags);

						sold_grm_wt += parseFloat(item.sold_grm_wt);

						sold_ct_wt += parseFloat(item.sold_ct_wt);

						//Product SOld Details

						//Section Out Details

						if (sec_out_check == 1) {

							sect_out_pcs += parseFloat(item.sect_out_pcs);

							sect_out_gwt += parseFloat(item.sect_out_gwt);

							sect_out_nwt += parseFloat(item.sect_out_nwt);

							sect_out_dwt += parseFloat(item.sect_out_diawt);

							sect_out_tags += parseFloat(item.sect_out_tags);

							sect_out_grm_wt += parseFloat(item.grm_sect_out_wt);

							sect_out_ct_wt += parseFloat(item.ct_sect_out_wt);

							item_sect_out_pcs = parseFloat(item.sect_out_pcs);

							item_sect_out_gwt = parseFloat(item.sect_out_gwt);

							item_sect_out_nwt = parseFloat(item.sect_out_nwt);

							item_sect_out_dwt = parseFloat(item.sect_out_diawt);

							item_sect_out_tags = parseFloat(item.sect_out_tags);

							item_sect_out_diawt = parseFloat(item.sect_out_diawt);

							item_sect_out_grm_wt += parseFloat(item.grm_sect_out_wt);

							item_sect_out_ct_wt += parseFloat(item.ct_sect_out_wt);

						}

						//Section Out Details

						//Other Outward Details

						other_s_pcs += parseFloat(item.br_out_pcs);

						other_s_gwt += parseFloat(item.br_out_gwt);

						other_s_nwt += parseFloat(item.br_out_nwt);

						other_s_diawt += parseFloat(item.br_out_diawt);

						other_s_tags += parseFloat(item.brout_tags);

						other_s_grm_wt += parseFloat(item.grm_br_out_wt);

						other_s_ct_wt += parseFloat(item.ct_br_out_wt);

						//Other Outward Details

						//Purchase return Outward Details

						ret_pcs += parseFloat(item.ret_pcs);

						ret_gwt += parseFloat(item.ret_gwt);

						ret_nwt += parseFloat(item.ret_nwt);

						ret_diawt += parseFloat(item.ret_diawt);

						ret_tags += parseFloat(item.ret_tags);

						ret_grm_wt += parseFloat(item.grm_ret_wt);

						ret_ct_wt += parseFloat(item.ct_ret_wt);

						//Purchase return Outward Details

						//Karigar Metal Issue Outward Details

						issue_pcs += parseFloat(item.iss_pcs);

						issue_gwt += parseFloat(item.iss_gwt);

						issue_nwt += parseFloat(item.iss_nwt);

						issue_diawt += parseFloat(item.iss_diawt);

						issue_tags += parseFloat(item.iss_tags);

						issue_grm_wt += parseFloat(item.grm_iss_wt);

						issue_ct_wt += parseFloat(item.ct_iss_wt);

						//Karigar Metal Issue Details

						//Product closing Details

						var closing_pcs = parseFloat(item.op_blc_pcs) + parseFloat(item.op_grm_blc_pcs) + parseFloat(item.op_ct_blc_pcs) + parseFloat(item.inw_pcs) + parseFloat(item.grm_inw_pcs) + parseFloat(item.ct_inw_pcs) - parseFloat(parseFloat(item.sold_pcs) + parseFloat(item.br_out_pcs) + parseFloat(item.sect_out_pcs) + parseFloat(item.ret_pcs) + parseFloat(item.iss_pcs));

						var closing_gwt = parseFloat(parseFloat(item.op_blc_gwt) + parseFloat(item.inw_gwt) - parseFloat(item.sold_gwt) - parseFloat(item.br_out_gwt) - parseFloat(item.sect_out_gwt) - parseFloat(item.ret_gwt) - parseFloat(item.iss_gwt)).toFixed(3);

						var closing_nwt = parseFloat(parseFloat(item.op_blc_nwt) + parseFloat(item.inw_nwt) - parseFloat(item.sold_nwt) - parseFloat(item.br_out_nwt) - parseFloat(item.sect_out_nwt) - parseFloat(item.ret_nwt) - parseFloat(item.iss_nwt)).toFixed(3);

						var closing_diawt = parseFloat(parseFloat(item.op_blc_diawt) + parseFloat(item.inw_diawt) - parseFloat(item.sold_diawt) - parseFloat(item.br_out_diawt) - parseFloat(item.sect_out_diawt) - parseFloat(item.ret_diawt) - parseFloat(item.iss_diawt)).toFixed(3);

						var closing_tag = parseFloat(parseFloat(item.blc_tags) + parseFloat(item.grm_blc_tags) + parseFloat(item.ct_blc_tags) + parseFloat(item.inw_tags) + parseFloat(item.grm_inw_tags) + parseFloat(item.ct_inw_tags) - parseFloat(item.sold_tags) - parseFloat(item.brout_tags) - parseFloat(item.sect_out_tags) - parseFloat(item.ret_tags) - parseFloat(item.iss_tags));

						var closing_grm_wt = parseFloat(parseFloat(item.op_grm_blc_wt) + parseFloat(item.grm_inw_wt) - parseFloat(item.sold_grm_wt) - parseFloat(item.grm_br_out_wt) - parseFloat(item.grm_sect_out_wt) - parseFloat(item.grm_ret_wt) - parseFloat(item.grm_iss_wt)).toFixed(3);

						var closing_ct_wt = parseFloat(parseFloat(item.op_ct_blc_wt) + parseFloat(item.ct_inw_wt) - parseFloat(item.sold_ct_wt) - parseFloat(item.ct_br_out_wt) - parseFloat(item.ct_sect_out_wt) - parseFloat(item.ct_ret_wt) - parseFloat(item.ct_iss_wt)).toFixed(3);

						trHTML += '<tr>'

							+ '<td style="text-align:left;">' + ($('#stock_group_by').val() == 1 ? item.section_name : ($('#stock_group_by').val() == 2 ? item.product_name : item.sub_design_name)) + '</td>'

							+ '<td>' + (item.blc_tags > 0 || item.grm_blc_tags > 0 || item.ct_blc_tags > 0 ? money_format_india(parseFloat(parseFloat(item.blc_tags) + parseFloat(item.grm_blc_tags) + parseFloat(item.ct_blc_tags))) : '') + '</td>'

							+ '<td>' + (item.op_blc_pcs > 0 ? money_format_india(item.op_blc_pcs) : '') + '</td>'

							+ '<td>' + (item.op_blc_gwt > 0 ? money_format_india(item.op_blc_gwt) : '') + '</td>'

							+ '<td>' + (item.op_blc_nwt > 0 ? money_format_india(item.op_blc_nwt) : '') + '</td>'

							+ '<td>' + (item.op_blc_diawt > 0 ? money_format_india(item.op_blc_diawt) : '') + '</td>'

							+ '<td>' + (item.op_grm_blc_wt > 0 ? money_format_india(item.op_grm_blc_wt) : '') + '</td>'

							+ '<td>' + (item.op_ct_blc_wt > 0 ? money_format_india(item.op_ct_blc_wt) : '') + '</td>'

							+ '<td>' + (item.inw_tags > 0 || item.grm_inw_tags > 0 || item.ct_inw_tags > 0 ? money_format_india(parseFloat(parseFloat(item.inw_tags) + parseFloat(item.grm_inw_tags) + parseFloat(item.ct_inw_tags))) : '') + '</td>'

							+ '<td>' + (item.inw_pcs > 0 ? money_format_india(item.inw_pcs) : '') + '</td>'

							+ '<td>' + (item.inw_gwt > 0 ? money_format_india(item.inw_gwt) : '') + '</td>'

							+ '<td>' + (item.inw_nwt > 0 ? money_format_india(item.inw_nwt) : '') + '</td>'

							+ '<td>' + (item.inw_diawt > 0 ? money_format_india(item.inw_diawt) : '') + '</td>'

							+ '<td>' + (item.grm_inw_wt > 0 ? money_format_india(item.grm_inw_wt) : '') + '</td>'

							+ '<td>' + (item.ct_inw_wt > 0 ? money_format_india(item.ct_inw_wt) : '') + '</td>'

							+ '<td>' + (item.sold_tags > 0 || item.brout_tags > 0 || item.sect_out_tags > 0 || item.ret_tags > 0 || item.iss_tags > 0 ? money_format_india(parseFloat(parseFloat(item.sold_tags) + parseFloat(item.brout_tags) + parseFloat(item.sect_out_tags) + parseFloat(item.ret_tags) + parseFloat(item.iss_tags))) : '') + '</td>'

							+ '<td>' + (item.sold_pcs > 0 || item.br_out_pcs > 0 || item.sect_out_pcs > 0 || item.ret_pcs > 0 || item.iss_pcs > 0 ? money_format_india(parseFloat(parseFloat(item.sold_pcs) + parseFloat(item.br_out_pcs) + parseFloat(item.sect_out_pcs) + parseFloat(item.ret_pcs) + parseFloat(item.iss_pcs))) : '') + '</td>'

							+ '<td>' + (item.sold_gwt > 0 || item.br_out_gwt > 0 || item.sect_out_gwt > 0 || item.ret_gwt > 0 || item.iss_gwt > 0 ? money_format_india(parseFloat(parseFloat(item.sold_gwt) + parseFloat(item.br_out_gwt) + parseFloat(item.sect_out_gwt) + parseFloat(item.ret_gwt) + parseFloat(item.iss_gwt)).toFixed(3)) : '') + '</td>'

							+ '<td>' + (item.sold_nwt > 0 || item.br_out_nwt > 0 || item.sect_out_nwt > 0 || item.ret_nwt > 0 || item.iss_nwt > 0 ? money_format_india(parseFloat(parseFloat(item.sold_nwt) + parseFloat(item.br_out_nwt) + parseFloat(item.sect_out_nwt) + parseFloat(item.ret_nwt) + parseFloat(item.iss_nwt)).toFixed(3)) : '') + '</td>'

							+ '<td>' + (item.sold_diawt > 0 || item.br_out_diawt > 0 || item.sect_out_diawt > 0 || item.ret_diawt > 0 || item.iss_diawt > 0 ? money_format_india(parseFloat(parseFloat(item.sold_diawt) + parseFloat(item.br_out_diawt) + parseFloat(item.sect_out_diawt) + parseFloat(item.ret_diawt) + parseFloat(item.iss_diawt)).toFixed(3)) : '') + '</td>'

							+ '<td>' + (item.sold_grm_wt > 0 || item.grm_br_out_wt > 0 || item.grm_sect_out_wt > 0 || item.grm_ret_wt > 0 || item.grm_iss_wt > 0 ? money_format_india(parseFloat(parseFloat(item.sold_grm_wt) + parseFloat(item.grm_br_out_wt) + parseFloat(item.grm_sect_out_wt) + parseFloat(item.grm_ret_wt) + parseFloat(item.grm_iss_wt)).toFixed(3)) : '') + '</td>'

							+ '<td>' + (item.sold_ct_wt > 0 || item.ct_br_out_wt > 0 || item.ct_br_out_wt > 0 || item.ct_ret_wt > 0 || item.ct_iss_wt > 0 ? money_format_india(parseFloat(parseFloat(item.sold_ct_wt) + parseFloat(item.ct_br_out_wt) + parseFloat(item.ct_sect_out_wt) + parseFloat(item.ct_ret_wt) + parseFloat(item.ct_iss_wt)).toFixed(3)) : '') + '</td>'

							+ '<td>' + (closing_tag > 0 ? money_format_india(closing_tag) : '') + '</td>'

							+ '<td>' + (closing_pcs > 0 ? money_format_india(closing_pcs) : '') + '</td>'

							+ '<td>' + (closing_gwt > 0 ? money_format_india(closing_gwt) : '') + '</td>'

							+ '<td>' + (closing_nwt > 0 ? money_format_india(closing_nwt) : '') + '</td>'

							+ '<td>' + (closing_diawt > 0 ? money_format_india(closing_diawt) : '') + '</td>'

							+ '<td>' + (closing_grm_wt > 0 ? money_format_india(closing_grm_wt) : '') + '</td>'

							+ '<td>' + (closing_ct_wt > 0 ? money_format_india(closing_ct_wt) : '') + '</td>'

							+ '<td>' + (item.in_trans_pcs > 0 ? money_format_india(item.in_trans_pcs) : '') + '</td>'

							+ '<td>' + (closing_pcs || item.in_trans_pcs > 0 ? money_format_india(parseFloat(parseFloat(closing_pcs) + parseFloat(item.in_trans_pcs))) : '') + '</td>'

						'</tr>';

						closing_inw_pcs += parseFloat(closing_pcs);

						closing_inw_gwt += parseFloat(closing_gwt);

						closing_net_wt += parseFloat(closing_nwt);

						closing_dia_wt += parseFloat(closing_diawt);

						closing_tags += parseFloat(closing_tag);

						closing_grm_wt += parseFloat(closing_grm_wt);

						closing_ct_wt += parseFloat(closing_ct_wt);

					});

					if ($('#stock_group_by').val() == 3) {

						trHTML += '<tr style="font-weight:bold;color:blue">' +

							+'<td></td>'

							+ '<td style="text-align:left;">SUB TOTAL</td>'

							+ '<td>' + (blc_tags > 0 ? money_format_india(blc_tags) : '') + '</td>'

							+ '<td>' + (op_blc_pcss > 0 ? money_format_india(op_blc_pcss) : '') + '</td>'

							+ '<td>' + (op_blc_gwt > 0 ? money_format_india(parseFloat(op_blc_gwt).toFixed(3)) : '') + '</td>'

							+ '<td>' + (op_blc_nwt > 0 ? money_format_india(parseFloat(op_blc_nwt).toFixed(3)) : '') + '</td>'

							+ '<td>' + (op_blc_diawt > 0 ? money_format_india(parseFloat(op_blc_diawt).toFixed(3)) : '') + '</td>'

							+ '<td>' + (op_blc_grm_wt > 0 ? money_format_india(parseFloat(op_blc_grm_wt).toFixed(3)) : '') + '</td>'

							+ '<td>' + (op_blc_ct_wt > 0 ? money_format_india(parseFloat(op_blc_ct_wt).toFixed(3)) : '') + '</td>'

							+ '<td>' + (inw_tags > 0 ? money_format_india(inw_tags) : '') + '</td>'

							+ '<td>' + (inw_pcss > 0 ? money_format_india(inw_pcss) : '') + '</td>'

							+ '<td>' + (inw_gwt > 0 ? money_format_india(parseFloat(inw_gwt).toFixed(3)) : '') + '</td>'

							+ '<td>' + (inw_nwt > 0 ? money_format_india(parseFloat(inw_nwt).toFixed(3)) : '') + '</td>'

							+ '<td>' + (inw_diawt > 0 ? money_format_india(parseFloat(inw_diawt).toFixed(3)) : '') + '</td>'

							+ '<td>' + (inw_grm_wt > 0 ? money_format_india(parseFloat(inw_grm_wt).toFixed(3)) : '') + '</td>'

							+ '<td>' + (inw_ct_wt > 0 ? money_format_india(parseFloat(inw_ct_wt).toFixed(3)) : '') + '</td>'

							+ '<td>' + (sold_tags > 0 || other_s_pcs > 0 || sect_out_tags > 0 ? money_format_india(parseFloat(sold_tags + other_s_pcs + sect_out_tags)) : '') + '</td>'

							+ '<td>' + (sold_pcs > 0 || other_s_pcs > 0 || sect_out_pcs > 0 ? money_format_india(parseFloat(sold_pcs + other_s_pcs + sect_out_pcs)) : '') + '</td>'

							+ '<td>' + (sold_gwt > 0 || other_s_gwt > 0 || sect_out_gwt > 0 ? money_format_india(parseFloat(sold_gwt + other_s_gwt + sect_out_gwt).toFixed(3)) : '') + '</td>'

							+ '<td>' + (sold_nwt > 0 || other_s_nwt > 0 || sect_out_nwt > 0 ? money_format_india(parseFloat(sold_nwt + other_s_nwt + sect_out_nwt).toFixed(3)) : '') + '</td>'

							+ '<td>' + (sold_diawt > 0 || other_s_diawt > 0 || sect_out_dwt > 0 ? money_format_india(parseFloat(sold_diawt + other_s_diawt + sect_out_dwt).toFixed(3)) : '') + '</td>'

							+ '<td>' + (sold_grm_wt > 0 || other_s_grm_wt > 0 || sect_out_grm_wt > 0 || ret_grm_wt > 0 || issue_grm_wt > 0 ? money_format_india(parseFloat(sold_grm_wt + other_s_grm_wt + sect_out_grm_wt + ret_grm_wt + issue_grm_wt)).toFixed(3) : '') + '</td>'

							+ '<td>' + (sold_ct_wt > 0 || other_s_ct_wt > 0 || sect_out_ct_wt > 0 || ret_ct_wt > 0 || issue_ct_wt > 0 ? money_format_india(parseFloat(sold_ct_wt + other_s_ct_wt + sect_out_ct_wt + ret_ct_wt + issue_ct_wt).toFixed(3)) : '') + '</td>'

							+ '<td>' + (closing_tags > 0 ? money_format_india(closing_tags) : '') + '</td>'

							+ '<td>' + (closing_inw_pcs > 0 ? money_format_india(closing_inw_pcs) : '') + '</td>'

							+ '<td>' + (closing_inw_gwt > 0 ? money_format_india(parseFloat(closing_inw_gwt).toFixed(3)) : '') + '</td>'

							+ '<td>' + (closing_net_wt > 0 ? money_format_india(parseFloat(closing_net_wt).toFixed(3)) : '') + '</td>'

							+ '<td>' + (closing_dia_wt > 0 ? money_format_india(parseFloat(closing_dia_wt).toFixed(3)) : '') + '</td>'

							+ '<td>' + (closing_grm_wt > 0 ? money_format_india(parseFloat(closing_grm_wt).toFixed(3)) : '') + '</td>'

							+ '<td>' + (closing_ct_wt > 0 ? money_format_india(parseFloat(closing_ct_wt).toFixed(3)) : '') + '</td>'

							+ '<td></td>'

							+ '<td></td>'

						'</tr>';

					}

					gt_total_op_blc_pcss += parseFloat(op_blc_pcss);

					gt_total_op_blc_gwt += parseFloat(op_blc_gwt);

					gt_total_op_blc_nwt += parseFloat(op_blc_nwt);

					gt_total_op_blc_diawt += parseFloat(op_blc_diawt);

					gt_total_op_tags += parseFloat(blc_tags);

					gt_total_op_blc_grm_wt += parseFloat(op_blc_grm_wt);

					gt_total_op_blc_ct_wt += parseFloat(op_blc_ct_wt);

					gt_total_inw_pcss += parseFloat(inw_pcss);

					gt_total_inw_gwt += parseFloat(inw_gwt);

					gt_total_inw_nwt += parseFloat(inw_nwt);

					gt_total_inw_diawt += parseFloat(inw_diawt);

					gt_total_inw_tags += parseFloat(inw_tags);

					gt_total_inw_grm_wt += parseFloat(inw_grm_wt);

					gt_total_inw_ct_wt += parseFloat(inw_ct_wt);

					gt_total_outward_pcs += parseFloat(sold_pcs + other_s_pcs + sect_out_pcs);

					gt_total_outward_gwt += parseFloat(sold_gwt + other_s_gwt + sect_out_gwt);

					gt_total_outward_nwt += parseFloat(sold_nwt + other_s_nwt + sect_out_nwt);

					gt_total_outward_diawt += parseFloat(sold_diawt + other_s_diawt + sect_out_dwt);

					gt_total_outward_tags += parseFloat(sold_tags + other_s_tags + sect_out_tags);

					gt_total_outward_grm_wt += parseFloat(sold_grm_wt + other_s_grm_wt + sect_out_grm_wt);

					gt_total_outward_ct_wt += parseFloat(sold_ct_wt + other_s_ct_wt + sect_out_ct_wt);

					gt_total_closing_inw_pcs += parseFloat(closing_inw_pcs);

					gt_total_closing_inw_gwt += parseFloat(closing_inw_gwt);

					gt_total_closing_net_wt += parseFloat(closing_net_wt);

					gt_total_closing_dia_wt += parseFloat(closing_dia_wt);

					gt_total_closing_tags += parseFloat(closing_tags);

					gt_total_closing_grm_wt += parseFloat(closing_grm_wt);

					gt_total_closing_ct_wt += parseFloat(closing_ct_wt);

				});

				if ($('#stock_group_by').val() == 3) {

					trHTML += '<tr style="font-weight:bold;color:red;">' +

						+'<td></td>'

						+ '<td style="text-align:left;">PRODUCT GRAND TOTAL</td>'

						+ '<td>' + (gt_total_op_tags > 0 ? money_format_india(gt_total_op_tags) : '') + '</td>'

						+ '<td>' + (gt_total_op_blc_pcss > 0 ? money_format_india(gt_total_op_blc_pcss) : '') + '</td>'

						+ '<td>' + (gt_total_op_blc_gwt > 0 ? money_format_india(parseFloat(gt_total_op_blc_gwt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (gt_total_op_blc_nwt > 0 ? money_format_india(parseFloat(gt_total_op_blc_nwt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (gt_total_op_blc_diawt > 0 ? money_format_india(parseFloat(gt_total_op_blc_diawt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (gt_total_op_blc_grm_wt > 0 ? money_format_india(parseFloat(gt_total_op_blc_grm_wt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (gt_total_op_blc_ct_wt > 0 ? money_format_india(parseFloat(gt_total_op_blc_ct_wt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (gt_total_inw_tags > 0 ? money_format_india(gt_total_inw_tags) : '') + '</td>'

						+ '<td>' + (gt_total_inw_pcss > 0 ? money_format_india(gt_total_inw_pcss) : '') + '</td>'

						+ '<td>' + (gt_total_inw_gwt > 0 ? money_format_india(parseFloat(gt_total_inw_gwt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (gt_total_inw_nwt > 0 ? money_format_india(parseFloat(gt_total_inw_nwt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (gt_total_inw_diawt > 0 ? money_format_india(parseFloat(gt_total_inw_diawt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (gt_total_inw_grm_wt > 0 ? money_format_india(parseFloat(gt_total_inw_grm_wt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (gt_total_inw_ct_wt > 0 ? money_format_india(parseFloat(gt_total_inw_ct_wt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (gt_total_outward_tags > 0 ? money_format_india(parseFloat(gt_total_outward_tags)) : '') + '</td>'

						+ '<td>' + (gt_total_outward_pcs > 0 ? money_format_india(parseFloat(gt_total_outward_pcs)) : '') + '</td>'

						+ '<td>' + (gt_total_outward_gwt > 0 ? money_format_india(parseFloat(gt_total_outward_gwt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (gt_total_outward_nwt > 0 ? money_format_india(parseFloat(gt_total_outward_nwt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (gt_total_outward_diawt > 0 ? money_format_india(parseFloat(gt_total_outward_diawt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (gt_total_outward_grm_wt > 0 ? money_format_india(parseFloat(gt_total_outward_grm_wt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (gt_total_outward_ct_wt > 0 ? money_format_india(parseFloat(gt_total_outward_ct_wt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (gt_total_closing_tags > 0 ? money_format_india(gt_total_closing_tags) : '') + '</td>'

						+ '<td>' + (gt_total_closing_inw_pcs > 0 ? money_format_india(gt_total_closing_inw_pcs) : '') + '</td>'

						+ '<td>' + (gt_total_closing_inw_gwt > 0 ? money_format_india(parseFloat(gt_total_closing_inw_gwt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (gt_total_closing_net_wt > 0 ? money_format_india(parseFloat(gt_total_closing_net_wt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (gt_total_closing_dia_wt > 0 ? money_format_india(parseFloat(gt_total_closing_dia_wt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (gt_total_closing_grm_wt > 0 ? money_format_india(parseFloat(gt_total_closing_grm_wt).toFixed(3)) : '') + '</td>'

						+ '<td>' + (gt_total_closing_ct_wt > 0 ? money_format_india(parseFloat(gt_total_closing_ct_wt).toFixed(3)) : '') + '</td>'

						+ '<td></td>'

						+ '<td></td>'

					'</tr>';

				}

				total_op_blc_pcss += parseFloat(gt_total_op_blc_pcss);

				total_op_blc_gwt += parseFloat(gt_total_op_blc_gwt);

				total_op_blc_nwt += parseFloat(gt_total_op_blc_nwt);

				total_op_blc_diawt += parseFloat(gt_total_op_blc_diawt);

				total_op_tags += parseFloat(gt_total_op_tags);

				total_op_blc_grm_wt += parseFloat(gt_total_op_blc_grm_wt);

				total_op_blc_ct_wt += parseFloat(gt_total_op_blc_ct_wt);

				total_inw_pcss += parseFloat(gt_total_inw_pcss);

				total_inw_gwt += parseFloat(gt_total_inw_gwt);

				total_inw_nwt += parseFloat(gt_total_inw_nwt);

				total_inw_diawt += parseFloat(gt_total_inw_diawt);

				total_inw_tags += parseFloat(gt_total_inw_tags);

				total_inw_grm_wt += parseFloat(gt_total_inw_grm_wt);

				total_inw_ct_wt += parseFloat(gt_total_inw_ct_wt);

				total_outward_pcs += parseFloat(gt_total_outward_pcs);

				total_outward_gwt += parseFloat(gt_total_outward_gwt);

				total_outward_nwt += parseFloat(gt_total_outward_nwt);

				total_outward_diawt += parseFloat(gt_total_outward_diawt);

				total_outward_tags += parseFloat(gt_total_outward_tags);

				total_outward_grm_wt += parseFloat(gt_total_outward_grm_wt);

				total_outward_ct_wt += parseFloat(gt_total_outward_ct_wt);

				total_closing_inw_pcs += parseFloat(gt_total_closing_inw_pcs);

				total_closing_inw_gwt += parseFloat(gt_total_closing_inw_gwt);

				total_closing_net_wt += parseFloat(gt_total_closing_net_wt);

				total_closing_dia_wt += parseFloat(gt_total_closing_dia_wt);

				total_closing_tags += parseFloat(gt_total_closing_tags);

				total_closing_grm_wt += parseFloat(gt_total_closing_grm_wt);

				total_closing_ct_wt += parseFloat(gt_total_closing_ct_wt);

			});

			trHTML += '<tr style="font-weight:bold;color:blue;">' +

				+'<td></td>'

				+ '<td style="text-align:left;">GRAND TOTAL</td>'

				+ '<td>' + (total_op_tags > 0 ? money_format_india(total_op_tags) : '') + '</td>'

				+ '<td>' + (total_op_blc_pcss > 0 ? money_format_india(total_op_blc_pcss) : '') + '</td>'

				+ '<td>' + (total_op_blc_gwt > 0 ? money_format_india(parseFloat(total_op_blc_gwt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_op_blc_nwt > 0 ? money_format_india(parseFloat(total_op_blc_nwt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_op_blc_diawt > 0 ? money_format_india(parseFloat(total_op_blc_diawt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_op_blc_grm_wt > 0 ? money_format_india(parseFloat(total_op_blc_grm_wt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_op_blc_ct_wt > 0 ? money_format_india(parseFloat(total_op_blc_ct_wt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_inw_tags > 0 ? money_format_india(total_inw_tags) : '') + '</td>'

				+ '<td>' + (total_inw_pcss > 0 ? money_format_india(total_inw_pcss) : '') + '</td>'

				+ '<td>' + (total_inw_gwt > 0 ? money_format_india(parseFloat(total_inw_gwt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_inw_nwt > 0 ? money_format_india(parseFloat(total_inw_nwt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_inw_diawt > 0 ? money_format_india(parseFloat(total_inw_diawt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_inw_grm_wt > 0 ? money_format_india(parseFloat(total_inw_grm_wt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_inw_ct_wt > 0 ? money_format_india(parseFloat(total_inw_ct_wt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_outward_tags > 0 ? money_format_india(parseFloat(total_outward_tags)) : '') + '</td>'

				+ '<td>' + (total_outward_pcs > 0 ? money_format_india(parseFloat(total_outward_pcs)) : '') + '</td>'

				+ '<td>' + (total_outward_gwt > 0 ? money_format_india(parseFloat(total_outward_gwt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_outward_nwt > 0 ? money_format_india(parseFloat(total_outward_nwt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_outward_diawt > 0 ? money_format_india(parseFloat(total_outward_diawt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_outward_grm_wt > 0 ? money_format_india(parseFloat(total_outward_grm_wt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_outward_ct_wt > 0 ? money_format_india(parseFloat(total_outward_ct_wt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_closing_tags > 0 ? money_format_india(total_closing_tags) : '') + '</td>'

				+ '<td>' + (total_closing_inw_pcs > 0 ? money_format_india(total_closing_inw_pcs) : '') + '</td>'

				+ '<td>' + (total_closing_inw_gwt > 0 ? money_format_india(parseFloat(total_closing_inw_gwt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_closing_net_wt > 0 ? money_format_india(parseFloat(total_closing_net_wt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_closing_dia_wt > 0 ? money_format_india(parseFloat(total_closing_dia_wt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_closing_grm_wt > 0 ? money_format_india(parseFloat(total_closing_grm_wt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_closing_ct_wt > 0 ? money_format_india(parseFloat(total_closing_ct_wt).toFixed(3)) : '') + '</td>'

				+ '<td></td>'

				+ '<td></td>'

			'</tr>';

			var nontag_total_op_blc_pcss = 0;

			var nontag_total_op_blc_gwt = 0;

			var nontag_total_op_blc_nwt = 0;

			var nontag_total_inw_pcss = 0;

			var nontag_total_inw_gwt = 0;

			var nontag_total_inw_nwt = 0;

			var nontag_total_closing_inw_pcs = 0;

			var nontag_total_closing_inw_gwt = 0;

			var nontag_total_closing_net_wt = 0;

			var nontag_total_outward_pcs = 0;

			var nontag_total_outward_gwt = 0;

			var nontag_total_outward_nwt = 0;

			if (non_tag_items != '') {

				trHTML += '<tr>'

					+ '<td style="font-weight:bold;text-align:left;text-transform:uppercase;">Non Tag Items</td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

				'</tr>';

			}

			$.each(non_tag_items, function (key, section) {

				var section_total_op_blc_pcss = 0;

				var section_total_op_blc_gwt = 0;

				var section_total_op_blc_nwt = 0;

				var section_total_inw_pcss = 0;

				var section_total_inw_gwt = 0;

				var section_total_inw_nwt = 0;

				var section_total_closing_inw_pcs = 0;

				var section_total_closing_inw_gwt = 0;

				var section_total_closing_net_wt = 0;

				var section_total_outward_pcs = 0;

				var section_total_outward_gwt = 0;

				var section_total_outward_nwt = 0;

				if ($('#stock_group_by').val() == 2 || $('#stock_group_by').val() == 3) {

					trHTML += '<tr>'

						+ '<td style="text-align:left;" colspan="2"><strong>' + key + '</strong></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

					'</tr>';

				}

				$.each(section, function (key, product) {

					var product_total_op_blc_pcss = 0;

					var product_total_op_blc_gwt = 0;

					var product_total_op_blc_nwt = 0;

					var product_total_inw_pcss = 0;

					var product_total_inw_gwt = 0;

					var product_total_inw_nwt = 0;

					var product_total_closing_inw_pcs = 0;

					var product_total_closing_inw_gwt = 0;

					var product_total_closing_net_wt = 0;

					var product_total_outward_pcs = 0;

					var product_total_outward_gwt = 0;

					var product_total_outward_nwt = 0;

					if ($('#stock_group_by').val() == 3) {

						trHTML += '<tr>'

							+ '<td style="text-align:left;" colspan="2"><strong>' + key + '</strong></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

						'</tr>';

					}

					$.each(product, function (k, items) {

						product_total_op_blc_pcss += parseFloat(items.op_blc_pcs);

						product_total_op_blc_gwt += parseFloat(items.op_blc_gwt);

						product_total_op_blc_nwt += parseFloat(items.op_blc_nwt);

						product_total_inw_pcss += parseFloat(items.inw_pcs);

						product_total_inw_gwt += parseFloat(items.inw_gwt);

						product_total_inw_nwt += parseFloat(items.inw_nwt);

						product_total_outward_pcs += parseFloat(items.sales_pcs || items.br_out_pcs);

						product_total_outward_gwt += parseFloat(items.sales_gwt || items.br_out_gwt);

						product_total_outward_nwt += parseFloat(items.sales_nwt || items.br_out_nwt);

						product_total_closing_inw_pcs += parseFloat(items.op_blc_pcs) + parseFloat(items.inw_pcs) - parseFloat(items.sales_pcs) - parseFloat(items.br_out_pcs);

						product_total_closing_inw_gwt += parseFloat(items.op_blc_gwt) + parseFloat(items.inw_gwt) - parseFloat(items.sales_gwt) - parseFloat(items.br_out_gwt);

						product_total_closing_net_wt += parseFloat(items.op_blc_nwt) + parseFloat(items.inw_nwt) - parseFloat(items.sales_nwt) - parseFloat(items.br_out_nwt);

						trHTML += '<tr>'

							+ '<td style="text-align:left;">' + ($('#stock_group_by').val() == 1 ? items.section_name : ($('#stock_group_by').val() == 2 ? items.product_name : items.sub_design_name)) + '</td>'

							+ '<td></td>'

							+ '<td>' + (items.op_blc_pcs > 0 ? money_format_india(items.op_blc_pcs) : '') + '</td>'

							+ '<td>' + (items.op_blc_gwt > 0 ? money_format_india(items.op_blc_gwt) : '') + '</td>'

							+ '<td>' + (items.op_blc_nwt > 0 ? money_format_india(items.op_blc_nwt) : '') + '</td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td>' + (items.inw_pcs > 0 ? money_format_india(items.inw_pcs) : '') + '</td>'

							+ '<td>' + (items.inw_gwt > 0 ? money_format_india(items.inw_gwt) : '') + '</td>'

							+ '<td>' + (items.inw_nwt > 0 ? money_format_india(items.inw_nwt) : '') + '</td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td>' + (items.sales_pcs > 0 || items.br_out_pcs > 0 ? money_format_india(parseFloat(parseFloat(items.sales_pcs) + parseFloat(items.br_out_pcs))) : '') + '</td>'

							+ '<td>' + (items.sales_gwt > 0 || items.br_out_gwt > 0 ? money_format_india(parseFloat(parseFloat(items.sales_gwt) + parseFloat(items.br_out_gwt)).toFixed(3)) : '') + '</td>'

							+ '<td>' + (items.sales_nwt > 0 || items.br_out_nwt > 0 ? money_format_india(parseFloat(parseFloat(items.sales_nwt) + parseFloat(items.br_out_nwt)).toFixed(3)) : '') + '</td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td>' + (items.op_blc_pcs > 0 || items.inw_pcs > 0 || items.sales_pcs > 0 || items.br_out_pcs > 0 ? money_format_india(parseFloat(parseFloat(items.op_blc_pcs) + parseFloat(items.inw_pcs) - parseFloat(items.sales_pcs) - parseFloat(items.br_out_pcs)).toFixed(0)) : '') + '</td>'

							+ '<td>' + (items.op_blc_gwt > 0 || items.inw_gwt > 0 || items.sales_gwt > 0 || items.br_out_gwt > 0 ? money_format_india(parseFloat(parseFloat(items.op_blc_gwt) + parseFloat(items.inw_gwt) - parseFloat(items.sales_gwt) - parseFloat(items.br_out_gwt)).toFixed(3)) : '') + '</td>'

							+ '<td>' + (items.op_blc_nwt > 0 || items.inw_nwt > 0 || items.sales_nwt > 0 || items.br_out_nwt > 0 ? money_format_india(parseFloat(parseFloat(items.op_blc_nwt) + parseFloat(items.inw_nwt) - parseFloat(items.sales_nwt) - parseFloat(items.br_out_nwt)).toFixed(3)) : '') + '</td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

						'</tr>';

						//   nontag_total_op_blc_pcss +=parseFloat(items.op_blc_pcs);

						//   nontag_total_op_blc_gwt +=parseFloat(items.op_blc_gwt);

						//   nontag_total_op_blc_nwt +=parseFloat(items.op_blc_nwt);

						//   nontag_total_inw_pcss +=parseFloat(items.inw_pcs);

						//   nontag_total_inw_gwt +=parseFloat(items.inw_gwt);

						//   nontag_total_inw_nwt +=parseFloat(items.inw_nwt);

						//   nontag_total_closing_inw_pcs+=parseFloat(parseFloat(parseFloat(items.op_blc_pcs) + parseFloat(items.inw_pcs) - parseFloat(items.sales_pcs) - parseFloat(items.br_out_pcs)));

						//   nontag_total_closing_inw_gwt+=parseFloat(parseFloat(parseFloat(items.op_blc_gwt) + parseFloat(items.inw_gwt) - parseFloat(items.sales_gwt) - parseFloat(items.br_out_gwt)));

						//   nontag_total_closing_net_wt+=parseFloat(parseFloat(parseFloat(items.op_blc_nwt) + parseFloat(items.inw_nwt) - parseFloat(items.sales_nwt) - parseFloat(items.br_out_nwt)));

						//   nontag_total_outward_pcs+=parseFloat(parseFloat(items.sales_pcs) + parseFloat(items.br_out_pcs));

						//   nontag_total_outward_gwt+=parseFloat(parseFloat(items.sales_gwt) + parseFloat(items.br_out_gwt));

						//   nontag_total_outward_nwt+=parseFloat(parseFloat(items.sales_nwt) + parseFloat(items.br_out_nwt));

					});

					if ($('#stock_group_by').val() == 3) {

						trHTML += '<tr style="font-weight:bold; color:blue;">' +

							+'<td></td>'

							+ '<td style="text-align:left;">SUB TOTAL</td>'

							+ '<td></td>'

							+ '<td>' + (product_total_op_blc_pcss > 0 ? money_format_india(product_total_op_blc_pcss) : '') + '</td>'

							+ '<td>' + (product_total_op_blc_gwt > 0 ? money_format_india(product_total_op_blc_gwt.toFixed(3)) : '') + '</td>'

							+ '<td>' + (product_total_op_blc_nwt > 0 ? money_format_india(product_total_op_blc_nwt.toFixed(3)) : '') + '</td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td>' + (product_total_inw_pcss > 0 ? money_format_india(product_total_inw_pcss) : '') + '</td>'

							+ '<td>' + (product_total_inw_gwt > 0 ? money_format_india(product_total_inw_gwt.toFixed(3)) : '') + '</td>'

							+ '<td>' + (product_total_inw_nwt > 0 ? money_format_india(product_total_inw_nwt.toFixed(3)) : '') + '</td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td>' + (product_total_outward_pcs > 0 ? money_format_india(product_total_outward_pcs) : '') + '</td>'

							+ '<td>' + (product_total_outward_gwt > 0 ? money_format_india(product_total_outward_gwt.toFixed(3)) : '') + '</td>'

							+ '<td>' + (product_total_outward_nwt > 0 ? money_format_india(product_total_outward_nwt.toFixed(3)) : '') + '</td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td>' + (product_total_closing_inw_pcs > 0 ? money_format_india(product_total_closing_inw_pcs.toFixed(0)) : '') + '</td>'

							+ '<td>' + (product_total_closing_inw_gwt > 0 ? money_format_india(product_total_closing_inw_gwt.toFixed(3)) : '') + '</td>'

							+ '<td>' + (product_total_closing_net_wt > 0 ? money_format_india(product_total_closing_net_wt.toFixed(3)) : '') + '</td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

						'</tr>';

					}

					section_total_op_blc_pcss += product_total_op_blc_pcss;

					section_total_op_blc_gwt += product_total_op_blc_gwt;

					section_total_op_blc_nwt += product_total_op_blc_nwt;

					section_total_inw_pcss += product_total_inw_pcss;

					section_total_inw_gwt += product_total_inw_gwt;

					section_total_inw_nwt += product_total_inw_nwt;

					section_total_outward_pcs += product_total_outward_pcs;

					section_total_outward_gwt += product_total_outward_gwt;

					section_total_outward_nwt += product_total_outward_nwt;

					section_total_closing_inw_pcs += product_total_closing_inw_pcs;

					section_total_closing_inw_gwt += product_total_closing_inw_gwt;

					section_total_closing_net_wt += product_total_closing_net_wt;

				});

				if ($('#stock_group_by').val() == 3) {

					trHTML += '<tr style="font-weight:bold; color:red;">' +

						+'<td></td>'

						+ '<td style="text-align:left;">PRODUCT GRAND TOTAL</td>'

						+ '<td></td>'

						+ '<td>' + (section_total_op_blc_pcss > 0 ? money_format_india(section_total_op_blc_pcss) : '') + '</td>'

						+ '<td>' + (section_total_op_blc_gwt > 0 ? money_format_india(section_total_op_blc_gwt.toFixed(3)) : '') + '</td>'

						+ '<td>' + (section_total_op_blc_nwt > 0 ? money_format_india(section_total_op_blc_nwt.toFixed(3)) : '') + '</td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td>' + (section_total_inw_pcss > 0 ? money_format_india(section_total_inw_pcss.toFixed(3)) : '') + '</td>'

						+ '<td>' + (section_total_inw_gwt > 0 ? money_format_india(section_total_inw_gwt.toFixed(3)) : '') + '</td>'

						+ '<td>' + (section_total_inw_nwt > 0 ? money_format_india(section_total_inw_nwt.toFixed(3)) : '') + '</td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td>' + (section_total_outward_pcs > 0 ? money_format_india(section_total_outward_pcs) : '') + '</td>'

						+ '<td>' + (section_total_outward_gwt > 0 ? money_format_india(section_total_outward_gwt.toFixed(3)) : '') + '</td>'

						+ '<td>' + (section_total_outward_nwt > 0 ? money_format_india(section_total_outward_nwt.toFixed(3)) : '') + '</td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td>' + (section_total_closing_inw_pcs > 0 ? money_format_india(section_total_closing_inw_pcs.toFixed(0)) : '') + '</td>'

						+ '<td>' + (section_total_closing_inw_gwt > 0 ? money_format_india(section_total_closing_inw_gwt.toFixed(3)) : '') + '</td>'

						+ '<td>' + (section_total_closing_net_wt > 0 ? money_format_india(section_total_closing_net_wt.toFixed(3)) : '') + '</td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

					'</tr>';

				}

				nontag_total_op_blc_pcss += section_total_op_blc_pcss;

				nontag_total_op_blc_gwt += section_total_op_blc_gwt;

				nontag_total_op_blc_nwt += section_total_op_blc_nwt;

				nontag_total_inw_pcss += section_total_inw_pcss;

				nontag_total_inw_gwt += section_total_inw_gwt;

				nontag_total_inw_nwt += section_total_inw_nwt;

				nontag_total_outward_pcs += section_total_outward_pcs;

				nontag_total_outward_gwt += section_total_outward_gwt;

				nontag_total_outward_nwt += section_total_outward_nwt;

				nontag_total_closing_inw_pcs += section_total_closing_inw_pcs;

				nontag_total_closing_inw_gwt += section_total_closing_inw_gwt;

				nontag_total_closing_net_wt += section_total_closing_net_wt;

			});

			trHTML += '<tr style="font-weight:bold; color:blue;">' +

				+'<td></td>'

				+ '<td style="text-align:left;">GRAND TOTAL</td>'

				+ '<td></td>'

				+ '<td>' + (nontag_total_op_blc_pcss > 0 ? money_format_india(nontag_total_op_blc_pcss) : "") + '</td>'

				+ '<td>' + (nontag_total_op_blc_gwt > 0 ? money_format_india(parseFloat(nontag_total_op_blc_gwt).toFixed(3)) : "") + '</td>'

				+ '<td>' + (nontag_total_op_blc_nwt > 0 ? money_format_india(parseFloat(nontag_total_op_blc_nwt).toFixed(3)) : "") + '</td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td>' + (nontag_total_inw_pcss > 0 ? money_format_india(nontag_total_inw_pcss) : "") + '</td>'

				+ '<td>' + (nontag_total_inw_gwt > 0 ? money_format_india(parseFloat(nontag_total_inw_gwt).toFixed(3)) : "") + '</td>'

				+ '<td>' + (nontag_total_inw_nwt > 0 ? money_format_india(parseFloat(nontag_total_inw_nwt).toFixed(3)) : "") + '</td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td>' + (nontag_total_outward_pcs > 0 ? money_format_india(parseFloat(nontag_total_outward_pcs)) : "") + '</td>'

				+ '<td>' + (nontag_total_outward_gwt > 0 ? money_format_india(parseFloat(nontag_total_outward_gwt).toFixed(3)) : "") + '</td>'

				+ '<td>' + (nontag_total_outward_nwt > 0 ? money_format_india(parseFloat(nontag_total_outward_nwt).toFixed(3)) : "") + '</td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td>' + (nontag_total_closing_inw_pcs > 0 ? money_format_india(parseFloat(nontag_total_closing_inw_pcs).toFixed(0)) : "") + '</td>'

				+ '<td>' + (nontag_total_closing_inw_gwt > 0 ? money_format_india(parseFloat(nontag_total_closing_inw_gwt).toFixed(3)) : "") + '</td>'

				+ '<td>' + (nontag_total_closing_net_wt > 0 ? money_format_india(parseFloat(nontag_total_closing_net_wt).toFixed(3)) : "") + '</td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

			'</tr>';

			trHTML += '<tr style="font-weight:bold;color:red;">' +

				+'<td></td>'

				+ '<td style="text-align:left;">GRAND TOTAL</td>'

				+ '<td>' + (total_op_tags > 0 ? money_format_india(total_op_tags) : '') + '</td>'

				+ '<td>' + (total_op_blc_pcss || nontag_total_op_blc_pcss > 0 ? money_format_india(parseFloat(total_op_blc_pcss + nontag_total_op_blc_pcss)) : '') + '</td>'

				+ '<td>' + (total_op_blc_gwt || nontag_total_op_blc_gwt > 0 ? money_format_india(parseFloat(total_op_blc_gwt + nontag_total_op_blc_gwt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_op_blc_nwt || nontag_total_op_blc_nwt > 0 ? money_format_india(parseFloat(total_op_blc_nwt + nontag_total_op_blc_nwt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_op_blc_diawt > 0 ? money_format_india(parseFloat(total_op_blc_diawt).toFixed(3)) : '') + '</td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td>' + (total_inw_tags > 0 ? money_format_india(total_inw_tags) : '') + '</td>'

				+ '<td>' + (total_inw_pcss || nontag_total_inw_pcss > 0 ? money_format_india(parseFloat(total_inw_pcss + nontag_total_inw_pcss)) : '') + '</td>'

				+ '<td>' + (total_inw_gwt || nontag_total_inw_gwt > 0 ? money_format_india(parseFloat(total_inw_gwt + nontag_total_inw_gwt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_inw_nwt || nontag_total_inw_nwt > 0 ? money_format_india(parseFloat(total_inw_nwt + nontag_total_inw_nwt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_inw_diawt > 0 ? money_format_india(parseFloat(total_inw_diawt).toFixed(3)) : '') + '</td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td>' + (total_outward_tags > 0 ? money_format_india(parseFloat(total_outward_tags).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_outward_pcs || nontag_total_outward_pcs > 0 ? money_format_india(parseFloat(total_outward_pcs + nontag_total_outward_pcs)) : '') + '</td>'

				+ '<td>' + (total_outward_gwt || nontag_total_outward_gwt > 0 ? money_format_india(parseFloat(total_outward_gwt + nontag_total_outward_gwt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_outward_nwt || nontag_total_outward_nwt > 0 ? money_format_india(parseFloat(total_outward_nwt + nontag_total_outward_nwt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_outward_diawt > 0 ? money_format_india(parseFloat(total_outward_diawt).toFixed(3)) : '') + '</td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td>' + (total_closing_tags > 0 ? money_format_india(total_closing_tags) : '') + '</td>'

				+ '<td>' + (total_closing_inw_pcs || nontag_total_closing_inw_pcs > 0 ? money_format_india(total_closing_inw_pcs + nontag_total_closing_inw_pcs) : '') + '</td>'

				+ '<td>' + (total_closing_inw_gwt || nontag_total_closing_inw_gwt > 0 ? money_format_india(parseFloat(total_closing_inw_gwt + nontag_total_closing_inw_gwt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_closing_net_wt || nontag_total_closing_net_wt > 0 ? money_format_india(parseFloat(total_closing_net_wt + nontag_total_closing_net_wt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_closing_dia_wt > 0 ? money_format_india(parseFloat(total_closing_dia_wt).toFixed(3)) : '') + '</td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

			'</tr>';

			trHTML += '<tr style="font-weight:bold;">' +

				+'<td></td>'

				+ '<td style="text-align:left;">TOTAL SUMMARY</td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

			'</tr>';

			trHTML += '<tr style="font-weight:bold;">' +

				+'<td></td>'

				+ '<td style="text-align:left;">#</td>'

				+ '<td>No.Tags</td>'

				+ '<td>PCS</td>'

				+ '<td>G.WT</td>'

				+ '<td>N.WT</td>'

				+ '<td>D.WT</td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

			'</tr>';

			trHTML += '<tr style="font-weight:bold;">' +

				+'<td></td>'

				+ '<td style="text-align:left;">OPENING</td>'

				+ '<td>' + (total_op_tags > 0 ? money_format_india(total_op_tags) : '') + '</td>'

				+ '<td>' + (total_op_blc_pcss || nontag_total_op_blc_pcss > 0 ? money_format_india(total_op_blc_pcss + nontag_total_op_blc_pcss) : '') + '</td>'

				+ '<td>' + (total_op_blc_gwt || nontag_total_op_blc_gwt > 0 ? money_format_india(parseFloat(total_op_blc_gwt + nontag_total_op_blc_gwt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_op_blc_nwt || nontag_total_op_blc_nwt > 0 ? money_format_india(parseFloat(total_op_blc_nwt + nontag_total_op_blc_nwt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_op_blc_diawt > 0 ? money_format_india(parseFloat(total_op_blc_diawt).toFixed(3)) : '') + '</td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

			'</tr>';

			trHTML += '<tr style="font-weight:bold;">' +

				+'<td></td>'

				+ '<td style="text-align:left;">INWARD</td>'

				+ '<td>' + (total_inw_tags > 0 ? money_format_india(total_inw_tags) : '') + '</td>'

				+ '<td>' + (total_inw_pcss || nontag_total_inw_pcss > 0 ? money_format_india(total_inw_pcss + nontag_total_inw_pcss) : '') + '</td>'

				+ '<td>' + (total_inw_gwt || nontag_total_inw_gwt > 0 ? money_format_india(parseFloat(total_inw_gwt + nontag_total_inw_gwt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_inw_nwt || nontag_total_inw_nwt > 0 ? money_format_india(parseFloat(total_inw_nwt + nontag_total_inw_nwt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_inw_diawt > 0 ? money_format_india(parseFloat(total_inw_diawt).toFixed(3)) : '') + '</td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

			'</tr>';

			trHTML += '<tr style="font-weight:bold;">' +

				+'<td></td>'

				+ '<td style="text-align:left;">OUTWARD</td>'

				+ '<td>' + (total_outward_tags > 0 ? money_format_india(parseFloat(total_outward_tags)) : '') + '</td>'

				+ '<td>' + (total_outward_pcs || nontag_total_outward_pcs > 0 ? money_format_india(parseFloat(total_outward_pcs + nontag_total_outward_pcs)) : '') + '</td>'

				+ '<td>' + (total_outward_gwt || nontag_total_outward_gwt > 0 ? money_format_india(parseFloat(total_outward_gwt + nontag_total_outward_gwt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_outward_nwt || nontag_total_outward_nwt > 0 ? money_format_india(parseFloat(total_outward_nwt + nontag_total_outward_nwt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_outward_diawt > 0 ? money_format_india(parseFloat(total_outward_diawt).toFixed(3)) : '') + '</td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

			'</tr>';

			trHTML += '<tr style="font-weight:bold;">' +

				+'<td></td>'

				+ '<td style="text-align:left;">CLOSING</td>'

				+ '<td>' + (total_closing_tags > 0 ? money_format_india(total_closing_tags) : '') + '</td>'

				+ '<td>' + (total_closing_inw_pcs || nontag_total_closing_inw_pcs > 0 ? money_format_india(total_closing_inw_pcs + nontag_total_closing_inw_pcs) : '') + '</td>'

				+ '<td>' + (total_closing_inw_gwt || nontag_total_closing_inw_gwt > 0 ? money_format_india(parseFloat(total_closing_inw_gwt + nontag_total_closing_inw_gwt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_closing_net_wt || nontag_total_closing_net_wt > 0 ? money_format_india(parseFloat(total_closing_net_wt + nontag_total_closing_net_wt).toFixed(3)) : '') + '</td>'

				+ '<td>' + (total_closing_dia_wt > 0 ? money_format_india(parseFloat(total_closing_dia_wt).toFixed(3)) : '') + '</td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

			'</tr>';

			$('#section_stock_list > tbody').html(trHTML);

			// Check and initialise datatable

			if (!$.fn.DataTable.isDataTable('#section_stock_list')) {

				oTable = $('#section_stock_list').dataTable({

					"bSort": false,

					"bInfo": true,

					"scrollX": '100%',

					"dom": 'lBfrtip',

					"paging": false,

					"bAutoWidth": false,

					"columnDefs": [

						{

							targets: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22],

							className: 'dt-body-right'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'colvis',

							collectionLayout: 'fixed columns',

							collectionTitle: 'Column visibility control'

						},

						{

							extend: 'excel',

							footer: true,

							title: 'SECTION WISE STOCK REPORT ' + branch_name + '-' + dt_range[0] + '-' + dt_range[1],

						}

					],

				});

			}

			$(".overlay").css("display", "none");

		}

	});

}

$('#stock_group_by').on('change', function () {

	$('#stock_group_by').val(this.value);

	if (this.value == 1) {

		$('.sect').css("display", "block");

		$('.pro').css("display", "none");

		$('.des').css("display", "none");

		$('#prod_select').val('');

		$('#des_select').val('');

		$('#sub_des_select').val('');

	}

	else if (this.value == 2) {

		$('.sect').css("display", "none");

		$('.pro').css("display", "block");

		$('.des').css("display", "none");

		$('#section_select').val('');

		$('#des_select').val('');

		$('#sub_des_select').val('');

	}

	else if (this.value == 3) {

		$('.sect').css("display", "none");

		$('.pro').css("display", "block");

		$('.des').css("display", "block");

		$('#section_select').val('');

		$('#prod_select').val('');

	}

});

/*Section-Wise Stock In & Out Report*/

//Contract Price Report

function set_dashboard_contractprice() {

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/dashboard_contractprice/ajax/?nocache=" + my_Date.getUTCSeconds(),

		data: { 'status': ctrl_page[3] },

		type: "POST",

		dataType: "JSON",

		cache: false,

		success: function (data) {

			var list = data.list;

			var oTable = $('#dash_contract_price_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#dash_contract_price_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: 'Contract Price',

						}

					],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "id_karikar_wast" },

						{ "mDataProp": "karigar" },

						{ "mDataProp": "product_name" },

						{ "mDataProp": "design_name" },

						{ "mDataProp": "sub_design_name" },

						{ "mDataProp": "calc_type" },

						{ "mDataProp": "wastage_per" },

						{ "mDataProp": "type" },

						{ "mDataProp": "mc_value" },

						{ "mDataProp": "pur_touch" },

						{

							"mDataProp": function (row, type, val, meta) {

								var wast_img_name = '';

								if (row.image_name != null && row.image_name != undefined && row.image_name != '') {

									wast_img_name = base_url + 'assets/img/karigar/product_wastage/' + row.id_karikar_wast + '/' + row.image_name;

								}

								else {

									wast_img_name = base_url + 'assets/img/no_image.png';

								}

								var image = "<img  class='img_src' id='img_prev' src=" + wast_img_name + "  width='35' height='35' onClick=tag_imgprev($(this).closest('tr')) ></img>"

								return image;

							},

						},

					],

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//Contract Price Report

function get_employee(type = "") {

	var id_branch = ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val());

	if (id_branch > 0) {

		$.ajax({

			type: 'POST',

			url: base_url + 'index.php/admin_ret_estimation/get_employee',

			data: ({ 'id_branch': id_branch }),

			dataType: 'json',

			success: function (data) {

				if (type == "cash_abs") {

					$("#emp_sel").empty();

					$.each(data, function (key, item) {

						$('#emp_sel').append(

							$("<option></option>")

								.attr("value", item.id_employee)

								.text(item.emp_name)

						);

					});

					$('#emp_sel').select2("val", "");

				}

			}

		});

	}

}

/*Lot Merge Reports*/

function getlotMergeNos() {

	my_Date = new Date();

	$('#lot_nos option').remove();

	$.ajax({

		type: 'GET',

		url: base_url + 'index.php/admin_ret_reports/lot_merge_report/getlotMergeNos',

		dataType: 'json',

		success: function (data) {

			$("#lot_nos").append(

				$("<option></option>")

					.attr("value", "")

					.text('')

			);

			$.each(data, function (key, item) {

				$('#lot_nos').append(

					$("<option></option>")

						.attr("value", item.lot_no)

						.text(item.lot_no)

				);

			});

			$('#lot_nos').select2("val", "");

		}

	});

}

$('#lot_nos').on('change', function () {

	get_lot_merge_details();

})

function get_lot_merge_details() {

	var company_name = $('#company_name').val();

	var from_date = '';

	var to_date = '';

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "Lot Merge Detail Report";

	var optional = "";

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/lot_merge_report/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: { 'lot_no': $('#lot_nos').val() },

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var oTable = $('#lot_merge_list').DataTable();

			oTable.clear().draw();

			if (data != null && data.length > 0) {

				oTable = $('#lot_merge_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"columnDefs": [

						{

							targets: [4, 5, 6, 7, 8],

							className: 'dt-body-right'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: "",

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'colvis',

							collectionLayout: 'fixed columns',

							collectionTitle: 'Column visibility control'

						},

						{

							extend: 'excel',

							footer: true,

							title: "Lot Merge Detail Report",

						}

					],

					"aaData": data,

					"aoColumns": [

						{ "mDataProp": "lot_no" },

						{ "mDataProp": "category" },

						{ "mDataProp": "product_name" },

						{ "mDataProp": "karigar" },

						{ "mDataProp": "pcs" },

						{ "mDataProp": "gross_wt" },

						{ "mDataProp": "net_wt" },

						{ "mDataProp": "dia_wt" },

						{ "mDataProp": "stn_wt" },

						{

							"mDataProp": null,

							"sClass": "control center",

							"sDefaultContent": '<span class="drill-val"><i class="fa fa-chevron-circle-down text-teal"></i></span>'

						},

					],

					"footerCallback": function (row, data, start, end, display) {

						if (data.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								pcs = api

									.column(4)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(4).footer()).html(parseFloat(pcs));

								grswt = api

									.column(5)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(5).footer()).html(parseFloat(grswt).toFixed(3));

								netwt = api

									.column(6)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(6).footer()).html(parseFloat(netwt).toFixed(3));

								diawt = api

									.column(7)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(7).footer()).html(parseFloat(diawt).toFixed(3));

								stnwt = api

									.column(8)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(8).footer()).html(parseFloat(stnwt).toFixed(3));

							}

						} else {

							var api = this.api(), data;

							$(api.column(4).footer()).html('');

							$(api.column(5).footer()).html('');

							$(api.column(6).footer()).html('');

							$(api.column(7).footer()).html('');

							$(api.column(8).footer()).html('');

						}

					}

				});

				var anOpen = [];

				$(document).on('click', "#lot_merge_list .control", function () {

					var nTr = this.parentNode;

					var i = $.inArray(nTr, anOpen);

					if (i === -1) {

						$('.drill-val', this).html('<i class="fa fa-chevron-circle-up text-teal"></i>');

						oTable.fnOpen(nTr, fnFormatLotMergeDetails(oTable, nTr), 'details');

						anOpen.push(nTr);

					}

					else {

						$('.drill-val', this).html('<i class="fa fa-chevron-circle-down text-teal"></i>');

						oTable.fnClose(nTr);

						anOpen.splice(i, 1);

					}

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function fnFormatLotMergeDetails(oTable, nTr) {

	var oData = oTable.fnGetData(nTr);

	var rowDetail = '';

	var prodTable =

		'<div class="innerDetails">' +

		'<table class="table table-responsive table-bordered text-center table-sm">' +

		'<tr class="bg-teal">' +

		'<th>S.No</th>' +

		'<th>Lot No</th>' +

		'<th>Product Name</th>' +

		'<th>No.of pcs</th>' +

		'<th>Gross Wt</th>' +

		'<th>Net Wt</th>' +

		'<th>Dia Wt</th>' +

		'<th>Stn Wt</th>' +

		'</tr>';

	var lot_details = oData.lot_det;

	var total_pcs = 0;

	var total_gwt = 0;

	var total_nwt = 0;

	var total_dia_wt = 0;

	var total_stn_wt = 0;

	$.each(lot_details, function (idx, val) {

		total_pcs += parseFloat(val.no_of_piece);

		total_gwt += parseFloat(val.gross_wt);

		total_nwt += parseFloat(val.net_wt);

		total_dia_wt += parseFloat(val.dia_wt);

		total_stn_wt += parseFloat(val.stn_wt);

		prodTable +=

			'<tr class="prod_det_btn">' +

			'<td>' + parseFloat(idx + 1) + '</td>' +

			'<td>' + val.lot_no + '</td>' +

			'<td>' + val.product_name + '</td>' +

			'<td>' + val.no_of_piece + '</td>' +

			'<td>' + money_format_india(val.gross_wt) + '</td>' +

			'<td>' + money_format_india(val.net_wt) + '</td>' +

			'<td>' + money_format_india(val.dia_wt) + '</td>' +

			'<td>' + money_format_india(val.stn_wt) + '</td>' +

			'</tr>';

	});

	prodTable +=

		'<tr class="prod_det_btn">' +

		'<td colspan="3"><strong>Total</strong></td>' +

		'<td><strong>' + money_format_india(parseFloat(total_pcs)) + '</td></strong>' +

		'<td><strong>' + money_format_india(parseFloat(total_gwt).toFixed(3)) + '</strong></td>' +

		'<td><strong>' + money_format_india(parseFloat(total_nwt).toFixed(3)) + '</strong></td>' +

		'<td><strong>' + money_format_india(parseFloat(total_dia_wt).toFixed(3)) + '</strong></td>' +

		'<td><strong>' + money_format_india(parseFloat(total_stn_wt).toFixed(3)) + '</strong></td>' +

		'</tr>';

	rowDetail = prodTable + '</table></div>';

	return rowDetail;

}

/*Lot Merge Reports*/

/*Lot Split Reports*/

function get_ActiveEmployee() {

	$('#emp_select option').remove();

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_estimation/get_employee?nocache=",

		type: "POST",

		dataType: "JSON",

		success: function (data) {

			if (ctrl_page[1] != 'est_referral') {

				$("#emp_select").append(

					$("<option></option>")

						.attr("value", "")

						.text('')

				);

			}

			$.each(data, function (key, item) {

				$("#emp_select").append(

					$("<option></option>")

						.attr("value", item.id_employee)

						.text(item.emp_name)

				);

			});

			$("#emp_select").select2("val", "");

			$(".overlay").css("display", "none");

		},

		error: function (error) {

		}

	});

}

$('#emp_select').on('change', function () {

	if (ctrl_page[1] != 'est_referral') {

		get_lot_split_details();

	}

})

function get_lot_split_details() {

	var company_name = $('#company_name').val();

	var from_date = '';

	var to_date = '';

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "Lot Split Detail Report";

	var optional = "";

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/lot_split_report/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: { 'id_employee': $('#emp_select').val() },

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var oTable = $('#lot_split_list').DataTable();

			oTable.clear().draw();

			if (data != null && data.length > 0) {

				oTable = $('#lot_split_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"columnDefs": [

						{

							targets: [4, 5, 6, 7, 8],

							className: 'dt-body-right'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: "",

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'colvis',

							collectionLayout: 'fixed columns',

							collectionTitle: 'Column visibility control'

						},

						{

							extend: 'excel',

							footer: true,

							title: "Lot Split Detail Report",

						}

					],

					"aaData": data,

					"aoColumns": [

						{ "mDataProp": "lot_no" },

						{ "mDataProp": "emp_name" },

						{ "mDataProp": "category" },

						{ "mDataProp": "product_name" },

						{ "mDataProp": "split_pcs" },

						{ "mDataProp": "split_grs_wt" },

						{ "mDataProp": "split_net_wt" },

						{ "mDataProp": "split_dia_wt" },

						{ "mDataProp": "split_stn_wt" },

					],

					"footerCallback": function (row, data, start, end, display) {

						if (data.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								pcs = api

									.column(4)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(4).footer()).html(parseFloat(pcs));

								grswt = api

									.column(5)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(5).footer()).html(parseFloat(grswt).toFixed(3));

								netwt = api

									.column(6)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(6).footer()).html(parseFloat(netwt).toFixed(3));

								diawt = api

									.column(7)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(7).footer()).html(parseFloat(diawt).toFixed(3));

								stnwt = api

									.column(8)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(8).footer()).html(parseFloat(stnwt).toFixed(3));

							}

						} else {

							var api = this.api(), data;

							$(api.column(4).footer()).html('');

							$(api.column(5).footer()).html('');

							$(api.column(6).footer()).html('');

							$(api.column(7).footer()).html('');

							$(api.column(8).footer()).html('');

						}

					}

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

/*Lot Split Reports*/

/*Advance transfer report*/

$('#adv_trns_search').click(function (event) {

	get_advance_transfer_details();

});

function get_advance_transfer_details() {

	var dt_range = ($("#dt_range").val()).split('-');

	var company_name = $('#company_name').val();

	var from_date = dt_range[0];

	var to_date = dt_range[1];

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "Advance Transfer"

	var optional = $('#karigar option:selected').html() != '' && $('#karigar option:selected').html() != undefined ? $('#karigar option:selected').html() + " - " : '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		type: 'POST',

		url: base_url + "index.php/admin_ret_reports/advance_transfer_details/ajax",

		data: { 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'dt_range': $("#dt_range").val() },

		dataType: 'JSON',

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.list;

			// $('#total_count').text(list.length);

			var oTable = $('#advance_transfer_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				var a = 1,

					oTable = $('#advance_transfer_list').dataTable({

						"bDestroy": true,

						"bInfo": true,

						"bFilter": true,

						"scrollX": '100%',

						"bSort": true,

						"dom": 'lBfrtip',

						"order": [[0, "asc"]],

						"columnDefs": [

							{

								targets: [5],

								className: 'dt-body-right'

							},

						],

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: '',

								messageTop: title,

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', '10px');

								},

							},

							{

								extend: 'excel',

								footer: true,

								title: "Advance Transfer Report",

							}

						],

						"aaData": list,

						"aoColumns": [

							{

								"mDataProp": function (row, type, val, meta) {

									return a++;

								}

							},

							// { "mDataProp": "transfer_receipt_id" },

							{

								"mDataProp": function (row, type, val, meta) {

									var url = base_url + 'index.php/admin_ret_billing/receipt/receipt_print/' + row.id_issue_receipt;

									return '<a href=' + url + ' target="_blank">' + row.bill_no + '</a>';

								}

							},

							{ "mDataProp": "bill_date" },

							{ "mDataProp": "from_cust" },

							{ "mDataProp": "to_cust" },

							{

								"mDataProp": function (row, type, val, meta) {

									var transfer_amount = row.transfer_amount;

									return money_format_india(parseFloat(transfer_amount).toFixed(2));

								}

							},

						],

					});

			}

		}

	})

}

/*Advance transfer report*/

/*Item Delivery Report*/

$('#item_delivery_search').on('click', function () {

	get_ItemDeliveryDetails();

});

function get_ItemDeliveryDetails() {

	var from_date = '';

	var to_date = '';

	var company_name = $('#company_name').val();

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "Item Delivery Report"

	var metal = $('#filter_metal option:selected').html() != '' && $('#filter_metal option:selected ').html() != undefined ? $('#filter_metal option:selected').html() + " - " : '';

	var old_metal_type = $('#old_metal_type option:selected').html() != '' && $('#old_metal_type option:selected ').html() != undefined ? $('#old_metal_type option:selected').html() + " - " : '';

	var optional = metal + old_metal_type;

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/item_delivery_report/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'deliver_status': $('#item_status').val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			var oTable = $('#item_delivery_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#item_delivery_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"columnDefs": [

						{

							targets: [7, 8, 9],

							className: 'dt-body-right'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: "",

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'colvis',

							collectionLayout: 'fixed columns',

							collectionTitle: 'Column visibility control'

						},

						{

							extend: 'excel',

							footer: true,

							title: "Item Delivery Detail Report",

						}

					],

					"aaData": list,

					"aoColumns": [

						{

							"mDataProp": function (row, type, val, meta) {

								var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + row.bill_id;

								return '<a href=' + url + ' target="_blank">' + row.bill_no + '</a>';

							}

						},

						{ "mDataProp": "bill_date" },

						{ "mDataProp": "branch_name" },

						{ "mDataProp": "cus_name" },

						{ "mDataProp": "mobile" },

						{ "mDataProp": "tag_code" },

						{ "mDataProp": "product_name" },

						{ "mDataProp": "gross_wt" },

						{ "mDataProp": "net_wt" },

						{

							"mDataProp": function (row, type, val, meta) {

								var item_cost = row.item_cost;

								return money_format_india(item_cost);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								if (row.is_delivered == 0) {

									return '<span class="badge bg-red">Yet to Deliver</span>';

								} else if (row.is_delivered == 2) {

									return '<span class="badge bg-green">Delivered</span>';

								}

							}

						},

						{ "mDataProp": "delivered_date" },

						{ "mDataProp": "delivered_by" },

					],

					"footerCallback": function (row, data, start, end, display) {

						if (data.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								grswt = api

									.column(7)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(7).footer()).html(money_format_india(parseFloat(grswt).toFixed(3)));

								netwt = api

									.column(8)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(8).footer()).html(money_format_india(parseFloat(netwt).toFixed(3)));

								amount = api

									.column(9)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(9).footer()).html(money_format_india(parseFloat(amount)));

							}

						} else {

							var api = this.api(), data;

							$(api.column(7).footer()).html('');

							$(api.column(8).footer()).html('');

							$(api.column(9).footer()).html('');

						}

					}

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

/*Item Delivery Report*/

/*GSTR1 SALES REPORT*/

$('#gstr1_sales_search').on('click', function () {

	get_gstr1_sales_items();

});

function get_gstr1_sales_items() {

	var company_name = $('#company_name').val();

	var from_date = $('#rpt_payments1').html();

	var to_date = $('#rpt_payments2').html();

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "GSTR1 SALES REPORT";

	var optional = '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/gstr1_sales/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: { 'from_date': $('#rpt_payments1').html(), 'to_date': $('#rpt_payments2').html(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()) },

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var trHTML = '';

			export_list = data.list;

			var sales_details = data.list.sales_details;

			var tot_sales_details = data.list.tot_sales_details;

			var tot_sales_retrun_details = data.list.tot_sales_ret_details;

			var inv_value = 0;

			var taxable_amount = 0;

			var igst = 0;

			var cgst = 0;

			var sgst = 0;

			var weight = 0;

			if (sales_details.length > 0) {

				$.each(sales_details, function (key, val) {

					inv_value += parseFloat(val.invoice_value);

					taxable_amount += parseFloat(val.taxable_amt);

					igst += parseFloat(val.igst);

					cgst += parseFloat(val.cgst);

					sgst += parseFloat(val.sgst);

					weight += parseFloat(val.grs_wt);

					print_url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + val.bill_id;

					action_content = '<a href="' + print_url + '" target="_blank" title="Billing Receipt">' + val.invoice_no + '</a>'

					trHTML += '<tr class="sales">' +

						'<td>' + val.invoice_type + '</td>' +

						'<td>' + val.customer_name + '</td>' +

						'<td>' + action_content + '</td>' +

						'<td>' + val.invoice_date + '</td>' +

						'<td>' + val.gst_no + '</td>' +

						'<td>' + val.address1 + '</td>' +

						'<td>' + val.address2 + '</td>' +

						'<td>' + val.address3 + '</td>' +

						'<td>' + val.state + '</td>' +

						'<td>' + money_format_india(parseFloat(val.invoice_value).toFixed(2)) + '</td>' +

						'<td>' + val.sr_no + '</td>' +

						'<td>' + money_format_india(parseFloat(val.taxable_amt).toFixed(2)) + '</td>' +

						'<td>' + parseFloat(val.tax_percentage) + '</td>' +

						'<td>' + (val.igst > 0 ? parseFloat(val.tax_percentage) : '') + '</td>' +

						'<td>' + money_format_india(parseFloat(val.igst).toFixed(2)) + '</td>' +

						'<td>' + (val.cgst > 0 ? parseFloat(parseFloat(val.tax_percentage) / 2).toFixed(2) : '') + '</td>' +

						'<td>' + money_format_india(parseFloat(val.cgst).toFixed(2)) + '</td>' +

						'<td>' + (val.sgst > 0 ? parseFloat(parseFloat(val.tax_percentage) / 2).toFixed(2) : '') + '</td>' +

						'<td>' + money_format_india(parseFloat(val.sgst).toFixed(2)) + '</td>' +

						'<td>' + val.hsn_code + '</td>' +

						'<td>' + val.product_name + '</td>' +

						'<td>GRAMS</td>' +

						'<td>' + parseFloat(val.grs_wt).toFixed(3) + '</td>' +

						'</tr>';

				});

				trHTML += '<tr class="sales" style="color:blue;">' +

					'<td><strong>SALES TOTAL</stong></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td><strong>' + money_format_india(parseFloat(inv_value).toFixed(2)) + '</strong></td>' +

					'<td></td>' +

					'<td><strong>' + money_format_india(parseFloat(taxable_amount).toFixed(2)) + '</strong></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td><strong>' + money_format_india(parseFloat(igst).toFixed(2)) + '</strong></td>' +

					'<td></td>' +

					'<td><strong>' + money_format_india(parseFloat(cgst).toFixed(2)) + '</strong></td>' +

					'<td></td>' +

					'<td><strong>' + money_format_india(parseFloat(sgst).toFixed(2)) + '</strong></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td><strong>' + money_format_india(parseFloat(weight).toFixed(3)) + '</strong></td>' +

					'</tr>';

			}

			trHTML += '<tr style="font-weight:bold">' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td>TOTAL SUMMARY</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'</tr>';

			var total_net_pcs = 0;

			var total_net_grs_wt = 0;

			var total_net_net_wt = 0;

			var total_net_taxable_amt = 0;

			var total_net_tax_amt = 0;

			var total_net_item_cost = 0;

			if (tot_sales_details.length > 0) {

				var total_sales_pcs = 0;

				var total_sales_grs_wt = 0;

				var total_sales_net_wt = 0;

				var total_sales_taxable_amt = 0;

				var total_sales_tax_amt = 0;

				var total_sales_item_cost = 0;

				$.each(tot_sales_details, function (i, item) {

					total_sales_pcs += parseFloat(item.sales_tot_pcs);

					total_sales_grs_wt += parseFloat(item.sales_tot_grswt);

					total_sales_net_wt += parseFloat(item.sales_tot_nwt);

					total_sales_taxable_amt += parseFloat(item.sales_taxable_amt);

					total_sales_tax_amt += parseFloat(item.sales_tax_amt);

					total_sales_item_cost += parseFloat(item.sales_tot_item_cost);

					trHTML += '<tr class="sales">' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td><strong>SALES GRAND TOTAL</strong></td>' +

						'<td></td>' +

						'<td><strong>' + money_format_india(parseFloat(item.sales_tot_pcs)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(item.sales_tot_grswt).toFixed(3)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(item.sales_tot_nwt).toFixed(3)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(item.sales_taxable_amt).toFixed(2)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(item.sales_tax_amt).toFixed(2)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(item.sales_tot_item_cost).toFixed(2)) + '</strong></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'</tr>';

				});

			}

			if (tot_sales_retrun_details.length > 0) {

				var total_ret_sales_pcs = 0;

				var total_ret_sales_grs_wt = 0;

				var total_ret_sales_net_wt = 0;

				var total_ret_sales_taxable_amt = 0;

				var total_ret_sales_tax_amt = 0;

				var total_ret_sales_item_cost = 0;

				$.each(tot_sales_retrun_details, function (i, item) {

					total_ret_sales_pcs += parseFloat(item.sales_ret_tot_pcs);

					total_ret_sales_grs_wt += parseFloat(item.sales_ret_tot_grswt);

					total_ret_sales_net_wt += parseFloat(item.sales_ret_tot_nwt);

					total_ret_sales_taxable_amt += parseFloat(item.sales_ret_taxable_amt);

					total_ret_sales_tax_amt += parseFloat(item.sales_ret_tax_amt);

					total_ret_sales_item_cost += parseFloat(item.sales_ret_tot_item_cost);

					trHTML += '<tr class="sales">' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td><strong>SALES RETURN GRAND TOTAL</strong></td>' +

						'<td></td>' +

						'<td><strong>' + money_format_india(parseFloat(item.sales_ret_tot_pcs)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(item.sales_ret_tot_grswt).toFixed(3)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(item.sales_ret_tot_nwt).toFixed(3)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(item.sales_ret_taxable_amt).toFixed(2)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(item.sales_ret_tax_amt).toFixed(2)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(item.sales_ret_tot_item_cost).toFixed(2)) + '</strong></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'</tr>';

				});

			}

			total_net_pcs = parseFloat(parseFloat(total_sales_pcs) - parseFloat(total_ret_sales_pcs));

			total_net_grs_wt = parseFloat(parseFloat(total_sales_grs_wt) - parseFloat(total_ret_sales_grs_wt));

			total_net_net_wt = parseFloat(parseFloat(total_sales_net_wt) - parseFloat(total_ret_sales_net_wt));

			total_net_taxable_amt = parseFloat(parseFloat(total_sales_taxable_amt) - parseFloat(total_ret_sales_taxable_amt));

			total_net_tax_amt = parseFloat(parseFloat(total_sales_tax_amt) - parseFloat(total_ret_sales_tax_amt));

			total_net_item_cost = parseFloat(parseFloat(total_sales_item_cost) - parseFloat(total_ret_sales_item_cost));

			trHTML += '<tr class="sales" style="color:red;">' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td><strong>NET TOTAL</strong></td>' +

				'<td></td>' +

				'<td><strong>' + money_format_india(parseFloat(total_net_pcs)) + '</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(total_net_grs_wt).toFixed(3)) + '</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(total_net_net_wt).toFixed(3)) + '</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(total_net_taxable_amt).toFixed(2)) + '</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(total_net_tax_amt).toFixed(2)) + '</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(total_net_item_cost).toFixed(2)) + '</strong></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'</tr>';

			$('#gstr1_sales_list > tbody').html(trHTML);

			if (!$.fn.DataTable.isDataTable('#gstr1_sales_list')) {

				oTable = $('#gstr1_sales_list').dataTable({

					columnDefs: [{

						"defaultContent": "-",

						"targets": "_all"

					}],

					"bSort": false,

					"bDestroy": true,

					"bInfo": true,

					"scrollX": '100%',

					"paging": false,

					"dom": 'Bfrtip',

					"bAutoWidth": false,

					"responsive": true,

					"columnDefs": [

						{

							targets: [9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 21],

							className: 'dt-body-right'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: false,

							title: '',

							messageTop: title,

							orientation: 'landscape',

							customize: function (win) {

								var last = null;

								var current = null;

								var bod = [];

								var css = '@page { size: landscape; }',

									head = win.document.head || win.document.getElementsByTagName('head')[0],

									style = win.document.createElement('style');

								style.type = 'text/css';

								style.media = 'print';

								if (style.styleSheet) {

									style.styleSheet.cssText = css;

								}

								else {

									style.appendChild(win.document.createTextNode(css));

								}

								head.appendChild(style);

							},

							exportOptions:

							{

								columns: ':visible',

								stripHtml: false

							}

						},

						'colvis',

						{

							extend: 'excel',

							footer: true,

							title: 'GSTR1 SALES REPORT',

						}

					],

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function fnGSTR1ExcelReport(export_type) {

	var sales_details_list = export_list.sales_details;

	var tot_sales_details = export_list.tot_sales_details;

	var tot_sales_return_details = export_list.tot_sales_ret_details

	if (sales_details_list.length > 0) {

		var htmls = "";

		htmls += '<table class="table table-bordered table-striped text-center"><thead><tr class="bg-teal">' +

			'<th colspan=50 style="background-color:#39cccc;text-align:center;">' + $('#company_name').val() + '<br>GSTR1 SALES REPORT &nbsp;FROM&nbsp;:&nbsp;' + $('#rpt_payments1').html() + ' &nbsp;&nbsp;TO&nbsp;&nbsp; ' + $('#rpt_payments2').html() + '</th></tr>'

			/*1st set*/

			+ '<tr><th width="10%;">Invoice Type</th>'

			+ '<th width="10%;">Is this an Original Invoice or Ammendment Invoice</th>'

			+ '<th width="10%;">Is this Advance received without you having given an Invoice  for this supply</th>'

			+ '<th width="10%;">Is this Advance amount received in earlier tax period and adjusted against the supplies being shown in this tax period</th>'

			+ '<th width="10%;">Is this a Zero Rated Supply or Deemed Export Including Exports out of India, Supplies to SEZ unit/ and SEZ developer, Deemed Exports</th>'

			+ '<th width="10%;">Is this supply related to E-Commerce Operator?</th>'

			+ '<th width="10%;">Is this a Credit Note / Debit Note /Refund Voucher?</th>'

			+ '<th width="10%;">Name of Receipient</th>'

			+ '<th width="10%;">Nature of Supply</th>'

			+ '<th width="10%;">Invoice number</th>'

			/*1st set*/

			/*2nd set*/

			+ '<th width="10%;">Invoice date</th>'

			+ '<th width="10%;">GSTIN / UIN of recipient</th>'

			+ '<th width="10%;">DOOR NO</th>'

			+ '<th width="1%">ADDRESS1</th>'

			+ '<th width="10%;">ADDRESS2e</th>'

			+ '<th width="10%;">ADDRESS3</th>'

			+ '<th width="10%;">Area</th>'

			+ '<th width="10%;">City</th>'

			+ '<th width="5%;">State of receipient of Invoice</th>'

			+ '<th width="10%;">State of supply of goods / services (may be different than state of receipient)</th>'

			/*2nd set*/

			/*3rd set*/

			+ '<th width="5%;">Is reverse charge mechanism applicable?</th>'

			+ '<th width="10%;">Is Provisional assessment Applicable</th>'

			+ '<th width="5%;">Invoice Value</th>'

			+ '<th width="5%;">Original Invoice Number</th>'

			+ '<th width="5%;">Original Invoice Date</th>'

			+ '<th width="5%;">Sr No for Item Details</th>'

			+ '<th width="5%;">Taxable valu</th>'

			+ '<th width="5%;">Rate</th>'

			+ '<th width="5%;">IGST Rate</th>'

			+ '<th width="5%;">IGST Tax Amount</th>'

			/*3rd set*/

			/*4th set*/

			+ '<th width="5%;">CGST Rate</th>'

			+ '<th width="5%;">CGST Tax Amount</th>'

			+ '<th width="5%;">SGST Rate</th>'

			+ '<th width="5%;">SGST Tax Amount</th>'

			+ '<th width="10%;">Cess Rate</th>'

			+ '<th width="5%;">Cess Amount</th>'

			+ '<th width="10%;">HSN or SAC of Goods or Services</th>'

			+ '<th width="10%;">Description of goods sold</th>'

			+ '<th width="10%;">UQC (Unit of Measure) of goods sold</th>'

			+ '<th width="10%;">Quantity of goods sold</th>'

			/*4th set*/

			/*5th set*/

			+ '<th width="5%;">GSTIN of E-commerce Operator (if applicable)</th>'

			+ '<th width="5%;">Date of Advance received</th>'

			+ '<th width="5%;">Amount of Advance receive</th>'

			+ '<th width="5%;">Amount of Advance to be adjusted</th>'

			+ '<th width="5%;">With/Without payment of GSTt</th>'

			+ '<th width="10%;">Shipping Bill No. or Bill of Export No</th>'

			+ '<th width="10%;">Shipping Bill Date. or Bill of Export Date</th>'

			+ '<th width="10%;">Credit or Debit or Refund Voucher?</th>'

			+ '<th width="10%;">Credit / Debit Note Number</th>'

			+ '<th width="10%;">Credit / Debit Note Date</th>'

			/*5th set*/

			+ '</tr></thead><tbody>';

		var textRange; var j = 0;

		$.each(sales_details_list, function (key, val) {

			var datas = "";

			htmls += '<div class="innerDetails" style="margin-bottom: 20px;border-bottom: 2px solid #39cccc;">' +

				'<table class="table table-responsive table-bordered text-center table-sm">' +

				'<tr class="prod_det_btn">' +

				/*1st set*/

				'<td>' + val.invoice_type + '</td>' +

				'<td>NO</td>' +

				'<td>NO</td>' +

				'<td>NO</td>' +

				'<td>NO</td>' +

				'<td>NO</td>' +

				'<td>NO</td>' +

				'<td>' + val.customer_name + '</td>' +

				'<td>GOODS</td>' +

				'<td>' + val.invoice_no + '</td>' +

				/*1st set*/

				/*2nd set*/

				'<td>' + val.invoice_date + '</td>' +

				'<td>' + val.gst_no + '</td>' +

				'<td>' + val.address1 + '</td>' +

				'<td>' + val.address2 + '</td>' +

				'<td>' + val.address3 + '</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td>' + val.city + '</td>' +

				'<td>' + val.state + '</td>' +

				'<td></td>' +

				/*2nd set*/

				/*3rd set*/

				'<td>NO</td>' +

				'<td>NO</td>' +

				'<td>' + money_format_india(parseFloat(val.invoice_value).toFixed(2)) + '</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td>' + val.sr_no + '</td>' +

				'<td>' + money_format_india(parseFloat(val.taxable_amt).toFixed(2)) + '</td>' +

				'<td>' + val.tax_percentage + '</td>' +

				'<td>' + (val.igst > 0 ? parseFloat(val.tax_percentage) : '') + '</td>' +

				'<td>' + money_format_india(parseFloat(val.igst).toFixed(2)) + '</td>' +

				/*3rd set*/

				/*4th set*/

				'<td>' + (val.cgst > 0 ? parseFloat(parseFloat(val.tax_percentage) / 2).toFixed(2) : '') + '</td>' +

				'<td>' + money_format_india(parseFloat(val.cgst).toFixed(2)) + '</td>' +

				'<td>' + (val.sgst > 0 ? parseFloat(parseFloat(val.tax_percentage) / 2).toFixed(2) : '') + '</td>' +

				'<td>' + money_format_india(parseFloat(val.sgst).toFixed(2)) + '</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td>' + val.hsn_code + '</td>' +

				'<td>' + val.product_name + '</td>' +

				'<td>GRAMS</td>' +

				'<td>' + parseFloat(val.grs_wt).toFixed(3) + '</td>' +

				/*4th set*/

				/*5th set*/

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				/*5th set*/

				'</tr>';

		});

		htmls += '<tr>'

			+ '<td colspan="50"></td>'

			+ '</tr>';

		htmls += '<tr>'

			+ '<td colspan="50" style="font-weight:bold">TOTAL SUMMARY</td>'

			+ '</tr>';

		var total_net_pcs = 0;

		var total_net_grs_wt = 0;

		var total_net_net_wt = 0;

		var total_net_taxable_amt = 0;

		var total_net_tax_amt = 0;

		var total_net_item_cost = 0;

		if (tot_sales_details.length > 0) {

			var total_sales_pcs = 0;

			var total_sales_grs_wt = 0;

			var total_sales_net_wt = 0;

			var total_sales_taxable_amt = 0;

			var total_sales_tax_amt = 0;

			var total_sales_item_cost = 0;

			$.each(tot_sales_details, function (key, val) {

				total_sales_pcs += parseFloat(val.sales_tot_pcs);

				total_sales_grs_wt += parseFloat(val.sales_tot_grswt);

				total_sales_net_wt += parseFloat(val.sales_tot_nwt);

				total_sales_taxable_amt += parseFloat(val.sales_taxable_amt);

				total_sales_tax_amt += parseFloat(val.sales_tax_amt);

				total_sales_item_cost += parseFloat(val.sales_tot_item_cost);

				htmls += '<div class="innerDetails" style="margin-bottom: 20px;border-bottom: 2px solid #39cccc;">' +

					'<table class="table table-responsive table-bordered text-center table-sm">' +

					'<tr class="prod_det_btn">' +

					'<td style="font-weight:bold">SALES GRAND TOTAL</td>' +

					'<td></td>' +

					'<td></td>' +

					'<td>' + money_format_india(parseInt(val.sales_tot_pcs)) + '</td>' +

					'<td>' + money_format_india(parseFloat(val.sales_tot_grswt).toFixed(3)) + '</td>' +

					'<td>' + money_format_india(parseFloat(val.sales_tot_nwt).toFixed(3)) + '</td>' +

					'<td>' + money_format_india(parseFloat(val.sales_taxable_amt).toFixed(2)) + '</td>' +

					'<td>' + money_format_india(parseFloat(val.sales_tax_amt).toFixed(2)) + '</td>' +

					'<td>' + money_format_india(parseFloat(val.sales_tot_item_cost).toFixed(2)) + '</td>' +

					'</tr>';

			});

		}

		if (tot_sales_return_details.length > 0) {

			var total_ret_sales_pcs = 0;

			var total_ret_sales_grs_wt = 0;

			var total_ret_sales_net_wt = 0;

			var total_ret_sales_taxable_amt = 0;

			var total_ret_sales_tax_amt = 0;

			var total_ret_sales_item_cost = 0;

			$.each(tot_sales_return_details, function (key, val) {

				total_ret_sales_pcs += parseFloat(val.sales_ret_tot_pcs);

				total_ret_sales_grs_wt += parseFloat(val.sales_ret_tot_grswt);

				total_ret_sales_net_wt += parseFloat(val.sales_ret_tot_nwt);

				total_ret_sales_taxable_amt += parseFloat(val.sales_ret_taxable_amt);

				total_ret_sales_tax_amt += parseFloat(val.sales_ret_tax_amt);

				total_ret_sales_item_cost += parseFloat(val.sales_ret_tot_item_cost);

				htmls += '<div class="innerDetails" style="margin-bottom: 20px;border-bottom: 2px solid #39cccc;">' +

					'<table class="table table-responsive table-bordered text-center table-sm">' +

					'<tr class="prod_det_btn">' +

					'<td style="font-weight:bold">SALES RETURN GRAND TOTAL</td>' +

					'<td></td>' +

					'<td></td>' +

					'<td>' + money_format_india(parseInt(val.sales_ret_tot_pcs)) + '</td>' +

					'<td>' + money_format_india(parseFloat(val.sales_ret_tot_grswt).toFixed(3)) + '</td>' +

					'<td>' + money_format_india(parseFloat(val.sales_ret_tot_nwt).toFixed(3)) + '</td>' +

					'<td>' + money_format_india(parseFloat(val.sales_ret_taxable_amt).toFixed(2)) + '</td>' +

					'<td>' + money_format_india(parseFloat(val.sales_ret_tax_amt).toFixed(2)) + '</td>' +

					'<td>' + money_format_india(parseFloat(val.sales_ret_tot_item_cost).toFixed(2)) + '</td>' +

					'</tr>';

			});

		}

		total_net_pcs = parseInt(parseInt(total_sales_pcs) - parseInt(total_ret_sales_pcs));

		total_net_grs_wt = parseFloat(parseFloat(total_sales_grs_wt) - parseFloat(total_ret_sales_grs_wt));

		total_net_net_wt = parseFloat(parseFloat(total_sales_net_wt) - parseFloat(total_ret_sales_net_wt));

		total_net_taxable_amt = parseFloat(parseFloat(total_sales_taxable_amt) - parseFloat(total_ret_sales_taxable_amt));

		total_net_tax_amt = parseFloat(parseFloat(total_sales_tax_amt) - parseFloat(total_ret_sales_tax_amt));

		total_net_item_cost = parseFloat(parseFloat(total_sales_item_cost) - parseFloat(total_ret_sales_item_cost));

		htmls += '<div class="innerDetails" style="margin-bottom: 20px;border-bottom: 2px solid #39cccc;">' +

			'<table class="table table-responsive table-bordered text-center table-sm">' +

			'<tr class="prod_det_btn" style="font-weight:bold">' +

			'<td>NET TOTAL</td>' +

			'<td></td>' +

			'<td></td>' +

			'<td>' + money_format_india(parseInt(total_net_pcs)) + '</td>' +

			'<td>' + money_format_india(parseFloat(total_net_grs_wt).toFixed(3)) + '</td>' +

			'<td>' + money_format_india(parseFloat(total_net_net_wt).toFixed(3)) + '</td>' +

			'<td>' + money_format_india(parseFloat(total_net_taxable_amt).toFixed(2)) + '</td>' +

			'<td>' + money_format_india(parseFloat(total_net_tax_amt).toFixed(2)) + '</td>' +

			'<td>' + money_format_india(parseFloat(total_net_item_cost).toFixed(2)) + '</td>' +

			'</tr>';

		htmls += '</tbody><tfoot></tfoot></table></div>';

		if (export_type == '1') {

			var uri = 'data:application/vnd.ms-excel;base64,';

			var template = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>';

			var base64 = function (s) {

				return window.btoa(unescape(encodeURIComponent(s)))

			};

			var format = function (s, c) {

				return s.replace(/{(\w+)}/g, function (m, p) {

					return c[p];

				})

			};

			var ctx = {

				worksheet: 'Worksheet',

				table: htmls

			}

			var link = document.createElement("a");

			link.download = "GSTR1_SALES_REPORT.xls";

			link.href = uri + base64(format(template, ctx));

			link.click();

		}

	}

}

/*GSTR1 SALES REPORT*/

/*GSTR2 PURCHASE REPORT*/

$('#gstr2_purchase_search').on('click', function () {

	get_gstr2_purchase_details();

})

function get_gstr2_purchase_details() {

	var company_name = $('#company_name').val();

	var from_date = $('#rpt_payments1').html();

	var to_date = $('#rpt_payments2').html();

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "GSTR2 URD PURCHASE REPORT";

	var optional = '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/gstr2_purchase/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: { 'from_date': $('#rpt_payments1').html(), 'to_date': $('#rpt_payments2').html(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'id_metal': $('#metal').val() },

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var trHTML = '';

			$("#purchase_list > tbody > tr").remove();

			$('#purchase_list').dataTable().fnClearTable();

			$('#purchase_list').dataTable().fnDestroy();

			var tot_pur_pcs = 0;

			var tot_pur_grswt = 0;

			var tot_pur_netwt = 0;

			var tot_pur_amount = 0;

			var purchase_list = data.list;

			$.each(purchase_list, function (key, old) {

				var pur_pcs = 0;

				var pur_grswt = 0;

				var pur_netwt = 0;

				var pur_amount = 0;

				trHTML += '<tr>'

					+ '<td><strong>OLD ' + key + '</strong></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

				'</tr>'

				$.each(old, function (key, val) {

					pur_pcs += parseInt(val.pcs);

					pur_grswt += parseFloat(val.gross_wt);

					pur_netwt += parseFloat(val.net_wt);

					pur_amount += parseFloat(val.total_amt);

					tot_pur_pcs += parseInt(val.pcs);

					tot_pur_grswt += parseFloat(val.gross_wt);

					tot_pur_netwt += parseFloat(val.net_wt);

					tot_pur_amount += parseFloat(val.total_amt);

					print_url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + val.bill_id;

					action_content = '<a href="' + print_url + '" target="_blank" title="Billing Receipt">' + val.bill_no + '</a>'

					trHTML += '<tr>'

						+ '<td>' + val.bill_date + '</td>'

						+ '<td>' + action_content + '</td>'

						+ '<td>' + val.pcs + '</td>'

						+ '<td>' + parseFloat(val.gross_wt) + '</td>'

						+ '<td>' + parseFloat(val.net_wt) + '</td>'

						+ '<td>' + money_format_india(val.rate_per_grm) + '</td>'

						+ '<td>' + money_format_india(val.total_amt) + '</td>'

						+ '<td>' + val.customer_name + '</td>'

						+ '<td>' + val.gst_no + '</td>'

						+ '<td>' + val.address1 + '</td>'

						+ '<td>' + val.mobile + '</td>'

					'</tr>'

				});

				trHTML += '<tr style="color:blue;">'

					+ '<td><strong>SUB TOTAL</strong></td>'

					+ '<td></td>'

					+ '<td><strong>' + pur_pcs + '<strong></td>'

					+ '<td><strong>' + parseFloat(pur_grswt).toFixed(3) + '<strong></td>'

					+ '<td><strong>' + parseFloat(pur_netwt).toFixed(3) + '<strong></td>'

					+ '<td></td>'

					+ '<td><strong>' + money_format_india(parseFloat(pur_amount).toFixed(2)) + '<strong></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

				'</tr>'

				pur_pcs = 0;

				pur_grswt = 0;

				pur_netwt = 0;

				pur_amount = 0;

			});

			trHTML += '<tr>'

				+ '<td><strong>GRAND TOTAL</strong></td>'

				+ '<td></td>'

				+ '<td><strong>' + tot_pur_pcs + '</strong></td>'

				+ '<td><strong>' + parseFloat(tot_pur_grswt).toFixed(3) + '</strong></td>'

				+ '<td><strong>' + parseFloat(tot_pur_netwt).toFixed(3) + '</strong></td>'

				+ '<td></td>'

				+ '<td><strong>' + money_format_india(parseFloat(tot_pur_amount).toFixed(2)) + '</strong></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

				+ '<td></td>'

			'</tr>'

			$('#purchase_list > tbody').html(trHTML);

			if (!$.fn.DataTable.isDataTable('#purchase_list')) {

				oTable = $('#purchase_list').dataTable({

					columnDefs: [{

						"defaultContent": "-",

						"targets": "_all"

					}],

					"bSort": false,

					"bDestroy": true,

					"bInfo": true,

					"scrollX": '100%',

					"paging": false,

					"dom": 'Bfrtip',

					"bAutoWidth": false,

					"responsive": true,

					"columnDefs": [

						{

							targets: [2, 3, 4, 5, 6],

							className: 'dt-body-right'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: false,

							title: '',

							messageTop: title,

							orientation: 'landscape',

							customize: function (win) {

								var last = null;

								var current = null;

								var bod = [];

								var css = '@page { size: landscape; }',

									head = win.document.head || win.document.getElementsByTagName('head')[0],

									style = win.document.createElement('style');

								style.type = 'text/css';

								style.media = 'print';

								if (style.styleSheet) {

									style.styleSheet.cssText = css;

								}

								else {

									style.appendChild(win.document.createTextNode(css));

								}

								head.appendChild(style);

							},

							exportOptions:

							{

								columns: ':visible',

								stripHtml: false

							}

						},

						{

							extend: 'excel',

							footer: true,

							title: 'GSTR URD PURCHASE REPORT FROM : ' + $('#rpt_payments1').html() + ' TO : ' + $('#rpt_payments2').html() + '',

						}

					],

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

/*GSTR2 PURCHASE REPORT*/

/*Old Metal Profit & Loss Report*/

$('#old_metal_pl_search').on('click', function () {

	console.log($('#filter_metal').val());

	console.log(($('#filter_metal').val() != '' && $('#filter_metal').val() != null));

	if ($('#filter_metal').val() != '' && $('#filter_metal').val() != null) {

		get_old_metal_pl_details();

	}

	else {

		$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + 'Please Select Metal ..' });

	}

});

function get_old_metal_pl_details() {

	var dt_range = ($("#dt_range").val()).split('-');

	var company_name = $('#company_name').val();

	var from_date = dt_range[0];

	var to_date = dt_range[1];

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "OLD METAL PROFIT & LOSS"

	var metal = $('#filter_metal option:selected').html() != '' && $('#filter_metal option:selected ').html() != undefined ? $('#filter_metal option:selected').html() + " - " : '';

	var old_metal_type = $('#old_metal_type option:selected').html() != '' && $('#old_metal_type option:selected ').html() != undefined ? $('#old_metal_type option:selected').html() + " - " : '';

	var optional = metal + old_metal_type;

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/old_metal_pl_report/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'metal': $("#filter_metal").val(), 'dt_range': $("#dt_range").val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'old_metal_type': $('#id_old_metal_type').val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			var metal_rate = data.metal_rate;

			$("#old_metal_pl_report_det > tbody > tr").remove();

			$('#old_metal_pl_report_det').dataTable().fnClearTable();

			$('#old_metal_pl_report_det').dataTable().fnDestroy();

			if (list != null) {

				trHTML = '';

				tfootHTML = '';

				var pure_rate = 0;

				var expected_pure_amt = 0;

				var tot_grs_wt = 0;

				var tot_net_wt = 0;

				var tot_purc_inv_amt = 0;

				var tot_exp_pure_grswt = 0;

				var tot_exp_pure_nwt = 0;

				var tot_exp_pure_amt = 0;

				var tot_purch_pure_amt = 0;

				var profit_amt = 0;

				var exp_pure_prof_grms = 0;

				var prof_per = 0;

				$.each(list, function (i, val) {

					if (val.metal_type == 1) {

						pure_rate = parseFloat(parseFloat(metal_rate.goldrate_22ct) / 93.25 * 100);

					}

					else {

						pure_rate = parseFloat(parseFloat(metal_rate.silverrate_1gm) / 106 * 100);

					}

					expected_pure_amt = parseFloat(parseFloat(val.exp_pur_nwt) * parseFloat(pure_rate)).toFixed(2);

					tot_grs_wt += parseFloat(val.gross_wt);

					tot_net_wt += parseFloat(val.net_wt);

					tot_purc_inv_amt += parseFloat(val.purch_amt);

					tot_exp_pure_grswt += parseFloat(val.exp_pur_grswt);

					tot_exp_pure_nwt += parseFloat(val.exp_pur_nwt);

					tot_exp_pure_amt += parseFloat(expected_pure_amt);

					trHTML += '<tr>'

						+ '<td>' + val.bill_date + '</td>'

						+ '<td>' + (val.metal_type == 1 ? metal_rate.goldrate_22ct : metal_rate.silverrate_1gm) + '</td>'

						+ '<td>' + parseFloat(pure_rate).toFixed(2) + '</td>'

						+ '<td>' + val.old_item + '</td>'

						+ '<td>' + val.gross_wt + '</td>'

						+ '<td>' + val.touch + '</td>'

						+ '<td>' + val.net_wt + '</td>'

						+ '<td>' + val.dust_gms + '</td>'

						+ '<td>' + val.less + '</td>'

						+ '<td>' + money_format_india(val.purch_amt) + '</td>'

						+ '<td>' + money_format_india(val.pur_rate_per_grm) + '</td>'

						+ '<td>' + val.exp_pur_grswt + '</td>'

						+ '<td>' + val.exp_pur_nwt + '</td>'

						+ '<td>' + money_format_india(expected_pure_amt) + '</td>'

					'</tr>';

				});

				trHTML += '<tr style="color:red;">'

					+ '<td><strong>TOTAL</strong></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td><strong>' + parseFloat(tot_grs_wt).toFixed(3) + '</strong></td>'

					+ '<td></td>'

					+ '<td><strong>' + parseFloat(tot_net_wt).toFixed(3) + '</strong></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td><strong>' + money_format_india(tot_purc_inv_amt) + '</strong></td>'

					+ '<td></td>'

					+ '<td><strong>' + parseFloat(tot_exp_pure_grswt).toFixed(3) + '</strong></td>'

					+ '<td><strong>' + parseFloat(tot_exp_pure_nwt).toFixed(3) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(tot_exp_pure_amt).toFixed(2)) + '</strong></td>'

				'</tr>';

				tot_purch_pure_amt = parseFloat(parseFloat(tot_exp_pure_nwt) * parseFloat(tot_purc_inv_amt) / parseFloat(tot_net_wt)).toFixed(2);

				profit_amt = parseFloat(parseFloat(tot_exp_pure_amt) - parseFloat(tot_purch_pure_amt)).toFixed(2);

				exp_pure_prof_grms = parseFloat(parseFloat(profit_amt) / parseFloat(pure_rate)).toFixed(3);

				prof_per = parseFloat(parseFloat(exp_pure_prof_grms) / parseFloat(tot_exp_pure_nwt) * 100).toFixed(2);

				trHTML += '<tr style="font-weight:bold;">'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td style="text-align:center;"><strong>Total Purchased Pure Amount(average)</strong></td>'

					+ '<td></td>'

					+ '<td><strong>' + money_format_india(isNaN(tot_purch_pure_amt) ? 0 : tot_purch_pure_amt) + '</strong></td>'

					+ '<td></td>'

					+ '<td></td>'

				'</tr>';

				trHTML += '<tr style="font-weight:bold;">'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td style="text-align:center;"><strong>Profit Amount</strong></td>'

					+ '<td></td>'

					+ '<td>' + money_format_india(isNaN(profit_amt) ? 0 : profit_amt) + '</td>'

					+ '<td></td>'

					+ '<td></td>'

				'</tr>';

				trHTML += '<tr style="font-weight:bold;">'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td style="text-align:center;"><strong>Expected Pure Profit in GMS</strong></td>'

					+ '<td></td>'

					+ '<td>' + (isNaN(exp_pure_prof_grms) ? 0 : exp_pure_prof_grms) + '</td>'

					+ '<td></td>'

					+ '<td></td>'

				'</tr>';

				trHTML += '<tr style="font-weight:bold;">'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td style="text-align:center;"><b>Profit Percentage</b></td>'

					+ '<td></td>'

					+ '<td>' + (isNaN(prof_per) ? 0 : prof_per) + '</td>'

					+ '<td></td>'

					+ '<td></td>'

				'</tr>';

				$('#old_metal_pl_report_det > tbody').html(trHTML);

				if (!$.fn.DataTable.isDataTable('#old_metal_pl_report_det')) {

					oTable = $('#old_metal_pl_report_det').dataTable({

						"bSort": false,

						"bInfo": true,

						"scrollX": '100%',

						"dom": 'lBfrtip',

						"paging": false,

						"fixedHeader": true,

						"columnDefs":

							[

								{

									targets: [9, 10, 11, 12, 13],

									className: 'dt-body-right'

								},

							],

						"buttons":

							[

								{

									extend: 'print',

									footer: true,

									title: '',

									messageTop: title,

									customize: function (win) {

										$(win.document.body).find('table')

											.addClass('compact');

										$(win.document.body).find('table')

											.addClass('compact')

											.css('font-size', '10px')

											.css('font-family', 'sans-serif');

									},

									exportOptions: {

										columns: ':visible',

										stripHtml: false

									}

								},

								{

									extend: 'colvis',

									collectionLayout: 'fixed columns',

									collectionTitle: 'Column visibility control'

								},

								{

									extend: 'excel',

									footer: true,

									title: 'OLD METAL PROFIT & LOSS',

								}

							],

					});

				}

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

/*Old Metal Profit & Loss Report*/

/*select transfer report*/

$('#section_trans_report_search').click(function (event) {

	get_section_transfer_list();

});

function getActiveSections() {

	my_Date = new Date();

	$.ajax({

		type: 'GET',

		url: base_url + "index.php/admin_ret_catalog/get_section?nocache=" + my_Date.getUTCSeconds(),

		dataType: 'json',

		success: function (data) {

			$("#select_to_section option").remove();

			$("#select_frm_section option").remove();

			$.each(data, function (key, item) {

				$("#select_frm_section,#select_to_section").append(

					$("<option></option>")

						.attr("value", item.id_section)

						.text(item.section_name)

				);

			});

			$('#select_frm_section').select2({

				placeholder: 'From Section',

				allowClear: true

			});

			$('#select_to_section').select2({

				placeholder: 'To Section',

				allowClear: true

			})

			$("#select_frm_section").select2("val", '');

			$("#select_to_section").select2("val", '');

			$(".overlay").css("display", "none");

		}

	})

}

function get_section_transfer_list() {

	var company_name = $('#company_name').val();

	var dt_range = ($("#dt_range").val()).split('-');

	var from_date = date_format(dt_range[0].trim());

	var to_date = date_format(dt_range[1].trim());

	var counter = $("#counter_sel option:selected").text() && $("#counter_sel option:selected").text() != undefined ? $("#counter_sel option:selected").text() + " - " : '';

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var floor_sel = $("#floor_sel option:selected").text() && $("#floor_sel option:selected").text() != undefined ? $("#floor_sel option:selected").text() + " - " : '';

	var report_name = "CASH ABSTRACT";

	var optional = counter + floor_sel;

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		type: 'POST',

		url: base_url + 'index.php/admin_ret_reports/section_transfer/ajax',

		data: { 'from_date': from_date, 'to_date': to_date, 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'id_product': $('#prod_select').val(), 'from_section': $('#select_frm_section').val(), 'to_section': $('#select_to_section').val(), 'sec_rpt_filter_by': $('#sec_rpt_filter_by').val() },

		dataType: 'JSON',

		success: function (data) {

			console.log(data)

			$("div.overlay").css("display", "none");

			var list = data.list;

			var non_tag_list = data.non_tag_list;

			var a = 1;

			$("#section_transfer_list > tbody > tr").remove();

			$('#section_transfer_list').dataTable().fnClearTable();

			$('#section_transfer_list').dataTable().fnDestroy();

			var trHtml = '';

			var a = 1;

			if ((list != null && list.length > 0) || (non_tag_list != null && non_tag_list.length > 0)) {

				if (list != null && list.length > 0) {

					trHtml += '<tr style="font-weight:bold;">' +

						'<td><strong>Tag</strong></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'</tr>';

					var tot_piece = 0;

					var tot_gross_wt = 0;

					var tot_net_wt = 0;

					var tot_less_wt = 0;

					var tot_dia_pcs = 0;

					var tot_dia_wt = 0;

					var tot_sales_value = 0;

					$.each(list, function (key, items) {

						trHtml += '<tr>'

							+ '<td>' + a + '</td>'

							+ '<td>' + items.product_name + '</td>'

							+ '<td>' + items.tag_code + '</td>'

							+ '<td>' + items.piece + '</td>'

							+ '<td>' + items.gross_wt + '</td>'

							+ '<td>' + items.net_wt + '</td>'

							+ '<td>' + items.dia_pcs + '</td>'

							+ '<td>' + items.dia_wt + '</td>'

							+ '<td>' + items.sales_value + '</td>'

							+ '<td>' + items.created_on + '</td>'

							+ '<td>' + items.from_section + '</td>'

							+ '<td>' + items.to_section + '</td>'

							+ '<td>' + items.created_by + '</td>'

							+ '<td>' + items.trans_time + '</td>'

							+ '</tr>';

						a++;

						tot_piece += parseFloat(items.piece);

						tot_gross_wt += parseFloat(items.gross_wt);

						tot_net_wt += parseFloat(items.net_wt);

						tot_less_wt += parseFloat(items.less_wt);

						tot_dia_pcs += parseFloat(items.dia_pcs);

						tot_dia_wt += parseFloat(items.dia_wt);

						tot_sales_value += parseFloat(items.sales_value);

					});

					trHtml += '<tr style="font-weight:bold;">' +

						'<td></td>' +

						'<td><strong>Tag Total</strong></td>' +

						'<td></td>' +

						'<td>' + (money_format_india(tot_piece)) + '</td>' +

						'<td>' + (money_format_india(parseFloat(tot_gross_wt).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(tot_net_wt).toFixed(3))) + '</td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'</tr>';

				}

				if (non_tag_list != null && non_tag_list.length > 0) {

					var nt_tot_piece = 0;

					var nt_tot_gross_wt = 0;

					var nt_tot_net_wt = 0;

					var nt_tot_less_wt = 0;

					var nt_tot_dia_pcs = 0;

					var nt_tot_dia_wt = 0;

					var nt_tot_sales_value = 0;

					trHtml += '<tr style="font-weight:bold;">' +

						'<td><strong>Non-Tag</strong></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'</tr>';

					$.each(non_tag_list, function (key, items) {

						trHtml += '<tr>'

							+ '<td>' + a + '</td>'

							+ '<td>' + items.product_name + '</td>'

							+ '<td>' + items.tag_code + '</td>'

							+ '<td>' + items.piece + '</td>'

							+ '<td>' + parseFloat(items.gross_wt).toFixed(3) + '</td>'

							+ '<td>' + parseFloat(items.net_wt).toFixed(3) + '</td>'

							+ '<td>-</td>'

							+ '<td>-</td>'

							+ '<td>-</td>'

							+ '<td>' + items.created_on + '</td>'

							+ '<td>' + items.from_section + '</td>'

							+ '<td>' + items.to_section + '</td>'

							+ '<td>' + items.created_by + '</td>'

							+ '<td>' + items.trans_time + '</td>'

							+ '</tr>';

						a++;

						nt_tot_piece += parseFloat(items.piece);

						nt_tot_gross_wt += parseFloat(items.gross_wt);

						nt_tot_less_wt += parseFloat(items.less_wt);

						nt_tot_net_wt += parseFloat(items.net_wt);

						nt_tot_dia_pcs += parseFloat(items.dia_pcs);

						nt_tot_dia_wt += parseFloat(items.dia_wt);

						nt_tot_sales_value += parseFloat(items.sales_value);

					});

					trHtml += '<tr style="font-weight:bold;">' +

						'<td></td>' +

						'<td><strong>Non-Tag Total</strong></td>' +

						'<td></td>' +

						'<td>' + (money_format_india(nt_tot_piece)) + '</td>' +

						'<td>' + (money_format_india(parseFloat(nt_tot_gross_wt).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(nt_tot_net_wt).toFixed(3))) + '</td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'</tr>';

				}

				// $('#section_transfer_list').append(trHtml);

				$('#section_transfer_list > tbody').html(trHtml);

				oTable = $('#section_transfer_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": false,

					"dom": 'lBfrtip',

					"paging": false,

					"columnDefs": [

						{

							targets: [4, 5, 6, 7, 8, 9, 12, 13],

							className: 'dt-body-right'

						},

						{

							targets: [2, 3, 10, 11],

							className: 'dt-body-left'

						}

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: "Section Transfer Report",

						}

					],

				});

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

/*select transfer report*/

function get_po_ref_nos() {

	$(".overlay").css('display', 'block');

	$.ajax({

		type: 'GET',

		url: base_url + 'index.php/admin_ret_reports/get_po_ref_nos',

		dataType: 'json',

		success: function (data) {

			var po_id = $('#select_po_ref_no').val();

			$.each(data, function (key, item) {

				$('#select_po_ref_no').append(

					$("<option></option>")

						.attr("value", item.po_id)

						.text(item.po_ref_no)

				);

			});

			$("#select_po_ref_no").select2({

				placeholder: "Select PO Ref No",

				allowClear: true

			});

			$("#select_po_ref_no").select2("val", (po_id != '' && po_id > 0 ? po_id : ''));

			$(".overlay").css("display", "none");

		}

	});

}

//Stock Issue Receipt Report

$('#report_type').on('change', function (e) {

	if (ctrl_page[1] == 'stock_issue_report') {

		if (this.value == 2) {

			$('.GroupBy').css("display", "block");

			$('.Cat_StockIssue').css("display", "block");

			$('.StockIssue').css("display", "none");

			$('.det').css("display", "none");

		}

		else {

			$('.det').css("display", "block");

			$('.GroupBy').css("display", "none");

			$('.Cat_StockIssue').css("display", "none");

			$('.StockIssue').css("display", "block");

		}

		get_stock_issue_report();

	}

});

$('#GroupBy').on('change', function (e) {

	if (this.value == 1) {

		$('.Cat_StockIssue').css("display", "block");

		$('.StockIssue').css("display", "none");

	}

	else {

		$('.Cat_StockIssue').css("display", "none");

		$('.StockIssue').css("display", "block");

	}

	get_stock_issue_report();

});

$('#search_by').on('change', function (e) {

	if (this.value != '') {

		get_stock_issue_report();

	}

});

$('#stock_issue_search').click(function (event) {

	get_stock_issue_report();

});

function get_stock_issue_report() {

	$("div.overlay").css("display", "block");

	var report_type = $('#report_type').val();

	var GroupBy = $('#GroupBy').val();

	var dt_range = ($("#dt_range").val()).split('-');

	var company_name = $('#company_name').val();

	var company_code = $('#company_code').val();

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $('#branch_select option:selected').toArray().map(item => item.text).join());

	var company_code = $('#company_code').val();

	var company_address1 = $('#company_address1').val();

	var company_address2 = $('#company_address2').val();

	var company_city = $('#company_city').val();

	var pincode = $('#pincode').val();

	var company_email = $('#company_email').val();

	var company_gst_number = $('#company_gst_number').val();

	var phone = $('#phone').val();

	var title = "<div style='text-align: center;'><b><span style='font-size:12pt;'>" + company_code + "</span></b></br>"

		+ "<span style='font-size:11pt;'>" + company_address1 + "</span></br>"

		+ "<span style='font-size:11pt;'>" + company_address2 + company_city + "-" + pincode + "</span></br>"

		+ "<span style='font-size:11pt;'>GSTIN:" + company_gst_number + ", EMAIL:" + company_email + "</span></br>"

		+ "<span style='font-size:11pt;'>Contact :" + phone + "</span></br>"

		+ "<span style=font-size:12pt;>Stock Issue Report - " + branch_name + " &nbsp;&nbsp; From: " + dt_range[0] + " To:" + dt_range[1] + " - " + $('.hidden-xs').html() + "</span>";

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/stock_issue_report/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'dt_range': $("#dt_range").val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'issue_type': $('#issue_type').val(), 'id_karigar': $("#karigar").val(), 'search_by': $('#search_by').val(), 'report_type': $('#report_type').val(), 'GroupBy': $('#GroupBy').val(), 'status_type': $('#status_type').val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			print_stock_issue = list;

			console.log(data);

			if (report_type == 1 || (report_type == 2 && GroupBy == 2)) {

				var oTable = $('#stock_issue_list').DataTable();

				oTable.clear().draw();

				if (list != null && list.length > 0) {

					oTable = $('#stock_issue_list').dataTable({

						"bDestroy": true,

						"bInfo": true,

						"bFilter": true,

						"order": [[0, "asc"]],

						"lengthMenu": [[-1, 25, 50, 100, 250], ["All", 25, 50, 100, 250]],

						"scrollX": '100%',

						"bSort": true,

						"dom": 'lBfrtip',

						"columnDefs": [

							{

								targets: [5, 6],

								className: 'dt-body-right'

							},

						],

						"buttons": [

							{

								extend: 'print',

								footer: true,

								stripHtml: false,

								title: "",

								messageTop: title,

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', 'inherit');

								},

							},

							{

								extend: 'colvis',

								collectionLayout: 'fixed columns',

								collectionTitle: 'Column visibility control'

							},

							{

								extend: 'excel',

								footer: true,

								title: 'Stock Issue Report' + branch_name + '-' + dt_range[0] + '-' + dt_range[1],

							}

						],

						"aaData": list,

						"aoColumns": [

							{ "mDataProp": "id_stock_issue" },

							{ "mDataProp": "issue_type" },

							{ "mDataProp": "issue_date" },

							{ "mDataProp": "received_date" },

							{ "mDataProp": "tag_code" },

							{

								"mDataProp": function (row, type, val, meta) {

									return money_format_india(row.tag_pcs);

								}

							},

							{

								"mDataProp": function (row, type, val, meta) {

									return money_format_india(row.tag_weight);

								}

							},

							{ "mDataProp": "name" },

							{ "mDataProp": "branch" },

							{ "mDataProp": "issue_status" }

						],

						"footerCallback": function (row, data, start, end, display) {

							var api = this.api(), data;

							// Remove the formatting to get integer data for summation

							var intVal = function (i) {

								return typeof i === 'string' ?

									i.replace(/[\$,]/g, '') * 1 :

									typeof i === 'number' ?

										i : 0;

							};

							// purchase_cost = api

							// .column(5)

							// .data()

							// .reduce( function (a, b) {

							// return intVal(a) + intVal(b);

							// }, 0 );

							total_pcs = api

								.column(5)

								.data()

								.reduce(function (a, b) {

									return intVal(a) + intVal(b);

								}, 0);

							total_weight = api

								.column(6)

								.data()

								.reduce(function (a, b) {

									return intVal(a) + intVal(b);

								}, 0);

							// Total over all pages

							// Update footer

							// $( api.column(5).footer() ).html(money_format_india(parseFloat(purchase_cost).toFixed(2)));

							$(api.column(5).footer()).html(money_format_india(parseFloat(total_pcs).toFixed(0)));

							$(api.column(6).footer()).html(money_format_india(parseFloat(total_weight).toFixed(3)));

						}

					});

				}

			}

			else {

				var oTable = $('#cat_stock_issue_list').DataTable();

				oTable.clear().draw();

				if (list != null && list.length > 0) {

					oTable = $('#cat_stock_issue_list').dataTable({

						"bDestroy": true,

						"bInfo": true,

						"bFilter": true,

						"order": [[0, "asc"]],

						"lengthMenu": [[-1, 25, 50, 100, 250], ["All", 25, 50, 100, 250]],

						"scrollX": '100%',

						"bSort": true,

						"dom": 'lBfrtip',

						"columnDefs": [

							{

								targets: [3, 4],

								className: 'dt-body-right'

							},

						],

						"buttons": [

							{

								extend: 'print',

								footer: true,

								stripHtml: false,

								title: "",

								messageTop: title,

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', 'inherit');

								},

							},

							{

								extend: 'colvis',

								collectionLayout: 'fixed columns',

								collectionTitle: 'Column visibility control'

							},

							{

								extend: 'excel',

								footer: true,

								title: 'Stock Issue Report' + branch_name + '-' + dt_range[0] + '-' + dt_range[1],

							}

						],

						"aaData": list,

						"aoColumns": [

							{ "mDataProp": "category" },

							{ "mDataProp": "issue_type" },

							{

								"mDataProp": function (row, type, val, meta) {

									if ($('#search_by').val() == 1) {

										return row.issue_date;

									}

									else if ($('#search_by').val() == 2) {

										return row.received_date;

									}

								},

							},

							{

								"mDataProp": function (row, type, val, meta) {

									return money_format_india(row.tag_pcs);

								}

							},

							{

								"mDataProp": function (row, type, val, meta) {

									return money_format_india(row.tag_weight);

								}

							},

							{ "mDataProp": "branch" },

							{ "mDataProp": "issue_status" }

						],

						"footerCallback": function (row, data, start, end, display) {

							var api = this.api(), data;

							// Remove the formatting to get integer data for summation

							var intVal = function (i) {

								return typeof i === 'string' ?

									i.replace(/[\$,]/g, '') * 1 :

									typeof i === 'number' ?

										i : 0;

							};

							opstock = api

								.column(3)

								.data()

								.reduce(function (a, b) {

									return intVal(a) + intVal(b);

								}, 0);

							opgwt = api

								.column(4)

								.data()

								.reduce(function (a, b) {

									return intVal(a) + intVal(b);

								}, 0);

							// Total over all pages

							// Update footer

							$(api.column(3).footer()).html(money_format_india(parseFloat(opstock).toFixed(0)));

							$(api.column(4).footer()).html(money_format_india((parseFloat(opgwt).toFixed(3))));

						}

					});

				}

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function fnFormatRowbalancetagDetails(oTable, nTr) {

	var oData = oTable.fnGetData(nTr);

	var rowDetail = '';

	var get_balanced_tags =

		'<div class="innerDetails" style="margin-bottom: 20px;border-bottom: 2px solid #39cccc;">' +

		'<table class="table table-responsive table-bordered text-center table-sm">' +

		'<tr class="bg-teal" >' +

		'<td colspan=10>Balanced  Tags</td>' +

		'</tr>'

		+ '<tr><th style="width:10%;">S.no</th>'

		+ '<th style="width:10%;">Issue No</th>'

		+ '<th style="width:10%;">Tag Code</th>'

		+ '<th style="width:10%;">Issued Date</th>'

		+ '<th style="width:10%;">Image</th>'

		+ '<th style="width:10%;">Gross Wt</th>'

		+ '<th style="width:10%;">Status</th>'

	'</tr>';

	$.each(oData.get_balanced_tags, function (idx, val) {

		var type = pre_image_path + '/' + val.image_name;

		get_balanced_tags +=

			'<tr class="issued_btn">' +

			'<td>' + parseFloat(idx + 1) + '</td>' +

			'<td>' + val.id_stock_issue + '</td>' +

			'<td>' + val.tag_code + '</td>' +

			'<td>' + val.issued_date + '</td>' +

			'<td><img src=' + type + ' width="50" height="55"><br><a  class="btn btn-secondary sti_img"  id="edit" data-toggle="modal" data-id=' + val.image_name + '><i class="fa fa-eye" ></i></a>' +

			'<td>' + val.weight + '</td>' +

			'<td>' + val.tag_status + '</td>' +

			'</tr>';

	});

	rowDetail = get_balanced_tags + '</table></div>';

	return rowDetail;

}

function fnFormatRowIssuedTagDetails(oTable, nTr) {

	var oData = oTable.fnGetData(nTr);

	var rowDetail = '';

	var issued_tags_details =

		'<div class="innerDetails" style="margin-bottom: 20px;border-bottom: 2px solid #39cccc;">' +

		'<table class="table table-responsive table-bordered text-center table-sm">' +

		'<tr class="bg-teal" >' +

		'<td colspan=10>Issued Tags</td>' +

		'</tr>'

		+ '<tr><th style="width:10%;">S.no</th>'

		+ '<th style="width:10%;">Issue No</th>'

		+ '<th style="width:10%;">Tag Code</th>'

		+ '<th style="width:10%;">Image</th>'

		+ '<th style="width:10%;">Gross Wt</th>'

		+ '<th style="width:10%;">Status</th>'

	'</tr>';

	$.each(oData.issued_tags, function (idx, val) {

		var type = pre_image_path + '/' + val.image_name;

		issued_tags_details +=

			'<tr class="issued_btn">' +

			'<td>' + parseFloat(idx + 1) + '</td>' +

			'<td>' + val.id_stock_issue + '</td>' +

			'<td>' + val.tag_code + '</td>' +

			'<td><img src=' + type + ' width="50" height="55"><br><a  class="btn btn-secondary sti_img"  id="edit" data-toggle="modal" data-id=' + val.image_name + '><i class="fa fa-eye" ></i></a></td>' +

			'<td>' + val.weight + '</td>' +

			'<td>' + val.tag_status + '</td>' +

			'</tr>';

	});

	rowDetail = issued_tags_details + '</table></div>';

	return rowDetail;

}

function fnFormatRowReceivedTagDetails(oTable, nTr) {

	var oData = oTable.fnGetData(nTr);

	var rowDetail = '';

	var received_tags_details =

		'<div class="innerDetails" style="margin-bottom: 20px;border-bottom: 2px solid #39cccc;">' +

		'<table class="table table-responsive table-bordered text-center table-sm">' +

		'<tr class="bg-teal" >' +

		'<td colspan=10>Received Tags</td>' +

		'</tr>'

		+ '<tr><th style="width:10%;">S.no</th>'

		+ '<th style="width:10%;">Issue No</th>'

		+ '<th style="width:10%;">Tag Code</th>'

		+ '<th style="width:10%;">Received Date</th>'

		+ '<th style="width:10%;">Image</th>'

		+ '<th style="width:10%;">Gross Wt</th>'

		+ '<th style="width:10%;">Status</th>'

	'</tr>';

	$.each(oData.received_tags, function (idx, val) {

		var type = pre_image_path + '/' + val.image_name;

		received_tags_details +=

			'<tr class="issued_btn">' +

			'<td>' + parseFloat(idx + 1) + '</td>' +

			'<td>' + val.id_stock_issue + '</td>' +

			'<td>' + val.tag_code + '</td>' +

			'<td>' + val.issue_received_date + '</td>' +

			'<td><img src=' + type + ' width="50" height="55"><br><a  class="btn btn-secondary sti_img"  id="edit" data-toggle="modal" data-id=' + val.image_name + '><i class="fa fa-eye" ></i></a></td>' +

			'<td>' + val.weight + '</td>' +

			'<td>' + val.tag_status + '</td>' +

			'</tr>';

	});

	rowDetail = received_tags_details + '</table></div>';

	return rowDetail;

}

//Stock Issue Report

//Tag History

$('#tagging_history_search').on('click', function () {

	if ($("#tag_number").val() != '' || $("#old_tag_number").val() != '') {

		set_tagging_history();

	} else {

		$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + 'Please Enter The Tag Number..' });

	}

});

function set_tagging_history() {

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$('#tag_stone_details > tbody').empty();

	$('#tag_billing > tbody').empty();

	$('#tag_branch_transfer > tbody').empty();

	$('#tag_section_transfer > tbody').empty();

	$('#tag_scan_details > tbody').empty();

	$('#tag_stock_issue > tbody').empty();

	$('#edit').remove();

	$('#tag_metal_details > tbody').empty();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/tagging_history/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: { 'tag_id': $("#tag_number").val(), 'old_tag_id': $("#old_tag_number").val() },

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			console.log(data);

			var tag_history_data = data.list;

			if (tag_history_data != null && tag_history_data.length > 0) {

				var tagData = tag_history_data[0];

				var calc = 0;

				if (tagData.calculation_based_on == 0) {

					calc = parseFloat((tagData.gross_wt * tagData.retail_max_wastage_percent) / 100);

				}

				else if (tagData.calculation_based_on == 1 || tagData.calculation_based_on == 2) {

					calc = parseFloat((tagData.net_wt * tagData.retail_max_wastage_percent) / 100);

				}

				$('#branch').val(tagData.current_branch);

				$('#product').val(tagData.product_name);

				var img_src = "";

				if (tagData.tag_image != null && tagData.tag_image != undefined && tagData.tag_image != '') {

					img_src = base_url + 'assets/img/tag/' + tagData.tag_image;

				}

				else {

					img_src = base_url + 'assets/img/no_image.png';

				}

				var orderDetailsId = tagData.tag_id;

				var anchorElement = $('<a>', { class: 'btn btn-secondary order_img', id: 'edit', href: '#', 'data-toggle': 'modal', 'data-id': orderDetailsId, html: '<i class="fa fa-eye"></i>', });

				$('#tag_wast_perc').val(tagData.retail_max_wastage_percent);

				let tot_wastage = $("#tag_wast_perc").val() > 0 ? $("#tag_wast_perc").val() : 0;

				let wast_wgt = parseFloat(parseFloat(tagData.net_wt) * parseFloat(tot_wastage / 100)).toFixed(3);

				var pur_ref_no = tagData.pur_ref_no;

				var po_id = tagData.po_id;

				var purchaseOrderLink = '<a href="' + base_url + 'index.php/admin_ret_purchase/purchase/job_receipt/' + po_id + '" target="_blank">' + pur_ref_no + '</a>';

				var OrderLink = '<a href="' + base_url + 'index.php/admin_ret_order/customer_order_acknowladgement/' + tagData.id_customerorder + '" target="_blank">' + tagData.orderno + '</a>';

				$('.cert_img_preview_container').append(anchorElement);

				$('#purchase_order_no').val(pur_ref_no);

				$('#purchase_order_link').html(purchaseOrderLink);

				$('#order_link').html(OrderLink);

				$('#cert_img_preview').attr('src', img_src);

				$('#design').val(tagData.design_name);

				$('#id_sub_design').val(tagData.sub_design_name);

				$('#tag_pcs').val(tagData.piece);

				$('#gross_wt').val(tagData.gross_wt);

				$('#tag_lwt').val(tagData.less_wt);

				$('#tag_nwt').val(tagData.net_wt);

				$('#tag_wast_value').val(wast_wgt);

				$('#tag_mc_type').val(tagData.tag_mc_type);

				$('#tag_mc_value').val(tagData.tag_mc_value);

				$('#size').val(tagData.size);

				$('#calc_type').val(tagData.calc_type);

				$('#tag_huid').val(tagData.huid1);

				$('#tag_huid2').val(tagData.huid2);

				$('#certi_no').val(tagData.certi_no);

				$('#manufacture_code').val(tagData.manufacture_code);

				$('#style_code').val(tagData.style_code);

				$('#old_tag_id').val(tagData.old_tag_id);

				$('#lot_no').val(tagData.lot_no);

				$('#tag_karigar').val(tagData.karigar);

				$('#purity').val(tagData.purity);

				$('#tag_sale_value').val(tagData.sales_value);

				$('#purchase_touch').val(tagData.purchase_touch);

				$('#purchase_wastage').val(tagData.item_wastage);

				$('#purchase_making_charges').val(tagData.po_othere_charges);

				$('#tag_date').val(tagData.tag_date);

				$('#id_section').val(tagData.section);

				$('#order_no').val(tagData.orderno);

				$('#tag_status').val(tagData.tag_status);

				$('#remark').val(tagData.remark);

				var tag_no = $('#tag_number').val();

				if (tag_no != "") {

					$('#lot_date').val(tagData.lot_date);

				}

				else {

					$('#lot_date').val(tagData.old_tag_date);

				}

				if (tag_no != "") {

					$('#age').val(tagData.age);

				}

				else {

					$('#age').val(tagData.old_age);

				}

				$('#employee').val(tagData.employee);

				$('#tag_stone_wt').val(tagData.stn_wt);

				$('#tag_dia_wt').val(tagData.totaldiawt);

				$('#tag_id').val(tagData.tag_id);

				var stone_details = tagData.stone_details;

				console.log(stone_details);

				var trHtml = "";

				$.each(stone_details, function (key, items) {

					trHtml += '<tr>'

						+ '<td>' + items.stone_name + '</td>'

						+ '<td>' + items.uom_name + '</td>'

						+ '<td>' + items.clarity + '</td>'

						+ '<td>' + items.color + '</td>'

						+ '<td>' + items.cut + '</td>'

						+ '<td>' + items.shape + '</td>'

						+ '<td>' + items.stone_pcs + '</td>'

						+ '<td>' + items.stone_wt + '</td>'

						+ '<td>' + items.stone_cal_type + '</td>'

						+ '<td>' + items.stone_rate + '</td>'

						+ '<td>' + items.stone_price + '</td>'

						+ '</tr>';

				});

				$('#tag_stone_details > tbody').append(trHtml);

				var metal_details = tagData.metal_details;

				var trmetal = "";

				$.each(metal_details, function (key, items) {

					trmetal += '<tr>'

						+ '<td>' + items.name + '</td>'

						+ '<td>' + items.purity + '</td>'

						+ '<td>' + items.pcs + '</td>'

						+ '<td>' + items.grosswt + '</td>'

						+ '<td>' + items.wastage + '</td>'

						+ '<td>' + items.rate + '</td>'

						+ '<td>' + items.totalamt + '</td>'

						+ '</tr>';

				});

				$('#tag_metal_details > tbody').append(trmetal);

				var bill_details = tagData.bill_details;

				var trest = "";

				$.each(bill_details, function (key, items) {

					var bill_url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + items.bill_id;

					trest += '<tr>'

						+ '<td>' + items.bill_no + '</td>'

						+ '<td>' + items.date_add + '</td>'

						+ '<td>' + items.customer + '</td>'

						+ '<td>' + items.mobile + '</td>'

						+ '<td>' + items.branch + '</td>'

						+ '<td><a href=' + bill_url + ' target="_blank">' + (items.bill_no != '' ? items.bill_no : '-') + '</a></td>'

						+ '</tr>';

				});

				$('#tag_billing > tbody').append(trest);

				var branch_details = tagData.branch_details;

				var tag_history = "";

				$.each(branch_details, function (key, items) {

					var branch_url = base_url + 'index.php/admin_ret_brntransfer/branch_transfer/print/' + items.branch_trans_code + '/' + items.transfer_item_type + '/' + 2;

					tag_history += '<tr>'

						+ '<td><a href=' + branch_url + ' target="_blank">' + (items.branch_trans_code != '' ? items.branch_trans_code : '-') + '</a></td>'

						+ '<td>' + items.from_branch + '</td>'

						+ '<td>' + items.to_branch + '</td>'

						+ '<td>' + items.employee + '</td>'

						+ '<td>' + items.date + '</td>'

						+ '<td>' + items.approved_by + '</td>'

						+ '<td>' + items.approved_date + '</td>'

						+ '<td>' + items.downloaded_by + '</td>'

						+ '<td>' + items.download_date + '</td>'

						+ '<td>' + items.tag_status + '</td>'

						+ '</tr>';

				});

				$('#tag_branch_transfer > tbody').append(tag_history);

				var section_details = tagData.section_history;

				var section = "";

				$.each(section_details, function (key, items) {

					section += '<tr>'

						+ '<td>' + items.from_section + '</td>'

						+ '<td>' + items.to_section + '</td>'

						+ '<td>' + items.employee + '</td>'

						+ '<td>' + items.date + '</td>'

						+ '</tr>';

				});

				$('#tag_section_transfer > tbody').append(section);

				var scan_details = tagData.scan_details;

				var scan = "";

				$.each(scan_details, function (key, items) {

					scan += '<tr>'

						+ '<td>' + items.date + '</td>'

						+ '<td>' + items.employee + '</td>'

						+ '</tr>';

				});

				$('#tag_scan_details> tbody').append(scan);

				var stock_issue_details = tagData.stock_details;

				var stock = "";

				$.each(stock_issue_details, function (key, items) {

					stock += '<tr>'

						+ '<td>' + items.issue_no + '</td>'

						+ '<td>' + items.issued_to + '</td>'

						+ '<td>' + items.issue_type + '</td>'

						+ '<td>' + items.tag_code + '</td>'

						+ '<td>' + items.created_by + '</td>'

						+ '<td>' + items.created_date + '</td>'

						+ '<td>' + items.received_by + '</td>'

						+ '<td>' + items.received_date + '</td>'

						+ '</tr>';

				});

				$('#tag_stock_issue> tbody').append(stock);

			}

			else {

				$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + 'No Records Found..' });

				$("div.overlay").css("display", "none");

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

$('#duplicate_print').on('click', function () {

	var tag_id = $("#tag_id").val();

	if (tag_id != "") {

		duplicate_tagging_print(tag_id);

	}

	else {

		$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + 'Please Enter the Tag Number.' });

		$("div.overlay").css("display", "none");

	}

});

function duplicate_tagging_print(req_data) {

	//var tag = JSON.stringify(req_data);

	window.open(base_url + 'index.php/admin_ret_tagging/tagging/generate_barcode?tag=' + req_data, '_blank');

	//window.location.reload();

}

$(document).on('click', "a.order_img", function (e) {

	e.preventDefault();

	console.log("Eye icon clicked");

	var order_id_img1 = $(this).data('id');

	// alert(order_id_img1);

	view_dup_tag_history_imgs(order_id_img1);

});

function view_dup_tag_history_imgs(order_id_img1) {

	update_tag_img_id1 = order_id_img1;

	data = [];

	var tag_codeimage1 = base_url + 'assets/img/tag';

	$('#imageModal_bulk_edit').modal('show');

	$(".overlay").css('display', "none");

	$.ajax({

		data: ({ 'tag_id': order_id_img1 }),

		url: base_url + "index.php/admin_ret_reports/get_img_by_tag_id?nocache=" + my_Date.getUTCSeconds() + '' + my_Date.getUTCMinutes() + '' + my_Date.getUTCHours(),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			retrive_img = data;

			for (i = 0; i < data.length; i++) {

				img_src = data[i].image;

				var preview = $('#order_images_preview');

				var img = tag_codeimage1 + '/' + img_src;

				if (img_src) {

					div = document.createElement("div");

					div.setAttribute('class', 'col-md-3 images');

					div.setAttribute('id', 'order_img_edit_' + [i]);

					$('.images').css('margin-right', '25px');

					key = [i];

					param = img_src;

					div.innerHTML += "<div class='form-group'><div class='image-input image-input-outline' 		id='kt_image_'><div class='image-input-wrapper'><img class='thumbnail' src='" + img + "'" + "style='width: 300px;height: 250px;'/><a href=" + img + " download=" + img_src + "><i class='fa fa-download btn btn-success'>Download</i></div></div></a>";

					preview.append(div);

				}

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

$("#imageModal_bulk_edit").on("hidden.bs.modal", function () {

	$('#order_images_preview').empty();

});

//Tag History

$('#gst_abstract_search_with_return').on('click', function () {

	get_gst_abstract_with_return_details();

});

/*function get_gst_abstract_with_return_details()

{

//var branch_name=($('#branch_name').val()!='' && $('#branch_name').val()!=undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

var report_type=$('#sale_ret_filter').find(':selected').text();

var branch_name=$("#branch_select option:selected").text();

var company_name=$('#company_name').val();

var title="<b><span style='font-size:15pt;margin-left:50%;'>"+company_name+"</span></b><b><span style='font-size:15pt;'></span></b></br>"+"<span style=font-size:13pt;margin-left:25%;>&nbsp;&nbsp;GST ABSTRACT SALES RETURN "+($("#branch_select").val()!='' ? "Cost Center:"+branch_name+" ":'')+"</span>";

$("div.overlay").css("display", "block");

my_Date = new Date();

$.ajax({

url:base_url+ "index.php/admin_ret_reports/gst_abstract_with_return/ajax?nocache=" + my_Date.getUTCSeconds(),

dataType:"JSON",

data:{'group_by':$('#gst_group_by').val(),'id_branch':$('#branch_select').val(),'from_date':$('#rpt_from_date').html(),'to_date' :$('#rpt_to_date').html(),'report_type':$('#report_type').val(),'gst_filter':$('#gst_filter').val(),'sale_ret_filter':$('#sale_ret_filter').val(),'id_metal':$('#metal').val(),'tax_group':$('#tax_group').val(),'hsn_code':$('#hsn_code').val()},

type:"POST",

success:function(data)

{

		var company_bills=data.list.B2B;

		var customer_bills=data.list.B2C;

		var sales_transfer=data.list.sales_transfer;

		var repair=data.list.repair;

		var overseas = data.list.overseas;

		var cmp_round_off=0;

		var cus_round_off=0;

		var rep_round_off=0;

		var overseas_round_off=0;

	   var trHTML='';

	   $("#gst_abstract_list > tbody > tr").remove();

	   $('#gst_abstract_list').dataTable().fnClearTable();

		   $('#gst_abstract_list').dataTable().fnDestroy();

		   var cmp_pcs=0;

		   var cmp_gwt=0;

		   var cmp_nwt=0;

		   var cmp_sgst=0;

		   var cmp_cgst=0;

		   var cmp_igst=0;

		   var cmp_gst=0;

		   var cmp_total_amt=0;

		   var cmp_taxable_amt=0;

		   var cus_pcs=0;

		   var cus_gwt=0;

		   var cus_nwt=0;

		   var cus_sgst=0;

		   var cus_cgst=0;

		   var cus_igst=0;

		   var cus_gst=0;

		   var cus_total_amt=0;

		   var cus_taxable_amt=0;

			var rep_pcs=0;

			var rep_gwt=0;

			var rep_taxable=0;

			var rep_sgst=0;

			var rep_cgst=0;

			var rep_igst=0;

			var rep_tax=0;

			var rep_tot_amount=0;

			var overseas_pcs=0;

			var overseas_gwt=0;

			var overseas_taxable=0;

			var overseas_sgst=0;

			var overseas_cgst=0;

			var overseas_igst=0;

			var overseas_tax=0;

			var overseas_tot_amount=0;

			var st_pcs=0;

			var st_gwt=0;

			var st_taxable=0;

			var st_sgst=0;

			var st_cgst=0;

			var st_igst=0;

			var st_tax=0;

			var st_tot_amount=0;

			var st_round_off=0;

		   console.log("company_bills", Object.keys(company_bills).length);

		   console.log("customer_bills", Object.keys(customer_bills).length);

		   console.log("overseas", Object.keys(overseas).length);

	   if(Object.keys(company_bills).length>0)

	   {

		   trHTML+='<tr>'

				   +'<td><strong>B2B BILLS</strong></td>'

				   +'<td></td>'

				   +'<td></td>'

				   +'<td></td>'

				   +'<td></td>'

				   +'<td></td>'

				   +'<td></td>'

				   // +'<td></td>'s

				   +'<td></td>'

				   +'<td></td>'

				   +'<td></td>'

				   +'<td></td>'

				   +'<td></td>'

				   +'</tr>';

		   $.each(company_bills,function(key,items){

			   let sls_category_name 	= typeof items.sales === 'undefined' || typeof items.sales.category_name === 'undefined' ? '' : items.sales.category_name;

			   let sls_hsn_code 		= typeof items.sales === 'undefined' || typeof items.sales.hsn_code === 'undefined' ? '' : items.sales.hsn_code;

			   let sls_starting_bill  	= typeof items.sales === 'undefined' || typeof items.sales.starting_bill === 'undefined' ? '' : items.sales.starting_bill;

			   let sls_ending_bill  	= typeof items.sales === 'undefined' || typeof items.sales.ending_bill === 'undefined' ? '' : items.sales.ending_bill;

			   let sls_piece 			= typeof items.sales === 'undefined' || typeof items.sales.piece === 'undefined' ? 0 : isNaN(parseFloat(items.sales.piece)) ? 0 : items.sales.piece;

			   let sls_gross_wt 		= typeof items.sales === 'undefined' || typeof items.sales.gross_wt === 'undefined' ? 0 : isNaN(parseFloat(items.sales.gross_wt)) ? 0 : items.sales.gross_wt;

			   let sls_net_wt 			= typeof items.sales === 'undefined' || typeof items.sales.net_wt === 'undefined' ? 0 : isNaN(parseFloat(items.sales.net_wt)) ? 0 : items.sales.net_wt;

			   let sls_taxable_amt 		= typeof items.sales === 'undefined' || typeof items.sales.taxable_amt === 'undefined' ? 0 : isNaN(parseFloat(items.sales.taxable_amt)) ? 0 : items.sales.taxable_amt;

			   let sls_total_sgst 		= typeof items.sales === 'undefined' || typeof items.sales.total_sgst === 'undefined' ? 0 : isNaN(parseFloat(items.sales.total_sgst)) ? 0 : items.sales.total_sgst;

			   let sls_total_cgst 		= typeof items.sales === 'undefined' || typeof items.sales.total_cgst === 'undefined' ? 0 : isNaN(parseFloat(items.sales.total_cgst)) ? 0 : items.sales.total_cgst;

			   let sls_total_igst 		= typeof items.sales === 'undefined' || typeof items.sales.total_igst === 'undefined' ? 0 : isNaN(parseFloat(items.sales.total_igst)) ? 0 : items.sales.total_igst;

			   let sls_tax_amt 			= typeof items.sales === 'undefined' || typeof items.sales.tax_amt === 'undefined' ? 0 : isNaN(parseFloat(items.sales.tax_amt)) ? 0 : items.sales.tax_amt;

			   let sls_total_amount 	= typeof items.sales === 'undefined' || typeof items.sales.total_amount === 'undefined' ? 0 : isNaN(parseFloat(items.sales.total_amount)) ? 0 : items.sales.total_amount;

			   let sls_round_off 		= typeof items.sales === 'undefined' || typeof items.sales.round_off === 'undefined' ? 0 : isNaN(parseFloat(items.sales.round_off)) ? 0 : items.sales.round_off;

			   let ret_category_name 	= typeof items.return === 'undefined' || typeof items.return.category_name === 'undefined' ? '' : items.return.category_name;

			   let ret_hsn_code 		= typeof items.return === 'undefined' || typeof items.return.hsn_code === 'undefined' ? '' : items.return.hsn_code;

			   let ret_starting_bill  	= typeof items.return === 'undefined' || typeof items.return.starting_bill === 'undefined' ? '' : items.return.starting_bill;

			   let ret_ending_bill  	= typeof items.return === 'undefined' || typeof items.return.ending_bill === 'undefined' ? '' : items.return.ending_bill;

			   let ret_piece 			= typeof items.return === 'undefined' || typeof items.return.piece === 'undefined' ? 0 : isNaN(parseFloat(items.return.piece)) ? 0 : items.return.piece;

			   let ret_gross_wt 		= typeof items.return === 'undefined' || typeof items.return.gross_wt === 'undefined' ? 0 : isNaN(parseFloat(items.return.gross_wt)) ? 0 : items.return.gross_wt;

			   let ret_net_wt 			= typeof items.return === 'undefined' || typeof items.return.net_wt === 'undefined' ? 0 : isNaN(parseFloat(items.return.net_wt)) ? 0 : items.return.net_wt;

			   let ret_taxable_amt 		= typeof items.return === 'undefined' || typeof items.return.taxable_amt === 'undefined' ? 0 : isNaN(parseFloat(items.return.taxable_amt)) ? 0 : items.return.taxable_amt;

			   let ret_total_sgst 		= typeof items.return === 'undefined' || typeof items.return.total_sgst === 'undefined' ? 0 : isNaN(parseFloat(items.return.total_sgst)) ? 0 : items.return.total_sgst;

			   let ret_total_cgst 		= typeof items.return === 'undefined' || typeof items.return.total_cgst === 'undefined' ? 0 : isNaN(parseFloat(items.return.total_cgst)) ? 0 : items.return.total_cgst;

			   let ret_total_igst 		= typeof items.return === 'undefined' || typeof items.return.total_igst === 'undefined' ? 0 : isNaN(parseFloat(items.return.total_igst)) ? 0 : items.return.total_igst;

			   let ret_tax_amt 			= typeof items.return === 'undefined' || typeof items.return.tax_amt === 'undefined' ? 0 : isNaN(parseFloat(items.return.tax_amt)) ? 0 : items.return.tax_amt;

			   let ret_total_amount 	= typeof items.return === 'undefined' || typeof items.return.total_amount === 'undefined' ? 0 : isNaN(parseFloat(items.return.total_amount)) ? 0 : items.return.total_amount;

			   let ret_round_off 		= typeof items.return === 'undefined' || typeof items.return.round_off === 'undefined' ? 0 : isNaN(parseFloat(items.return.round_off)) ? 0 : items.return.round_off;

			   cmp_pcs+=parseFloat(sls_piece)-parseFloat(ret_piece);

			   cmp_gwt+=parseFloat(sls_gross_wt)-parseFloat(ret_gross_wt);

			   cmp_nwt+=parseFloat(sls_net_wt)-parseFloat(ret_net_wt);

			   cmp_taxable_amt+=parseFloat(sls_taxable_amt)-parseFloat(ret_taxable_amt);

			   cmp_sgst+=parseFloat(sls_total_sgst)-parseFloat(ret_total_sgst);

			   cmp_cgst+=parseFloat(sls_total_cgst)-parseFloat(ret_total_cgst);

			   cmp_igst+=parseFloat(sls_total_igst)-parseFloat(ret_total_igst);

			   cmp_gst+=parseFloat(sls_tax_amt)-parseFloat(ret_tax_amt);

			   cmp_total_amt+=parseFloat(sls_total_amount)-parseFloat(ret_total_amount);

			   cmp_round_off+=parseFloat(sls_round_off)-parseFloat(ret_round_off);

			   trHTML+='<tr>'

				+'<td><strong>'+sls_category_name+'(Sales)</strong></td>'

				   +'<td>'+(sls_starting_bill+' - '+sls_ending_bill)+'</td>'

				   +'<td>'+sls_piece+'</td>'

				   +'<td>'+sls_hsn_code+'</td>'

				   +'<td>'+sls_gross_wt+'</td>'

				   // +'<td>'+items.net_wt+'</td>'

				   +'<td>'+money_format_india(parseFloat(sls_taxable_amt).toFixed(2))+'</td>'

				   +'<td>'+money_format_india(parseFloat(sls_total_sgst).toFixed(2))+'</td>'

				   +'<td>'+money_format_india(parseFloat(sls_total_cgst).toFixed(2))+'</td>'

				   +'<td>'+money_format_india(parseFloat(sls_total_igst).toFixed(2))+'</td>'

				   +'<td>'+money_format_india(parseFloat(sls_tax_amt).toFixed(2))+'</td>'

				   +'<td>'+parseFloat(sls_round_off).toFixed(2)+'</td>'

				   +'<td>'+money_format_india(parseFloat(sls_total_amount).toFixed(2))+'</td>'

				   +'</tr>';

					trHTML+='<tr>'

				   +'<td><strong>'+ret_category_name+'(Return)</strong></td>'

				   +'<td>'+(ret_starting_bill+' - '+ret_ending_bill)+'</td>'

				   +'<td>'+ret_piece+'</td>'

				   +'<td>'+ret_hsn_code+'</td>'

				   +'<td>'+parseFloat(ret_gross_wt).toFixed(3)+'</td>'

				   // +'<td>'+items.net_wt+'</td>'

				   +'<td>'+money_format_india(parseFloat(ret_taxable_amt).toFixed(2))+'</td>'

				   +'<td>'+money_format_india(parseFloat(ret_total_sgst).toFixed(2))+'</td>'

				   +'<td>'+money_format_india(parseFloat(ret_total_cgst).toFixed(2))+'</td>'

				   +'<td>'+money_format_india(parseFloat(ret_total_igst).toFixed(2))+'</td>'

				   +'<td>'+money_format_india(parseFloat(ret_tax_amt).toFixed(2))+'</td>'

				   +'<td>'+parseFloat(ret_round_off).toFixed(2)+'</td>'

				   +'<td>'+money_format_india(parseFloat(ret_total_amount).toFixed(2))+'</td>'

				   +'</tr>';

					trHTML+='<tr class="sales_return_total">'

				   +'<td><strong>Total(Sales-Return)</strong></td>'

				   +'<td>'+(sls_starting_bill+' - '+sls_ending_bill)+'</td>'

				   +'<td>'+(parseFloat(sls_piece)-parseFloat(ret_piece))+'</td>'

				   +'<td>'+(sls_hsn_code == '' ? ret_hsn_code : sls_hsn_code)+'</td>'

				   +'<td>'+parseFloat(parseFloat(sls_gross_wt)-parseFloat(ret_gross_wt)).toFixed(3)+'</td>'

				   // +'<td>'+items.net_wt+'</td>'

				   +'<td>'+money_format_india((parseFloat(sls_taxable_amt)-parseFloat(ret_taxable_amt)).toFixed(2))+'</td>'

				   +'<td>'+money_format_india((parseFloat(sls_total_sgst)-parseFloat(ret_total_sgst)).toFixed(2))+'</td>'

				   +'<td>'+money_format_india((parseFloat(sls_total_cgst)-parseFloat(ret_total_cgst)).toFixed(2))+'</td>'

				   +'<td>'+money_format_india((parseFloat(sls_total_igst)-parseFloat(ret_total_igst)).toFixed(2))+'</td>'

				   +'<td>'+money_format_india((parseFloat(sls_tax_amt)-parseFloat(ret_tax_amt)).toFixed(2))+'</td>'

				   +'<td>'+parseFloat(parseFloat(sls_round_off)-parseFloat(ret_round_off)).toFixed(2)+'</td>'

				   +'<td>'+money_format_india((parseFloat(sls_total_amount)-parseFloat(ret_total_amount)).toFixed(2))+'</td>'

				   +'</tr>';

		   });

		   trHTML+='<tr>'

				   +'<td><strong>SUB TOTAL</strong></td>'

				   +'<td></td>'

				   +'<td><strong>'+cmp_pcs+'</td>'

				   +'<td></td>'

				   +'<td><strong>'+parseFloat(cmp_gwt).toFixed(3)+'</strong></td>'

				   // +'<td><strong>'+parseFloat(cmp_nwt).toFixed(3)+'</strong></td>'

				   +'<td><strong>'+money_format_india(parseFloat(cmp_taxable_amt).toFixed(2))+'</strong></td>'

				   +'<td><strong>'+money_format_india(parseFloat(cmp_sgst).toFixed(2))+'</strong></td>'

				   +'<td><strong>'+money_format_india(parseFloat(cmp_cgst).toFixed(2))+'</strong></td>'

				   +'<td><strong>'+money_format_india(parseFloat(cmp_igst).toFixed(2))+'</strong></td>'

				   +'<td><strong>'+money_format_india(parseFloat(cmp_gst).toFixed(2))+'</strong></td>'

				   +'<td><strong>'+parseFloat(cmp_round_off).toFixed(2)+'</strong></td>'

				   +'<td><strong>'+money_format_india(parseFloat(cmp_total_amt).toFixed(2))+'</strong></td>'

			+'</tr>';

	   }

	   if(Object.keys(customer_bills).length>0)

	   {

		   trHTML+='<tr>'

				   +'<td><strong>B2C BILLS</strong></td>'

				   +'<td></td>'

				   +'<td></td>'

				   +'<td></td>'

				   +'<td></td>'

				   // +'<td></td>'

				   +'<td></td>'

				   +'<td></td>'

				   +'<td></td>'

				   +'<td></td>'

				   +'<td></td>'

				   +'<td></td>'

				   +'<td></td>'

				   +'</tr>';

		   $.each(customer_bills,function(key,items){

				let sls_category_name 	= typeof items.sales === 'undefined' || typeof items.sales.category_name === 'undefined' ? '' : items.sales.category_name;

				let sls_hsn_code 		= typeof items.sales === 'undefined' || typeof items.sales.hsn_code === 'undefined' ? '' : items.sales.hsn_code;

				let sls_starting_bill  	= typeof items.sales === 'undefined' || typeof items.sales.starting_bill === 'undefined' ? '' : items.sales.starting_bill;

				let sls_ending_bill  	= typeof items.sales === 'undefined' || typeof items.sales.ending_bill === 'undefined' ? '' : items.sales.ending_bill;

				let sls_piece 			= typeof items.sales === 'undefined' || typeof items.sales.piece === 'undefined' ? 0 : isNaN(parseFloat(items.sales.piece)) ? 0 : items.sales.piece;

				let sls_gross_wt 		= typeof items.sales === 'undefined' || typeof items.sales.gross_wt === 'undefined' ? 0 : isNaN(parseFloat(items.sales.gross_wt)) ? 0 : items.sales.gross_wt;

				let sls_net_wt 			= typeof items.sales === 'undefined' || typeof items.sales.net_wt === 'undefined' ? 0 : isNaN(parseFloat(items.sales.net_wt)) ? 0 : items.sales.net_wt;

				let sls_taxable_amt 		= typeof items.sales === 'undefined' || typeof items.sales.taxable_amt === 'undefined' ? 0 : isNaN(parseFloat(items.sales.taxable_amt)) ? 0 : items.sales.taxable_amt;

				let sls_total_sgst 		= typeof items.sales === 'undefined' || typeof items.sales.total_sgst === 'undefined' ? 0 : isNaN(parseFloat(items.sales.total_sgst)) ? 0 : items.sales.total_sgst;

				let sls_total_cgst 		= typeof items.sales === 'undefined' || typeof items.sales.total_cgst === 'undefined' ? 0 : isNaN(parseFloat(items.sales.total_cgst)) ? 0 : items.sales.total_cgst;

				let sls_total_igst 		= typeof items.sales === 'undefined' || typeof items.sales.total_igst === 'undefined' ? 0 : isNaN(parseFloat(items.sales.total_igst)) ? 0 : items.sales.total_igst;

				let sls_tax_amt 			= typeof items.sales === 'undefined' || typeof items.sales.tax_amt === 'undefined' ? 0 : isNaN(parseFloat(items.sales.tax_amt)) ? 0 : items.sales.tax_amt;

				let sls_total_amount 	= typeof items.sales === 'undefined' || typeof items.sales.total_amount === 'undefined' ? 0 : isNaN(parseFloat(items.sales.total_amount)) ? 0 : items.sales.total_amount;

				let sls_round_off 		= typeof items.sales === 'undefined' || typeof items.sales.round_off === 'undefined' ? 0 : isNaN(parseFloat(items.sales.round_off)) ? 0 : items.sales.round_off;

				let ret_category_name 	= typeof items.return === 'undefined' || typeof items.return.category_name === 'undefined' ? '' : items.return.category_name;

				let ret_hsn_code 		= typeof items.return === 'undefined' || typeof items.return.hsn_code === 'undefined' ? '' : items.return.hsn_code;

				let ret_starting_bill  	= typeof items.return === 'undefined' || typeof items.return.starting_bill === 'undefined' ? '' : items.return.starting_bill;

				let ret_ending_bill  	= typeof items.return === 'undefined' || typeof items.return.ending_bill === 'undefined' ? '' : items.return.ending_bill;

				let ret_piece 			= typeof items.return === 'undefined' || typeof items.return.piece === 'undefined' ? 0 : isNaN(parseFloat(items.return.piece)) ? 0 : items.return.piece;

				let ret_gross_wt 		= typeof items.return === 'undefined' || typeof items.return.gross_wt === 'undefined' ? 0 : isNaN(parseFloat(items.return.gross_wt)) ? 0 : items.return.gross_wt;

				let ret_net_wt 			= typeof items.return === 'undefined' || typeof items.return.net_wt === 'undefined' ? 0 : isNaN(parseFloat(items.return.net_wt)) ? 0 : items.return.net_wt;

				let ret_taxable_amt 		= typeof items.return === 'undefined' || typeof items.return.taxable_amt === 'undefined' ? 0 : isNaN(parseFloat(items.return.taxable_amt)) ? 0 : items.return.taxable_amt;

				let ret_total_sgst 		= typeof items.return === 'undefined' || typeof items.return.total_sgst === 'undefined' ? 0 : isNaN(parseFloat(items.return.total_sgst)) ? 0 : items.return.total_sgst;

				let ret_total_cgst 		= typeof items.return === 'undefined' || typeof items.return.total_cgst === 'undefined' ? 0 : isNaN(parseFloat(items.return.total_cgst)) ? 0 : items.return.total_cgst;

				let ret_total_igst 		= typeof items.return === 'undefined' || typeof items.return.total_igst === 'undefined' ? 0 : isNaN(parseFloat(items.return.total_igst)) ? 0 : items.return.total_igst;

				let ret_tax_amt 			= typeof items.return === 'undefined' || typeof items.return.tax_amt === 'undefined' ? 0 : isNaN(parseFloat(items.return.tax_amt)) ? 0 : items.return.tax_amt;

				let ret_total_amount 	= typeof items.return === 'undefined' || typeof items.return.total_amount === 'undefined' ? 0 : isNaN(parseFloat(items.return.total_amount)) ? 0 : items.return.total_amount;

				let ret_round_off 		= typeof items.return === 'undefined' || typeof items.return.round_off === 'undefined' ? 0 : isNaN(parseFloat(items.return.round_off)) ? 0 : items.return.round_off;

				cus_pcs+=parseFloat(sls_piece)-parseFloat(ret_piece);

				cus_gwt+=parseFloat(sls_gross_wt)-parseFloat(ret_gross_wt);

				cus_nwt+=parseFloat(sls_net_wt)-parseFloat(ret_net_wt);

				cus_taxable_amt+=parseFloat(sls_taxable_amt)-parseFloat(ret_taxable_amt);

				cus_sgst+=parseFloat(sls_total_sgst)-parseFloat(ret_total_sgst);

				cus_cgst+=parseFloat(sls_total_cgst)-parseFloat(ret_total_cgst);

				cus_igst+=parseFloat(sls_total_igst)-parseFloat(ret_total_igst);

				cus_gst+=parseFloat(sls_tax_amt)-parseFloat(ret_tax_amt);

				cus_total_amt+=parseFloat(sls_total_amount)-parseFloat(ret_total_amount);

				cus_round_off+=parseFloat(sls_round_off)-parseFloat(ret_round_off);

				trHTML+='<tr>'

				+'<td><strong>'+sls_category_name+'(Sales)</strong></td>'

				   +'<td>'+(sls_starting_bill+' - '+sls_ending_bill)+'</td>'

				   +'<td>'+sls_piece+'</td>'

				   +'<td>'+sls_hsn_code+'</td>'

				   +'<td>'+sls_gross_wt+'</td>'

				   // +'<td>'+items.net_wt+'</td>'

				   +'<td>'+money_format_india(parseFloat(sls_taxable_amt).toFixed(2))+'</td>'

				   +'<td>'+money_format_india(parseFloat(sls_total_sgst).toFixed(2))+'</td>'

				   +'<td>'+money_format_india(parseFloat(sls_total_cgst).toFixed(2))+'</td>'

				   +'<td>'+money_format_india(parseFloat(sls_total_igst).toFixed(2))+'</td>'

				   +'<td>'+money_format_india(parseFloat(sls_tax_amt).toFixed(2))+'</td>'

				   +'<td>'+parseFloat(sls_round_off).toFixed(2)+'</td>'

				   +'<td>'+money_format_india(parseFloat(sls_total_amount).toFixed(2))+'</td>'

				   +'</tr>';

					trHTML+='<tr>'

				   +'<td><strong>'+ret_category_name+'(Return)</strong></td>'

				   +'<td>'+(ret_starting_bill+' - '+ret_ending_bill)+'</td>'

				   +'<td>'+ret_piece+'</td>'

				   +'<td>'+ret_hsn_code+'</td>'

				   +'<td>'+parseFloat(ret_gross_wt).toFixed(3)+'</td>'

				   // +'<td>'+items.net_wt+'</td>'

				   +'<td>'+money_format_india(parseFloat(ret_taxable_amt).toFixed(2))+'</td>'

				   +'<td>'+money_format_india(parseFloat(ret_total_sgst).toFixed(2))+'</td>'

				   +'<td>'+money_format_india(parseFloat(ret_total_cgst).toFixed(2))+'</td>'

				   +'<td>'+money_format_india(parseFloat(ret_total_igst).toFixed(2))+'</td>'

				   +'<td>'+money_format_india(parseFloat(ret_tax_amt).toFixed(2))+'</td>'

				   +'<td>'+parseFloat(ret_round_off).toFixed(2)+'</td>'

				   +'<td>'+money_format_india(parseFloat(ret_total_amount).toFixed(2))+'</td>'

				   +'</tr>';

					trHTML+='<tr class="sales_return_total">'

				   +'<td><strong>Total(Sales-Return)</strong></td>'

				   +'<td>'+(sls_starting_bill+' - '+sls_ending_bill)+'</td>'

				   +'<td>'+(parseFloat(sls_piece)-parseFloat(ret_piece))+'</td>'

				   +'<td>'+(sls_hsn_code == '' ? ret_hsn_code : sls_hsn_code)+'</td>'

				   +'<td>'+parseFloat(parseFloat(sls_gross_wt)-parseFloat(ret_gross_wt)).toFixed(3)+'</td>'

				   // +'<td>'+items.net_wt+'</td>'

				   +'<td>'+money_format_india((parseFloat(sls_taxable_amt)-parseFloat(ret_taxable_amt)).toFixed(2))+'</td>'

				   +'<td>'+money_format_india((parseFloat(sls_total_sgst)-parseFloat(ret_total_sgst)).toFixed(2))+'</td>'

				   +'<td>'+money_format_india((parseFloat(sls_total_cgst)-parseFloat(ret_total_cgst)).toFixed(2))+'</td>'

				   +'<td>'+money_format_india((parseFloat(sls_total_igst)-parseFloat(ret_total_igst)).toFixed(2))+'</td>'

				   +'<td>'+money_format_india((parseFloat(sls_tax_amt)-parseFloat(ret_tax_amt)).toFixed(2))+'</td>'

				   +'<td>'+parseFloat(parseFloat(sls_round_off)-parseFloat(ret_round_off)).toFixed(2)+'</td>'

				   +'<td>'+money_format_india((parseFloat(sls_total_amount)-parseFloat(ret_total_amount)).toFixed(2))+'</td>'

				   +'</tr>';

		   });

		   trHTML+='<tr>'

				   +'<td><strong>SUB TOTAL</strong></td>'

				   +'<td></td>'

				   +'<td><strong>'+cus_pcs+'</strong></td>'

				   +'<td></td>'

				   +'<td><strong>'+parseFloat(cus_gwt).toFixed(3)+'</strong></td>'

				   // +'<td><strong>'+parseFloat(cus_nwt).toFixed(3)+'</strong></td>'

				   +'<td><strong>'+money_format_india(parseFloat(cus_taxable_amt).toFixed(2))+'</strong></td>'

				   +'<td><strong>'+money_format_india(parseFloat(cus_sgst).toFixed(2))+'</strong></td>'

				   +'<td><strong>'+money_format_india(parseFloat(cus_cgst).toFixed(2))+'</strong></td>'

				   +'<td><strong>'+money_format_india(parseFloat(cus_igst).toFixed(2))+'</strong></td>'

				   +'<td><strong>'+money_format_india(parseFloat(cus_gst).toFixed(2))+'</strong></td>'

				   +'<td><strong>'+parseFloat(cus_round_off).toFixed(2)+'</strong></td>'

				   +'<td><strong>'+money_format_india(parseFloat(cus_total_amt).toFixed(2))+'</strong></td>'

			+'</tr>';

	   }

	   if(Object.keys(overseas).length>0)

			{

				trHTML+='<tr>'

				+'<td><strong>OVERSEAS BILLS</strong></td>'

				+'<td></td>'

				+'<td></td>'

				+'<td></td>'

				+'<td></td>'

				+'<td></td>'

				+'<td></td>'

				+'<td></td>'

				+'<td></td>'

				+'<td></td>'

				+'<td></td>'

				+'<td></td>'

				+'</tr>';

				$.each(overseas,function(key,items){

					let sls_category_name 	= typeof items.sales === 'undefined' || typeof items.sales.category_name === 'undefined' ? '' : items.sales.category_name;

					let sls_hsn_code 		= typeof items.sales === 'undefined' || typeof items.sales.hsn_code === 'undefined' ? '' : items.sales.hsn_code;

					let sls_starting_bill  	= typeof items.sales === 'undefined' || typeof items.sales.starting_bill === 'undefined' ? '' : items.sales.starting_bill;

					let sls_ending_bill  	= typeof items.sales === 'undefined' || typeof items.sales.ending_bill === 'undefined' ? '' : items.sales.ending_bill;

					let sls_piece 			= typeof items.sales === 'undefined' || typeof items.sales.piece === 'undefined' ? 0 : isNaN(parseFloat(items.sales.piece)) ? 0 : items.sales.piece;

					let sls_gross_wt 		= typeof items.sales === 'undefined' || typeof items.sales.gross_wt === 'undefined' ? 0 : isNaN(parseFloat(items.sales.gross_wt)) ? 0 : items.sales.gross_wt;

					let sls_net_wt 			= typeof items.sales === 'undefined' || typeof items.sales.net_wt === 'undefined' ? 0 : isNaN(parseFloat(items.sales.net_wt)) ? 0 : items.sales.net_wt;

					let sls_taxable_amt 		= typeof items.sales === 'undefined' || typeof items.sales.taxable_amt === 'undefined' ? 0 : isNaN(parseFloat(items.sales.taxable_amt)) ? 0 : items.sales.taxable_amt;

					let sls_total_sgst 		= typeof items.sales === 'undefined' || typeof items.sales.total_sgst === 'undefined' ? 0 : isNaN(parseFloat(items.sales.total_sgst)) ? 0 : items.sales.total_sgst;

					let sls_total_cgst 		= typeof items.sales === 'undefined' || typeof items.sales.total_cgst === 'undefined' ? 0 : isNaN(parseFloat(items.sales.total_cgst)) ? 0 : items.sales.total_cgst;

					let sls_total_igst 		= typeof items.sales === 'undefined' || typeof items.sales.total_igst === 'undefined' ? 0 : isNaN(parseFloat(items.sales.total_igst)) ? 0 : items.sales.total_igst;

					let sls_tax_amt 			= typeof items.sales === 'undefined' || typeof items.sales.tax_amt === 'undefined' ? 0 : isNaN(parseFloat(items.sales.tax_amt)) ? 0 : items.sales.tax_amt;

					let sls_total_amount 	= typeof items.sales === 'undefined' || typeof items.sales.total_amount === 'undefined' ? 0 : isNaN(parseFloat(items.sales.total_amount)) ? 0 : items.sales.total_amount;

					let sls_round_off 		= typeof items.sales === 'undefined' || typeof items.sales.round_off === 'undefined' ? 0 : isNaN(parseFloat(items.sales.round_off)) ? 0 : items.sales.round_off;

					let ret_category_name 	= typeof items.return === 'undefined' || typeof items.return.category_name === 'undefined' ? '' : items.return.category_name;

					let ret_hsn_code 		= typeof items.return === 'undefined' || typeof items.return.hsn_code === 'undefined' ? '' : items.return.hsn_code;

					let ret_starting_bill  	= typeof items.return === 'undefined' || typeof items.return.starting_bill === 'undefined' ? '' : items.return.starting_bill;

					let ret_ending_bill  	= typeof items.return === 'undefined' || typeof items.return.ending_bill === 'undefined' ? '' : items.return.ending_bill;

					let ret_piece 			= typeof items.return === 'undefined' || typeof items.return.piece === 'undefined' ? 0 : isNaN(parseFloat(items.return.piece)) ? 0 : items.return.piece;

					let ret_gross_wt 		= typeof items.return === 'undefined' || typeof items.return.gross_wt === 'undefined' ? 0 : isNaN(parseFloat(items.return.gross_wt)) ? 0 : items.return.gross_wt;

					let ret_net_wt 			= typeof items.return === 'undefined' || typeof items.return.net_wt === 'undefined' ? 0 : isNaN(parseFloat(items.return.net_wt)) ? 0 : items.return.net_wt;

					let ret_taxable_amt 		= typeof items.return === 'undefined' || typeof items.return.taxable_amt === 'undefined' ? 0 : isNaN(parseFloat(items.return.taxable_amt)) ? 0 : items.return.taxable_amt;

					let ret_total_sgst 		= typeof items.return === 'undefined' || typeof items.return.total_sgst === 'undefined' ? 0 : isNaN(parseFloat(items.return.total_sgst)) ? 0 : items.return.total_sgst;

					let ret_total_cgst 		= typeof items.return === 'undefined' || typeof items.return.total_cgst === 'undefined' ? 0 : isNaN(parseFloat(items.return.total_cgst)) ? 0 : items.return.total_cgst;

					let ret_total_igst 		= typeof items.return === 'undefined' || typeof items.return.total_igst === 'undefined' ? 0 : isNaN(parseFloat(items.return.total_igst)) ? 0 : items.return.total_igst;

					let ret_tax_amt 			= typeof items.return === 'undefined' || typeof items.return.tax_amt === 'undefined' ? 0 : isNaN(parseFloat(items.return.tax_amt)) ? 0 : items.return.tax_amt;

					let ret_total_amount 	= typeof items.return === 'undefined' || typeof items.return.total_amount === 'undefined' ? 0 : isNaN(parseFloat(items.return.total_amount)) ? 0 : items.return.total_amount;

					let ret_round_off 		= typeof items.return === 'undefined' || typeof items.return.round_off === 'undefined' ? 0 : isNaN(parseFloat(items.return.round_off)) ? 0 : items.return.round_off;

				overseas_pcs+=parseFloat(sls_piece)-parseFloat(ret_piece);

				overseas_gwt+=parseFloat(sls_gross_wt)-parseFloat(ret_gross_wt);

				overseas_taxable+=parseFloat(sls_taxable_amt)-parseFloat(ret_taxable_amt);

				overseas_sgst+=parseFloat(sls_total_sgst)-parseFloat(ret_total_sgst);

				overseas_cgst+=parseFloat(sls_total_cgst)-parseFloat(ret_total_cgst);

				overseas_igst+=parseFloat(sls_total_igst)-parseFloat(ret_total_igst);

				overseas_tax+=parseFloat(sls_tax_amt)-parseFloat(ret_tax_amt);

				overseas_tot_amount+=parseFloat(sls_total_amount)-parseFloat(ret_total_amount);

				overseas_round_off+=parseFloat(sls_round_off)-parseFloat(ret_round_off);

				trHTML+='<tr>'

				+'<td><strong>'+sls_category_name+'(Sales)</strong></td>'

				   +'<td>'+(sls_starting_bill+' - '+sls_ending_bill)+'</td>'

				   +'<td>'+sls_piece+'</td>'

				   +'<td>'+sls_hsn_code+'</td>'

				   +'<td>'+sls_gross_wt+'</td>'

				   // +'<td>'+items.net_wt+'</td>'

				   +'<td>'+money_format_india(parseFloat(sls_taxable_amt).toFixed(2))+'</td>'

				   +'<td>'+money_format_india(parseFloat(sls_total_sgst).toFixed(2))+'</td>'

				   +'<td>'+money_format_india(parseFloat(sls_total_cgst).toFixed(2))+'</td>'

				   +'<td>'+money_format_india(parseFloat(sls_total_igst).toFixed(2))+'</td>'

				   +'<td>'+money_format_india(parseFloat(sls_tax_amt).toFixed(2))+'</td>'

				   +'<td>'+parseFloat(sls_round_off).toFixed(2)+'</td>'

				   +'<td>'+money_format_india(parseFloat(sls_total_amount).toFixed(2))+'</td>'

				   +'</tr>';

					trHTML+='<tr>'

				   +'<td><strong>'+ret_category_name+'(Return)</strong></td>'

				   +'<td>'+(ret_starting_bill+' - '+ret_ending_bill)+'</td>'

				   +'<td>'+ret_piece+'</td>'

				   +'<td>'+ret_hsn_code+'</td>'

				   +'<td>'+parseFloat(ret_gross_wt).toFixed(3)+'</td>'

				   // +'<td>'+items.net_wt+'</td>'

				   +'<td>'+money_format_india(parseFloat(ret_taxable_amt).toFixed(2))+'</td>'

				   +'<td>'+money_format_india(parseFloat(ret_total_sgst).toFixed(2))+'</td>'

				   +'<td>'+money_format_india(parseFloat(ret_total_cgst).toFixed(2))+'</td>'

				   +'<td>'+money_format_india(parseFloat(ret_total_igst).toFixed(2))+'</td>'

				   +'<td>'+money_format_india(parseFloat(ret_tax_amt).toFixed(2))+'</td>'

				   +'<td>'+parseFloat(ret_round_off).toFixed(2)+'</td>'

				   +'<td>'+money_format_india(parseFloat(ret_total_amount).toFixed(2))+'</td>'

				   +'</tr>';

					trHTML+='<tr class="sales_return_total">'

				   +'<td><strong>Total(Sales-Return)</strong></td>'

				   +'<td>'+(sls_starting_bill+' - '+sls_ending_bill)+'</td>'

				   +'<td>'+(parseFloat(sls_piece)-parseFloat(ret_piece))+'</td>'

				   +'<td>'+(sls_hsn_code == '' ? ret_hsn_code : sls_hsn_code)+'</td>'

				   +'<td>'+parseFloat(parseFloat(sls_gross_wt)-parseFloat(ret_gross_wt)).toFixed(3)+'</td>'

				   // +'<td>'+items.net_wt+'</td>'

				   +'<td>'+money_format_india((parseFloat(sls_taxable_amt)-parseFloat(ret_taxable_amt)).toFixed(2))+'</td>'

				   +'<td>'+money_format_india((parseFloat(sls_total_sgst)-parseFloat(ret_total_sgst)).toFixed(2))+'</td>'

				   +'<td>'+money_format_india((parseFloat(sls_total_cgst)-parseFloat(ret_total_cgst)).toFixed(2))+'</td>'

				   +'<td>'+money_format_india((parseFloat(sls_total_igst)-parseFloat(ret_total_igst)).toFixed(2))+'</td>'

				   +'<td>'+money_format_india((parseFloat(sls_tax_amt)-parseFloat(ret_tax_amt)).toFixed(2))+'</td>'

				   +'<td>'+parseFloat(parseFloat(sls_round_off)-parseFloat(ret_round_off)).toFixed(2)+'</td>'

				   +'<td>'+money_format_india((parseFloat(sls_total_amount)-parseFloat(ret_total_amount)).toFixed(2))+'</td>'

				   +'</tr>';

				});

				trHTML+='<tr>'

				+'<td><strong>SUB TOTAL</strong></td>'

				+'<td></td>'

				+'<td><strong>'+overseas_pcs+'</strong></td>'

				+'<td></td>'

				+'<td><strong>'+parseFloat(overseas_gwt).toFixed(3)+'</strong></td>'

				//  +'<td><strong></strong></td>'

				+'<td><strong>'+money_format_india(parseFloat(overseas_taxable).toFixed(2))+'</strong></td>'

				+'<td><strong>'+money_format_india(parseFloat(overseas_sgst).toFixed(2))+'</strong></td>'

				+'<td><strong>'+money_format_india(parseFloat(overseas_cgst).toFixed(2))+'</strong></td>'

				+'<td><strong>'+money_format_india(parseFloat(overseas_igst).toFixed(2))+'</strong></td>'

				+'<td><strong>'+money_format_india(parseFloat(overseas_tax).toFixed(2))+'</strong></td>'

				+'<td><strong>'+parseFloat(overseas_round_off).toFixed(2)+'</strong></td>'

				+'<td><strong>'+money_format_india(parseFloat(overseas_tot_amount).toFixed(2))+'</strong></td>'

				 +'</tr>';

			}

		if(Object.keys(customer_bills).length>0 || Object.keys(company_bills).length>0 || Object.keys(overseas).length>0){

			trHTML+='<tr>'

			+'<td><strong>GRAND TOTAL</strong></td>'

			+'<td></td>'

			+'<td><strong>'+(cus_pcs+cmp_pcs+overseas_pcs)+'</strong></td>'

			+'<td></td>'

			+'<td><strong>'+parseFloat(cus_gwt+cmp_gwt+overseas_gwt).toFixed(3)+'</strong></td>'

			// +'<td><strong>'+parseFloat(cus_nwt+cmp_nwt).toFixed(3)+'</strong></td>'

			+'<td><strong>'+money_format_india(parseFloat(cus_taxable_amt+cmp_taxable_amt+overseas_taxable).toFixed(2))+'</strong></td>'

			+'<td><strong>'+money_format_india(parseFloat(cus_sgst+cmp_sgst+overseas_sgst).toFixed(2))+'</strong></td>'

			+'<td><strong>'+money_format_india(parseFloat(cus_cgst+cmp_cgst+overseas_cgst).toFixed(2))+'</strong></td>'

			+'<td><strong>'+money_format_india(parseFloat(cus_igst+cmp_igst+overseas_igst).toFixed(2))+'</strong></td>'

			+'<td><strong>'+money_format_india(parseFloat(cus_gst+cmp_gst+overseas_tax).toFixed(2))+'</strong></td>'

			+'<td><strong>'+parseFloat(cus_round_off+cmp_round_off+overseas_round_off).toFixed(2)+'</strong></td>'

			+'<td><strong>'+money_format_india(parseFloat(cus_total_amt+cmp_total_amt+overseas_tot_amount).toFixed(2))+'</strong></td>'

			+'</tr>';

		}

		if(repair.length>0)

		{

		   trHTML+='<tr>'

				   +'<td><strong>REPAIR CHARGES</strong></td>'

				   +'<td></td>'

				   +'<td></td>'

				   +'<td></td>'

				   +'<td></td>'

				   // +'<td></td>'

				   +'<td></td>'

				   +'<td></td>'

				   +'<td></td>'

				   +'<td></td>'

				   +'<td></td>'

				   +'<td></td>'

				   +'<td></td>'

				   +'</tr>';

		   $.each(repair,function(key,items){

			   rep_pcs+=parseFloat(items.pcs);

			   rep_gwt+=parseFloat(items.weight);

			   rep_taxable+=parseFloat(items.tot_taxable);

			   rep_sgst+=parseFloat(items.tot_sgst);

			   rep_cgst+=parseFloat(items.tot_cgst);

			   rep_igst+=parseFloat(items.tot_igst);

			   rep_tax+=parseFloat(items.tot_tax);

			   rep_tot_amount+=parseFloat(items.amount);

			   rep_round_off+=parseFloat(items.round_off);

			   trHTML+='<tr>'

				+'<td><strong>'+items.name+'</strong></td>'

				   +'<td>'+(items.starting_bill+' - '+items.ending_bill)+'</td>'

				   +'<td>'+items.pcs+'</td>'

				   +'<td>'+items.hsn_code+'</td>'

				   +'<td>'+items.weight+'</td>'

				   // +'<td></td>'

				   +'<td>'+money_format_india(items.tot_taxable)+'</td>'

				   +'<td>'+money_format_india(items.tot_sgst)+'</td>'

				   +'<td>'+money_format_india(items.tot_cgst)+'</td>'

				   +'<td>'+money_format_india(items.tot_igst)+'</td>'

				   +'<td>'+money_format_india(items.tot_tax)+'</td>'

				   +'<td>'+parseFloat(items.round_off).toFixed(2)+'</td>'

				   +'<td>'+money_format_india(items.amount)+'</td>'

				   +'</tr>';

		   });

		   trHTML+='<tr>'

				   +'<td><strong>GRANT TOTAL</strong></td>'

				   +'<td></td>'

				   +'<td><strong>'+rep_pcs+'</strong></td>'

				   +'<td></td>'

				   +'<td><strong>'+parseFloat(rep_gwt).toFixed(3)+'</strong></td>'

				   // +'<td><strong></strong></td>'

				   +'<td><strong>'+money_format_india(parseFloat(rep_taxable).toFixed(2))+'</strong></td>'

				   +'<td><strong>'+money_format_india(parseFloat(rep_sgst).toFixed(2))+'</strong></td>'

				   +'<td><strong>'+money_format_india(parseFloat(rep_cgst).toFixed(2))+'</strong></td>'

				   +'<td><strong>'+money_format_india(parseFloat(rep_igst).toFixed(2))+'</strong></td>'

				   +'<td><strong>'+money_format_india(parseFloat(rep_tax).toFixed(2))+'</strong></td>'

				   +'<td><strong>'+parseFloat(rep_round_off).toFixed(2)+'</strong></td>'

				   +'<td><strong>'+money_format_india(parseFloat(rep_tot_amount).toFixed(2))+'</strong></td>'

			+'</tr>';

		   }

	   $('#gst_abstract_list > tbody').html(trHTML);

		if(!$.fn.DataTable.isDataTable('#gst_abstract_list'))

		{

				oTable = $('#gst_abstract_list').dataTable({

				"bSort": false,

				"bDestroy": true,

				"bInfo": true,

				"scrollX":'100%',

				"paging": false,

				"dom": 'Bfrtip',

				"bAutoWidth": false,

				"responsive": true,

				"buttons": [

				{

				extend: 'print',

				footer: false,

				title: '',

				messageTop: title,

			orientation: 'landscape',

				customize: function(win)

				{

				var last = null;

				var current = null;

				var bod = [];

				var css = '@page { size: landscape; }',

				head = win.document.head || win.document.getElementsByTagName('head')[0],

				style = win.document.createElement('style');

				style.type = 'text/css';

				style.media = 'print';

				if (style.styleSheet)

				{

				style.styleSheet.cssText = css;

				}

				else

				{

				style.appendChild(win.document.createTextNode(css));

				}

				head.appendChild(style);

				},

				exportOptions: {

				columns: ':visible',

				stripHtml: false

				}

				},

				{

				extend:'excel',

				footer: true,

				title: 'GST Abstract Report',

				}

				],

				});

	   }

				$("div.overlay").css("display", "none");

},

 error:function(error)

 {

		$("div.overlay").css("display", "none");

 }

 });

}*/

function get_gst_abstract_with_return_details() {

	/*var branch_name=($('#branch_name').val()!='' && $('#branch_name').val()!=undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());*/

	var report_type = $('#sale_ret_filter').find(':selected').text();

	var branch_name = $("#branch_select option:selected").text();

	var company_name = $('#company_name').val();

	var from_date = $('#rpt_from_date').html();

	var to_date = $('#rpt_to_date').html();

	var report_name = "GST ABSTRACT WITH RETURN REPORT";

	var optional = '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	console.log(title);

	//var title="<b><span style='font-size:15pt;margin-left:50%;'>"+company_name+"</span></b><b><span style='font-size:15pt;'></span></b></br>"+"<span style=font-size:13pt;margin-left:25%;>&nbsp;&nbsp;GST ABSTRACT SALES RETURN "+($("#branch_select").val()!='' ? "Cost Center:"+branch_name+" ":'')+"</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/gst_abstract_with_return/ajax?nocache=" + my_Date.getUTCSeconds(),

		dataType: "JSON",

		data: { 'group_by': $('#gst_group_by').val(), 'id_branch': $('#branch_select').val(), 'from_date': $('#rpt_from_date').html(), 'to_date': $('#rpt_to_date').html(), 'report_type': $('#report_type').val(), 'gst_filter': $('#gst_filter').val(), 'sale_ret_filter': $('#sale_ret_filter').val(), 'id_metal': $('#metal').val(), 'tax_group': $('#tax_group').val(), 'hsn_code': $('#hsn_code').val(), 'category': $('#category').val() },

		type: "POST",

		success: function (data) {

			var company_bills = data.list.B2B;

			var customer_bills = data.list.B2C;

			var sales_transfer = data.list.sales_transfer;

			var repair = data.list.repair;

			var overseas = data.list.overseas;

			var cmp_round_off = 0;

			var cus_round_off = 0;

			var rep_round_off = 0;

			var overseas_round_off = 0;

			var trHTML = '';

			$("#gst_abstract_list > tbody > tr").remove();

			$('#gst_abstract_list').dataTable().fnClearTable();

			$('#gst_abstract_list').dataTable().fnDestroy();

			var cmp_pcs = 0;

			var cmp_gwt = 0;

			var cmp_nwt = 0;

			var cmp_sgst = 0;

			var cmp_cgst = 0;

			var cmp_igst = 0;

			var cmp_gst = 0;

			var cmp_total_amt = 0;

			var cmp_taxable_amt = 0;

			var cus_pcs = 0;

			var cus_gwt = 0;

			var cus_nwt = 0;

			var cus_sgst = 0;

			var cus_cgst = 0;

			var cus_igst = 0;

			var cus_gst = 0;

			var cus_total_amt = 0;

			var cus_taxable_amt = 0;

			var rep_pcs = 0;

			var rep_gwt = 0;

			var rep_taxable = 0;

			var rep_sgst = 0;

			var rep_cgst = 0;

			var rep_igst = 0;

			var rep_tax = 0;

			var rep_tot_amount = 0;

			var overseas_pcs = 0;

			var overseas_gwt = 0;

			var overseas_taxable = 0;

			var overseas_sgst = 0;

			var overseas_cgst = 0;

			var overseas_igst = 0;

			var overseas_tax = 0;

			var overseas_tot_amount = 0;

			var st_pcs = 0;

			var st_gwt = 0;

			var st_taxable = 0;

			var st_sgst = 0;

			var st_cgst = 0;

			var st_igst = 0;

			var st_tax = 0;

			var st_tot_amount = 0;

			var st_round_off = 0;

			console.log("company_bills", Object.keys(company_bills).length);

			console.log("customer_bills", Object.keys(customer_bills).length);

			console.log("overseas", Object.keys(overseas).length);

			if (Object.keys(company_bills).length > 0) {

				trHTML += '<tr>'

					+ '<td><strong>B2B BILLS</strong></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					// +'<td></td>'s

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '</tr>';

				$.each(company_bills, function (key, items) {

					let sls_category_name = typeof items.sales === 'undefined' || typeof items.sales.category_name === 'undefined' ? '' : items.sales.category_name;

					let sls_hsn_code = typeof items.sales === 'undefined' || typeof items.sales.hsn_code === 'undefined' ? '' : items.sales.hsn_code;

					let sls_starting_bill = typeof items.sales === 'undefined' || typeof items.sales.starting_bill === 'undefined' ? '' : items.sales.starting_bill;

					let sls_ending_bill = typeof items.sales === 'undefined' || typeof items.sales.ending_bill === 'undefined' ? '' : items.sales.ending_bill;

					let sls_piece = typeof items.sales === 'undefined' || typeof items.sales.piece === 'undefined' ? 0 : isNaN(parseFloat(items.sales.piece)) ? 0 : items.sales.piece;

					let sls_gross_wt = typeof items.sales === 'undefined' || typeof items.sales.gross_wt === 'undefined' ? 0 : isNaN(parseFloat(items.sales.gross_wt)) ? 0 : items.sales.gross_wt;

					let sls_net_wt = typeof items.sales === 'undefined' || typeof items.sales.net_wt === 'undefined' ? 0 : isNaN(parseFloat(items.sales.net_wt)) ? 0 : items.sales.net_wt;

					let sls_taxable_amt = typeof items.sales === 'undefined' || typeof items.sales.taxable_amt === 'undefined' ? 0 : isNaN(parseFloat(items.sales.taxable_amt)) ? 0 : items.sales.taxable_amt;

					let sls_total_sgst = typeof items.sales === 'undefined' || typeof items.sales.total_sgst === 'undefined' ? 0 : isNaN(parseFloat(items.sales.total_sgst)) ? 0 : items.sales.total_sgst;

					let sls_total_cgst = typeof items.sales === 'undefined' || typeof items.sales.total_cgst === 'undefined' ? 0 : isNaN(parseFloat(items.sales.total_cgst)) ? 0 : items.sales.total_cgst;

					let sls_total_igst = typeof items.sales === 'undefined' || typeof items.sales.total_igst === 'undefined' ? 0 : isNaN(parseFloat(items.sales.total_igst)) ? 0 : items.sales.total_igst;

					let sls_tax_amt = typeof items.sales === 'undefined' || typeof items.sales.tax_amt === 'undefined' ? 0 : isNaN(parseFloat(items.sales.tax_amt)) ? 0 : items.sales.tax_amt;

					let sls_total_amount = typeof items.sales === 'undefined' || typeof items.sales.total_amount === 'undefined' ? 0 : isNaN(parseFloat(items.sales.total_amount)) ? 0 : items.sales.total_amount;

					let sls_round_off = typeof items.sales === 'undefined' || typeof items.sales.round_off === 'undefined' ? 0 : isNaN(parseFloat(items.sales.round_off)) ? 0 : items.sales.round_off;

					let ret_category_name = typeof items.return === 'undefined' || typeof items.return.category_name === 'undefined' ? '' : items.return.category_name;

					let ret_hsn_code = typeof items.return === 'undefined' || typeof items.return.hsn_code === 'undefined' ? '' : items.return.hsn_code;

					let ret_starting_bill = typeof items.return === 'undefined' || typeof items.return.starting_bill === 'undefined' ? '' : items.return.starting_bill;

					let ret_ending_bill = typeof items.return === 'undefined' || typeof items.return.ending_bill === 'undefined' ? '' : items.return.ending_bill;

					let ret_piece = typeof items.return === 'undefined' || typeof items.return.piece === 'undefined' ? 0 : isNaN(parseFloat(items.return.piece)) ? 0 : items.return.piece;

					let ret_gross_wt = typeof items.return === 'undefined' || typeof items.return.gross_wt === 'undefined' ? 0 : isNaN(parseFloat(items.return.gross_wt)) ? 0 : items.return.gross_wt;

					let ret_net_wt = typeof items.return === 'undefined' || typeof items.return.net_wt === 'undefined' ? 0 : isNaN(parseFloat(items.return.net_wt)) ? 0 : items.return.net_wt;

					let ret_taxable_amt = typeof items.return === 'undefined' || typeof items.return.taxable_amt === 'undefined' ? 0 : isNaN(parseFloat(items.return.taxable_amt)) ? 0 : items.return.taxable_amt;

					let ret_total_sgst = typeof items.return === 'undefined' || typeof items.return.total_sgst === 'undefined' ? 0 : isNaN(parseFloat(items.return.total_sgst)) ? 0 : items.return.total_sgst;

					let ret_total_cgst = typeof items.return === 'undefined' || typeof items.return.total_cgst === 'undefined' ? 0 : isNaN(parseFloat(items.return.total_cgst)) ? 0 : items.return.total_cgst;

					let ret_total_igst = typeof items.return === 'undefined' || typeof items.return.total_igst === 'undefined' ? 0 : isNaN(parseFloat(items.return.total_igst)) ? 0 : items.return.total_igst;

					let ret_tax_amt = typeof items.return === 'undefined' || typeof items.return.tax_amt === 'undefined' ? 0 : isNaN(parseFloat(items.return.tax_amt)) ? 0 : items.return.tax_amt;

					let ret_total_amount = typeof items.return === 'undefined' || typeof items.return.total_amount === 'undefined' ? 0 : isNaN(parseFloat(items.return.total_amount)) ? 0 : items.return.total_amount;

					let ret_round_off = typeof items.return === 'undefined' || typeof items.return.round_off === 'undefined' ? 0 : isNaN(parseFloat(items.return.round_off)) ? 0 : items.return.round_off;

					cmp_pcs += parseFloat(sls_piece) - parseFloat(ret_piece);

					cmp_gwt += parseFloat(sls_gross_wt) - parseFloat(ret_gross_wt);

					cmp_nwt += parseFloat(sls_net_wt) - parseFloat(ret_net_wt);

					cmp_taxable_amt += parseFloat(sls_taxable_amt) - parseFloat(ret_taxable_amt);

					cmp_sgst += parseFloat(sls_total_sgst) - parseFloat(ret_total_sgst);

					cmp_cgst += parseFloat(sls_total_cgst) - parseFloat(ret_total_cgst);

					cmp_igst += parseFloat(sls_total_igst) - parseFloat(ret_total_igst);

					cmp_gst += parseFloat(sls_tax_amt) - parseFloat(ret_tax_amt);

					cmp_total_amt += parseFloat(sls_total_amount) - parseFloat(ret_total_amount);

					cmp_round_off += parseFloat(sls_round_off) - parseFloat(ret_round_off);

					trHTML += '<tr>'

						+ '<td><strong>' + sls_category_name + '(Sales)</strong></td>'

						+ '<td>' + (sls_starting_bill + ' - ' + sls_ending_bill) + '</td>'

						+ '<td>' + sls_piece + '</td>'

						+ '<td>' + sls_hsn_code + '</td>'

						+ '<td>' + sls_gross_wt + '</td>'

						// +'<td>'+items.net_wt+'</td>'

						+ '<td>' + money_format_india(parseFloat(sls_taxable_amt).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(sls_total_sgst).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(sls_total_cgst).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(sls_total_igst).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(sls_tax_amt).toFixed(2)) + '</td>'

						+ '<td>' + parseFloat(sls_round_off).toFixed(2) + '</td>'

						+ '<td>' + money_format_india(parseFloat(sls_total_amount).toFixed(2)) + '</td>'

						+ '</tr>';

					trHTML += '<tr>'

						+ '<td><strong>' + ret_category_name + '(Return)</strong></td>'

						+ '<td>' + (ret_starting_bill + ' - ' + ret_ending_bill) + '</td>'

						+ '<td>' + ret_piece + '</td>'

						+ '<td>' + ret_hsn_code + '</td>'

						+ '<td>' + parseFloat(ret_gross_wt).toFixed(3) + '</td>'

						// +'<td>'+items.net_wt+'</td>'

						+ '<td>' + money_format_india(parseFloat(ret_taxable_amt).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(ret_total_sgst).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(ret_total_cgst).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(ret_total_igst).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(ret_tax_amt).toFixed(2)) + '</td>'

						+ '<td>' + parseFloat(ret_round_off).toFixed(2) + '</td>'

						+ '<td>' + money_format_india(parseFloat(ret_total_amount).toFixed(2)) + '</td>'

						+ '</tr>';

					trHTML += '<tr class="sales_return_total">'

						+ '<td><strong>Total(Sales-Return)</strong></td>'

						+ '<td>' + (sls_starting_bill + ' - ' + sls_ending_bill) + '</td>'

						+ '<td>' + (parseFloat(sls_piece) - parseFloat(ret_piece)) + '</td>'

						+ '<td>' + (sls_hsn_code == '' ? ret_hsn_code : sls_hsn_code) + '</td>'

						+ '<td>' + parseFloat(parseFloat(sls_gross_wt) - parseFloat(ret_gross_wt)).toFixed(3) + '</td>'

						// +'<td>'+items.net_wt+'</td>'

						+ '<td>' + money_format_india((parseFloat(sls_taxable_amt) - parseFloat(ret_taxable_amt)).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india((parseFloat(sls_total_sgst) - parseFloat(ret_total_sgst)).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india((parseFloat(sls_total_cgst) - parseFloat(ret_total_cgst)).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india((parseFloat(sls_total_igst) - parseFloat(ret_total_igst)).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india((parseFloat(sls_tax_amt) - parseFloat(ret_tax_amt)).toFixed(2)) + '</td>'

						+ '<td>' + parseFloat(parseFloat(sls_round_off) - parseFloat(ret_round_off)).toFixed(2) + '</td>'

						+ '<td>' + money_format_india((parseFloat(sls_total_amount) - parseFloat(ret_total_amount)).toFixed(2)) + '</td>'

						+ '</tr>';

				});

				trHTML += '<tr>'

					+ '<td><strong>SUB TOTAL</strong></td>'

					+ '<td></td>'

					+ '<td><strong>' + cmp_pcs + '</td>'

					+ '<td></td>'

					+ '<td><strong>' + parseFloat(cmp_gwt).toFixed(3) + '</strong></td>'

					// +'<td><strong>'+parseFloat(cmp_nwt).toFixed(3)+'</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(cmp_taxable_amt).toFixed(2)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(cmp_sgst).toFixed(2)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(cmp_cgst).toFixed(2)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(cmp_igst).toFixed(2)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(cmp_gst).toFixed(2)) + '</strong></td>'

					+ '<td><strong>' + parseFloat(cmp_round_off).toFixed(2) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(cmp_total_amt).toFixed(2)) + '</strong></td>'

					+ '</tr>';

			}

			if (Object.keys(customer_bills).length > 0) {

				trHTML += '<tr>'

					+ '<td><strong>B2C BILLS</strong></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					// +'<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '</tr>';

				$.each(customer_bills, function (key, items) {

					let sls_category_name = typeof items.sales === 'undefined' || typeof items.sales.category_name === 'undefined' ? '' : items.sales.category_name;

					let sls_hsn_code = typeof items.sales === 'undefined' || typeof items.sales.hsn_code === 'undefined' ? '' : items.sales.hsn_code;

					let sls_starting_bill = typeof items.sales === 'undefined' || typeof items.sales.starting_bill === 'undefined' ? '' : items.sales.starting_bill;

					let sls_ending_bill = typeof items.sales === 'undefined' || typeof items.sales.ending_bill === 'undefined' ? '' : items.sales.ending_bill;

					let sls_piece = typeof items.sales === 'undefined' || typeof items.sales.piece === 'undefined' ? 0 : isNaN(parseFloat(items.sales.piece)) ? 0 : items.sales.piece;

					let sls_gross_wt = typeof items.sales === 'undefined' || typeof items.sales.gross_wt === 'undefined' ? 0 : isNaN(parseFloat(items.sales.gross_wt)) ? 0 : items.sales.gross_wt;

					let sls_net_wt = typeof items.sales === 'undefined' || typeof items.sales.net_wt === 'undefined' ? 0 : isNaN(parseFloat(items.sales.net_wt)) ? 0 : items.sales.net_wt;

					let sls_taxable_amt = typeof items.sales === 'undefined' || typeof items.sales.taxable_amt === 'undefined' ? 0 : isNaN(parseFloat(items.sales.taxable_amt)) ? 0 : items.sales.taxable_amt;

					let sls_total_sgst = typeof items.sales === 'undefined' || typeof items.sales.total_sgst === 'undefined' ? 0 : isNaN(parseFloat(items.sales.total_sgst)) ? 0 : items.sales.total_sgst;

					let sls_total_cgst = typeof items.sales === 'undefined' || typeof items.sales.total_cgst === 'undefined' ? 0 : isNaN(parseFloat(items.sales.total_cgst)) ? 0 : items.sales.total_cgst;

					let sls_total_igst = typeof items.sales === 'undefined' || typeof items.sales.total_igst === 'undefined' ? 0 : isNaN(parseFloat(items.sales.total_igst)) ? 0 : items.sales.total_igst;

					let sls_tax_amt = typeof items.sales === 'undefined' || typeof items.sales.tax_amt === 'undefined' ? 0 : isNaN(parseFloat(items.sales.tax_amt)) ? 0 : items.sales.tax_amt;

					let sls_total_amount = typeof items.sales === 'undefined' || typeof items.sales.total_amount === 'undefined' ? 0 : isNaN(parseFloat(items.sales.total_amount)) ? 0 : items.sales.total_amount;

					let sls_round_off = typeof items.sales === 'undefined' || typeof items.sales.round_off === 'undefined' ? 0 : isNaN(parseFloat(items.sales.round_off)) ? 0 : items.sales.round_off;

					let ret_category_name = typeof items.return === 'undefined' || typeof items.return.category_name === 'undefined' ? '' : items.return.category_name;

					let ret_hsn_code = typeof items.return === 'undefined' || typeof items.return.hsn_code === 'undefined' ? '' : items.return.hsn_code;

					let ret_starting_bill = typeof items.return === 'undefined' || typeof items.return.starting_bill === 'undefined' ? '' : items.return.starting_bill;

					let ret_ending_bill = typeof items.return === 'undefined' || typeof items.return.ending_bill === 'undefined' ? '' : items.return.ending_bill;

					let ret_piece = typeof items.return === 'undefined' || typeof items.return.piece === 'undefined' ? 0 : isNaN(parseFloat(items.return.piece)) ? 0 : items.return.piece;

					let ret_gross_wt = typeof items.return === 'undefined' || typeof items.return.gross_wt === 'undefined' ? 0 : isNaN(parseFloat(items.return.gross_wt)) ? 0 : items.return.gross_wt;

					let ret_net_wt = typeof items.return === 'undefined' || typeof items.return.net_wt === 'undefined' ? 0 : isNaN(parseFloat(items.return.net_wt)) ? 0 : items.return.net_wt;

					let ret_taxable_amt = typeof items.return === 'undefined' || typeof items.return.taxable_amt === 'undefined' ? 0 : isNaN(parseFloat(items.return.taxable_amt)) ? 0 : items.return.taxable_amt;

					let ret_total_sgst = typeof items.return === 'undefined' || typeof items.return.total_sgst === 'undefined' ? 0 : isNaN(parseFloat(items.return.total_sgst)) ? 0 : items.return.total_sgst;

					let ret_total_cgst = typeof items.return === 'undefined' || typeof items.return.total_cgst === 'undefined' ? 0 : isNaN(parseFloat(items.return.total_cgst)) ? 0 : items.return.total_cgst;

					let ret_total_igst = typeof items.return === 'undefined' || typeof items.return.total_igst === 'undefined' ? 0 : isNaN(parseFloat(items.return.total_igst)) ? 0 : items.return.total_igst;

					let ret_tax_amt = typeof items.return === 'undefined' || typeof items.return.tax_amt === 'undefined' ? 0 : isNaN(parseFloat(items.return.tax_amt)) ? 0 : items.return.tax_amt;

					let ret_total_amount = typeof items.return === 'undefined' || typeof items.return.total_amount === 'undefined' ? 0 : isNaN(parseFloat(items.return.total_amount)) ? 0 : items.return.total_amount;

					let ret_round_off = typeof items.return === 'undefined' || typeof items.return.round_off === 'undefined' ? 0 : isNaN(parseFloat(items.return.round_off)) ? 0 : items.return.round_off;

					cus_pcs += parseFloat(sls_piece) - parseFloat(ret_piece);

					cus_gwt += parseFloat(sls_gross_wt) - parseFloat(ret_gross_wt);

					cus_nwt += parseFloat(sls_net_wt) - parseFloat(ret_net_wt);

					cus_taxable_amt += parseFloat(sls_taxable_amt) - parseFloat(ret_taxable_amt);

					cus_sgst += parseFloat(sls_total_sgst) - parseFloat(ret_total_sgst);

					cus_cgst += parseFloat(sls_total_cgst) - parseFloat(ret_total_cgst);

					cus_igst += parseFloat(sls_total_igst) - parseFloat(ret_total_igst);

					cus_gst += parseFloat(sls_tax_amt) - parseFloat(ret_tax_amt);

					cus_total_amt += parseFloat(sls_total_amount) - parseFloat(ret_total_amount);

					cus_round_off += parseFloat(sls_round_off) - parseFloat(ret_round_off);

					trHTML += '<tr>'

						+ '<td><strong>' + sls_category_name + '(Sales)</strong></td>'

						+ '<td>' + (sls_starting_bill + ' - ' + sls_ending_bill) + '</td>'

						+ '<td>' + sls_piece + '</td>'

						+ '<td>' + sls_hsn_code + '</td>'

						+ '<td>' + sls_gross_wt + '</td>'

						// +'<td>'+items.net_wt+'</td>'

						+ '<td>' + money_format_india(parseFloat(sls_taxable_amt).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(sls_total_sgst).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(sls_total_cgst).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(sls_total_igst).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(sls_tax_amt).toFixed(2)) + '</td>'

						+ '<td>' + parseFloat(sls_round_off).toFixed(2) + '</td>'

						+ '<td>' + money_format_india(parseFloat(sls_total_amount).toFixed(2)) + '</td>'

						+ '</tr>';

					trHTML += '<tr>'

						+ '<td><strong>' + ret_category_name + '(Return)</strong></td>'

						+ '<td>' + (ret_starting_bill + ' - ' + ret_ending_bill) + '</td>'

						+ '<td>' + ret_piece + '</td>'

						+ '<td>' + ret_hsn_code + '</td>'

						+ '<td>' + parseFloat(ret_gross_wt).toFixed(3) + '</td>'

						// +'<td>'+items.net_wt+'</td>'

						+ '<td>' + money_format_india(parseFloat(ret_taxable_amt).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(ret_total_sgst).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(ret_total_cgst).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(ret_total_igst).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(ret_tax_amt).toFixed(2)) + '</td>'

						+ '<td>' + parseFloat(ret_round_off).toFixed(2) + '</td>'

						+ '<td>' + money_format_india(parseFloat(ret_total_amount).toFixed(2)) + '</td>'

						+ '</tr>';

					trHTML += '<tr class="sales_return_total">'

						+ '<td><strong>Total(Sales-Return)</strong></td>'

						+ '<td>' + (sls_starting_bill + ' - ' + sls_ending_bill) + '</td>'

						+ '<td>' + (parseFloat(sls_piece) - parseFloat(ret_piece)) + '</td>'

						+ '<td>' + (sls_hsn_code == '' ? ret_hsn_code : sls_hsn_code) + '</td>'

						+ '<td>' + parseFloat(parseFloat(sls_gross_wt) - parseFloat(ret_gross_wt)).toFixed(3) + '</td>'

						// +'<td>'+items.net_wt+'</td>'

						+ '<td>' + money_format_india((parseFloat(sls_taxable_amt) - parseFloat(ret_taxable_amt)).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india((parseFloat(sls_total_sgst) - parseFloat(ret_total_sgst)).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india((parseFloat(sls_total_cgst) - parseFloat(ret_total_cgst)).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india((parseFloat(sls_total_igst) - parseFloat(ret_total_igst)).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india((parseFloat(sls_tax_amt) - parseFloat(ret_tax_amt)).toFixed(2)) + '</td>'

						+ '<td>' + parseFloat(parseFloat(sls_round_off) - parseFloat(ret_round_off)).toFixed(2) + '</td>'

						+ '<td>' + money_format_india((parseFloat(sls_total_amount) - parseFloat(ret_total_amount)).toFixed(2)) + '</td>'

						+ '</tr>';

				});

				trHTML += '<tr>'

					+ '<td><strong>SUB TOTAL</strong></td>'

					+ '<td></td>'

					+ '<td><strong>' + cus_pcs + '</strong></td>'

					+ '<td></td>'

					+ '<td><strong>' + parseFloat(cus_gwt).toFixed(3) + '</strong></td>'

					// +'<td><strong>'+parseFloat(cus_nwt).toFixed(3)+'</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(cus_taxable_amt).toFixed(2)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(cus_sgst).toFixed(2)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(cus_cgst).toFixed(2)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(cus_igst).toFixed(2)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(cus_gst).toFixed(2)) + '</strong></td>'

					+ '<td><strong>' + parseFloat(cus_round_off).toFixed(2) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(cus_total_amt).toFixed(2)) + '</strong></td>'

					+ '</tr>';

			}

			if (Object.keys(overseas).length > 0) {

				trHTML += '<tr>'

					+ '<td><strong>OVERSEAS BILLS</strong></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '</tr>';

				$.each(overseas, function (key, items) {

					let sls_category_name = typeof items.sales === 'undefined' || typeof items.sales.category_name === 'undefined' ? '' : items.sales.category_name;

					let sls_hsn_code = typeof items.sales === 'undefined' || typeof items.sales.hsn_code === 'undefined' ? '' : items.sales.hsn_code;

					let sls_starting_bill = typeof items.sales === 'undefined' || typeof items.sales.starting_bill === 'undefined' ? '' : items.sales.starting_bill;

					let sls_ending_bill = typeof items.sales === 'undefined' || typeof items.sales.ending_bill === 'undefined' ? '' : items.sales.ending_bill;

					let sls_piece = typeof items.sales === 'undefined' || typeof items.sales.piece === 'undefined' ? 0 : isNaN(parseFloat(items.sales.piece)) ? 0 : items.sales.piece;

					let sls_gross_wt = typeof items.sales === 'undefined' || typeof items.sales.gross_wt === 'undefined' ? 0 : isNaN(parseFloat(items.sales.gross_wt)) ? 0 : items.sales.gross_wt;

					let sls_net_wt = typeof items.sales === 'undefined' || typeof items.sales.net_wt === 'undefined' ? 0 : isNaN(parseFloat(items.sales.net_wt)) ? 0 : items.sales.net_wt;

					let sls_taxable_amt = typeof items.sales === 'undefined' || typeof items.sales.taxable_amt === 'undefined' ? 0 : isNaN(parseFloat(items.sales.taxable_amt)) ? 0 : items.sales.taxable_amt;

					let sls_total_sgst = typeof items.sales === 'undefined' || typeof items.sales.total_sgst === 'undefined' ? 0 : isNaN(parseFloat(items.sales.total_sgst)) ? 0 : items.sales.total_sgst;

					let sls_total_cgst = typeof items.sales === 'undefined' || typeof items.sales.total_cgst === 'undefined' ? 0 : isNaN(parseFloat(items.sales.total_cgst)) ? 0 : items.sales.total_cgst;

					let sls_total_igst = typeof items.sales === 'undefined' || typeof items.sales.total_igst === 'undefined' ? 0 : isNaN(parseFloat(items.sales.total_igst)) ? 0 : items.sales.total_igst;

					let sls_tax_amt = typeof items.sales === 'undefined' || typeof items.sales.tax_amt === 'undefined' ? 0 : isNaN(parseFloat(items.sales.tax_amt)) ? 0 : items.sales.tax_amt;

					let sls_total_amount = typeof items.sales === 'undefined' || typeof items.sales.total_amount === 'undefined' ? 0 : isNaN(parseFloat(items.sales.total_amount)) ? 0 : items.sales.total_amount;

					let sls_round_off = typeof items.sales === 'undefined' || typeof items.sales.round_off === 'undefined' ? 0 : isNaN(parseFloat(items.sales.round_off)) ? 0 : items.sales.round_off;

					let ret_category_name = typeof items.return === 'undefined' || typeof items.return.category_name === 'undefined' ? '' : items.return.category_name;

					let ret_hsn_code = typeof items.return === 'undefined' || typeof items.return.hsn_code === 'undefined' ? '' : items.return.hsn_code;

					let ret_starting_bill = typeof items.return === 'undefined' || typeof items.return.starting_bill === 'undefined' ? '' : items.return.starting_bill;

					let ret_ending_bill = typeof items.return === 'undefined' || typeof items.return.ending_bill === 'undefined' ? '' : items.return.ending_bill;

					let ret_piece = typeof items.return === 'undefined' || typeof items.return.piece === 'undefined' ? 0 : isNaN(parseFloat(items.return.piece)) ? 0 : items.return.piece;

					let ret_gross_wt = typeof items.return === 'undefined' || typeof items.return.gross_wt === 'undefined' ? 0 : isNaN(parseFloat(items.return.gross_wt)) ? 0 : items.return.gross_wt;

					let ret_net_wt = typeof items.return === 'undefined' || typeof items.return.net_wt === 'undefined' ? 0 : isNaN(parseFloat(items.return.net_wt)) ? 0 : items.return.net_wt;

					let ret_taxable_amt = typeof items.return === 'undefined' || typeof items.return.taxable_amt === 'undefined' ? 0 : isNaN(parseFloat(items.return.taxable_amt)) ? 0 : items.return.taxable_amt;

					let ret_total_sgst = typeof items.return === 'undefined' || typeof items.return.total_sgst === 'undefined' ? 0 : isNaN(parseFloat(items.return.total_sgst)) ? 0 : items.return.total_sgst;

					let ret_total_cgst = typeof items.return === 'undefined' || typeof items.return.total_cgst === 'undefined' ? 0 : isNaN(parseFloat(items.return.total_cgst)) ? 0 : items.return.total_cgst;

					let ret_total_igst = typeof items.return === 'undefined' || typeof items.return.total_igst === 'undefined' ? 0 : isNaN(parseFloat(items.return.total_igst)) ? 0 : items.return.total_igst;

					let ret_tax_amt = typeof items.return === 'undefined' || typeof items.return.tax_amt === 'undefined' ? 0 : isNaN(parseFloat(items.return.tax_amt)) ? 0 : items.return.tax_amt;

					let ret_total_amount = typeof items.return === 'undefined' || typeof items.return.total_amount === 'undefined' ? 0 : isNaN(parseFloat(items.return.total_amount)) ? 0 : items.return.total_amount;

					let ret_round_off = typeof items.return === 'undefined' || typeof items.return.round_off === 'undefined' ? 0 : isNaN(parseFloat(items.return.round_off)) ? 0 : items.return.round_off;

					overseas_pcs += parseFloat(sls_piece) - parseFloat(ret_piece);

					overseas_gwt += parseFloat(sls_gross_wt) - parseFloat(ret_gross_wt);

					overseas_taxable += parseFloat(sls_taxable_amt) - parseFloat(ret_taxable_amt);

					overseas_sgst += parseFloat(sls_total_sgst) - parseFloat(ret_total_sgst);

					overseas_cgst += parseFloat(sls_total_cgst) - parseFloat(ret_total_cgst);

					overseas_igst += parseFloat(sls_total_igst) - parseFloat(ret_total_igst);

					overseas_tax += parseFloat(sls_tax_amt) - parseFloat(ret_tax_amt);

					overseas_tot_amount += parseFloat(sls_total_amount) - parseFloat(ret_total_amount);

					overseas_round_off += parseFloat(sls_round_off) - parseFloat(ret_round_off);

					trHTML += '<tr>'

						+ '<td><strong>' + sls_category_name + '(Sales)</strong></td>'

						+ '<td>' + (sls_starting_bill + ' - ' + sls_ending_bill) + '</td>'

						+ '<td>' + sls_piece + '</td>'

						+ '<td>' + sls_hsn_code + '</td>'

						+ '<td>' + sls_gross_wt + '</td>'

						// +'<td>'+items.net_wt+'</td>'

						+ '<td>' + money_format_india(parseFloat(sls_taxable_amt).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(sls_total_sgst).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(sls_total_cgst).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(sls_total_igst).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(sls_tax_amt).toFixed(2)) + '</td>'

						+ '<td>' + parseFloat(sls_round_off).toFixed(2) + '</td>'

						+ '<td>' + money_format_india(parseFloat(sls_total_amount).toFixed(2)) + '</td>'

						+ '</tr>';

					trHTML += '<tr>'

						+ '<td><strong>' + ret_category_name + '(Return)</strong></td>'

						+ '<td>' + (ret_starting_bill + ' - ' + ret_ending_bill) + '</td>'

						+ '<td>' + ret_piece + '</td>'

						+ '<td>' + ret_hsn_code + '</td>'

						+ '<td>' + parseFloat(ret_gross_wt).toFixed(3) + '</td>'

						// +'<td>'+items.net_wt+'</td>'

						+ '<td>' + money_format_india(parseFloat(ret_taxable_amt).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(ret_total_sgst).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(ret_total_cgst).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(ret_total_igst).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india(parseFloat(ret_tax_amt).toFixed(2)) + '</td>'

						+ '<td>' + parseFloat(ret_round_off).toFixed(2) + '</td>'

						+ '<td>' + money_format_india(parseFloat(ret_total_amount).toFixed(2)) + '</td>'

						+ '</tr>';

					trHTML += '<tr class="sales_return_total">'

						+ '<td><strong>Total(Sales-Return)</strong></td>'

						+ '<td>' + (sls_starting_bill + ' - ' + sls_ending_bill) + '</td>'

						+ '<td>' + (parseFloat(sls_piece) - parseFloat(ret_piece)) + '</td>'

						+ '<td>' + (sls_hsn_code == '' ? ret_hsn_code : sls_hsn_code) + '</td>'

						+ '<td>' + parseFloat(parseFloat(sls_gross_wt) - parseFloat(ret_gross_wt)).toFixed(3) + '</td>'

						// +'<td>'+items.net_wt+'</td>'

						+ '<td>' + money_format_india((parseFloat(sls_taxable_amt) - parseFloat(ret_taxable_amt)).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india((parseFloat(sls_total_sgst) - parseFloat(ret_total_sgst)).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india((parseFloat(sls_total_cgst) - parseFloat(ret_total_cgst)).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india((parseFloat(sls_total_igst) - parseFloat(ret_total_igst)).toFixed(2)) + '</td>'

						+ '<td>' + money_format_india((parseFloat(sls_tax_amt) - parseFloat(ret_tax_amt)).toFixed(2)) + '</td>'

						+ '<td>' + parseFloat(parseFloat(sls_round_off) - parseFloat(ret_round_off)).toFixed(2) + '</td>'

						+ '<td>' + money_format_india((parseFloat(sls_total_amount) - parseFloat(ret_total_amount)).toFixed(2)) + '</td>'

						+ '</tr>';

				});

				trHTML += '<tr>'

					+ '<td><strong>SUB TOTAL</strong></td>'

					+ '<td></td>'

					+ '<td><strong>' + overseas_pcs + '</strong></td>'

					+ '<td></td>'

					+ '<td><strong>' + parseFloat(overseas_gwt).toFixed(3) + '</strong></td>'

					//  +'<td><strong></strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(overseas_taxable).toFixed(2)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(overseas_sgst).toFixed(2)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(overseas_cgst).toFixed(2)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(overseas_igst).toFixed(2)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(overseas_tax).toFixed(2)) + '</strong></td>'

					+ '<td><strong>' + parseFloat(overseas_round_off).toFixed(2) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(overseas_tot_amount).toFixed(2)) + '</strong></td>'

					+ '</tr>';

			}

			if (Object.keys(customer_bills).length > 0 || Object.keys(company_bills).length > 0 || Object.keys(overseas).length > 0) {

				trHTML += '<tr>'

					+ '<td><strong>GRAND TOTAL</strong></td>'

					+ '<td></td>'

					+ '<td><strong>' + (cus_pcs + cmp_pcs + overseas_pcs) + '</strong></td>'

					+ '<td></td>'

					+ '<td><strong>' + parseFloat(cus_gwt + cmp_gwt + overseas_gwt).toFixed(3) + '</strong></td>'

					// +'<td><strong>'+parseFloat(cus_nwt+cmp_nwt).toFixed(3)+'</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(cus_taxable_amt + cmp_taxable_amt + overseas_taxable).toFixed(2)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(cus_sgst + cmp_sgst + overseas_sgst).toFixed(2)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(cus_cgst + cmp_cgst + overseas_cgst).toFixed(2)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(cus_igst + cmp_igst + overseas_igst).toFixed(2)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(cus_gst + cmp_gst + overseas_tax).toFixed(2)) + '</strong></td>'

					+ '<td><strong>' + parseFloat(cus_round_off + cmp_round_off + overseas_round_off).toFixed(2) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(cus_total_amt + cmp_total_amt + overseas_tot_amount).toFixed(2)) + '</strong></td>'

					+ '</tr>';

			}

			if (repair.length > 0) {

				trHTML += '<tr>'

					+ '<td><strong>REPAIR CHARGES</strong></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					// +'<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '</tr>';

				$.each(repair, function (key, items) {

					rep_pcs += parseFloat(items.pcs);

					rep_gwt += parseFloat(items.weight);

					rep_taxable += parseFloat(items.tot_taxable);

					rep_sgst += parseFloat(items.tot_sgst);

					rep_cgst += parseFloat(items.tot_cgst);

					rep_igst += parseFloat(items.tot_igst);

					rep_tax += parseFloat(items.tot_tax);

					rep_tot_amount += parseFloat(items.amount);

					rep_round_off += parseFloat(items.round_off);

					trHTML += '<tr>'

						+ '<td><strong>' + items.name + '</strong></td>'

						+ '<td>' + (items.starting_bill + ' - ' + items.ending_bill) + '</td>'

						+ '<td>' + items.pcs + '</td>'

						+ '<td>' + items.hsn_code + '</td>'

						+ '<td>' + items.weight + '</td>'

						// +'<td></td>'

						+ '<td>' + money_format_india(items.tot_taxable) + '</td>'

						+ '<td>' + money_format_india(items.tot_sgst) + '</td>'

						+ '<td>' + money_format_india(items.tot_cgst) + '</td>'

						+ '<td>' + money_format_india(items.tot_igst) + '</td>'

						+ '<td>' + money_format_india(items.tot_tax) + '</td>'

						+ '<td>' + parseFloat(items.round_off).toFixed(2) + '</td>'

						+ '<td>' + money_format_india(items.amount) + '</td>'

						+ '</tr>';

				});

				trHTML += '<tr>'

					+ '<td><strong>GRANT TOTAL</strong></td>'

					+ '<td></td>'

					+ '<td><strong>' + rep_pcs + '</strong></td>'

					+ '<td></td>'

					+ '<td><strong>' + parseFloat(rep_gwt).toFixed(3) + '</strong></td>'

					// +'<td><strong></strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(rep_taxable).toFixed(2)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(rep_sgst).toFixed(2)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(rep_cgst).toFixed(2)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(rep_igst).toFixed(2)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(rep_tax).toFixed(2)) + '</strong></td>'

					+ '<td><strong>' + parseFloat(rep_round_off).toFixed(2) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(rep_tot_amount).toFixed(2)) + '</strong></td>'

					+ '</tr>';

			}

			$('#gst_abstract_list > tbody').html(trHTML);

			if (!$.fn.DataTable.isDataTable('#gst_abstract_list')) {

				oTable = $('#gst_abstract_list').dataTable({

					"bSort": false,

					"bDestroy": true,

					"bInfo": true,

					"scrollX": '100%',

					"paging": false,

					"dom": 'Bfrtip',

					"bAutoWidth": false,

					"responsive": true,

					/*"buttons": [

					{

					extend: 'print',

					footer: true,

					title: '',

					messageTop: title,

					customize: function ( win ) {

					   $(win.document.body).find('table')

											.addClass('compact');

					$(win.document.body).find( 'table' )

					.addClass('compact')

					.css('font-size','10px')

					.css('font-family','sans-serif');

					},

					   exportOptions: {

									   columns: ':visible',

									  stripHtml: false

								   }

					},

					{

					extend:'excel',

					footer: true,

					   title: 'GST Abstract Report',

					}

					], */

					"buttons": [

						{

							extend: 'print',

							footer: false,

							title: '',

							messageTop: title,

							orientation: 'landscape',

							customize: function (win) {

								var last = null;

								var current = null;

								var bod = [];

								var css = '@page { size: landscape; }',

									head = win.document.head || win.document.getElementsByTagName('head')[0],

									style = win.document.createElement('style');

								style.type = 'text/css';

								style.media = 'print';

								if (style.styleSheet) {

									style.styleSheet.cssText = css;

								}

								else {

									style.appendChild(win.document.createTextNode(css));

								}

								head.appendChild(style);

							},

							exportOptions: {

								columns: ':visible',

								stripHtml: false

							}

						},

						{

							extend: 'excel',

							footer: true,

							title: 'GST Abstract Report',

						}

					],

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function get_ActiveTaxGroup() {

	$.ajax({

		type: 'GET',

		url: base_url + 'index.php/admin_ret_catalog/tax/active_tax',

		dataType: 'json',

		success: function (data) {

			var id = $("#tax_group").val();

			$("#tax_group").append(

				$("<option></option>")

					.attr("value", 0)

					.text('All')

			);

			$.each(data, function (key, item) {

				$('#tax_group').append(

					$("<option></option>")

						.attr("value", item.tax_id)

						.text(item.tax_name)

				);

			});

			$("#tax_group").select2(

				{

					placeholder: "Select Tax Group",

					allowClear: true

				});

		}

	});

}

function get_TaxGroupFromBilling() {

	$.ajax({

		type: 'GET',

		url: base_url + 'index.php/admin_ret_billing/get_tax_group_from_billing',

		dataType: 'json',

		success: function (data) {

			var id = $("#tax_group").val();

			$("#tax_group").append(

				$("<option></option>")

					.attr("value", 0)

					.text('All')

			);

			$.each(data, function (key, item) {

				$('#tax_group').append(

					$("<option></option>")

						.attr("value", item.tgrp_id)

						.text(item.tgrp_name)

				);

			});

			$("#tax_group").select2(

				{

					placeholder: "Select Tax Group",

					allowClear: true

				});

		}

	});

}

function get_hsncode() {

	$("#hsn_code option").remove();

	$.ajax({

		type: 'POST',

		url: base_url + 'index.php/admin_ret_catalog/category/hsn_code',

		dataType: 'json',

		data: { 'id_metal': $('#metal').val() },

		success: function (data) {

			$("#hsn_code").append(

				$("<option></option>")

					.attr("value", 0)

					.text('All')

			);

			$.each(data, function (key, item) {

				if (item.hsn_code != '' && item.hsn_code != null) {

					$('#hsn_code').append(

						$("<option></option>")

							.attr("value", item.hsn_code)

							.text(item.hsn_code)

					);

				}

			});

			$('#hsn_code').select2({

				placeholder: "HSN Code",

				allowClear: true

			});

		}

	});

	$("div.overlay").css("display", "none");

}

//Analysis report start here

$('#customer_analysis_search').click(function (event) {

	get_input_values();

});

$('#add_condtions').click(function (event) {

	$('#condition_list').toggle();

	console.log($("#condition_list > tbody > tr").length);

	if ($("#condition_list > tbody > tr").length < 1) {

		create_new_filter_condition_rows();

	}

});

function get_customer_analysis_report(fliter_values) {

	my_Date = new Date();

	$('.overlay').css('display', 'block');

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/customer_sales_analysis/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'from_date': $('#rpt_payments1').html(), 'to_date': $('#rpt_payments2').html(), 'filter_condtions': fliter_values, 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()) }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			set_customer_analysis_report(data);

			$('.overlay').css('display', 'none');

		},

		error: function (error) {

			$('.overlay').css('display', 'none');

		}

	});

}

function set_customer_analysis_report(data) {

	var list = data;

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $('#branch_select option:selected').toArray().map(item => item.text).join());

	var company_name = $('#company_name').val();

	var company_code = $('#company_code').val();

	var company_code = $('#company_code').val();

	var company_address1 = $('#company_address1').val();

	var company_address2 = $('#company_address2').val();

	var company_city = $('#company_city').val();

	var pincode = $('#pincode').val();

	var company_email = $('#company_email').val();

	var company_gst_number = $('#company_gst_number').val();

	var phone = $('#phone').val();

	var title = "<div style='text-align: center;'><b><span style='font-size:12pt;'>" + company_code + "</span></b></br>"

		+ "<span style='font-size:11pt;'>" + company_address1 + "</span></br>"

		+ "<span style='font-size:11pt;'>" + company_address2 + company_city + "-" + pincode + "</span></br>"

		+ "<span style='font-size:11pt;'>GSTIN:" + company_gst_number + ", EMAIL:" + company_email + "</span></br>"

		+ "<span style='font-size:11pt;'>Contact :" + phone + "</span></br>"

		+ "<span style=font-size:12pt;>&nbsp;&nbsp;Customer Analysis - " + branch_name + " &nbsp;FROM&nbsp;:&nbsp;" + $('#rpt_payments1').html() + " &nbsp;&nbsp;TO&nbsp;&nbsp; " + $('#rpt_payments2').html() + " - " + $('.hidden-xs').html() + "</span>";

	var oTable = $('#telecalling_list').DataTable();

	oTable.clear().draw();

	if (list != null && list.length > 0) {

		oTable = $('#telecalling_list').dataTable({

			"bDestroy": true,

			"bInfo": true,

			"bFilter": true,

			"scrollX": '100%',

			"bSort": true,

			"dom": 'lBfrtip',

			"buttons": [

				{

					extend: 'print',

					footer: true,

					title: '',

					messageTop: title,

					customize: function (win) {

						$(win.document.body).find('table')

							.addClass('compact')

							.css('font-size', 'inherit');

					},

				},

				{

					extend: 'excel',

					footer: true,

					title: ''

				}

			],

			"aaData": list,

			"columnDefs": [

				{

					targets: [0, 1, 2, 3, 4, 5, 6, 7, 9, 10, 11, 12],

					className: 'dt-left'

				},

				{

					targets: [13, 14, 15, 16, 17, 18],

					className: 'dt-right'

				},

			],

			"aoColumns": [

				{

					"mDataProp": function (row, type, val, meta) {

						chekbox = '<input type="checkbox" class="id_customer" name="id_customer[]" value="' + row.id_customer + '"/>' + row.id_customer;

						return chekbox;

					}

				},

				{

					"mDataProp": function (row, type, val, meta) {

						cus_report = base_url + "index.php/admin_ret_reports/customer_history/list/" + row.mobile;

						action = '<a href="' + cus_report + '" target="_blank">' + row.firstname;

						return action;

					}

				},

				{

					"mDataProp": function (row, type, val, meta) {

						mobile_report = base_url + "index.php/admin_ret_reports/customer_history/list/" + row.mobile;

						action = '<a href="' + mobile_report + '" target="_blank">' + row.mobile;

						return action;

					}

				},

				{ "mDataProp": "address1" },

				{ "mDataProp": "address2" },

				{ "mDataProp": "village" },

				{ "mDataProp": "city" },

				{ "mDataProp": "state" },

				{ "mDataProp": "pan" },

				{ "mDataProp": "gst" },

				{

					"mDataProp": function (row, type, val, meta) {

						if (row.vip_customer == 'YES') {

							return '<span class="badge bg-green">' + row.vip_customer + '</span>';

						}

						else {

							return row.vip_customer

						}

					}

				},

				{ "mDataProp": "branch_name" },

				{ "mDataProp": "bill_count" },

				{

					"mDataProp": function (row, type, val, meta) {

						return money_format_india(row.item_cost);

					}

				},

				// { "mDataProp":"item_cost" },

				{ "mDataProp": "last_billdate" },

				{

					"mDataProp": function (row, type, val, meta) {

						return money_format_india(row.goldwt);

					}

				},

				// { "mDataProp":"gold_wt" },

				{

					"mDataProp": function (row, type, val, meta) {

						return money_format_india(row.silverwt);

					}

				},

				// { "mDataProp":"silverwt" },

				{

					"mDataProp": function (row, type, val, meta) {

						return money_format_india(row.tot_fixed_rate);

					}

				},

				// { "mDataProp":"tot_fixed_rate" },

				{

					"mDataProp": function (row, type, val, meta) {

						return money_format_india(row.tot_discount);

					}

				},

				// { "mDataProp":"tot_discount" },

			],

			"footerCallback": function (row, data, start, end, display) {

				var api = this.api(), data;

				// Remove the formatting to get integer data for summation

				var intVal = function (i) {

					return typeof i === 'string' ?

						i.replace(/[\$,]/g, '') * 1 :

						typeof i === 'number' ?

							i : 0;

				};

				bill_count = api

					.column(13)

					.data()

					.reduce(function (a, b) {

						return intVal(a) + intVal(b);

					}, 0);

				sold_gross_wgt = api

					.column(15)

					.data()

					.reduce(function (a, b) {

						return intVal(a) + intVal(b);

					}, 0);

				mrp_cost = api

					.column(17)

					.data()

					.reduce(function (a, b) {

						return intVal(a) + intVal(b);

					}, 0);

				tot_discount = api

					.column(18)

					.data()

					.reduce(function (a, b) {

						return intVal(a) + intVal(b);

					}, 0);

				mrp_discount = api

					.column(16)

					.data()

					.reduce(function (a, b) {

						return intVal(a) + intVal(b);

					}, 0);

				discount = api

					.column(12)

					.data()

					.reduce(function (a, b) {

						return intVal(a) + intVal(b);

					}, 0);

				// console.log('solditems', sold_gross_wgt);

				// console.log('mrp_cost',  mrp_cost);

				// console.log('tot_discount', tot_discount);

				// console.log('mrp_discount', mrp_discount);

				// Update footer

				$(api.column(12).footer()).html(money_format_india(parseFloat(discount).toFixed(0)));

				$(api.column(13).footer()).html(money_format_india(parseFloat(bill_count).toFixed(2)))

				$(api.column(15).footer()).html(money_format_india(parseFloat(sold_gross_wgt).toFixed(2)));

				$(api.column(16).footer()).html(money_format_india(parseFloat(mrp_discount).toFixed(3)));

				$(api.column(17).footer()).html(money_format_india(parseFloat(mrp_cost).toFixed(2)));

				$(api.column(18).footer()).html(money_format_india(parseFloat(tot_discount).toFixed(2)));

			}

		});

	}

}

$(document).on('click', '.add', function () {

	if (validate_filter_condtions()) {

		create_new_filter_condition_rows();

	}

	else {

		$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + 'Please the requires fields..' });

	}

});

function validate_filter_condtions() {

	var row_validate = true;

	$(".container table tbody tr").each(function (index, elemet) {

		if (($(this).find(".flit_type option:selected").val() == 'bill.bill_date') && ($(this).find(".flit_method option:selected").val() == 'Between')) {

			if ($(this).find(".filter_date").val() == '' || $(this).find(".filter_to_date").val() == "" || $(this).find(".flit_operators").val() == "") {

				row_validate = false;

			}

		}

		else if (($(this).find(".flit_type option:selected").val() != 'bill.bill_date') && ($(this).find(".flit_method option:selected").val() == 'Between')) {

			if ($(this).find(".filt_values").val() == '' || $(this).find(".another_val").val() == '' || $(this).find(".flit_operators").val() == '') {

				row_validate = false;

			}

		}

		else {

			if ($(this).find(".flit_operators").val() == '') {

				row_validate = false;

			}

		}

	});

	return row_validate;

}

function create_new_filter_condition_rows() {

	$('.container table tbody').append(

		'<tr><td><select class="flit_type form-control"  name="filt_types[values][]"><option value="tot_gold.gold_wt" selected>Gold GrossWt</option><option value="tot_silver.silver_wt">Sliver GrossWt</option><option value="bill_tot.tot_discount">Discount</option><option value="bill_tot.item_cost">Sale Value</option><option value="bill.bill_date">Bill Date</option><option value="last_biil_date">Since Last Bill </option><option value="bill.created_by">Employee</option><option value="pro.cat_id">Cateagory</option><option value="bill_det.product_id">Product</option> <option value="bill_det.design_id">Design </option> <option value="bill_det.id_sub_design">Sub Design</option><option value="c.id_village">Village</option><option value="bill_tot.bill_counts">Bill Count</option> </select></td>'

		+ '<td class="flit_method_val "><select class="flit_method form-control"  name="filt_types[values][]" ><option value=""></option><option value="<">Lesser Than</option><option value=">">Greater than</option><option value="=">Equal To</option><option value="Between">Between</option><option value="like">Like</option></select></td>'

		+ '<td style="display: flex;flex-direction: row;"><input name="filt_values" class="filt_values form-control" placeholder="Enter Value" />'

		+ '<input style="display: none;" name="between_values" class="another_val form-control" name="filt_types[values][]"placeholder="Enter Value" />'

		+ '<input style="display: none;" class="filter_date  datemask date filter_date form-control" data-date-format="dd-mm-yyyy" name="filt_types[filter_date][]" type="text" placeholder="Payment Date" value="" />'

		+ '<input style="display : none;" class="filter_to_date  datemask date filter_date form-control" data-date-format="dd-mm-yyyy" name="filt_types[filter_to_date][]" type="text" placeholder="To_Payment Date" value="" />'

		+ '<select  style="display : none;"  class="select_epc form-control" name="select_epc[values][]" onchange="set_value($(this).closest(\'tr\'))"> </select>'

		+ '<td><select class="flit_operators form-control" name="filt_types[values][]"style=" "><option value=""></option><option value="AND">AND</option><option value="OR">OR</option><option value="NOT">Not</option></select></td>'

		+ '<td><a href="#" class="add" style="padding: 2em;"> <i class="fa fa-plus"></i>  </a>  <a href="#" onClick="remove_tag_row($(this).closest(\'tr\'));" class="remove" style="padding: 2em;" > <i class="fa fa-trash"></i> </a></td>'

		+ '</tr>');

	$('.filter_date').datepicker({ dateFormat: 'yyyy-mm-dd', });

}

function remove_tag_row(curRow) {

	curRow.remove();

}

$(document).on('change', ".flit_method,.flit_type", function () {

	showing_condtions();

});

function showing_condtions() {

	$(".container table tbody tr").each(function (index, elemet) {

		if (($(this).find("td .flit_type option:selected").val() == '(date(bill.bill_date))') && ($(this).find("td .flit_method option:selected").val() == 'Between')) {

			$(this).find("td .filter_date").css('display', 'inline-block');

			$(this).find("td .filter_to_date").css('display', 'inline-block');

			$(this).find("td .filt_values").css('display', 'none');

			$(this).find("td .another_val").css('display', 'none');

			$(this).find(".select_epc").select2().next().hide();

		}

		else if (($(this).find("td .flit_type option:selected").val() != '(date(bill.bill_date))') && ($(this).find("td .flit_method option:selected").val() == 'Between')) {

			$(this).find("td .filt_values").css('display', 'inline-block');

			$(this).find("td .another_val").css('display', 'inline-block');

			$(this).find("td .filter_date").css('display', 'none');

			$(this).find("td .filter_to_date").css('display', 'none');

			$(this).find(".select_epc").select2().next().hide();

		}

		else if (($(this).find("td .flit_type option:selected").val() != '(date(bill.bill_date))') && ($(this).find("td .flit_method option:selected").val() == 'Between')) {

			$(this).find("td .filt_values").css('display', 'inline-block');

			$(this).find("td .another_val").css('display', 'inline-block');

			$(this).find("td .filter_date").css('display', 'none');

			$(this).find("td .filter_to_date").css('display', 'none');

			$(this).find(".select_epc").select2().next().hide();

		}

		else if (($(this).find("td .flit_type option:selected").val() == 'bill.created_by')) {

			$(this).find("td .filter_date").css('display', 'none');

			$(this).find("td .filt_values").css('display', 'none');

			$(this).find("td .filter_to_date").css('display', 'none');

			$(this).find("td .another_val").css('display', 'none');

			$(this).find("td .select_epc").css('display', 'inline-block');

			$(this).find(".select_epc").select2().next().show();

			if ($(this).find(".select_epc").val() == null) {

				get_select_option($(this), 'emp');

			}

		}

		else if (($(this).find("td .flit_type option:selected").val() == 'bill_det.product_id')) {

			$(this).find("td .filter_date").css('display', 'none');

			$(this).find("td .filt_values").css('display', 'none');

			$(this).find("td .filter_to_date").css('display', 'none');

			$(this).find("td .another_val").css('display', 'none');

			$(this).find("td .select_epc").css('display', 'inline-block');

			$(this).find(".select_epc").select2().next().show();

			$(this).find(".flit_method ").val('=');

			if ($(this).find(".select_epc").val() == null || $(this).find(".select_epc").val() == '') {

				get_select_option($(this), 'pro');

			}

		}

		else if (($(this).find("td .flit_type option:selected").val() == 'pro.cat_id')) {

			$(this).find("td .filter_date").css('display', 'none');

			$(this).find("td .filt_values").css('display', 'none');

			$(this).find("td .filter_to_date").css('display', 'none');

			$(this).find("td .another_val").css('display', 'none');

			$(this).find("td .select_epc").css('display', 'inline-block');

			$(this).find(".select_epc").select2().next().show();

			$(this).find(".flit_method ").val('=');

			//console.log($(this).find(".select_epc").val());

			if ($(this).find(".select_epc").val() == null || $(this).find(".select_epc").val() == '') {

				get_select_option($(this), 'cat');

			}

		}

		else if (($(this).find("td .flit_type option:selected").val() == 'bill_det.design_id')) {

			$(this).find("td .filter_date").css('display', 'none');

			$(this).find("td .filt_values").css('display', 'none');

			$(this).find("td .filter_to_date").css('display', 'none');

			$(this).find("td .another_val").css('display', 'none');

			$(this).find("td .select_epc").css('display', 'inline-block');

			$(this).find(".select_epc").select2().next().show();

			$(this).find(".flit_method ").val('=');

			//console.log($(this).find(".select_epc").val());

			if ($(this).find(".select_epc").val() == null || $(this).find(".select_epc").val() == '') {

				get_select_option($(this), 'des');

			}

		}

		else if (($(this).find("td .flit_type option:selected").val() == 'bill_det.id_sub_design')) {

			$(this).find("td .filter_date").css('display', 'none');

			$(this).find("td .filt_values").css('display', 'none');

			$(this).find("td .filter_to_date").css('display', 'none');

			$(this).find("td .another_val").css('display', 'none');

			$(this).find("td .select_epc").css('display', 'inline-block');

			$(this).find(".select_epc").select2().next().show();

			$(this).find(".flit_method ").val('=');

			//console.log($(this).find(".select_epc").val());

			if ($(this).find(".select_epc").val() == null || $(this).find(".select_epc").val() == '') {

				get_select_option($(this), 'sub_des');

			}

		}

		else if (($(this).find("td .flit_type option:selected").val() == 'c.id_village')) {

			$(this).find("td .filter_date").css('display', 'none');

			$(this).find("td .filt_values").css('display', 'none');

			$(this).find("td .filter_to_date").css('display', 'none');

			$(this).find("td .another_val").css('display', 'none');

			$(this).find("td .select_epc").css('display', 'inline-block');

			$(this).find(".select_epc").select2().next().show();

			$(this).find(".flit_method ").val('=');

			//console.log($(this).find(".select_epc").val());

			if ($(this).find(".select_epc").val() == null || $(this).find(".select_epc").val() == '') {

				get_select_option($(this), 'village');

			}

		}

		else if (($(this).find("td .flit_type option:selected").val() == '(date(bill.bill_date))')) {

			$(this).find("td .another_val").css('display', 'none');

			$(this).find("td .filter_date").css('display', 'inline-block');

			$(this).find("td .filt_values").css('display', 'none');

			$(this).find("td .filter_to_date").css('display', 'none');

			$(this).find("td .filter_to_date").css('display', 'none');

			$(this).find(".select_epc").select2().next().hide();

		}

		else {

			$(this).find("td .filt_values").css('display', 'inline-block');

			$(this).find("td .another_val").css('display', 'none');

			$(this).find("td .filter_date").css('display', 'none');

			$(this).find(".select_epc").select2().next().hide();

		}

	});

}

function get_input_values() {

	var total = $(".container table tbody tr").length;

	var arrWHere = [];

	var arrHAving = [];

	var fliter_values = [];

	var i = 1;

	$(".container table tbody tr").each(function (index, elemet) {

		if ($(this).find(".flit_type").val() == 'bill_det.product_id' || $(this).find(".flit_type").val() == 'bill.bill_date' || $(this).find(".flit_type").val() == 'bill.created_by' || $(this).find(".flit_type").val() == 'pro.cat_id' || $(this).find(".flit_type").val() == 'bill_det.id_sub_design' || $(this).find(".flit_type").val() == 'bill_det.design_id') {

			arrWHere.push({

				name: $(this).find(".flit_type").val(),

				methods: $(this).find(".flit_method").val(),

				values: $(this).find(".filt_values").val(),

				btw_values: $(this).find(".another_val").val(),

				from_date: $(this).find(".filter_date").val(),

				to_date: $(this).find(".filter_to_date").val(),

				flit_operators: $(this).find(".flit_operators").val(),

			});

			i++;

		} else {

			arrHAving.push({

				name: $(this).find(".flit_type").val(),

				methods: $(this).find(".flit_method").val(),

				values: $(this).find(".filt_values").val(),

				btw_values: $(this).find(".another_val").val(),

				from_date: $(this).find(".filter_date").val(),

				to_date: $(this).find(".filter_to_date").val(),

				flit_operators: $(this).find(".flit_operators").val(),

			});

		}

	});

	if (arrHAving.length > 0) {

		var len = arrHAving.length - 1;

		arrHAving[len].flit_operators = '';

		fliter_values = fliter_values.concat(arrHAving);

	}

	if (arrWHere.length > 0) {

		var len = arrWHere.length - 1;

		arrWHere[len].flit_operators = '';

		fliter_values = fliter_values.concat(arrWHere);

	}

	get_customer_analysis_report(fliter_values);

}

function get_select_option(id, type) {

	console.log(id);

	if (type == 'emp') {

		my_Date = new Date();

		$.ajax({

			url: base_url + "index.php/admin_ret_estimation/get_employee?nocache=" + my_Date.getUTCSeconds() + '' + my_Date.getUTCMinutes() + '' + my_Date.getUTCHours(),

			data: { 'id_branch': $('#branch_select').val() },

			type: "POST",

			dataType: "JSON",

			success: function (data) {

				id.find("td .select_epc option").remove();

				$.each(data, function (key, item) {

					id.find("td .select_epc").append(

						$("<option></option>")

							.attr("value", item.id_employee)

							.text(item.emp_name)

					);

				});

				id.find(".select_epc").select2({

					placeholder: "Select Employee",

					allowClear: true

				});

				id.find(".select_epc").select2("val", '');

				$(".overlay").css("display", "none");

			},

			error: function (error) {

			}

		});

	} else if (type == 'pro') {

		cat_id = get_filter_id('pro');

		$.ajax({

			type: 'POST',

			url: base_url + 'index.php/admin_ret_reports/get_ActiveProduct',

			dataType: 'json',

			data: { 'id_category': cat_id },

			success: function (data) {

				id.find("td .select_epc option").remove();

				$.each(data, function (key, item) {

					id.find("td .select_epc").append(

						$("<option></option>")

							.attr("value", item.pro_id)

							.text(item.product_name)

					);

				});

				id.find(".select_epc").select2({

					placeholder: "Select Product",

					allowClear: true

				});

				id.find(".select_epc").select2("val", '');

			}

		});

	} else if (type == 'des') {

		id_product = get_filter_id('des');

		$.ajax({

			type: 'POST',

			url: base_url + 'index.php/admin_ret_reports/get_Activedesign',

			dataType: 'json',

			data: { 'id_product': id_product },

			success: function (data) {

				id.find("td .select_epc option").remove();

				$.each(data, function (key, item) {

					id.find("td .select_epc").append(

						$("<option></option>")

							.attr("value", item.design_no)

							.text(item.design_name)

					);

				});

				id.find(".select_epc").select2({

					placeholder: "Select Design ",

					allowClear: true

				});

				id.find(".select_epc").select2("val", '');

			}

		});

	}

	else if (type == 'sub_des') {

		id_design = get_filter_id('sub_des');

		$.ajax({

			type: 'POST',

			url: base_url + 'index.php/admin_ret_reports/get_ActivesubDesign',

			dataType: 'json',

			data: { 'id_design': id_design },

			success: function (data) {

				id.find("td .select_epc option").remove();

				$.each(data, function (key, item) {

					id.find("td .select_epc").append(

						$("<option></option>")

							.attr("value", item.id_sub_design)

							.text(item.sub_design_name)

					);

				});

				id.find(".select_epc").select2({

					placeholder: "Select Sub Design",

					allowClear: true

				});

				id.find(".select_epc").select2("val", '');

			}

		});

	}

	else if (type == 'cat') {

		$.ajax({

			type: 'POST',

			url: base_url + 'index.php/admin_ret_catalog/category/active_category',

			dataType: 'json',

			success: function (data) {

				id.find("td .select_epc option").remove();

				$.each(data, function (key, item) {

					id.find("td .select_epc").append(

						$("<option></option>")

							.attr("value", item.id_ret_category)

							.text(item.name)

					);

				});

				id.find(".select_epc").select2({

					placeholder: "Select Cateagory",

					allowClear: true

				});

				id.find(".select_epc").select2("val", '');

			}

		});

	} else if (type == 'village') {

		$.ajax({

			type: 'POST',

			url: base_url + 'index.php/admin_ret_reports/ajax_get_village',

			dataType: 'json',

			success: function (data) {

				id.find("td .select_epc option").remove();

				$.each(data, function (key, item) {

					id.find("td .select_epc").append(

						$("<option></option>")

							.attr("value", item.id_village)

							.text(item.village_name)

					);

				});

				id.find(".select_epc").select2({

					placeholder: "Select Village",

					allowClear: true

				});

				id.find(".select_epc").select2("val", '');

			}

		});

	}

}

function get_employee(id_branch) {

	$('#emp_select option').remove();

	$('#employee_select option').remove();

	var my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_estimation/get_employee?nocache=" + my_Date.getUTCSeconds() + '' + my_Date.getUTCMinutes() + '' + my_Date.getUTCHours(),

		data: { 'id_branch': id_branch },

		type: "POST",

		dataType: "JSON",

		success: function (data) {

			var id_employee = $('#id_employee').val();

			emp_details = data;

			$.each(data, function (key, item) {

				$("#emp_select, #employee_select").append(

					$("<option></option>").attr("value", item.id_employee).text(item.emp_name)

				);

			});

			$("#emp_select, #employee_select").select2({

				placeholder: "Select Employee",

				allowClear: true

			});

			if (id_employee !== '' && id_employee > 0 && id_employee !== undefined) {

				$("#emp_select, #employee_select").select2("val", id_employee);

			} else {

				$("#emp_select, #employee_select").val(null).trigger('change'); // Reset selection

			}

			$(".overlay").css("display", "none");

		},

		error: function (error) {

			// Handle error

		}

	});

}

function set_value(curRow) {

	val = curRow.find("td .select_epc").val();

	curRow.find("td .filt_values").val(val);

}

function get_filter_id(type) {

	return_id = '';

	$(".container table tbody tr").each(function (index, elemet) {

		if (type == 'pro' && ($(this).find("td .flit_type option:selected").val() == 'pro.cat_id')) {

			return_id = $(this).find("td .select_epc option:selected").val();

		} else if (type == 'des' && ($(this).find("td .flit_type option:selected").val() == 'bill_det.product_id')) {

			return_id = $(this).find("td .select_epc option:selected").val();

		} else if (type == 'sub_des' && ($(this).find("td .flit_type option:selected").val() == 'bill_det.design_id')) {

			return_id = $(this).find("td .select_epc option:selected").val();

		}

	});

	return return_id;

}

function reset_filter(tr) {

	reset = false;

	$(".container table tbody tr").each(function (index, elemet) {

		if (tr.find("td .flit_type option:selected").val() == 'pro.cat_id' && ($(this).find("td .flit_type option:selected").val() == 'bill_det.product_id')) {

			$(this).find("td .select_epc").val('');

			reset = true;

		} else if (tr.find("td .flit_type option:selected").val() == 'bill_det.product_id' && ($(this).find("td .flit_type option:selected").val() == 'bill_det.design_id')) {

			$(this).find("td .select_epc").val('');

			reset = true;

		} else if (tr.find("td .flit_type option:selected").val() == 'bill_det.design_id' && ($(this).find("td .flit_type option:selected").val() == 'bill_det.id_sub_design')) {

			$(this).find("td .select_epc").val('');

			reset = true;

		}

	});

	if (reset) {

		showing_condtions();

	}

}

$(document).on('select2:select', '.select_epc', function () {

	tr = $(this).closest('tr');

	reset_filter(tr);

});

//Analysis report end here

$('#issue_report_type').on('change', function () {

	$('.detailed').css("display", "none");

	$('.summary').css("display", "none");

	if (this.value == 1) {

		$('.detailed').css("display", "block");

		$('.summary').css("display", "none");

		$('.issue_group').css("display", "none");

	} else if (this.value == 2) {

		$('.summary').css("display", "block");

		$('.detailed').css("display", "none");

		$('.issue_group').css("display", "block");

	}

});

function set_dashboard_ordermangement() {

	var company_name = $('#company_name').val();

	var from_date = ctrl_page[2];

	var to_date = ctrl_page[3];

	var branch_name = ctrl_page[5];

	var report_name = (ctrl_page[4] == 1 ? 'Customer Order Pending Report'

		: (ctrl_page[4] == 2 ? 'Stock Order Pending Report'

			: (ctrl_page[4] == 3 ? 'Customer Order Work in Progress Report'

				: (ctrl_page[4] == 4 ? 'Stock Order Work in Progress Report'

					: (ctrl_page[4] == 5 ? 'Customer Order Delivery Ready Report'

						: (ctrl_page[4] == 6 ? 'Stock Order Delivery Ready Report'

							: (ctrl_page[4] == 7 ? 'Customer Order Delivered Report'

								: (ctrl_page[4] == 8 ? 'Stock Order Delivered Report'

									: (ctrl_page[4] == 9 ? 'Karigar Reminder Report'

										: (ctrl_page[4] == 10 ? 'Karigar Reminder Report'

											: (ctrl_page[4] == 11 ? 'Karigar OverDue Report'

												: (ctrl_page[4] == 12 ? 'Karigar OverDue Report' : 'Order Management Report'))))))))))));

	var optional = '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$("div.overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/dashboard_ordermangemnetlist?nocache=" + my_Date.getUTCSeconds(),

		type: "POST",

		data: { 'from_date': ctrl_page[2], 'to_date': ctrl_page[3], 'type': ctrl_page[4], 'id_branch': ctrl_page[5], 'id_product': $('#prod_select').val(), 'id_design': $('#des_select').val(), 'id_sub_design': $('#sub_des_select').val() },

		dataType: "JSON",

		cache: false,

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.order_details;

			var oTable = $('#order_management_report').DataTable();

			console.log(list);

			if (list != null) {

				$("#order_management_report > tbody > tr").remove();

				$('#order_management_report').dataTable().fnClearTable();

				$('#order_management_report').dataTable().fnDestroy();

				var trHTML = '';

				$.each(list, function (idx, items) {

					if (items.image != null && items.image != undefined && items.image != '') {

						var img_src = base_url + 'assets/img/orders/' + items.image;

					}

					else {

						var img_src = base_url + 'assets/img/no_image.png';

					}

					let advance_amount = isNaN(items.advance_amount) ? 0 : items.advance_amount;

					let advance_adj_amount = isNaN(items.advance_adj_amount) ? 0 : items.advance_adj_amount;

					var image = "<img  class='img_src' id='img_prev' src=" + img_src + "  width='35' height='35' onClick=tag_imgprev($(this).closest('tr')) ></img>"

					trHTML += '<tr class="sales">' +

						'<td>' + (items.branch_name != null ? items.branch_name : '') + '</td>' +

						'<td>' + (items.order_type != null ? items.order_type : '') + '</td>' +

						'<td>' + (items.order_no != null ? items.order_no : '') + '</td>' +

						'<td>' + (items.pur_no != null ? items.pur_no : '') + '</td>' +

						'<td>' + (items.tag_code != null ? items.tag_code : '') + '</td>' +

						'<td>' + (items.order_status != null ? items.order_status : '') + '</td>' +

						'<td>' + (items.bill_no != null ? items.bill_no : '') + '</td>' +

						'<td>' + (items.advance_amount != null ? items.advance_amount : '') + '</td>' +

						'<td>' + (items.advance_adj_amount != null ? items.advance_adj_amount : '') + '</td>' +

						'<td>' + parseFloat(parseFloat(advance_amount) - parseFloat(advance_adj_amount)).toFixed(2) + '</td>' +

						'<td>' + (items.karigar_name != null ? items.karigar_name : '') + '</td>' +

						'<td>' + (items.order_date != null ? items.order_date : '') + '</td>' +

						'<td>' + (items.delivered_date != null ? items.delivered_date : '') + '</td>' +

						'<td>' + (items.cus_due_date != null ? items.cus_due_date : '') + '</td>' +

						'<td>' + (items.smith_due_date != null ? items.smith_due_date : '') + '</td>' +

						'<td>' + (items.cus_name != null ? items.cus_name : '') + '</td>' +

						'<td>' + (items.mobile != null ? items.mobile : '') + '</td>' +

						'<td>' + (image != null ? image : '') + '</td>' +

						'<td>' + (items.product_name != null ? items.product_name : '') + '</td>' +

						'<td>' + (items.design_name != null ? items.design_name : '') + '</td>' +

						'<td>' + (items.sub_design_name != null ? items.sub_design_name : '') + '</td>' +

						'<td>' + (items.totalitems != null ? items.totalitems : '') + '</td>' +

						'<td>' + (items.weight != null ? items.weight : '') + '</td>' +

						'<td>' + (items.less_wt != null ? items.less_wt : '') + '</td>' +

						'<td>' + (items.net_wt != null ? items.net_wt : '') + '</td>' +

						'<td>' + (items.stn_amt != null ? items.stn_amt : '') + '</td>' +

						'<td>' + (items.wast_percent != null ? items.wast_percent : '') + '</td>' +

						'<td>' + (items.mc != null ? items.mc : '') + '</td>' +

						'<td>' + (items.assigned_by != null ? items.assigned_by : '') + '</td>' +

						'<td>' + (items.assigned_on != null ? items.assigned_on : '') + '</td>' +

						'<td>' + (items.description != null ? items.description : '') + '</td>';

					'</tr>';

				});

				$('#order_management_report  > tbody ').html(trHTML);

				if (!$.fn.DataTable.isDataTable('#order_management_report')) {

					oTable = $('#order_management_report').dataTable({

						"bSort": false,

						"bDestroy": true,

						"bInfo": true,

						"scrollX": '100%',

						"paging": false,

						"dom": 'Bfrtip',

						"bAutoWidth": false,

						"responsive": true,

						"columnDefs": [

							{

								targets: [0, 1, 2, 3, 4, 5, 6, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 28, 29, 30],

								className: 'dt-body-left'

							},

							{

								targets: [7, 8, 9, 21, 22, 23, 24, 25, 26, 27],

								className: 'dt-body-right'

							}

						],

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: '',

								messageTop: title,

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', '10px');

								},

							},

							{

								extend: 'excel',

								footer: true,

								title: 'Rate Fixed Report',

							}

						],

					});

				}

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

// function set_packaging_table()

// {

// 	var company_name = $('#company_name').val();

// 	var from_date = $("#rpt_payments1").html();

// 	var to_date = $("#rpt_payments2").html();

// 	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

// 	var report_name = "Branch Transfer Report"

// 	var optional = '';

// 	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

// 		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

// 	$("div.overlay").css("display", "block");

// 	my_Date = new Date();

// 	$(".overlay").css("display", "block");

// 	var type =$('#transtype').val();

//     var from_branch = "";

// 	var to_branch = "";

// 	 if(type == 1)

// 	{

// 		from_branch = $("#branch_filter").val();

// 	}

// 	else if(type == 2)

// 	{

// 		to_branch = $("#branch_filter").val();

// 	}

//     else

// 	{

// 		from_branch = $("#branch_filter").val();

// 	}

// 	$.ajax({

// 		url: base_url + "index.php/admin_ret_reports/branch_trans/ajax?nocache=" + my_Date.getUTCSeconds(),

// 		data: ({

// 			'transtype': $("#transtype").val(),

//             'from_date': $("#rpt_payments1").html(),

// 			'to_date': $("#rpt_payments2").html(),

// 			'branchtranstype' :$('#branch_transfer_type').val(),

// 			'from_branch': $("#branch_select").val() || from_branch,

// 			'to_branch': $('#branch_select_to').val() || to_branch ,

// 			'id_metal': $("#metal").val(),

// 			'id_section':$('#section_select').val(),

// 			'id_category':$('#category').val(),

// 			'report_type':$('#report_type').val(),

// 			'group_by':$('#group_by').val(),

// 			'trans_status':$('#trans_status').val(),

// 			'brans_type':$('#brans_type').val()

// 		 }),

// 		dataType: "JSON",

// 		type: "POST",

// 		success: function (data) {

// 			$("div.overlay").css("display", "none");

// 			var list = data.list;

// 			if(list != null && list.length > 0){

// 				var oTable = $('#inventory_report').DataTable();

// 				oTable.clear().draw();

// 				if (list != null && list.length > 0) {

// 					oTable = $('#inventory_report').dataTable({

// 					"bDestroy": true,

// 					"bInfo": true,

// 					"bFilter": true,

// 					"order": [[0, "desc"]],

// 					"scrollX": '100%',

// 					"bSort": true,

// 					"dom": 'lBfrtip',

// 					"columnDefs": [

// 						{

// 							targets: [1,2,6,7,8],

// 							className: 'dt-body-right'

// 						},

// 					],

// 					"buttons": [

// 						{

// 							extend: 'print',

// 							footer: true,

// 							title: '',

// 							messageTop: title,

// 							customize: function (win) {

// 								$(win.document.body).find('table')

// 									.addClass('compact')

// 									.css('font-size', '10px');

// 							},

// 						},

// 						{

// 							extend: 'excel',

// 							footer: true,

// 							title: "Branch Transfer Report - " + $("#dt_range").val(),

// 						}

// 					],

// 					"aaData": list,

// 					"aoColumns": [

// 						{ "mDataProp": "date_add" },

// 						{ "mDataProp": "branch_transfer_id" },

// 						{ "mDataProp": "branch_trans_code" },

// 						{ "mDataProp": "from_branch" },

// 						{ "mDataProp": "to_branch" },

// 						{ "mDataProp": "item_name" },

// 						{ "mDataProp": "pieces" },

// 						{ "mDataProp": "bt_status" },

// 						{ "mDataProp": "approved_datetime" },

// 						{ "mDataProp": "dwnload_datetime" },

// 						{ "mDataProp": "created_emp" },

// 						{ "mDataProp": "downloaded_emp" },

// 					],

// 					"footerCallback": function (row, data, start, end, display) {

// 						if (data.length > 0) {

// 							var api = this.api(), data;

// 							for (var i = 0; i <= data.length - 1; i++) {

// 								var intVal = function (i) {

// 									return typeof i === 'string' ?

// 										i.replace(/[\$,]/g, '') * 1 :

// 										typeof i === 'number' ?

// 											i : 0;

// 								};

// 								$(api.column(4).footer()).html('Total');

// 								pcs = api

// 									.column(6)

// 									.data()

// 									.reduce(function (a, b) {

// 										return intVal(a) + intVal(b);

// 									}, 0);

// 								$(api.column(6).footer()).html(money_format_india(parseFloat(pcs).toFixed(2)));

// 							}

// 						} else {

// 							var api = this.api(), data;

// 							$(api.column(4).footer()).html('');

// 							$(api.column(6).footer()).html('');

// 						}

// 					}

// 				});

// 				// oTable.fnAddData(list);

// 			   }

// 			}

// 		},

// 		error: function (error) {

// 			$("div.overlay").css("display", "none");

// 		}

// 	});

// }

//Sales Trasnfer

function tag_imgprev(curRow) {

	$('#imagepreview').attr('src', curRow.find('#img_prev').attr('src'));

	$('#imagemodal').modal('show');

}

$('#sales_transfer_search').on('click', function () {

	get_sales_transfer_details();

});

function get_sales_transfer_details() {

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $('#branch_select option:selected').toArray().map(item => item.text).join());

	var company_code = $('#company_code').val();

	var company_address1 = $('#company_address1').val();

	var company_address2 = $('#company_address2').val();

	var company_city = $('#company_city').val();

	var pincode = $('#pincode').val();

	var company_email = $('#company_email').val();

	var company_gst_number = $('#company_gst_number').val();

	var phone = $('#phone').val();

	var report_type = $('#sale_ret_filter').find(':selected').text();

	var title = "<div style='text-align: center;'><b><span style='font-size:12pt;'>" + company_code + "</span></b></br>"

		+ "<span style='font-size:11pt;'>" + company_address1 + "</span></br>"

		+ "<span style='font-size:11pt;'>" + company_address2 + company_city + "-" + pincode + "</span></br>"

		+ "<span style='font-size:11pt;'>GSTIN:" + company_gst_number + ", EMAIL:" + company_email + "</span></br>"

		+ "<span style='font-size:11pt;'>Contact :" + phone + "</span></br>"

		+ "<span style=font-size:12pt;>&nbsp;&nbsp;Sales Transfer Report - " + report_type + " - " + branch_name + " &nbsp;From&nbsp;:&nbsp;" + $('#rpt_from_date').html() + " &nbsp;&nbsp;- to " + $('#rpt_to_date').html() + " - " + $('.hidden-xs').html() + "&nbsp;&nbsp;" + getDisplayDateTime() + "</span></div>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		type: "POST",

		url: base_url + "index.php/admin_ret_reports/sales_transfer_report/ajax",

		data: { 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'from_date': $('#rpt_from_date').html(), 'to_date': $('#rpt_to_date').html(), 'id_category': ($('#category').val() != '' && $('#category').val() != undefined && $('#category').val() != null) ? $('#category').val() : 0 },

		dataType: 'JSON',

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.list;

			var oTable = $('#sales_transfer_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#sales_transfer_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"order": [[0, "asc"]],

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"fixedHeader": true,

					"paging": true,

					"bAutoWidth": false,

					"columnDefs": [

						{

							targets: [4, 5, 6, 7, , 8, 9, 10, 11, 12, 13, 14],

							className: 'dt-right'

						},

						{

							targets: [0, 1, 2, 3],

							className: 'dt-left'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', '10px');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: "Sales Transfer Report",

						}

					],

					"aaData": list,

					"aoColumns": [

						{

							"mDataProp": function (row, type, val, meta) {

								print_url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + row.bill_id;

								action_content = '<a href="' + print_url + '" target="_blank" title="Billing Receipt">SA-' + row.short_name + '-' + row.metal_code + '-' + row.sales_ref_no + '</a>'

								return action_content;

							}

						},

						{ "mDataProp": "bill_date" },

						{ "mDataProp": "from_branch" },

						{ "mDataProp": "to_branch" },

						{ "mDataProp": "piece" },

						{ "mDataProp": "gross_wt" },

						{ "mDataProp": "net_wt" },

						{ "mDataProp": "less_wt" },

						{ "mDataProp": "taxable_amt" },

						{ "mDataProp": "total_sgst" },

						{ "mDataProp": "total_cgst" },

						{ "mDataProp": "total_igst" },

						{ "mDataProp": "tax_amt" },

						{ "mDataProp": "round_off" },

						{ "mDataProp": "total_amount" },

					],

					"footerCallback": function (row, data, start, end, display) {

						if (data.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								// opcs = api

								// .column(1, {search:'applied'})

								// .data()

								// .reduce( function (a, b) {

								// 	return intVal(a) + intVal(b);

								// }, 0 );

								// $(api.column(1).footer()).html(parseFloat(opcs).toFixed(0));

								// ogwt = api

								// .column(2, {search:'applied'})

								// .data()

								// .reduce( function (a, b) {

								// 	return intVal(a) + intVal(b);

								// }, 0 );

								// $(api.column(2).footer()).html(parseFloat(ogwt).toFixed(3));

								// onwt = api

								// .column(3, {search:'applied'})

								// .data()

								// .reduce( function (a, b) {

								// 	return intVal(a) + intVal(b);

								// }, 0 );

								// $(api.column(3).footer()).html(parseFloat(onwt).toFixed(3));

								opvalue = api

									.column(4, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(4).footer()).html(parseFloat(opvalue).toFixed(0));

								inpcs = api

									.column(5, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(5).footer()).html(parseFloat(inpcs).toFixed(3));

								ingwt = api

									.column(6, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(6).footer()).html(parseFloat(ingwt).toFixed(3));

								innwt = api

									.column(7, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(7).footer()).html(parseFloat(innwt).toFixed(3));

								invalue = api

									.column(8, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(8).footer()).html(parseFloat(invalue).toFixed(2));

								outpcs = api

									.column(9, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(9).footer()).html(parseFloat(outpcs).toFixed(2));

								outgwt = api

									.column(10, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(10).footer()).html(parseFloat(outgwt).toFixed(2));

								outnwt = api

									.column(11, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(11).footer()).html(parseFloat(outnwt).toFixed(2));

								outvalue = api

									.column(12, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(12).footer()).html(parseFloat(outvalue).toFixed(2));

								clpcs = api

									.column(13, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(13).footer()).html(parseFloat(clpcs).toFixed(2));

								clgwt = api

									.column(14, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(14).footer()).html(parseFloat(clgwt).toFixed(2));

							}

						} else {

							var api = this.api(), data;

							$(api.column(1).footer()).html('');

						}

					}

				});

			}

		}

	});

}

$('#karigar_wise_sales_summary').click(function (event) {

	get_karigar_wise_sales_detail();

});

function get_karigar_wise_sales_detail() {

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $('#branch_select option:selected').toArray().map(item => item.text).join());

	var company_name = $('#company_name').val();

	var company_code = $('#company_code').val();

	var company_code = $('#company_code').val();

	var company_address1 = $('#company_address1').val();

	var company_address2 = $('#company_address2').val();

	var company_city = $('#company_city').val();

	var pincode = $('#pincode').val();

	var company_email = $('#company_email').val();

	var company_gst_number = $('#company_gst_number').val();

	var phone = $('#phone').val();

	$(".overlay").css("display", "block");

	var title = "<div style='text-align: center;'><b><span style='font-size:12pt;'>" + company_code + "</span></b></br>"

		+ "<span style='font-size:11pt;'>" + company_address1 + "</span></br>"

		+ "<span style='font-size:11pt;'>" + company_address2 + company_city + "-" + pincode + "</span></br>"

		+ "<span style='font-size:11pt;'>GSTIN:" + company_gst_number + ", EMAIL:" + company_email + "</span></br>"

		+ "<span style='font-size:11pt;'>Contact :" + phone + "</span></br>"

		+ "<span style=font-size:12pt;>&nbsp;&nbsp;Karigar Wise Sale Reports - " + branch_name + " &nbsp; &nbsp;FROM&nbsp;:&nbsp;" + $('#rpt_payments1').html() + " &nbsp;&nbsp;TO&nbsp;&nbsp; " + $('#rpt_payments2').html() + " - " + $('.hidden-xs').html() + "</span>";

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/karigar_wise_sales_detail/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: { 'from_date': $('#rpt_payments1').html(), 'to_date': $('#rpt_payments2').html(), 'product_id': $('#prod_select').val(), 'design_id': $('#des_select').val(), 'id_sub_design': $('#sub_des_select').val(), 'branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'id_karigar': $('#karigar').val() },

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var oTable = $('#karigar_wise_sales_list').DataTable();

			oTable.clear().draw();

			list = data

			if (data != null && data.length > 0) {

				oTable = $('#karigar_wise_sales_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"columnDefs": [

						{

							targets: [4, 5, 6, 7, 8, 9],

							className: 'dt-right'

						},

						{

							targets: [0, 1, 2, 3],

							className: 'dt-left'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: "",

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: "Karigar Wise Sales Report",

						}

					],

					"aaData": data,

					"aoColumns": [

						{ "mDataProp": "kaigar_name" },

						{ "mDataProp": "product_name" },

						{ "mDataProp": "design_name" },

						{ "mDataProp": "sub_design_name" },

						{ "mDataProp": "tot_pcs" },

						{ "mDataProp": "tot_gwt" },

						{ "mDataProp": "sold_pcs" },

						{ "mDataProp": "sold_wt" },

						{ "mDataProp": "bal_pcs" },

						{ "mDataProp": "bal_wt" },

					],

					"footerCallback": function (row, data, start, end, display) {

						var cshtotal = 0;

						if (data.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								total_value = api

									.column(4)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(4).footer()).html(parseInt(total_value));

								total_value = api

									.column(5)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(5).footer()).html(parseFloat(total_value).toFixed(3));

								total_value = api

									.column(6)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(6).footer()).html(parseInt(total_value));

								total_value = api

									.column(7)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(7).footer()).html(parseFloat(total_value).toFixed(3));

								total_value = api

									.column(8)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(8).footer()).html(parseInt(total_value));

								total_value = api

									.column(9)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(9).footer()).html(parseFloat(total_value).toFixed(3));

							}

						} else {

							var api = this.api(), data;

							$(api.column(0).footer()).html('');

							$(api.column(4).footer()).html('');

							$(api.column(5).footer()).html('');

							$(api.column(6).footer()).html('');

							$(api.column(7).footer()).html('');

							$(api.column(8).footer()).html('');

							$(api.column(9).footer()).html('');

						}

					}

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function set_stock_age_dynamic_report(branch = "") {

	$("div.overlay").css("display", "block");

	var id_branch = ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val());

	let age_from = $('#age_from').val();

	let age_to = $('#age_to').val();

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/stock_age_analysis/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'id_branch': id_branch, 'id_product': $("#prod_select").val(), 'id_metal': $("#metal").val(), 'id_ret_category': $("#category").val(), age_from, age_to }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.list;

			$('#total_count').text(list.length);

			var oTable = $('#stock_age_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#stock_age_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"order": [[0, "asc"]],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: "Stock Age Analysis",

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: "Stock Age Analysis",

						}

					],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "pro_id" },

						{ "mDataProp": "product_name" },

						{ "mDataProp": "age" },

						{

							"mDataProp": function (row, type, val, meta) {

								var url = base_url + `index.php/admin_ret_reports/stock_age/tag_list/${age_from}/${age_to}/${row.pro_id}/${id_branch}`;

								return '<a href=' + url + ' target="_blank">' + row.pieces + '</a>';

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var url = base_url + `index.php/admin_ret_reports/stock_age/tag_list/${age_from}/${age_to}/${row.pro_id}/${id_branch}`;

								return '<a href=' + url + ' target="_blank">' + row.gross_wt + '</a>';

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var url = base_url + `index.php/admin_ret_reports/stock_age/tag_list/${age_from}/${age_to}/${row.pro_id}/${id_branch}`;

								return '<a href=' + url + ' target="_blank">' + row.net_wt + '</a>';

							}

						},

					],

				});

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function get_Active_purity() {

	$('#select_purity option').remove();

	$(".overlay").css('display', 'block');

	$.ajax({

		type: 'POST',

		url: base_url + 'index.php/admin_ret_catalog/category/cat_purity',

		dataType: 'json',

		data: { 'id_category': $('#category').val() },

		success: function (data) {

			console.log(data);

			var id_purity = $('#id_purity').val();

			$.each(data, function (key, item) {

				$('#select_purity').append(

					$("<option></option>")

						.attr("value", item.id_purity)

						.text(item.purity)

				);

			});

			$("#select_purity").select2({

				placeholder: "Select Purity",

				allowClear: true

			});

			if ($("#select_purity").length) {

				$("#select_purity").select2("val", (id_purity != '' && id_purity > 0 ? id_purity : ''));

			}

			$(".overlay").css("display", "none");

		}

	});

}

function get_irn_details() {

	var company_name = $('#company_name').val();

	var from_date = $('#rpt_payments1').html();

	var to_date = $('#rpt_payments2').html();

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "IRN- REPORT ";

	var product = $('#product').val() != '' && $('#product').val() != undefined ? $('#product').val() + " - " : '';

	var category = $('#category option:selected').val() != '' && $('#category option:selected').val() != undefined ? $('#category option:selected').html() + " - " : '';

	var optional = '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		type: 'POST',

		url: base_url + "index.php/admin_ret_reports/irn_report/ajax",

		dataType: 'JSON',

		data: { 'from_date': $('#rpt_payments1').html(), 'to_date': $('#rpt_payments2').html(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'report_type': $('#irn_rprt_type').val() },

		success: function (data) {

			$("div.overlay").css("display", "none");

			if ($('#irn_rprt_type').val() == 1) { //B2B Sales Invoice

				$("#irn_details > tbody > tr").remove();

				$('#irn_details').dataTable().fnClearTable();

				$('#irn_details').dataTable().fnDestroy();

				console.log(data);

				var trHTML = '';

				var data = data.list;

				var i = 1;

				$.each(data, function (idx, bill) {

					var bill_url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + bill.bill_id;

					if (bill.cusdel_irn != null && bill.cusdel_irn != undefined && bill.cusdel_irn != '' && bill.cusdel_irn != '-' && bill.cusdel_irn.length > 6) {

						var img_src = base_url + 'einvqrcode/' + bill.cusdel_irn + '.jpg';

					}

					else {

						var img_src = base_url + 'assets/img/no_image.png';

					}

					var image = "<img  class='img_src' id='img_prev' src=" + img_src + "  width='35' height='35' onClick=tag_imgprev($(this).closest('tr')) ></img>"

					trHTML += '<tr class="sales">' +

						'<td>' + i + '</td>' +

						'<td>' + '<a href="' + bill_url + '"  target="_blank" >' + bill.bill_no + '</a>' + '</td>' +

						'<td>' + (bill.is_einvoice == 0 ? '<a target="_blank" class="btn btn-success" href="' + base_url + "index.php/admin_ret_billing/generateEinvoice/" + bill.bill_id + '"><i class="fa fa-upload" aria-hidden="true"></i></a>' : '') + '</td>' +

						'<td>' + bill.bill_date + '</td>' +

						'<td>' + bill.firstname + '</td>' +

						'<td>' + bill.gst_number + '</td>' +

						'<td>' + bill.pan + '</td>' +

						'<td>' + bill.state_name + '</td>' +

						'<td>' + bill.piece + '</td>' +

						'<td>' + bill.gross_wt + '</td>' +

						'<td>' + bill.net_wt + '</td>' +

						'<td>' + bill.stn_wt + '</td>' +

						'<td>' + bill.taxable_amt + '</td>' +

						'<td>' + bill.tax_percentage + '</td>' +

						'<td>' + bill.total_cgst + '</td>' +

						'<td>' + bill.total_sgst + '</td>' +

						'<td>' + bill.total_igst + '</td>' +

						'<td>' + bill.item_total_tax + '</td>' +

						'<td>' + bill.round_off_amt + '</td>' +

						'<td>' + bill.item_cost + '</td>' +

						'<td>' + image + '</td>' +

						'<td>' + bill.cusdel_irn + '</td>' +

						'<td>' + bill.ack_no + '</td>' +

						'</tr>';

					i++;

				});

				$('#irn_details > tbody').html(trHTML);

				if (!$.fn.DataTable.isDataTable('#irn_details')) {

					oTable = $('#irn_details').dataTable({

						"bDestroy": true,

						"bInfo": true,

						"scrollX": '100%',

						"paging": true,

						"dom": 'Bfrtip',

						"bAutoWidth": false,

						"responsive": true,

						"columnDefs": [

							{

								targets: [1, 3, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 21, 22],

								className: 'dt-body-right'

							},

							{

								targets: [4, 5, 6, 7],

								className: 'dt-body-left'

							},

						],

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: '',

								messageTop: title,

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact');

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', '10px')

										.css('font-family', 'sans-serif');

								},

								exportOptions: {

									columns: ':visible',

									stripHtml: false

								}

							},

							{

								extend: 'excel',

								footer: true,

								title: 'IRN-REPORT',

							}

						],

					});

				}

			} else if ($('#irn_rprt_type').val() == 2) { //Purchase Return Invoice

				$("#irn_pur_details > tbody > tr").remove();

				$('#irn_pur_details').dataTable().fnClearTable();

				$('#irn_pur_details').dataTable().fnDestroy();

				console.log(data);

				var trHTML = '';

				var data = data.list;

				var i = 1;

				$.each(data, function (idx, bill) {

					var bill_url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + bill.bill_id;

					if (bill.cusdel_irn != null && bill.cusdel_irn != undefined && bill.cusdel_irn != '' && bill.cusdel_irn != '-' && bill.cusdel_irn.length > 6) {

						var img_src = base_url + 'einvqrcode/' + bill.cusdel_irn + '.jpg';

					}

					else {

						var img_src = base_url + 'assets/img/no_image.png';

					}

					var image = "<img  class='img_src' id='img_prev' src=" + img_src + "  width='35' height='35' onClick=tag_imgprev($(this).closest('tr')) ></img>"

					trHTML += '<tr class="sales">' +

						'<td>' + i + '</td>' +

						'<td>' + '<a href="' + bill_url + '"  target="_blank" >' + bill.bill_no + '</a>' + '</td>' +

						'<td>' + (bill.is_einvoice == 0 ? '<a target="_blank" class="btn btn-success" href="' + base_url + "index.php/admin_ret_purchase/generateEinvoice/" + bill.bill_id + '"><i class="fa fa-upload" aria-hidden="true"></i></a>' : '') + '</td>' +

						'<td>' + bill.bill_date + '</td>' +

						'<td>' + bill.firstname + '</td>' +

						'<td>' + bill.gst_number + '</td>' +

						'<td>' + bill.pan + '</td>' +

						'<td>' + bill.state_name + '</td>' +

						'<td>' + bill.piece + '</td>' +

						'<td>' + bill.gross_wt + '</td>' +

						'<td>' + bill.net_wt + '</td>' +

						'<td>' + bill.stn_wt + '</td>' +

						'<td>' + bill.taxable_amt + '</td>' +

						'<td>' + bill.tax_percentage + '</td>' +

						'<td>' + bill.total_cgst + '</td>' +

						'<td>' + bill.total_sgst + '</td>' +

						'<td>' + bill.total_igst + '</td>' +

						'<td>' + bill.item_total_tax + '</td>' +

						'<td>' + bill.round_off_amt + '</td>' +

						'<td>' + bill.item_cost + '</td>' +

						'<td>' + image + '</td>' +

						'<td>' + bill.cusdel_irn + '</td>' +

						'<td>' + bill.ack_no + '</td>' +

						'</tr>';

					i++;

				});

				$('#irn_pur_details > tbody').html(trHTML);

				if (!$.fn.DataTable.isDataTable('#irn_pur_details')) {

					oTable = $('#irn_pur_details').dataTable({

						// "bSort": true,

						"bDestroy": true,

						"bInfo": true,

						"scrollX": '100%',

						"paging": true,

						"dom": 'Bfrtip',

						"bAutoWidth": false,

						"responsive": true,

						"columnDefs": [

							{

								targets: [1, 3, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 21, 22],

								className: 'dt-body-right'

							},

							{

								targets: [4, 5, 6, 7],

								className: 'dt-body-left'

							},

						],

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: '',

								messageTop: title,

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact');

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', '10px')

										.css('font-family', 'sans-serif');

								},

								exportOptions: {

									columns: ':visible',

									stripHtml: false

								}

							},

							{

								extend: 'excel',

								footer: true,

								title: 'IRN-REPORT',

							}

						],

					});

				}

			}

		},

		error: function (error) {

			alert('Error Occured');

		}

	})

}

function get_categorybookstock_report() {

	$("div.overlay").css("display", "block");

	var dt_range = ($("#dt_range").val()).split('-');

	var company_name = $('#company_name').val();

	var company_code = $('#company_code').val();

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $('#branch_select option:selected').toArray().map(item => item.text).join());

	var company_code = $('#company_code').val();

	var company_address1 = $('#company_address1').val();

	var company_address2 = $('#company_address2').val();

	var company_city = $('#company_city').val();

	var pincode = $('#pincode').val();

	var company_email = $('#company_email').val();

	var company_gst_number = $('#company_gst_number').val();

	var phone = $('#phone').val();

	var title = "<div style='text-align: center;'><b><span style='font-size:12pt;'>" + company_code + "</span></b></br>"

		+ "<span style='font-size:11pt;'>" + company_address1 + "</span></br>"

		+ "<span style='font-size:11pt;'>" + company_address2 + company_city + "-" + pincode + "</span></br>"

		+ "<span style='font-size:11pt;'>GSTIN:" + company_gst_number + ", EMAIL:" + company_email + "</span></br>"

		+ "<span style='font-size:11pt;'>Contact :" + phone + "</span></br>"

		+ "<span style=font-size:12pt;>Categorywise Book Stock Report -  &nbsp;&nbsp; From: " + dt_range[0] + " To:" + dt_range[1] + " - " + $('.hidden-xs').html() + "</span>";

	my_Date = new Date();

	var transitemtype = $('#selecttransitemtypes').val();

	var selectedcat = 0;

	if (transitemtype == '0') {

		selectedcat = 0;

	} else if (transitemtype == '5') {

		selectedcat = $('#oldcategory').val();

	} else {

		selectedcat = $('#category').val();

	}

	//($('#transitemtype').val()!='' && $('#transitemtype').val()!=undefined && $('#transitemtype').val() != null) ? $('#transitemtype').val(): 0

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/bookstocks/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({

			'dt_range': $("#dt_range").val(),

			'id_branch': $("#branch_select").val(),

			'id_category': selectedcat,

			'transitemtype': $('#selecttransitemtypes').val()

		}),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			console.log(data);

			var list = data.list;

			print_stock_issue = list;

			console.log(data);

			var oTable = $('#categorywise_stock_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#categorywise_stock_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"order": [[0, "asc"]],

					"lengthMenu": [[-1, 25, 50, 100, 250], ["All", 25, 50, 100, 250]],

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"columnDefs": [

						{

							targets: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15],

							className: 'dt-body-right'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							stripHtml: false,

							title: "",

							messageTop: title,

							exportOptions: {

								columns: ':visible'

							},

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: "Categorywise Stock Report - " + branch_name + " From: " + dt_range[0] + " To:" + dt_range[1],

						},

						{

							extend: 'colvis',

							collectionLayout: 'fixed columns',

							collectionTitle: 'Column visibility control'

						},

					],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "category_name" },

						{

							"mDataProp": function (row, type, val, meta) {

								var op_blc_pcs = row.op_blc_pcs;

								return (op_blc_pcs);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var op_blc_gwt = row.op_blc_gwt;

								return money_format_india(op_blc_gwt);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var op_blc_nwt = row.op_blc_nwt;

								return money_format_india(op_blc_nwt);

							}

						},

						{ "mDataProp": "op_blc_stnwt" },

						{ "mDataProp": "op_blc_diawt" },

						{

							"mDataProp": function (row, type, val, meta) {

								var inw_pcs = row.inw_pcs;

								return (inw_pcs);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var inw_gwt = row.inw_gwt;

								return money_format_india(inw_gwt);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var inw_nwt = row.inw_nwt;

								return money_format_india(inw_nwt);

							}

						},

						{ "mDataProp": "inw_stnwt" },

						{ "mDataProp": "inw_diawt" },

						{

							"mDataProp": function (row, type, val, meta) {

								var out_piece = row.out_piece;

								return (out_piece);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var out_gwt = row.out_gwt;

								return money_format_india(out_gwt);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var out_netwt = row.out_netwt;

								return money_format_india(out_netwt);

							}

						},

						{ "mDataProp": "out_stnwt" },

						{ "mDataProp": "out_diawt" },

						{

							"mDataProp": function (row, type, val, meta) {

								var closing_pcs = row.closing_pcs;

								return (closing_pcs);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var closing_gwt = row.closing_gwt;

								return money_format_india(closing_gwt);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var closing_nwt = row.closing_nwt;

								return money_format_india(closing_nwt);

							}

						},

						{ "mDataProp": "cl_stnwt" },

						{ "mDataProp": "cl_diawt" },

					],

					"footerCallback": function (row, data, start, end, display) {

						if (data.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								opcs = api

									.column(1, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(1).footer()).html((parseFloat(opcs).toFixed(0)));

								ogwt = api

									.column(2, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(2).footer()).html(money_format_india(parseFloat(ogwt).toFixed(3)));

								onwt = api

									.column(3, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(3).footer()).html(money_format_india(parseFloat(onwt).toFixed(3)));

								opstnwt = api

									.column(4, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(4).footer()).html(money_format_india(parseFloat(opstnwt).toFixed(2)));

								opdiawt = api

									.column(5, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(5).footer()).html(money_format_india(parseFloat(opdiawt).toFixed(2)));

								inpcs = api

									.column(6, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(6).footer()).html((parseFloat(inpcs).toFixed(0)));

								ingwt = api

									.column(7, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(7).footer()).html(money_format_india(parseFloat(ingwt).toFixed(3)));

								innwt = api

									.column(8, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(8).footer()).html(money_format_india(parseFloat(innwt).toFixed(3)));

								inw_stnwt = api

									.column(9, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(9).footer()).html(money_format_india(parseFloat(inw_stnwt).toFixed(3)));

								inw_diawt = api

									.column(10, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(10).footer()).html(money_format_india(parseFloat(inw_diawt).toFixed(3)));

								outpcs = api

									.column(11, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(11).footer()).html((parseFloat(outpcs).toFixed(0)));

								outgwt = api

									.column(12, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(12).footer()).html(money_format_india(parseFloat(outgwt).toFixed(3)));

								outnwt = api

									.column(13, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(13).footer()).html(money_format_india(parseFloat(outnwt).toFixed(3)));

								out_stnwt = api

									.column(14, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(14).footer()).html(money_format_india(parseFloat(out_stnwt).toFixed(3)));

								out_diawt = api

									.column(15, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(15).footer()).html(money_format_india(parseFloat(out_diawt).toFixed(3)));

								clpcs = api

									.column(16, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(16).footer()).html((parseFloat(clpcs).toFixed(0)));

								clgwt = api

									.column(17, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(17).footer()).html(money_format_india(parseFloat(clgwt).toFixed(3)));

								clnwt = api

									.column(18, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(18).footer()).html(money_format_india(parseFloat(clnwt).toFixed(3)));

								clc_stnwt = api

									.column(19, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(19).footer()).html(parseFloat(clc_stnwt).toFixed(3));

								clc_diawt = api

									.column(20, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(20).footer()).html(parseFloat(clc_diawt).toFixed(3));

							}

						} else {

							var api = this.api(), data;

							$(api.column(1).footer()).html('');

						}

					}

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function get_retagging_list() {

	var from_date = $('#rpt_from_date').html();

	var to_date = $('#rpt_to_date').html();

	var company_name = $('#company_name').val();

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "RETAGGING REPORT";

	var optional = '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/retagging_report/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: { 'from_date': $('#rpt_from_date').html(), 'to_date': $('#rpt_to_date').html(), 'receipt_type': $('#receipt_type').val(), 'karigar': $('#karigar').val(), 'id_category': $('#category').val(), 'metal': $('#metal').val(), 'report_type': $('#report_type').val(), 'bt_code': $('#bt_code').val() },

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			$("#retagging_item_list > tbody > tr").remove();

			$('#retagging_item_list').dataTable().fnClearTable();

			$('#retagging_item_list').dataTable().fnDestroy();

			if (list != null) {

				trHTML = '';

				tfootHTML = '';

				var tot_ret_amt = 0;

				var tot_sales_wast = 0;

				var total_pur_wast = 0;

				// $.each(list, function (i, plbill) {

				// trHTML += '<tr>' +

				// 	'<td><strong>' + i + '</strong></td>'

				// 	+ '<td></td>'

				// 	+ '<td></td>'

				// 	+ '<td></td>'

				// 	+ '<td></td>'

				// 	+ '<td></td>'

				// 	+ '<td></td>'

				// 	+ '<td></td>'

				// 	+ '<td></td>'

				// 	+ '<td></td>'

				// 	+ '<td></td>'

				// 	+ '<td></td>'

				// 	+ '<td></td>'

				// 	+ '<td></td>'

				// 	+ '<td></td>'

				// 	+ '<td></td>'

				// 	+ '<td></td>'

				// 	+ '<td></td>'

				// '</tr>';

				var tot_retag_gwt = 0;

				var tot_retag_nwt = 0;

				var tot_retag_diawt = 0;

				var tot_inw_gwt = 0;

				var tot_inw_nwt = 0;

				var tot_inw_diawt = 0;

				var tot_ret_gwt = 0;

				var tot_ret_nwt = 0;

				var tot_return_diawt = 0;

				var tot_closing_gwt = 0;

				var tot_closing_nwt = 0;

				var tot_closing_diawt = 0;

				$.each(list, function (i, item) {

					tot_retag_gwt += parseInt(item.retag_gwt);

					tot_retag_nwt += parseFloat(item.retag_nwt);

					tot_retag_diawt += parseFloat(item.retag_diawt);

					tot_inw_gwt += parseFloat(item.inw_gwt);

					tot_inw_nwt += parseFloat(item.inw_nwt);

					tot_inw_diawt += parseFloat(item.inw_diawt);

					tot_ret_gwt += parseFloat(item.ret_gwt);

					tot_ret_nwt += parseFloat(item.ret_nwt);

					tot_return_diawt += parseFloat(item.return_diawt);

					tot_closing_gwt += parseFloat(item.closing_gwt);

					tot_closing_nwt += parseFloat(item.closing_nwt);

					tot_closing_diawt += parseFloat(item.closing_diawt);

					trHTML += '<tr>' +

						+'<td>' + item.branch_trans_code + '</td>'

						+ '<td>' + item.bt_date + '</td>'

						+ '<td>' + item.process_date + '</td>'

						+ '<td>' + item.karigar_name + '</td>'

						+ '<td>' + item.op_blc_gwt + '</td>'

						+ '<td>' + item.retag_nwt + '</td>'

						+ '<td>' + item.retag_diawt + '</td>'

						+ '<td>' + item.inw_gwt + '</td>'

						+ '<td>' + item.inw_nwt + '</td>'

						+ '<td>' + item.inw_diawt + '</td>'

						+ '<td>' + item.ref_no + '</td>'

						+ '<td>' + item.ret_gwt + '</td>'

						+ '<td>' + item.ret_nwt + '</td>'

						+ '<td>' + item.return_diawt + '</td>'

						+ '<td>' + item.closing_gwt + '</td>'

						+ '<td>' + item.closing_nwt + '</td>'

						+ '<td>' + item.closing_diawt + '</td>'

					'</tr>';

				});

				trHTML += '<tr style="color:red">'

					+ '<td><strong>Grand Total</strong></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td><strong>' + money_format_india(parseFloat(tot_retag_gwt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(tot_retag_nwt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(tot_retag_diawt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(tot_inw_gwt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(tot_inw_nwt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(tot_inw_diawt).toFixed(3)) + '</strong></td>'

					+ '<td></td>'

					+ '<td><strong>' + money_format_india(parseFloat(tot_ret_gwt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(tot_ret_nwt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(tot_return_diawt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(tot_closing_gwt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(tot_closing_nwt).toFixed(3)) + '</strong></td>'

					+ '<td><strong>' + money_format_india(parseFloat(tot_closing_diawt).toFixed(3)) + '</strong></td>'

				'</tr>';

				// });

				/* += '<tr style="font-weight:bold;">' +

							+'<td></td>'

							+'<td></td>'

							+'<td></td>'

							+'<td></td>'

							+'<td></td>'

							+'<td>GrandTotal</td>'

							+'<td></td>'

							+'<td></td>'

							+'<td></td>'

							+'<td></td>'

							+'<td></td>'

							+'<td></td>'

							+'<td></td>'

							+'<td></td>'

							+'<td></td>'

							+'<td></td>'

							'</tr>';*/

				$('#retagging_item_list > tbody').html(trHTML);

				// Check and initialise datatable

				if (!$.fn.DataTable.isDataTable('#retagging_item_list')) {

					oTable = $('#retagging_item_list').dataTable({

						"bSort": false,

						"bInfo": true,

						"scrollX": '100%',

						"dom": 'lBfrtip',

						"paging": false,

						"fixedHeader": true,

						"columnDefs": [

							{

								targets: [7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17],

								className: 'dt-body-right'

							},

							{

								targets: [0, 1, 2, 3, 4, 5,],

								className: 'dt-body-left'

							},

						],

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: '',

								messageTop: title,

								exportOptions: {

									columns: ':visible'

								},

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', '12px')

										.css('font-family', 'sans-serif');

								},

							},

							'colvis',

							{

								extend: 'excel',

								footer: true,

								title: 'Retagging Report',

							}

						],

					});

				}

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//tag wise profit list

//stock report

function set_tag_items() {

	var company_name = $('#company_name').val();

	var from_date = '';

	var to_date = '';

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "Design Wise Tag Items"

	var metal = $('#metal option:selected').html() != '' && $('#metal option:selected').html() != undefined ? $('#metal option:selected').html() + " - " : '';

	var category = $('#category option:selected').html() != '' && $('#category option:selected').html() != undefined ? $('#category option:selected').html() + " - " : '';

	var prod_select = $('#prod_select option:selected').html() != '' && $('#prod_select option:selected').html() != undefined ? $('#prod_select option:selected').html() + " - " : '';

	var des_select = $('#des_select option:selected').html() != '' && $('#des_select option:selected').html() != undefined ? $('#des_select option:selected').html() + " - " : '';

	var select_collection = $('#select_collection option:selected').html() != '' && $('#select_collection option:selected').html() != undefined ? $('#select_collection option:selected').html() + " - " : '';

	var select_size = $('#select_size option:selected').html() != '' && $('#select_size option:selected').html() != undefined ? $('#select_size option:selected').html() + " - " : '';

	var karigar = $('#karigar option:selected').html() != '' && $('#karigar option:selected').html() != undefined ? $('#karigar option:selected').html() + " - " : '';

	var optional = metal + category + prod_select + des_select + select_collection + select_size + karigar;

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/tagged_item_report/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'id_category': $('#category').val(), 'group_by': $('#group_by').val(), 'id_product': $('#prod_select').val(), 'id_design': $("#des_select").val(), 'from_lotno': $("#from_lotno").val(), 'to_lotno': $("#to_lotno").val(), 'id_sub_design': $('#sub_des_select').val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'from_weight': $('#from_weight').val(), 'to_weight': $('#to_weight').val(), 'id_size': $('#select_size').val(), 'id_metal': $('#metal').val(), 'id_collection': $('#select_collection').val(), 'id_karigar': $('#karigar').val(), 'id_collection': $('#select_collection').val(), 'id_section': $('#section_select').val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.list;

			var stone_details = data.list.stone_details;

			var multi_metal_details = data.list.multi_metal_details;

			console.log(stone_details);

			console.log(multi_metal_details);

			$("#tag_items_list > tbody > tr").remove();

			$('#tag_items_list').dataTable().fnClearTable();

			$('#tag_items_list').dataTable().fnDestroy();

			$("#tag_item_branchwise > tbody > tr").remove();

			$('#tag_item_branchwise').dataTable().fnClearTable();

			$('#tag_item_branchwise').dataTable().fnDestroy();

			if (list != '') {

				var trHtml = '';

				var tot_no_of_tags = 0;

				var total_piece = 0;

				var tot_gross_wt = 0;

				var tot_net_wt = 0;

				var tot_grm_wt = 0;

				var tot_ct_wt = 0;

				var tot_nt_stn_pcs = 0;

				var tot_nt_stn_wt = 0;

				var tot_dia_stn_pcs = 0;

				var tot_dia_stn_wt = 0;

				var tot_tag_mc_value = 0;

				var tot_retail_max_wastage_percent = 0;

				var tot_wastage_weight = 0;

				var tot_sales_value = 0;

				var tot_attrvalues = 0;

				var tot_tot_est = 0;

				export_list = [];

				export_list = list;

				var stock_details = data.stock_details;

				var tot_weight = 0;

				var tot_piece = 0;

				var Sno = 1;

				$.each(list, function (skey, item_details) {

					var no_of_tags = 0;

					var piece = 0;

					var gross_wt = 0;

					var net_wt = 0;

					var grm_wt = 0;

					var ct_wt = 0;

					var nt_stn_pcs = 0;

					var nt_stn_wt = 0;

					var dia_stn_pcs = 0;

					var dia_stn_wt = 0;

					var tag_mc_value = 0;

					var retail_max_wastage_percent = 0;

					var wastage_weight = 0;

					var sales_value = 0;

					var attrvalues = 0;

					var tot_est = 0;

					var tag_mc_type = 0;

					if ($('#group_by').val() != 0) {

						trHtml += '<tr>'

							+ '<td></td>'

							+ '<td style="text-align:left;"><strong>' + skey + '</strong></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '</tr>';

					}

					$.each(item_details, function (tkey, item) {

						tot_piece += parseFloat(item.piece);

						tot_weight += parseFloat(item.gross_wt);

						no_of_tags += parseFloat(item.tag_count);

						piece += parseFloat(item.piece);

						gross_wt += parseFloat(item.stone_type == 0 ? item.gross_wt : 0);

						net_wt += parseFloat(item.stone_type == 0 ? item.net_wt : 0);

						grm_wt += parseFloat((item.stone_type == 1 && (item.tag_uom == 1 || item.tag_uom == '')) ? item.gross_wt : 0);

						ct_wt += parseFloat((item.stone_type == 1 && item.tag_uom == 6) ? item.gross_wt : 0);

						nt_stn_pcs += parseFloat(item.nt_stn_pcs);

						nt_stn_wt += parseFloat(item.nt_stn_wt);

						dia_stn_pcs += parseFloat(item.dia_stn_pcs);

						dia_stn_wt += parseFloat((item.stone_type == 2 || item.dia_stn_wt > 0) ? parseFloat(parseFloat(item.dia_stn_wt) + parseFloat(item.gross_wt)) : 0);

						tag_mc_value += parseFloat(item.tag_mc_value);

						retail_max_wastage_percent += parseFloat(item.retail_max_wastage_percent);

						wastage_weight += parseFloat(item.wastage_weight);

						sales_value += parseFloat(item.sales_value);

						attrvalues += parseFloat(item.attrvalues);

						tot_est += parseFloat(item.tot_est);

						tag_mc_type = parseFloat(item.tag_mc_type);

						//  var action_content="";

						// if (item.stone_details.length > 0 || item.multi_metal_details.length > 0) {

						// 	action_content ='<span class="drill-val"><i class="fa fa-chevron-circle-down text-teal"></i>' + item.tag_lot_id + '</span>';

						// } else {

						// 	action_content ='<span class="badge bg-red">' + item.tag_lot_id + '</span>';

						// }

						trHtml += '<tr>'

							+ '<td>' + ($('#group_by').val() == 1 ? (parseFloat(tkey + 1)) : (Sno++)) + '</td>'

							+ '<td style="text-align:left;">' + item.tag_lot_id + '</td>'

							// +'<td style="text-align:left;">' + ((item.stone_details.length > 0 ||item.multi_metal_details.length > 0) ? '<span class="drill-val"><i class="fa fa-chevron-circle-down text-teal"></i>' + item.tag_lot_id + '</span>' : '<span class="badge bg-red">' + item.tag_lot_id + '</span>') + '</td>'

							+ '<td>' + (item.po_ref_no != "" ? item.po_ref_no : '') + '</td>'

							+ '<td>' + (item.order_no != "" ? item.order_no : '') + '</td>'

							+ '<td>' + (item.karigarname != "" ? item.karigarname : '') + '</td>'

							+ '<td>' + ((item.tag_img != null && item.tag_img != undefined && item.tag_img != '') ? '<img class="img_src" id="img_prev" src="' + base_url + 'assets/img/tag/' + item.tag_img + '" width="35" height="35" onClick="tag_imgprev($(this).closest(\'tr\'))" />' : '<img class="img_src" id="img_prev" src="' + base_url + 'assets/img/no_image.png" width="35" height="35" onClick="tag_imgprev($(this).closest(\'tr\'))" />') + '</td>'

							+ '<td>' + (item.tag_code != "" ? item.tag_code : '') + '</td>'

							+ '<td>' + (item.old_tag_id != "" ? item.old_tag_id : '') + '</td>'

							+ '<td>' + (item.tag_date != "" ? item.tag_date : '') + '</td>'

							+ '<td>' + (item.branch_name != "" ? item.branch_name : '') + '</td>'

							+ '<td>' + (item.catname != "" ? item.catname : '') + '</td>'

							+ '<td>' + (item.purity != "" ? item.purity : '') + '</td>'

							+ '<td>' + (item.product_name != "" ? item.product_name : '') + '</td>'

							+ '<td>' + (item.design_name != "" ? item.design_name : '') + '</td>'

							+ '<td>' + (item.sub_design_name != "" ? item.sub_design_name : '') + '</td>'

							+ '<td>' + (item.collection_name != "" ? item.collection_name : '') + '</td>'

							+ '<td>' + (item.section_name != "" ? item.section_name : '') + '</td>'

							+ '<td>' + (item.huid != "" ? item.huid : '') + '</td>'

							+ '<td>' + (item.tag_count != "" ? item.tag_count : '') + '</td>'

							+ '<td>' + (item.piece > 0 ? money_format_india(parseFloat(item.piece).toFixed(0)) : '') + '</td>'

							+ '<td>' + (item.gross_wt > 0 && item.stone_type == 0 ? money_format_india(parseFloat(item.gross_wt).toFixed(3)) : '') + '</td>'

							+ '<td>' + (item.net_wt > 0 && item.stone_type == 0 ? money_format_india(parseFloat(item.net_wt).toFixed(3)) : '') + '</td>'

							+ '<td>' + (item.gross_wt > 0 && (item.stone_type == 1 && (item.tag_uom == 1 || item.tag_uom == '')) ? money_format_india(parseFloat(item.gross_wt).toFixed(3)) : '') + '</td>'

							+ '<td>' + (item.gross_wt > 0 && (item.stone_type == 1 && item.tag_uom == 6) ? money_format_india(parseFloat(item.gross_wt).toFixed(3)) : '') + '</td>'

							+ '<td>' + (item.nt_stn_pcs > 0 ? money_format_india(parseFloat(item.nt_stn_pcs).toFixed(0)) : '') + '</td>'

							+ '<td>' + (item.nt_stn_wt > 0 ? money_format_india(parseFloat(item.nt_stn_wt).toFixed(3)) : '') + '</td>'

							+ '<td>' + (item.dia_stn_pcs > 0 ? money_format_india(parseFloat(item.dia_stn_pcs).toFixed(0)) : '') + '</td>'

							+ '<td>' + (item.dia_stn_wt > 0 || item.stone_type == 2 ? money_format_india(parseFloat(parseFloat(item.dia_stn_wt) + parseFloat(item.gross_wt)).toFixed(3)) : '') + '</td>'

							+ '<td>' + (item.size_name != "" ? item.size_name : '') + '</td>'

							+ '<td>' + (item.retail_max_wastage_percent > 0 ? item.retail_max_wastage_percent : '') + '</td>'

							+ '<td>' + (item.tag_mc_type == 2 ? money_format_india(parseFloat(item.tag_mc_value).toFixed(0)) : '-') + '</td>'

							+ '<td>' + (item.tag_mc_type == 1 ? money_format_india(parseFloat(item.tag_mc_value).toFixed(0)) : '-') + '</td>'

							+ '<td>' + (item.sales_value > 0 ? money_format_india(parseFloat(item.sales_value).toFixed(3)) : '') + '</td>'

							+ '<td>' + (item.attrvalues != "" ? item.attrvalues : '') + '</td>'

							+ '<td>' + (item.cert_no != "" ? item.cert_no : '') + '</td>'

							+ '<td>' + (item.style_code != "" ? item.style_code : '') + '</td>'

							+ '<td>' + (item.tot_est != "" ? '<span class="badge bg-red">' + item.tot_est + '</span>' : '') + '</td>'

							+ '<td>' + (item.emp_name != "" ? item.emp_name : '') + '</td>'

							+ '<td>' + (item.age != "" ? item.age : '') + '</td>'

							+ '<td>' + (item.remark != "" ? item.remark : '') + '</td>'

						'</tr>';

					});

					if ($('#group_by').val() != 0) {

						trHtml += '<tr style="font-weight:bold; color:red">'

							+ '<td>SUB TOTAL</td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td>' + money_format_india(parseFloat(no_of_tags).toFixed(0)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(piece).toFixed(0)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(gross_wt).toFixed(3)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(net_wt).toFixed(3)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(grm_wt).toFixed(3)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(ct_wt).toFixed(3)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(nt_stn_pcs).toFixed(0)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(nt_stn_wt).toFixed(3)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(dia_stn_pcs).toFixed(0)) + '</td>'

							+ '<td>' + money_format_india(parseFloat(dia_stn_wt).toFixed(3)) + '</td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td>' + (tag_mc_type == 2 ? money_format_india(parseFloat(tag_mc_value).toFixed(0)) : '-') + '</td>'

							+ '<td>' + (tag_mc_type == 1 ? money_format_india(parseFloat(tag_mc_value).toFixed(0)) : '-') + '</td>'

							+ '<td>' + money_format_india(parseFloat(sales_value).toFixed(3)) + '</td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td>' + money_format_india(parseFloat(tot_est).toFixed(0)) + '</td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '<td></td>'

							+ '</tr>';

					}

					tot_no_of_tags += parseFloat(no_of_tags);

					total_piece += parseFloat(piece);

					tot_gross_wt += parseFloat(gross_wt);

					tot_net_wt += parseFloat(net_wt);

					tot_grm_wt += parseFloat(grm_wt);

					tot_ct_wt += parseFloat(ct_wt);

					tot_nt_stn_pcs += parseFloat(nt_stn_pcs);

					tot_nt_stn_wt += parseFloat(nt_stn_wt);

					tot_dia_stn_pcs += parseFloat(dia_stn_pcs);

					tot_dia_stn_wt += parseFloat(dia_stn_wt);

					tot_tag_mc_value += parseFloat(tag_mc_value);

					tot_retail_max_wastage_percent += parseFloat(retail_max_wastage_percent);

					tot_wastage_weight += parseFloat(wastage_weight);

					tot_sales_value += parseFloat(sales_value);

					tot_attrvalues += parseFloat(attrvalues);

					tot_tot_est += parseFloat(tot_est);

					tot_tag_mc_type = parseFloat(tag_mc_type);

				});

				$('#total_count').text(tot_piece);

				$('#total_wt').text(parseFloat(tot_weight).toFixed(3));

				$("#tag_item_branchwise > tbody > tr").remove();

				if ((stock_details.length > 0) && ($("#branch_select").val() == 0)) {

					var trHtml = '';

					var tot_pcs = 0;

					var tot_gross_wt = 0;

					var tot_net_wt = 0;

					$.each(stock_details, function (key, items) {

						tot_pcs += parseFloat(items.piece);

						tot_gross_wt += parseFloat(items.gross_wt);

						tot_net_wt += parseFloat(items.gross_wt);

						trHtml += '<tr>'

							+ '<td>' + items.branch_name + '</td>'

							+ '<td>' + items.piece + '</td>'

							+ '<td>' + items.gross_wt + '</td>'

							+ '<td>' + items.net_wt + '</td>'

							+ '</tr>';

					});

					trHtml += '<tr style="font-weight:bold;">'

						+ '<td>TOTAL</td>'

						+ '<td>' + parseFloat(tot_pcs).toFixed(2) + '</td>'

						+ '<td>' + parseFloat(tot_gross_wt).toFixed(2) + '</td>'

						+ '<td>' + parseFloat(tot_net_wt).toFixed(2) + '</td>'

						+ '</tr>';

					$('#tag_item_branchwise').append(trHtml);

				}

				trHtml += '<tr style="font-weight:bold; color: blue">'

					+ '<td>GRAND TOTAL</td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td>' + money_format_india(parseFloat(tot_no_of_tags).toFixed(0)) + '</td>'

					+ '<td>' + money_format_india(parseFloat(total_piece).toFixed(0)) + '</td>'

					+ '<td>' + money_format_india(parseFloat(tot_gross_wt).toFixed(3)) + '</td>'

					+ '<td>' + money_format_india(parseFloat(tot_net_wt).toFixed(3)) + '</td>'

					+ '<td>' + money_format_india(parseFloat(tot_grm_wt).toFixed(3)) + '</td>'

					+ '<td>' + money_format_india(parseFloat(tot_ct_wt).toFixed(3)) + '</td>'

					+ '<td>' + money_format_india(parseFloat(tot_nt_stn_pcs).toFixed(0)) + '</td>'

					+ '<td>' + money_format_india(parseFloat(tot_nt_stn_wt).toFixed(3)) + '</td>'

					+ '<td>' + money_format_india(parseFloat(tot_dia_stn_pcs).toFixed(0)) + '</td>'

					+ '<td>' + money_format_india(parseFloat(tot_dia_stn_wt).toFixed(3)) + '</td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td>' + (tot_tag_mc_type == 2 ? money_format_india(parseFloat(tot_tag_mc_value).toFixed(0)) : '-') + '</td>'

					+ '<td>' + (tot_tag_mc_type == 1 ? money_format_india(parseFloat(tot_tag_mc_value).toFixed(0)) : '-') + '</td>'

					+ '<td>' + money_format_india(parseFloat(tot_sales_value).toFixed(3)) + '</td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td>' + money_format_india(parseFloat(tot_tot_est).toFixed(0)) + '</td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '<td></td>'

					+ '</tr>';

				$('#tag_items_list > tbody').html(trHtml);

				// Check and initialise datatable

				if (!$.fn.DataTable.isDataTable('#tag_items_list')) {

					oTable = $('#tag_items_list').dataTable({

						"bSort": false,

						"bInfo": true,

						"scrollX": '100%',

						"dom": 'lBfrtip',

						"paging": true,

						"fixedHeader": true,

						"autoWidth": true,

						"columnDefs": [

							{

								targets: [11, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 29, 32],

								className: 'dt-body-right'

							},

							{

								targets: [4, 9, 10, 12, 13, 14, 15, 16, 17],

								className: 'dt-body-right'

							}

						],

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: '',

								messageTop: title,

								exportOptions: {

									columns: ':visible'

								},

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', '12px')

										.css('font-family', 'sans-serif');

								},

							},

							'colvis',

							{

								extend: 'excel',

								footer: true,

								title: 'Tagged Stock Report',

							}

						],

					});

				}

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//stock report

//reorder report

/*

function get_reorder_report() {

	var company_name = $('#company_name').val();

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = 'REORDER REPORT';

	var prod_select = $('#prod_select option:selected').html() != '' && $('#prod_select option:selected').html() != undefined ? $('#prod_select option:selected').html() + ' - ' : '';

	var optional = prod_select;

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, '', '', optional) + "</span>";

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/reorder_report/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'dt_range': $("#dt_range").val(),'id_product': $('#prod_select').val(), 'id_design': $('#des_select').val(),'id_sub_design': $('#sub_des_select').val(),'category': $('#category_select').val(),'id_section': $('#section_select').val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'report_type': $('#report_type').val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var result = data.list;

			var weight_details = data.weight_details;

			var size_details = data.size_details;

			if(result.length > 0)

			{

				var trHtml = '';

				var weight_range = '';

				$.each(weight_details,function(key,val){

					weight_range+='<td colspan="'+val.size_details.length+'" style="text-align: center;">'+val.weight_description+'</td>'

				});

				var sizeDet= '';

				var size= '';

				trHtml+='<tr style="font-weight:bold;">'

						+'<td>Branch</td>'

						+'<td>Section</td>'

						+'<td>Product</td>'

						+'<td>Design</td>'

						+'<td>Sub Design</td>'

						+weight_range

				+'</tr>';

				$.each(weight_details,function(key,val){

					$.each(val.size_details,function(key,itm){

						sizeDet+='<td>'+(itm.value+' '+itm.name)+'</td>'

					});

				});

				trHtml+='<tr style="font-weight:bold;">'

						+'<td></td>'

						+'<td></td>'

						+'<td></td>'

						+'<td></td>'

						+'<td></td>'

						+sizeDet

				+'</tr>';

				$.each(result,function(key,val){

					var tag_details='';

					$.each(val.weight_details,function(key,item){

						$.each(item.tag_size_details,function(key,k){

							tag_details+='<td>'+k.tag_pcs+'</td>'

						});

					});

							trHtml+='<tr>'

							+'<td>'+val.branch_name+'</td>'

							+'<td>'+val.section_name+'</td>'

							+'<td>'+val.product_name+'</td>'

							+'<td>'+val.design_name+'</td>'

							+'<td>'+val.sub_design_name+'</td>'

							+tag_details

							+'</tr>';

				});

				$('#reorder_item_list > tbody').html(trHtml);

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

} */

//reorder report

// $('#reorder_print').on('click',function(){

// 	my_Date = new Date();

// 	var report_type = $("input[name='report_type']:checked").val();//0-Available,1-1-shortage,2-Excess

// 	var item_type = $("input[name='item_type']:checked").val(); //1-weight range and size,2-size

// 	var available_stock_type = $("input[name='available_stock_type']:checked").val(); //1-weight range and size,2-size

//     var branch = ($('#branch_select').val() !== "" && $('#branch_select').val() !== undefined) ? $('#branch_select').val() : $('#branch_filter').val();

//     console.log(branch);

// 	if(branch=="" || branch == null )

// 	{

// 		$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + 'Please Select Branch' });

// 	}

//     else

// 	{

// 		window.open(base_url+'index.php/admin_ret_reports/reorder_print/'+$('#prod_select').val()+'/'+branch+'/'+report_type+'/'+item_type+'/'+available_stock_type);

// 	}

// });

//  $('#reorder_search').on('click',function(){

// 	if($('#prod_select').val()==null || $('#prod_select').val()=='')

// 	{

// 		$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + 'Please Select Product' });

// 	}

// 	 else if($('#prod_select').val()==0 )

// 	{

// 		$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + 'Please Select Valid  Product' });

// 	}

// 	else{

// 		get_reorder_report();

// 	}

// });

// function get_reorder_report() {

// 	$('#reorder_item_list > tbody').empty();

// 	$('#reorder_item_list > tfoot').empty();

// 	var company_name = $('#company_name').val();

// 	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

// 	var report_name = 'REORDER REPORT';

// 	var prod_select = $('#prod_select option:selected').html() != '' && $('#prod_select option:selected').html() != undefined ? $('#prod_select option:selected').html() + ' - ' : '';

// 	var optional = prod_select;

// 	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

// 		+ "<span>" + report_print(branch_name, report_name, '', '', optional) + "</span>";

// 	var report_type = $("input[name='report_type']:checked").val();//0-Available,1-1-shortage,2-Excess

// 	var item_type = $("input[name='item_type']:checked").val(); //1-weight range and size,2-size

// 	var available_stock_type = $("input[name='available_stock_type']:checked").val(); //1-weight range and size,2-size

// 	my_Date = new Date();

// 	$(".overlay").css("display", "block");

// 	$.ajax({

// 		url: base_url + "index.php/admin_ret_reports/reorder_report/ajax?nocache=" + my_Date.getUTCSeconds(),

// 		 data: ({ 'id_product': $('#prod_select').val(), 'id_design': $('#des_select').val(),'id_sub_design': $('#sub_des_select').val(),'category': $('#category_select').val(),'id_section': $('#section_select').val(), 'id_branch': $('#branch_select').val() ||  $('#branch_filter').val(), 'report_type': report_type,'item_type':item_type,'available_stock_type':available_stock_type }),

// 		dataType: "JSON",

// 		type: "POST",

// 		success: function (data) {

// 			var result = data.list;

// 			var weight_details = data.weight_details;

// 			var size_details = data.size_details;

// 			if(result.length > 0)

// 			{

// 				if(item_type == 1){

// 					var trHtml = '';

// 					var trfoot = '';

// 					var weight_range = '';

// 					$.each(weight_details,function(key,val){

// 						weight_range+='<td colspan="'+val.size_details.length+'" style="text-align: center;">'+val.weight_description.toUpperCase()+'</td>'

// 					});

// 					var sizeDet= '';

// 					var grand_total_row='';

// 					var size= '';

// 					trHtml+='<tr style="font-weight:bold;">'

// 				 			+'<td>BRANCH</td>'

// 							+'<td>SECTION</td>'

// 							+'<td>PRODUCT</td>'

// 							+'<td>DESIGN</td>'

// 							+'<td>SUB DESIGN</td>'

// 							+weight_range

// 							+'<td>TOTAL</td>'

// 							+'</tr>';

// 					$.each(weight_details,function(key,val){

// 						$.each(val.size_details,function(key,itm){

// 							sizeDet+='<td>'+(itm.value+' '+itm.name.toUpperCase())+'</td>';

// 							grand_total_row+='<td class="col_total'+val.id_weight+'_'+itm.id_size+'"></td>';

// 						});

// 					});

// 					trHtml+='<tr style="font-weight:bold;text-align:right;">'

// 							+'<td></td>'

// 							+'<td></td>'

// 							+'<td></td>'

// 							+'<td></td>'

// 							+'<td></td>'

// 							+sizeDet

// 							+'<td></td>'

// 					+'</tr>';

// 					$.each(result,function(key,val){

// 						var tag_details='';

// 						var row_total_pcs = 0;

// 						$.each(val.weight_details,function(key,item){

// 							$.each(item.tag_size_details,function(key,k){

// 								row_total_pcs+=parseFloat((k.value!='' && k.value!=null ? k.value:0));

// 								tag_details+='<td class="weight_and_size_'+item.id_weight+'_'+k.id_size+'" style="text-align:right;">'+money_format_india(k.value)+'</td>';

// 							});

// 						});

// 								trHtml+='<tr>'

// 									+'<td>'+val.branch_name+'</td>'

// 									+'<td>'+val.section_name+'</td>'

// 									+'<td>'+val.product_name+'</td>'

// 									+'<td>'+val.design_name+'</td>'

// 									+'<td>'+val.sub_design_name+'</td>'

// 									+tag_details

// 									+'<td class="total_pcs" style="font-weight:bold;text-align:right;">'+money_format_india(row_total_pcs)+'</td>'

// 								+'</tr>';

// 					});

// 					trfoot+='<tr style="font-weight:bold;text-align:right;">'

// 							+'<td>TOTAL</td>'

// 							+'<td></td>'

// 							+'<td></td>'

// 							+'<td></td>'

// 							+'<td></td>'

// 							+grand_total_row

// 							+'<td class="total_reorder_value"></td>'

// 					+'</tr>';

// 					$('#reorder_item_list > tbody').html(trHtml);

// 					$('#reorder_item_list > tfoot').html(trfoot);

// 				}else{

// 					var trHtml = '';

// 					var trfoot = '';

// 					var size_range = '';

// 					$.each(size_details,function(key,val){

// 						size_range+='<td style="text-align: center;">'+(val.value+' '+val.name.toUpperCase())+'</td>'

// 					});

// 					var sizeDet= '';

// 					var grand_total_row='';

// 					var size= '';

// 					trHtml+='<tr style="font-weight:bold;">'

// 							+'<td>BRANCH</td>'

// 							+'<td>SECTION</td>'

// 							+'<td>PRODUCT</td>'

// 							+'<td>DESIGN</td>'

// 							+'<td>SUB DESIGN</td>'

// 							+size_range

// 							+'<td>TOTAL</td>'

// 							+'</tr>';

// 						$.each(size_details,function(key,itm){

// 							sizeDet+='<td>'+(itm.value+' '+itm.name.toUpperCase())+'</td>';

// 							grand_total_row+='<td class="col_total_'+itm.id_size+'"></td>';

// 						});

// 					$.each(result,function(key,val){

// 						var tag_details='';

// 						var row_total_pcs = 0;

// 						$.each(val.size_details,function(key,item){

// 								row_total_pcs+=parseFloat((item.value!='' && item.value!=null ? item.value:0));

// 								tag_details+='<td class="weight_and_size_'+item.id_size+'" style="text-align:right;">'+money_format_india(item.value)+'</td>';

// 						});

// 								trHtml+='<tr>'

// 									+'<td>'+val.branch_name+'</td>'

// 									+'<td>'+val.section_name+'</td>'

// 									+'<td>'+val.product_name+'</td>'

// 									+'<td>'+val.design_name+'</td>'

// 									+'<td>'+val.sub_design_name+'</td>'

// 									+tag_details

// 									+'<td class="total_pcs" style="font-weight:bold;text-align:right;">'+money_format_india(row_total_pcs)+'</td>'

// 								+'</tr>';

// 					});

// 				 	trfoot+='<tr style="font-weight:bold;text-align:right;">'

// 							+'<td>TOTAL</td>'

// 							+'<td></td>'

// 							+'<td></td>'

// 							+'<td></td>'

// 							+'<td></td>'

// 							+grand_total_row

// 							+'<td class="total_reorder_value"></td>'

// 					+'</tr>';

// 					$('#reorder_item_list > tbody').html(trHtml);

// 					$('#reorder_item_list > tfoot').html(trfoot);

// 				}

// 				calculate_reorder_column_total(item_type,weight_details,size_details,available_stock_type);

// 			}

// 			$("div.overlay").css("display", "none");

// 		},

// 		error: function (error) {

// 			$("div.overlay").css("display", "none");

// 		}

// 	});

// }

// function calculate_reorder_column_total(item_type,weight_details,size_details,available_stock_type)

// {

// 	if(item_type == 1 ){

// 		$('#reorder_item_list > tbody tr').each(function(idx, row){

// 			curRow = $(this);

// 			$.each(weight_details,function(key,val){

// 				$.each(val.size_details,function(k,itm){

// 					var total_column_value = 0;

// 					var total_reorder_value = 0;

// 					var total_reorder_value = ($('#reorder_item_list > tfoot tr').find('.total_reorder_value').html()!='' ? $('#reorder_item_list > tfoot tr').find('.total_reorder_value').html() :0);

// 					var total_column_value = ($('#reorder_item_list > tfoot tr').find('.col_total'+val.id_weight+'_'+itm.id_size).html()!='' ? $('#reorder_item_list > tfoot tr').find('.col_total'+val.id_weight+'_'+itm.id_size).html() :0);

// 					var column_value = (!isNaN(curRow.find('.weight_and_size_'+val.id_weight+'_'+itm.id_size).html()) && (curRow.find('.weight_and_size_'+val.id_weight+'_'+itm.id_size).html()!='') ? curRow.find('.weight_and_size_'+val.id_weight+'_'+itm.id_size).html() :0);

// 					total_column_value=parseFloat(total_column_value)+parseFloat(column_value);

// 					total_reorder_value=parseFloat(total_reorder_value)+parseFloat(column_value);

// 					if(available_stock_type == 2)

// 					{

// 					$('#reorder_item_list > tfoot tr').find('.col_total'+val.id_weight+'_'+itm.id_size).html(money_format_india(parseFloat(total_column_value).toFixed(3)));

// 				 	$('#reorder_item_list > tfoot tr').find('.total_reorder_value').html(money_format_india(parseFloat(total_reorder_value).toFixed(3)));

// 					}

// 					else

// 					{

// 						$('#reorder_item_list > tfoot tr').find('.col_total'+val.id_weight+'_'+itm.id_size).html(money_format_india(parseFloat(total_column_value).toFixed(0)));

// 						$('#reorder_item_list > tfoot tr').find('.total_reorder_value').html(money_format_india(parseFloat(total_reorder_value).toFixed(0)));

// 					}

// 				});

// 			});

// 		});

// 	}else{

// 		$('#reorder_item_list > tbody tr').each(function(idx, row){

// 			curRow = $(this);

// 			$.each(size_details,function(k,itm){

// 					var total_column_value = 0;

// 					var total_reorder_value = 0;

// 					var total_reorder_value = ($('#reorder_item_list > tfoot tr').find('.total_reorder_value').html()!='' ? $('#reorder_item_list > tfoot tr').find('.total_reorder_value').html() :0);

// 					var total_column_value = ($('#reorder_item_list > tfoot tr').find('.col_total_'+itm.id_size).html()!='' ? $('#reorder_item_list > tfoot tr').find('.col_total_'+itm.id_size).html() :0);

// 					var column_value = (!isNaN(curRow.find('.weight_and_size_'+itm.id_size).html()) && (curRow.find('.weight_and_size_'+itm.id_size).html()!='') ? curRow.find('.weight_and_size_'+itm.id_size).html() :0);

// 					total_column_value=parseFloat(total_column_value)+parseFloat(column_value);

// 					total_reorder_value=parseFloat(total_reorder_value)+parseFloat(column_value);

// 					if(available_stock_type == 2)

// 					{

// 						$('#reorder_item_list > tfoot tr').find('.col_total_'+itm.id_size).html(money_format_india(parseFloat(total_column_value).toFixed(3)));

// 						$('#reorder_item_list > tfoot tr').find('.total_reorder_value').html(money_format_india(parseFloat(total_reorder_value).toFixed(3)));

// 					}

// 		  			else

// 					{

// 						$('#reorder_item_list > tfoot tr').find('.col_total_'+itm.id_size).html(money_format_india(parseFloat(total_column_value).toFixed(0)));

// 						$('#reorder_item_list > tfoot tr').find('.total_reorder_value').html(money_format_india(parseFloat(total_reorder_value).toFixed(0)));

// 					}

// 			});

// 		});

// 	}

// }

// //reorder report

//reorder report

// $('#reorder_print').on('click',function(){

// 	my_Date = new Date();

// 	var report_type = $("input[name='report_type']:checked").val();//0-Available,1-1-shortage,2-Excess

// 	var item_type = $("input[name='item_type']:checked").val(); //1-weight range and size,2-size

// 	var available_stock_type = $("input[name='available_stock_type']:checked").val(); //1-weight range and size,2-size

//     var branch = ($('#branch_select').val() !== "" && $('#branch_select').val() !== undefined) ? $('#branch_select').val() : $('#branch_filter').val();

//     console.log(branch);

// 	if(branch=="" || branch == null )

// 	{

// 		$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + 'Please Select Branch' });

// 	}

//     else

// 	{

// 		window.open(base_url+'index.php/admin_ret_reports/reorder_print/'+$('#prod_select').val()+'/'+branch+'/'+report_type+'/'+item_type+'/'+available_stock_type);

// 	}

// });

$('#reorder_print').on('click', function () {

	my_Date = new Date();

	var report_type = $("input[name='report_type']:checked").val();

	var item_type = $("input[name='item_type']:checked").val();

	var available_stock_type = $("input[name='available_stock_type']:checked").val();

	var branch = ($('#branch_select').val() || $('#branch_filter').val()) || 0;

	var design = ($('#des_select').val() != '' && $('#des_select').val() != null ? $('#des_select').val() : 0);

	var sub_design = ($('#sub_des_select').val() != '' && $('#sub_des_select').val() != null ? $('#sub_des_select').val() : 0);

	var section = ($('#section_select').val() != '' && $('#section_select').val() != null ? $('#section_select').val() : 0);

	console.log(branch);

	// if (branch == "" || branch == null) {

	//     $.toaster({ priority: 'danger', title: 'Warning!', message: 'Please Select Branch' });

	// }

	//  else {

	$.ajax({

		url: base_url + 'index.php/admin_ret_reports/reorder_product',

		data: ({

			'id_product': $('#prod_select').val(),

			'id_branch': branch,

			'report_type': report_type,

			'available_stock_types': available_stock_type

		}),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			console.log(data.product_details); // Log the response to the console for debugging

			console.log(data.product_details.size_details); // Log the response to the console for debugging

			console.log(data.stock_details); // Log the response to the console for debugging

			if (data != null) {

				if (data.stock_details && data.stock_details.length > 0) {

					window.open(base_url + 'index.php/admin_ret_reports/reorder_print/' + $('#prod_select').val() + '/' + branch + '/' + report_type + '/' + item_type + '/' + available_stock_type + '/' + design + '/' + sub_design + '/' + section);

				}

			}

			else {

				$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + 'No Records Found' });

			}

		}

	});

	// }

});

$('#reorder_search').on('click', function () {

	if ($('#prod_select').val() == null || $('#prod_select').val() == '') {

		$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + 'Please Select Product' });

	}

	else if ($('#prod_select').val() == 0) {

		$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + 'Please Select Valid  Product' });

	}

	else {

		get_reorder_report();

		// get_reorder_data();

	}

});

function get_reorder_report() {

	$('#reorder_item_list > tbody').empty();

	$('#reorder_item_list > tfoot').empty();

	var company_name = $('#company_name').val();

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = 'REORDER REPORT';

	var prod_select = $('#prod_select option:selected').html() != '' && $('#prod_select option:selected').html() != undefined ? $('#prod_select option:selected').html() + ' - ' : '';

	var optional = prod_select;

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, '', '', optional) + "</span>";

	var report_type = $("input[name='report_type']:checked").val();//0-Available,1-1-shortage,2-Excess

	var item_type = $("input[name='item_type']:checked").val(); //1-weight range and size,2-size

	var available_stock_type = $("input[name='available_stock_type']:checked").val(); //1-weight range and size,2-size

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/reorder_report/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'id_product': $('#prod_select').val(), 'id_design': $('#des_select').val(), 'id_sub_design': $('#sub_des_select').val(), 'category': $('#category_select').val(), 'id_section': $('#section_select').val(), 'id_branch': $('#branch_select').val() || $('#branch_filter').val(), 'report_type': report_type, 'item_type': item_type, 'available_stock_type': available_stock_type }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var result = data.list;

			var weight_details = data.weight_details;

			var size_details = data.size_details;

			if (result.length > 0) {

				if (item_type == 1) {

					var trHtml = '';

					var trfoot = '';

					var weight_range = '';

					$.each(weight_details, function (key, val) {

						if (val.weight_description != null) {

							var weight = val.weight_description.toUpperCase();

						}

						else {

							var weight = "";

						}

						weight_range += '<td colspan="' + val.size_details.length + '" style="text-align: center;">' + weight + '</td>'

					});

					var sizeDet = '';

					var grand_total_row = '';

					var size = '';

					trHtml += '<tr style="font-weight:bold;">'

						+ '<td>BRANCH</td>'

						+ '<td>SECTION</td>'

						+ '<td>PRODUCT</td>'

						+ '<td>DESIGN</td>'

						+ '<td>SUB DESIGN</td>'

						+ weight_range

						+ '<td>TOTAL</td>'

						+ '</tr>';

					$.each(weight_details, function (key, val) {

						$.each(val.size_details, function (key, itm) {

							sizeDet += '<td>' + (itm.value + ' ' + itm.name.toUpperCase()) + '</td>';

							grand_total_row += '<td class="col_total' + val.id_weight + '_' + itm.id_size + '"></td>';

						});

					});

					trHtml += '<tr style="font-weight:bold;text-align:right;">'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ sizeDet

						+ '<td></td>'

						+ '</tr>';

					$.each(result, function (key, val) {

						var tag_details = '';

						var row_total_pcs = 0;

						var pcs = 0;

						$.each(val.weight_details, function (key, item) {

							$.each(item.tag_size_details, function (key, k) {

								row_total_pcs += parseFloat((k.value != '' && k.value != null ? k.value : 0));

								tag_details += '<td class="weight_and_size_' + item.id_weight + '_' + k.id_size + '" style="text-align:right;">' + money_format_india(k.value != '' && k.value != null ? k.value : 0) + '</td>';

							});

						});

						if (available_stock_type == 1) {

							pcs = (money_format_india(parseFloat(row_total_pcs).toFixed(0)));

						}

						else {

							pcs = (money_format_india(parseFloat(row_total_pcs).toFixed(3)));

						}

						trHtml += '<tr>'

							+ '<td>' + val.branch_name + '</td>'

							+ '<td>' + val.section_name + '</td>'

							+ '<td>' + val.product_name + '</td>'

							+ '<td>' + val.design_name + '</td>'

							+ '<td>' + val.sub_design_name + '</td>'

							+ tag_details

							+ '<td class="total_pcs" style="font-weight:bold;text-align:right;">' + pcs + '</td>'

							+ '</tr>';

					});

					trfoot += '<tr style="font-weight:bold;text-align:right;">'

						+ '<td>TOTAL</td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ grand_total_row

						+ '<td class="total_reorder_value"></td>'

						+ '</tr>';

					$('#reorder_item_list > tbody').html(trHtml);

					$('#reorder_item_list > tfoot').html(trfoot);

				} else {

					var trHtml = '';

					var trfoot = '';

					var size_range = '';

					$.each(size_details, function (key, val) {

						size_range += '<td style="text-align: center;">' + (val.value + ' ' + val.name.toUpperCase()) + '</td>'

					});

					var sizeDet = '';

					var grand_total_row = '';

					var size = '';

					trHtml += '<tr style="font-weight:bold;">'

						+ '<td>BRANCH</td>'

						+ '<td>SECTION</td>'

						+ '<td>PRODUCT</td>'

						+ '<td>DESIGN</td>'

						+ '<td>SUB DESIGN</td>'

						+ size_range

						+ '<td>TOTAL</td>'

						+ '</tr>';

					$.each(size_details, function (key, itm) {

						sizeDet += '<td>' + (itm.value + ' ' + itm.name.toUpperCase()) + '</td>';

						grand_total_row += '<td class="col_total_' + itm.id_size + '"></td>';

					});

					$.each(result, function (key, val) {

						var tag_details = '';

						var row_total_pcs = 0;

						var pcs = 0;

						$.each(val.size_details, function (key, item) {

							row_total_pcs += parseFloat((item.value != '' && item.value != null ? item.value : 0));

							tag_details += '<td class="weight_and_size_' + item.id_size + '" style="text-align:right;">' + money_format_india(item.value != '' && item.value != null ? item.value : 0) + '</td>';

						});

						if (available_stock_type == 1) {

							pcs = (money_format_india(parseFloat(row_total_pcs).toFixed(0)));

						}

						else {

							pcs = (money_format_india(parseFloat(row_total_pcs).toFixed(3)));

						}

						trHtml += '<tr>'

							+ '<td>' + val.branch_name + '</td>'

							+ '<td>' + val.section_name + '</td>'

							+ '<td>' + val.product_name + '</td>'

							+ '<td>' + val.design_name + '</td>'

							+ '<td>' + val.sub_design_name + '</td>'

							+ tag_details

							+ '<td class="total_pcs" style="font-weight:bold;text-align:right;">' + pcs + '</td>'

							+ '</tr>';

					});

					trfoot += '<tr style="font-weight:bold;text-align:right;">'

						+ '<td>TOTAL</td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ '<td></td>'

						+ grand_total_row

						+ '<td class="total_reorder_value"></td>'

						+ '</tr>';

					$('#reorder_item_list > tbody').html(trHtml);

					$('#reorder_item_list > tfoot').html(trfoot);

				}

				calculate_reorder_column_total(item_type, weight_details, size_details, available_stock_type);

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function calculate_reorder_column_total(item_type, weight_details, size_details, available_stock_type) {

	if (item_type == 1) {

		$('#reorder_item_list > tbody tr').each(function (idx, row) {

			curRow = $(this);

			$.each(weight_details, function (key, val) {

				$.each(val.size_details, function (k, itm) {

					var total_column_value = 0;

					var total_reorder_value = 0;

					var total_reorder_value = ($('#reorder_item_list > tfoot tr').find('.total_reorder_value').html() != '' ? $('#reorder_item_list > tfoot tr').find('.total_reorder_value').html() : 0);

					var total_column_value = ($('#reorder_item_list > tfoot tr').find('.col_total' + val.id_weight + '_' + itm.id_size).html() != '' ? $('#reorder_item_list > tfoot tr').find('.col_total' + val.id_weight + '_' + itm.id_size).html() : 0);

					var column_value = (!isNaN(curRow.find('.weight_and_size_' + val.id_weight + '_' + itm.id_size).html()) && (curRow.find('.weight_and_size_' + val.id_weight + '_' + itm.id_size).html() != '') ? curRow.find('.weight_and_size_' + val.id_weight + '_' + itm.id_size).html() : 0);

					total_column_value = parseFloat(total_column_value) + parseFloat(column_value);

					total_reorder_value = parseFloat(total_reorder_value) + parseFloat(column_value);

					if (available_stock_type == 2) {

						// $('#reorder_item_list > tfoot tr').find('.col_total'+val.id_weight+'_'+itm.id_size).html(money_format_india(parseFloat(total_column_value).toFixed(3)));

						// $('#reorder_item_list > tfoot tr').find('.total_reorder_value').html(money_format_india(parseFloat(total_reorder_value).toFixed(3)));

						$('#reorder_item_list > tfoot tr').find('.col_total' + val.id_weight + '_' + itm.id_size).html(money_format_india(parseFloat(total_column_value).toFixed(3)).replace(/,/g, ''));

						$('#reorder_item_list > tfoot tr').find('.total_reorder_value').html(money_format_india(parseFloat(total_reorder_value).toFixed(3)).replace(/,/g, ''));

					}

					else {

						// $('#reorder_item_list > tfoot tr').find('.col_total'+val.id_weight+'_'+itm.id_size).html(money_format_india(parseFloat(total_column_value).toFixed(0)));

						// $('#reorder_item_list > tfoot tr').find('.total_reorder_value').html(money_format_india(parseFloat(total_reorder_value).toFixed(0)));

						$('#reorder_item_list > tfoot tr').find('.col_total' + val.id_weight + '_' + itm.id_size).html(money_format_india(parseFloat(total_column_value).toFixed(0)).replace(/,/g, ''));

						$('#reorder_item_list > tfoot tr').find('.total_reorder_value').html(money_format_india(parseFloat(total_reorder_value).toFixed(0)).replace(/,/g, ''));

					}

				});

			});

		});

	} else {

		$('#reorder_item_list > tbody tr').each(function (idx, row) {

			curRow = $(this);

			$.each(size_details, function (k, itm) {

				var total_column_value = 0;

				var total_reorder_value = 0;

				var total_reorder_value = ($('#reorder_item_list > tfoot tr').find('.total_reorder_value').html() != '' ? $('#reorder_item_list > tfoot tr').find('.total_reorder_value').html() : 0);

				var total_column_value = ($('#reorder_item_list > tfoot tr').find('.col_total_' + itm.id_size).html() != '' ? $('#reorder_item_list > tfoot tr').find('.col_total_' + itm.id_size).html() : 0);

				var column_value = (!isNaN(curRow.find('.weight_and_size_' + itm.id_size).html()) && (curRow.find('.weight_and_size_' + itm.id_size).html() != '') ? curRow.find('.weight_and_size_' + itm.id_size).html() : 0);

				total_column_value = parseFloat(total_column_value) + parseFloat(column_value);

				total_reorder_value = parseFloat(total_reorder_value) + parseFloat(column_value);

				if (available_stock_type == 2) {

					// $('#reorder_item_list > tfoot tr').find('.col_total_'+itm.id_size).html(money_format_india(parseFloat(total_column_value).toFixed(3)));

					// $('#reorder_item_list > tfoot tr').find('.total_reorder_value').html(money_format_india(parseFloat(total_reorder_value).toFixed(3)));

					$('#reorder_item_list > tfoot tr').find('.col_total_' + itm.id_size).html(money_format_india(parseFloat(total_column_value).toFixed(3)).replace(/,/g, ''));

					$('#reorder_item_list > tfoot tr').find('.total_reorder_value').html(money_format_india(parseFloat(total_reorder_value).toFixed(3)).replace(/,/g, ''));

				}

				else {

					// $('#reorder_item_list > tfoot tr').find('.col_total_'+itm.id_size).html(money_format_india(parseFloat(total_column_value).toFixed(0)));

					// $('#reorder_item_list > tfoot tr').find('.total_reorder_value').html(money_format_india(parseFloat(total_reorder_value).toFixed(0)));

					$('#reorder_item_list > tfoot tr').find('.col_total_' + itm.id_size).html(money_format_india(parseFloat(total_column_value).toFixed(0)).replace(/,/g, ''));

					$('#reorder_item_list > tfoot tr').find('.total_reorder_value').html(money_format_india(parseFloat(total_reorder_value).toFixed(0)).replace(/,/g, ''));

				}

			});

		});

	}

}

//reorder report

function getDeviceNames() {

	$("div.overlay").css("display", "block");

	$("#device option").remove();

	$.ajax({

		type: 'POST',

		url: base_url + 'index.php/admin_ret_catalog/get_deviceNames',

		dataType: "JSON",

		success: function (data) {

			$("#device").append(

				$("<option></option>")

					.attr("value", 0)

					.text('All')

			);

			$.each(data, function (key, item) {

				$('#device').append(

					$("<option></option>")

						.attr("value", item.id_device)

						.text(item.device_name)

				);

			});

			$("#device").select2({

				placeholder: "Select Bank Name",

				allowClear: true

			});

		}

	});

	$("div.overlay").css("display", "none");

}

function get_reorder_data() {

	var report_type = $("input[name='report_type']:checked").val();//0-Available,1-1-shortage,2-Excess

	var item_type = $("input[name='item_type']:checked").val(); //1-weight range and size,2-size

	var available_stock_type = $("input[name='available_stock_type']:checked").val(); //1-weight range and size,2-size

	my_Date = new Date();

	$("div.overlay").css("display", "block");

	$.ajax({

		type: 'POST',

		url: base_url + 'index.php/admin_ret_reports/reorder_report/ajax',

		data: ({ 'id_product': $('#prod_select').val(), 'id_design': $('#des_select').val(), 'id_sub_design': $('#sub_des_select').val(), 'category': $('#category_select').val(), 'id_section': $('#section_select').val(), 'id_branch': $('#branch_select').val() || $('#branch_filter').val(), 'report_type': report_type, 'item_type': item_type, 'available_stock_type': available_stock_type }),

		dataType: 'json',

		success: function (data) {

			console.log(data);

			reorder_export_list = [];

			weight_list = [];

			size_list = [];

			reorder_export_list = data.list;

			weight_list = data.weight_details;

			size_list = data.size_details;

			//  reorder_export_list = data.product_details;

			//  stock_details = data.product_details.stock_details;

			//  weight_list = data.product_details.weight_details;

			//  size_list = data.product_details.size_details;

		}

	});

	$("div.overlay").css("display", "none");

}

function fnReorderReportExcelReport(export_type) {

	console.log(reorder_export_list);

	var result = reorder_export_list;

	var weight_details = weight_list;

	var size_details = size_list;

	console.log(result);

	console.log(weight_details);

	console.log(size_details);

	if (reorder_export_list != null) {

		var report_type = $("input[name='report_type']:checked").val();//0-Available,1-1-shortage,2-Excess

		var item_type = $("input[name='item_type']:checked").val(); //1-weight range and size,2-size

		var available_stock_type = $("input[name='available_stock_type']:checked").val(); //1-weight range and size,2-size

		if (reorder_export_list.length > 0) {

			var htmls = "";

			var weight_range = '';

			$.each(weight_details, function (key, val) {

				if (val.weight_description != null) {

					var weight = val.weight_description.toUpperCase();

				} else {

					var weight = "";

				}

				weight_range += '<td colspan="' + val.size_details.length + '" style="text-align: center;">' + weight + '</td>';

			});

			var sizeDet = '';

			var grand_total_row = '';

			var size_range = '';

			htmls += '<tr style="font-weight:bold;">' +

				'<td>BRANCH</td>' +

				'<td>SECTION</td>' +

				'<td>PRODUCT</td>' +

				'<td>DESIGN</td>' +

				'<td>SUB DESIGN</td>' +

				weight_range +

				'<td>TOTAL</td>' +

				'</tr>';

			$.each(weight_details, function (key, val) {

				$.each(val.size_details, function (key, itm) {

					sizeDet += '<td>' + (itm.value + ' ' + itm.name.toUpperCase()) + '</td>';

					grand_total_row += '<td class="col_total' + val.id_weight + '_' + itm.id_size + '"></td>';

				});

			});

			htmls += '<tr style="font-weight:bold;text-align:right;">' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				sizeDet +

				'<td></td>' +

				'</tr>';

			var total_reorder_value = 0;

			$.each(result, function (key, val) {

				var tag_details = '';

				var row_total_pcs = 0;

				var pcs = 0;

				$.each(val.weight_details, function (key, item) {

					$.each(item.tag_size_details, function (key, k) {

						row_total_pcs += parseFloat((k.value != '' && k.value != null ? k.value : 0));

						tag_details += '<td class="weight_and_size_' + item.id_weight + '_' + k.id_size + '" style="text-align:right;">' + money_format_india(k.value) + '</td>';

					});

				});

				var row_total = parseFloat(row_total_pcs);

				total_reorder_value += row_total;

				// if (available_stock_type == 1) {

				// 	pcs = money_format_india(parseFloat(row_total_pcs).toFixed(0));

				// } else {

				// 	pcs = money_format_india(parseFloat(row_total_pcs).toFixed(3));

				// }

				var pcs = money_format_india(row_total.toFixed(available_stock_type == 2 ? 3 : 0));

				htmls += '<tr>' +

					'<td>' + val.branch_name + '</td>' +

					'<td>' + val.section_name + '</td>' +

					'<td>' + val.product_name + '</td>' +

					'<td>' + val.design_name + '</td>' +

					'<td>' + val.sub_design_name + '</td>' +

					tag_details +

					'<td class="total_pcs" style="font-weight:bold;text-align:right;">' + pcs + '</td>' +

					'</tr>';

			});

			$.each(size_details, function (key, itm) {

				grand_total_row += '<td class="col_total_' + itm.id_size + '"></td>';

			});

			htmls += '<tr style="font-weight:bold;text-align:right;">' +

				'<td>TOTAL</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				grand_total_row +

				'<td class="total_reorder_value" style="text-align:right;">' + money_format_india(total_reorder_value.toFixed(available_stock_type == 2 ? 3 : 0)) + '</td>' +

				'</tr>';

		} else {

			var size_range = '';

			$.each(size_details, function (key, val) {

				size_range += '<td style="text-align: center;">' + (val.value + ' ' + val.name.toUpperCase()) + '</td>';

			});

			var sizeDet = '';

			var grand_total_row = '';

			var size = '';

			htmls += '<tr style="font-weight:bold;">' +

				'<td>BRANCH</td>' +

				'<td>SECTION</td>' +

				'<td>PRODUCT</td>' +

				'<td>DESIGN</td>' +

				'<td>SUB DESIGN</td>' +

				size_range +

				'<td>TOTAL</td>' +

				'</tr>';

			$.each(size_details, function (key, itm) {

				sizeDet += '<td>' + (itm.value + ' ' + itm.name.toUpperCase()) + '</td>';

				grand_total_row += '<td class="col_total_' + itm.id_size + '"></td>';

			});

			var total_reorder_value = 0;

			$.each(result, function (key, val) {

				var tag_details = '';

				var row_total_pcs = 0;

				var pcs = 0;

				$.each(val.size_details, function (key, item) {

					row_total_pcs += parseFloat((item.value != '' && item.value != null ? item.value : 0));

					tag_details += '<td class="weight_and_size_' + item.id_size + '" style="text-align:right;">' + money_format_india(item.value) + '</td>';

				});

				var row_total = parseFloat(row_total_pcs);

				total_reorder_value += row_total;

				// if (available_stock_type == 1) {

				// 	pcs = (money_format_india(parseFloat(row_total_pcs).toFixed(0)));

				// } else {

				// 	pcs = (money_format_india(parseFloat(row_total_pcs).toFixed(3)));

				// }

				var pcs = money_format_india(row_total.toFixed(available_stock_type == 2 ? 3 : 0));

				htmls += '<tr>' +

					'<td>' + val.branch_name + '</td>' +

					'<td>' + val.section_name + '</td>' +

					'<td>' + val.product_name + '</td>' +

					'<td>' + val.design_name + '</td>' +

					'<td>' + val.sub_design_name + '</td>' +

					tag_details +

					'<td class="total_pcs" style="font-weight:bold;text-align:right;">' + pcs + '</td>' +

					'</tr>';

			});

			$.each(size_details, function (key, itm) {

				grand_total_row += '<td class="col_total_' + itm.id_size + '"></td>';

			});

			htmls += '<tr style="font-weight:bold;text-align:right;">' +

				'<td>TOTAL</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				grand_total_row +

				'<td class="total_reorder_value" style="text-align:right;">' + money_format_india(total_reorder_value.toFixed(available_stock_type == 2 ? 3 : 0)) + '</td>' +

				'</tr>';

		}

		htmls += '</tbody><tfoot></tfoot></table>';

		var uri = 'data:application/vnd.ms-excel;base64,';

		var template = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>';

		var base64 = function (s) {

			return window.btoa(unescape(encodeURIComponent(s)));

		};

		var format = function (s, c) {

			return s.replace(/{(\w+)}/g, function (m, p) {

				return c[p];

			});

		};

		var ctx = {

			worksheet: 'Worksheet',

			table: htmls

		};

		var link = document.createElement("a");

		link.download = "Reorder Report.xls";

		link.href = uri + base64(format(template, ctx));

		link.click();

	}

}

// function fnReorderReportExcelReport(export_type) {

// 	console.log(reorder_export_list);

//     var result = reorder_export_list;

//     var weight_details = weight_list;

//     var size_details = size_list;

// 	var stock_details = stock_details;

//     console.log(result);

//     // console.log(weight_details);

//     // console.log(size_details);

//     if (reorder_export_list != null) {

//         var report_type = $("input[name='report_type']:checked").val();

//         var item_type = $("input[name='item_type']:checked").val();

//         var available_stock_type = $("input[name='available_stock_type']:checked").val();

// 		if (reorder_export_list.length > 0) {

// 			var htmls = "";

// 			var weight_range = '';

// 			var grand_total_row = '';

//             if(weight_details > 0)

// 			{

// 			$.each(weight_details, function (key, val) {

// 				if (val.weight_description != null) {

// 					var weight = val.weight_description.toUpperCase();

// 				} else {

// 					var weight = "";

// 				}

// 				weight_range += '<td colspan="' + val.size_details.length + '" style="text-align: center;">' + weight + '</td>';

// 			});

// 		    }

// 			var sizeDet = '';

// 			var size_range = '';

// 			htmls += '<tr style="font-weight:bold;">' +

// 				'<td>BRANCH</td>' +

// 				'<td>SECTION</td>' +

// 				'<td>PRODUCT</td>' +

// 				'<td>DESIGN</td>' +

// 				'<td>SUB DESIGN</td>' +

// 				weight_range +

// 				'<td>TOTAL</td>' +

// 				'</tr>';

// 				if(weight_details > 0)

// 				{

// 			$.each(weight_details, function (key, val) {

// 				$.each(val.size_details, function (key, itm) {

// 					sizeDet += '<td>' + (itm.value + ' ' + itm.name.toUpperCase()) + '</td>';

// 					// grand_total_row += '<td class="col_total' + val.id_weight + '_' + itm.id_size + '"></td>';

// 				});

// 			});

// 				}

// 			htmls += '<tr style="font-weight:bold;text-align:right;">' +

// 				'<td></td>' +

// 				'<td></td>' +

// 				'<td></td>' +

// 				'<td></td>' +

// 				'<td></td>' +

// 				sizeDet +

// 				'<td></td>' +

// 				'</tr>';

// 			var total_reorder_value = 0;

// 			$.each(result, function (key, val) {

// 				var tag_details = '';

// 				var row_total_pcs = 0;

// 				var row_total = 0;

// 				if(val.weight_details > 0)

// 				{

// 				$.each(val.weight_details, function (key, item) {

// 					$.each(item.tag_size_details, function (key, k) {

// 						row_total_pcs += parseFloat((k.value != '' && k.value != null ? k.value : 0));

// 						tag_details += '<td class="weight_and_size_' + item.id_weight + '_' + k.id_size + '" style="text-align:right;">' + money_format_india(k.value) + '</td>';

// 					});

// 				});

// 			}

// 				row_total = parseFloat(row_total_pcs);

// 				var pcs = money_format_india(row_total.toFixed(available_stock_type == 2 ? 3 : 0));

// 				htmls += '<tr>' +

// 					'<td>' + val.branch_name + '</td>' +

// 					'<td>' + val.section_name + '</td>' +

// 					'<td>' + val.product_name + '</td>' +

// 					'<td>' + val.design_name + '</td>' +

// 					'<td>' + val.sub_design_name + '</td>' +

// 					tag_details +

// 					'<td class="total_pcs" style="font-weight:bold;text-align:right;">' + pcs + '</td>' +

// 					'</tr>';

// 			});

// 			var groupedData = [];

// 			$.each(result, function (key, val) {

// 				var total_value = 0;

// 				var weight = '';

// 				var size = '';

// 				if (val.size_details > 0) {

// 					$.each(val.size_details, function (key, item) {

// 						if (val.reorder_based_on == 2) {

// 							weight = item.id_weight;

// 							size = item.id_size;

// 							total_value += parseFloat(item.value);

// 						}

// 					});

// 				}

// 				if (val.weight_details > 0) {

// 					$.each(val.weight_details, function (key, item) {

// 						$.each(item.tag_size_details, function (key, k) {

// 							if (val.reorder_based_on == 1) {

// 								weight = k.id_weight;

// 								size = k.id_size;

// 								total_value += parseFloat(k.value);

// 							}

// 						});

// 					});

// 				}

// 				var existingItem = groupedData.find(function (item) {

// 					return (

// 						item.id_weight === weight &&

// 						item.id_size === size

// 					);

// 				});

// 				if (existingItem) {

// 					existingItem.value += total_value;

// 				} else {

// 					groupedData.push({

// 						'id_weight': weight,

// 						'id_size': size,

// 						'value': total_value

// 					});

// 				}

// 			});

// 			console.log(groupedData);

// 			var grand_total_row = '';

// 			var total_reorder_value = 0;

// 			$.each(groupedData, function (key, item) {

// 				grand_total_row += '<td class="col_total">' + item.value + '</td>';

// 				total_reorder_value += item.value;

// 			});

// 			console.log(total_reorder_value);

// 			// Assuming you have an HTML table, add the following row to the table

// 			htmls += '<tr style="font-weight:bold;text-align:right;">' +

// 				'<td>TOTAL</td>' +

// 				'<td></td>' +

// 				'<td></td>' +

// 				'<td></td>' +

// 				'<td></td>' +

// 				grand_total_row +

// 				'<td class="total_reorder_value" style="text-align:right;">' + money_format_india(parseFloat(total_reorder_value).toFixed(available_stock_type == 2 ? 3 : 0)) + '</td>' +

// 				'</tr>';

// 		}

//        else {

//             var size_range = '';

//             $.each(size_details, function (key, val) {

//                 size_range += '<td style="text-align: center;">' + (val.value + ' ' + val.name.toUpperCase()) + '</td>';

//             });

//             var sizeDet = '';

//             var grand_total_row = '';

//             var size = '';

//             htmls += '<tr style="font-weight:bold;">' +

//                 '<td>BRANCH</td>' +

//                 '<td>SECTION</td>' +

//                 '<td>PRODUCT</td>' +

//                 '<td>DESIGN</td>' +

//                 '<td>SUB DESIGN</td>' +

//                 size_range +

//                 '<td>TOTAL</td>' +

//                 '</tr>';

//             $.each(size_details, function (key, itm) {

//                 sizeDet += '<td>' + (itm.value + ' ' + itm.name.toUpperCase()) + '</td>';

//                 grand_total_row += '<td class="col_total_' + itm.id_size + '"></td>';

//             });

//             var total_reorder_value = 0;

//             $.each(result, function (key, val) {

//                 var tag_details = '';

//                 var row_total_pcs = 0;

//                 $.each(val.size_details, function (key, item) {

//                     row_total_pcs += parseFloat((item.value != '' && item.value != null ? item.value : 0));

//                     tag_details += '<td class="weight_and_size_' + item.id_size + '" style="text-align:right;">' + money_format_india(item.value) + '</td>';

//                 });

//                 var row_total = parseFloat(row_total_pcs);

//                 total_reorder_value += row_total;

//                 var pcs = money_format_india(row_total.toFixed(available_stock_type == 2 ? 3 : 0));

//                 htmls += '<tr>' +

//                     '<td>' + val.branch_name + '</td>' +

//                     '<td>' + val.section_name + '</td>' +

//                     '<td>' + val.product_name + '</td>' +

//                     '<td>' + val.design_name + '</td>' +

//                     '<td>' + val.sub_design_name + '</td>' +

//                     tag_details +

//                     '<td class="total_pcs" style="font-weight:bold;text-align:right;">' + pcs + '</td>' +

//                     '</tr>';

//             });

//             $.each(size_details, function (key, itm) {

//                 grand_total_row += '<td class="col_total_' + itm.id_size + '"></td>';

//             });

//             htmls += '<tr style="font-weight:bold;text-align:right;">' +

//                 '<td>TOTAL</td>' +

//                 '<td></td>' +

//                 '<td></td>' +

//                 '<td></td>' +

//                 '<td></td>' +

//                 grand_total_row +

//                 '<td class="total_reorder_value" style="text-align:right;">' + money_format_india(total_reorder_value.toFixed(available_stock_type == 2 ? 3 : 0)) + '</td>' +

//                 '</tr>';

//         }

//         htmls += '</tbody><tfoot></tfoot></table>';

//         var uri = 'data:application/vnd.ms-excel;base64,';

//         var template = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>';

//         var base64 = function (s) {

//             return window.btoa(unescape(encodeURIComponent(s)));

//         };

//         var format = function (s, c) {

//             return s.replace(/{(\w+)}/g, function (m, p) {

//                 return c[p];

//             });

//         };

//         var ctx = {

//             worksheet: 'Worksheet',

//             table: htmls

//         };

//         var link = document.createElement("a");

//         link.download = "Reorder Report.xls";

//         link.href = uri + base64(format(template, ctx));

//         link.click();

//     }

// }

$('#inventory_turnover_search').on('click', function () {

	get_inventory_turnover_list();

});

function get_inventory_turnover_list() {

	if (validate_inventory_turnover()) {

		var company_name = $('#company_name').val();

		var from_date = $('#rpt_payments1').html();

		var to_date = $('#rpt_payments2').html();

		var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

		var report_name = "PURCHASE IMPORT";

		var optional = $('#prod_select option:selected').html() != '' && $('#prod_select option:selected').html() != undefined ? $('#prod_select option:selected').html() + ' - ' : '';

		var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

			+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

		$("div.overlay").css("display", "block");

		my_Date = new Date();

		let id_branch = ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val());

		console.log({ 'id_branch': id_branch, 'id_product': $("#prod_select").val(), 'id_metal': $("#metal").val(), 'id_ret_category': $("#category").val(), 'des_select': $("#des_select").val(), 'sub_des_select': $("#sub_des_select").val(), 'karigar': $("#karigar").val(), 'section_select': $("#section_select").val(), 'group_by': $("#group_by").val(), 'date_type': $("#date_type").val(), 'dt_range': $("#dt_range").val() });

		let group_by_values = $("#group_by").val();

		let thead = '<table id="inventory_turnover" class="table table-bordered table-striped text-center"><thead>' +

			'<tr>';

		console.log(group_by_values);

		if (group_by_values != "undefined" && group_by_values != null && group_by_values.length > 0) {

			$(group_by_values).each(function (gp_idx, gp_val) {

				if (gp_val == 1) {

					thead += '<th>Product</th>';

				}

				if (gp_val == 2) {

					thead += '<th>Design</th>';

				}

				if (gp_val == 3) {

					thead += '<th>Sub Design</th>';

				}

				if (gp_val == 4) {

					thead += '<th>Section</th>';

				}

				if (gp_val == 5) {

					thead += '<th>Karigar</th>';

				}

				if (gp_val == 6) {

					thead += '<th>Weight Range</th>';

				}

				if (gp_val == 7) {

					thead += '<th>Size</th>';

				}

			});

		} else {

			var options = ["1", "2", "3", "6"];

			$('#group_by').val(null).trigger('change');

			$('#group_by').val(options);

			$('#group_by').trigger('change');

			thead += '<th>Product</th><th>Design</th><th>Sub Design</th><th>Weight Range</th>';

		}

		thead += '<th>Sales Gwt</th>' +

			'<th>Avg Stock Gwt</th>' +

			'<th>Inventory Turns</th>' +

			'<th>Inventory Turns/Year</th>' +

			'<th>Sell Through Ratio</th>' +

			'</tr>' +

			'</thead></table>';

		$(".inventory_turns_container").html(thead);

		$.ajax({

			url: base_url + "index.php/admin_ret_reports/inventory_turnover/ajax?nocache=" + my_Date.getUTCSeconds(),

			data: ({ 'id_branch': id_branch, 'id_product': $("#prod_select").val(), 'id_metal': $("#metal").val(), 'id_ret_category': $("#category").val(), 'des_select': $("#des_select").val(), 'sub_des_select': $("#sub_des_select").val(), 'karigar': $("#karigar").val(), 'section_select': $("#section_select").val(), 'group_by': $("#group_by").val(), 'dt_range': $("#dt_range").val() }),

			dataType: "JSON",

			type: "POST",

			success: function (data) {

				$("div.overlay").css("display", "none");

				let list = data.list.data;

				let diffInDays = !isNaN(data.list.diffInDays) && data.list.diffInDays != "" ? parseInt(data.list.diffInDays) : 0;

				let inventory_turns_per_year = !isNaN($('#inventory_turns_per_year').val()) && $.trim($('#inventory_turns_per_year').val()) != "" ? parseFloat($.trim($('#inventory_turns_per_year').val())) : 0;

				trHTML = '';

				if (list != null) {

					let total_avg_stock_gwt = 0;

					let total_sold_gwt = 0;

					let total_inv_turns = 0;

					let total_inv_turns_1_year = 0;

					let total_sell_through_ratio = 0;

					let no_avg_stock_gwt = 0;

					let no_sold_gwt = 0;

					let no_inv_turns = 0;

					let no_inv_turns_1_year = 0;

					let no_sell_through_ratio = 0;

					$.each(list, function (key_inv, invData) {

						console.log(invData);

						let trData = '<tr>';

						if (group_by_values != "undefined" && group_by_values != null && group_by_values.length > 0) {

							$(group_by_values).each(function (gp_idx, gp_val) {

								if (gp_val == 1) {

									trData += "<td>" + (invData.product_name == null ? "" : invData.product_name) + "</td>";

								}

								if (gp_val == 2) {

									trData += "<td>" + (invData.design_name == null ? "" : invData.design_name) + "</td>";

								}

								if (gp_val == 3) {

									trData += "<td>" + (invData.sub_design_name == null ? "" : invData.sub_design_name) + "</td>";

								}

								if (gp_val == 4) {

									trData += "<td>" + (invData.section_name == null ? "" : invData.section_name) + "</td>";

								}

								if (gp_val == 5) {

									trData += "<td>" + (invData.karigar_name == null ? "" : invData.karigar_name) + "</td>";

								}

								if (gp_val == 6) {

									trData += "<td>" + (invData.weight_name == null ? "" : invData.weight_name) + "</td>";

								}

								if (gp_val == 7) {

									trData += "<td>" + (invData.size_name == null ? "" : invData.size_name) + "</td>";

								}

							});

						} else {

							trData += "<td>" + (invData.product_name == null ? "" : invData.product_name) + "</td><td>" + (invData.design_name == null ? "" : invData.design_name) + "</td><td>" + (invData.sub_design_name == null ? "" : invData.sub_design_name) + "</td><td>" + (invData.weight_name == null ? "" : invData.weight_name) + "</td>";

						}

						let avg_stock_gwt = !isNaN(invData.avg_stock_gwt) && invData.avg_stock_gwt != "" ? parseFloat(invData.avg_stock_gwt) : 0;

						let sold_gwt = !isNaN(invData.sold_gwt) && invData.sold_gwt != "" ? parseFloat(invData.sold_gwt) : 0;

						let closing_wt = !isNaN(invData.closing_wt) && invData.closing_wt != "" ? parseFloat(invData.closing_wt) : 0;

						let inv_turns = avg_stock_gwt > 0 ? (sold_gwt / avg_stock_gwt) : 0;

						let inv_turns_1_year = diffInDays > 0 ? (inv_turns / diffInDays * 365) : 0;

						let sell_through_ratio = closing_wt > 0 ? sold_gwt / closing_wt : 0;

						trData += "<td>" + (sold_gwt == 0 ? '' : sold_gwt.toFixed(3)) + "</td><td>" + (avg_stock_gwt == 0 ? '' : avg_stock_gwt.toFixed(3)) + "</td><td>" + (inv_turns == 0 ? '' : inv_turns.toFixed(3)) + "</td><td>" + (inv_turns_1_year == 0 ? '' : inv_turns_1_year.toFixed(3)) + "</td><td>" + (sell_through_ratio == 0 ? '' : sell_through_ratio.toFixed(3)) + "</td>";

						trData += '</tr>';

						if (inv_turns_1_year >= inventory_turns_per_year) {

							trHTML += trData;

							no_avg_stock_gwt += (avg_stock_gwt > 0 ? 1 : 0);

							no_sold_gwt += (sold_gwt > 0 ? 1 : 0);

							no_inv_turns += (inv_turns > 0 ? 1 : 0);

							no_inv_turns_1_year += (inv_turns_1_year > 0 ? 1 : 0);

							no_sell_through_ratio += (sell_through_ratio > 0 ? 1 : 0);

							total_avg_stock_gwt += avg_stock_gwt;

							total_sold_gwt += sold_gwt;

							total_inv_turns += inv_turns;

							total_inv_turns_1_year += inv_turns_1_year;

							total_sell_through_ratio += sell_through_ratio;

						}

					});

					let totalTR = "<tr class='total_row'>";

					if (group_by_values != "undefined" && group_by_values != null && group_by_values.length > 0) {

						$(group_by_values).each(function (gp_idx, gp_val) {

							if (gp_val == 1) {

								totalTR += "<td></td>";

							}

							if (gp_val == 2) {

								totalTR += "<td></td>";

							}

							if (gp_val == 3) {

								totalTR += "<td></td>";

							}

							if (gp_val == 4) {

								totalTR += "<td></td>";

							}

							if (gp_val == 5) {

								totalTR += "<td></td>";

							}

							if (gp_val == 6) {

								totalTR += "<td></td>";

							}

							if (gp_val == 7) {

								totalTR += "<td></td>";

							}

						});

					} else {

						totalTR += "<td></td><td></td><td></td><td></td>";

					}

					totalTR += "<td>" + (no_sold_gwt > 0 ? (total_sold_gwt / no_sold_gwt).toFixed(3) : 0) + "</td><td>" + (no_avg_stock_gwt > 0 ? (total_avg_stock_gwt / no_avg_stock_gwt).toFixed(3) : 0) + "</td><td>" + (no_inv_turns > 0 ? (total_inv_turns / no_inv_turns).toFixed(3) : 0) + "</td><td>" + (no_inv_turns_1_year > 0 ? (total_inv_turns_1_year / no_inv_turns_1_year).toFixed(3) : 0) + "</td><td>" + (no_sell_through_ratio > 0 ? (total_sell_through_ratio / no_sell_through_ratio).toFixed(3) : 0) + "</td>";

					trHTML += totalTR;

				}

				$('#inventory_turnover').append("<tbody>" + trHTML + "</tbody>");

				$('.total_row td:first').html("Average");

				if (!$.fn.DataTable.isDataTable('#inventory_turnover')) {

					tableStockRatio = $('#inventory_turnover').dataTable({

						"bSort": false,

						"bInfo": true,

						"scrollX": '100%',

						"dom": 'lBfrtip',

						"paging": false,

						"fixedHeader": true,

						"buttons":

							[

								{

									extend: 'print',

									footer: true,

									title: '',

									messageTop: "Inventory Turn Over",

									customize: function (win) {

										$(win.document.body).find('table')

											.addClass('compact');

										$(win.document.body).find('table')

											.addClass('compact')

											.css('font-size', '10px')

											.css('font-family', 'sans-serif');

									},

									exportOptions: {

										columns: ':visible',

										stripHtml: false,

									}

								},

								{

									extend: 'excel',

									footer: true,

									title: 'Inventory Turn Over',

								}

							],

					});

				}

			},

			error: function (error) {

				$("div.overlay").css("display", "none");

			}

		});

	}

}

function validate_inventory_turnover() {

	let status = true;

	let id_branch = ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val());

	if (!(id_branch > 0)) {

		$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + 'Please select any one branch...' });

		status = false;

	}

	else if ($("#dt_range").val() == "") {

		$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + 'Date field cannot be empty...' });

		status = false;

	}

	return status;

}

$('#stockAgeDynamic_search').click(function (event) {

	set_dynamic_stock_age_table();

});

function set_dynamic_stock_age_table(branch = "") {

	if (validate_stock_days()) {

		$("div.overlay").css("display", "block");

		let dt_range = $("#dt_range").val();

		let stock_days = [];

		let dynamic_days = '';

		let no_dynamic_days = 0;

		$("#stock_age_days tbody tr").each(function () {

			let days_from = $.trim($(this).find(".days_from").val());

			let days_to = $.trim($(this).find(".days_to").val());

			let _days = {

				"days_from": days_from,

				"days_to": days_to

			}

			dynamic_days = dynamic_days + '<th width="5%">pcs(' + (days_from) + ' > ' + (days_to) + ')</th><th width="5%">Gwt(g)(' + (days_from) + ' > ' + (days_to) + ')</th><th width="5%">Nwt(g)(' + (days_from) + ' > ' + (days_to) + ')</th><th width="5%">Dwt(c)(' + (days_from) + ' > ' + (days_to) + ')</th>';

			stock_days.push(_days);

			no_dynamic_days++;

		});

		let pcs_wt_row = "<th>Pcs</th><th>GWt(Gms)</th><th>NWt(Gms)</th><th>DWt(CT)</th>";

		for (let i = 1; i < no_dynamic_days; i++) {

			pcs_wt_row = pcs_wt_row + "<th>Pcs</th><th>GWt(Gms)</th><th>NWt(Gms)</th><th>DWt(CT)</th>";

		}

		console.log(stock_days);

		/*var oTable = $('#stock_age_dynamic_list').DataTable();

		oTable.clear().draw();

		$("#stock_age_dynamic_list > tbody > tr").remove();

		$("#stock_age_dynamic_list > thead > th").remove();

		$('#stock_age_dynamic_list').dataTable().fnClearTable();

		$('#stock_age_dynamic_list').dataTable().fnDestroy();*/

		let thead = `<table id="stock_age_dynamic_list" class="table table-bordered table-striped text-center"><thead>` +

			`<tr>` +

			`<th width="5%" class="desc">Description</th>`;

		if ($("#group_type").val() == 2) {

			thead += `<th width="5%" class="desc">Product</th>

					<th width="5%" class="desc">Design</th>

					<th width="5%" class="desc">Sub Design</th>

					<th width="5%" class="desc">Age(days)</th>`;

		}

		thead += dynamic_days +

			`</tr>` +

			`</thead></table>`;

		$(".stock_age_container").html(thead);

		let id_branch = ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val());

		var age_type = $("#age_type").val();

		my_Date = new Date();

		$.ajax({

			url: base_url + "index.php/admin_ret_reports/stock_age/get_dynamic_age_list?nocache=" + my_Date.getUTCSeconds(),

			data: ({ 'id_branch': id_branch, 'id_product': $("#prod_select").val(), 'id_metal': $("#metal").val(), 'id_ret_category': $("#category").val(), 'des_select': $("#des_select").val(), 'sub_des_select': $("#sub_des_select").val(), 'karigar': $("#karigar").val(), 'section_select': $("#section_select").val(), 'group_by': $("#stock_age_group_by").val(), 'group_type': $("#group_type").val(), 'dt_range': dt_range, 'stock_days': stock_days, 'age_type': age_type}),

			dataType: "JSON",

			type: "POST",

			success: function (data) {

				$("div.overlay").css("display", "none");

				var list = data.list;

				$('#total_count').text(list.length);

				//var oTable = $('#stock_age_dynamic_list').DataTable();

				if (list != null) {

					let group_by_values = $("#stock_age_group_by").val();

					let group_by_count = 0;

					if (group_by_values) {

						if (group_by_values.includes("1") || group_by_values.includes("5") || group_by_values.includes("6")) {

							group_by_count++;

						}

						if (group_by_values.includes("2") || group_by_values.includes("3") || group_by_values.includes("4") || group_by_values.includes("7")) {

							group_by_count++;

						}

					}

					if ($("#group_type").val() == 2) {

						group_by_count++;

					}

					let blank_tds = "";

					if (no_dynamic_days > 0) {

						tds = "<td></td><td></td><td></td><td></td>";

						blank_tds = tds.repeat(no_dynamic_days);

					}

					trHTML = '';

					if (group_by_count == 0) {

						let stock_days_td = "";

						$(stock_days).each(function (stock_idx, stock_val) {

							let days_obj = stock_val.days_from + "_" + stock_val.days_to;

							if (list.hasOwnProperty(days_obj) && list[days_obj] !== undefined) {

								stock_days_td = stock_days_td + "<td class='summary age_pcs'>" + list[days_obj].pcs + "</td><td class='summary age_wt'>" + (!isNaN(list[days_obj].wt) && list[days_obj].wt != "" ? parseFloat(list[days_obj].wt).toFixed(3) : '') + "</td><td class='summary age_nwt'>" + (!isNaN(list[days_obj].nwt) && list[days_obj].nwt != "" ? parseFloat(list[days_obj].nwt).toFixed(3) : '') + "</td><td class='summary age_dwt'>" + (!isNaN(list[days_obj].dwt) && list[days_obj].dwt != "" ? parseFloat(list[days_obj].dwt).toFixed(3) : '') + "</td>";

							} else {

								stock_days_td = stock_days_td + "<td></td><td></td><td></td><td></td>";

							}

						});

						trHTML += '<tr>'

							+ '<td class="summary">Total Summary</td>';

						if ($("#group_type").val() == 2) {

							trHTML += '<td class="summary"></td>'

								+ '<td class="summary"></td>'

								+ '<td class="summary"></td>'

								+ '<td class="summary"></td>';

						}

						trHTML += stock_days_td + '</tr>';

					} else {

						let grandtotal_pcs = [];

						let grandtotal_wt = [];

						let grandtotal_nwt = [];

						let grandtotal_dwt = [];

						$.each(list, function (key_1, val_1) {

							if (group_by_count == 1) {

								let stock_days_td = "";

								$(stock_days).each(function (stock_idx, stock_val) {

									let days_obj = stock_val.days_from + "_" + stock_val.days_to;

									if (val_1.hasOwnProperty(days_obj) && val_1[days_obj] !== undefined) {

										stock_days_td = stock_days_td + "<td class='age_pcs'>" + val_1[days_obj].pcs + "</td><td  class='age_wt'>" + (!isNaN(val_1[days_obj].wt) && val_1[days_obj].wt != "" ? parseFloat(val_1[days_obj].wt).toFixed(3) : '') + "</td><td  class='age_nwt'>" + (!isNaN(val_1[days_obj].nwt) && val_1[days_obj].nwt != "" ? parseFloat(val_1[days_obj].nwt).toFixed(3) : '') + "</td><td  class='age_dwt'>" + (!isNaN(val_1[days_obj].dwt) && val_1[days_obj].dwt != "" ? parseFloat(val_1[days_obj].dwt).toFixed(3) : '') + "</td>";

										grandtotal_pcs[days_obj] = (grandtotal_pcs.hasOwnProperty(days_obj) ? grandtotal_pcs[days_obj] : 0) + val_1[days_obj].pcs;

										grandtotal_wt[days_obj] = (grandtotal_wt.hasOwnProperty(days_obj) ? parseFloat(grandtotal_wt[days_obj]) : 0) + parseFloat(!isNaN(val_1[days_obj].wt) && val_1[days_obj].wt != "" ? parseFloat(val_1[days_obj].wt).toFixed(3) : 0);

										grandtotal_nwt[days_obj] = (grandtotal_nwt.hasOwnProperty(days_obj) ? parseFloat(grandtotal_nwt[days_obj]) : 0) + parseFloat(!isNaN(val_1[days_obj].nwt) && val_1[days_obj].nwt != "" ? parseFloat(val_1[days_obj].nwt).toFixed(3) : 0);

										grandtotal_dwt[days_obj] = (grandtotal_dwt.hasOwnProperty(days_obj) ? parseFloat(grandtotal_dwt[days_obj]) : 0) + parseFloat(!isNaN(val_1[days_obj].dwt) && val_1[days_obj].dwt != "" ? parseFloat(val_1[days_obj].dwt).toFixed(3) : 0);

									} else {

										stock_days_td = stock_days_td + "<td></td><td></td><td></td><td></td>";

									}

								});

								trHTML += '<tr>'

									+ '<td class="stock_age_heading3">' + key_1 + '</td>';

								if ($("#group_type").val() == 2) {

									trHTML += '<td class="stock_age_heading3">' + val_1.product_name + '</td>'

										+ '<td class="stock_age_heading3">' + val_1.design_name + '</td>'

										+ '<td class="stock_age_heading3">' + val_1.sub_design_name + '</td>'

										+ '<td class="stock_age_heading3">' + val_1.age + '</td>';

								}

								trHTML += stock_days_td

									+ '</tr>';

							} else {

								trHTML += '<tr>'

									+ '<td class="stock_age_heading1">' + key_1 + '</td>';

								if ($("#group_type").val() == 2) {

									trHTML += '<td></td>'

										+ '<td></td>'

										+ '<td></td>'

										+ '<td></td>';

								}

								trHTML += blank_tds

									+ '</tr>';

								let subtotal_val2_pcs = [];

								let subtotal_val2_wt = [];

								let subtotal_val2_nwt = [];

								let subtotal_val2_dwt = [];

								$.each(val_1, function (key_2, val_2) {

									if (group_by_count == 2) {

										let stock_days_td = "";

										$(stock_days).each(function (stock_idx, stock_val) {

											let days_obj = stock_val.days_from + "_" + stock_val.days_to;

											if (val_2.hasOwnProperty(days_obj) && val_2[days_obj] !== undefined) {

												stock_days_td = stock_days_td + "<td class='age_pcs'>" + val_2[days_obj].pcs + "</td><td class='age_wt'>" + (!isNaN(val_2[days_obj].wt) && val_2[days_obj].wt != "" ? parseFloat(val_2[days_obj].wt).toFixed(3) : '') + "</td><td class='age_nwt'>" + (!isNaN(val_2[days_obj].nwt) && val_2[days_obj].nwt != "" ? parseFloat(val_2[days_obj].nwt).toFixed(3) : '') + "</td><td class='age_dwt'>" + (!isNaN(val_2[days_obj].dwt) && val_2[days_obj].dwt != "" ? parseFloat(val_2[days_obj].dwt).toFixed(3) : '') + "</td>";

												subtotal_val2_pcs[days_obj] = (subtotal_val2_pcs.hasOwnProperty(days_obj) ? subtotal_val2_pcs[days_obj] : 0) + val_2[days_obj].pcs;

												subtotal_val2_wt[days_obj] = (subtotal_val2_wt.hasOwnProperty(days_obj) ? parseFloat(subtotal_val2_wt[days_obj]) : 0) + parseFloat(!isNaN(val_2[days_obj].wt) && val_2[days_obj].wt != "" ? parseFloat(val_2[days_obj].wt).toFixed(3) : 0);

												subtotal_val2_nwt[days_obj] = (subtotal_val2_nwt.hasOwnProperty(days_obj) ? parseFloat(subtotal_val2_nwt[days_obj]) : 0) + parseFloat(!isNaN(val_2[days_obj].nwt) && val_2[days_obj].nwt != "" ? parseFloat(val_2[days_obj].nwt).toFixed(3) : 0);

												subtotal_val2_dwt[days_obj] = (subtotal_val2_dwt.hasOwnProperty(days_obj) ? parseFloat(subtotal_val2_dwt[days_obj]) : 0) + parseFloat(!isNaN(val_2[days_obj].dwt) && val_2[days_obj].dwt != "" ? parseFloat(val_2[days_obj].dwt).toFixed(3) : 0);

												grandtotal_pcs[days_obj] = (grandtotal_pcs.hasOwnProperty(days_obj) ? grandtotal_pcs[days_obj] : 0) + val_2[days_obj].pcs;

												grandtotal_wt[days_obj] = (grandtotal_wt.hasOwnProperty(days_obj) ? parseFloat(grandtotal_wt[days_obj]) : 0) + parseFloat(!isNaN(val_2[days_obj].wt) && val_2[days_obj].wt != "" ? parseFloat(val_2[days_obj].wt).toFixed(3) : 0);

												grandtotal_nwt[days_obj] = (grandtotal_nwt.hasOwnProperty(days_obj) ? parseFloat(grandtotal_nwt[days_obj]) : 0) + parseFloat(!isNaN(val_2[days_obj].nwt) && val_2[days_obj].nwt != "" ? parseFloat(val_2[days_obj].nwt).toFixed(3) : 0);

												grandtotal_dwt[days_obj] = (grandtotal_dwt.hasOwnProperty(days_obj) ? parseFloat(grandtotal_dwt[days_obj]) : 0) + parseFloat(!isNaN(val_2[days_obj].dwt) && val_2[days_obj].dwt != "" ? parseFloat(val_2[days_obj].dwt).toFixed(3) : 0);

											} else {

												stock_days_td = stock_days_td + "<td></td><td></td><td></td><td></td>";

											}

										});

										trHTML += '<tr>'

											+ '<td class="stock_age_heading3">' + key_2 + '</td>';

										if ($("#group_type").val() == 2) {

											trHTML += '<td class="stock_age_heading3">' + val_2.product_name + '</td>'

												+ '<td class="stock_age_heading3">' + val_2.design_name + '</td>'

												+ '<td class="stock_age_heading3">' + val_2.sub_design_name + '</td>'

												+ '<td class="stock_age_heading3">' + val_2.age + '</td>';

										}

										trHTML += stock_days_td

											+ '</tr>';

									} else {

										trHTML += '<tr>'

											+ '<td class="stock_age_heading2">' + key_2 + '</td>';

										if ($("#group_type").val() == 2) {

											trHTML += '<td class=""></td>'

												+ '<td class=""></td>'

												+ '<td class=""></td>'

												+ '<td class=""></td>';

										}

										trHTML += blank_tds

											+ '</tr>';

										let subtotal_val3_pcs = [];

										let subtotal_val3_wt = [];

										let subtotal_val3_nwt = [];

										let subtotal_val3_dwt = [];

										$.each(val_2, function (key_3, val_3) {

											let stock_days_td = "";

											$(stock_days).each(function (stock_idx, stock_val) {

												let days_obj = stock_val.days_from + "_" + stock_val.days_to;

												if (val_3.hasOwnProperty(days_obj) && val_3[days_obj] !== undefined) {

													stock_days_td = stock_days_td + "<td class='age_pcs'>" + val_3[days_obj].pcs + "</td><td class='age_wt'>" + (!isNaN(val_3[days_obj].wt) && val_3[days_obj].wt != "" ? parseFloat(val_3[days_obj].wt).toFixed(3) : '') + "</td><td class='age_nwt'>" + (!isNaN(val_3[days_obj].nwt) && val_3[days_obj].nwt != "" ? parseFloat(val_3[days_obj].nwt).toFixed(3) : '') + "</td><td class='age_dwt'>" + (!isNaN(val_3[days_obj].dwt) && val_3[days_obj].dwt != "" ? parseFloat(val_3[days_obj].dwt).toFixed(3) : '') + "</td>";

													subtotal_val3_pcs[days_obj] = (subtotal_val3_pcs.hasOwnProperty(days_obj) ? subtotal_val3_pcs[days_obj] : 0) + val_3[days_obj].pcs;

													subtotal_val3_wt[days_obj] = (subtotal_val3_wt.hasOwnProperty(days_obj) ? parseFloat(subtotal_val3_wt[days_obj]) : 0) + parseFloat(!isNaN(val_3[days_obj].wt) && val_3[days_obj].wt != "" ? parseFloat(val_3[days_obj].wt).toFixed(3) : 0);

													subtotal_val3_nwt[days_obj] = (subtotal_val3_nwt.hasOwnProperty(days_obj) ? parseFloat(subtotal_val3_nwt[days_obj]) : 0) + parseFloat(!isNaN(val_3[days_obj].nwt) && val_3[days_obj].nwt != "" ? parseFloat(val_3[days_obj].nwt).toFixed(3) : 0);

													subtotal_val3_dwt[days_obj] = (subtotal_val3_dwt.hasOwnProperty(days_obj) ? parseFloat(subtotal_val3_dwt[days_obj]) : 0) + parseFloat(!isNaN(val_3[days_obj].dwt) && val_3[days_obj].dwt != "" ? parseFloat(val_3[days_obj].dwt).toFixed(3) : 0);

													subtotal_val2_pcs[days_obj] = (subtotal_val2_pcs.hasOwnProperty(days_obj) ? subtotal_val2_pcs[days_obj] : 0) + val_3[days_obj].pcs;

													subtotal_val2_wt[days_obj] = (subtotal_val2_wt.hasOwnProperty(days_obj) ? parseFloat(subtotal_val2_wt[days_obj]) : 0) + parseFloat(!isNaN(val_3[days_obj].wt) && val_3[days_obj].wt != "" ? parseFloat(val_3[days_obj].wt).toFixed(3) : 0);

													subtotal_val2_nwt[days_obj] = (subtotal_val2_nwt.hasOwnProperty(days_obj) ? parseFloat(subtotal_val2_nwt[days_obj]) : 0) + parseFloat(!isNaN(val_3[days_obj].nwt) && val_3[days_obj].nwt != "" ? parseFloat(val_3[days_obj].nwt).toFixed(3) : 0);

													subtotal_val2_dwt[days_obj] = (subtotal_val2_dwt.hasOwnProperty(days_obj) ? parseFloat(subtotal_val2_dwt[days_obj]) : 0) + parseFloat(!isNaN(val_3[days_obj].dwt) && val_3[days_obj].dwt != "" ? parseFloat(val_3[days_obj].dwt).toFixed(3) : 0);

													grandtotal_pcs[days_obj] = (grandtotal_pcs.hasOwnProperty(days_obj) ? grandtotal_pcs[days_obj] : 0) + val_3[days_obj].pcs;

													grandtotal_wt[days_obj] = (grandtotal_wt.hasOwnProperty(days_obj) ? parseFloat(grandtotal_wt[days_obj]) : 0) + parseFloat(!isNaN(val_3[days_obj].wt) && val_3[days_obj].wt != "" ? parseFloat(val_3[days_obj].wt).toFixed(3) : 0);

													grandtotal_nwt[days_obj] = (grandtotal_nwt.hasOwnProperty(days_obj) ? parseFloat(grandtotal_nwt[days_obj]) : 0) + parseFloat(!isNaN(val_3[days_obj].nwt) && val_3[days_obj].nwt != "" ? parseFloat(val_3[days_obj].nwt).toFixed(3) : 0);

													grandtotal_dwt[days_obj] = (grandtotal_dwt.hasOwnProperty(days_obj) ? parseFloat(grandtotal_dwt[days_obj]) : 0) + parseFloat(!isNaN(val_3[days_obj].dwt) && val_3[days_obj].dwt != "" ? parseFloat(val_3[days_obj].dwt).toFixed(3) : 0);

												} else {

													stock_days_td = stock_days_td + "<td></td><td></td><td></td><td></td>";

												}

											});

											trHTML += '<tr>'

												+ '<td class="stock_age_heading3">' + key_3 + '</td>'

												+ '<td class="stock_age_heading3">' + val_3.product_name + '</td>'

												+ '<td class="stock_age_heading3">' + val_3.design_name + '</td>'

												+ '<td class="stock_age_heading3">' + val_3.sub_design_name + '</td>'

												+ '<td class="stock_age_heading3">' + val_3.age + '</td>'

												+ stock_days_td

												+ '</tr>';

										});

										let subtotal_val3_td = "";

										$(stock_days).each(function (stock_idx, stock_val) {

											let days_obj = stock_val.days_from + "_" + stock_val.days_to;

											if (subtotal_val3_pcs.hasOwnProperty(days_obj) && subtotal_val3_pcs[days_obj] !== undefined) {

												subtotal_val3_td = subtotal_val3_td + "<td class='val3 stock_age_total age_pcs'>" + subtotal_val3_pcs[days_obj] + "</td><td class='val3 stock_age_total age_wt'>" + subtotal_val3_wt[days_obj].toFixed(3) + "</td><td class='val3 stock_age_total age_nwt'>" + subtotal_val3_nwt[days_obj].toFixed(3) + "</td><td class='val3 stock_age_total age_dwt'>" + subtotal_val3_dwt[days_obj].toFixed(3) + "</td>";

											} else {

												subtotal_val3_td = subtotal_val3_td + "<td class='val3 stock_age_total'></td><td class='val3 stock_age_total'></td><td class='val3 stock_age_total'></td><td class='val3 stock_age_total'></td>";

											}

										});

										trHTML += '<tr>'

											+ '<td class="val3 stock_age_total total_heading">' + key_2 + ' TOTAL</td>';

										if ($("#group_type").val() == 2) {

											trHTML += '<td class="val3 stock_age_total total_heading"></td>'

												+ '<td class="val3 stock_age_total total_heading"></td>'

												+ '<td class="val3 stock_age_total total_heading"></td>'

												+ '<td class="val3 stock_age_total total_heading"></td>';

										}

										trHTML += subtotal_val3_td

											+ '</tr>';

									}

								});

								let subtotal_val2_td = "";

								$(stock_days).each(function (stock_idx, stock_val) {

									let days_obj = stock_val.days_from + "_" + stock_val.days_to;

									if (subtotal_val2_pcs.hasOwnProperty(days_obj) && subtotal_val2_pcs[days_obj] !== undefined) {

										subtotal_val2_td = subtotal_val2_td + "<td class='val2 stock_age_total age_pcs'>" + subtotal_val2_pcs[days_obj] + "</td><td class='val2 stock_age_total age_wt'>" + subtotal_val2_wt[days_obj].toFixed(3) + "</td><td class='val2 stock_age_total age_nwt'>" + subtotal_val2_nwt[days_obj].toFixed(3) + "</td><td class='val2 stock_age_total age_dwt'>" + subtotal_val2_dwt[days_obj].toFixed(3) + "</td>";

									} else {

										subtotal_val2_td = subtotal_val2_td + "<td class='val2 stock_age_total'></td><td class='val2 stock_age_total'></td><td class='val2 stock_age_total'></td><td class='val2 stock_age_total'></td>";

									}

								});

								trHTML += '<tr>'

									+ '<td  class="val2 stock_age_total total_heading">' + key_1 + ' TOTAL</td>';

								if ($("#group_type").val() == 2) {

									trHTML += '<td  class="val2 stock_age_total total_heading"></td>'

										+ '<td  class="val2 stock_age_total total_heading"></td>'

										+ '<td  class="val2 stock_age_total total_heading"></td>'

										+ '<td  class="val2 stock_age_total total_heading"></td>';

								}

								trHTML += subtotal_val2_td

									+ '</tr>';

							}

						});

						let grandtotal_td = "";

						$(stock_days).each(function (stock_idx, stock_val) {

							let days_obj = stock_val.days_from + "_" + stock_val.days_to;

							if (grandtotal_pcs.hasOwnProperty(days_obj) && grandtotal_pcs[days_obj] !== undefined) {

								grandtotal_td = grandtotal_td + "<td class='val1 stock_age_total age_pcs'>" + grandtotal_pcs[days_obj] + "</td><td class='val1 stock_age_total age_wt'>" + grandtotal_wt[days_obj].toFixed(3) + "</td><td class='val1 stock_age_total age_nwt'>" + grandtotal_nwt[days_obj].toFixed(3) + "</td><td class='val1 stock_age_total age_dwt'>" + grandtotal_dwt[days_obj].toFixed(3) + "</td>";

							} else {

								grandtotal_td = grandtotal_td + "<td class='val1 stock_age_total'></td><td class='val1 stock_age_total'></td><td class='val1 stock_age_total'></td><td class='val1 stock_age_total'></td>";

							}

						});

						trHTML += '<tr>'

							+ '<td  class="val1 stock_age_total total_heading">GRAND TOTAL</td>';

						if ($("#group_type").val() == 2) {

							trHTML += '<td  class="val1 stock_age_total total_heading"></td>'

								+ '<td  class="val1 stock_age_total total_heading"></td>'

								+ '<td  class="val1 stock_age_total total_heading"></td>'

								+ '<td  class="val1 stock_age_total total_heading"></td>';

						}

						trHTML += grandtotal_td

							+ '</tr>';

					}

					$('#stock_age_dynamic_list').append("<tbody>" + trHTML + "</tbody>");

					if (!$.fn.DataTable.isDataTable('#stock_age_dynamic_list')) {

						oTable = $('#stock_age_dynamic_list').dataTable({

							"bSort": false,

							"bInfo": true,

							"scrollX": '100%',

							"dom": 'lBfrtip',

							"paging": false,

							"fixedHeader": true,

							"buttons":

								[

									{

										extend: 'print',

										footer: true,

										title: '',

										messageTop: "Stock Age",

										customize: function (win) {

											$(win.document.body).find('table')

												.addClass('compact');

											$(win.document.body).find('table')

												.addClass('compact')

												.css('font-size', '10px')

												.css('font-family', 'sans-serif');

										},

										exportOptions: {

											columns: ':visible',

											stripHtml: false

										}

									},

									{

										extend: 'excel',

										footer: true,

										title: 'Stock Age ',

									}

								],

						});

					}

				}

			},

			error: function (error) {

				$("div.overlay").css("display", "none");

			}

		});

	}

}

$(document).on("click", ".stock_days_add", function (e) {

	e.preventDefault();

	if (validate_stock_days()) {

		let _html_add = `<tr>

						<td><input type="number" value="" class="form-control days_from" /></td>

						<td><input type="number" value="" class="form-control days_to" /></td>

						<td>

						<button class="plus-button stock_days_add"><i class="fa fa-plus fa-lg"></i></button> &nbsp; &nbsp;

						<button class="del-button stock_days_del"><i class="fa fa-trash fa-lg"></i></button>

						</td>

					</tr>`;

		$("#stock_age_days tbody").append(_html_add);

	}

});

$(document).on("click", ".stock_days_del", function (e) {

	e.preventDefault();

	$(this).closest('tr').remove();

});

function validate_stock_days() {

	let is_validate = true;

	let previous_row_from_day = "";

	let previous_row_to_day = "";

	$("#stock_age_days tbody tr").each(function () {

		let days_from = parseFloat($.trim($(this).find(".days_from").val()));

		let days_to = parseFloat($.trim($(this).find(".days_to").val()));

		if (days_from == "" || days_to == "") {

			is_validate = false;

			$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + 'Please fill all the rows in Enter Days popup..' });

			return false;

		} else if (isNaN(days_from) || isNaN(days_to)) {

			is_validate = false;

			$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + 'Please enter a valid number in Enter Days popup..' });

			return false;

		} else if (days_from >= days_to) {

			is_validate = false;

			$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + 'From day cannot be greater than or equal to To day in Enter Days popup..' });

			return false;

		} else if (previous_row_to_day != "" ? days_from <= previous_row_to_day : false) {

			is_validate = false;

			$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + 'Day ' + days_from + ' cannot be less than or equal to day ' + previous_row_to_day + '  in Enter Days popup..' });

			return false;

		}

		previous_row_from_day = days_from;

		previous_row_to_day = days_to;

	});

	return is_validate;

}

$(document).on("click", "#stockage_days", function () {

	$('#stockDaysModal').modal('show');

	setTimeout(function () {

		$("#days_from_1").focus();

	}, 500);

});

$('#stockDaysModal').on('hidden.bs.modal', function () {

	$("#stockAgeDynamic_search").focus();

});

$('#stockratio_search').click(function (event) {

	get_stock_ratio_availability();

});

let tableStockRatio;

let stockRatioDates = [];

function get_stock_ratio_availability() {

	if (validate_stock_ratio_availability()) {

		$("div.overlay").css("display", "block");

		let dt_range = $("#dt_range").val();

		let id_branch = ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val());

		my_Date = new Date();

		$.ajax({

			url: base_url + "index.php/admin_ret_reports/stock_ratio_avail/ajax?nocache=" + my_Date.getUTCSeconds(),

			data: ({ 'id_product': $("#prod_select").val(), 'des_select': $("#des_select").val(), 'sub_des_select': $("#sub_des_select").val(), 'size': $("#size").val(), 'wt_range': $("#wt_select").val(), 'dt_range': dt_range }),

			dataType: "JSON",

			type: "POST",

			success: function (data) {

				$("div.overlay").css("display", "none");

				let stock_data = data.stock_data;

				let branches = data.branches;

				stockRatioDates = data.no_dates;

				//$('#total_count').text(list.length);

				let thead = `<table id="stock_ratio_avail_list" class="table table-bordered table-striped text-center"><thead>` +

					`<tr>` +

					`<th width="5%" class="desc">Product</th>` +

					`<th width="5%" class="desc">Design</th>` +

					`<th width="5%" class="desc">Sub Design</th>` +

					`<th width="5%" class="desc">Size</th>` +

					`<th width="5%" class="desc">Weight Range</th>`;

				$(branches).each(function (br_idx, br_val) {

					thead += `<th width="5%" class="desc">` + br_val.name + `</th>`;

				});

				thead += `<th width="5%" class="desc">Details</th></tr>` +

					`</thead></table>`;

				$(".stock_ratio_container").html(thead);

				trHTML = '';

				if (stock_data != null) {

					$.each(stock_data, function (key_product, pro_data) {

						$.each(pro_data, function (key_design, design_data) {

							$.each(design_data, function (key_subdesign, subdesign_data) {

								$.each(subdesign_data, function (key_size, size_data) {

									$.each(size_data, function (key_wr, br_data) {

										trHTML += '<tr>'

											+ '<td>' + key_product + '</td>'

											+ '<td>' + key_design + '</td>'

											+ '<td>' + key_subdesign + '</td>'

											+ '<td>' + key_size + '</td>'

											+ '<td>' + key_wr + '</td>';

										let allBrTd = "";

										let no_branches = 0;

										let branchDatas = [];

										$(branches).each(function (br_idx, br_val) {

											let branchTD = '<td></td>';

											$.each(br_data, function (branch, stock) {

												if (br_val.name == branch) {

													branchTD = '<td class="percentage">' + stock.stock_perc + '</td>';

													let dates = {

														"branch": branch,

														"dates": stock.dates,

														"stock_perc": stock.stock_perc

													}

													branchDatas.push(dates);

													return false;

												}

											});

											allBrTd += branchTD;

											no_branches++;

										});

										if (allBrTd != "") {

											allBrTd += "<td class='stock_ratio_details'><span class='glyphicon glyphicon-arrow-right'></span><span class='hidden_branch_data'>" + JSON.stringify(branchDatas) + "</span></td>";

											trHTML += allBrTd;

										}

										trHTML += '</tr>';

										//trHTML += '<tr><td colspan="'+(6+no_branches)+'"><table><thead><tr><td>Branch</td</tr></thead></table></td></tr>';

									});

								});

							});

						});

					});

				}

				$('#stock_ratio_avail_list').append("<tbody>" + trHTML + "</tbody>");

				if (!$.fn.DataTable.isDataTable('#stock_ratio_avail_list')) {

					tableStockRatio = $('#stock_ratio_avail_list').dataTable({

						"bSort": false,

						"bInfo": true,

						"scrollX": '100%',

						"dom": 'lBfrtip',

						"paging": false,

						"fixedHeader": true,

						"buttons":

							[

								{

									extend: 'print',

									footer: true,

									title: '',

									messageTop: "Stock Ratio Availability",

									customize: function (win) {

										$(win.document.body).find('table')

											.addClass('compact');

										$(win.document.body).find('table')

											.addClass('compact')

											.css('font-size', '10px')

											.css('font-family', 'sans-serif');

									},

									exportOptions: {

										columns: ':visible',

										stripHtml: false,

										columns: ':not(:last-child)',

									}

								},

								{

									extend: 'excel',

									footer: true,

									title: 'Stock Ratio Availability',

									exportOptions: {

										columns: ':not(:last-child)',

									}

								}

							],

					});

				}

			},

			error: function (error) {

				$("div.overlay").css("display", "none");

			}

		});

	}

}

function validate_stock_ratio_availability() {

	let status = true;

	if ($("#dt_range").val() == "") {

		$.toaster({ priority: 'danger', title: 'Warning!', message: '' + "</br>" + 'Date field cannot be empty...' });

		status = false;

	}

	return status;

}

$(document).on('click', '.stock_ratio_details', function (e) {

	let tr = e.target.closest('tr');

	let row = tableStockRatio.api().row(tr);

	if (row.child.isShown()) {

		// This row is already open - close it

		row.child.hide();

	}

	else {

		// Open this row

		let childData = $(tr).find('.hidden_branch_data').text();

		row.child(format_stock_ratio_child_table(childData)).show();

	}

});

function format_stock_ratio_child_table(childData) {

	// `d` is the original data object for the row

	//console.log(childData);

	let parsedData = JSON.parse(childData);

	let result = '<div class="stock-child-max-width"><table class="table table-bordered table-striped text-center stock_ratio_child_table"><thead><tr><th>Branch / Day</th>';

	$.each(stockRatioDates, function (date_idx, date) {

		result += '<th>' + date + '</th>';

	});

	result += '<th>Ratio</th>';

	result += '</tr></thead>';

	let trHTML = "";

	$.each(parsedData, function (br_idx, br_data) {

		trHTML += '<tr><td class="br_name">' + (br_data.branch) + '</td>';

		$.each(stockRatioDates, function (date_idx, date) {

			$.each(br_data.dates, function (date_idx, date_val) {

				if (date == date_idx) {

					trHTML += '<td>' + date_val + '</td>';

					return false;

				}

			});

		});

		trHTML += '<td class="stock_perc percentage">' + (br_data.stock_perc) + '</td></tr>';

	});

	result += '<tbody>' + trHTML + '</tbody></table></div>';

	return result;

}

function get_product_size(id_product = "") {

	$("#size").empty();

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/get_product_size/" + id_product + "?nocache=" + my_Date.getUTCSeconds(),

		dataType: "JSON",

		type: "GET",

		success: function (data) {

			$.each(data, function (key, item) {

				$('#size').append(

					$("<option></option>")

						.attr("value", item.id_size)

						.text(item.value + " " + item.name)

				);

			});

			$("#size").select2({

				placeholder: "Select size",

				allowClear: true

			});

			$("#size").select2("val", "");

		}

	});

}

function get_influencer() {

	$('#select_influencer option').remove();

	$.ajax({

		type: 'GET',

		url: base_url + 'index.php/admin_ret_reports/get_influencer',

		dataType: 'json',

		success: function (data) {

			var size = $('#select_influencer').val();

			$.each(data, function (key, item) {

				$("#select_influencer").append(

					$("<option></option>")

						.attr("value", item.credit_reference)

						.text(item.credit_reference)

				);

			});

			$("#select_influencer").select2({

				placeholder: "Select Influencer",

				allowClear: true

			});

			$("#select_influencer").select2("val", '');

		}

	});

}

//repair gst abstract

$('#repair_gst_abstract_search').on('click', function () {

	get_repair_gst_abstract_details();

});

function get_repair_gst_abstract_details() {

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var company_name = $('#company_name').val();

	var title = "<b><span style='font-size:15pt;margin-left:32%;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>" + "<span style=font-size:12pt;margin-left:20%;>&nbsp;&nbsp;REPAIR GST ABSTRACT &nbsp;" + ($("#branch_select").val() != '' ? "COST CENTER:" + branch_name + " " : '') + " From&nbsp;:&nbsp;" + $('#rpt_from_date').html() + " &nbsp;&nbsp;- " + $('#rpt_to_date').html() + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/repair_gst_abstract/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'from_date': $('#rpt_from_date').html(), 'to_date': $('#rpt_to_date').html(), 'id_branch': $("#branch_select").val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.list;

			$('#total_count').text(list.length);

			var oTable = $('#repair_gst_abstract').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#repair_gst_abstract').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"order": [[0, "desc"]],

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"columnDefs": [

						{

							"targets": [5, 6, 7, 8, 9],

							"className": 'dt-body-right'

						}

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: '',

							messageTop: title,

						}

					],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "repair_del_ref_no" },

						{ "mDataProp": "bill_date" },

						{ "mDataProp": "cus_name" },

						{ "mDataProp": "mobile" },

						{ "mDataProp": "repair_type" },

						{ "mDataProp": "total_taxable_amount" },

						{ "mDataProp": "total_sgst" },

						{ "mDataProp": "total_cgst" },

						{ "mDataProp": "total_tax_amount" },

						{ "mDataProp": "total_amount" },

					],

					"footerCallback": function (row, data, start, end, display) {

						if (data.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								taxable_amt = api

									.column(5)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(5).footer()).html(parseFloat(taxable_amt).toFixed(2));

								total_sgst = api

									.column(6)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(6).footer()).html(parseFloat(total_sgst).toFixed(2));

								total_cgst = api

									.column(7)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(7).footer()).html(parseFloat(total_cgst).toFixed(2));

								total_tax_amount = api

									.column(8)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(8).footer()).html(parseFloat(total_tax_amount).toFixed(2));

								total_amount = api

									.column(9)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(9).footer()).html(parseFloat(total_amount).toFixed(2));

							}

						} else {

							var api = this.api(), data;

							$(api.column(5).footer()).html('');

							$(api.column(6).footer()).html('');

							$(api.column(7).footer()).html('');

							$(api.column(8).footer()).html('');

							$(api.column(9).footer()).html('');

						}

					}

				});

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

//repair gst abstract

function get_ActiveBankname() {

	$('#device_name option').remove();

	$.ajax({

		url: base_url + 'index.php/admin_ret_reports/get_ActiveBankname',

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var id = $("#id_bank").val();

			$("#bank").append(

				$("<option></option>")

					.attr("value", 0)

					.text('All')

			);

			$.each(data, function (key, item) {

				$("#bank").append(

					$("<option></option>")

						.attr("value", item.id_bank)

						.text(item.bank_name)

				);

			});

			$("#bank").select2(

				{

					placeholder: "Select Bank ",

					allowClear: true

				});

			$("#bank").select2("val", (id != '' && id > 0 ? id : ''));

		}

	});

}

$('#emp_ref_search').click(function (event) {

	set_estimation_referral_and_sales_return()

});

function set_estimation_referral_and_sales_return() {

	var dt_range = ($("#dt_range").val()).split('-');

	var company_name = $('#company_name').val();

	var from_date = dt_range[0];

	var to_date = dt_range[1];

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "SALES REFERRALS"

	var metal = $('#metal option:selected').html() != '' && $('#metal option:selected ').html() != undefined ? $('#metal option:selected').html() + " - " : '';

	var category = $('#category option:selected').html() != '' && $('#category option:selected ').html() != undefined ? $('#category option:selected').html() + " - " : '';

	var prod_select = $('#prod_select').text() != '' && $('#prod_select').text() != undefined ? $('#prod_select option:selected').text().split('-') + " - " : '';

	var optional = metal + category + prod_select;

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/employee_sales_referal_and_sales_return/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'id_branch': $("#branch_select").val(), 'dt_range': $("#dt_range").val(), 'id_metal': $('#metal').val(), 'id_ret_category': $('#category').val(), 'id_product': $('#prod_select').val(), 'id_report_type': $('#id_report_type').val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			console.log(list);

			var type = $('#id_report_type').val();

			if (type == 2) {	//Summary

				var trHtml = '';

				$("#ref_list_sum > tbody > tr").remove();

				$('#ref_list_sum').dataTable().fnClearTable();

				$('#ref_list_sum').dataTable().fnDestroy();

				if (list != null) {

					var tot_pcs = 0;

					var tot_gwt = 0;

					var tot_lwt = 0;

					var tot_nwt = 0;

					var tot_dwt = 0;

					var tot_amt = 0;

					var tot_ret_gwt = 0;

					var tot_ret_lwt = 0;

					var tot_ret_nwt = 0;

					var tot_ret_dwt = 0;

					var tot_ret_amt = 0;

					var tot_gross_wt = 0;

					var tot_net_wt = 0;

					var tot_less_wt = 0;

					var tot_dia_wt = 0;

					var tot_amount = 0;

					$.each(list, function (i, emp) {

						trHtml += '<tr>' +

							'<td>' + emp.branch_name + '</td>' +

							'<td>' + emp.emp_name + '</td>' +

							'<td>' + emp.emp_code + '</td>' +

							'<td>' + emp.piece + '</td>' +

							'<td style="background-color: rgba(200, 200, 200, 0.1)">' + emp.gross_wt + '</td>' +

							'<td style="background-color: rgba(200, 200, 200, 0.1)">' + emp.less_wt + '</td>' +

							'<td style="background-color: rgba(200, 200, 200, 0.1)">' + emp.net_wt + '</td>' +

							'<td style="background-color: rgba(200, 200, 200, 0.1)">' + parseFloat(emp.dia_wt).toFixed(3) + '</td>' +

							'<td style="background-color: rgba(200, 200, 200, 0.1)">' + money_format_india(emp.item_cost) + '</td>' +

							'<td>' + emp.return_gwt + '</td>' +

							'<td>' + emp.return_lwt + '</td>' +

							'<td>' + emp.return_nwt + '</td>' +

							'<td>' + emp.return_dwt + '</td>' +

							'<td>' + money_format_india(emp.return_item_cost) + '</td>' +

							'<td style="background-color: rgba(200, 200, 200, 0.1)">' + parseFloat((parseFloat(emp.gross_wt) - parseFloat(emp.return_gwt))).toFixed(3) + '</td>' +

							'<td style="background-color: rgba(200, 200, 200, 0.1)">' + parseFloat((parseFloat(emp.less_wt) - parseFloat(emp.return_lwt))).toFixed(3) + '</td>' +

							'<td style="background-color: rgba(200, 200, 200, 0.1)">' + parseFloat((parseFloat(emp.net_wt) - parseFloat(emp.return_nwt))).toFixed(3) + '</td>' +

							'<td style="background-color: rgba(200, 200, 200, 0.1)">' + parseFloat((parseFloat(emp.dia_wt) - parseFloat(emp.return_dwt))).toFixed(3) + '</td>' +

							'<td style="background-color: rgba(200, 200, 200, 0.1)">' + money_format_india(parseFloat((parseFloat(emp.item_cost) - parseFloat(emp.return_item_cost))).toFixed(2)) + '</td>' +

							'</tr>';

						tot_pcs += parseFloat(emp.piece);

						tot_gwt += parseFloat(emp.gross_wt);

						tot_lwt += parseFloat(emp.less_wt);

						tot_nwt += parseFloat(emp.net_wt);

						tot_dwt += parseFloat(emp.dia_wt);

						tot_ret_gwt += parseFloat(emp.return_gwt);

						tot_ret_lwt += parseFloat(emp.return_lwt);

						tot_ret_nwt += parseFloat(emp.return_nwt);

						tot_ret_dwt += parseFloat(emp.return_dwt);

						tot_amt += parseFloat(emp.item_cost);

						tot_ret_amt += parseFloat(emp.return_item_cost);

						//  tot_gross_wt += parseFloat(parseFloat(tot_gwt) - parseFloat(tot_ret_gwt));

						//  tot_less_wt +=parseFloat(parseFloat(tot_lwt) - parseFloat(tot_ret_lwt));

						//  tot_net_wt +=parseFloat(parseFloat(tot_nwt) - parseFloat(tot_ret_nwt));

						//  tot_dia_wt +=parseFloat(parseFloat(tot_dwt) - parseFloat(tot_ret_dwt));

						//  tot_amount +=parseFloat(parseFloat(tot_amt) - parseFloat(tot_ret_amt));

						tot_gross_wt += parseFloat(parseFloat(emp.gross_wt) - parseFloat(emp.return_gwt));

						tot_less_wt += parseFloat(parseFloat(emp.less_wt) - parseFloat(emp.return_lwt));

						tot_net_wt += parseFloat(parseFloat(emp.net_wt) - parseFloat(emp.return_nwt));

						tot_dia_wt += parseFloat(parseFloat(emp.dia_wt) - parseFloat(emp.return_dwt));

						tot_amount += parseFloat(parseFloat(emp.item_cost) - parseFloat(emp.return_item_cost));

					});

					trHtml += '<tr style="color:blue" >' +

						'<td><strong> GRAND TOTAL </strong></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td>' + money_format_india(parseFloat(tot_pcs)) + '</td>' +

						'<td>' + money_format_india(parseFloat(tot_gwt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(tot_lwt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(tot_nwt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(tot_dwt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(tot_amt).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(tot_ret_gwt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(tot_ret_lwt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(tot_ret_nwt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(tot_ret_dwt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(tot_ret_amt).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(tot_gross_wt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(tot_less_wt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(tot_net_wt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(tot_dia_wt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(tot_amount).toFixed(2)) + '</td>' +

						'</tr>';

					total_pcs += parseFloat(tot_pcs);

					total_gwt += parseFloat(tot_gwt);

					total_net += parseFloat(tot_nwt);

					total_less += parseFloat(tot_lwt);

					total_dwt += parseFloat(tot_dwt);

					total_amount += parseFloat(tot_amt);

					$('#ref_list_sum > tbody').html(trHtml);

					if (!$.fn.DataTable.isDataTable('#ref_list_sum')) {

						Table = $('#ref_list_sum').dataTable({

							"bSort": false,

							"bInfo": true,

							"scrollX": '100%',

							"dom": 'lBfrtip',

							"paging": false,

							"fixedHeader": true,

							"columnDefs": [

								{

									targets: [2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18],

									className: 'dt-right'

								},

								{

									targets: [0, 1],

									className: 'dt-left'

								},

							],

							"buttons": [

								{

									extend: 'print',

									footer: true,

									title: '',

									messageTop: title,

									customize: function (win) {

										$(win.document.body).find('table')

											.addClass('compact')

											.css('font-size', '10px');

									},

								},

								{

									extend: 'excel',

									footer: true,

									title: 'Employee Sales Referrals' + ' ( ' + from_date.replace(/\//g, "-") + ' TO ' + to_date.replace(/\//g, "-") + ' ) ',

								}

							],

						});

					}

				}

			} else if (type == 1) { //Detailed

				var trHtml = '';

				var total_pcs = 0;

				var total_gwt = 0;

				var total_net = 0;

				var total_less = 0;

				var total_dwt = 0;

				var total_amount = 0;

				var total_ret_gwt = 0;

				var total_ret_lwt = 0;

				var total_ret_nwt = 0;

				var total_ret_dwt = 0;

				var total_ret_amt = 0;

				var grand_total_gross_wt = 0;

				var grand_total_net_wt = 0;

				var grand_total_less_wt = 0;

				var grand_total_dia_wt = 0;

				var grand_total_item_cost = 0;

				$.each(list, function (i, emp) {

					var tot_pcs = 0

					var tot_gwt = 0

					var tot_lwt = 0

					var tot_nwt = 0

					var tot_dwt = 0

					var tot_amt = 0

					var tot_ret_gwt = 0

					var tot_ret_lwt = 0

					var tot_ret_nwt = 0

					var tot_ret_dwt = 0

					var tot_ret_amt = 0

					var total_gross_wt = 0

					var total_lwt = 0

					var total_nwt = 0

					var total_dia_wt = 0

					var total_amt = 0

					trHtml += '<tr>' +

						'<td ><strong>' + i + '</strong></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'</tr>';

					$.each(emp, function (i, items) {

						trHtml += '<tr>' +

							'<td >' + parseFloat(i + 1) + '</td>' +

							'<td >' + items.product_name + '</td>' +

							'<td >' + items.piece + '</td>' +

							'<td style="background-color: rgba(200, 200, 200, 0.1)">' + items.gross_wt + '</td>' +

							'<td style="background-color: rgba(200, 200, 200, 0.1)">' + items.less_wt + '</td>' +

							'<td style="background-color: rgba(200, 200, 200, 0.1)">' + items.net_wt + '</td>' +

							'<td style="background-color: rgba(200, 200, 200, 0.1)">' + parseFloat(items.dia_wt).toFixed(3) + '</td>' +

							'<td style="background-color: rgba(200, 200, 200, 0.1)">' + money_format_india(items.item_cost) + '</td>' +

							'<td>' + items.return_gwt + '</td>' +

							'<td>' + items.return_lwt + '</td>' +

							'<td>' + items.return_nwt + '</td>' +

							'<td>' + items.return_dwt + '</td>' +

							'<td>' + money_format_india(items.return_item_cost) + '</td>' +

							'<td style="background-color: rgba(200, 200, 200, 0.1)">' + parseFloat(parseFloat(items.gross_wt) - parseFloat(items.return_gwt)).toFixed(3) + '</td>' +

							'<td style="background-color: rgba(200, 200, 200, 0.1)">' + parseFloat(parseFloat(items.less_wt) - parseFloat(items.return_lwt)).toFixed(3) + '</td>' +

							'<td style="background-color: rgba(200, 200, 200, 0.1)">' + parseFloat(parseFloat(items.net_wt) - parseFloat(items.return_nwt)).toFixed(3) + '</td>' +

							'<td style="background-color: rgba(200, 200, 200, 0.1)">' + parseFloat(parseFloat(items.dia_wt) - parseFloat(items.return_dwt)).toFixed(3) + '</td>' +

							'<td style="background-color: rgba(200, 200, 200, 0.1)">' + money_format_india(parseFloat(parseFloat(items.item_cost) - parseFloat(items.return_item_cost)).toFixed(2)) + '</td>' +

							'</tr>';

						tot_pcs += parseFloat(items.piece);

						tot_gwt += parseFloat(items.gross_wt);

						tot_lwt += parseFloat(items.less_wt);

						tot_nwt += parseFloat(items.net_wt);

						tot_dwt += parseFloat(items.dia_wt);

						tot_amt += parseFloat(items.item_cost);

						tot_ret_gwt += parseFloat(items.return_gwt);

						tot_ret_lwt += parseFloat(items.return_lwt);

						tot_ret_nwt += parseFloat(items.return_nwt);

						tot_ret_dwt += parseFloat(items.return_dwt);

						tot_ret_amt += parseFloat(items.return_item_cost);

						total_gross_wt += parseFloat(parseFloat(items.gross_wt) - parseFloat(items.return_gwt));

						total_lwt += parseFloat(parseFloat(items.less_wt) - parseFloat(items.return_lwt));

						total_nwt += parseFloat(parseFloat(items.net_wt) - parseFloat(items.return_nwt));

						total_dia_wt += parseFloat(parseFloat(items.dia_wt) - parseFloat(items.return_dwt));

						total_amt += parseFloat(parseFloat(items.item_cost) - parseFloat(items.return_item_cost));

					});

					trHtml += '<tr style="color:blue" >' +

						'<td><strong> SUB TOTAL </strong></td>' +

						'<td></td>' +

						'<td>' + money_format_india(parseFloat(tot_pcs)) + '</td>' +

						'<td>' + money_format_india(parseFloat(tot_gwt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(tot_lwt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(tot_nwt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(tot_dwt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(tot_amt).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(tot_ret_gwt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(tot_ret_lwt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(tot_ret_nwt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(tot_ret_dwt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(tot_ret_amt).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(total_gross_wt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(total_lwt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(total_nwt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(total_dia_wt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(total_amt).toFixed(2)) + '</td>' +

						'</tr>';

					total_pcs += parseFloat(tot_pcs);

					total_gwt += parseFloat(tot_gwt);

					total_net += parseFloat(tot_nwt);

					total_less += parseFloat(tot_lwt);

					total_dwt += parseFloat(tot_dwt);

					total_amount += parseFloat(tot_amt);

					total_ret_gwt += parseFloat(tot_ret_gwt);

					total_ret_lwt += parseFloat(tot_ret_lwt);

					total_ret_nwt += parseFloat(tot_ret_nwt);

					total_ret_dwt += parseFloat(tot_ret_dwt);

					total_ret_amt += parseFloat(tot_ret_amt);

					grand_total_gross_wt += parseFloat(total_gross_wt);

					grand_total_net_wt += parseFloat(total_lwt);

					grand_total_less_wt += parseFloat(total_nwt);

					grand_total_dia_wt += parseFloat(total_dia_wt);

					grand_total_item_cost += parseFloat(total_amt);

				});

				trHtml += '<tr style="color:red">' +

					'<td style="text-align:left;"><strong>GRAND TOTAL</strong></td>' +

					'<td></td>' +

					'<td>' + money_format_india(parseInt(total_pcs)) + '</td>' +

					'<td>' + money_format_india(parseFloat(total_gwt).toFixed(3)) + '</td>' +

					'<td>' + money_format_india(parseFloat(total_less).toFixed(3)) + '</td>' +

					'<td>' + money_format_india(parseFloat(total_net).toFixed(3)) + '</td>' +

					'<td>' + money_format_india(parseFloat(total_dwt).toFixed(3)) + '</td>' +

					'<td>' + money_format_india(parseFloat(total_amount).toFixed(2)) + '</td>' +

					'<td>' + money_format_india(parseFloat(total_ret_gwt).toFixed(3)) + '</td>' +

					'<td>' + money_format_india(parseFloat(total_ret_lwt).toFixed(3)) + '</td>' +

					'<td>' + money_format_india(parseFloat(total_ret_nwt).toFixed(3)) + '</td>' +

					'<td>' + money_format_india(parseFloat(total_ret_dwt).toFixed(3)) + '</td>' +

					'<td>' + money_format_india(parseFloat(total_ret_amt).toFixed(2)) + '</td>' +

					'<td>' + money_format_india(parseFloat(grand_total_gross_wt).toFixed(3)) + '</td>' +

					'<td>' + money_format_india(parseFloat(grand_total_net_wt).toFixed(3)) + '</td>' +

					'<td>' + money_format_india(parseFloat(grand_total_less_wt).toFixed(3)) + '</td>' +

					'<td>' + money_format_india(parseFloat(grand_total_dia_wt).toFixed(3)) + '</td>' +

					'<td>' + money_format_india(parseFloat(grand_total_item_cost).toFixed(2)) + '</td>' +

					'</tr>';

				$('#ref_list_det > tbody').html(trHtml);

				if (!$.fn.DataTable.isDataTable('#ref_list_det')) {

					Table = $('#ref_list_det').dataTable({

						"bSort": false,

						"bInfo": true,

						"scrollX": '100%',

						"dom": 'lBfrtip',

						"paging": false,

						"fixedHeader": true,

						"columnDefs": [

							{

								targets: [2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17],

								className: 'dt-right'

							},

							{

								targets: [0, 1],

								className: 'dt-left'

							},

						],

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: '',

								messageTop: title,

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', '10px');

								},

							},

							{

								extend: 'excel',

								footer: true,

								title: 'Employee Sales Referrals' + ' ( ' + from_date.replace(/\//g, "-") + ' TO ' + to_date.replace(/\//g, "-") + ' ) ',

							}

						],

					});

				}

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

$(document).on('change', '#irn_rprt_type', function (idx, row) {

	if (this.value == 1) {

		$('#irn_sales_list').css('display', 'block');

		$('#irn_pur_ret_list').css('display', 'none');

	} else if (this.value == 2) {

		$('#irn_sales_list').css('display', 'none');

		$('#irn_pur_ret_list').css('display', 'block');

	}

});

/*Branch Vault Report*/

$('#branch_vault_search').on('click', function () {

	get_branch_vault_report();

})

function get_branch_vault_report() {

	var dt_range = ($("#dt_range").val()).split('-');

	var company_name = $('#company_name').val();

	var from_date = dt_range[0];

	var to_date = dt_range[1];

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "BRANCH VAULT REPORT ";

	var product = $('#product').val() != '' && $('#product').val() != undefined ? $('#product').val() + " - " : '';

	var category = $('#category option:selected').val() != '' && $('#category option:selected').val() != undefined ? $('#category option:selected').html() + " - " : '';

	var optional = '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		type: 'POST',

		url: base_url + "index.php/admin_ret_reports/branch_vault_report/ajax",

		dataType: 'JSON',

		data: { 'dt_range': $("#dt_range").val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'stock_type': $('#stock_type').val(), 'id_metal': $('#metal').val() },

		success: function (data) {

			$("div.overlay").css("display", "none");

			$("#branch_vault_report > tbody > tr").remove();

			$('#branch_vault_report').dataTable().fnClearTable();

			$('#branch_vault_report').dataTable().fnDestroy();

			var trHTML = '';

			var data = data.list;

			var tag_stock = data.tag_stock;

			var nontag_stock = data.nontag_stock;

			var sales_return_stock = data.sales_return_stock;

			var partly_sales_stock = data.partlysale_stock;

			var oldMetal_stock = data.oldmetal_stock;

			var op_tot_grswt = 0;

			var op_tot_nwt = 0;

			var op_tot_diawt = 0;

			var op_tot_grmwt = 0;

			var op_tot_ctwt = 0;

			var out_tot_grswt = 0;

			var out_tot_nwt = 0;

			var out_tot_diawt = 0;

			var out_tot_grmwt = 0;

			var out_tot_ctwt = 0;

			var inw_tot_grswt = 0;

			var inw_tot_nwt = 0;

			var inw_tot_diawt = 0;

			var inw_tot_grmwt = 0;

			var inw_tot_ctwt = 0;

			var closing_tot_grswt = 0;

			var closing_tot_nwt = 0;

			var closing_tot_diawt = 0;

			var closing_tot_grmwt = 0;

			var closing_tot_ctwt = 0;

			// Opening & Outward //

			trHTML += '<tr  style="font-weight:bold;color:blue;text-transform:uppercase;">' +

				'<td></td>' +

				'<td></td>' +

				'<td>Opening</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td>Outward</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'</tr>';

			var op_gwt_tag = 0;

			var op_nwt_tag = 0;

			var op_diawt_tag = 0;

			var op_grm_wt_tag = 0;

			var op_ct_wt_tag = 0;

			var out_gwt_tag = 0;

			var out_nwt_tag = 0;

			var out_diawt_tag = 0;

			var out_grm_wt_tag = 0;

			var out_ct_wt_tag = 0;

			if (tag_stock.length > 0) {

				$.each(tag_stock, function (key, item) {

					op_gwt_tag += parseFloat(item.op_blc_gwt);

					op_nwt_tag += parseFloat(item.op_blc_nwt);

					op_diawt_tag += parseFloat(item.op_blc_diawt);

					op_grm_wt_tag += parseFloat(item.op_grm_blc_wt);

					op_ct_wt_tag += parseFloat(item.op_ct_blc_wt);

					out_gwt_tag += parseFloat(parseFloat(item.sold_gwt) + parseFloat(item.blc_tag_gwt) + parseFloat(item.br_out_gwt) + parseFloat(item.ret_gwt) + parseFloat(item.iss_gwt));

					out_nwt_tag += parseFloat(parseFloat(item.sold_nwt) + parseFloat(item.blc_tag_nwt) + parseFloat(item.br_out_nwt) + parseFloat(item.ret_nwt) + parseFloat(item.iss_nwt));

					out_diawt_tag += parseFloat(parseFloat(parseFloat(item.sold_diawt) + parseFloat(item.blc_looseDia_wt) + parseFloat(item.br_out_diawt) + parseFloat(item.ret_diawt) + parseFloat(item.iss_diawt)));

					out_grm_wt_tag += parseFloat(parseFloat(item.sold_grm_wt) + parseFloat(item.blc_grm_wt) + parseFloat(item.grm_br_out_wt) + parseFloat(item.grm_ret_wt) + parseFloat(item.grm_iss_wt));

					out_ct_wt_tag += parseFloat(parseFloat(item.sold_ct_wt) + parseFloat(item.blc_ct_wt) + parseFloat(item.ct_br_out_wt) + parseFloat(item.ct_ret_wt) + parseFloat(item.ct_iss_wt));

					trHTML += '<tr >' +

						'<td>' + (item.cat_type == 1 ? 'OPENING ORANMENT STOCK(TAG)' : (item.cat_type == 2 ? 'OPENING PURE STOCK(TAG)' : 'LOOSE PRODUCT(TAG)')) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.op_blc_gwt).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.op_blc_nwt).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.op_blc_diawt).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.op_grm_blc_wt).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.op_ct_blc_wt).toFixed(3))) + '</td>' +

						'<td>' + (item.cat_type == 1 ? 'ORANMENT SOLD /<br> BALANCE /<br> BRANCH OUTWARDS(TAG)' : (item.cat_type == 2 ? 'PURE SOLD /<br> BALANCE /<br> BRANCH OUTWARDS(TAG)' : 'LOOSE STONE SOLD /<br> BALANCE /<br> BRANCH OUTWARDS(TAG)')) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.sold_gwt).toFixed(3)) + ' /<br> ' + money_format_india(parseFloat(item.blc_tag_gwt).toFixed(3)) + ' /<br> ' + money_format_india(parseFloat(parseFloat(item.br_out_gwt) + parseFloat(item.ret_gwt) + parseFloat(item.iss_gwt)).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.sold_nwt).toFixed(3)) + ' /<br> ' + money_format_india(parseFloat(item.blc_tag_nwt).toFixed(3)) + ' /<br> ' + money_format_india(parseFloat(parseFloat(item.br_out_nwt) + parseFloat(item.ret_nwt) + parseFloat(item.iss_nwt)).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.sold_diawt).toFixed(3)) + ' /<br> ' + money_format_india(parseFloat(item.blc_looseDia_wt).toFixed(3)) + ' /<br> ' + money_format_india(parseFloat(parseFloat(item.br_out_diawt) + parseFloat(item.ret_diawt) + parseFloat(item.iss_diawt)).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.sold_grm_wt).toFixed(3)) + ' /<br> ' + money_format_india(parseFloat(item.blc_grm_wt).toFixed(3)) + ' /<br> ' + money_format_india(parseFloat(parseFloat(item.grm_br_out_wt) + parseFloat(item.grm_ret_wt) + parseFloat(item.grm_iss_wt)).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.sold_ct_wt).toFixed(3)) + '/<br> ' + money_format_india(parseFloat(item.blc_ct_wt).toFixed(3)) + ' /<br> ' + money_format_india(parseFloat(parseFloat(item.ct_br_out_wt) + parseFloat(item.ct_ret_wt) + parseFloat(item.ct_iss_wt)).toFixed(3))) + '</td>' +

						'</tr>';

				});

				trHTML += '<tr  style="font-weight:bold;color:red;">' +

					'<td>SUB TOTAL</td>' +

					'<td>' + (money_format_india(parseFloat(op_gwt_tag).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(op_nwt_tag).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(op_diawt_tag).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(op_grm_wt_tag).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(op_ct_wt_tag).toFixed(3))) + '</td>' +

					'<td>SUB TOTAL</td>' +

					'<td>' + (money_format_india(parseFloat(out_gwt_tag).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(out_nwt_tag).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(out_diawt_tag).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(out_grm_wt_tag).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(out_ct_wt_tag).toFixed(3))) + '</td>' +

					'</tr>';

			}

			var op_gwt_nontag = 0;

			var op_nwt_nontag = 0;

			var out_gwt_nontag = 0;

			var out_nwt_nontag = 0;

			if (nontag_stock.length > 0) {

				$.each(nontag_stock, function (key, item) {

					op_gwt_nontag += parseFloat(item.op_blc_gwt);

					op_nwt_nontag += parseFloat(item.op_blc_nwt);

					out_gwt_nontag += parseFloat(parseFloat(item.sales_gwt) + parseFloat(item.br_out_gwt) + parseFloat(item.pur_ret_gwt) + parseFloat(item.kar_iss_gwt));

					out_nwt_nontag += parseFloat(parseFloat(item.sales_nwt) + parseFloat(item.br_out_nwt) + parseFloat(item.pur_ret_nwt) + parseFloat(item.kar_iss_nwt));

					trHTML += '<tr >' +

						'<td>' + (item.cat_type == 1 ? 'OPENING ORANMENT STOCK(NON-TAG)' : (item.cat_type == 2 ? 'OPENING PURE STOCK(NON-TAG)' : 'LOOSE PRODUCT(NON-TAG)')) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.op_blc_gwt).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.op_blc_nwt).toFixed(3))) + '</td>' +

						'<td>0.000 / 0.000</td>' +

						'<td>0.000 / 0.000</td>' +

						'<td>0.000 / 0.000</td>' +

						'<td>' + (item.cat_type == 1 ? 'ORANMENT SOLD / BANCH OUTWARDS(NON-TAG)' : (item.cat_type == 2 ? 'PURE SOLD / BRANCH OUTWARDS(NON-TAG)' : 'LOOSE PRODUCT SOLD / BRANCH OUTWARDS(NON-TAG)')) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.sales_gwt).toFixed(3)) + ' / ' + money_format_india(parseFloat(parseFloat(item.br_out_gwt) + parseFloat(item.pur_ret_gwt) + parseFloat(item.kar_iss_gwt)).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.sales_nwt).toFixed(3)) + ' / ' + money_format_india(parseFloat(parseFloat(item.br_out_nwt) + parseFloat(item.pur_ret_nwt) + parseFloat(item.kar_iss_nwt)).toFixed(3))) + '</td>' +

						'<td>0.000 / 0.000</td>' +

						'<td>0.000 / 0.000</td>' +

						'<td>0.000 / 0.000</td>' +

						'</tr>';

				});

				trHTML += '<tr  style="font-weight:bold;color:red;">' +

					'<td>SUB TOTAL</td>' +

					'<td>' + (money_format_india(parseFloat(op_gwt_nontag).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(op_nwt_nontag).toFixed(3))) + '</td>' +

					'<td>0.000</td>' +

					'<td>0.000</td>' +

					'<td>0.000</td>' +

					'<td>SUB TOTAL</td>' +

					'<td>' + (money_format_india(parseFloat(out_gwt_nontag).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(out_nwt_nontag).toFixed(3))) + '</td>' +

					'<td>0.000</td>' +

					'<td>0.000</td>' +

					'<td>0.000</td>' +

					'</tr>';

			}

			var op_sr_gwt = 0;

			var op_sr_nwt = 0;

			var op_sr_diawt = 0;

			var op_sr_grm_wt = 0;

			var op_sr_ct_wt = 0;

			var out_sr_gwt = 0;

			var out_sr_nwt = 0;

			var out_sr_diawt = 0;

			var out_sr_grm_wt = 0;

			var out_sr_ct_wt = 0;

			if (sales_return_stock.length > 0) {

				$.each(sales_return_stock, function (key, item) {

					op_sr_gwt += parseFloat(item.op_blc_gwt);

					op_sr_nwt += parseFloat(item.op_blc_nwt);

					op_sr_diawt += parseFloat(item.op_blc_diawt);

					op_sr_grm_wt += parseFloat(item.op_blc_grm_wt);

					op_sr_ct_wt += parseFloat(item.op_blc_ct_wt);

					out_sr_gwt += parseFloat(item.out_gwt);

					out_sr_nwt += parseFloat(item.out_netwt);

					out_sr_diawt += parseFloat(item.out_diawt);

					out_sr_grm_wt += parseFloat(item.out_grm_wt);

					out_sr_ct_wt += parseFloat(item.out_ct_wt);

					trHTML += '<tr >' +

						'<td>' + (item.cat_type == 1 ? 'SALES RETURN ORANMENT STOCK(PENDING)' : (item.cat_type == 2 ? 'SALES RETURN PURE STOCK(PENDING)' : 'SALES RETURN LOOSE PRODUCT(PENDING)')) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.op_blc_gwt).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.op_blc_nwt).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.op_blc_diawt).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.op_blc_grm_wt).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.op_blc_ct_wt).toFixed(3))) + '</td>' +

						'<td>' + (item.cat_type == 1 ? 'SALES RETURN OUTWARDS' : (item.cat_type == 2 ? 'SALES RETURN PURE OUTWARDS' : 'SALES RETURN LOOSE PRODUCT OUTWARDS')) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.out_gwt).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.out_netwt).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.out_diawt).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.out_grm_wt).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.out_ct_wt).toFixed(3))) + '</td>' +

						'</tr>';

				});

				trHTML += '<tr  style="font-weight:bold;color:red;">' +

					'<td>SUB TOTAL</td>' +

					'<td>' + (money_format_india(parseFloat(op_sr_gwt).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(op_sr_nwt).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(op_sr_diawt).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(op_sr_grm_wt).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(op_sr_ct_wt).toFixed(3))) + '</td>' +

					'<td>SUB TOTAL</td>' +

					'<td>' + (money_format_india(parseFloat(out_sr_gwt).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(out_sr_nwt).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(out_sr_diawt).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(out_sr_grm_wt).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(out_sr_ct_wt).toFixed(3))) + '</td>' +

					'</tr>';

			}

			var op_ps_gwt = 0;

			var op_ps_nwt = 0;

			var op_ps_diawt = 0;

			var op_ps_grm_wt = 0;

			var op_ps_ct_wt = 0;

			var out_ps_gwt = 0;

			var out_ps_nwt = 0;

			var out_ps_diawt = 0;

			var out_ps_grm_wt = 0;

			var out_ps_ct_wt = 0;

			if (partly_sales_stock.length > 0) {

				$.each(partly_sales_stock, function (key, item) {

					op_ps_gwt += parseFloat(item.op_blc_gwt);

					op_ps_nwt += parseFloat(item.op_blc_nwt);

					op_ps_diawt += parseFloat(item.op_blc_diawt);

					op_ps_grm_wt += parseFloat(item.op_blc_grm_wt);

					op_ps_ct_wt += parseFloat(item.op_blc_ct_wt);

					out_ps_gwt += parseFloat(item.out_gwt);

					out_ps_nwt += parseFloat(item.out_netwt);

					out_ps_diawt += parseFloat(item.out_diawt);

					out_ps_grm_wt += parseFloat(item.out_grm_wt);

					out_ps_ct_wt += parseFloat(item.out_ct_wt);

					trHTML += '<tr >' +

						'<td>' + (item.cat_type == 1 ? 'PARTLY SALES ORANMENT STOCK(PENDING)' : (item.cat_type == 2 ? 'PARTLY SALES PURE STOCK(PENDING)' : 'PARTLY SALES LOOSE PRODUCT(PENDING)')) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.op_blc_gwt).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.op_blc_nwt).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.op_blc_diawt).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.op_blc_grm_wt).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.op_blc_ct_wt).toFixed(3))) + '</td>' +

						'<td>' + (item.cat_type == 1 ? 'PARTLY SALES OUTWARDS' : (item.cat_type == 2 ? 'PARTLY SALES PURE OUTWARDS' : 'PARTLY SALES LOOSE PRODUCT OUTWARDS')) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.out_gwt).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.out_netwt).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.out_diawt).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.out_grm_wt).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.out_ct_wt).toFixed(3))) + '</td>' +

						'</tr>';

				});

				trHTML += '<tr  style="font-weight:bold;color:red;">' +

					'<td>SUB TOTAL</td>' +

					'<td>' + (money_format_india(parseFloat(op_ps_gwt).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(op_ps_nwt).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(op_ps_diawt).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(op_ps_grm_wt).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(op_ps_ct_wt).toFixed(3))) + '</td>' +

					'<td>SUB TOTAL</td>' +

					'<td>' + (money_format_india(parseFloat(out_ps_gwt).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(out_ps_nwt).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(out_ps_diawt).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(out_ps_grm_wt).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(out_ps_ct_wt).toFixed(3))) + '</td>' +

					'</tr>';

			}

			var op_oldmt_gwt = 0;

			var op_oldmt_nwt = 0;

			var op_oldmt_diawt = 0;

			var out_oldmt_gwt = 0;

			var out_oldmt_nwt = 0;

			var out_oldmt_diawt = 0;

			if (oldMetal_stock.length > 0) {

				$.each(oldMetal_stock, function (key, item) {

					op_oldmt_gwt += parseFloat(item.op_blc_gwt);

					op_oldmt_nwt += parseFloat(item.op_blc_nwt);

					op_oldmt_diawt += parseFloat(item.op_blc_diawt);

					out_oldmt_gwt += parseFloat(item.out_gwt);

					out_oldmt_nwt += parseFloat(item.out_netwt);

					out_oldmt_diawt += parseFloat(item.out_diawt);

					trHTML += '<tr >' +

						'<td>' + item.category_name + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.op_blc_gwt).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.op_blc_nwt).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.op_blc_diawt).toFixed(3))) + '</td>' +

						'<td>0.000</td>' +

						'<td>0.000</td>' +

						'<td>' + item.category_name + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.out_gwt).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.out_netwt).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.out_diawt).toFixed(3))) + '</td>' +

						'<td>0.000</td>' +

						'<td>0.000</td>' +

						'</tr>';

				});

				trHTML += '<tr  style="font-weight:bold;color:red;">' +

					'<td>SUB TOTAL</td>' +

					'<td>' + (money_format_india(parseFloat(op_oldmt_gwt).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(op_oldmt_nwt).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(op_oldmt_diawt).toFixed(3))) + '</td>' +

					'<td>0.000</td>' +

					'<td>0.000</td>' +

					'<td>SUB TOTAL</td>' +

					'<td>' + (money_format_india(parseFloat(out_oldmt_gwt).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(out_oldmt_nwt).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(out_oldmt_diawt).toFixed(3))) + '</td>' +

					'<td>0.000</td>' +

					'<td>0.000</td>' +

					'</tr>';

			}

			op_tot_grswt += parseFloat(parseFloat(op_gwt_tag) + parseFloat(op_gwt_nontag) + parseFloat(op_sr_gwt) + parseFloat(op_ps_gwt) + parseFloat(op_oldmt_gwt));

			op_tot_nwt += parseFloat(parseFloat(op_nwt_tag) + parseFloat(op_nwt_nontag) + parseFloat(op_sr_nwt) + parseFloat(op_ps_nwt) + parseFloat(op_oldmt_nwt));

			op_tot_diawt += parseFloat(parseFloat(op_diawt_tag) + parseFloat(op_sr_diawt) + parseFloat(op_ps_diawt) + parseFloat(op_oldmt_diawt));

			op_tot_grmwt += parseFloat(parseFloat(op_grm_wt_tag) + parseFloat(op_sr_grm_wt) + parseFloat(op_ps_grm_wt));

			op_tot_ctwt += parseFloat(parseFloat(op_ct_wt_tag) + parseFloat(op_sr_ct_wt) + parseFloat(op_ps_ct_wt));

			out_tot_grswt += parseFloat(parseFloat(out_gwt_tag) + parseFloat(out_gwt_nontag) + parseFloat(out_sr_gwt) + parseFloat(out_ps_gwt) + parseFloat(out_oldmt_gwt));

			out_tot_nwt += parseFloat(parseFloat(out_nwt_tag) + parseFloat(out_nwt_nontag) + parseFloat(out_sr_nwt) + parseFloat(out_ps_nwt) + parseFloat(out_oldmt_nwt));

			out_tot_diawt += parseFloat(parseFloat(out_diawt_tag) + parseFloat(out_sr_diawt) + parseFloat(out_ps_diawt) + parseFloat(out_oldmt_diawt));

			out_tot_grmwt += parseFloat(parseFloat(out_grm_wt_tag) + parseFloat(out_sr_grm_wt) + parseFloat(out_ps_grm_wt));

			out_tot_ctwt += parseFloat(parseFloat(out_ct_wt_tag) + parseFloat(out_sr_ct_wt) + parseFloat(out_ps_ct_wt));

			trHTML += '<tr  style="font-weight:bold;color:blue;">' +

				'<td><strong>GRAND TOTAL</strong></td>' +

				'<td><strong>' + (money_format_india(parseFloat(op_tot_grswt).toFixed(3))) + '</strong></td>' +

				'<td><strong>' + (money_format_india(parseFloat(op_tot_nwt).toFixed(3))) + '</strong></td>' +

				'<td><strong>' + (money_format_india(parseFloat(op_tot_diawt).toFixed(3))) + '</strong></td>' +

				'<td><strong>' + (money_format_india(parseFloat(op_tot_grmwt).toFixed(3))) + '</strong></td>' +

				'<td><strong>' + (money_format_india(parseFloat(op_tot_ctwt).toFixed(3))) + '</strong></td>' +

				'<td><strong>GRAND TOTAL</strong></td>' +

				'<td><strong>' + (money_format_india(parseFloat(out_tot_grswt).toFixed(3))) + '</strong></td>' +

				'<td><strong>' + (money_format_india(parseFloat(out_tot_nwt).toFixed(3))) + '</strong></td>' +

				'<td><strong>' + (money_format_india(parseFloat(out_tot_diawt).toFixed(3))) + '</strong></td>' +

				'<td><strong>' + (money_format_india(parseFloat(out_tot_grmwt).toFixed(3))) + '</strong></td>' +

				'<td><strong>' + (money_format_india(parseFloat(out_tot_ctwt).toFixed(3))) + '</strong></td>' +

				'</tr>';

			// Opening & Outward //

			// Receipt & Closing //

			trHTML += '<tr  style="font-weight:bold;color:blue;text-transform:uppercase;">' +

				'<td></td>' +

				'<td></td>' +

				'<td>RECEIPT</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td>CLOSING</td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'</tr>';

			var inw_gwt_tag = 0;

			var inw_nwt_tag = 0;

			var inw_diawt_tag = 0;

			var inw_grm_wt_tag = 0;

			var inw_ct_wt_tag = 0;

			var closing_gwt_tag = 0;

			var closing_nwt_tag = 0;

			var closing_diawt_tag = 0;

			var closing_grm_wt_tag = 0;

			var closing_ct_wt_tag = 0;

			if (tag_stock.length > 0) {

				$.each(tag_stock, function (key, item) {

					inw_gwt_tag += parseFloat(item.inw_gwt);

					inw_nwt_tag += parseFloat(item.inw_nwt);

					inw_diawt_tag += parseFloat(item.inw_diawt);

					inw_grm_wt_tag += parseFloat(item.grm_inw_wt);

					inw_ct_wt_tag += parseFloat(item.ct_inw_wt);

					closing_gwt_tag += parseFloat(parseFloat(item.op_blc_gwt) + parseFloat(item.inw_gwt) - parseFloat(item.sold_gwt) - parseFloat(item.blc_tag_gwt) - parseFloat(item.br_out_gwt) - parseFloat(item.ret_gwt) - parseFloat(item.iss_gwt));

					closing_nwt_tag += parseFloat(parseFloat(item.op_blc_nwt) + parseFloat(item.inw_nwt) - parseFloat(item.sold_nwt) - parseFloat(item.blc_tag_nwt) - parseFloat(item.br_out_nwt) - parseFloat(item.ret_nwt) - parseFloat(item.iss_nwt));

					closing_diawt_tag += parseFloat(parseFloat(item.op_blc_diawt) + parseFloat(item.inw_diawt) - parseFloat(item.sold_diawt) - parseFloat(item.br_out_diawt) - parseFloat(item.ret_diawt) - parseFloat(item.iss_diawt));

					closing_grm_wt_tag += parseFloat(parseFloat(item.op_grm_blc_wt) + parseFloat(item.grm_inw_wt) - parseFloat(item.sold_grm_wt) - parseFloat(item.blc_grm_wt) - parseFloat(item.grm_br_out_wt) - parseFloat(item.grm_ret_wt) - parseFloat(item.grm_iss_wt));

					closing_ct_wt_tag += parseFloat(parseFloat(item.op_ct_blc_wt) + parseFloat(item.ct_inw_wt) - parseFloat(item.sold_ct_wt) - parseFloat(item.blc_ct_wt) - parseFloat(item.ct_br_out_wt) - parseFloat(item.ct_ret_wt) - parseFloat(item.ct_iss_wt));

					trHTML += '<tr >' +

						'<td>' + (item.cat_type == 1 ? 'INWARD ORANMENT STOCK(TAG)' : (item.cat_type == 2 ? 'INWARD PURE STOCK(TAG)' : 'INWARD LOOSE PRODUCT(TAG)')) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.inw_gwt).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.inw_nwt).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.inw_diawt).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.grm_inw_wt).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.ct_inw_wt).toFixed(3))) + '</td>' +

						'<td>' + (item.cat_type == 1 ? 'CLOSING ORANMENT STOCK(TAG)' : (item.cat_type == 2 ? 'CLOSING PURE STOCK(TAG)' : 'CLOSING LOOSE PRODUCT STOCK(TAG)')) + '</td>' +

						'<td>' + (money_format_india(parseFloat(parseFloat(item.op_blc_gwt) + parseFloat(item.inw_gwt) - parseFloat(item.sold_gwt) - parseFloat(item.blc_tag_gwt) - parseFloat(item.br_out_gwt) - parseFloat(item.ret_gwt) - parseFloat(item.iss_gwt)).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(parseFloat(item.op_blc_nwt) + parseFloat(item.inw_nwt) - parseFloat(item.sold_nwt) - parseFloat(item.blc_tag_nwt) - parseFloat(item.br_out_nwt) - parseFloat(item.ret_nwt) - parseFloat(item.iss_nwt)).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(parseFloat(item.op_blc_diawt) + parseFloat(item.inw_diawt) - parseFloat(item.sold_diawt) - parseFloat(item.br_out_diawt) - parseFloat(item.ret_diawt) - parseFloat(item.iss_diawt)).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(parseFloat(item.op_grm_blc_wt) + parseFloat(item.grm_inw_wt) - parseFloat(item.sold_grm_wt) - parseFloat(item.blc_grm_wt) - parseFloat(item.grm_br_out_wt) - parseFloat(item.grm_ret_wt) - parseFloat(item.grm_iss_wt)).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(parseFloat(item.op_ct_blc_wt) + parseFloat(item.ct_inw_wt) - parseFloat(item.sold_ct_wt) - parseFloat(item.blc_ct_wt) - parseFloat(item.ct_br_out_wt) - parseFloat(item.ct_ret_wt) - parseFloat(item.ct_iss_wt)).toFixed(3))) + '</td>' +

						'</tr>';

				});

				trHTML += '<tr  style="font-weight:bold;color:red;">' +

					'<td>SUB TOTAL</td>' +

					'<td>' + (money_format_india(parseFloat(inw_gwt_tag).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(inw_nwt_tag).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(inw_diawt_tag).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(inw_grm_wt_tag).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(inw_ct_wt_tag).toFixed(3))) + '</td>' +

					'<td>SUB TOTAL</td>' +

					'<td>' + (money_format_india(parseFloat(closing_gwt_tag).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(closing_nwt_tag).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(closing_diawt_tag).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(closing_grm_wt_tag).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(closing_ct_wt_tag).toFixed(3))) + '</td>' +

					'</tr>';

			}

			var inw_gwt_nontag = 0;

			var inw_nwt_nontag = 0;

			var closing_gwt_nontag = 0;

			var closing_nwt_nontag = 0;

			if (nontag_stock.length > 0) {

				$.each(nontag_stock, function (key, item) {

					inw_gwt_nontag += parseFloat(item.inw_gwt);

					inw_nwt_nontag += parseFloat(item.inw_nwt);

					closing_gwt_nontag += parseFloat(parseFloat(item.op_blc_gwt) + parseFloat(item.inw_gwt) - parseFloat(item.sales_gwt) - parseFloat(item.br_out_gwt) - parseFloat(item.pur_ret_gwt) - parseFloat(item.kar_iss_gwt));

					closing_nwt_nontag += parseFloat(parseFloat(item.op_blc_nwt) + parseFloat(item.inw_nwt) - parseFloat(item.sales_nwt) - parseFloat(item.br_out_nwt) - parseFloat(item.pur_ret_nwt) - parseFloat(item.kar_iss_nwt));

					trHTML += '<tr >' +

						'<td>' + (item.cat_type == 1 ? 'INWARD ORANMENT STOCK(NON-TAG)' : (item.cat_type == 2 ? 'INWARD PURE STOCK(NON-TAG)' : 'INWARD LOOSE PRODUCT(NON-TAG)')) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.inw_gwt).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.inw_nwt).toFixed(3))) + '</td>' +

						'<td>0.000</td>' +

						'<td>0.000</td>' +

						'<td>0.000</td>' +

						'<td>' + (item.cat_type == 1 ? 'CLOSING ORANMENT STOCK(NON-TAG)' : (item.cat_type == 2 ? 'CLOSING PURE STOCK(NON-TAG)' : 'CLOSING LOOSE PRODUCT STOCK(NON-TAG)')) + '</td>' +

						'<td>' + (money_format_india(parseFloat(parseFloat(item.op_blc_gwt) + parseFloat(item.inw_gwt) - parseFloat(item.sales_gwt) - parseFloat(item.br_out_gwt) - parseFloat(item.pur_ret_gwt) - parseFloat(item.kar_iss_gwt)).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(parseFloat(item.op_blc_nwt) + parseFloat(item.inw_nwt) - parseFloat(item.sales_nwt) - parseFloat(item.br_out_nwt) - parseFloat(item.pur_ret_nwt) - parseFloat(item.kar_iss_nwt)).toFixed(3))) + '</td>' +

						'<td>0.000</td>' +

						'<td>0.000</td>' +

						'<td>0.000</td>' +

						'</tr>';

				});

				trHTML += '<tr  style="font-weight:bold;color:red;">' +

					'<td>SUB TOTAL</td>' +

					'<td>' + (money_format_india(parseFloat(inw_gwt_nontag).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(inw_nwt_nontag).toFixed(3))) + '</td>' +

					'<td>0.000</td>' +

					'<td>0.000</td>' +

					'<td>0.000</td>' +

					'<td>SUB TOTAL</td>' +

					'<td>' + (money_format_india(parseFloat(closing_gwt_nontag).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(closing_nwt_nontag).toFixed(3))) + '</td>' +

					'<td>0.000</td>' +

					'<td>0.000</td>' +

					'<td>0.000</td>' +

					'</tr>';

			}

			var inw_sr_gwt = 0;

			var inw_sr_nwt = 0;

			var inw_sr_diawt = 0;

			var inw_sr_grm_wt = 0;

			var inw_sr_ct_wt = 0;

			var closing_sr_gwt = 0;

			var closing_sr_nwt = 0;

			var closing_sr_diawt = 0;

			var closing_sr_grm_wt = 0;

			var closing_sr_ct_wt = 0;

			if (sales_return_stock.length > 0) {

				$.each(sales_return_stock, function (key, item) {

					inw_sr_gwt += parseFloat(item.inw_gwt);

					inw_sr_nwt += parseFloat(item.inw_nwt);

					inw_sr_diawt += parseFloat(item.inw_diawt);

					inw_sr_grm_wt += parseFloat(item.inw_grm_wt);

					inw_sr_ct_wt += parseFloat(item.inw_ct_wt);

					closing_sr_gwt += parseFloat(parseFloat(item.op_blc_gwt) + parseFloat(item.inw_gwt) - parseFloat(item.out_gwt));

					closing_sr_nwt += parseFloat(parseFloat(item.op_blc_nwt) + parseFloat(item.inw_nwt) - parseFloat(item.out_netwt));

					closing_sr_diawt += parseFloat(parseFloat(item.op_blc_diawt) + parseFloat(item.inw_diawt) - parseFloat(item.out_diawt));

					closing_sr_grm_wt += parseFloat(parseFloat(item.op_blc_grm_wt) + parseFloat(item.inw_grm_wt) - parseFloat(item.out_grm_wt));

					closing_sr_ct_wt += parseFloat(parseFloat(item.op_blc_ct_wt) + parseFloat(item.inw_ct_wt) - parseFloat(item.out_ct_wt));

					trHTML += '<tr >' +

						'<td>' + (item.cat_type == 1 ? 'INWARD SALES RETURN ORANMENT STOCK' : (item.cat_type == 2 ? 'INWARD SALES RETURN PURE STOCK' : 'INWARD SALES RETURN LOOSE PRODUCT STOCK')) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.inw_gwt).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.inw_nwt).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.inw_diawt).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.inw_grm_wt).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.inw_ct_wt).toFixed(3))) + '</td>' +

						'<td>' + (item.cat_type == 1 ? 'CLOSING SALES RETURN STOCK' : (item.cat_type == 2 ? 'CLOSING SALES RETURN PURE STOCK' : 'CLOSING SALES RETURN LOOSE PRODUCT STOCK')) + '</td>' +

						'<td>' + (money_format_india(parseFloat(parseFloat(item.op_blc_gwt) + parseFloat(item.inw_gwt) - parseFloat(item.out_gwt)).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(parseFloat(item.op_blc_nwt) + parseFloat(item.inw_nwt) - parseFloat(item.out_netwt)).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(parseFloat(item.op_blc_diawt) + parseFloat(item.inw_diawt) - parseFloat(item.out_diawt)).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(parseFloat(item.op_blc_grm_wt) + parseFloat(item.inw_grm_wt) - parseFloat(item.out_grm_wt)).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(parseFloat(item.op_blc_ct_wt) + parseFloat(item.inw_ct_wt) - parseFloat(item.out_ct_wt)).toFixed(3))) + '</td>' +

						'</tr>';

				});

				trHTML += '<tr  style="font-weight:bold;color:red;">' +

					'<td>SUB TOTAL</td>' +

					'<td>' + (money_format_india(parseFloat(inw_sr_gwt).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(inw_sr_nwt).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(inw_sr_diawt).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(inw_sr_grm_wt).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(inw_sr_ct_wt).toFixed(3))) + '</td>' +

					'<td>SUB TOTAL</td>' +

					'<td>' + (money_format_india(parseFloat(closing_sr_gwt).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(closing_sr_nwt).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(closing_sr_diawt).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(closing_sr_grm_wt).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(closing_sr_ct_wt).toFixed(3))) + '</td>' +

					'</tr>';

			}

			var inw_ps_gwt = 0;

			var inw_ps_nwt = 0;

			var inw_ps_diawt = 0;

			var inw_ps_grm_wt = 0;

			var inw_ps_ct_wt = 0;

			var closing_ps_gwt = 0;

			var closing_ps_nwt = 0;

			var closing_ps_diawt = 0;

			var closing_ps_grm_wt = 0;

			var closing_ps_ct_wt = 0;

			if (partly_sales_stock.length > 0) {

				$.each(partly_sales_stock, function (key, item) {

					inw_ps_gwt += parseFloat(item.inw_gwt);

					inw_ps_nwt += parseFloat(item.inw_nwt);

					inw_ps_diawt += parseFloat(item.inw_diawt);

					inw_ps_grm_wt += parseFloat(item.inw_grm_wt);

					inw_ps_ct_wt += parseFloat(item.inw_ct_wt);

					closing_ps_gwt += parseFloat(parseFloat(item.op_blc_gwt) + parseFloat(item.inw_gwt) - parseFloat(item.out_gwt));

					closing_ps_nwt += parseFloat(parseFloat(item.op_blc_nwt) + parseFloat(item.inw_nwt) - parseFloat(item.out_netwt));

					closing_ps_diawt += parseFloat(parseFloat(item.op_blc_diawt) + parseFloat(item.inw_diawt) - parseFloat(item.out_diawt));

					closing_ps_grm_wt += parseFloat(parseFloat(item.op_blc_grm_wt) + parseFloat(item.inw_grm_wt) - parseFloat(item.out_diawt));

					closing_ps_ct_wt += parseFloat(parseFloat(item.op_blc_ct_wt) + parseFloat(item.inw_ct_wt) - parseFloat(item.out_ct_wt));

					trHTML += '<tr >' +

						'<td>' + (item.cat_type == 1 ? 'INWARD PARTLY SALES ORANMENT STOCK' : (item.cat_type == 2 ? 'INWARD PARTLY SALES PURE STOCK' : 'INWARD PARTLY SALES LOOSE PRODUCT STOCK')) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.inw_gwt).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.inw_nwt).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.inw_diawt).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.inw_grm_wt).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.inw_ct_wt).toFixed(3))) + '</td>' +

						'<td>' + (item.cat_type == 1 ? 'CLOSING PARTLY SALES STOCK' : (item.cat_type == 2 ? 'CLOSING PARTLY SALES PURE STOCK' : 'CLOSING PARTLY SALES LOOSE PRODUCT STOCK')) + '</td>' +

						'<td>' + (money_format_india(parseFloat(parseFloat(item.op_blc_gwt) + parseFloat(item.inw_gwt) - parseFloat(item.out_gwt)).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(parseFloat(item.op_blc_nwt) + parseFloat(item.inw_nwt) - parseFloat(item.out_netwt)).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(parseFloat(item.op_blc_diawt) + parseFloat(item.inw_diawt) - parseFloat(item.out_diawt)).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(parseFloat(item.op_blc_grm_wt) + parseFloat(item.inw_grm_wt) - parseFloat(item.out_grm_wt)).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(parseFloat(item.op_blc_ct_wt) + parseFloat(item.inw_ct_wt) - parseFloat(item.out_ct_wt)).toFixed(3))) + '</td>' +

						'</tr>';

				});

				trHTML += '<tr  style="font-weight:bold;color:red;">' +

					'<td>SUB TOTAL</td>' +

					'<td>' + (money_format_india(parseFloat(inw_ps_gwt).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(inw_ps_nwt).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(inw_ps_diawt).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(inw_ps_grm_wt).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(inw_ps_ct_wt).toFixed(3))) + '</td>' +

					'<td>SUB TOTAL</td>' +

					'<td>' + (money_format_india(parseFloat(closing_ps_gwt).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(closing_ps_nwt).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(closing_ps_diawt).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(closing_ps_grm_wt).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(closing_ps_ct_wt).toFixed(3))) + '</td>' +

					'</tr>';

			}

			var inw_oldmt_gwt = 0;

			var inw_oldmt_nwt = 0;

			var inw_oldmt_diawt = 0;

			var closing_oldmt_gwt = 0;

			var closing_oldmt_nwt = 0;

			var closing_oldmt_diawt = 0;

			if (oldMetal_stock.length > 0) {

				$.each(oldMetal_stock, function (key, item) {

					inw_oldmt_gwt += parseFloat(item.inw_gwt);

					inw_oldmt_nwt += parseFloat(item.inw_nwt);

					inw_oldmt_diawt += parseFloat(item.inw_diawt);

					closing_oldmt_gwt += parseFloat(parseFloat(item.op_blc_gwt) + parseFloat(item.inw_gwt) - parseFloat(item.out_gwt));

					closing_oldmt_nwt += parseFloat(parseFloat(item.op_blc_nwt) + parseFloat(item.inw_nwt) - parseFloat(item.out_netwt));

					closing_oldmt_diawt += parseFloat(parseFloat(item.op_blc_diawt) + parseFloat(item.inw_diawt) - parseFloat(item.out_diawt));

					trHTML += '<tr >' +

						'<td>' + ('INWARD ' + item.category_name + ' STOCK') + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.inw_gwt).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.inw_nwt).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(item.inw_diawt).toFixed(3))) + '</td>' +

						'<td>0.000</td>' +

						'<td>0.000</td>' +

						'<td>' + ('CLOSING ' + item.category_name + ' STOCK') + '</td>' +

						'<td>' + (money_format_india(parseFloat(parseFloat(item.op_blc_gwt) + parseFloat(item.inw_gwt) - parseFloat(item.out_gwt)).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(parseFloat(item.op_blc_nwt) + parseFloat(item.inw_nwt) - parseFloat(item.out_netwt)).toFixed(3))) + '</td>' +

						'<td>' + (money_format_india(parseFloat(parseFloat(item.op_blc_diawt) + parseFloat(item.inw_diawt) - parseFloat(item.out_diawt)).toFixed(3))) + '</td>' +

						'<td>0.000</td>' +

						'<td>0.000</td>' +

						'</tr>';

				});

				trHTML += '<tr  style="font-weight:bold;color:red;">' +

					'<td>SUB TOTAL</td>' +

					'<td>' + (money_format_india(parseFloat(inw_oldmt_gwt).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(inw_oldmt_nwt).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(inw_oldmt_diawt).toFixed(3))) + '</td>' +

					'<td>0.000</td>' +

					'<td>0.000</td>' +

					'<td>SUB TOTAL</td>' +

					'<td>' + (money_format_india(parseFloat(closing_oldmt_gwt).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(closing_oldmt_nwt).toFixed(3))) + '</td>' +

					'<td>' + (money_format_india(parseFloat(closing_oldmt_diawt).toFixed(3))) + '</td>' +

					'<td>0.000</td>' +

					'<td>0.000</td>' +

					'</tr>';

			}

			inw_tot_grswt += parseFloat(parseFloat(inw_gwt_tag) + parseFloat(inw_gwt_nontag) + parseFloat(inw_sr_gwt) + parseFloat(inw_ps_gwt) + parseFloat(inw_oldmt_gwt));

			inw_tot_nwt += parseFloat(parseFloat(inw_nwt_tag) + parseFloat(inw_nwt_nontag) + parseFloat(inw_sr_nwt) + parseFloat(inw_ps_nwt) + parseFloat(inw_oldmt_nwt));

			inw_tot_diawt += parseFloat(parseFloat(inw_diawt_tag) + parseFloat(inw_sr_diawt) + parseFloat(inw_ps_diawt) + parseFloat(inw_oldmt_diawt));

			inw_tot_grmwt += parseFloat(parseFloat(inw_grm_wt_tag) + parseFloat(inw_sr_grm_wt) + parseFloat(inw_ps_grm_wt));

			inw_tot_ctwt += parseFloat(parseFloat(inw_ct_wt_tag) + parseFloat(inw_sr_ct_wt) + parseFloat(inw_ps_ct_wt));

			closing_tot_grswt += parseFloat(parseFloat(closing_gwt_tag) + parseFloat(closing_gwt_nontag) + parseFloat(closing_sr_gwt) + parseFloat(closing_ps_gwt) + parseFloat(closing_oldmt_gwt));

			closing_tot_nwt += parseFloat(parseFloat(closing_nwt_tag) + parseFloat(closing_nwt_nontag) + parseFloat(closing_sr_nwt) + parseFloat(closing_ps_nwt) + parseFloat(closing_oldmt_nwt));

			closing_tot_diawt += parseFloat(parseFloat(closing_diawt_tag) + parseFloat(closing_sr_diawt) + parseFloat(closing_ps_diawt) + parseFloat(closing_oldmt_diawt));

			closing_tot_grmwt += parseFloat(parseFloat(closing_grm_wt_tag) + parseFloat(closing_sr_grm_wt) + parseFloat(closing_ps_grm_wt));

			closing_tot_ctwt += parseFloat(parseFloat(closing_ct_wt_tag) + parseFloat(closing_sr_ct_wt) + parseFloat(closing_ps_ct_wt));

			trHTML += '<tr  style="font-weight:bold;color:blue;">' +

				'<td><strong>GRAND TOTAL</strong></td>' +

				'<td><strong>' + (money_format_india(parseFloat(inw_tot_grswt).toFixed(3))) + '</strong></td>' +

				'<td><strong>' + (money_format_india(parseFloat(inw_tot_nwt).toFixed(3))) + '</strong></td>' +

				'<td><strong>' + (money_format_india(parseFloat(inw_tot_diawt).toFixed(3))) + '</strong></td>' +

				'<td><strong>' + (money_format_india(parseFloat(inw_tot_grmwt).toFixed(3))) + '</strong></td>' +

				'<td><strong>' + (money_format_india(parseFloat(inw_tot_ctwt).toFixed(3))) + '</strong></td>' +

				'<td><strong>GRAND TOTAL</strong></td>' +

				'<td><strong>' + (money_format_india(parseFloat(closing_tot_grswt).toFixed(3))) + '</strong></td>' +

				'<td><strong>' + (money_format_india(parseFloat(closing_tot_nwt).toFixed(3))) + '</strong></td>' +

				'<td><strong>' + (money_format_india(parseFloat(closing_tot_diawt).toFixed(3))) + '</strong></td>' +

				'<td><strong>' + (money_format_india(parseFloat(closing_tot_grmwt).toFixed(3))) + '</strong></td>' +

				'<td><strong>' + (money_format_india(parseFloat(closing_tot_ctwt).toFixed(3))) + '</strong></td>' +

				'</tr>';

			// Receipt & Closing //

			$('#branch_vault_report > tbody').html(trHTML);

			if (!$.fn.DataTable.isDataTable('#branch_vault_report')) {

				oTable = $('#branch_vault_report').dataTable({

					"bSort": false,

					"bDestroy": true,

					"bInfo": true,

					"scrollX": '100%',

					"paging": false,

					"dom": 'Bfrtip',

					"bAutoWidth": false,

					"responsive": true,

					"fixedHeader": true,

					"lengthMenu": [[-1, 25, 50, 100, 250], ["All", 25, 50, 100, 250]],

					"columnDefs": [

						{

							targets: [1, 2, 3, 4, 5, 7, 8, 9, 10, 11],

							className: 'dt-body-right'

						},

						{

							targets: [0, 6],

							className: 'dt-body-left'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact');

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', '10px')

									.css('font-family', 'sans-serif');

							},

							exportOptions: {

								columns: ':visible',

								stripHtml: false

							}

						},

						{

							extend: 'excel',

							footer: true,

							title: 'Branch Vault Report',

						}

					],

				});

			}

		},

		error: function (error) {

			console.log('Error Occured');

		}

	});

}

/*Branch Vault Report*/

/*Detailed Day Transaction Report*/

$('#detailed_day_trans_search').on('click', function () {

	get_Detailed_Daytransaction_report();

})

function get_Detailed_Daytransaction_report() {

	var dt_range = ($("#dt_range").val()).split('-');

	var company_name = $('#company_name').val();

	var from_date = dt_range[0];

	var to_date = dt_range[1];

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "Detailed Day Transaction Report";

	var metal = $('#metal option:selected').html() != '' && $('#metal option:selected').html() != undefined ? $('#metal option:selected').html() + ' - ' : '';

	var category = $('#category option:selected').html() != '' && $('#category option:selected').html() != undefined ? $('#category option:selected').html() + ' - ' : '';

	var prod_select = $('#prod_select option:selected').html() != '' && $('#prod_select option:selected').html() != undefined ? $('#prod_select option:selected').html() + ' - ' : '';

	var optional = metal + category + prod_select;

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		type: 'POST',

		url: base_url + "index.php/admin_ret_reports/detailed_day_transaction_report/ajax",

		dataType: 'JSON',

		data: { 'dt_range': $("#dt_range").val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'id_product': $('#prod_select').val(), 'id_category': $('#category').val(), 'id_metal': $('#metal').val(), 'id_section': $('#section_select').val(), 'report_type': $('#det_sales_report_type').val(), 'bill_type': $('#bill_type').val() },

		success: function (data) {

			$("div.overlay").css("display", "none");

			$("#detailed_day_transactiton_list > tbody > tr").remove();

			$('#detailed_day_transactiton_list').dataTable().fnClearTable();

			$('#detailed_day_transactiton_list').dataTable().fnDestroy();

			var trHTML = '';

			var sales_details = data.list.sales_details;

			var purchase_details = data.list.old_matel_details;

			var sales_return_details = data.list.return_details;

			var order_advance_details = data.list.order_advance_details;

			var credit_collection_details = data.list.credit_details;

			var advance_receipt_details = data.list.advance_receipt_details;

			var payment_issue_details = data.list.payment_issue_details;

			var repair_order_details = data.list.repair_order_details;

			var purchase_plan_details = data.list.purchase_plan_details;

			// Sales Total

			var tot_sales_pcs = 0;

			var tot_sales_gwt = 0;

			var tot_sales_nwt = 0;

			var tot_sales_lwt = 0;

			var tot_sales_dwt = 0;

			var tot_taxable_amt = 0;

			var tot_sales_sgst = 0;

			var tot_sales_cgst = 0;

			var tot_sales_igst = 0;

			var tot_sales_gst = 0;

			var tot_sales_amount = 0;

			// Sales Total

			// Purchase Total

			var tot_pur_pcs = 0;

			var tot_pur_gwt = 0;

			var tot_pur_lwt = 0;

			var tot_pur_nwt = 0;

			var tot_pur_diawt = 0;

			var tot_pur_amount = 0;

			// Purchase Total

			// Sales return Total

			var tot_sret_pcs = 0;

			var tot_sret_gwt = 0;

			var tot_sret_lwt = 0;

			var tot_sret_nwt = 0;

			var tot_sret_diawt = 0;

			var tot_sret_taxable_amt = 0;

			var tot_sret_sgst = 0;

			var tot_sret_cgst = 0;

			var tot_sret_igst = 0;

			var tot_sret_gst = 0;

			var tot_sret_amount = 0;

			// Sales return Total

			// Order Advance Total

			var tot_ord_taxable_amt = 0;

			var tot_ord_amount = 0;

			// Order Avance Total

			//Credit Collection Total

			var tot_cred_taxable_amt = 0;

			var tot_cred_amount = 0;

			//Credit Collection Total

			// Advance Receipt Total

			var tot_adv_taxable_amt = 0;

			var tot_adv_amount = 0;

			// Advance Receipt Total

			// Payment Issue Total

			var tot_issue_taxable_amt = 0;

			var tot_issue_amount = 0;

			// Payment Issue Total

			// Repair Order Total

			var tot_rep_pcs = 0;

			var tot_rep_gwt = 0;

			var tot_rep_taxable_amt = 0;

			var tot_rep_amount = 0;

			// Repair Order Total

			// Purchase Plan Total

			var tot_pp_taxable_amt = 0;

			var tot_pp_amt = 0;

			// Purchase Plan Total

			if (sales_details.length > 0) {

				trHTML += '<tr style="font-weight:bold;color:red;">' +

					'<td><strong>Sales Details</strong></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'</tr>';

				$.each(sales_details, function (key, item) {

					var cash_payment = 0;

					var card_payment = 0;

					var cheque_payment = 0;

					var upi_scanner_payment = 0;

					var upi_transfer_payment = 0;

					var rtgs_payment = 0;

					var imps_payment = 0;

					var neft_payment = 0;

					var advance_adj_amt = item.adv_adj_amt.adj_amt;

					if ((item.sales_payment_details.length > 0) && item.SerialNumber == 1) // For first row of same bill id's

					{

						$.each(item.sales_payment_details, function (key, items) {

							if (items.payment_mode == 'Cash') {

								cash_payment += parseFloat(items.payment_amount);

							}

							if (items.payment_mode == 'CC' || items.payment_mode == 'DC') {

								card_payment += parseFloat(items.payment_amount);

							}

							if (items.payment_mode == 'CHQ') {

								cheque_payment += parseFloat(items.payment_amount);

							}

							if (items.payment_mode == 'NB') {

								if (items.nb_type == 1) {

									rtgs_payment += parseFloat(items.payment_amount);

								}

								if (items.nb_type == 2) {

									imps_payment += parseFloat(items.payment_amount);

								}

								if (items.nb_type == 3) {

									upi_transfer_payment += parseFloat(items.payment_amount);

								} if (items.nb_type == 4) {

									neft_payment += parseFloat(items.payment_amount);

								}

								if (items.nb_type == 5) {

									upi_scanner_payment += parseFloat(items.payment_amount);

								}

							}

						})

					}

					tot_sales_pcs += parseFloat(item.tot_pcs);

					tot_sales_gwt += parseFloat(item.gross_wt);

					tot_sales_nwt += parseFloat(item.net_wt);

					tot_sales_lwt += parseFloat(item.less_wt);

					tot_sales_dwt += parseFloat(item.dia_wt);

					tot_taxable_amt += parseFloat(item.amt_without_tax);

					tot_sales_sgst += parseFloat(item.total_sgst);

					tot_sales_cgst += parseFloat(item.total_cgst);

					tot_sales_igst += parseFloat(item.total_igst);

					tot_sales_gst += parseFloat(item.item_total_tax);

					tot_sales_amount += parseFloat(item.total_cost);

					var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + item.bill_id;

					trHTML += '<tr class="' + item.bill_id + '">' +

						'<td>' + (key + 1) + '</td>' +

						'<td>' + item.branch + '</td>' +

						'<td><a href=' + url + ' target="_blank">' + item.bill_no + '</a></td>' +

						'<td>' + item.bill_date + '</td>' +

						'<td>' + item.bill_type + '</td>' +

						'<td>' + item.emp_name + '</td>' +

						'<td>' + item.counter + '</td>' +

						'<td>' + item.purity + '</td>' +

						'<td>' + item.product_name + '</td>' +

						'<td>' + parseInt(item.tot_pcs) + '</td>' +

						'<td>' + money_format_india(parseFloat(item.gross_wt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(item.less_wt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(item.net_wt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(item.dia_wt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(item.amt_without_tax).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(item.total_sgst).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(item.total_cgst).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(item.total_igst).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(item.item_total_tax).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(item.total_cost).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(cash_payment).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(card_payment).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(cheque_payment).toFixed(2)) + '</td>' +

						'<td>' + (item.SerialNumber == 1 ? money_format_india(parseFloat(advance_adj_amt).toFixed(2)) : 0) + ' </td>' +

						'<td>' + money_format_india(parseFloat(upi_scanner_payment).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(upi_transfer_payment).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(rtgs_payment).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(imps_payment).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(neft_payment).toFixed(2)) + '</td>' +

						'<td>' + (item.SerialNumber == 1 ? money_format_india(parseFloat(item.old_metal_amount).toFixed(2)) : 0) + '</td>' +

						'<td>' + (item.SerialNumber == 1 ? money_format_india(parseFloat(item.tot_ret_amt).toFixed(2)) : 0) + '</td>' +

						'<td>' + (item.SerialNumber == 1 ? money_format_india(parseFloat(item.utilized_amt).toFixed(2)) : 0) + '</td>' +

						'<td>' + (item.SerialNumber == 1 ? money_format_india(parseFloat(item.gift_voucher_amt).toFixed(2)) : 0) + '</td>' +

						'<td>' + item.cus_name + '</td>' +

						'<td>' + item.mobile + '</td>' +

						'<td>' + item.pan_number + '</td>' +

						'<td>' + item.gst_number + '</td>' +

						'</tr>';

				})

				trHTML += '<tr style="font-weight:bold;color:red;">' +

					'<td><strong>Sales Grand Total</strong></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td><strong>' + parseInt(tot_sales_pcs) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_sales_gwt).toFixed(3)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_sales_nwt).toFixed(3)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_sales_lwt).toFixed(3)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_sales_dwt).toFixed(3)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_taxable_amt).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_sales_sgst).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_sales_cgst).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_sales_igst).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_sales_gst).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_sales_amount).toFixed(2)) + '</strong></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'</tr>';

			}

			if (purchase_details.length > 0) {

				trHTML += '<tr style="font-weight:bold;color:red;">' +

					'<td><strong>Purchase Details</strong></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'</tr>';

				$.each(purchase_details, function (key, item) {

					tot_pur_pcs += parseFloat(item.pcs);

					tot_pur_gwt += parseFloat(item.gross_wt);

					tot_pur_lwt += parseFloat(parseFloat(item.dust_wt) + parseFloat(item.stone_wt));

					tot_pur_nwt += parseFloat(item.net_wt);

					tot_pur_diawt += parseFloat(item.dia_wt);

					tot_pur_amount += parseFloat(item.amount);

					var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + item.bill_id;

					trHTML += '<tr class="' + item.bill_id + '">' +

						'<td>' + (key + 1) + '</td>' +

						'<td>' + item.branch + '</td>' +

						'<td><a href=' + url + ' target="_blank">' + item.bill_no + '</a></td>' +

						'<td>' + item.bill_date + '</td>' +

						'<td>' + item.bill_type + '</td>' +

						'<td>' + item.emp_name + '</td>' +

						'<td>' + item.counter + '</td>' +

						'<td>' + item.purity + '</td>' +

						'<td></td>' +

						'<td>' + parseInt(item.pcs) + '</td>' +

						'<td>' + money_format_india(parseFloat(item.gross_wt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(parseFloat(item.dust_wt) + parseFloat(item.stone_wt)).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(item.net_wt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(item.dia_wt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(item.amount).toFixed(2)) + '</td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td>' + money_format_india(parseFloat(item.amount).toFixed(2)) + '</td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td>' + item.cus_name + '</td>' +

						'<td>' + item.mobile + '</td>' +

						'<td>' + item.pan_number + '</td>' +

						'<td>' + item.gst_number + '</td>' +

						'</tr>';

				})

				trHTML += '<tr style="font-weight:bold;color:red;">' +

					'<td><strong>Purchase Grand Total</stromg></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td><strong>' + parseInt(tot_pur_pcs) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_pur_gwt).toFixed(3)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_pur_lwt).toFixed(3)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_pur_nwt).toFixed(3)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_pur_diawt).toFixed(3)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_pur_amount).toFixed(2)) + '</strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_pur_amount).toFixed(2)) + '</strong></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'</tr>';

			}

			if (sales_return_details.length > 0) {

				trHTML += '<tr style="font-weight:bold;color:red;">' +

					'<td><strong>Sales Return Details</strong></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'</tr>';

				$.each(sales_return_details, function (key, item) {

					tot_sret_pcs += parseFloat(item.piece);

					tot_sret_gwt += parseFloat(item.gross_wt);

					tot_sret_lwt += parseFloat(item.less_wt);

					tot_sret_nwt += parseFloat(item.net_wt);

					tot_sret_diawt += parseFloat(item.dia_wt);

					tot_sret_taxable_amt += parseFloat(item.amt_without_tax);

					tot_sret_sgst += parseFloat(item.total_sgst);

					tot_sret_cgst += parseFloat(item.total_cgst);

					tot_sret_igst += parseFloat(item.total_igst);

					tot_sret_gst += parseFloat(item.item_total_tax);

					tot_sret_amount += parseFloat(item.total_cost);

					var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + item.bill_id;

					trHTML += '<tr  class="' + item.bill_id + '">' +

						'<td>' + (key + 1) + '</td>' +

						'<td>' + item.branch + '</td>' +

						'<td><a href=' + url + ' target="_blank">' + item.bill_no + '</a></td>' +

						'<td>' + item.bill_date + '</td>' +

						'<td>' + item.bill_type + '</td>' +

						'<td>' + item.emp_name + '</td>' +

						'<td>' + item.counter + '</td>' +

						'<td>' + item.purity + '</td>' +

						'<td>' + item.product_name + '</td>' +

						'<td>' + parseInt(item.piece) + '</td>' +

						'<td>' + money_format_india(parseFloat(item.gross_wt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(item.less_wt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(item.net_wt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(item.dia_wt).toFixed(3)) + '</td>' +

						'<td>' + money_format_india(parseFloat(item.amt_without_tax).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(item.total_sgst).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(item.total_cgst).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(item.total_igst).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(item.item_total_tax).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(item.total_cost).toFixed(2)) + '</td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td>' + item.cus_name + '</td>' +

						'<td>' + item.mobile + '</td>' +

						'<td>' + item.pan_number + '</td>' +

						'<td>' + item.gst_number + '</td>' +

						'</tr>';

				});

				trHTML += '<tr style="font-weight:bold;color:red;">' +

					'<td><strong>Sales Return Grand Total</stromg></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td><strong>' + parseInt(tot_sret_pcs) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_sret_gwt).toFixed(3)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_sret_lwt).toFixed(3)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_sret_nwt).toFixed(3)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_sret_diawt).toFixed(3)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_sret_taxable_amt).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_sret_sgst).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_sret_cgst).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_sret_igst).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_sret_gst).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_sret_amount).toFixed(2)) + '</strong></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'</tr>';

			}

			if (order_advance_details.length > 0) {

				trHTML += '<tr style="font-weight:bold;color:red;">' +

					'<td><strong>Order Advance Details</strong></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'</tr>';

				$.each(order_advance_details, function (key, item) {

					var cash_payment = 0;

					var card_payment = 0;

					var cheque_payment = 0;

					var upi_scanner_payment = 0;

					var upi_transfer_payment = 0;

					var rtgs_payment = 0;

					var imps_payment = 0;

					var neft_payment = 0;

					if (item.payment_details.length > 0) {

						$.each(item.payment_details, function (key, items) {

							if (items.payment_mode == 'Cash') {

								cash_payment += parseFloat(items.payment_amount);

							}

							if (items.payment_mode == 'CC' || items.payment_mode == 'DC') {

								card_payment += parseFloat(items.payment_amount);

							}

							if (items.payment_mode == 'CHQ') {

								cheque_payment += parseFloat(items.payment_amount);

							}

							if (items.payment_mode == 'NB') {

								if (items.nb_type == 1) {

									rtgs_payment += parseFloat(items.payment_amount);

								}

								if (items.nb_type == 2) {

									imps_payment += parseFloat(items.payment_amount);

								}

								if (items.nb_type == 3) {

									upi_transfer_payment += parseFloat(items.payment_amount);

								} if (items.nb_type == 4) {

									neft_payment += parseFloat(items.payment_amount);

								}

								if (items.nb_type == 5) {

									upi_scanner_payment += parseFloat(items.payment_amount);

								}

							}

						})

					}

					tot_ord_taxable_amt += parseFloat(parseFloat(item.tot_amt_received) + parseFloat(item.old_metal_amount));

					tot_ord_amount += parseFloat(parseFloat(item.tot_amt_received) + parseFloat(item.old_metal_amount));

					var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + item.bill_id;

					trHTML += '<tr class="' + item.bill_id + '">' +

						'<td>' + (key + 1) + '</td>' +

						'<td>' + item.branch + '</td>' +

						'<td><a href=' + url + ' target="_blank">' + item.bill_no + '</a></td>' +

						'<td>' + item.bill_date + '</td>' +

						'<td>' + item.bill_type + '</td>' +

						'<td>' + item.emp_name + '</td>' +

						'<td>' + item.counter + '</td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td>' + money_format_india(parseFloat(parseFloat(item.tot_amt_received) + parseFloat(item.old_metal_amount)).toFixed(2)) + '</td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td>' + money_format_india(parseFloat(parseFloat(item.tot_amt_received) + parseFloat(item.old_metal_amount)).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(cash_payment).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(card_payment).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(cheque_payment).toFixed(2)) + '</td>' +

						'<td></td>' +

						'<td>' + money_format_india(parseFloat(upi_scanner_payment).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(upi_transfer_payment).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(rtgs_payment).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(imps_payment).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(neft_payment).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(item.old_metal_amount).toFixed(2)) + '</td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td>' + item.cus_name + '</td>' +

						'<td>' + item.mobile + '</td>' +

						'<td>' + item.pan_number + '</td>' +

						'<td>' + item.gst_number + '</td>' +

						'</tr>';

				});

				trHTML += '<tr style="font-weight:bold;color:red;">' +

					'<td><strong>Order Advance Grand Total</stromg></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_ord_taxable_amt).toFixed(2)) + '</strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_ord_amount).toFixed(2)) + '</strong></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'</tr>';

			}

			if (credit_collection_details.length > 0) {

				trHTML += '<tr style="font-weight:bold;color:red;">' +

					'<td><strong>Credit Collection Details</strong></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'</tr>';

				$.each(credit_collection_details, function (key, item) {

					var cash_payment = 0;

					var card_payment = 0;

					var cheque_payment = 0;

					var upi_scanner_payment = 0;

					var upi_transfer_payment = 0;

					var rtgs_payment = 0;

					var imps_payment = 0;

					var neft_payment = 0;

					if (item.payment_details.length > 0) {

						$.each(item.payment_details, function (key, items) {

							if (items.payment_mode == 'Cash') {

								cash_payment += parseFloat(items.payment_amount);

							}

							if (items.payment_mode == 'CC' || items.payment_mode == 'DC') {

								card_payment += parseFloat(items.payment_amount);

							}

							if (items.payment_mode == 'CHQ') {

								cheque_payment += parseFloat(items.payment_amount);

							}

							if (items.payment_mode == 'NB') {

								if (items.nb_type == 1) {

									rtgs_payment += parseFloat(items.payment_amount);

								}

								if (items.nb_type == 2) {

									imps_payment += parseFloat(items.payment_amount);

								}

								if (items.nb_type == 3) {

									upi_transfer_payment += parseFloat(items.payment_amount);

								} if (items.nb_type == 4) {

									neft_payment += parseFloat(items.payment_amount);

								}

								if (items.nb_type == 5) {

									upi_scanner_payment += parseFloat(items.payment_amount);

								}

							}

						})

					}

					tot_cred_taxable_amt += parseFloat(item.amount);

					tot_cred_amount += parseFloat(item.amount);

					if (item.type == 1) {

						var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + item.bill_id;

					}

					else {

						var url = base_url + 'index.php/admin_ret_billing/receipt/receipt_print/' + item.bill_id;

					}

					trHTML += '<tr>' +

						'<td>' + (key + 1) + '</td>' +

						'<td>' + item.branch + '</td>' +

						'<td><a href=' + url + ' target="_blank">' + item.bill_no + '</a></td>' +

						'<td>' + item.bill_date + '</td>' +

						'<td>' + item.bill_type + '</td>' +

						'<td>' + item.emp_name + '</td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td>' + money_format_india(parseFloat(item.amount).toFixed(2)) + '</td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td>' + money_format_india(parseFloat(item.amount).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(cash_payment).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(card_payment).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(cheque_payment).toFixed(2)) + '</td>' +

						'<td></td>' +

						'<td>' + money_format_india(parseFloat(upi_scanner_payment).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(upi_transfer_payment).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(rtgs_payment).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(imps_payment).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(neft_payment).toFixed(2)) + '</td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td>' + item.cus_name + '</td>' +

						'<td>' + item.mobile + '</td>' +

						'<td>' + item.pan_number + '</td>' +

						'<td>' + item.gst_number + '</td>' +

						'</tr>';

				})

				trHTML += '<tr style="font-weight:bold;color:red;">' +

					'<td><strong>Credit Grand Total</stromg></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_cred_taxable_amt).toFixed(2)) + '</strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_cred_amount).toFixed(2)) + '</strong></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'</tr>';

			}

			if (advance_receipt_details.length > 0) {

				trHTML += '<tr style="font-weight:bold;color:red;">' +

					'<td><strong>Advance Receipt Details</strong></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'</tr>';

				$.each(advance_receipt_details, function (key, item) {

					var cash_payment = 0;

					var card_payment = 0;

					var cheque_payment = 0;

					var upi_scanner_payment = 0;

					var upi_transfer_payment = 0;

					var rtgs_payment = 0;

					var imps_payment = 0;

					var neft_payment = 0;

					if (item.payment_details.length > 0) {

						$.each(item.payment_details, function (key, items) {

							if (items.payment_mode == 'Cash') {

								cash_payment += parseFloat(items.payment_amount);

							}

							if (items.payment_mode == 'CC' || items.payment_mode == 'DC') {

								card_payment += parseFloat(items.payment_amount);

							}

							if (items.payment_mode == 'CHQ') {

								cheque_payment += parseFloat(items.payment_amount);

							}

							if (items.payment_mode == 'NB') {

								if (items.nb_type == 1) {

									rtgs_payment += parseFloat(items.payment_amount);

								}

								if (items.nb_type == 2) {

									imps_payment += parseFloat(items.payment_amount);

								}

								if (items.nb_type == 3) {

									upi_transfer_payment += parseFloat(items.payment_amount);

								} if (items.nb_type == 4) {

									neft_payment += parseFloat(items.payment_amount);

								}

								if (items.nb_type == 5) {

									upi_scanner_payment += parseFloat(items.payment_amount);

								}

							}

						})

					}

					tot_adv_taxable_amt += parseFloat(item.amount);

					tot_adv_amount += parseFloat(item.amount);

					var url = base_url + 'index.php/admin_ret_billing/receipt/receipt_print/' + item.bill_id;

					trHTML += '<tr class="' + item.bill_id + '">' +

						'<td>' + (key + 1) + '</td>' +

						'<td>' + item.branch + '</td>' +

						'<td><a href=' + url + ' target="_blank">' + item.bill_no + '</a></td>' +

						'<td>' + item.bill_date + '</td>' +

						'<td>' + item.receipt_type + '</td>' +

						'<td>' + item.emp_name + '</td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td>' + money_format_india(parseFloat(item.amount).toFixed(2)) + '</td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td>' + money_format_india(parseFloat(item.amount).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(cash_payment).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(card_payment).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(cheque_payment).toFixed(2)) + '</td>' +

						'<td></td>' +

						'<td>' + money_format_india(parseFloat(upi_scanner_payment).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(upi_transfer_payment).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(rtgs_payment).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(imps_payment).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(neft_payment).toFixed(2)) + '</td>' +

						'<td>' + (item.deposit_type == 1 ? money_format_india(parseFloat(item.amount).toFixed(2)) : 0) + '</td>' +

						'<td>' + (item.deposit_type == 2 ? money_format_india(parseFloat(item.amount).toFixed(2)) : 0) + '</td>' +

						'<td>' + (item.deposit_type == 3 ? money_format_india(parseFloat(item.amount).toFixed(2)) : 0) + '</td>' +

						'<td></td>' +

						'<td>' + item.cus_name + '</td>' +

						'<td>' + item.mobile + '</td>' +

						'<td>' + item.pan_number + '</td>' +

						'<td>' + item.gst_number + '</td>' +

						'</tr>';

				})

				trHTML += '<tr style="font-weight:bold;color:red;">' +

					'<td><strong>Advance Receipt Grand Total</stromg></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_adv_taxable_amt).toFixed(2)) + '</strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_adv_amount).toFixed(2)) + '</strong></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'</tr>';

			}

			if (payment_issue_details.length > 0) {

				trHTML += '<tr style="font-weight:bold;color:red;">' +

					'<td><strong>Payment Issue Details</strong></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'</tr>';

				$.each(payment_issue_details, function (key, item) {

					var cash_payment = 0;

					var card_payment = 0;

					var cheque_payment = 0;

					var upi_scanner_payment = 0;

					var upi_transfer_payment = 0;

					var rtgs_payment = 0;

					var imps_payment = 0;

					var neft_payment = 0;

					if (item.payment_details.length > 0) {

						$.each(item.payment_details, function (key, items) {

							if (items.payment_mode == 'Cash') {

								cash_payment += parseFloat(items.payment_amount);

							}

							if (items.payment_mode == 'CC' || items.payment_mode == 'DC') {

								card_payment += parseFloat(items.payment_amount);

							}

							if (items.payment_mode == 'CHQ') {

								cheque_payment += parseFloat(items.payment_amount);

							}

							if (items.payment_mode == 'NB') {

								if (items.nb_type == 1) {

									rtgs_payment += parseFloat(items.payment_amount);

								}

								if (items.nb_type == 2) {

									imps_payment += parseFloat(items.payment_amount);

								}

								if (items.nb_type == 3) {

									upi_transfer_payment += parseFloat(items.payment_amount);

								} if (items.nb_type == 4) {

									neft_payment += parseFloat(items.payment_amount);

								}

								if (items.nb_type == 5) {

									upi_scanner_payment += parseFloat(items.payment_amount);

								}

							}

						})

					}

					tot_issue_taxable_amt += parseFloat(item.amount);

					tot_issue_amount += parseFloat(item.amount);

					var url = base_url + 'index.php/admin_ret_billing/issue/issue_print/' + item.bill_id;

					trHTML += '<tr class="' + item.bill_id + '">' +

						'<td>' + (key + 1) + '</td>' +

						'<td>' + item.branch + '</td>' +

						'<td><a href=' + url + ' target="_blank">' + item.bill_no + '</a></td>' +

						'<td>' + item.bill_date + '</td>' +

						'<td>' + item.bill_type + '</td>' +

						'<td>' + item.emp_name + '</td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td>' + money_format_india(parseFloat(item.amount).toFixed(2)) + '</td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td>' + money_format_india(parseFloat(item.amount).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(cash_payment).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(card_payment).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(cheque_payment).toFixed(2)) + '</td>' +

						'<td></td>' +

						'<td>' + money_format_india(parseFloat(upi_scanner_payment).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(upi_transfer_payment).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(rtgs_payment).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(imps_payment).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(neft_payment).toFixed(2)) + '</td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td>' + item.cus_name + '</td>' +

						'<td>' + item.mobile + '</td>' +

						'<td>' + item.pan_number + '</td>' +

						'<td>' + item.gst_number + '</td>' +

						'</tr>';

				})

				trHTML += '<tr style="font-weight:bold;color:red;">' +

					'<td><strong>Payment Issue Grand Total</stromg></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_issue_taxable_amt).toFixed(2)) + '</strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_issue_amount).toFixed(2)) + '</strong></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'</tr>';

			}

			if (repair_order_details.length > 0) {

				trHTML += '<tr style="font-weight:bold;color:red;">' +

					'<td><strong>Repair Order Details</strong></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'</tr>';

				$.each(repair_order_details, function (key, item) {

					var cash_payment = 0;

					var card_payment = 0;

					var cheque_payment = 0;

					var upi_scanner_payment = 0;

					var upi_transfer_payment = 0;

					var rtgs_payment = 0;

					var imps_payment = 0;

					var neft_payment = 0;

					if (item.payment_details.length > 0) {

						$.each(item.payment_details, function (key, items) {

							if (items.payment_mode == 'Cash') {

								cash_payment += parseFloat(items.payment_amount);

							}

							if (items.payment_mode == 'CC' || items.payment_mode == 'DC') {

								card_payment += parseFloat(items.payment_amount);

							}

							if (items.payment_mode == 'CHQ') {

								cheque_payment += parseFloat(items.payment_amount);

							}

							if (items.payment_mode == 'NB') {

								if (items.nb_type == 1) {

									rtgs_payment += parseFloat(items.payment_amount);

								}

								if (items.nb_type == 2) {

									imps_payment += parseFloat(items.payment_amount);

								}

								if (items.nb_type == 3) {

									upi_transfer_payment += parseFloat(items.payment_amount);

								} if (items.nb_type == 4) {

									neft_payment += parseFloat(items.payment_amount);

								}

								if (items.nb_type == 5) {

									upi_scanner_payment += parseFloat(items.payment_amount);

								}

							}

						})

					}

					tot_rep_pcs += parseFloat(item.pcs);

					tot_rep_gwt += parseFloat(item.weight);

					tot_rep_taxable_amt += parseFloat(item.amount);

					tot_rep_amount += parseFloat(item.amount);

					var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + item.bill_id;

					trHTML += '<tr class="' + item.bill_id + '">' +

						'<td>' + (key + 1) + '</td>' +

						'<td>' + item.branch + '</td>' +

						'<td><a href=' + url + ' target="_blank">' + item.bill_no + '</a></td>' +

						'<td>' + item.bill_date + '</td>' +

						'<td>' + item.bill_type + '</td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td>' + parseFloat(item.pcs) + '</td>' +

						'<td> ' + parseFloat(item.weight) + '</td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td>' + money_format_india(parseFloat(item.amount).toFixed(2)) + '</td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td>' + money_format_india(parseFloat(item.amount).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(cash_payment).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(card_payment).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(cheque_payment).toFixed(2)) + '</td>' +

						'<td></td>' +

						'<td>' + money_format_india(parseFloat(upi_scanner_payment).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(upi_transfer_payment).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(rtgs_payment).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(imps_payment).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(neft_payment).toFixed(2)) + '</td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td>' + item.cus_name + '</td>' +

						'<td>' + item.mobile + '</td>' +

						'<td>' + item.pan_number + '</td>' +

						'<td>' + item.gst_number + '</td>' +

						'</tr>';

				})

				trHTML += '<tr style="font-weight:bold;color:red;">' +

					'<td><strong>Repair Order Grand Total</stromg></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_rep_pcs)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_rep_gwt).toFixed(3)) + '</strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_rep_taxable_amt).toFixed(2)) + '</strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_rep_amount).toFixed(2)) + '</strong></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'</tr>';

			}

			if (purchase_plan_details.length > 0) {

				trHTML += '<tr style="font-weight:bold;color:red;">' +

					'<td><strong>Purchase Plan Details</strong></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'</tr>';

				$.each(purchase_plan_details, function (key, item) {

					var cash_payment = 0;

					var card_payment = 0;

					var cheque_payment = 0;

					var upi_scanner_payment = 0;

					var upi_transfer_payment = 0;

					var rtgs_payment = 0;

					var imps_payment = 0;

					var neft_payment = 0;

					if (item.payment_mode == 'CSH') {

						cash_payment += parseFloat(item.payment_amount);

					}

					if (item.payment_mode == 'CC' || item.payment_mode == 'DC') {

						card_payment += parseFloat(item.payment_amount);

					}

					if (item.payment_mode == 'CHQ') {

						cheque_payment += parseFloat(item.payment_amount);

					}

					if (item.payment_mode == 'NB') {

						if (item.NB_type == 1) {

							rtgs_payment += parseFloat(item.payment_amount);

						}

						if (item.NB_type == 2) {

							imps_payment += parseFloat(item.payment_amount);

						}

						if (item.NB_type == 3) {

							upi_transfer_payment += parseFloat(item.payment_amount);

						} if (item.NB_type == 4) {

							neft_payment += parseFloat(item.payment_amount);

						}

						if (item.NB_type == 5) {

							upi_scanner_payment += parseFloat(item.payment_amount);

						}

					}

					tot_pp_taxable_amt += parseFloat(item.payment_amount);

					tot_pp_amt += parseFloat(item.payment_amount);

					//var url = base_url + 'index.php/admin_ret_billing/billing_invoice/'+ item.bill_id;

					trHTML += '<tr class="' + item.bill_id + '">' +

						'<td>' + (key + 1) + '</td>' +

						'<td>' + item.branch + '</td>' +

						'<td>' + item.bill_no + '</td>' +

						'<td>' + item.bill_date + '</td>' +

						'<td>' + item.bill_type + '</td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td> </td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td>' + money_format_india(parseFloat(item.payment_amount).toFixed(2)) + '</td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td>' + money_format_india(parseFloat(item.payment_amount).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(cash_payment).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(card_payment).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(cheque_payment).toFixed(2)) + '</td>' +

						'<td></td>' +

						'<td>' + money_format_india(parseFloat(upi_scanner_payment).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(upi_transfer_payment).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(rtgs_payment).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(imps_payment).toFixed(2)) + '</td>' +

						'<td>' + money_format_india(parseFloat(neft_payment).toFixed(2)) + '</td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td>' + item.cus_name + '</td>' +

						'<td>' + item.mobile + '</td>' +

						'<td>' + item.pan_number + '</td>' +

						'<td>' + item.gst_number + '</td>' +

						'</tr>';

				})

				trHTML += '<tr style="font-weight:bold;color:red;">' +

					'<td><strong>Purchase Plan Grand Total</stromg></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_pp_taxable_amt).toFixed(2)) + '</strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_pp_amt).toFixed(2)) + '</strong></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'</tr>';

			}

			$('#detailed_day_transactiton_list > tbody').html(trHTML);

			// Check and initialise datatable

			if (!$.fn.DataTable.isDataTable('#detailed_day_transactiton_list')) {

				oTable = $('#detailed_day_transactiton_list').dataTable({

					"fixedHeader": true,

					"destroy": true,

					"bSort": false,

					"bInfo": true,

					"scrollX": '100%',

					"dom": 'lBfrtip',

					"lengthMenu": [[-1, 25, 50, 100, 250], ["All", 25, 50, 100, 250]],

					"columnDefs": [

						{

							targets: [9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32],

							className: 'dt-body-right'

						},

						{

							targets: [0, 1, 2, 4, 5, 6, 7, 8],

							className: 'dt-body-left'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: false,

							title: '',

							messageTop: title,

							orientation: 'landscape',

							customize: function (win) {

								var last = null;

								var current = null;

								var bod = [];

								var css = '@page { size: landscape; }',

									head = win.document.head || win.document.getElementsByTagName('head')[0],

									style = win.document.createElement('style');

								style.type = 'text/css';

								style.media = 'print';

								if (style.styleSheet) {

									style.styleSheet.cssText = css;

								}

								else {

									style.appendChild(win.document.createTextNode(css));

								}

								head.appendChild(style);

							},

							exportOptions: {

								columns: ':visible',

								stripHtml: false

							}

						},

						{

							extend: 'excel',

							footer: true,

							title: 'Detailed Day Transaction Report',

						},

						{

							extend: 'colvis',

							collectionLayout: 'fixed columns',

							collectionTitle: 'Column visibility control'

						},

					],

				});

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

/*Detailed Day Transaction Report*/

function set_discBills() {

	var dt_range = ($("#dt_range").val()).split('-');

	var company_name = $('#company_name').val();

	var from_date = dt_range[0];

	var to_date = dt_range[1];

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "Discount Bill Report"

	var optional = '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/bill_discount/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'dt_range': $("#dt_range").val(), 'is_otp_approved': $('#is_otp_approved').val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'disc_rep_type': $("#disc_rep_type").val(), 'category_id': $("#category").val(), 'id_product': $("#prod_select").val(), 'id_design': $("#des_select").val(), 'id_sub_design': $('#sub_des_select').val(), 'metal_id': $('#metal').val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.list;

			$('#total_count').text(list.length);

			var oTable = $('#disc_bill_detail').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#disc_bill_detail').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"order": [[0, "desc"]],

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"fixedHeader": true,

					"paging": false,

					"autoWidth": true,

					"columnDefs": [

						{

							targets: [9, 10, 11, 12, 13, 14, 15],

							className: 'dt-body-right'

						},

						{

							targets: [0, 1, 2, 3, 4, 5, 6, 7, 8],

							className: 'dt-body-left'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', '10px');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: 'Discount Bill Report',

						}

					],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "branch_name" },

						{ "mDataProp": "bill_date" },

						{

							"mDataProp": function (row, type, val, meta) {

								var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + row.bill_id;

								return '<a href=' + url + ' target="_blank">' + row.bill_no + '</a>';

							},

						},

						{ "mDataProp": "cus_name" },

						{ "mDataProp": "mobile" },

						{ "mDataProp": "tag_code" },

						{ "mDataProp": "product_name" },

						{ "mDataProp": "design_name" },

						{ "mDataProp": "sub_design_name" },

						{

							"mDataProp": function (row, type, val, meta) {

								return money_format_india(row.gross_wt);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								return money_format_india(row.net_wt);

							}

						},

						{ "mDataProp": "wastage_percent" },

						{ "mDataProp": "making_charge" },

						/* { "mDataProp": function ( row, type, val, meta ){

							var mc_value=0;

							if(row.calculation_based_on==0 || row.calculation_based_on==2)

							{

								mc_value=(row.mcType==1 ? parseFloat(row.mc_value*row.gross_wt):parseFloat(row.mc_value*row.piece));

							}else if(row.calculation_based_on==1)

							{

								mc_value=(row.mcType==1 ? parseFloat(row.mc_value*row.net_wt):parseFloat(row.mc_value*row.piece));

							}

							return money_format_india(parseFloat(mc_value).toFixed(2));

						},

						}, */

						{

							"mDataProp": function (row, type, val, meta) {

								var item_cost = (row.item_cost);

								return money_format_india(parseFloat(item_cost).toFixed(2));

							},

						},

						{

							"mDataProp": function (row, type, val, meta) {

								return money_format_india(row.bill_discount);

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								var mc_value = 0;

								var wast_wt = 0;

								var disc_per = '-';

								/*if(row.calculation_based_on==0 || row.calculation_based_on==2)

								{

									var wast_wt=parseFloat(parseFloat(row.gross_wt)*parseFloat(row.wastage_percent)).toFixed(3);

									mc_value=(row.mcType==1 ? parseFloat(row.mc_value*row.gross_wt):parseFloat(row.mc_value*row.piece));

								}else if(row.calculation_based_on==1)

								{

									var wast_wt=parseFloat(parseFloat(row.net_wt)*parseFloat(row.wastage_percent)).toFixed(3);

									mc_value=(row.mcType==1 ? parseFloat(row.mc_value*row.net_wt):parseFloat(row.mc_value*row.piece));

								}

								if(mc_value<row.bill_discount && mc_value>0)

								{

									disc_per=parseFloat(((row.bill_discount-mc_value)/parseFloat(row.rate_per_grm)/row.net_wt)*100).toFixed(2);

								}*/

								/*disc_per=parseFloat((row.bill_discount/row.item_cost)*100).toFixed(2);

								return disc_per;*/

								var dis_per = (row.bill_discount / row.item_cost) * 100

								return dis_per.toFixed(2);

							},

						},

						{ "mDataProp": "is_otp_approved" },

						{ "mDataProp": "approved_by" },

						{ "mDataProp": "emp_name" },

						{ "mDataProp": "emp_code" },

						/* { "mDataProp": function ( row, type, val, meta ){

							  var mc_value=0;

							 if(row.calculation_based_on==0 || row.calculation_based_on==2)

							 {

								 mc_value=(row.mcType==1 ? parseFloat(row.mc_value*row.gross_wt):parseFloat(row.mc_value*row.piece));

							 }else if(row.calculation_based_on==1)

							 {

								 mc_value=(row.mcType==1 ? parseFloat(row.mc_value*row.net_wt):parseFloat(row.mc_value*row.piece));

							 }

							 return parseFloat(parseFloat(row.mc_value)-parseFloat(row.bill_discount)/parseFloat(row.gross_wt)*100)

						 },

						 },*/

						/*{ "mDataProp": function ( row, type, val, meta ){

							var tag_details=row.tag_details;

							return tag_details.gross_wt;

						},

						},

						{ "mDataProp": "min_pcs" },

						{ "mDataProp": "max_pcs" },*/

					],

					"footerCallback": function (row, data, start, end, display) {

						if (data.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								grs_wt = api

									.column(9)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(9).footer()).html(parseFloat(grs_wt).toFixed(2));

								net_wt = api

									.column(10)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(10).footer()).html(parseFloat(net_wt).toFixed(2));

								va = api

									.column(11)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(11).footer()).html(parseFloat(parseFloat(va) / parseFloat(data.length)).toFixed(2));

								mc = api

									.column(12)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(12).footer()).html(parseFloat(mc).toFixed(2));

								cost = api

									.column(13)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(13).footer()).html(parseFloat(cost).toFixed(2));

								discount = api

									.column(14)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(14).footer()).html(parseFloat(parseFloat(discount)).toFixed(2));

								disc = api

									.column(15)

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(15).footer()).html(parseFloat(disc / parseFloat(data.length)).toFixed(2));

							}

						} else {

							var api = this.api(), data;

							$(api.column(9).footer()).html('');

							$(api.column(10).footer()).html('');

							$(api.column(11).footer()).html('');

							$(api.column(12).footer()).html('');

							$(api.column(13).footer()).html('');

							$(api.column(14).footer()).html('');

							$(api.column(15).footer()).html('');

						}

					}

				});

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

$('#receipts_stmt_search').on('click', function () {

	if ($('#branch_filter').val() != null) {

		get_ReceiptsLedger();

	}

});

//Receipts statements

function get_ReceiptsLedger() {

	var dt_range = ($("#dt_range").val()).split('-');

	var from_date = dt_range[0];

	var to_date = dt_range[1];

	var company_name = $('#company_name').val();

	var branch_name = ''

	var report_name = "CUSTOMER LEDGER"

	var optional = '';

	var ledger_type = $("#ledger_type").val();

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/receipts_ledger_statement/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: {

			'dt_range': $("#dt_range").val(),

			'id_branch': $("#branch_filter").val(),

			'ledger_type': $("#ledger_type").val(),

			'reqledger_type': $("#reqledger_type").val(),

		},

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			var oTable = $('#receipts_ledger_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#receipts_ledger_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": false,

					"dom": 'lBfrtip',

					"aLengthMenu": [[10, 100, 200, 300, -1], [10, 100, 200, 300, "All"]],

					"pageLength": 10,

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: "",

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: "Cusomer Ledger",

						}

					],

					"columnDefs": [

						{

							targets: [5, 6, 7],

							className: 'dt-body-right'

						},

						{

							targets: [1, 2],

							className: 'dt-body-left'

						}

					],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "VoucherDate" },

						{ "mDataProp": "Particulars" },

						{ "mDataProp": "VoucherType" },

						{ "mDataProp": "VoucherNumber" },

						{ "mDataProp": "BillNo" },

						{

							"mDataProp": function (row, type, val, meta) {

								return money_format_india(row.GrossTotal)

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								return money_format_india(row.CashTotal)

							}

						},

						{

							"mDataProp": function (row, type, val, meta) {

								return money_format_india(row.OthersTotal)

							}

						},

					],

					"footerCallback": function (row, data, start, end, display) {

						if (data.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								opening = api

									.column(6, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(6).footer()).html(money_format_india(parseFloat(opening).toFixed(2)));

								debit = api

									.column(7, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(7).footer()).html(money_format_india(parseFloat(debit).toFixed(2)));

								credit = api

									.column(5, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(5).footer()).html(money_format_india(parseFloat(credit).toFixed(2)));

								//$(api.column(7).footer()).html(money_format_india(parseFloat(balance).toFixed(2)));

							}

						} else {

							/*$(api.column(3).footer() ).html('');

							$(api.column(4).footer() ).html('');

							$(api.column(5).footer() ).html('');*/

						}

					}

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function set_credit_pending_list() {

	var company_name = $('#company_name').val();

	var from_date = $('#rpt_from_date').html();

	var to_date = $('#rpt_to_date').html();

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "CREDIT PENDING REPORT";

	var optional = $('#category option:selected').html() != '' && $('#category option:selected').html() != undefined ? $('#category option:selected').html() + " - " : '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/credit_pending/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'credit_reference': $('#select_influencer').val(), 'id_customer': $('#select_customer').val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'from_date': $('#rpt_from_date').html(), 'to_date': $('#rpt_to_date').html(), 'filter_type': $('#filter_type').val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			var oTable = $('#credit_issued_list').DataTable();

			oTable.clear().draw();

			if (list != null && list.length > 0) {

				oTable = $('#credit_issued_list').dataTable({

					"bDestroy": true,

					"bInfo": true,

					"bFilter": true,

					"scrollX": '100%',

					"bSort": true,

					"dom": 'lBfrtip',

					"columnDefs": [

						{

							targets: [9, 10, 11, 12, 13],

							className: 'dt-body-right'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: "",

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', 'inherit');

							},

						},

						{

							extend: 'excel',

							footer: true,

							title: "Credit Pending Report",

						}

					],

					"aaData": list,

					"aoColumns": [

						{ "mDataProp": "branch_name" },

						{ "mDataProp": "cus_name" },

						{ "mDataProp": "mobile" },

						{ "mDataProp": "address" },

						{ "mDataProp": "city_name" },

						{ "mDataProp": "village_name" },

						{

							"mDataProp": function (row, type, val, meta) {

								if (row.type == 0) {

									var url = base_url + 'index.php/admin_ret_billing/billing_invoice/' + row.bill_id;

								} else {

									var url = base_url + 'index.php/admin_ret_billing/issue/issue_print/' + row.bill_id;

								}

								return '<a href=' + url + ' target="_blank">' + row.bill_no + '</a>';

							}

						},

						{ "mDataProp": "bill_date" },

						{ "mDataProp": "credit_reference" },

						{

							"mDataProp": function (row) {

								return money_format_india(parseFloat(row.tot_bill_amount).toFixed(2));

							}

						},

						{

							"mDataProp": function (row) {

								return money_format_india(parseFloat(row.due_amount).toFixed(2));

							}

						},

						{

							"mDataProp": function (row) {

								return money_format_india(parseFloat(row.paid_amount).toFixed(2));

							}

						},

						{

							"mDataProp": function (row) {

								return money_format_india(parseFloat(row.credit_ret_amt).toFixed(2));

							}

						},

						{

							"mDataProp": function (row) {

								return money_format_india(parseFloat(row.bal_amt).toFixed(2));

							}

						},

						{

							"mDataProp": null,

							"sClass": "control center",

							"sDefaultContent": '<span class="drill-val"><i class="fa fa-chevron-circle-down text-teal"></i></span>'

						},

					],

					"footerCallback": function (row, data, start, end, display) {

						var cshtotal = 0;

						if (list.length > 0) {

							var api = this.api(), data;

							for (var i = 0; i <= data.length - 1; i++) {

								var intVal = function (i) {

									return typeof i === 'string' ?

										i.replace(/[\$,]/g, '') * 1 :

										typeof i === 'number' ?

											i : 0;

								};

								$(api.column(0).footer()).html('Total');

								total_bill_amount = api

									.column(9, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(9).footer()).html(money_format_india(parseFloat(total_bill_amount).toFixed(2)));

								total_due_amount = api

									.column(10, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(10).footer()).html(money_format_india(parseFloat(total_due_amount).toFixed(2)));

								total_paid_amount = api

									.column(11, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(11).footer()).html(money_format_india(parseFloat(total_paid_amount).toFixed(2)));

								total_return_amount = api

									.column(12, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(12).footer()).html(money_format_india(parseFloat(total_return_amount).toFixed(2)));

								total_amount = api

									.column(13, { search: 'applied' })

									.data()

									.reduce(function (a, b) {

										return intVal(a) + intVal(b);

									}, 0);

								$(api.column(13).footer()).html(money_format_india(parseFloat(total_amount).toFixed(2)));

							}

						}

						else {

							var api = this.api(), data;

							$(api.column(7).footer()).html('');

						}

					}

				});

				var anOpen = [];

				$(document).on('click', "#credit_issued_list .control", function () {

					var nTr = this.parentNode;

					var i = $.inArray(nTr, anOpen);

					if (i === -1) {

						$('.drill-val', this).html('<i class="fa fa-chevron-circle-up text-teal"></i>');

						oTable.fnOpen(nTr, fnFormatRowCreditDetails(oTable, nTr), 'details');

						anOpen.push(nTr);

					}

					else {

						$('.drill-val', this).html('<i class="fa fa-chevron-circle-down text-teal"></i>');

						oTable.fnClose(nTr);

						anOpen.splice(i, 1);

					}

				});

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

$("#filter_type").on("change", function () {

	if (this.value == 0) {

		$('.filter_date').css({ "display": "none" })

	} else {

		$('.filter_date').css({ "display": "block" })

	}

});

// CASH BOOK

$('#cash_book_search').on('click', function () {

	get_cash_book_details();

});

function get_cash_book_details() {

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $('#branch_select option:selected').toArray().map(item => item.text).join());

	var company_code = $('#company_code').val();

	var company_address1 = $('#company_address1').val();

	var company_address2 = $('#company_address2').val();

	var company_city = $('#company_city').val();

	var pincode = $('#pincode').val();

	var company_email = $('#company_email').val();

	var company_gst_number = $('#company_gst_number').val();

	var phone = $('#phone').val();

	var report_type = $('#sale_ret_filter').find(':selected').text();

	var title = "<div style='text-align: center;'><b><span style='font-size:12pt;'>" + company_code + "</span></b></br>"

		+ "<span style='font-size:11pt;'>" + company_address1 + "</span></br>"

		+ "<span style='font-size:11pt;'>" + company_address2 + company_city + "-" + pincode + "</span></br>"

		+ "<span style='font-size:11pt;'>GSTIN:" + company_gst_number + ", EMAIL:" + company_email + "</span></br>"

		+ "<span style='font-size:11pt;'>Contact :" + phone + "</span></br>"

		+ "<span style=font-size:12pt;>&nbsp;&nbsp;CASH BOOK  - " + branch_name + " &nbsp;From&nbsp;:&nbsp;" + $('#rpt_from_date').html() + " &nbsp;&nbsp;- to " + $('#rpt_to_date').html() + " - " + $('.hidden-xs').html() + "&nbsp;&nbsp;" + getDisplayDateTime() + "</span></div>";

	$("div.overlay").css("display", "block");

	my_Date = new Date();

	$.ajax({

		type: "POST",

		url: base_url + "index.php/admin_ret_reports/cash_book/ajax",

		data: { 'id_branch': $('#branch_select').val(), 'from_date': $('#rpt_from_date').html(), 'to_date': $('#rpt_to_date').html() },

		dataType: 'JSON',

		success: function (data) {

			$("div.overlay").css("display", "none");

			var list = data.list;

			// var oTable = $('#cash_book_list').DataTable();

			trHTML = '';

			//  oTable.clear().draw();

			$("#cash_book_list > tbody > tr ").remove();

			$('#cash_book_list').dataTable().fnClearTable();

			$('#cash_book_list').dataTable().fnDestroy();

			if (list) {

				$.each(list, function (k, items) {

					total_credit = 0;

					total_debit = 0;

					trHTML += '<tr class="sales">' +

						'<td class="sales" style="font-weight:bold;text-align: left;"><strong>' + k + '<strong></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'</tr>';

					trHTML += '<tr class="sales">' +

						'<td class="sales" style="font-weight:bold;text-align: left;"><strong>OPENING<strong></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td style="text-align: right;" >' + money_format_india(parseFloat(items.opening).toFixed(2)) + '</td>' +

						'<td></td>' +

						// '<td style="text-align: right;" >'+money_format_india(items.opening)+'</td>'+

						'</tr>';

					$.each(items, function (id, dta) {

						if (dta.Remarks) {

							trHTML += '<tr class="sales">' +

								'<td class="sales" style="font-weight:bold;"></td>' +

								'<td style="text-align: left;">' + dta.ref_id + '</td>' +

								'<td style="text-align: left;" >' + dta.type + '</td>' +

								'<td style="text-align: right;" >' + (dta.Debit != '' ? money_format_india(parseFloat(dta.Debit).toFixed(2)) : '') + '</td>' +

								'<td style="text-align: right;" >' + (dta.Credit != '' ? money_format_india(parseFloat(dta.Credit).toFixed(2)) : '') + '</td>' +

								'</tr>';

							total_credit += dta.Credit != '' ? parseFloat(dta.Credit) : 0;

							total_debit += dta.Debit != '' ? parseFloat(dta.Debit) : 0;

						}

					});

					trHTML += '<tr class="sales">' +

						'<td class="sales" style="font-weight:bold;text-align: left;"><strong>TOTAL<strong></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td style="text-align: right;" >' + money_format_india(parseFloat(total_debit).toFixed(2)) + '</td>' +

						'<td style="text-align: right;" >' + money_format_india(parseFloat(total_credit).toFixed(2)) + '</td>' +

						'</tr>';

					closing = total_debit - total_credit;

					trHTML += '<tr class="sales">' +

						'<td class="sales" style="font-weight:bold;text-align: left;"><strong>CLOSING<strong></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td style="text-align: right;" >' + money_format_india(parseFloat(closing).toFixed(2)) + '</td>' +

						'<td></td>' +

						'</tr>';

					closig_bal = parseFloat(items.opening) + parseFloat(closing);

					trHTML += '<tr class="sales">' +

						'<td class="sales" style="font-weight:bold;text-align: left;"><strong>CLOSING BALANCE<strong></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td style="text-align: right;" >' + money_format_india(parseFloat(closig_bal).toFixed(2)) + '</td>' +

						'<td></td>' +

						'</tr>';

				});

				$('#cash_book_list tbody').html(trHTML);

				if (!$.fn.DataTable.isDataTable('#cash_book_list')) {

					oTable = $('#cash_book_list').dataTable({

						"bSort": false,

						"bDestroy": true,

						"bInfo": true,

						"scrollX": '100%',

						"paging": false,

						"dom": 'Bfrtip',

						"bAutoWidth": false,

						"responsive": true,

						// "columnDefs": [

						// 	{

						// 		targets: [0],

						// 		className: 'dt-body-left'

						// 	},

						// 	{

						// 		targets: [1,2,3,4,5,6,7,8,9,10,11],

						// 		className: 'dt-body-right'

						// 	},

						// ],

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: '',

								messageTop: title,

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact');

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', '10px')

										.css('font-family', 'sans-serif');

								},

								exportOptions: {

									columns: ':visible',

									stripHtml: false

								}

							},

							{

								extend: 'excel',

								footer: true,

								title: 'CASH BOOK',

							}

						],

					});

				}

			}

		}

	});

}

//CASH BOOK

/*CategoryWise Day Transactions */

$('#bill_type').on('change', function () {

	if (ctrl_page[1] == 'categorywise_day_transaction') {

		$('.sales_cat').css('display', 'block');

		$('.pur_cat').css('display', 'none');

		if (this.value == 2) {

			$('.sales_cat').css('display', 'none');

			$('.pur_cat').css('display', 'block');

		}

	}

})

$('#categorywise_day_trans_search').on('click', function () {

	get_categorywise_day_transactions();

});

function get_categorywise_day_transactions() {

	var dt_range = ($("#dt_range").val()).split('-');

	var from_date = dt_range[0];

	var to_date = dt_range[1];

	var company_name = $('#company_name').val();

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "CategoryWise Day Transaction Report";

	var metal = $('#metal option:selected').html() != '' && $('#metal option:selected').html() != undefined ? $('#metal option:selected').html() + ' - ' : '';

	var category = $('#category option:selected').html() != '' && $('#category option:selected').html() != undefined ? $('#category option:selected').html() + ' - ' : '';

	var optional = metal + category;

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		type: 'POST',

		url: base_url + "index.php/admin_ret_reports/categorywise_day_transaction/ajax",

		dataType: 'JSON',

		data: { 'dt_range': $("#dt_range").val(), 'id_branch': ($('#branch_filter').val() != '' && $('#branch_filter').val() != undefined ? $('#branch_filter').val() : $("#branch_select").val()), 'id_category': $('#category').val(), 'id_metal': $('#metal').val(), 'bill_type': $('#bill_type').val(), 'id_old_metal_type': $('#old_metal_type').val() },

		success: function (data) {

			console.log(data);

			$("div.overlay").css("display", "none");

			$("#categorywise_day_transactiton_list > tbody > tr").remove();

			$('#categorywise_day_transactiton_list').dataTable().fnClearTable();

			$('#categorywise_day_transactiton_list').dataTable().fnDestroy();

			var trHTML = '';



			var sales_details = data.list.sales_details;

			var purchase_details = data.list.purchase_details;

			var return_details = data.list.return_details;

			var order_advance_details = data.list.order_advance_details;

			var gen_advance_details = data.list.gen_advance_details;

			var payment_issue_details = data.list.payment_issue_details;

			var purchase_plan_details = data.list.purchase_plan_details;

			if (sales_details != '') {

				var tot_sales_pcs = 0;

				var tot_sales_gwt = 0;

				var tot_sales_lwt = 0;

				var tot_sales_nwt = 0;

				var tot_sales_diawt = 0;

				var tot_sales_taxable_amt = 0;

				var tot_sales_sgst = 0;

				var tot_sales_cgst = 0;

				var tot_sales_igst = 0;

				var tot_sales_tax = 0;

				var tot_sales_item_cost = 0;



				var tot_cash = 0;

				var tot_card = 0;

				var tot_chq = 0;

				var tot_upi = 0;

				var tot_rtgs = 0;

				var tot_imps = 0;

				var tot_neft = 0;

				var tot_old_metal_amt = 0;

				var tot_sales_ret_amt = 0;

				var tot_adv_adj_amt = 0;

				var tot_chit_ulti_amt = 0;





				trHTML += '<tr style="font-weight:bold;color:red;text-transform:uppercase;">' +

					'<td><strong>Sales Details</strong></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'</tr>';



				$.each(sales_details, function (k, date) {

					trHTML += '<tr style="font-weight:bold;color:blue;">' +

						'<td><strong>' + k + '</strong></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'</tr>';



					var sales_pcs = 0;

					var sales_gwt = 0;

					var sales_lwt = 0;

					var sales_nwt = 0;

					var sales_diawt = 0;

					var sales_taxable_amt = 0;

					var sales_sgst = 0;

					var sales_cgst = 0;

					var sales_igst = 0;

					var sales_tax = 0;

					var sales_item_cost = 0;



					var cash = 0;

					var card = 0;

					var chq = 0;

					var upi = 0;

					var rtgs = 0;

					var imps = 0;

					var neft = 0;

					var old_metal_amt = 0;

					var sales_ret_amt = 0;

					var adv_adj_amt = 0;

					var chit_ulti_amt = 0;



					$.each(date, function (key, bill) {



						if (key == 'payment') {

							$.each(bill, function (pay, val) {

								cash += parseFloat(val.cash);

								card += parseFloat(val.card);

								chq += parseFloat(val.chq);

								upi += parseFloat(val.upi);

								rtgs += parseFloat(val.rtgs);

								imps += parseFloat(val.imps);

								neft += parseFloat(val.neft);

								old_metal_amt += parseFloat(val.old_met_amount);

								sales_ret_amt += parseFloat(val.return_amount);

								adv_adj_amt += parseFloat(val.adv_adj_amt);

								chit_ulti_amt += parseFloat(val.chit_utilize);

							})

						}



						if (key == 'sales') {



							$.each(bill, function (i, items) {

								sales_pcs += parseFloat(items.piece);

								sales_gwt += parseFloat(items.gross_wt);

								sales_lwt += parseFloat(items.less_wt);

								sales_nwt += parseFloat(items.net_wt);

								sales_diawt += parseFloat(items.dia_wt);

								sales_taxable_amt += parseFloat(items.taxable_amount);

								sales_sgst += parseFloat(items.total_sgst);

								sales_cgst += parseFloat(items.total_cgst);

								sales_igst += parseFloat(items.total_igst);

								sales_tax += parseFloat(items.item_total_tax);

								sales_item_cost += parseFloat(items.total_cost);



								trHTML += '<tr>' +

									'<td style="width:15%">' + items.category_name + '</td>' +

									'<td>' + parseInt(items.piece) + '</td>' +

									'<td>' + money_format_india(parseFloat(items.gross_wt).toFixed(3)) + '</td>' +

									'<td>' + money_format_india(parseFloat(items.less_wt).toFixed(3)) + '</td>' +

									'<td>' + money_format_india(parseFloat(items.net_wt).toFixed(3)) + '</td>' +

									'<td>' + money_format_india(parseFloat(items.dia_wt).toFixed(3)) + '</td>' +

									'<td>' + money_format_india(parseFloat(items.taxable_amount).toFixed(2)) + '</td>' +

									'<td>' + money_format_india(parseFloat(items.total_sgst).toFixed(2)) + '</td>' +

									'<td>' + money_format_india(parseFloat(items.total_cgst).toFixed(2)) + '</td>' +

									'<td>' + money_format_india(parseFloat(items.total_igst).toFixed(2)) + '</td>' +

									'<td>' + money_format_india(parseFloat(items.item_total_tax).toFixed(2)) + '</td>' +

									'<td>' + money_format_india(parseFloat(items.total_cost).toFixed(2)) + '</td>' +

									'<td></td>' +

									'<td></td>' +

									'<td></td>' +

									'<td></td>' +

									'<td></td>' +

									'<td></td>' +

									'<td></td>' +

									'<td></td>' +

									'<td></td>' +

									'<td></td>' +

									'<td></td>' +

									'<td></td>' +



									'</tr>';

							});

						}



					})

					tot_sales_pcs += parseFloat(sales_pcs);

					tot_sales_gwt += parseFloat(sales_gwt);

					tot_sales_lwt += parseFloat(sales_lwt);

					tot_sales_nwt += parseFloat(sales_nwt);

					tot_sales_diawt += parseFloat(sales_diawt);

					tot_sales_taxable_amt += parseFloat(sales_taxable_amt);

					tot_sales_sgst += parseFloat(sales_sgst);

					tot_sales_cgst += parseFloat(sales_cgst);

					tot_sales_igst += parseFloat(sales_igst);

					tot_sales_tax += parseFloat(sales_tax);

					tot_sales_item_cost += parseFloat(sales_item_cost);



					tot_cash += parseFloat(cash);

					tot_card += parseFloat(card);

					tot_chq += parseFloat(chq);

					tot_upi += parseFloat(upi);

					tot_rtgs += parseFloat(rtgs);

					tot_imps += parseFloat(imps);

					tot_neft += parseFloat(neft);

					tot_old_metal_amt += parseFloat(old_metal_amt);

					tot_sales_ret_amt += parseFloat(sales_ret_amt);

					tot_adv_adj_amt += parseFloat(adv_adj_amt);

					tot_chit_ulti_amt += parseFloat(chit_ulti_amt);



					trHTML += '<tr style="font-weight:bold;color:blue;">' +

						'<td><strong>SUB TOTAL</strong></td>' +

						'<td><strong>' + parseInt(sales_pcs) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(sales_gwt).toFixed(3)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(sales_lwt).toFixed(3)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(sales_nwt).toFixed(3)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(sales_diawt).toFixed(3)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(sales_taxable_amt).toFixed(2)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(sales_sgst).toFixed(2)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(sales_cgst).toFixed(2)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(sales_igst).toFixed(2)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(sales_tax).toFixed(2)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(sales_item_cost).toFixed(2)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(cash).toFixed(2)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(card).toFixed(2)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(chq).toFixed(2)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(upi).toFixed(2)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(rtgs).toFixed(2)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(imps).toFixed(2)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(neft).toFixed(2)) + '</strong></td>' +

						'<td></td>' +

						'<td><strong>' + money_format_india(parseFloat(old_metal_amt).toFixed(2)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(sales_ret_amt).toFixed(2)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(adv_adj_amt).toFixed(2)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(chit_ulti_amt).toFixed(2)) + '</strong></td>' +

						'</tr>';

				})

				trHTML += '<tr style="font-weight:bold;color:red;">' +

					'<td><strong>SALES GRAND TOTAL</strong></td>' +

					'<td><strong>' + parseInt(tot_sales_pcs) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_sales_gwt).toFixed(3)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_sales_lwt).toFixed(3)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_sales_nwt).toFixed(3)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_sales_diawt).toFixed(3)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_sales_taxable_amt).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_sales_sgst).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_sales_cgst).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_sales_igst).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_sales_tax).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_sales_item_cost).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_cash).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_card).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_chq).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_upi).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_rtgs).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_imps).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_neft).toFixed(2)) + '</strong></td>' +

					'<td></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_old_metal_amt).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_sales_ret_amt).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_adv_adj_amt).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_chit_ulti_amt).toFixed(2)) + '</strong></td>' +

					'</tr>';

			}



			if (purchase_details != '') // Purchase Details

			{

				var tot_purchase_pcs = 0;

				var tot_purchase_gwt = 0;

				var tot_purchase_lwt = 0;

				var tot_purchase_nwt = 0;

				var tot_purchase_diawt = 0;

				var tot_purchase_taxable_amt = 0;

				var tot_purchase_item_cost = 0;



				trHTML += '<tr style="font-weight:bold;color:red;text-transform:uppercase;">' +

					'<td><strong>Purchase Details</strong></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +



					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'</tr>';



				$.each(purchase_details, function (key, bill) {

					var purchase_pcs = 0;

					var purchase_gwt = 0;

					var purchase_lwt = 0;

					var purchase_nwt = 0;

					var purchase_diawt = 0;

					var purchase_taxable_amt = 0;

					var purchase_item_cost = 0;



					trHTML += '<tr style="font-weight:bold;color:blue;">' +

						'<td><strong>' + key + '</strong></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +



						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'</tr>';



					$.each(bill, function (k, items) {

						purchase_pcs += parseFloat(items.pcs);

						purchase_gwt += parseFloat(items.gross_wt);

						purchase_lwt += parseFloat(parseFloat(items.dust_wt) + parseFloat(items.stone_wt));

						purchase_nwt += parseFloat(items.net_wt);

						purchase_diawt += parseFloat(items.dia_wt);

						purchase_taxable_amt += parseFloat(items.amount);

						purchase_item_cost += parseFloat(items.amount);



						trHTML += '<tr>' +

							'<td style="width:15%">' + items.category + '</td>' +

							'<td>' + parseInt(items.pcs) + '</td>' +

							'<td>' + money_format_india(parseFloat(items.gross_wt).toFixed(3)) + '</td>' +

							'<td>' + money_format_india(parseFloat(parseFloat(items.dust_wt) + parseFloat(items.stone_wt)).toFixed(3)) + '</td>' +

							'<td>' + money_format_india(parseFloat(items.net_wt).toFixed(3)) + '</td>' +

							'<td>' + money_format_india(parseFloat(items.dia_wt).toFixed(3)) + '</td>' +

							'<td>' + money_format_india(parseFloat(items.amount).toFixed(2)) + '</td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td>' + money_format_india(parseFloat(items.amount).toFixed(2)) + '</td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'</tr>';

					});



					tot_purchase_pcs += parseFloat(purchase_pcs);

					tot_purchase_gwt += parseFloat(purchase_gwt);

					tot_purchase_lwt += parseFloat(purchase_lwt);

					tot_purchase_nwt += parseFloat(purchase_nwt);

					tot_purchase_diawt += parseFloat(purchase_diawt);

					tot_purchase_taxable_amt += parseFloat(purchase_taxable_amt);

					tot_purchase_item_cost += parseFloat(purchase_item_cost);



					trHTML += '<tr style="font-weight:bold;color:blue;">' +

						'<td><strong>SUB TOTAL</strong></td>' +

						'<td><strong>' + parseInt(purchase_pcs) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(purchase_gwt).toFixed(3)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(purchase_lwt).toFixed(3)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(purchase_nwt).toFixed(3)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(purchase_diawt).toFixed(3)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(purchase_taxable_amt).toFixed(2)) + '</strong></td>' +

						'<td><strong></strong></td>' +

						'<td><strong></strong></td>' +

						'<td><strong></strong></td>' +

						'<td><strong></strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(purchase_item_cost).toFixed(2)) + '</strong></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'</tr>';

				});



				trHTML += '<tr style="font-weight:bold;color:red;">' +

					'<td><strong>PURCHASE GRAND TOTAL</strong></td>' +

					'<td><strong>' + parseInt(tot_purchase_pcs) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_purchase_gwt).toFixed(3)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_purchase_lwt).toFixed(3)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_purchase_nwt).toFixed(3)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_purchase_diawt).toFixed(3)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_purchase_taxable_amt).toFixed(2)) + '</strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_purchase_item_cost).toFixed(2)) + '</strong></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'</tr>';

			}



			if (return_details != '') // Sales Return Details

			{

				var tot_sales_return_pcs = 0;

				var tot_sales_return_gwt = 0;

				var tot_sales_return_lwt = 0;

				var tot_sales_return_nwt = 0;

				var tot_sales_return_diawt = 0;

				var tot_sales_return_taxable_amt = 0;

				var tot_sales_return_sgst = 0;

				var tot_sales_return_cgst = 0;

				var tot_sales_return_igst = 0;

				var tot_sales_return_tax = 0;

				var tot_sales_return_item_cost = 0;



				trHTML += '<tr style="font-weight:bold;color:red;text-transform:uppercase;">' +

					'<td><strong>Sales Return Details</strong></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'</tr>';



				$.each(return_details, function (key, bill) {

					var sales_return_pcs = 0;

					var sales_return_gwt = 0;

					var sales_return_lwt = 0;

					var sales_return_nwt = 0;

					var sales_return_diawt = 0;

					var sales_return_taxable_amt = 0;

					var sales_return_sgst = 0;

					var sales_return_cgst = 0;

					var sales_return_igst = 0;

					var sales_return_tax = 0;

					var sales_return_item_cost = 0;



					trHTML += '<tr style="font-weight:bold;color:blue;">' +

						'<td><strong>' + key + '</strong></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'</tr>';

					$.each(bill, function (k, items) {

						sales_return_pcs += parseFloat(items.piece);

						sales_return_gwt += parseFloat(items.gross_wt);

						sales_return_lwt += parseFloat(items.less_wt);

						sales_return_nwt += parseFloat(items.net_wt);

						sales_return_diawt += parseFloat(items.dia_wt);

						sales_return_taxable_amt += parseFloat(items.taxable_amount);

						sales_return_sgst += parseFloat(items.total_sgst);

						sales_return_cgst += parseFloat(items.total_cgst);

						sales_return_igst += parseFloat(items.total_igst);

						sales_return_tax += parseFloat(items.item_total_tax);

						sales_return_item_cost += parseFloat(items.total_cost);



						trHTML += '<tr>' +

							'<td style="width:15%">' + items.category_name + '</td>' +

							'<td>' + parseInt(items.piece) + '</td>' +

							'<td>' + money_format_india(parseFloat(items.gross_wt).toFixed(3)) + '</td>' +

							'<td>' + money_format_india(parseFloat(items.less_wt).toFixed(3)) + '</td>' +

							'<td>' + money_format_india(parseFloat(items.net_wt).toFixed(3)) + '</td>' +

							'<td>' + money_format_india(parseFloat(items.dia_wt).toFixed(3)) + '</td>' +

							'<td>' + money_format_india(parseFloat(items.taxable_amount).toFixed(2)) + '</td>' +

							'<td>' + money_format_india(parseFloat(items.total_sgst).toFixed(2)) + '</td>' +

							'<td>' + money_format_india(parseFloat(items.total_cgst).toFixed(2)) + '</td>' +

							'<td>' + money_format_india(parseFloat(items.total_igst).toFixed(2)) + '</td>' +

							'<td>' + money_format_india(parseFloat(items.item_total_tax).toFixed(2)) + '</td>' +

							'<td>' + money_format_india(parseFloat(items.total_cost).toFixed(2)) + '</td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +



							'</tr>';

					});



					tot_sales_return_pcs += parseFloat(sales_return_pcs);

					tot_sales_return_gwt += parseFloat(sales_return_gwt);

					tot_sales_return_lwt += parseFloat(sales_return_lwt);

					tot_sales_return_nwt += parseFloat(sales_return_nwt);

					tot_sales_return_diawt += parseFloat(sales_return_diawt);

					tot_sales_return_taxable_amt += parseFloat(sales_return_taxable_amt);

					tot_sales_return_sgst += parseFloat(sales_return_sgst);

					tot_sales_return_cgst += parseFloat(sales_return_cgst);

					tot_sales_return_igst += parseFloat(sales_return_igst);

					tot_sales_return_tax += parseFloat(sales_return_tax);

					tot_sales_return_item_cost += parseFloat(sales_return_item_cost);



					trHTML += '<tr style="font-weight:bold;color:blue;">' +

						'<td><strong>SUB TOTAL</strong></td>' +

						'<td><strong>' + parseInt(sales_return_pcs) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(sales_return_gwt).toFixed(3)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(sales_return_lwt).toFixed(3)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(sales_return_nwt).toFixed(3)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(sales_return_diawt).toFixed(3)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(sales_return_taxable_amt).toFixed(2)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(sales_return_sgst).toFixed(2)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(sales_return_cgst).toFixed(2)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(sales_return_igst).toFixed(2)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(sales_return_tax).toFixed(2)) + '</strong></td>' +

						'<td><strong>' + money_format_india(parseFloat(sales_return_item_cost).toFixed(2)) + '</strong></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'<td></td>' +

						'</tr>';



				});





				trHTML += '<tr style="font-weight:bold;color:red;">' +

					'<td><strong>SALES RETURN GRAND TOTAL</strong></td>' +

					'<td><strong>' + parseInt(tot_sales_return_pcs) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_sales_return_gwt).toFixed(3)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_sales_return_lwt).toFixed(3)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_sales_return_nwt).toFixed(3)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_sales_return_diawt).toFixed(3)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_sales_return_taxable_amt).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_sales_return_sgst).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_sales_return_cgst).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_sales_return_igst).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_sales_return_tax).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_sales_return_item_cost).toFixed(2)) + '</strong></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'</tr>';

			}



			if (order_advance_details != '') // Order Advance Details

			{

				var tot_ord_adv_amt = 0;

				var tot_ord_adv_cash = 0;

				var tot_ord_adv_card = 0;

				var tot_ord_adv_chq = 0;

				var tot_ord_adv_upi = 0;

				var tot_ord_adv_rtgs = 0;

				var tot_ord_adv_imps = 0;

				var tot_ord_adv_neft = 0;

				var tot_ord_old_metal = 0;

				var tot_ord_adv_sales_ret = 0;

				var tot_ord_adv_adv_adj = 0;

				var tot_ord_adv_chit_ulti = 0;



				trHTML += '<tr style="font-weight:bold;color:red;text-transform:uppercase;">' +

					'<td><strong>Order Advance Details</strong></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'</tr>';



				$.each(order_advance_details, function (k, bill) {

					$.each(bill, function (key, items) {

						tot_ord_adv_amt += parseFloat(items.amount_received);

						tot_ord_adv_cash += parseFloat(items.cash);

						tot_ord_adv_card += parseFloat(items.card);

						tot_ord_adv_chq += parseFloat(items.chq);

						tot_ord_adv_upi += parseFloat(items.upi);

						tot_ord_adv_rtgs += parseFloat(items.rtgs);

						tot_ord_adv_imps += parseFloat(items.imps);

						tot_ord_adv_neft += parseFloat(items.neft);

						tot_ord_old_metal += parseFloat(items.old_metal_amount);

						/*tot_ord_adv_sales_ret +=parseFloat(items.old_metal_amount);

						tot_ord_adv_adv_adj +=parseFloat(items.old_metal_amount);

						tot_ord_adv_chit_ulti +=parseFloat(items.old_metal_amount);*/



						trHTML += '<tr>' +

							'<td style="width:15%">' + items.bill_date + '</td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td>' + money_format_india(parseFloat(items.amount_received).toFixed(2)) + '</td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td>' + money_format_india(parseFloat(items.amount_received).toFixed(2)) + '</td>' +

							'<td>' + money_format_india(parseFloat(items.cash).toFixed(2)) + '</td>' +

							'<td>' + money_format_india(parseFloat(items.card).toFixed(2)) + '</td>' +

							'<td>' + money_format_india(parseFloat(items.chq).toFixed(2)) + '</td>' +

							'<td>' + money_format_india(parseFloat(items.upi).toFixed(2)) + '</td>' +

							'<td>' + money_format_india(parseFloat(items.rtgs).toFixed(2)) + '</td>' +

							'<td>' + money_format_india(parseFloat(items.imps).toFixed(2)) + '</td>' +

							'<td>' + money_format_india(parseFloat(items.neft).toFixed(2)) + '</td>' +

							'<td></td>' +

							'<td>' + money_format_india(parseFloat(items.old_metal_amount).toFixed(2)) + '</td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +





							'</tr>';

					})

				})



				trHTML += '<tr style="font-weight:bold;color:red;">' +

					'<td><strong>ORDER ADVANCE GRAND TOTAL</strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_ord_adv_amt).toFixed(2)) + '</strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_ord_adv_amt).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_ord_adv_cash).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_ord_adv_card).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_ord_adv_chq).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_ord_adv_upi).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_ord_adv_rtgs).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_ord_adv_imps).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_ord_adv_neft).toFixed(2)) + '</strong></td>' +

					'<td></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_ord_old_metal).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_ord_adv_sales_ret).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_ord_adv_adv_adj).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_ord_adv_chit_ulti).toFixed(2)) + '</strong></td>' +

					'</tr>';

			}



			if (gen_advance_details != '') // General Advance Details

			{

				var tot_gen_adv_amt = 0;

				var tot_gen_adv_cash = 0;

				var tot_gen_adv_card = 0;

				var tot_gen_adv_chq = 0;

				var tot_gen_adv_upi = 0;

				var tot_gen_adv_rtgs = 0;

				var tot_gen_adv_imps = 0;

				var tot_gen_adv_neft = 0;

				var tot_gen_old_metal = 0;

				var tot_gen_adv_sales_ret = 0;

				var tot_gen_adv_adv_adj = 0;

				var tot_gen_adv_chit_ulti = 0;



				trHTML += '<tr style="font-weight:bold;color:red;text-transform:uppercase;">' +

					'<td><strong>General Advance Details</strong></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'</tr>';



				$.each(gen_advance_details, function (k, bill) {

					$.each(bill, function (key, items) {

						tot_gen_adv_amt += parseFloat(items.amount_received);

						tot_gen_adv_cash += parseFloat(items.cash);

						tot_gen_adv_card += parseFloat(items.card);

						tot_gen_adv_chq += parseFloat(items.chq);

						tot_gen_adv_upi += parseFloat(items.upi);

						tot_gen_adv_rtgs += parseFloat(items.rtgs);

						tot_gen_adv_imps += parseFloat(items.imps);

						tot_gen_adv_neft += parseFloat(items.neft);

						/*tot_gen_old_metal +=parseFloat(items.old_metal_amount);

						tot_ord_adv_sales_ret +=parseFloat(items.old_metal_amount);

						tot_ord_adv_adv_adj +=parseFloat(items.old_metal_amount);

						tot_ord_adv_chit_ulti +=parseFloat(items.old_metal_amount);*/



						trHTML += '<tr>' +

							'<td style="width:15%">' + items.bill_date + '</td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td>' + money_format_india(parseFloat(items.amount_received).toFixed(2)) + '</td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td>' + money_format_india(parseFloat(items.amount_received).toFixed(2)) + '</td>' +

							'<td>' + money_format_india(parseFloat(items.cash).toFixed(2)) + '</td>' +

							'<td>' + money_format_india(parseFloat(items.card).toFixed(2)) + '</td>' +

							'<td>' + money_format_india(parseFloat(items.chq).toFixed(2)) + '</td>' +

							'<td>' + money_format_india(parseFloat(items.upi).toFixed(2)) + '</td>' +

							'<td>' + money_format_india(parseFloat(items.rtgs).toFixed(2)) + '</td>' +

							'<td>' + money_format_india(parseFloat(items.imps).toFixed(2)) + '</td>' +

							'<td>' + money_format_india(parseFloat(items.neft).toFixed(2)) + '</td>' +

							'<td></td>' +

							'<td>' + money_format_india(parseFloat(0).toFixed(2)) + '</td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +





							'</tr>';

					})

				})



				trHTML += '<tr style="font-weight:bold;color:red;">' +

					'<td><strong>ORDER ADVANCE GRAND TOTAL</strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_gen_adv_amt).toFixed(2)) + '</strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_gen_adv_amt).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_gen_adv_cash).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_gen_adv_card).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_gen_adv_chq).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_gen_adv_upi).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_gen_adv_rtgs).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_gen_adv_imps).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_gen_adv_neft).toFixed(2)) + '</strong></td>' +

					'<td></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_gen_old_metal).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_gen_adv_sales_ret).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_gen_adv_adv_adj).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_gen_adv_chit_ulti).toFixed(2)) + '</strong></td>' +

					'</tr>';

			}



			if (payment_issue_details != '') // Payment Issue Details

			{

				var tot_pay_iss_amt = 0;

				var tot_pay_iss_cash = 0;

				var tot_pay_iss_card = 0;

				var tot_pay_iss_chq = 0;

				var tot_pay_iss_upi = 0;

				var tot_pay_iss_rtgs = 0;

				var tot_pay_iss_imps = 0;

				var tot_pay_iss_neft = 0;

				var tot_pay_old_metal = 0;

				var tot_pay_iss_sales_ret = 0;

				var tot_pay_iss_adv_adj = 0;

				var tot_pay_iss_chit_ulti = 0;



				trHTML += '<tr style="font-weight:bold;color:red;text-transform:uppercase;">' +

					'<td><strong>Payment Issue Details</strong></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'</tr>';







				$.each(payment_issue_details, function (k, bill) {

					let PaymentDateWise = bill.filter(bill => bill.bill_date === k)

						.reduce((a, b) => a + b);

					console.log(PaymentDateWise);

					$.each(bill, function (key, items) {

						tot_pay_iss_amt += parseFloat(items.amount_received);

						tot_pay_iss_cash += parseFloat(items.cash);

						tot_pay_iss_card += parseFloat(items.card);

						tot_pay_iss_chq += parseFloat(items.chq);

						tot_pay_iss_upi += parseFloat(items.upi);

						tot_pay_iss_rtgs += parseFloat(items.rtgs);

						tot_pay_iss_imps += parseFloat(items.imps);

						tot_pay_iss_neft += parseFloat(items.neft);

						/*tot_gen_old_metal +=parseFloat(items.old_metal_amount);

						tot_ord_adv_sales_ret +=parseFloat(items.old_metal_amount);

						tot_ord_adv_adv_adj +=parseFloat(items.old_metal_amount);

						tot_ord_adv_chit_ulti +=parseFloat(items.old_metal_amount);*/



						trHTML += '<tr>' +

							'<td style="width:15%">' + items.bill_date + '</td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td>' + money_format_india(parseFloat(items.amount_received).toFixed(2)) + '</td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td>' + money_format_india(parseFloat(items.amount_received).toFixed(2)) + '</td>' +

							'<td>' + money_format_india(parseFloat(items.cash).toFixed(2)) + '</td>' +

							'<td>' + money_format_india(parseFloat(items.card).toFixed(2)) + '</td>' +

							'<td>' + money_format_india(parseFloat(items.chq).toFixed(2)) + '</td>' +

							'<td>' + money_format_india(parseFloat(items.upi).toFixed(2)) + '</td>' +

							'<td>' + money_format_india(parseFloat(items.rtgs).toFixed(2)) + '</td>' +

							'<td>' + money_format_india(parseFloat(items.imps).toFixed(2)) + '</td>' +

							'<td>' + money_format_india(parseFloat(items.neft).toFixed(2)) + '</td>' +

							'<td></td>' +

							'<td>' + money_format_india(parseFloat(0).toFixed(2)) + '</td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +





							'</tr>';

					})

				})



				trHTML += '<tr style="font-weight:bold;color:red;">' +

					'<td><strong>ORDER ADVANCE GRAND TOTAL</strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_pay_iss_amt).toFixed(2)) + '</strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_pay_iss_amt).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_pay_iss_cash).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_pay_iss_card).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_pay_iss_chq).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_pay_iss_upi).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_pay_iss_rtgs).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_pay_iss_imps).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_pay_iss_neft).toFixed(2)) + '</strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_pay_old_metal).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_pay_iss_sales_ret).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_pay_iss_adv_adj).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_pay_iss_chit_ulti).toFixed(2)) + '</strong></td>' +

					'</tr>';

			}



			if (purchase_plan_details != '') // Purchase Plan Details

			{

				var tot_pp_amt = 0;

				var tot_pp_cash = 0;

				var tot_pp_card = 0;

				var tot_pp_chq = 0;

				var tot_pp_upi = 0;

				var tot_pp_rtgs = 0;

				var tot_pp_imps = 0;

				var tot_pp_neft = 0;

				var tot_pp_online = 0;



				trHTML += '<tr style="font-weight:bold;color:red;text-transform:uppercase;">' +

					'<td><strong>Purchase Plan Details</strong></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'<td></td>' +

					'</tr>';



				$.each(purchase_plan_details, function (k, bill) {

					$.each(bill, function (key, items) {

						tot_pp_amt += parseFloat(items.payment);

						tot_pp_cash += parseFloat(items.cash);

						tot_pp_card += parseFloat(items.card);

						tot_pp_chq += parseFloat(items.chq);

						tot_pp_upi += parseFloat(items.upi);

						tot_pp_rtgs += parseFloat(items.rtgs);

						tot_pp_imps += parseFloat(items.imps);

						tot_pp_neft += parseFloat(items.neft);

						tot_pp_online += parseFloat(items.online_pay);





						trHTML += '<tr>' +

							'<td style="width:15%">' + items.pay_date + '</td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td>' + money_format_india(parseFloat(items.payment).toFixed(2)) + '</td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td>' + money_format_india(parseFloat(items.payment).toFixed(2)) + '</td>' +

							'<td>' + money_format_india(parseFloat(items.cash).toFixed(2)) + '</td>' +

							'<td>' + money_format_india(parseFloat(items.card).toFixed(2)) + '</td>' +

							'<td>' + money_format_india(parseFloat(items.chq).toFixed(2)) + '</td>' +

							'<td>' + money_format_india(parseFloat(items.upi).toFixed(2)) + '</td>' +

							'<td>' + money_format_india(parseFloat(items.rtgs).toFixed(2)) + '</td>' +

							'<td>' + money_format_india(parseFloat(items.imps).toFixed(2)) + '</td>' +

							'<td>' + money_format_india(parseFloat(items.neft).toFixed(2)) + '</td>' +

							'<td>' + money_format_india(parseFloat(items.online_pay).toFixed(2)) + '</td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +

							'<td></td>' +





							'</tr>';

					})

				})



				trHTML += '<tr style="font-weight:bold;color:red;">' +

					'<td><strong>PURCHASE PLAN GRAND TOTAL</strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_pp_amt).toFixed(2)) + '</strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_pp_amt).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_pp_cash).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_pp_card).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_pp_chq).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_pp_upi).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_pp_rtgs).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_pp_imps).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_pp_neft).toFixed(2)) + '</strong></td>' +

					'<td><strong>' + money_format_india(parseFloat(tot_pp_online).toFixed(2)) + '</strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'<td><strong></strong></td>' +

					'</tr>';

			}

			$('#categorywise_day_transactiton_list > tbody').html(trHTML);

			// Check and initialise datatable

			if (!$.fn.DataTable.isDataTable('#categorywise_day_transactiton_list')) {

				oTable = $('#categorywise_day_transactiton_list').dataTable({

					"destroy": true,

					"bSort": false,

					"bInfo": true,

					"scrollX": '100%',

					"dom": 'lBfrtip',

					"lengthMenu": [[-1, 25, 50, 100, 250], ["All", 25, 50, 100, 250]],

					"columnDefs": [

						{

							targets: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23],

							className: 'dt-body-right'

						},

						{

							targets: [0],

							className: 'dt-body-left'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact');

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', '10px')

									.css('font-family', 'sans-serif');

							},

							exportOptions: {

								columns: ':visible',

								stripHtml: false

							}

						},

						{

							extend: 'excel',

							footer: true,

							title: 'CategoryWise Day Transaction Report',

							customize: function (xlsx) {

								var sheet = xlsx.xl.worksheets['sheet1.xml'];

								$('row c[r*="A"]', sheet).each(function () {

									var cellText = $('is t', this).text();

									if (cellText === 'SUB TOTAL' || cellText === 'SALES GRAND TOTAL' || cellText === 'PURCHASE GRAND TOTAL' || cellText === 'SALES RETURN GRAND TOTAL') {

										$(this).attr('s', '2').siblings().attr('s', '2');

									}

									else if (cellText.match(/^\d{2}-\d{2}-\d{4}$/)) {

										$(this).attr('s', '2');

									}

								});

							}

						},

						{

							extend: 'colvis',

							collectionLayout: 'fixed columns',

							collectionTitle: 'Column visibility control'

						},

					],

				});

			}

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

/*CategoryWise Day Transactions */

function getTaggedLot() {

	$.ajax({

		type: 'GET',

		url: base_url + 'index.php/admin_ret_tagging/getTaggedLot',

		dataType: 'json',

		success: function (data) {

			var id = $("#tag_lot_no").val();

			$.each(data, function (key, item) {

				$("#tag_lot_no").append(

					$("<option></option>")

						.attr("value", item.lot_no)

						.text(item.lot_no)

				);

			});

			$("#tag_lot_no").select2(

				{

					placeholder: "Select Lot No",

					allowClear: true,

					//closeOnSelect: false

				});

			if (id != '') {

				$("#tag_lot_no").select2("val", id);

			}

		}

	});

}

$("#repair_search").on('click', function () {

	set_repair_order_list();

});

$("#cus_order_type").on('change', function () {

	if (this.value == 1) {

		$('.stock_order').css('display', 'none');

		$('.custom_order').css('display', 'block');

	} else {

		$('.stock_order').css('display', 'block');

		$('.custom_order').css('display', 'none');

	}

});

function set_repair_order_list() {

	var company_name = $('#company_name').val();

	var from_date = $('#rpt_from_date').html();

	var to_date = $('#rpt_to_date').html();

	var branch_name = ($('#branch_name').val() != '' && $('#branch_name').val() != undefined ? $('#branch_name').val() : $("#branch_select option:selected").text());

	var report_name = "Issue Receipt Report";

	var optional = '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	$("div.overlay").css("display", "block");

	var order_type = $("#cus_order_type").val();

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		url: base_url + "index.php/admin_ret_reports/repair_order/ajax?nocache=" + my_Date.getUTCSeconds(),

		data: ({ 'from_date': $('#rpt_from_date').html(), 'to_date': $('#rpt_to_date').html(), 'id_karigar': $('#karigar').val(), 'order_type': $('#order_type').val(), 'id_branch': $('#branch_select').val(), 'id_employee': $('#emp_select').val(), 'report_type': $('#report_type').val(), 'cus_order_type': $('#cus_order_type').val() }),

		dataType: "JSON",

		type: "POST",

		success: function (data) {

			var list = data.list;

			if (order_type == 1) {

				var oTable = $('#repair_order_cus').DataTable();

				oTable.clear().draw();

				if (list != null && list.length > 0) {

					oTable = $('#repair_order_cus').dataTable({

						"bDestroy": true,

						"bInfo": true,

						"bFilter": true,

						"scrollX": '100%',

						"bSort": true,

						"dom": 'lBfrtip',

						"columnDefs": [

							{

								targets: [9, 10, 11],

								className: 'dt-right'

							}, {

								targets: [0, 1, 2, 3, 4, 5, 6, 7, 8],

								className: 'dt-left'

							},

						],

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: "",

								messageTop: title,

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', 'inherit');

								},

							},

							{

								extend: 'excel',

								footer: true,

								title: "Issue Receipt Report",

							}

						],

						"aaData": list,

						"aoColumns": [

							{ "mDataProp": "ref_no" },

							{ "mDataProp": "issue_date" },

							{ "mDataProp": "karigar" },

							{ "mDataProp": "branch_name" },

							{ "mDataProp": "employee_name" },

							{ "mDataProp": "work_at" },

							{ "mDataProp": "product_name" },

							{ "mDataProp": "design_name" },

							{ "mDataProp": "sub_design_name" },

							{ "mDataProp": "issue_wt" },

							{ "mDataProp": "recived_wt" },

							{

								"mDataProp": function (row) {

									return money_format_india(parseFloat(row.issue_wt - row.recived_wt).toFixed(3));

								}

							},

						],

						"footerCallback": function (row, data, start, end, display) {

							var cshtotal = 0;

							if (list.length > 0) {

								var api = this.api(), data;

								for (var i = 0; i <= data.length - 1; i++) {

									var intVal = function (i) {

										return typeof i === 'string' ?

											i.replace(/[\$,]/g, '') * 1 :

											typeof i === 'number' ?

												i : 0;

									};

									$(api.column(0).footer()).html('Total');

									total = api

										.column(11, { search: 'applied' })

										.data()

										.reduce(function (a, b) {

											return intVal(a) + intVal(b);

										}, 0);

									$(api.column(11).footer()).html(money_format_india(parseFloat(total).toFixed(3)));

									total_bill = api

										.column(10, { search: 'applied' })

										.data()

										.reduce(function (a, b) {

											return intVal(a) + intVal(b);

										}, 0);

									$(api.column(10).footer()).html(money_format_india(parseFloat(total_bill).toFixed(3)));

									amount = api

										.column(9, { search: 'applied' })

										.data()

										.reduce(function (a, b) {

											return intVal(a) + intVal(b);

										}, 0);

									$(api.column(9).footer()).html(money_format_india(parseFloat(amount).toFixed(3)));

								}

							}

							else {

								var api = this.api(), data;

								$(api.column(7).footer()).html('');

							}

						}

					});

				}

			} else {

				var oTable = $('#repair_order').DataTable();

				oTable.clear().draw();

				if (list != null && list.length > 0) {

					oTable = $('#repair_order').dataTable({

						"bDestroy": true,

						"bInfo": true,

						"bFilter": true,

						"scrollX": '100%',

						"bSort": true,

						"dom": 'lBfrtip',

						"columnDefs": [

							{

								targets: [9, 10, 11],

								className: 'dt-right'

							},

							{

								targets: [0, 1, 2, 3, 4, 5, 6, 7, 8, 12, 13],

								className: 'dt-left'

							},

						],

						"buttons": [

							{

								extend: 'print',

								footer: true,

								title: "",

								messageTop: title,

								customize: function (win) {

									$(win.document.body).find('table')

										.addClass('compact')

										.css('font-size', 'inherit');

								},

							},

							{

								extend: 'excel',

								footer: true,

								title: "Issue Receipt Report",

							}

						],

						"aaData": list,

						"aoColumns": [

							{ "mDataProp": "karigar" },

							{ "mDataProp": "work_at" },

							{ "mDataProp": "ref_no" },

							{ "mDataProp": "issue_date" },

							{ "mDataProp": "order_no" },

							{ "mDataProp": "branch_name" },

							{ "mDataProp": "employee_name" },

							{ "mDataProp": "product_name" },

							{ "mDataProp": "design_name" },

							{ "mDataProp": "sub_design_name" },

							{ "mDataProp": "issue_wt" },

							{ "mDataProp": "recived_wt" },

							{

								"mDataProp": function (row) {

									return money_format_india(parseFloat(row.issue_wt - row.recived_wt).toFixed(3));

								}

							},

							{ "mDataProp": "receipt_date" },

							{ "mDataProp": "receipt_by" },

							{

								"mDataProp": null,

								"sClass": "control center",

								"sDefaultContent": '<span class="drill-val"><i class="fa fa-chevron-circle-down text-teal"></i></span>'

							},

						],

						"footerCallback": function (row, data, start, end, display) {

							var cshtotal = 0;

							if (list.length > 0) {

								var api = this.api(), data;

								for (var i = 0; i <= data.length - 1; i++) {

									var intVal = function (i) {

										return typeof i === 'string' ?

											i.replace(/[\$,]/g, '') * 1 :

											typeof i === 'number' ?

												i : 0;

									};

									$(api.column(0).footer()).html('Total');

									total = api

										.column(10, { search: 'applied' })

										.data()

										.reduce(function (a, b) {

											return intVal(a) + intVal(b);

										}, 0);

									$(api.column(10).footer()).html(money_format_india(parseFloat(total).toFixed(3)));

									total_bill = api

										.column(11, { search: 'applied' })

										.data()

										.reduce(function (a, b) {

											return intVal(a) + intVal(b);

										}, 0);

									$(api.column(11).footer()).html(money_format_india(parseFloat(total_bill).toFixed(3)));

									amount = api

										.column(12, { search: 'applied' })

										.data()

										.reduce(function (a, b) {

											return intVal(a) + intVal(b);

										}, 0);

									$(api.column(12).footer()).html(money_format_india(parseFloat(amount).toFixed(3)));

								}

							}

							else {

								var api = this.api(), data;

								$(api.column(7).footer()).html('');

							}

						}

					});

					var anOpen = [];

					$(document).on('click', "#repair_order .control", function () {

						var nTr = this.parentNode;

						var i = $.inArray(nTr, anOpen);

						if (i === -1) {

							$('.drill-val', this).html('<i class="fa fa-chevron-circle-up text-teal"></i>');

							oTable.fnOpen(nTr, fnFormatRowRepairDetails(oTable, nTr), 'details');

							anOpen.push(nTr);

						}

						else {

							$('.drill-val', this).html('<i class="fa fa-chevron-circle-down text-teal"></i>');

							oTable.fnClose(nTr);

							anOpen.splice(i, 1);

						}

					});

				}

			}

			$("div.overlay").css("display", "none");

		},

		error: function (error) {

			$("div.overlay").css("display", "none");

		}

	});

}

function fnFormatRowRepairDetails(oTable, nTr) {

	var oData = oTable.fnGetData(nTr);

	var rowDetail = '';

	var prodTable =

		'<div class="innerDetails">' +

		'<table class="table table-responsive table-bordered text-center table-sm">' +

		'<tr class="bg-teal">' +

		'<th>S.No</th>' +

		// '<th>Image</th>' +

		'<th>Product </th>' +

		'<th>Design </th>' +

		'<th>Sub Design </th>' +

		'<th>Pcs</th>' +

		'<th>Gross wt</th>' +

		'<th>Less wt</th>' +

		'<th>Net wt</th>' +

		'<th>VA</th>' +

		'<th>MC</th>' +

		'<th>Status</th>' +

		//'<th>Remarks</th>' +

		// '<th>Reject Reason</th>' +

		// '<th>Repair Type</th>' +

		'<th>Tag Code</th>' +

		// '<th>C.Due</th>' +

		// '<th>Action</th>' +

		'</tr>';

	var order_details = oData.order_details;

	var total_amount = 0;

	$.each(order_details, function (idx, val) {

		// if (val.image_details[0] != '' && val.image_details[0] != null) {

		// 	img_src = base_url + 'assets/img/orders/' + val.image_details[0].image;

		// }

		// else {

		// 	img_src = base_url + 'assets/img/no_image.png';

		// }

		prodTable +=

			'<tr class="prod_det_btn">' +

			'<td>' + val.id_orderdetails + '</td>' +

			//'<td>' + '<img src=' + img_src + ' width="50" height="55"><br><a  class="btn btn-secondary order_img"  id="edit" data-toggle="modal" data-id=' + val.id_orderdetails + '><i class="fa fa-eye" ></i></a>' + '</td>' +

			'<td>' + val.product_name + '</td>' +

			'<td>' + val.design_name + '</td>' +

			'<td>' + val.sub_design_name + '</td>' +

			'<td style="text-align:right;">' + val.totalitems + '</td>' +

			'<td style="text-align:right;">' + val.weight + '</td>' +

			'<td style="text-align:right;">' + val.less_wt + '</td>' +

			'<td style="text-align:right;">' + val.net_wt + '</td>' +

			// '<td>' + val.repair_type + '</td>' +



			'<td>' + val.mc + '</td>' +

			'<td>' + val.va + '</td>' +

			'<td>' + val.status + '</td>' +

			//		'<td>' + val.description + '</td>' +

			//		'<td>' + (val.reject_reason ? val.reject_reason : ' - ') + '</td>' +

			// '<td>' + (val.repair_type) + '</td>' +

			'<td>' + (val.tag_code ? val.tag_code : '-') + '</td>' +

			// '<td>' + (val.cus_due_date_date ? val.cus_due_date_date : '-') + '</td>' +

			'</tr>';

	});

	rowDetail = prodTable + '</table></div>';

	return rowDetail;

}

/*H.O DAILY STOCK BOOK REPORT*/

$('#ho_daily_stock_search').on('click', function () {

	get_ho_daily_stock_book();

})

function get_ho_daily_stock_book() {

	var dt_range = ($("#dt_range").val()).split('-');

	var company_name = $('#company_name').val();

	var from_date = dt_range[0];

	var to_date = dt_range[1];

	var branch_name = 'HEAD OFFICE';

	var report_name = "H.O DAILY STOCK BOOK REPORT ";

	var optional = '';

	var title = "<div style='text-align: center;'><b><span style='font-size:15pt;'>" + company_name + "</span></b><b><span style='font-size:12pt;'></span></b></br>"

		+ "<span>" + report_print(branch_name, report_name, from_date, to_date, optional) + "</span>";

	my_Date = new Date();

	$(".overlay").css("display", "block");

	$.ajax({

		type: 'POST',

		url: base_url + "index.php/admin_ret_reports/ho_daily_stock_book/ajax",

		dataType: 'JSON',

		data: { 'dt_range': $("#dt_range").val(), 'id_branch': 1, 'id_metal': $('#metal').val(), 'from_date': from_date, 'to_date': to_date, 'GroupBy': 1 },

		success: function (data) {

			var stock_details = data.stock_details;

			$("div.overlay").css("display", "none");

			$("#ho_daily_stock_list > tbody > tr").remove();

			$('#ho_daily_stock_list').dataTable().fnClearTable();

			$('#ho_daily_stock_list').dataTable().fnDestroy();

			var trHTML = '';

			// OPENING

			var total_opening_grswt = parseFloat(parseFloat(stock_details.hovaultopengrswt) + parseFloat(stock_details.btvaultopengrswt) + parseFloat(stock_details.sectopengrswt));

			var total_opening_nwt = parseFloat(parseFloat(stock_details.hovaultopennwt) + parseFloat(stock_details.btvaultopennwt) + parseFloat(stock_details.sectopennwt));

			var total_opening_diawt = parseFloat(parseFloat(stock_details.hovaultopendiawt) + parseFloat(stock_details.btvaultopendiawt) + parseFloat(stock_details.sectopendiawt));

			var total_opening_grmwt = parseFloat(parseFloat(stock_details.hovaultopengrmwt) + parseFloat(stock_details.btvaultopengrmwt) + parseFloat(stock_details.sectopengrmwt));

			var total_opening_ctwt = parseFloat(parseFloat(stock_details.hovaultopenctwt) + parseFloat(stock_details.btvaultopenctwt) + parseFloat(stock_details.sectopenctwt));

			trHTML += '<tr>' +

				'<td style="width:10%"></td>' +

				'<td style="width:20%">HO VAULT OPENING STOCK</td>' +

				'<td>' + (money_format_india(stock_details.hovaultopengrswt)) + '</td>' +

				'<td>' + (money_format_india(stock_details.hovaultopennwt)) + '</td>' +

				'<td>' + (money_format_india(stock_details.hovaultopendiawt)) + '</td>' +

				'<td>' + (money_format_india(stock_details.hovaultopengrmwt)) + '</td>' +

				'<td>' + (money_format_india(stock_details.hovaultopenctwt)) + '</td>' +

				'</tr>';

			trHTML += '<tr>' +

				'<td style="font-weight:bold;color:blue;text-transform:uppercase;"><strong>OPENING</strong</td>' +

				'<td>HO BT VAULT OPENING STOCK</td>' +

				'<td>' + (money_format_india(stock_details.btvaultopengrswt)) + '</td>' +

				'<td>' + (money_format_india(stock_details.btvaultopennwt)) + '</td>' +

				'<td>' + (money_format_india(stock_details.btvaultopendiawt)) + '</td>' +

				'<td>' + (money_format_india(stock_details.btvaultopengrmwt)) + '</td>' +

				'<td>' + (money_format_india(stock_details.btvaultopenctwt)) + '</td>' +

				'</tr>';

			trHTML += '<tr>' +

				'<td></td>' +

				'<td>HO SECTION OPENING STOCK</td>' +

				'<td>' + (money_format_india(stock_details.sectopengrswt)) + '</td>' +

				'<td>' + (money_format_india(stock_details.sectopennwt)) + '</td>' +

				'<td>' + (money_format_india(stock_details.sectopendiawt)) + '</td>' +

				'<td>' + (money_format_india(stock_details.sectopengrmwt)) + '</td>' +

				'<td>' + (money_format_india(stock_details.sectopenctwt)) + '</td>' +

				'</tr>';

			trHTML += '<tr style="font-weight:bold;color:red;text-transform:uppercase;">' +

				'<td></td>' +

				'<td><strong>TOTAL</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(total_opening_grswt).toFixed(3)) + '</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(total_opening_nwt).toFixed(3)) + '</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(total_opening_diawt).toFixed(3)) + '</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(total_opening_grmwt).toFixed(3)) + '</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(total_opening_ctwt).toFixed(3)) + '</strong></td>' +

				'</tr>';

			//OPENING

			// INWARDS

			var total_inwards_grswt = parseFloat(parseFloat(stock_details.hovaultinwgrswt) + parseFloat(stock_details.btvaultinwgrswt) + parseFloat(stock_details.sectinwgrswt));

			var total_inwards_nwt = parseFloat(parseFloat(stock_details.hovaultinwnwt) + parseFloat(stock_details.btvaultinwnwt) + parseFloat(stock_details.sectinwnwt));

			var total_inwards_diawt = parseFloat(parseFloat(stock_details.hovaultinwdiawt) + parseFloat(stock_details.btvaultinwdiawt) + parseFloat(stock_details.sectinwdiawt));

			var total_inwards_grmwt = parseFloat(parseFloat(stock_details.hovaultinwgrmwt) + parseFloat(stock_details.btvaultinwgrmwt) + parseFloat(stock_details.sectinwgrmwt));

			var total_inwards_ctwt = parseFloat(parseFloat(stock_details.hovaultinwctwt) + parseFloat(stock_details.btvaultinwctwt) + parseFloat(stock_details.sectinwctwt));

			trHTML += '<tr>' +

				'<td></td>' +

				'<td>HO PURCHASES</td>' +

				'<td>' + (money_format_india(stock_details.hovaultinwgrswt)) + '</td>' +

				'<td>' + (money_format_india(stock_details.hovaultinwnwt)) + '</td>' +

				'<td>' + (money_format_india(stock_details.hovaultinwdiawt)) + '</td>' +

				'<td>' + (money_format_india(stock_details.hovaultinwgrmwt)) + '</td>' +

				'<td>' + (money_format_india(stock_details.hovaultinwctwt)) + '</td>' +

				'</tr>';

			trHTML += '<tr>' +

				'<td style="font-weight:bold;color:blue;text-transform:uppercase;"><strong>INWARDS</strong></td>' +

				'<td>HO BT VAULT INWARD</td>' +

				'<td>' + (money_format_india(stock_details.btvaultinwgrswt)) + '</td>' +

				'<td>' + (money_format_india(stock_details.btvaultinwnwt)) + '</td>' +

				'<td>' + (money_format_india(stock_details.btvaultinwdiawt)) + '</td>' +

				'<td>' + (money_format_india(stock_details.btvaultinwgrmwt)) + '</td>' +

				'<td>' + (money_format_india(stock_details.btvaultinwctwt)) + '</td>' +

				'</tr>';

			trHTML += '<tr>' +

				'<td></td>' +

				'<td>HO SECTION STOCK INWARD</td>' +

				'<td>' + (money_format_india(stock_details.sectinwgrswt)) + '</td>' +

				'<td>' + (money_format_india(stock_details.sectinwnwt)) + '</td>' +

				'<td>' + (money_format_india(stock_details.sectinwdiawt)) + '</td>' +

				'<td>' + (money_format_india(stock_details.sectinwgrmwt)) + '</td>' +

				'<td>' + (money_format_india(stock_details.sectinwctwt)) + '</td>' +

				'</tr>';

			trHTML += '<tr style="font-weight:bold;color:red;text-transform:uppercase;">' +

				'<td></td>' +

				'<td><strong>TOTAL</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(total_inwards_grswt).toFixed(3)) + '</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(total_inwards_nwt).toFixed(3)) + '</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(total_inwards_diawt).toFixed(3)) + '</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(total_inwards_grmwt).toFixed(3)) + '</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(total_inwards_ctwt).toFixed(3)) + '</strong></td>' +

				'</tr>';

			// INWARDS

			// OUTWARDS

			var total_outwards_grswt = parseFloat(parseFloat(stock_details.purretgrswt) + parseFloat(stock_details.issuegrswt) + parseFloat(stock_details.sectoutgrswt) + parseFloat(stock_details.pocketgrswt));

			var total_outwards_nwt = parseFloat(parseFloat(stock_details.purretnwt) + parseFloat(stock_details.issuenwt) + parseFloat(stock_details.sectoutnwt) + parseFloat(stock_details.pocketnwt));

			var total_outwards_diawt = parseFloat(parseFloat(stock_details.purretdiawt) + parseFloat(stock_details.issuediawt) + parseFloat(stock_details.sectoutdiawt) + parseFloat(stock_details.pocketdiawt));

			var total_outwards_grmwt = parseFloat(parseFloat(stock_details.purretgrmwt) + parseFloat(stock_details.issuegrmwt) + parseFloat(stock_details.sectoutgrmwt) + parseFloat(stock_details.pocketgrmwt));

			var total_outwards_ctwt = parseFloat(parseFloat(stock_details.purretctwt) + parseFloat(stock_details.issuectwt) + parseFloat(stock_details.sectoutctwt) + parseFloat(stock_details.pocketctwt));

			trHTML += '<tr>' +

				'<td></td>' +

				'<td>HO SALES & PURCHASE RETURN</td>' +

				'<td>' + (money_format_india(stock_details.purretgrswt)) + '</td>' +

				'<td>' + (money_format_india(stock_details.purretnwt)) + '</td>' +

				'<td>' + (money_format_india(stock_details.purretdiawt)) + '</td>' +

				'<td>' + (money_format_india(stock_details.purretgrmwt)) + '</td>' +

				'<td>' + (money_format_india(stock_details.purretctwt)) + '</td>' +

				'</tr>';

			trHTML += '<tr>' +

				'<td style="font-weight:bold;color:blue;text-transform:uppercase;"><strong>OUTWARDS</strong></td>' +

				'<td>HO METAL ISSUES</td>' +

				'<td>' + (money_format_india(stock_details.issuegrswt)) + '</td>' +

				'<td>' + (money_format_india(stock_details.issuenwt)) + '</td>' +

				'<td>' + (money_format_india(stock_details.issuediawt)) + '</td>' +

				'<td>' + (money_format_india(stock_details.issuegrmwt)) + '</td>' +

				'<td>' + (money_format_india(stock_details.issuectwt)) + '</td>' +

				'</tr>';

			trHTML += '<tr>' +

				'<td></td>' +

				'<td>HO SECTION STOCK OUTWARD</td>' +

				'<td>' + (money_format_india(stock_details.sectoutgrswt)) + '</td>' +

				'<td>' + (money_format_india(stock_details.sectoutnwt)) + '</td>' +

				'<td>' + (money_format_india(stock_details.sectoutdiawt)) + '</td>' +

				'<td>' + (money_format_india(stock_details.sectoutgrmwt)) + '</td>' +

				'<td>' + (money_format_india(stock_details.sectoutctwt)) + '</td>' +

				'</tr>';

			trHTML += '<tr>' +

				'<td></td>' +

				'<td>POCKET OUTWARD</td>' +

				'<td>' + (money_format_india(stock_details.pocketgrswt)) + '</td>' +

				'<td>' + (money_format_india(stock_details.pocketnwt)) + '</td>' +

				'<td>' + (money_format_india(stock_details.pocketdiawt)) + '</td>' +

				'<td>' + (money_format_india(stock_details.pocketgrmwt)) + '</td>' +

				'<td>' + (money_format_india(stock_details.pocketctwt)) + '</td>' +

				'</tr>';

			trHTML += '<tr style="font-weight:bold;color:red;text-transform:uppercase;">' +

				'<td></td>' +

				'<td><strong>TOTAL</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(total_outwards_grswt).toFixed(3)) + '</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(total_outwards_nwt).toFixed(3)) + '</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(total_outwards_diawt).toFixed(3)) + '</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(total_outwards_grmwt).toFixed(3)) + '</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(total_outwards_ctwt).toFixed(3)) + '</strong></td>' +

				'</tr>';

			// OUTWARDS

			// Profit & Loss

			var total_pl_grswt = parseFloat(parseFloat(stock_details.profitgrswt) - parseFloat(stock_details.lossgrswt));

			var total_pl_nwt = parseFloat(parseFloat(stock_details.profitnwt) - parseFloat(stock_details.lossnwt));

			var total_pl_diawt = parseFloat(parseFloat(stock_details.profitdiawt) - parseFloat(stock_details.lossdiawt));

			var total_pl_grmwt = parseFloat(parseFloat(stock_details.profitgrmwt) - parseFloat(stock_details.lossgrmwt));

			var total_pl_ctwt = parseFloat(parseFloat(stock_details.profitctwt) - parseFloat(stock_details.lossctwt));

			trHTML += '<tr>' +

				'<td style="font-weight:bold;color:blue;text-transform:uppercase;"><strong>P&L</strong></td>' +

				'<td>PROFIT A/C</td>' +

				'<td>' + (money_format_india(parseFloat(stock_details.profitgrswt).toFixed(3))) + '</td>' +

				'<td>' + (money_format_india(parseFloat(stock_details.profitnwt).toFixed(3))) + '</td>' +

				'<td>' + (money_format_india(parseFloat(stock_details.profitdiawt).toFixed(3))) + '</td>' +

				'<td>' + (money_format_india(parseFloat(stock_details.profitgrmwt).toFixed(3))) + '</td>' +

				'<td>' + (money_format_india(parseFloat(stock_details.profitctwt).toFixed(3))) + '</td>' +

				'</tr>';

			trHTML += '<tr>' +

				'<td></td>' +

				'<td>LOSS A/C</td>' +

				'<td>' + (money_format_india(parseFloat(stock_details.lossgrswt).toFixed(3))) + '</td>' +

				'<td>' + (money_format_india(parseFloat(stock_details.lossnwt).toFixed(3))) + '</td>' +

				'<td>' + (money_format_india(parseFloat(stock_details.lossdiawt).toFixed(3))) + '</td>' +

				'<td>' + (money_format_india(parseFloat(stock_details.lossgrmwt).toFixed(3))) + '</td>' +

				'<td>' + (money_format_india(parseFloat(stock_details.lossctwt).toFixed(3))) + '</td>' +

				'</tr>';

			// Profit & Loss

			// CLOSING

			var total_closing_grswt = parseFloat(parseFloat(total_opening_grswt) + parseFloat(total_inwards_grswt) - parseFloat(total_outwards_grswt) + parseFloat(total_pl_grswt));

			var total_closing_nwt = parseFloat(parseFloat(total_opening_nwt) + parseFloat(total_inwards_nwt) - parseFloat(total_outwards_nwt) + parseFloat(total_pl_nwt));

			var total_closing_diawt = parseFloat(parseFloat(total_opening_diawt) + parseFloat(total_inwards_diawt) - parseFloat(total_outwards_diawt) + parseFloat(total_pl_diawt));

			var total_closing_grmwt = parseFloat(parseFloat(total_opening_grmwt) + parseFloat(total_inwards_grmwt) - parseFloat(total_outwards_grmwt) + parseFloat(total_pl_grmwt));

			var total_closing_ctwt = parseFloat(parseFloat(total_opening_ctwt) + parseFloat(total_inwards_ctwt) - parseFloat(total_outwards_ctwt) + parseFloat(total_pl_ctwt));

			trHTML += '<tr style="font-weight:bold;color:red;text-transform:uppercase;">' +

				'<td><strong>CLOSING AS PER OPENING, INWARD,OUTWARD AND P  & L</strong></td>' +

				'<td></td>' +

				'<td><strong>' + money_format_india(parseFloat(total_closing_grswt).toFixed(3)) + '</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(total_closing_nwt).toFixed(3)) + '</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(total_closing_diawt).toFixed(3)) + '</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(total_closing_grmwt).toFixed(3)) + '</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(total_closing_ctwt).toFixed(3)) + '</strong></td>' +

				'</tr>';

			// CLOSING

			// CLOSING BALANCE AS PER THE REPORTS

			var total_closing_balance_grswt = parseFloat(parseFloat(stock_details.hovaultclosingrswt) + parseFloat(stock_details.btvaultclosingrswt) + parseFloat(stock_details.sectionclosinggrswt));

			var total_closing_balance_nwt = parseFloat(parseFloat(stock_details.hovaultclosingnwt) + parseFloat(stock_details.btvaultclosingnwt) + parseFloat(stock_details.sectionclosingnwt));

			var total_closing_balance_diawt = parseFloat(parseFloat(stock_details.hovaultclosingdiawt) + parseFloat(stock_details.btvaultclosingdiawt) + parseFloat(stock_details.sectionclosingdiawt));

			var total_closing_balance_grmwt = parseFloat(parseFloat(stock_details.hovaultclosinggrmwt) + parseFloat(stock_details.btvaultclosinggrmwt) + parseFloat(stock_details.sectionclosinggrmwt));

			var total_closing_balance_ctwt = parseFloat(parseFloat(stock_details.hovaultclosingctwt) + parseFloat(stock_details.btvaultclosingctwt) + parseFloat(stock_details.sectionclosingctwt));

			trHTML += '<tr>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'<td></td>' +

				'</tr>';

			trHTML += '<tr>' +

				'<td></td>' +

				'<td>HO VAULT CLOSING STOCK</td>' +

				'<td>' + money_format_india(parseFloat(stock_details.hovaultclosingrswt).toFixed(3)) + '</td>' +

				'<td>' + money_format_india(parseFloat(stock_details.hovaultclosingnwt).toFixed(3)) + '</td>' +

				'<td>' + money_format_india(parseFloat(stock_details.hovaultclosingdiawt).toFixed(3)) + '</td>' +

				'<td>' + money_format_india(parseFloat(stock_details.hovaultclosinggrmwt).toFixed(3)) + '</td>' +

				'<td>' + money_format_india(parseFloat(stock_details.hovaultclosingctwt).toFixed(3)) + '</td>' +

				'</tr>';

			trHTML += '<tr>' +

				'<td style="font-weight:bold;color:blue;text-transform:uppercase;"><strong>CLOSING BALANCE AS PER THE REPORTS</strong></td>' +

				'<td>HO BT VAULT CLOSING STOCK</td>' +

				'<td>' + money_format_india(parseFloat(stock_details.btvaultclosingrswt).toFixed(3)) + '</td>' +

				'<td>' + money_format_india(parseFloat(stock_details.btvaultclosingnwt).toFixed(3)) + '</td>' +

				'<td>' + money_format_india(parseFloat(stock_details.btvaultclosingdiawt).toFixed(3)) + '</td>' +

				'<td>' + money_format_india(parseFloat(stock_details.btvaultclosinggrmwt).toFixed(3)) + '</td>' +

				'<td>' + money_format_india(parseFloat(stock_details.btvaultclosingctwt).toFixed(3)) + '</td>' +

				'</tr>';

			trHTML += '<tr>' +

				'<td></td>' +

				'<td>HO SECTION CLOSING STOCK</td>' +

				'<td>' + money_format_india(parseFloat(stock_details.sectionclosinggrswt).toFixed(3)) + '</td>' +

				'<td>' + money_format_india(parseFloat(stock_details.sectionclosingnwt).toFixed(3)) + '</td>' +

				'<td>' + money_format_india(parseFloat(stock_details.sectionclosingdiawt).toFixed(3)) + '</td>' +

				'<td>' + money_format_india(parseFloat(stock_details.sectionclosinggrmwt).toFixed(3)) + '</td>' +

				'<td>' + money_format_india(parseFloat(stock_details.sectionclosingctwt).toFixed(3)) + '</td>' +

				'</tr>';

			trHTML += '<tr style="font-weight:bold;color:red;text-transform:uppercase;">' +

				'<td></td>' +

				'<td><strong>TOTAL</td>' +

				'<td><strong>' + money_format_india(parseFloat(total_closing_balance_grswt).toFixed(3)) + '</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(total_closing_balance_nwt).toFixed(3)) + '</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(total_closing_balance_diawt).toFixed(3)) + '</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(total_closing_balance_grmwt).toFixed(3)) + '</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(total_closing_balance_ctwt).toFixed(3)) + '</strong></td>' +

				'</tr>';

			// CLOSING BALANCE AS PER THE REPORTS

			// DIFFERENCES

			trHTML += '<tr style="font-weight:bold;color:red;text-transform:uppercase;">' +

				'<td><strong>DIFFERENCES</strong></td>' +

				'<td></td>' +

				'<td><strong>' + money_format_india(parseFloat(parseFloat(total_closing_grswt) - parseFloat(total_closing_balance_grswt)).toFixed(3)) + '</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(parseFloat(total_closing_nwt) - parseFloat(total_closing_balance_nwt)).toFixed(3)) + '</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(parseFloat(total_closing_diawt) - parseFloat(total_closing_balance_diawt)).toFixed(3)) + '</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(parseFloat(total_closing_grmwt) - parseFloat(total_closing_balance_grmwt)).toFixed(3)) + '</strong></td>' +

				'<td><strong>' + money_format_india(parseFloat(parseFloat(total_closing_ctwt) - parseFloat(total_closing_balance_ctwt)).toFixed(3)) + '</strong></td>' +

				'</tr>';

			// DIFFERENCES

			$('#ho_daily_stock_list > tbody').html(trHTML);

			if (!$.fn.DataTable.isDataTable('#ho_daily_stock_list')) {

				oTable = $('#ho_daily_stock_list').dataTable({

					"bSort": false,

					"bDestroy": true,

					"bInfo": true,

					"scrollX": '100%',

					"paging": false,

					"dom": 'Bfrtip',

					"bAutoWidth": false,

					"responsive": true,

					"fixedHeader": true,

					"lengthMenu": [[-1, 25, 50, 100, 250], ["All", 25, 50, 100, 250]],

					"columnDefs": [

						{

							targets: [2, 3, 4, 5, 6],

							className: 'dt-body-right'

						},

						{

							targets: [0, 1],

							className: 'dt-body-left'

						},

					],

					"buttons": [

						{

							extend: 'print',

							footer: true,

							title: '',

							messageTop: title,

							customize: function (win) {

								$(win.document.body).find('table')

									.addClass('compact');

								$(win.document.body).find('table')

									.addClass('compact')

									.css('font-size', '10px')

									.css('font-family', 'sans-serif');

							},

							exportOptions: {

								columns: ':visible',

								stripHtml: false

							}

						},

						{

							extend: 'colvis',

							collectionLayout: 'fixed columns',

							collectionTitle: 'Column visibility control'

						},

						{

							extend: 'excel',

							footer: true,

							title: 'H.O DAILY STOCK BOOK',

						}

					],

				});

			}

		},

		error: function (error) {

			console.log('Error Occured');

		}

	});

}

/*H.O DAILY STOCK BOOK REPORT*/

function get_product_group() {

	$.ajax({

		type: 'POST',

		url: base_url + 'index.php/admin_ret_catalog/product_grouping/active_product_group',

		dataType: 'json',

		success: function (data) {

			$('#prod_group_id option').remove();

			$("#prod_group_id").append(

				$("<option></option>")

					.attr("value", 0)

					.text('All')

			);

			$.each(data.prod_grp, function (key, item) {

				let metal = $('#metal').val();

				if (parseFloat(metal) > 0 ? parseFloat(item.group_metal) == parseFloat(metal) : true) {

					$('#prod_group_id').append(

						$("<option></option>")

							.attr("value", item.id_prod_group)

							.text(item.group_name)

					);

				}

			});

			$("#prod_group_id").select2({

				placeholder: "Select Product Group",

				allowClear: true

			});

		}

	});

}



function get_metalname() {



	$(".overlay").css('display', 'block');

	$.ajax({

		type: 'GET',

		url: base_url + 'index.php/metal/metalname_list',

		dataType: 'json',

		success: function (data) {

			console.log(data);

			//var scheme_val =  $('#id_metal').val();

			//console.log( $('#id_metal').val());

			$.each(data, function (key, item) {



				$('#metal_select,#filter_metal').append(

					$("<option></option>")

						.attr("value", item.id_metal)

						.text(item.metal)



				);



			});



			$("#metal_select,#filter_metal").select2({

				placeholder: "Select metal name",

				allowClear: true

			});



			//$("#metal_select").select2("val",(scheme_val!='' && scheme_val>0?scheme_val:''));

			//console.log($('#id_metal').val());



			if ($("#metal_select").length) {

				$("#metal_select").select2("val", ($('#id_metal').val() != null ? $('#id_metal').val() : ''));

			}





			$(".overlay").css("display", "none");

		}

	});

}





$(document).ready(function() {

    function toggleHuidField() {

        if ($('#tagged').prop('checked')) {

            $('.huid_block').show();  // Show the HUID field

        } else {

            $('.huid_block').hide();  // Hide the HUID field

        }

    }



    // Run the toggle function initially

    toggleHuidField();



    // Add event listeners to the radio buttons

    $('#tagged, #non_tagged').change(function() {

        toggleHuidField();

    });

});

